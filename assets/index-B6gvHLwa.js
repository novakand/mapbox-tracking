var PU=Object.defineProperty;var DU=(i,e,t)=>e in i?PU(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var ce=(i,e,t)=>DU(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function t(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(s){if(s.ep)return;s.ep=!0;const c=t(s);fetch(s.href,c)}})();var bO=Object.defineProperty,BU=Object.defineProperties,OU=Object.getOwnPropertyDescriptor,FU=Object.getOwnPropertyDescriptors,qR=Object.getOwnPropertySymbols,LU=Object.prototype.hasOwnProperty,zU=Object.prototype.propertyIsEnumerable,kT=(i,e)=>(e=Symbol[i])?e:Symbol.for("Symbol."+i),EE=i=>{throw TypeError(i)},YR=(i,e,t)=>e in i?bO(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Eh=(i,e)=>{for(var t in e||(e={}))LU.call(e,t)&&YR(i,t,e[t]);if(qR)for(var t of qR(e))zU.call(e,t)&&YR(i,t,e[t]);return i},p0=(i,e)=>BU(i,FU(e)),J=(i,e,t,n)=>{for(var s=n>1?void 0:n?OU(e,t):e,c=i.length-1,f;c>=0;c--)(f=i[c])&&(s=(n?f(e,t,s):f(s))||s);return n&&s&&bO(e,t,s),s},vO=(i,e,t)=>e.has(i)||EE("Cannot "+t),NU=(i,e,t)=>(vO(i,e,"read from private field"),e.get(i)),UU=(i,e,t)=>e.has(i)?EE("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),VU=(i,e,t,n)=>(vO(i,e,"write to private field"),e.set(i,t),t),$U=function(i,e){this[0]=i,this[1]=e},jU=i=>{var e=i[kT("asyncIterator")],t=!1,n,s={};return e==null?(e=i[kT("iterator")](),n=c=>s[c]=f=>e[c](f)):(e=e.call(i),n=c=>s[c]=f=>{if(t){if(t=!1,c==="throw")throw f;return f}return t=!0,{done:!1,value:new $U(new Promise(r=>{var b=e[c](f);b instanceof Object||EE("Object expected"),r(b)}),1)}}),s[kT("iterator")]=()=>s,n("next"),"throw"in e?n("throw"):s.throw=c=>{throw c},"return"in e&&n("return"),s},W_=new WeakMap,G_=new WeakMap,X_=new WeakMap,PT=new WeakSet,Bv=new WeakMap,Ch=class{constructor(i,e){this.handleFormData=t=>{const n=this.options.disabled(this.host),s=this.options.name(this.host),c=this.options.value(this.host),f=this.host.tagName.toLowerCase()==="sl-button";this.host.isConnected&&!n&&!f&&typeof s=="string"&&s.length>0&&typeof c<"u"&&(Array.isArray(c)?c.forEach(r=>{t.formData.append(s,r.toString())}):t.formData.append(s,c.toString()))},this.handleFormSubmit=t=>{var n;const s=this.options.disabled(this.host),c=this.options.reportValidity;this.form&&!this.form.noValidate&&((n=W_.get(this.form))==null||n.forEach(f=>{this.setUserInteracted(f,!0)})),this.form&&!this.form.noValidate&&!s&&!c(this.host)&&(t.preventDefault(),t.stopImmediatePropagation())},this.handleFormReset=()=>{this.options.setValue(this.host,this.options.defaultValue(this.host)),this.setUserInteracted(this.host,!1),Bv.set(this.host,[])},this.handleInteraction=t=>{const n=Bv.get(this.host);n.includes(t.type)||n.push(t.type),n.length===this.options.assumeInteractionOn.length&&this.setUserInteracted(this.host,!0)},this.checkFormValidity=()=>{if(this.form&&!this.form.noValidate){const t=this.form.querySelectorAll("*");for(const n of t)if(typeof n.checkValidity=="function"&&!n.checkValidity())return!1}return!0},this.reportFormValidity=()=>{if(this.form&&!this.form.noValidate){const t=this.form.querySelectorAll("*");for(const n of t)if(typeof n.reportValidity=="function"&&!n.reportValidity())return!1}return!0},(this.host=i).addController(this),this.options=Eh({form:t=>{const n=t.form;if(n){const c=t.getRootNode().querySelector(`#${n}`);if(c)return c}return t.closest("form")},name:t=>t.name,value:t=>t.value,defaultValue:t=>t.defaultValue,disabled:t=>{var n;return(n=t.disabled)!=null?n:!1},reportValidity:t=>typeof t.reportValidity=="function"?t.reportValidity():!0,checkValidity:t=>typeof t.checkValidity=="function"?t.checkValidity():!0,setValue:(t,n)=>t.value=n,assumeInteractionOn:["sl-input"]},e)}hostConnected(){const i=this.options.form(this.host);i&&this.attachForm(i),Bv.set(this.host,[]),this.options.assumeInteractionOn.forEach(e=>{this.host.addEventListener(e,this.handleInteraction)})}hostDisconnected(){this.detachForm(),Bv.delete(this.host),this.options.assumeInteractionOn.forEach(i=>{this.host.removeEventListener(i,this.handleInteraction)})}hostUpdated(){const i=this.options.form(this.host);i||this.detachForm(),i&&this.form!==i&&(this.detachForm(),this.attachForm(i)),this.host.hasUpdated&&this.setValidity(this.host.validity.valid)}attachForm(i){i?(this.form=i,W_.has(this.form)?W_.get(this.form).add(this.host):W_.set(this.form,new Set([this.host])),this.form.addEventListener("formdata",this.handleFormData),this.form.addEventListener("submit",this.handleFormSubmit),this.form.addEventListener("reset",this.handleFormReset),G_.has(this.form)||(G_.set(this.form,this.form.reportValidity),this.form.reportValidity=()=>this.reportFormValidity()),X_.has(this.form)||(X_.set(this.form,this.form.checkValidity),this.form.checkValidity=()=>this.checkFormValidity())):this.form=void 0}detachForm(){if(!this.form)return;const i=W_.get(this.form);i&&(i.delete(this.host),i.size<=0&&(this.form.removeEventListener("formdata",this.handleFormData),this.form.removeEventListener("submit",this.handleFormSubmit),this.form.removeEventListener("reset",this.handleFormReset),G_.has(this.form)&&(this.form.reportValidity=G_.get(this.form),G_.delete(this.form)),X_.has(this.form)&&(this.form.checkValidity=X_.get(this.form),X_.delete(this.form)),this.form=void 0))}setUserInteracted(i,e){e?PT.add(i):PT.delete(i),i.requestUpdate()}doAction(i,e){if(this.form){const t=document.createElement("button");t.type=i,t.style.position="absolute",t.style.width="0",t.style.height="0",t.style.clipPath="inset(50%)",t.style.overflow="hidden",t.style.whiteSpace="nowrap",e&&(t.name=e.name,t.value=e.value,["formaction","formenctype","formmethod","formnovalidate","formtarget"].forEach(n=>{e.hasAttribute(n)&&t.setAttribute(n,e.getAttribute(n))})),this.form.append(t),t.click(),t.remove()}}getForm(){var i;return(i=this.form)!=null?i:null}reset(i){this.doAction("reset",i)}submit(i){this.doAction("submit",i)}setValidity(i){const e=this.host,t=!!PT.has(e),n=!!e.required;e.toggleAttribute("data-required",n),e.toggleAttribute("data-optional",!n),e.toggleAttribute("data-invalid",!i),e.toggleAttribute("data-valid",i),e.toggleAttribute("data-user-invalid",!i&&t),e.toggleAttribute("data-user-valid",i&&t)}updateValidity(){const i=this.host;this.setValidity(i.validity.valid)}emitInvalidEvent(i){const e=new CustomEvent("sl-invalid",{bubbles:!1,composed:!1,cancelable:!0,detail:{}});i||e.preventDefault(),this.host.dispatchEvent(e)||i==null||i.preventDefault()}},uw=Object.freeze({badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:!0,valueMissing:!1}),HU=Object.freeze(p0(Eh({},uw),{valid:!1,valueMissing:!0})),WU=Object.freeze(p0(Eh({},uw),{valid:!1,customError:!0}));/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ix=globalThis,CE=Ix.ShadowRoot&&(Ix.ShadyCSS===void 0||Ix.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,IE=Symbol(),ZR=new WeakMap;let xO=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==IE)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(CE&&e===void 0){const n=t!==void 0&&t.length===1;n&&(e=ZR.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&ZR.set(t,e))}return e}toString(){return this.cssText}};const GU=i=>new xO(typeof i=="string"?i:i+"",void 0,IE),ji=(i,...e)=>{const t=i.length===1?i[0]:e.reduce((n,s,c)=>n+(f=>{if(f._$cssResult$===!0)return f.cssText;if(typeof f=="number")return f;throw Error("Value passed to 'css' function must be a 'css' function result: "+f+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+i[c+1],i[0]);return new xO(t,i,IE)},XU=(i,e)=>{if(CE)i.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const n=document.createElement("style"),s=Ix.litNonce;s!==void 0&&n.setAttribute("nonce",s),n.textContent=t.cssText,i.appendChild(n)}},KR=CE?i=>i:i=>i instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return GU(t)})(i):i;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:qU,defineProperty:YU,getOwnPropertyDescriptor:ZU,getOwnPropertyNames:KU,getOwnPropertySymbols:JU,getPrototypeOf:QU}=Object,Bu=globalThis,JR=Bu.trustedTypes,eV=JR?JR.emptyScript:"",DT=Bu.reactiveElementPolyfillSupport,by=(i,e)=>i,Mm={toAttribute(i,e){switch(e){case Boolean:i=i?eV:null;break;case Object:case Array:i=i==null?i:JSON.stringify(i)}return i},fromAttribute(i,e){let t=i;switch(e){case Boolean:t=i!==null;break;case Number:t=i===null?null:Number(i);break;case Object:case Array:try{t=JSON.parse(i)}catch{t=null}}return t}},ME=(i,e)=>!qU(i,e),QR={attribute:!0,type:String,converter:Mm,reflect:!1,useDefault:!1,hasChanged:ME};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Bu.litPropertyMetadata??(Bu.litPropertyMetadata=new WeakMap);let cm=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=QR){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),s=this.getPropertyDescriptor(e,n,t);s!==void 0&&YU(this.prototype,e,s)}}static getPropertyDescriptor(e,t,n){const{get:s,set:c}=ZU(this.prototype,e)??{get(){return this[t]},set(f){this[t]=f}};return{get:s,set(f){const r=s==null?void 0:s.call(this);c==null||c.call(this,f),this.requestUpdate(e,r,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??QR}static _$Ei(){if(this.hasOwnProperty(by("elementProperties")))return;const e=QU(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(by("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(by("properties"))){const t=this.properties,n=[...KU(t),...JU(t)];for(const s of n)this.createProperty(s,t[s])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[n,s]of t)this.elementProperties.set(n,s)}this._$Eh=new Map;for(const[t,n]of this.elementProperties){const s=this._$Eu(t,n);s!==void 0&&this._$Eh.set(s,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const s of n)t.unshift(KR(s))}else e!==void 0&&t.push(KR(e));return t}static _$Eu(e,t){const n=t.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((t=e.hostConnected)==null||t.call(e))}removeController(e){var t;(t=this._$EO)==null||t.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return XU(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(t=>{var n;return(n=t.hostConnected)==null?void 0:n.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(t=>{var n;return(n=t.hostDisconnected)==null?void 0:n.call(t)})}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$ET(e,t){var c;const n=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,n);if(s!==void 0&&n.reflect===!0){const f=(((c=n.converter)==null?void 0:c.toAttribute)!==void 0?n.converter:Mm).toAttribute(t,n.type);this._$Em=e,f==null?this.removeAttribute(s):this.setAttribute(s,f),this._$Em=null}}_$AK(e,t){var c,f;const n=this.constructor,s=n._$Eh.get(e);if(s!==void 0&&this._$Em!==s){const r=n.getPropertyOptions(s),b=typeof r.converter=="function"?{fromAttribute:r.converter}:((c=r.converter)==null?void 0:c.fromAttribute)!==void 0?r.converter:Mm;this._$Em=s,this[s]=b.fromAttribute(t,r.type)??((f=this._$Ej)==null?void 0:f.get(s))??null,this._$Em=null}}requestUpdate(e,t,n){var s;if(e!==void 0){const c=this.constructor,f=this[e];if(n??(n=c.getPropertyOptions(e)),!((n.hasChanged??ME)(f,t)||n.useDefault&&n.reflect&&f===((s=this._$Ej)==null?void 0:s.get(e))&&!this.hasAttribute(c._$Eu(e,n))))return;this.C(e,t,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,t,{useDefault:n,reflect:s,wrapped:c},f){n&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,f??t??this[e]),c!==!0||f!==void 0)||(this._$AL.has(e)||(this.hasUpdated||n||(t=void 0),this._$AL.set(e,t)),s===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var n;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[c,f]of this._$Ep)this[c]=f;this._$Ep=void 0}const s=this.constructor.elementProperties;if(s.size>0)for(const[c,f]of s){const{wrapped:r}=f,b=this[c];r!==!0||this._$AL.has(c)||b===void 0||this.C(c,void 0,f,b)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(n=this._$EO)==null||n.forEach(s=>{var c;return(c=s.hostUpdate)==null?void 0:c.call(s)}),this.update(t)):this._$EM()}catch(s){throw e=!1,this._$EM(),s}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$EO)==null||t.forEach(n=>{var s;return(s=n.hostUpdated)==null?void 0:s.call(n)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(e){}firstUpdated(e){}};cm.elementStyles=[],cm.shadowRootOptions={mode:"open"},cm[by("elementProperties")]=new Map,cm[by("finalized")]=new Map,DT==null||DT({ReactiveElement:cm}),(Bu.reactiveElementVersions??(Bu.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const vy=globalThis,Zx=vy.trustedTypes,ek=Zx?Zx.createPolicy("lit-html",{createHTML:i=>i}):void 0,wO="$lit$",Iu=`lit$${Math.random().toFixed(9).slice(2)}$`,AO="?"+Iu,tV=`<${AO}>`,bf=document,Xy=()=>bf.createComment(""),qy=i=>i===null||typeof i!="object"&&typeof i!="function",RE=Array.isArray,iV=i=>RE(i)||typeof(i==null?void 0:i[Symbol.iterator])=="function",BT=`[ 	
\f\r]`,q_=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,tk=/-->/g,ik=/>/g,Hd=RegExp(`>|${BT}(?:([^\\s"'>=/]+)(${BT}*=${BT}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),nk=/'/g,rk=/"/g,TO=/^(?:script|style|textarea|title)$/i,nV=i=>(e,...t)=>({_$litType$:i,strings:e,values:t}),ei=nV(1),Da=Symbol.for("lit-noChange"),$r=Symbol.for("lit-nothing"),sk=new WeakMap,sf=bf.createTreeWalker(bf,129);function SO(i,e){if(!RE(i)||!i.hasOwnProperty("raw"))throw Error("invalid template strings array");return ek!==void 0?ek.createHTML(e):e}const rV=(i,e)=>{const t=i.length-1,n=[];let s,c=e===2?"<svg>":e===3?"<math>":"",f=q_;for(let r=0;r<t;r++){const b=i[r];let w,E,k=-1,F=0;for(;F<b.length&&(f.lastIndex=F,E=f.exec(b),E!==null);)F=f.lastIndex,f===q_?E[1]==="!--"?f=tk:E[1]!==void 0?f=ik:E[2]!==void 0?(TO.test(E[2])&&(s=RegExp("</"+E[2],"g")),f=Hd):E[3]!==void 0&&(f=Hd):f===Hd?E[0]===">"?(f=s??q_,k=-1):E[1]===void 0?k=-2:(k=f.lastIndex-E[2].length,w=E[1],f=E[3]===void 0?Hd:E[3]==='"'?rk:nk):f===rk||f===nk?f=Hd:f===tk||f===ik?f=q_:(f=Hd,s=void 0);const $=f===Hd&&i[r+1].startsWith("/>")?" ":"";c+=f===q_?b+tV:k>=0?(n.push(w),b.slice(0,k)+wO+b.slice(k)+Iu+$):b+Iu+(k===-2?r:$)}return[SO(i,c+(i[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),n]};let eS=class EO{constructor({strings:e,_$litType$:t},n){let s;this.parts=[];let c=0,f=0;const r=e.length-1,b=this.parts,[w,E]=rV(e,t);if(this.el=EO.createElement(w,n),sf.currentNode=this.el.content,t===2||t===3){const k=this.el.content.firstChild;k.replaceWith(...k.childNodes)}for(;(s=sf.nextNode())!==null&&b.length<r;){if(s.nodeType===1){if(s.hasAttributes())for(const k of s.getAttributeNames())if(k.endsWith(wO)){const F=E[f++],$=s.getAttribute(k).split(Iu),X=/([.?@])?(.*)/.exec(F);b.push({type:1,index:c,name:X[2],strings:$,ctor:X[1]==="."?oV:X[1]==="?"?aV:X[1]==="@"?lV:dw}),s.removeAttribute(k)}else k.startsWith(Iu)&&(b.push({type:6,index:c}),s.removeAttribute(k));if(TO.test(s.tagName)){const k=s.textContent.split(Iu),F=k.length-1;if(F>0){s.textContent=Zx?Zx.emptyScript:"";for(let $=0;$<F;$++)s.append(k[$],Xy()),sf.nextNode(),b.push({type:2,index:++c});s.append(k[F],Xy())}}}else if(s.nodeType===8)if(s.data===AO)b.push({type:2,index:c});else{let k=-1;for(;(k=s.data.indexOf(Iu,k+1))!==-1;)b.push({type:7,index:c}),k+=Iu.length-1}c++}}static createElement(e,t){const n=bf.createElement("template");return n.innerHTML=e,n}};function Rm(i,e,t=i,n){var f,r;if(e===Da)return e;let s=n!==void 0?(f=t._$Co)==null?void 0:f[n]:t._$Cl;const c=qy(e)?void 0:e._$litDirective$;return(s==null?void 0:s.constructor)!==c&&((r=s==null?void 0:s._$AO)==null||r.call(s,!1),c===void 0?s=void 0:(s=new c(i),s._$AT(i,t,n)),n!==void 0?(t._$Co??(t._$Co=[]))[n]=s:t._$Cl=s),s!==void 0&&(e=Rm(i,s._$AS(i,e.values),s,n)),e}let sV=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:n}=this._$AD,s=((e==null?void 0:e.creationScope)??bf).importNode(t,!0);sf.currentNode=s;let c=sf.nextNode(),f=0,r=0,b=n[0];for(;b!==void 0;){if(f===b.index){let w;b.type===2?w=new kE(c,c.nextSibling,this,e):b.type===1?w=new b.ctor(c,b.name,b.strings,this,e):b.type===6&&(w=new cV(c,this,e)),this._$AV.push(w),b=n[++r]}f!==(b==null?void 0:b.index)&&(c=sf.nextNode(),f++)}return sf.currentNode=bf,s}p(e){let t=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}},kE=class CO{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,t,n,s){this.type=2,this._$AH=$r,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=s,this._$Cv=(s==null?void 0:s.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Rm(this,e,t),qy(e)?e===$r||e==null||e===""?(this._$AH!==$r&&this._$AR(),this._$AH=$r):e!==this._$AH&&e!==Da&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):iV(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==$r&&qy(this._$AH)?this._$AA.nextSibling.data=e:this.T(bf.createTextNode(e)),this._$AH=e}$(e){var c;const{values:t,_$litType$:n}=e,s=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=eS.createElement(SO(n.h,n.h[0]),this.options)),n);if(((c=this._$AH)==null?void 0:c._$AD)===s)this._$AH.p(t);else{const f=new sV(s,this),r=f.u(this.options);f.p(t),this.T(r),this._$AH=f}}_$AC(e){let t=sk.get(e.strings);return t===void 0&&sk.set(e.strings,t=new eS(e)),t}k(e){RE(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,s=0;for(const c of e)s===t.length?t.push(n=new CO(this.O(Xy()),this.O(Xy()),this,this.options)):n=t[s],n._$AI(c),s++;s<t.length&&(this._$AR(n&&n._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){var n;for((n=this._$AP)==null?void 0:n.call(this,!1,!0,t);e&&e!==this._$AB;){const s=e.nextSibling;e.remove(),e=s}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},dw=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,s,c){this.type=1,this._$AH=$r,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=c,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=$r}_$AI(e,t=this,n,s){const c=this.strings;let f=!1;if(c===void 0)e=Rm(this,e,t,0),f=!qy(e)||e!==this._$AH&&e!==Da,f&&(this._$AH=e);else{const r=e;let b,w;for(e=c[0],b=0;b<c.length-1;b++)w=Rm(this,r[n+b],t,b),w===Da&&(w=this._$AH[b]),f||(f=!qy(w)||w!==this._$AH[b]),w===$r?e=$r:e!==$r&&(e+=(w??"")+c[b+1]),this._$AH[b]=w}f&&!s&&this.j(e)}j(e){e===$r?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},oV=class extends dw{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===$r?void 0:e}},aV=class extends dw{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==$r)}},lV=class extends dw{constructor(e,t,n,s,c){super(e,t,n,s,c),this.type=5}_$AI(e,t=this){if((e=Rm(this,e,t,0)??$r)===Da)return;const n=this._$AH,s=e===$r&&n!==$r||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,c=e!==$r&&(n===$r||s);s&&this.element.removeEventListener(this.name,this,n),c&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}},cV=class{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Rm(this,e)}};const OT=vy.litHtmlPolyfillSupport;OT==null||OT(eS,kE),(vy.litHtmlVersions??(vy.litHtmlVersions=[])).push("3.3.0");const hV=(i,e,t)=>{const n=(t==null?void 0:t.renderBefore)??e;let s=n._$litPart$;if(s===void 0){const c=(t==null?void 0:t.renderBefore)??null;n._$litPart$=s=new kE(e.insertBefore(Xy(),c),c,void 0,t??{})}return s._$AI(i),s};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const uf=globalThis;let xy=class extends cm{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t;const e=super.createRenderRoot();return(t=this.renderOptions).renderBefore??(t.renderBefore=e.firstChild),e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=hV(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return Da}};var _O;xy._$litElement$=!0,xy.finalized=!0,(_O=uf.litElementHydrateSupport)==null||_O.call(uf,{LitElement:xy});const FT=uf.litElementPolyfillSupport;FT==null||FT({LitElement:xy});(uf.litElementVersions??(uf.litElementVersions=[])).push("4.2.0");var uV=ji`
  :host {
    display: block;
    outline: 0;
    z-index: 0;
  }

  :host(:focus) {
    outline: none;
  }

  slot:not([name])::slotted(sl-icon) {
    margin-inline-end: var(--sl-spacing-x-small);
  }

  .tree-item {
    position: relative;
    display: flex;
    align-items: stretch;
    flex-direction: column;
    color: var(--sl-color-neutral-700);
    cursor: pointer;
    user-select: none;
    -webkit-user-select: none;
  }

  .tree-item__checkbox {
    pointer-events: none;
  }

  .tree-item__expand-button,
  .tree-item__checkbox,
  .tree-item__label {
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    line-height: var(--sl-line-height-dense);
    letter-spacing: var(--sl-letter-spacing-normal);
  }

  .tree-item__checkbox::part(base) {
    display: flex;
    align-items: center;
  }

  .tree-item__indentation {
    display: block;
    width: 1em;
    flex-shrink: 0;
  }

  .tree-item__expand-button {
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: content-box;
    color: var(--sl-color-neutral-500);
    padding: var(--sl-spacing-x-small);
    width: 1rem;
    height: 1rem;
    flex-shrink: 0;
    cursor: pointer;
  }

  .tree-item__expand-button {
    transition: var(--sl-transition-medium) rotate ease;
  }

  .tree-item--expanded .tree-item__expand-button {
    rotate: 90deg;
  }

  .tree-item--expanded.tree-item--rtl .tree-item__expand-button {
    rotate: -90deg;
  }

  .tree-item--expanded slot[name='expand-icon'],
  .tree-item:not(.tree-item--expanded) slot[name='collapse-icon'] {
    display: none;
  }

  .tree-item:not(.tree-item--has-expand-button) .tree-item__expand-icon-slot {
    display: none;
  }

  .tree-item__expand-button--visible {
    cursor: pointer;
  }

  .tree-item__item {
    display: flex;
    align-items: center;
    border-inline-start: solid 3px transparent;
  }

  .tree-item--disabled .tree-item__item {
    opacity: 0.5;
    outline: none;
    cursor: not-allowed;
  }

  :host(:focus-visible) .tree-item__item {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
    z-index: 2;
  }

  :host(:not([aria-disabled='true'])) .tree-item--selected .tree-item__item {
    background-color: var(--sl-color-neutral-100);
    border-inline-start-color: var(--sl-color-primary-600);
  }

  :host(:not([aria-disabled='true'])) .tree-item__expand-button {
    color: var(--sl-color-neutral-600);
  }

  .tree-item__label {
    display: flex;
    align-items: center;
    transition: var(--sl-transition-fast) color;
  }

  .tree-item__children {
    display: block;
    font-size: calc(1em + var(--indent-size, var(--sl-spacing-medium)));
  }

  /* Indentation lines */
  .tree-item__children {
    position: relative;
  }

  .tree-item__children::before {
    content: '';
    position: absolute;
    top: var(--indent-guide-offset);
    bottom: var(--indent-guide-offset);
    left: calc(1em - (var(--indent-guide-width) / 2) - 1px);
    border-inline-end: var(--indent-guide-width) var(--indent-guide-style) var(--indent-guide-color);
    z-index: 1;
  }

  .tree-item--rtl .tree-item__children::before {
    left: auto;
    right: 1em;
  }

  @media (forced-colors: active) {
    :host(:not([aria-disabled='true'])) .tree-item--selected .tree-item__item {
      outline: dashed 1px SelectedItem;
    }
  }
`,dV=ji`
  :host {
    display: inline-block;
  }

  .checkbox {
    position: relative;
    display: inline-flex;
    align-items: flex-start;
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-input-font-weight);
    color: var(--sl-input-label-color);
    vertical-align: middle;
    cursor: pointer;
  }

  .checkbox--small {
    --toggle-size: var(--sl-toggle-size-small);
    font-size: var(--sl-input-font-size-small);
  }

  .checkbox--medium {
    --toggle-size: var(--sl-toggle-size-medium);
    font-size: var(--sl-input-font-size-medium);
  }

  .checkbox--large {
    --toggle-size: var(--sl-toggle-size-large);
    font-size: var(--sl-input-font-size-large);
  }

  .checkbox__control {
    flex: 0 0 auto;
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--toggle-size);
    height: var(--toggle-size);
    border: solid var(--sl-input-border-width) var(--sl-input-border-color);
    border-radius: 2px;
    background-color: var(--sl-input-background-color);
    color: var(--sl-color-neutral-0);
    transition:
      var(--sl-transition-fast) border-color,
      var(--sl-transition-fast) background-color,
      var(--sl-transition-fast) color,
      var(--sl-transition-fast) box-shadow;
  }

  .checkbox__input {
    position: absolute;
    opacity: 0;
    padding: 0;
    margin: 0;
    pointer-events: none;
  }

  .checkbox__checked-icon,
  .checkbox__indeterminate-icon {
    display: inline-flex;
    width: var(--toggle-size);
    height: var(--toggle-size);
  }

  /* Hover */
  .checkbox:not(.checkbox--checked):not(.checkbox--disabled) .checkbox__control:hover {
    border-color: var(--sl-input-border-color-hover);
    background-color: var(--sl-input-background-color-hover);
  }

  /* Focus */
  .checkbox:not(.checkbox--checked):not(.checkbox--disabled) .checkbox__input:focus-visible ~ .checkbox__control {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  /* Checked/indeterminate */
  .checkbox--checked .checkbox__control,
  .checkbox--indeterminate .checkbox__control {
    border-color: var(--sl-color-primary-600);
    background-color: var(--sl-color-primary-600);
  }

  /* Checked/indeterminate + hover */
  .checkbox.checkbox--checked:not(.checkbox--disabled) .checkbox__control:hover,
  .checkbox.checkbox--indeterminate:not(.checkbox--disabled) .checkbox__control:hover {
    border-color: var(--sl-color-primary-500);
    background-color: var(--sl-color-primary-500);
  }

  /* Checked/indeterminate + focus */
  .checkbox.checkbox--checked:not(.checkbox--disabled) .checkbox__input:focus-visible ~ .checkbox__control,
  .checkbox.checkbox--indeterminate:not(.checkbox--disabled) .checkbox__input:focus-visible ~ .checkbox__control {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  /* Disabled */
  .checkbox--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .checkbox__label {
    display: inline-block;
    color: var(--sl-input-label-color);
    line-height: var(--toggle-size);
    margin-inline-start: 0.5em;
    user-select: none;
    -webkit-user-select: none;
  }

  :host([required]) .checkbox__label::after {
    content: var(--sl-input-required-content);
    color: var(--sl-input-required-content-color);
    margin-inline-start: var(--sl-input-required-content-offset);
  }
`,Hm=(i="value")=>(e,t)=>{const n=e.constructor,s=n.prototype.attributeChangedCallback;n.prototype.attributeChangedCallback=function(c,f,r){var b;const w=n.getPropertyOptions(i),E=typeof w.attribute=="string"?w.attribute:i;if(c===E){const k=w.converter||Mm,$=(typeof k=="function"?k:(b=k==null?void 0:k.fromAttribute)!=null?b:Mm.fromAttribute)(r,w.type);this[i]!==$&&(this[t]=$)}s.call(this,c,f,r)}},If=ji`
  .form-control .form-control__label {
    display: none;
  }

  .form-control .form-control__help-text {
    display: none;
  }

  /* Label */
  .form-control--has-label .form-control__label {
    display: inline-block;
    color: var(--sl-input-label-color);
    margin-bottom: var(--sl-spacing-3x-small);
  }

  .form-control--has-label.form-control--small .form-control__label {
    font-size: var(--sl-input-label-font-size-small);
  }

  .form-control--has-label.form-control--medium .form-control__label {
    font-size: var(--sl-input-label-font-size-medium);
  }

  .form-control--has-label.form-control--large .form-control__label {
    font-size: var(--sl-input-label-font-size-large);
  }

  :host([required]) .form-control--has-label .form-control__label::after {
    content: var(--sl-input-required-content);
    margin-inline-start: var(--sl-input-required-content-offset);
    color: var(--sl-input-required-content-color);
  }

  /* Help text */
  .form-control--has-help-text .form-control__help-text {
    display: block;
    color: var(--sl-input-help-text-color);
    margin-top: var(--sl-spacing-3x-small);
  }

  .form-control--has-help-text.form-control--small .form-control__help-text {
    font-size: var(--sl-input-help-text-font-size-small);
  }

  .form-control--has-help-text.form-control--medium .form-control__help-text {
    font-size: var(--sl-input-help-text-font-size-medium);
  }

  .form-control--has-help-text.form-control--large .form-control__help-text {
    font-size: var(--sl-input-help-text-font-size-large);
  }

  .form-control--has-help-text.form-control--radio-group .form-control__help-text {
    margin-top: var(--sl-spacing-2x-small);
  }
`,Uo=class{constructor(i,...e){this.slotNames=[],this.handleSlotChange=t=>{const n=t.target;(this.slotNames.includes("[default]")&&!n.name||n.name&&this.slotNames.includes(n.name))&&this.host.requestUpdate()},(this.host=i).addController(this),this.slotNames=e}hasDefaultSlot(){return[...this.host.childNodes].some(i=>{if(i.nodeType===i.TEXT_NODE&&i.textContent.trim()!=="")return!0;if(i.nodeType===i.ELEMENT_NODE){const e=i;if(e.tagName.toLowerCase()==="sl-visually-hidden")return!1;if(!e.hasAttribute("slot"))return!0}return!1})}hasNamedSlot(i){return this.host.querySelector(`:scope > [slot="${i}"]`)!==null}test(i){return i==="[default]"?this.hasDefaultSlot():this.hasNamedSlot(i)}hostConnected(){this.host.shadowRoot.addEventListener("slotchange",this.handleSlotChange)}hostDisconnected(){this.host.shadowRoot.removeEventListener("slotchange",this.handleSlotChange)}};function fV(i){if(!i)return"";const e=i.assignedNodes({flatten:!0});let t="";return[...e].forEach(n=>{n.nodeType===Node.TEXT_NODE&&(t+=n.textContent)}),t}var tS="";function iS(i){tS=i}function pV(i=""){if(!tS){const e=[...document.getElementsByTagName("script")],t=e.find(n=>n.hasAttribute("data-shoelace"));if(t)iS(t.getAttribute("data-shoelace"));else{const n=e.find(c=>/shoelace(\.min)?\.js($|\?)/.test(c.src)||/shoelace-autoloader(\.min)?\.js($|\?)/.test(c.src));let s="";n&&(s=n.getAttribute("src")),iS(s.split("/").slice(0,-1).join("/"))}}return tS.replace(/\/$/,"")+(i?`/${i.replace(/^\//,"")}`:"")}var mV={name:"default",resolver:i=>pV(`assets/icons/${i}.svg`)},gV=mV,ok={caret:`
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  `,check:`
    <svg part="checked-icon" class="checkbox__icon" viewBox="0 0 16 16">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
        <g stroke="currentColor">
          <g transform="translate(3.428571, 3.428571)">
            <path d="M0,5.71428571 L3.42857143,9.14285714"></path>
            <path d="M9.14285714,0 L3.42857143,9.14285714"></path>
          </g>
        </g>
      </g>
    </svg>
  `,"chevron-down":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
    </svg>
  `,"chevron-left":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
    </svg>
  `,"chevron-right":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
    </svg>
  `,copy:`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2Zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6ZM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2Z"/>
    </svg>
  `,eye:`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
      <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
      <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
    </svg>
  `,"eye-slash":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
      <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/>
      <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/>
      <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>
    </svg>
  `,eyedropper:`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eyedropper" viewBox="0 0 16 16">
      <path d="M13.354.646a1.207 1.207 0 0 0-1.708 0L8.5 3.793l-.646-.647a.5.5 0 1 0-.708.708L8.293 5l-7.147 7.146A.5.5 0 0 0 1 12.5v1.793l-.854.853a.5.5 0 1 0 .708.707L1.707 15H3.5a.5.5 0 0 0 .354-.146L11 7.707l1.146 1.147a.5.5 0 0 0 .708-.708l-.647-.646 3.147-3.146a1.207 1.207 0 0 0 0-1.708l-2-2zM2 12.707l7-7L10.293 7l-7 7H2v-1.293z"></path>
    </svg>
  `,"grip-vertical":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-grip-vertical" viewBox="0 0 16 16">
      <path d="M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path>
    </svg>
  `,indeterminate:`
    <svg part="indeterminate-icon" class="checkbox__icon" viewBox="0 0 16 16">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
        <g stroke="currentColor" stroke-width="2">
          <g transform="translate(2.285714, 6.857143)">
            <path d="M10.2857143,1.14285714 L1.14285714,1.14285714"></path>
          </g>
        </g>
      </g>
    </svg>
  `,"person-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
      <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
    </svg>
  `,"play-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
      <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"></path>
    </svg>
  `,"pause-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause-fill" viewBox="0 0 16 16">
      <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"></path>
    </svg>
  `,radio:`
    <svg part="checked-icon" class="radio__icon" viewBox="0 0 16 16">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g fill="currentColor">
          <circle cx="8" cy="8" r="3.42857143"></circle>
        </g>
      </g>
    </svg>
  `,"star-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
      <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
    </svg>
  `,"x-lg":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
      <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
    </svg>
  `,"x-circle-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
      <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path>
    </svg>
  `},_V={name:"system",resolver:i=>i in ok?`data:image/svg+xml,${encodeURIComponent(ok[i])}`:""},yV=_V,Kx=[gV,yV],Jx=[];function bV(i){Jx.push(i)}function vV(i){Jx=Jx.filter(e=>e!==i)}function ak(i){return Kx.find(e=>e.name===i)}function xV(i,e){wV(i),Kx.push({name:i,resolver:e.resolver,mutator:e.mutator,spriteSheet:e.spriteSheet}),Jx.forEach(t=>{t.library===i&&t.setIcon()})}function wV(i){Kx=Kx.filter(e=>e.name!==i)}var AV=ji`
  :host {
    display: inline-block;
    width: 1em;
    height: 1em;
    box-sizing: content-box !important;
  }

  svg {
    display: block;
    height: 100%;
    width: 100%;
  }
`;function hi(i,e){const t=Eh({waitUntilFirstUpdate:!1},e);return(n,s)=>{const{update:c}=n,f=Array.isArray(i)?i:[i];n.update=function(r){f.forEach(b=>{const w=b;if(r.has(w)){const E=r.get(w),k=this[w];E!==k&&(!t.waitUntilFirstUpdate||this.hasUpdated)&&this[s](E,k)}}),c.call(this,r)}}}var qi=ji`
  :host {
    box-sizing: border-box;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  [hidden] {
    display: none !important;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const TV={attribute:!0,type:String,converter:Mm,reflect:!1,hasChanged:ME},SV=(i=TV,e,t)=>{const{kind:n,metadata:s}=t;let c=globalThis.litPropertyMetadata.get(s);if(c===void 0&&globalThis.litPropertyMetadata.set(s,c=new Map),n==="setter"&&((i=Object.create(i)).wrapped=!0),c.set(t.name,i),n==="accessor"){const{name:f}=t;return{set(r){const b=e.get.call(this);e.set.call(this,r),this.requestUpdate(f,b,i)},init(r){return r!==void 0&&this.C(f,void 0,i,r),r}}}if(n==="setter"){const{name:f}=t;return function(r){const b=this[f];e.call(this,r),this.requestUpdate(f,b,i)}}throw Error("Unsupported decorator location: "+n)};function be(i){return(e,t)=>typeof t=="object"?SV(i,e,t):((n,s,c)=>{const f=s.hasOwnProperty(c);return s.constructor.createProperty(c,n),f?Object.getOwnPropertyDescriptor(s,c):void 0})(i,e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Hi(i){return be({...i,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function m0(i){return(e,t)=>{const n=typeof e=="function"?e:e[t];Object.assign(n,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const IO=(i,e,t)=>(t.configurable=!0,t.enumerable=!0,Reflect.decorate&&typeof e!="object"&&Object.defineProperty(i,e,t),t);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function yi(i,e){return(t,n,s)=>{const c=f=>{var r;return((r=f.renderRoot)==null?void 0:r.querySelector(i))??null};return IO(t,n,{get(){return c(this)}})}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function EV(i){return(e,t)=>IO(e,t,{async get(){var n;return await this.updateComplete,((n=this.renderRoot)==null?void 0:n.querySelector(i))??null}})}var Mx,Li=class extends xy{constructor(){super(),UU(this,Mx,!1),this.initialReflectedProperties=new Map,Object.entries(this.constructor.dependencies).forEach(([i,e])=>{this.constructor.define(i,e)})}emit(i,e){const t=new CustomEvent(i,Eh({bubbles:!0,cancelable:!1,composed:!0,detail:{}},e));return this.dispatchEvent(t),t}static define(i,e=this,t={}){const n=customElements.get(i);if(!n){try{customElements.define(i,e,t)}catch{customElements.define(i,class extends e{},t)}return}let s=" (unknown version)",c=s;"version"in e&&e.version&&(s=" v"+e.version),"version"in n&&n.version&&(c=" v"+n.version),!(s&&c&&s===c)&&console.warn(`Attempted to register <${i}>${s}, but <${i}>${c} has already been registered.`)}attributeChangedCallback(i,e,t){NU(this,Mx)||(this.constructor.elementProperties.forEach((n,s)=>{n.reflect&&this[s]!=null&&this.initialReflectedProperties.set(s,this[s])}),VU(this,Mx,!0)),super.attributeChangedCallback(i,e,t)}willUpdate(i){super.willUpdate(i),this.initialReflectedProperties.forEach((e,t)=>{i.has(t)&&this[t]==null&&(this[t]=e)})}};Mx=new WeakMap;Li.version="2.20.1";Li.dependencies={};J([be()],Li.prototype,"dir",2);J([be()],Li.prototype,"lang",2);/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const CV=(i,e)=>(i==null?void 0:i._$litType$)!==void 0,MO=i=>i.strings===void 0,IV={},MV=(i,e=IV)=>i._$AH=e;var Y_=Symbol(),Ov=Symbol(),LT,zT=new Map,kr=class extends Li{constructor(){super(...arguments),this.initialRender=!1,this.svg=null,this.label="",this.library="default"}async resolveIcon(i,e){var t;let n;if(e!=null&&e.spriteSheet)return this.svg=ei`<svg part="svg">
        <use part="use" href="${i}"></use>
      </svg>`,this.svg;try{if(n=await fetch(i,{mode:"cors"}),!n.ok)return n.status===410?Y_:Ov}catch{return Ov}try{const s=document.createElement("div");s.innerHTML=await n.text();const c=s.firstElementChild;if(((t=c==null?void 0:c.tagName)==null?void 0:t.toLowerCase())!=="svg")return Y_;LT||(LT=new DOMParser);const r=LT.parseFromString(c.outerHTML,"text/html").body.querySelector("svg");return r?(r.part.add("svg"),document.adoptNode(r)):Y_}catch{return Y_}}connectedCallback(){super.connectedCallback(),bV(this)}firstUpdated(){this.initialRender=!0,this.setIcon()}disconnectedCallback(){super.disconnectedCallback(),vV(this)}getIconSource(){const i=ak(this.library);return this.name&&i?{url:i.resolver(this.name),fromLibrary:!0}:{url:this.src,fromLibrary:!1}}handleLabelChange(){typeof this.label=="string"&&this.label.length>0?(this.setAttribute("role","img"),this.setAttribute("aria-label",this.label),this.removeAttribute("aria-hidden")):(this.removeAttribute("role"),this.removeAttribute("aria-label"),this.setAttribute("aria-hidden","true"))}async setIcon(){var i;const{url:e,fromLibrary:t}=this.getIconSource(),n=t?ak(this.library):void 0;if(!e){this.svg=null;return}let s=zT.get(e);if(s||(s=this.resolveIcon(e,n),zT.set(e,s)),!this.initialRender)return;const c=await s;if(c===Ov&&zT.delete(e),e===this.getIconSource().url){if(CV(c)){if(this.svg=c,n){await this.updateComplete;const f=this.shadowRoot.querySelector("[part='svg']");typeof n.mutator=="function"&&f&&n.mutator(f)}return}switch(c){case Ov:case Y_:this.svg=null,this.emit("sl-error");break;default:this.svg=c.cloneNode(!0),(i=n==null?void 0:n.mutator)==null||i.call(n,this.svg),this.emit("sl-load")}}}render(){return this.svg}};kr.styles=[qi,AV];J([Hi()],kr.prototype,"svg",2);J([be({reflect:!0})],kr.prototype,"name",2);J([be()],kr.prototype,"src",2);J([be()],kr.prototype,"label",2);J([be({reflect:!0})],kr.prototype,"library",2);J([hi("label")],kr.prototype,"handleLabelChange",1);J([hi(["name","src","library"])],kr.prototype,"setIcon",1);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Sc={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4},g0=i=>(...e)=>({_$litDirective$:i,values:e});let _0=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Xi=g0(class extends _0{constructor(i){var e;if(super(i),i.type!==Sc.ATTRIBUTE||i.name!=="class"||((e=i.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(i){return" "+Object.keys(i).filter(e=>i[e]).join(" ")+" "}update(i,[e]){var n,s;if(this.st===void 0){this.st=new Set,i.strings!==void 0&&(this.nt=new Set(i.strings.join(" ").split(/\s/).filter(c=>c!=="")));for(const c in e)e[c]&&!((n=this.nt)!=null&&n.has(c))&&this.st.add(c);return this.render(e)}const t=i.element.classList;for(const c of this.st)c in e||(t.remove(c),this.st.delete(c));for(const c in e){const f=!!e[c];f===this.st.has(c)||(s=this.nt)!=null&&s.has(c)||(f?(t.add(c),this.st.add(c)):(t.remove(c),this.st.delete(c)))}return Da}});/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Fi=i=>i??$r;/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const vf=g0(class extends _0{constructor(i){if(super(i),i.type!==Sc.PROPERTY&&i.type!==Sc.ATTRIBUTE&&i.type!==Sc.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!MO(i))throw Error("`live` bindings can only contain a single expression")}render(i){return i}update(i,[e]){if(e===Da||e===$r)return e;const t=i.element,n=i.name;if(i.type===Sc.PROPERTY){if(e===t[n])return Da}else if(i.type===Sc.BOOLEAN_ATTRIBUTE){if(!!e===t.hasAttribute(n))return Da}else if(i.type===Sc.ATTRIBUTE&&t.getAttribute(n)===e+"")return Da;return MV(i),e}});var Ls=class extends Li{constructor(){super(...arguments),this.formControlController=new Ch(this,{value:i=>i.checked?i.value||"on":void 0,defaultValue:i=>i.defaultChecked,setValue:(i,e)=>i.checked=e}),this.hasSlotController=new Uo(this,"help-text"),this.hasFocus=!1,this.title="",this.name="",this.size="medium",this.disabled=!1,this.checked=!1,this.indeterminate=!1,this.defaultChecked=!1,this.form="",this.required=!1,this.helpText=""}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}firstUpdated(){this.formControlController.updateValidity()}handleClick(){this.checked=!this.checked,this.indeterminate=!1,this.emit("sl-change")}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleInput(){this.emit("sl-input")}handleInvalid(i){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(i)}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleDisabledChange(){this.formControlController.setValidity(this.disabled)}handleStateChange(){this.input.checked=this.checked,this.input.indeterminate=this.indeterminate,this.formControlController.updateValidity()}click(){this.input.click()}focus(i){this.input.focus(i)}blur(){this.input.blur()}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.input.reportValidity()}setCustomValidity(i){this.input.setCustomValidity(i),this.formControlController.updateValidity()}render(){const i=this.hasSlotController.test("help-text"),e=this.helpText?!0:!!i;return ei`
      <div
        class=${Xi({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--has-help-text":e})}
      >
        <label
          part="base"
          class=${Xi({checkbox:!0,"checkbox--checked":this.checked,"checkbox--disabled":this.disabled,"checkbox--focused":this.hasFocus,"checkbox--indeterminate":this.indeterminate,"checkbox--small":this.size==="small","checkbox--medium":this.size==="medium","checkbox--large":this.size==="large"})}
        >
          <input
            class="checkbox__input"
            type="checkbox"
            title=${this.title}
            name=${this.name}
            value=${Fi(this.value)}
            .indeterminate=${vf(this.indeterminate)}
            .checked=${vf(this.checked)}
            .disabled=${this.disabled}
            .required=${this.required}
            aria-checked=${this.checked?"true":"false"}
            aria-describedby="help-text"
            @click=${this.handleClick}
            @input=${this.handleInput}
            @invalid=${this.handleInvalid}
            @blur=${this.handleBlur}
            @focus=${this.handleFocus}
          />

          <span
            part="control${this.checked?" control--checked":""}${this.indeterminate?" control--indeterminate":""}"
            class="checkbox__control"
          >
            ${this.checked?ei`
                  <sl-icon part="checked-icon" class="checkbox__checked-icon" library="system" name="check"></sl-icon>
                `:""}
            ${!this.checked&&this.indeterminate?ei`
                  <sl-icon
                    part="indeterminate-icon"
                    class="checkbox__indeterminate-icon"
                    library="system"
                    name="indeterminate"
                  ></sl-icon>
                `:""}
          </span>

          <div part="label" class="checkbox__label">
            <slot></slot>
          </div>
        </label>

        <div
          aria-hidden=${e?"false":"true"}
          class="form-control__help-text"
          id="help-text"
          part="form-control-help-text"
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};Ls.styles=[qi,If,dV];Ls.dependencies={"sl-icon":kr};J([yi('input[type="checkbox"]')],Ls.prototype,"input",2);J([Hi()],Ls.prototype,"hasFocus",2);J([be()],Ls.prototype,"title",2);J([be()],Ls.prototype,"name",2);J([be()],Ls.prototype,"value",2);J([be({reflect:!0})],Ls.prototype,"size",2);J([be({type:Boolean,reflect:!0})],Ls.prototype,"disabled",2);J([be({type:Boolean,reflect:!0})],Ls.prototype,"checked",2);J([be({type:Boolean,reflect:!0})],Ls.prototype,"indeterminate",2);J([Hm("checked")],Ls.prototype,"defaultChecked",2);J([be({reflect:!0})],Ls.prototype,"form",2);J([be({type:Boolean,reflect:!0})],Ls.prototype,"required",2);J([be({attribute:"help-text"})],Ls.prototype,"helpText",2);J([hi("disabled",{waitUntilFirstUpdate:!0})],Ls.prototype,"handleDisabledChange",1);J([hi(["checked","indeterminate"],{waitUntilFirstUpdate:!0})],Ls.prototype,"handleStateChange",1);var RV=ji`
  :host {
    --track-width: 2px;
    --track-color: rgb(128 128 128 / 25%);
    --indicator-color: var(--sl-color-primary-600);
    --speed: 2s;

    display: inline-flex;
    width: 1em;
    height: 1em;
    flex: none;
  }

  .spinner {
    flex: 1 1 auto;
    height: 100%;
    width: 100%;
  }

  .spinner__track,
  .spinner__indicator {
    fill: none;
    stroke-width: var(--track-width);
    r: calc(0.5em - var(--track-width) / 2);
    cx: 0.5em;
    cy: 0.5em;
    transform-origin: 50% 50%;
  }

  .spinner__track {
    stroke: var(--track-color);
    transform-origin: 0% 0%;
  }

  .spinner__indicator {
    stroke: var(--indicator-color);
    stroke-linecap: round;
    stroke-dasharray: 150% 75%;
    animation: spin var(--speed) linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
      stroke-dasharray: 0.05em, 3em;
    }

    50% {
      transform: rotate(450deg);
      stroke-dasharray: 1.375em, 1.375em;
    }

    100% {
      transform: rotate(1080deg);
      stroke-dasharray: 0.05em, 3em;
    }
  }
`;const nS=new Set,dm=new Map;let ef,PE="ltr",DE="en";const RO=typeof MutationObserver<"u"&&typeof document<"u"&&typeof document.documentElement<"u";if(RO){const i=new MutationObserver(PO);PE=document.documentElement.dir||"ltr",DE=document.documentElement.lang||navigator.language,i.observe(document.documentElement,{attributes:!0,attributeFilter:["dir","lang"]})}function kO(...i){i.map(e=>{const t=e.$code.toLowerCase();dm.has(t)?dm.set(t,Object.assign(Object.assign({},dm.get(t)),e)):dm.set(t,e),ef||(ef=e)}),PO()}function PO(){RO&&(PE=document.documentElement.dir||"ltr",DE=document.documentElement.lang||navigator.language),[...nS.keys()].map(i=>{typeof i.requestUpdate=="function"&&i.requestUpdate()})}let kV=class{constructor(e){this.host=e,this.host.addController(this)}hostConnected(){nS.add(this.host)}hostDisconnected(){nS.delete(this.host)}dir(){return`${this.host.dir||PE}`.toLowerCase()}lang(){return`${this.host.lang||DE}`.toLowerCase()}getTranslationData(e){var t,n;const s=new Intl.Locale(e.replace(/_/g,"-")),c=s==null?void 0:s.language.toLowerCase(),f=(n=(t=s==null?void 0:s.region)===null||t===void 0?void 0:t.toLowerCase())!==null&&n!==void 0?n:"",r=dm.get(`${c}-${f}`),b=dm.get(c);return{locale:s,language:c,region:f,primary:r,secondary:b}}exists(e,t){var n;const{primary:s,secondary:c}=this.getTranslationData((n=t.lang)!==null&&n!==void 0?n:this.lang());return t=Object.assign({includeFallback:!1},t),!!(s&&s[e]||c&&c[e]||t.includeFallback&&ef&&ef[e])}term(e,...t){const{primary:n,secondary:s}=this.getTranslationData(this.lang());let c;if(n&&n[e])c=n[e];else if(s&&s[e])c=s[e];else if(ef&&ef[e])c=ef[e];else return console.error(`No translation found for: ${String(e)}`),String(e);return typeof c=="function"?c(...t):c}date(e,t){return e=new Date(e),new Intl.DateTimeFormat(this.lang(),t).format(e)}number(e,t){return e=Number(e),isNaN(e)?"":new Intl.NumberFormat(this.lang(),t).format(e)}relativeTime(e,t,n){return new Intl.RelativeTimeFormat(this.lang(),n).format(e,t)}};var DO={$code:"en",$name:"English",$dir:"ltr",carousel:"Carousel",clearEntry:"Clear entry",close:"Close",copied:"Copied",copy:"Copy",currentValue:"Current value",error:"Error",goToSlide:(i,e)=>`Go to slide ${i} of ${e}`,hidePassword:"Hide password",loading:"Loading",nextSlide:"Next slide",numOptionsSelected:i=>i===0?"No options selected":i===1?"1 option selected":`${i} options selected`,previousSlide:"Previous slide",progress:"Progress",remove:"Remove",resize:"Resize",scrollToEnd:"Scroll to end",scrollToStart:"Scroll to start",selectAColorFromTheScreen:"Select a color from the screen",showPassword:"Show password",slideNum:i=>`Slide ${i}`,toggleColorFormat:"Toggle color format"};kO(DO);var PV=DO,cr=class extends kV{};kO(PV);var y0=class extends Li{constructor(){super(...arguments),this.localize=new cr(this)}render(){return ei`
      <svg part="base" class="spinner" role="progressbar" aria-label=${this.localize.term("loading")}>
        <circle class="spinner__track"></circle>
        <circle class="spinner__indicator"></circle>
      </svg>
    `}};y0.styles=[qi,RV];var BO=new Map,DV=new WeakMap;function BV(i){return i??{keyframes:[],options:{duration:0}}}function lk(i,e){return e.toLowerCase()==="rtl"?{keyframes:i.rtlKeyframes||i.keyframes,options:i.options}:i}function _r(i,e){BO.set(i,BV(e))}function jr(i,e,t){const n=DV.get(i);if(n!=null&&n[e])return lk(n[e],t.dir);const s=BO.get(e);return s?lk(s,t.dir):{keyframes:[],options:{duration:0}}}function ss(i,e,t){return new Promise(n=>{if((t==null?void 0:t.duration)===1/0)throw new Error("Promise-based animations must be finite.");const s=i.animate(e,p0(Eh({},t),{duration:rS()?0:t.duration}));s.addEventListener("cancel",n,{once:!0}),s.addEventListener("finish",n,{once:!0})})}function ck(i){return i=i.toString().toLowerCase(),i.indexOf("ms")>-1?parseFloat(i):i.indexOf("s")>-1?parseFloat(i)*1e3:parseFloat(i)}function rS(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}function Es(i){return Promise.all(i.getAnimations().map(e=>new Promise(t=>{e.cancel(),requestAnimationFrame(t)})))}function Qx(i,e){return i.map(t=>p0(Eh({},t),{height:t.height==="auto"?`${e}px`:t.height}))}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function hk(i,e,t){return i?e(i):t==null?void 0:t(i)}var os=class sS extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.indeterminate=!1,this.isLeaf=!1,this.loading=!1,this.selectable=!1,this.expanded=!1,this.selected=!1,this.disabled=!1,this.lazy=!1}static isTreeItem(e){return e instanceof Element&&e.getAttribute("role")==="treeitem"}connectedCallback(){super.connectedCallback(),this.setAttribute("role","treeitem"),this.setAttribute("tabindex","-1"),this.isNestedItem()&&(this.slot="children")}firstUpdated(){this.childrenContainer.hidden=!this.expanded,this.childrenContainer.style.height=this.expanded?"auto":"0",this.isLeaf=!this.lazy&&this.getChildrenItems().length===0,this.handleExpandedChange()}async animateCollapse(){this.emit("sl-collapse"),await Es(this.childrenContainer);const{keyframes:e,options:t}=jr(this,"tree-item.collapse",{dir:this.localize.dir()});await ss(this.childrenContainer,Qx(e,this.childrenContainer.scrollHeight),t),this.childrenContainer.hidden=!0,this.emit("sl-after-collapse")}isNestedItem(){const e=this.parentElement;return!!e&&sS.isTreeItem(e)}handleChildrenSlotChange(){this.loading=!1,this.isLeaf=!this.lazy&&this.getChildrenItems().length===0}willUpdate(e){e.has("selected")&&!e.has("indeterminate")&&(this.indeterminate=!1)}async animateExpand(){this.emit("sl-expand"),await Es(this.childrenContainer),this.childrenContainer.hidden=!1;const{keyframes:e,options:t}=jr(this,"tree-item.expand",{dir:this.localize.dir()});await ss(this.childrenContainer,Qx(e,this.childrenContainer.scrollHeight),t),this.childrenContainer.style.height="auto",this.emit("sl-after-expand")}handleLoadingChange(){this.setAttribute("aria-busy",this.loading?"true":"false"),this.loading||this.animateExpand()}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false")}handleSelectedChange(){this.setAttribute("aria-selected",this.selected?"true":"false")}handleExpandedChange(){this.isLeaf?this.removeAttribute("aria-expanded"):this.setAttribute("aria-expanded",this.expanded?"true":"false")}handleExpandAnimation(){this.expanded?this.lazy?(this.loading=!0,this.emit("sl-lazy-load")):this.animateExpand():this.animateCollapse()}handleLazyChange(){this.emit("sl-lazy-change")}getChildrenItems({includeDisabled:e=!0}={}){return this.childrenSlot?[...this.childrenSlot.assignedElements({flatten:!0})].filter(t=>sS.isTreeItem(t)&&(e||!t.disabled)):[]}render(){const e=this.localize.dir()==="rtl",t=!this.loading&&(!this.isLeaf||this.lazy);return ei`
      <div
        part="base"
        class="${Xi({"tree-item":!0,"tree-item--expanded":this.expanded,"tree-item--selected":this.selected,"tree-item--disabled":this.disabled,"tree-item--leaf":this.isLeaf,"tree-item--has-expand-button":t,"tree-item--rtl":this.localize.dir()==="rtl"})}"
      >
        <div
          class="tree-item__item"
          part="
            item
            ${this.disabled?"item--disabled":""}
            ${this.expanded?"item--expanded":""}
            ${this.indeterminate?"item--indeterminate":""}
            ${this.selected?"item--selected":""}
          "
        >
          <div class="tree-item__indentation" part="indentation"></div>

          <div
            part="expand-button"
            class=${Xi({"tree-item__expand-button":!0,"tree-item__expand-button--visible":t})}
            aria-hidden="true"
          >
            ${hk(this.loading,()=>ei` <sl-spinner part="spinner" exportparts="base:spinner__base"></sl-spinner> `)}
            <slot class="tree-item__expand-icon-slot" name="expand-icon">
              <sl-icon library="system" name=${e?"chevron-left":"chevron-right"}></sl-icon>
            </slot>
            <slot class="tree-item__expand-icon-slot" name="collapse-icon">
              <sl-icon library="system" name=${e?"chevron-left":"chevron-right"}></sl-icon>
            </slot>
          </div>

          ${hk(this.selectable,()=>ei`
              <sl-checkbox
                part="checkbox"
                exportparts="
                    base:checkbox__base,
                    control:checkbox__control,
                    control--checked:checkbox__control--checked,
                    control--indeterminate:checkbox__control--indeterminate,
                    checked-icon:checkbox__checked-icon,
                    indeterminate-icon:checkbox__indeterminate-icon,
                    label:checkbox__label
                  "
                class="tree-item__checkbox"
                ?disabled="${this.disabled}"
                ?checked="${vf(this.selected)}"
                ?indeterminate="${this.indeterminate}"
                tabindex="-1"
              ></sl-checkbox>
            `)}

          <slot class="tree-item__label" part="label"></slot>
        </div>

        <div class="tree-item__children" part="children" role="group">
          <slot name="children" @slotchange="${this.handleChildrenSlotChange}"></slot>
        </div>
      </div>
    `}};os.styles=[qi,uV];os.dependencies={"sl-checkbox":Ls,"sl-icon":kr,"sl-spinner":y0};J([Hi()],os.prototype,"indeterminate",2);J([Hi()],os.prototype,"isLeaf",2);J([Hi()],os.prototype,"loading",2);J([Hi()],os.prototype,"selectable",2);J([be({type:Boolean,reflect:!0})],os.prototype,"expanded",2);J([be({type:Boolean,reflect:!0})],os.prototype,"selected",2);J([be({type:Boolean,reflect:!0})],os.prototype,"disabled",2);J([be({type:Boolean,reflect:!0})],os.prototype,"lazy",2);J([yi("slot:not([name])")],os.prototype,"defaultSlot",2);J([yi("slot[name=children]")],os.prototype,"childrenSlot",2);J([yi(".tree-item__item")],os.prototype,"itemElement",2);J([yi(".tree-item__children")],os.prototype,"childrenContainer",2);J([yi(".tree-item__expand-button slot")],os.prototype,"expandButtonSlot",2);J([hi("loading",{waitUntilFirstUpdate:!0})],os.prototype,"handleLoadingChange",1);J([hi("disabled")],os.prototype,"handleDisabledChange",1);J([hi("selected")],os.prototype,"handleSelectedChange",1);J([hi("expanded",{waitUntilFirstUpdate:!0})],os.prototype,"handleExpandedChange",1);J([hi("expanded",{waitUntilFirstUpdate:!0})],os.prototype,"handleExpandAnimation",1);J([hi("lazy",{waitUntilFirstUpdate:!0})],os.prototype,"handleLazyChange",1);var wy=os;_r("tree-item.expand",{keyframes:[{height:"0",opacity:"0",overflow:"hidden"},{height:"auto",opacity:"1",overflow:"hidden"}],options:{duration:250,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)"}});_r("tree-item.collapse",{keyframes:[{height:"auto",opacity:"1",overflow:"hidden"},{height:"0",opacity:"0",overflow:"hidden"}],options:{duration:200,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)"}});wy.define("sl-tree-item");var OV=ji`
  :host {
    --max-width: 20rem;
    --hide-delay: 0ms;
    --show-delay: 150ms;

    display: contents;
  }

  .tooltip {
    --arrow-size: var(--sl-tooltip-arrow-size);
    --arrow-color: var(--sl-tooltip-background-color);
  }

  .tooltip::part(popup) {
    z-index: var(--sl-z-index-tooltip);
  }

  .tooltip[placement^='top']::part(popup) {
    transform-origin: bottom;
  }

  .tooltip[placement^='bottom']::part(popup) {
    transform-origin: top;
  }

  .tooltip[placement^='left']::part(popup) {
    transform-origin: right;
  }

  .tooltip[placement^='right']::part(popup) {
    transform-origin: left;
  }

  .tooltip__body {
    display: block;
    width: max-content;
    max-width: var(--max-width);
    border-radius: var(--sl-tooltip-border-radius);
    background-color: var(--sl-tooltip-background-color);
    font-family: var(--sl-tooltip-font-family);
    font-size: var(--sl-tooltip-font-size);
    font-weight: var(--sl-tooltip-font-weight);
    line-height: var(--sl-tooltip-line-height);
    text-align: start;
    white-space: normal;
    color: var(--sl-tooltip-color);
    padding: var(--sl-tooltip-padding);
    pointer-events: none;
    user-select: none;
    -webkit-user-select: none;
  }
`,FV=ji`
  :host {
    --arrow-color: var(--sl-color-neutral-1000);
    --arrow-size: 6px;

    /*
     * These properties are computed to account for the arrow's dimensions after being rotated 45. The constant
     * 0.7071 is derived from sin(45), which is the diagonal size of the arrow's container after rotating.
     */
    --arrow-size-diagonal: calc(var(--arrow-size) * 0.7071);
    --arrow-padding-offset: calc(var(--arrow-size-diagonal) - var(--arrow-size));

    display: contents;
  }

  .popup {
    position: absolute;
    isolation: isolate;
    max-width: var(--auto-size-available-width, none);
    max-height: var(--auto-size-available-height, none);
  }

  .popup--fixed {
    position: fixed;
  }

  .popup:not(.popup--active) {
    display: none;
  }

  .popup__arrow {
    position: absolute;
    width: calc(var(--arrow-size-diagonal) * 2);
    height: calc(var(--arrow-size-diagonal) * 2);
    rotate: 45deg;
    background: var(--arrow-color);
    z-index: -1;
  }

  /* Hover bridge */
  .popup-hover-bridge:not(.popup-hover-bridge--visible) {
    display: none;
  }

  .popup-hover-bridge {
    position: fixed;
    z-index: calc(var(--sl-z-index-dropdown) - 1);
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    clip-path: polygon(
      var(--hover-bridge-top-left-x, 0) var(--hover-bridge-top-left-y, 0),
      var(--hover-bridge-top-right-x, 0) var(--hover-bridge-top-right-y, 0),
      var(--hover-bridge-bottom-right-x, 0) var(--hover-bridge-bottom-right-y, 0),
      var(--hover-bridge-bottom-left-x, 0) var(--hover-bridge-bottom-left-y, 0)
    );
  }
`;const zu=Math.min,ka=Math.max,e1=Math.round,Fv=Math.floor,Mc=i=>({x:i,y:i}),LV={left:"right",right:"left",bottom:"top",top:"bottom"},zV={start:"end",end:"start"};function oS(i,e,t){return ka(i,zu(e,t))}function Wm(i,e){return typeof i=="function"?i(e):i}function Nu(i){return i.split("-")[0]}function Gm(i){return i.split("-")[1]}function OO(i){return i==="x"?"y":"x"}function BE(i){return i==="y"?"height":"width"}function wh(i){return["top","bottom"].includes(Nu(i))?"y":"x"}function OE(i){return OO(wh(i))}function NV(i,e,t){t===void 0&&(t=!1);const n=Gm(i),s=OE(i),c=BE(s);let f=s==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[c]>e.floating[c]&&(f=t1(f)),[f,t1(f)]}function UV(i){const e=t1(i);return[aS(i),e,aS(e)]}function aS(i){return i.replace(/start|end/g,e=>zV[e])}function VV(i,e,t){const n=["left","right"],s=["right","left"],c=["top","bottom"],f=["bottom","top"];switch(i){case"top":case"bottom":return t?e?s:n:e?n:s;case"left":case"right":return e?c:f;default:return[]}}function $V(i,e,t,n){const s=Gm(i);let c=VV(Nu(i),t==="start",n);return s&&(c=c.map(f=>f+"-"+s),e&&(c=c.concat(c.map(aS)))),c}function t1(i){return i.replace(/left|right|bottom|top/g,e=>LV[e])}function jV(i){return{top:0,right:0,bottom:0,left:0,...i}}function FO(i){return typeof i!="number"?jV(i):{top:i,right:i,bottom:i,left:i}}function i1(i){const{x:e,y:t,width:n,height:s}=i;return{width:n,height:s,top:t,left:e,right:e+n,bottom:t+s,x:e,y:t}}function uk(i,e,t){let{reference:n,floating:s}=i;const c=wh(e),f=OE(e),r=BE(f),b=Nu(e),w=c==="y",E=n.x+n.width/2-s.width/2,k=n.y+n.height/2-s.height/2,F=n[r]/2-s[r]/2;let $;switch(b){case"top":$={x:E,y:n.y-s.height};break;case"bottom":$={x:E,y:n.y+n.height};break;case"right":$={x:n.x+n.width,y:k};break;case"left":$={x:n.x-s.width,y:k};break;default:$={x:n.x,y:n.y}}switch(Gm(e)){case"start":$[f]-=F*(t&&w?-1:1);break;case"end":$[f]+=F*(t&&w?-1:1);break}return $}const HV=async(i,e,t)=>{const{placement:n="bottom",strategy:s="absolute",middleware:c=[],platform:f}=t,r=c.filter(Boolean),b=await(f.isRTL==null?void 0:f.isRTL(e));let w=await f.getElementRects({reference:i,floating:e,strategy:s}),{x:E,y:k}=uk(w,n,b),F=n,$={},X=0;for(let W=0;W<r.length;W++){const{name:ne,fn:_e}=r[W],{x:Te,y:we,data:Ee,reset:Le}=await _e({x:E,y:k,initialPlacement:n,placement:F,strategy:s,middlewareData:$,rects:w,platform:f,elements:{reference:i,floating:e}});E=Te??E,k=we??k,$={...$,[ne]:{...$[ne],...Ee}},Le&&X<=50&&(X++,typeof Le=="object"&&(Le.placement&&(F=Le.placement),Le.rects&&(w=Le.rects===!0?await f.getElementRects({reference:i,floating:e,strategy:s}):Le.rects),{x:E,y:k}=uk(w,F,b)),W=-1)}return{x:E,y:k,placement:F,strategy:s,middlewareData:$}};async function FE(i,e){var t;e===void 0&&(e={});const{x:n,y:s,platform:c,rects:f,elements:r,strategy:b}=i,{boundary:w="clippingAncestors",rootBoundary:E="viewport",elementContext:k="floating",altBoundary:F=!1,padding:$=0}=Wm(e,i),X=FO($),ne=r[F?k==="floating"?"reference":"floating":k],_e=i1(await c.getClippingRect({element:(t=await(c.isElement==null?void 0:c.isElement(ne)))==null||t?ne:ne.contextElement||await(c.getDocumentElement==null?void 0:c.getDocumentElement(r.floating)),boundary:w,rootBoundary:E,strategy:b})),Te=k==="floating"?{x:n,y:s,width:f.floating.width,height:f.floating.height}:f.reference,we=await(c.getOffsetParent==null?void 0:c.getOffsetParent(r.floating)),Ee=await(c.isElement==null?void 0:c.isElement(we))?await(c.getScale==null?void 0:c.getScale(we))||{x:1,y:1}:{x:1,y:1},Le=i1(c.convertOffsetParentRelativeRectToViewportRelativeRect?await c.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:Te,offsetParent:we,strategy:b}):Te);return{top:(_e.top-Le.top+X.top)/Ee.y,bottom:(Le.bottom-_e.bottom+X.bottom)/Ee.y,left:(_e.left-Le.left+X.left)/Ee.x,right:(Le.right-_e.right+X.right)/Ee.x}}const WV=i=>({name:"arrow",options:i,async fn(e){const{x:t,y:n,placement:s,rects:c,platform:f,elements:r,middlewareData:b}=e,{element:w,padding:E=0}=Wm(i,e)||{};if(w==null)return{};const k=FO(E),F={x:t,y:n},$=OE(s),X=BE($),W=await f.getDimensions(w),ne=$==="y",_e=ne?"top":"left",Te=ne?"bottom":"right",we=ne?"clientHeight":"clientWidth",Ee=c.reference[X]+c.reference[$]-F[$]-c.floating[X],Le=F[$]-c.reference[$],Je=await(f.getOffsetParent==null?void 0:f.getOffsetParent(w));let Tt=Je?Je[we]:0;(!Tt||!await(f.isElement==null?void 0:f.isElement(Je)))&&(Tt=r.floating[we]||c.floating[X]);const _t=Ee/2-Le/2,St=Tt/2-W[X]/2-1,kt=zu(k[_e],St),Lt=zu(k[Te],St),si=kt,bi=Tt-W[X]-Lt,ii=Tt/2-W[X]/2+_t,vi=oS(si,ii,bi),Zi=!b.arrow&&Gm(s)!=null&&ii!==vi&&c.reference[X]/2-(ii<si?kt:Lt)-W[X]/2<0,Cn=Zi?ii<si?ii-si:ii-bi:0;return{[$]:F[$]+Cn,data:{[$]:vi,centerOffset:ii-vi-Cn,...Zi&&{alignmentOffset:Cn}},reset:Zi}}}),GV=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(e){var t,n;const{placement:s,middlewareData:c,rects:f,initialPlacement:r,platform:b,elements:w}=e,{mainAxis:E=!0,crossAxis:k=!0,fallbackPlacements:F,fallbackStrategy:$="bestFit",fallbackAxisSideDirection:X="none",flipAlignment:W=!0,...ne}=Wm(i,e);if((t=c.arrow)!=null&&t.alignmentOffset)return{};const _e=Nu(s),Te=wh(r),we=Nu(r)===r,Ee=await(b.isRTL==null?void 0:b.isRTL(w.floating)),Le=F||(we||!W?[t1(r)]:UV(r)),Je=X!=="none";!F&&Je&&Le.push(...$V(r,W,X,Ee));const Tt=[r,...Le],_t=await FE(e,ne),St=[];let kt=((n=c.flip)==null?void 0:n.overflows)||[];if(E&&St.push(_t[_e]),k){const ii=NV(s,f,Ee);St.push(_t[ii[0]],_t[ii[1]])}if(kt=[...kt,{placement:s,overflows:St}],!St.every(ii=>ii<=0)){var Lt,si;const ii=(((Lt=c.flip)==null?void 0:Lt.index)||0)+1,vi=Tt[ii];if(vi&&(!(k==="alignment"?Te!==wh(vi):!1)||kt.every(nr=>nr.overflows[0]>0&&wh(nr.placement)===Te)))return{data:{index:ii,overflows:kt},reset:{placement:vi}};let Zi=(si=kt.filter(Cn=>Cn.overflows[0]<=0).sort((Cn,nr)=>Cn.overflows[1]-nr.overflows[1])[0])==null?void 0:si.placement;if(!Zi)switch($){case"bestFit":{var bi;const Cn=(bi=kt.filter(nr=>{if(Je){const vr=wh(nr.placement);return vr===Te||vr==="y"}return!0}).map(nr=>[nr.placement,nr.overflows.filter(vr=>vr>0).reduce((vr,Qi)=>vr+Qi,0)]).sort((nr,vr)=>nr[1]-vr[1])[0])==null?void 0:bi[0];Cn&&(Zi=Cn);break}case"initialPlacement":Zi=r;break}if(s!==Zi)return{reset:{placement:Zi}}}return{}}}};async function XV(i,e){const{placement:t,platform:n,elements:s}=i,c=await(n.isRTL==null?void 0:n.isRTL(s.floating)),f=Nu(t),r=Gm(t),b=wh(t)==="y",w=["left","top"].includes(f)?-1:1,E=c&&b?-1:1,k=Wm(e,i);let{mainAxis:F,crossAxis:$,alignmentAxis:X}=typeof k=="number"?{mainAxis:k,crossAxis:0,alignmentAxis:null}:{mainAxis:k.mainAxis||0,crossAxis:k.crossAxis||0,alignmentAxis:k.alignmentAxis};return r&&typeof X=="number"&&($=r==="end"?X*-1:X),b?{x:$*E,y:F*w}:{x:F*w,y:$*E}}const qV=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(e){var t,n;const{x:s,y:c,placement:f,middlewareData:r}=e,b=await XV(e,i);return f===((t=r.offset)==null?void 0:t.placement)&&(n=r.arrow)!=null&&n.alignmentOffset?{}:{x:s+b.x,y:c+b.y,data:{...b,placement:f}}}}},YV=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(e){const{x:t,y:n,placement:s}=e,{mainAxis:c=!0,crossAxis:f=!1,limiter:r={fn:ne=>{let{x:_e,y:Te}=ne;return{x:_e,y:Te}}},...b}=Wm(i,e),w={x:t,y:n},E=await FE(e,b),k=wh(Nu(s)),F=OO(k);let $=w[F],X=w[k];if(c){const ne=F==="y"?"top":"left",_e=F==="y"?"bottom":"right",Te=$+E[ne],we=$-E[_e];$=oS(Te,$,we)}if(f){const ne=k==="y"?"top":"left",_e=k==="y"?"bottom":"right",Te=X+E[ne],we=X-E[_e];X=oS(Te,X,we)}const W=r.fn({...e,[F]:$,[k]:X});return{...W,data:{x:W.x-t,y:W.y-n,enabled:{[F]:c,[k]:f}}}}}},ZV=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(e){var t,n;const{placement:s,rects:c,platform:f,elements:r}=e,{apply:b=()=>{},...w}=Wm(i,e),E=await FE(e,w),k=Nu(s),F=Gm(s),$=wh(s)==="y",{width:X,height:W}=c.floating;let ne,_e;k==="top"||k==="bottom"?(ne=k,_e=F===(await(f.isRTL==null?void 0:f.isRTL(r.floating))?"start":"end")?"left":"right"):(_e=k,ne=F==="end"?"top":"bottom");const Te=W-E.top-E.bottom,we=X-E.left-E.right,Ee=zu(W-E[ne],Te),Le=zu(X-E[_e],we),Je=!e.middlewareData.shift;let Tt=Ee,_t=Le;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(_t=we),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(Tt=Te),Je&&!F){const kt=ka(E.left,0),Lt=ka(E.right,0),si=ka(E.top,0),bi=ka(E.bottom,0);$?_t=X-2*(kt!==0||Lt!==0?kt+Lt:ka(E.left,E.right)):Tt=W-2*(si!==0||bi!==0?si+bi:ka(E.top,E.bottom))}await b({...e,availableWidth:_t,availableHeight:Tt});const St=await f.getDimensions(r.floating);return X!==St.width||W!==St.height?{reset:{rects:!0}}:{}}}};function fw(){return typeof window<"u"}function Xm(i){return LO(i)?(i.nodeName||"").toLowerCase():"#document"}function Fa(i){var e;return(i==null||(e=i.ownerDocument)==null?void 0:e.defaultView)||window}function Pc(i){var e;return(e=(LO(i)?i.ownerDocument:i.document)||window.document)==null?void 0:e.documentElement}function LO(i){return fw()?i instanceof Node||i instanceof Fa(i).Node:!1}function zl(i){return fw()?i instanceof Element||i instanceof Fa(i).Element:!1}function kc(i){return fw()?i instanceof HTMLElement||i instanceof Fa(i).HTMLElement:!1}function dk(i){return!fw()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Fa(i).ShadowRoot}function b0(i){const{overflow:e,overflowX:t,overflowY:n,display:s}=Nl(i);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(s)}function KV(i){return["table","td","th"].includes(Xm(i))}function pw(i){return[":popover-open",":modal"].some(e=>{try{return i.matches(e)}catch{return!1}})}function mw(i){const e=LE(),t=zl(i)?Nl(i):i;return["transform","translate","scale","rotate","perspective"].some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function JV(i){let e=Uu(i);for(;kc(e)&&!km(e);){if(mw(e))return e;if(pw(e))return null;e=Uu(e)}return null}function LE(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function km(i){return["html","body","#document"].includes(Xm(i))}function Nl(i){return Fa(i).getComputedStyle(i)}function gw(i){return zl(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function Uu(i){if(Xm(i)==="html")return i;const e=i.assignedSlot||i.parentNode||dk(i)&&i.host||Pc(i);return dk(e)?e.host:e}function zO(i){const e=Uu(i);return km(e)?i.ownerDocument?i.ownerDocument.body:i.body:kc(e)&&b0(e)?e:zO(e)}function Yy(i,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=zO(i),c=s===((n=i.ownerDocument)==null?void 0:n.body),f=Fa(s);if(c){const r=lS(f);return e.concat(f,f.visualViewport||[],b0(s)?s:[],r&&t?Yy(r):[])}return e.concat(s,Yy(s,[],t))}function lS(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function NO(i){const e=Nl(i);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=kc(i),c=s?i.offsetWidth:t,f=s?i.offsetHeight:n,r=e1(t)!==c||e1(n)!==f;return r&&(t=c,n=f),{width:t,height:n,$:r}}function zE(i){return zl(i)?i:i.contextElement}function vm(i){const e=zE(i);if(!kc(e))return Mc(1);const t=e.getBoundingClientRect(),{width:n,height:s,$:c}=NO(e);let f=(c?e1(t.width):t.width)/n,r=(c?e1(t.height):t.height)/s;return(!f||!Number.isFinite(f))&&(f=1),(!r||!Number.isFinite(r))&&(r=1),{x:f,y:r}}const QV=Mc(0);function UO(i){const e=Fa(i);return!LE()||!e.visualViewport?QV:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function e8(i,e,t){return e===void 0&&(e=!1),!t||e&&t!==Fa(i)?!1:e}function xf(i,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=i.getBoundingClientRect(),c=zE(i);let f=Mc(1);e&&(n?zl(n)&&(f=vm(n)):f=vm(i));const r=e8(c,t,n)?UO(c):Mc(0);let b=(s.left+r.x)/f.x,w=(s.top+r.y)/f.y,E=s.width/f.x,k=s.height/f.y;if(c){const F=Fa(c),$=n&&zl(n)?Fa(n):n;let X=F,W=lS(X);for(;W&&n&&$!==X;){const ne=vm(W),_e=W.getBoundingClientRect(),Te=Nl(W),we=_e.left+(W.clientLeft+parseFloat(Te.paddingLeft))*ne.x,Ee=_e.top+(W.clientTop+parseFloat(Te.paddingTop))*ne.y;b*=ne.x,w*=ne.y,E*=ne.x,k*=ne.y,b+=we,w+=Ee,X=Fa(W),W=lS(X)}}return i1({width:E,height:k,x:b,y:w})}function NE(i,e){const t=gw(i).scrollLeft;return e?e.left+t:xf(Pc(i)).left+t}function VO(i,e,t){t===void 0&&(t=!1);const n=i.getBoundingClientRect(),s=n.left+e.scrollLeft-(t?0:NE(i,n)),c=n.top+e.scrollTop;return{x:s,y:c}}function t8(i){let{elements:e,rect:t,offsetParent:n,strategy:s}=i;const c=s==="fixed",f=Pc(n),r=e?pw(e.floating):!1;if(n===f||r&&c)return t;let b={scrollLeft:0,scrollTop:0},w=Mc(1);const E=Mc(0),k=kc(n);if((k||!k&&!c)&&((Xm(n)!=="body"||b0(f))&&(b=gw(n)),kc(n))){const $=xf(n);w=vm(n),E.x=$.x+n.clientLeft,E.y=$.y+n.clientTop}const F=f&&!k&&!c?VO(f,b,!0):Mc(0);return{width:t.width*w.x,height:t.height*w.y,x:t.x*w.x-b.scrollLeft*w.x+E.x+F.x,y:t.y*w.y-b.scrollTop*w.y+E.y+F.y}}function i8(i){return Array.from(i.getClientRects())}function n8(i){const e=Pc(i),t=gw(i),n=i.ownerDocument.body,s=ka(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),c=ka(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let f=-t.scrollLeft+NE(i);const r=-t.scrollTop;return Nl(n).direction==="rtl"&&(f+=ka(e.clientWidth,n.clientWidth)-s),{width:s,height:c,x:f,y:r}}function r8(i,e){const t=Fa(i),n=Pc(i),s=t.visualViewport;let c=n.clientWidth,f=n.clientHeight,r=0,b=0;if(s){c=s.width,f=s.height;const w=LE();(!w||w&&e==="fixed")&&(r=s.offsetLeft,b=s.offsetTop)}return{width:c,height:f,x:r,y:b}}function s8(i,e){const t=xf(i,!0,e==="fixed"),n=t.top+i.clientTop,s=t.left+i.clientLeft,c=kc(i)?vm(i):Mc(1),f=i.clientWidth*c.x,r=i.clientHeight*c.y,b=s*c.x,w=n*c.y;return{width:f,height:r,x:b,y:w}}function fk(i,e,t){let n;if(e==="viewport")n=r8(i,t);else if(e==="document")n=n8(Pc(i));else if(zl(e))n=s8(e,t);else{const s=UO(i);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return i1(n)}function $O(i,e){const t=Uu(i);return t===e||!zl(t)||km(t)?!1:Nl(t).position==="fixed"||$O(t,e)}function o8(i,e){const t=e.get(i);if(t)return t;let n=Yy(i,[],!1).filter(r=>zl(r)&&Xm(r)!=="body"),s=null;const c=Nl(i).position==="fixed";let f=c?Uu(i):i;for(;zl(f)&&!km(f);){const r=Nl(f),b=mw(f);!b&&r.position==="fixed"&&(s=null),(c?!b&&!s:!b&&r.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||b0(f)&&!b&&$O(i,f))?n=n.filter(E=>E!==f):s=r,f=Uu(f)}return e.set(i,n),n}function a8(i){let{element:e,boundary:t,rootBoundary:n,strategy:s}=i;const f=[...t==="clippingAncestors"?pw(e)?[]:o8(e,this._c):[].concat(t),n],r=f[0],b=f.reduce((w,E)=>{const k=fk(e,E,s);return w.top=ka(k.top,w.top),w.right=zu(k.right,w.right),w.bottom=zu(k.bottom,w.bottom),w.left=ka(k.left,w.left),w},fk(e,r,s));return{width:b.right-b.left,height:b.bottom-b.top,x:b.left,y:b.top}}function l8(i){const{width:e,height:t}=NO(i);return{width:e,height:t}}function c8(i,e,t){const n=kc(e),s=Pc(e),c=t==="fixed",f=xf(i,!0,c,e);let r={scrollLeft:0,scrollTop:0};const b=Mc(0);function w(){b.x=NE(s)}if(n||!n&&!c)if((Xm(e)!=="body"||b0(s))&&(r=gw(e)),n){const $=xf(e,!0,c,e);b.x=$.x+e.clientLeft,b.y=$.y+e.clientTop}else s&&w();c&&!n&&s&&w();const E=s&&!n&&!c?VO(s,r):Mc(0),k=f.left+r.scrollLeft-b.x-E.x,F=f.top+r.scrollTop-b.y-E.y;return{x:k,y:F,width:f.width,height:f.height}}function NT(i){return Nl(i).position==="static"}function pk(i,e){if(!kc(i)||Nl(i).position==="fixed")return null;if(e)return e(i);let t=i.offsetParent;return Pc(i)===t&&(t=t.ownerDocument.body),t}function jO(i,e){const t=Fa(i);if(pw(i))return t;if(!kc(i)){let s=Uu(i);for(;s&&!km(s);){if(zl(s)&&!NT(s))return s;s=Uu(s)}return t}let n=pk(i,e);for(;n&&KV(n)&&NT(n);)n=pk(n,e);return n&&km(n)&&NT(n)&&!mw(n)?t:n||JV(i)||t}const h8=async function(i){const e=this.getOffsetParent||jO,t=this.getDimensions,n=await t(i.floating);return{reference:c8(i.reference,await e(i.floating),i.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function u8(i){return Nl(i).direction==="rtl"}const Rx={convertOffsetParentRelativeRectToViewportRelativeRect:t8,getDocumentElement:Pc,getClippingRect:a8,getOffsetParent:jO,getElementRects:h8,getClientRects:i8,getDimensions:l8,getScale:vm,isElement:zl,isRTL:u8};function HO(i,e){return i.x===e.x&&i.y===e.y&&i.width===e.width&&i.height===e.height}function d8(i,e){let t=null,n;const s=Pc(i);function c(){var r;clearTimeout(n),(r=t)==null||r.disconnect(),t=null}function f(r,b){r===void 0&&(r=!1),b===void 0&&(b=1),c();const w=i.getBoundingClientRect(),{left:E,top:k,width:F,height:$}=w;if(r||e(),!F||!$)return;const X=Fv(k),W=Fv(s.clientWidth-(E+F)),ne=Fv(s.clientHeight-(k+$)),_e=Fv(E),we={rootMargin:-X+"px "+-W+"px "+-ne+"px "+-_e+"px",threshold:ka(0,zu(1,b))||1};let Ee=!0;function Le(Je){const Tt=Je[0].intersectionRatio;if(Tt!==b){if(!Ee)return f();Tt?f(!1,Tt):n=setTimeout(()=>{f(!1,1e-7)},1e3)}Tt===1&&!HO(w,i.getBoundingClientRect())&&f(),Ee=!1}try{t=new IntersectionObserver(Le,{...we,root:s.ownerDocument})}catch{t=new IntersectionObserver(Le,we)}t.observe(i)}return f(!0),c}function f8(i,e,t,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:c=!0,elementResize:f=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:b=!1}=n,w=zE(i),E=s||c?[...w?Yy(w):[],...Yy(e)]:[];E.forEach(_e=>{s&&_e.addEventListener("scroll",t,{passive:!0}),c&&_e.addEventListener("resize",t)});const k=w&&r?d8(w,t):null;let F=-1,$=null;f&&($=new ResizeObserver(_e=>{let[Te]=_e;Te&&Te.target===w&&$&&($.unobserve(e),cancelAnimationFrame(F),F=requestAnimationFrame(()=>{var we;(we=$)==null||we.observe(e)})),t()}),w&&!b&&$.observe(w),$.observe(e));let X,W=b?xf(i):null;b&&ne();function ne(){const _e=xf(i);W&&!HO(W,_e)&&t(),W=_e,X=requestAnimationFrame(ne)}return t(),()=>{var _e;E.forEach(Te=>{s&&Te.removeEventListener("scroll",t),c&&Te.removeEventListener("resize",t)}),k==null||k(),(_e=$)==null||_e.disconnect(),$=null,b&&cancelAnimationFrame(X)}}const p8=qV,m8=YV,g8=GV,mk=ZV,_8=WV,y8=(i,e,t)=>{const n=new Map,s={platform:Rx,...t},c={...s.platform,_c:n};return HV(i,e,{...s,platform:c})};function b8(i){return v8(i)}function UT(i){return i.assignedSlot?i.assignedSlot:i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}function v8(i){for(let e=i;e;e=UT(e))if(e instanceof Element&&getComputedStyle(e).display==="none")return null;for(let e=UT(i);e;e=UT(e)){if(!(e instanceof Element))continue;const t=getComputedStyle(e);if(t.display!=="contents"&&(t.position!=="static"||mw(t)||e.tagName==="BODY"))return e}return null}function x8(i){return i!==null&&typeof i=="object"&&"getBoundingClientRect"in i&&("contextElement"in i?i.contextElement instanceof Element:!0)}var yr=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.active=!1,this.placement="top",this.strategy="absolute",this.distance=0,this.skidding=0,this.arrow=!1,this.arrowPlacement="anchor",this.arrowPadding=10,this.flip=!1,this.flipFallbackPlacements="",this.flipFallbackStrategy="best-fit",this.flipPadding=0,this.shift=!1,this.shiftPadding=0,this.autoSizePadding=0,this.hoverBridge=!1,this.updateHoverBridge=()=>{if(this.hoverBridge&&this.anchorEl){const i=this.anchorEl.getBoundingClientRect(),e=this.popup.getBoundingClientRect(),t=this.placement.includes("top")||this.placement.includes("bottom");let n=0,s=0,c=0,f=0,r=0,b=0,w=0,E=0;t?i.top<e.top?(n=i.left,s=i.bottom,c=i.right,f=i.bottom,r=e.left,b=e.top,w=e.right,E=e.top):(n=e.left,s=e.bottom,c=e.right,f=e.bottom,r=i.left,b=i.top,w=i.right,E=i.top):i.left<e.left?(n=i.right,s=i.top,c=e.left,f=e.top,r=i.right,b=i.bottom,w=e.left,E=e.bottom):(n=e.right,s=e.top,c=i.left,f=i.top,r=e.right,b=e.bottom,w=i.left,E=i.bottom),this.style.setProperty("--hover-bridge-top-left-x",`${n}px`),this.style.setProperty("--hover-bridge-top-left-y",`${s}px`),this.style.setProperty("--hover-bridge-top-right-x",`${c}px`),this.style.setProperty("--hover-bridge-top-right-y",`${f}px`),this.style.setProperty("--hover-bridge-bottom-left-x",`${r}px`),this.style.setProperty("--hover-bridge-bottom-left-y",`${b}px`),this.style.setProperty("--hover-bridge-bottom-right-x",`${w}px`),this.style.setProperty("--hover-bridge-bottom-right-y",`${E}px`)}}}async connectedCallback(){super.connectedCallback(),await this.updateComplete,this.start()}disconnectedCallback(){super.disconnectedCallback(),this.stop()}async updated(i){super.updated(i),i.has("active")&&(this.active?this.start():this.stop()),i.has("anchor")&&this.handleAnchorChange(),this.active&&(await this.updateComplete,this.reposition())}async handleAnchorChange(){if(await this.stop(),this.anchor&&typeof this.anchor=="string"){const i=this.getRootNode();this.anchorEl=i.getElementById(this.anchor)}else this.anchor instanceof Element||x8(this.anchor)?this.anchorEl=this.anchor:this.anchorEl=this.querySelector('[slot="anchor"]');this.anchorEl instanceof HTMLSlotElement&&(this.anchorEl=this.anchorEl.assignedElements({flatten:!0})[0]),this.anchorEl&&this.active&&this.start()}start(){!this.anchorEl||!this.active||(this.cleanup=f8(this.anchorEl,this.popup,()=>{this.reposition()}))}async stop(){return new Promise(i=>{this.cleanup?(this.cleanup(),this.cleanup=void 0,this.removeAttribute("data-current-placement"),this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height"),requestAnimationFrame(()=>i())):i()})}reposition(){if(!this.active||!this.anchorEl)return;const i=[p8({mainAxis:this.distance,crossAxis:this.skidding})];this.sync?i.push(mk({apply:({rects:t})=>{const n=this.sync==="width"||this.sync==="both",s=this.sync==="height"||this.sync==="both";this.popup.style.width=n?`${t.reference.width}px`:"",this.popup.style.height=s?`${t.reference.height}px`:""}})):(this.popup.style.width="",this.popup.style.height=""),this.flip&&i.push(g8({boundary:this.flipBoundary,fallbackPlacements:this.flipFallbackPlacements,fallbackStrategy:this.flipFallbackStrategy==="best-fit"?"bestFit":"initialPlacement",padding:this.flipPadding})),this.shift&&i.push(m8({boundary:this.shiftBoundary,padding:this.shiftPadding})),this.autoSize?i.push(mk({boundary:this.autoSizeBoundary,padding:this.autoSizePadding,apply:({availableWidth:t,availableHeight:n})=>{this.autoSize==="vertical"||this.autoSize==="both"?this.style.setProperty("--auto-size-available-height",`${n}px`):this.style.removeProperty("--auto-size-available-height"),this.autoSize==="horizontal"||this.autoSize==="both"?this.style.setProperty("--auto-size-available-width",`${t}px`):this.style.removeProperty("--auto-size-available-width")}})):(this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height")),this.arrow&&i.push(_8({element:this.arrowEl,padding:this.arrowPadding}));const e=this.strategy==="absolute"?t=>Rx.getOffsetParent(t,b8):Rx.getOffsetParent;y8(this.anchorEl,this.popup,{placement:this.placement,middleware:i,strategy:this.strategy,platform:p0(Eh({},Rx),{getOffsetParent:e})}).then(({x:t,y:n,middlewareData:s,placement:c})=>{const f=this.localize.dir()==="rtl",r={top:"bottom",right:"left",bottom:"top",left:"right"}[c.split("-")[0]];if(this.setAttribute("data-current-placement",c),Object.assign(this.popup.style,{left:`${t}px`,top:`${n}px`}),this.arrow){const b=s.arrow.x,w=s.arrow.y;let E="",k="",F="",$="";if(this.arrowPlacement==="start"){const X=typeof b=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";E=typeof w=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"",k=f?X:"",$=f?"":X}else if(this.arrowPlacement==="end"){const X=typeof b=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";k=f?"":X,$=f?X:"",F=typeof w=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:""}else this.arrowPlacement==="center"?($=typeof b=="number"?"calc(50% - var(--arrow-size-diagonal))":"",E=typeof w=="number"?"calc(50% - var(--arrow-size-diagonal))":""):($=typeof b=="number"?`${b}px`:"",E=typeof w=="number"?`${w}px`:"");Object.assign(this.arrowEl.style,{top:E,right:k,bottom:F,left:$,[r]:"calc(var(--arrow-size-diagonal) * -1)"})}}),requestAnimationFrame(()=>this.updateHoverBridge()),this.emit("sl-reposition")}render(){return ei`
      <slot name="anchor" @slotchange=${this.handleAnchorChange}></slot>

      <span
        part="hover-bridge"
        class=${Xi({"popup-hover-bridge":!0,"popup-hover-bridge--visible":this.hoverBridge&&this.active})}
      ></span>

      <div
        part="popup"
        class=${Xi({popup:!0,"popup--active":this.active,"popup--fixed":this.strategy==="fixed","popup--has-arrow":this.arrow})}
      >
        <slot></slot>
        ${this.arrow?ei`<div part="arrow" class="popup__arrow" role="presentation"></div>`:""}
      </div>
    `}};yr.styles=[qi,FV];J([yi(".popup")],yr.prototype,"popup",2);J([yi(".popup__arrow")],yr.prototype,"arrowEl",2);J([be()],yr.prototype,"anchor",2);J([be({type:Boolean,reflect:!0})],yr.prototype,"active",2);J([be({reflect:!0})],yr.prototype,"placement",2);J([be({reflect:!0})],yr.prototype,"strategy",2);J([be({type:Number})],yr.prototype,"distance",2);J([be({type:Number})],yr.prototype,"skidding",2);J([be({type:Boolean})],yr.prototype,"arrow",2);J([be({attribute:"arrow-placement"})],yr.prototype,"arrowPlacement",2);J([be({attribute:"arrow-padding",type:Number})],yr.prototype,"arrowPadding",2);J([be({type:Boolean})],yr.prototype,"flip",2);J([be({attribute:"flip-fallback-placements",converter:{fromAttribute:i=>i.split(" ").map(e=>e.trim()).filter(e=>e!==""),toAttribute:i=>i.join(" ")}})],yr.prototype,"flipFallbackPlacements",2);J([be({attribute:"flip-fallback-strategy"})],yr.prototype,"flipFallbackStrategy",2);J([be({type:Object})],yr.prototype,"flipBoundary",2);J([be({attribute:"flip-padding",type:Number})],yr.prototype,"flipPadding",2);J([be({type:Boolean})],yr.prototype,"shift",2);J([be({type:Object})],yr.prototype,"shiftBoundary",2);J([be({attribute:"shift-padding",type:Number})],yr.prototype,"shiftPadding",2);J([be({attribute:"auto-size"})],yr.prototype,"autoSize",2);J([be()],yr.prototype,"sync",2);J([be({type:Object})],yr.prototype,"autoSizeBoundary",2);J([be({attribute:"auto-size-padding",type:Number})],yr.prototype,"autoSizePadding",2);J([be({attribute:"hover-bridge",type:Boolean})],yr.prototype,"hoverBridge",2);function No(i,e){return new Promise(t=>{function n(s){s.target===i&&(i.removeEventListener(e,n),t())}i.addEventListener(e,n)})}var qs=class extends Li{constructor(){super(),this.localize=new cr(this),this.content="",this.placement="top",this.disabled=!1,this.distance=8,this.open=!1,this.skidding=0,this.trigger="hover focus",this.hoist=!1,this.handleBlur=()=>{this.hasTrigger("focus")&&this.hide()},this.handleClick=()=>{this.hasTrigger("click")&&(this.open?this.hide():this.show())},this.handleFocus=()=>{this.hasTrigger("focus")&&this.show()},this.handleDocumentKeyDown=i=>{i.key==="Escape"&&(i.stopPropagation(),this.hide())},this.handleMouseOver=()=>{if(this.hasTrigger("hover")){const i=ck(getComputedStyle(this).getPropertyValue("--show-delay"));clearTimeout(this.hoverTimeout),this.hoverTimeout=window.setTimeout(()=>this.show(),i)}},this.handleMouseOut=()=>{if(this.hasTrigger("hover")){const i=ck(getComputedStyle(this).getPropertyValue("--hide-delay"));clearTimeout(this.hoverTimeout),this.hoverTimeout=window.setTimeout(()=>this.hide(),i)}},this.addEventListener("blur",this.handleBlur,!0),this.addEventListener("focus",this.handleFocus,!0),this.addEventListener("click",this.handleClick),this.addEventListener("mouseover",this.handleMouseOver),this.addEventListener("mouseout",this.handleMouseOut)}disconnectedCallback(){var i;super.disconnectedCallback(),(i=this.closeWatcher)==null||i.destroy(),document.removeEventListener("keydown",this.handleDocumentKeyDown)}firstUpdated(){this.body.hidden=!this.open,this.open&&(this.popup.active=!0,this.popup.reposition())}hasTrigger(i){return this.trigger.split(" ").includes(i)}async handleOpenChange(){var i,e;if(this.open){if(this.disabled)return;this.emit("sl-show"),"CloseWatcher"in window?((i=this.closeWatcher)==null||i.destroy(),this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>{this.hide()}):document.addEventListener("keydown",this.handleDocumentKeyDown),await Es(this.body),this.body.hidden=!1,this.popup.active=!0;const{keyframes:t,options:n}=jr(this,"tooltip.show",{dir:this.localize.dir()});await ss(this.popup.popup,t,n),this.popup.reposition(),this.emit("sl-after-show")}else{this.emit("sl-hide"),(e=this.closeWatcher)==null||e.destroy(),document.removeEventListener("keydown",this.handleDocumentKeyDown),await Es(this.body);const{keyframes:t,options:n}=jr(this,"tooltip.hide",{dir:this.localize.dir()});await ss(this.popup.popup,t,n),this.popup.active=!1,this.body.hidden=!0,this.emit("sl-after-hide")}}async handleOptionsChange(){this.hasUpdated&&(await this.updateComplete,this.popup.reposition())}handleDisabledChange(){this.disabled&&this.open&&this.hide()}async show(){if(!this.open)return this.open=!0,No(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,No(this,"sl-after-hide")}render(){return ei`
      <sl-popup
        part="base"
        exportparts="
          popup:base__popup,
          arrow:base__arrow
        "
        class=${Xi({tooltip:!0,"tooltip--open":this.open})}
        placement=${this.placement}
        distance=${this.distance}
        skidding=${this.skidding}
        strategy=${this.hoist?"fixed":"absolute"}
        flip
        shift
        arrow
        hover-bridge
      >
        ${""}
        <slot slot="anchor" aria-describedby="tooltip"></slot>

        ${""}
        <div part="body" id="tooltip" class="tooltip__body" role="tooltip" aria-live=${this.open?"polite":"off"}>
          <slot name="content">${this.content}</slot>
        </div>
      </sl-popup>
    `}};qs.styles=[qi,OV];qs.dependencies={"sl-popup":yr};J([yi("slot:not([name])")],qs.prototype,"defaultSlot",2);J([yi(".tooltip__body")],qs.prototype,"body",2);J([yi("sl-popup")],qs.prototype,"popup",2);J([be()],qs.prototype,"content",2);J([be()],qs.prototype,"placement",2);J([be({type:Boolean,reflect:!0})],qs.prototype,"disabled",2);J([be({type:Number})],qs.prototype,"distance",2);J([be({type:Boolean,reflect:!0})],qs.prototype,"open",2);J([be({type:Number})],qs.prototype,"skidding",2);J([be()],qs.prototype,"trigger",2);J([be({type:Boolean})],qs.prototype,"hoist",2);J([hi("open",{waitUntilFirstUpdate:!0})],qs.prototype,"handleOpenChange",1);J([hi(["content","distance","hoist","placement","skidding"])],qs.prototype,"handleOptionsChange",1);J([hi("disabled")],qs.prototype,"handleDisabledChange",1);_r("tooltip.show",{keyframes:[{opacity:0,scale:.8},{opacity:1,scale:1}],options:{duration:150,easing:"ease"}});_r("tooltip.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.8}],options:{duration:150,easing:"ease"}});qs.define("sl-tooltip");var w8=ji`
  :host {
    /*
     * These are actually used by tree item, but we define them here so they can more easily be set and all tree items
     * stay consistent.
     */
    --indent-guide-color: var(--sl-color-neutral-200);
    --indent-guide-offset: 0;
    --indent-guide-style: solid;
    --indent-guide-width: 0;
    --indent-size: var(--sl-spacing-large);

    display: block;

    /*
     * Tree item indentation uses the "em" unit to increment its width on each level, so setting the font size to zero
     * here removes the indentation for all the nodes on the first level.
     */
    font-size: 0;
  }
`;function ws(i,e,t){const n=s=>Object.is(s,-0)?0:s;return i<e?n(e):i>t?n(t):n(i)}function gk(i,e=!1){function t(c){const f=c.getChildrenItems({includeDisabled:!1});if(f.length){const r=f.every(w=>w.selected),b=f.every(w=>!w.selected&&!w.indeterminate);c.selected=r,c.indeterminate=!r&&!b}}function n(c){const f=c.parentElement;wy.isTreeItem(f)&&(t(f),n(f))}function s(c){for(const f of c.getChildrenItems())f.selected=e?c.selected||f.selected:!f.disabled&&c.selected,s(f);e&&t(c)}s(i),n(i)}var Mf=class extends Li{constructor(){super(),this.selection="single",this.clickTarget=null,this.localize=new cr(this),this.initTreeItem=i=>{i.selectable=this.selection==="multiple",["expand","collapse"].filter(e=>!!this.querySelector(`[slot="${e}-icon"]`)).forEach(e=>{const t=i.querySelector(`[slot="${e}-icon"]`),n=this.getExpandButtonIcon(e);n&&(t===null?i.append(n):t.hasAttribute("data-default")&&t.replaceWith(n))})},this.handleTreeChanged=i=>{for(const e of i){const t=[...e.addedNodes].filter(wy.isTreeItem),n=[...e.removedNodes].filter(wy.isTreeItem);t.forEach(this.initTreeItem),this.lastFocusedItem&&n.includes(this.lastFocusedItem)&&(this.lastFocusedItem=null)}},this.handleFocusOut=i=>{const e=i.relatedTarget;(!e||!this.contains(e))&&(this.tabIndex=0)},this.handleFocusIn=i=>{const e=i.target;i.target===this&&this.focusItem(this.lastFocusedItem||this.getAllTreeItems()[0]),wy.isTreeItem(e)&&!e.disabled&&(this.lastFocusedItem&&(this.lastFocusedItem.tabIndex=-1),this.lastFocusedItem=e,this.tabIndex=-1,e.tabIndex=0)},this.addEventListener("focusin",this.handleFocusIn),this.addEventListener("focusout",this.handleFocusOut),this.addEventListener("sl-lazy-change",this.handleSlotChange)}async connectedCallback(){super.connectedCallback(),this.setAttribute("role","tree"),this.setAttribute("tabindex","0"),await this.updateComplete,this.mutationObserver=new MutationObserver(this.handleTreeChanged),this.mutationObserver.observe(this,{childList:!0,subtree:!0})}disconnectedCallback(){var i;super.disconnectedCallback(),(i=this.mutationObserver)==null||i.disconnect()}getExpandButtonIcon(i){const t=(i==="expand"?this.expandedIconSlot:this.collapsedIconSlot).assignedElements({flatten:!0})[0];if(t){const n=t.cloneNode(!0);return[n,...n.querySelectorAll("[id]")].forEach(s=>s.removeAttribute("id")),n.setAttribute("data-default",""),n.slot=`${i}-icon`,n}return null}selectItem(i){const e=[...this.selectedItems];if(this.selection==="multiple")i.selected=!i.selected,i.lazy&&(i.expanded=!0),gk(i);else if(this.selection==="single"||i.isLeaf){const n=this.getAllTreeItems();for(const s of n)s.selected=s===i}else this.selection==="leaf"&&(i.expanded=!i.expanded);const t=this.selectedItems;(e.length!==t.length||t.some(n=>!e.includes(n)))&&Promise.all(t.map(n=>n.updateComplete)).then(()=>{this.emit("sl-selection-change",{detail:{selection:t}})})}getAllTreeItems(){return[...this.querySelectorAll("sl-tree-item")]}focusItem(i){i==null||i.focus()}handleKeyDown(i){if(!["ArrowDown","ArrowUp","ArrowRight","ArrowLeft","Home","End","Enter"," "].includes(i.key)||i.composedPath().some(s=>{var c;return["input","textarea"].includes((c=s==null?void 0:s.tagName)==null?void 0:c.toLowerCase())}))return;const e=this.getFocusableItems(),t=this.localize.dir()==="ltr",n=this.localize.dir()==="rtl";if(e.length>0){i.preventDefault();const s=e.findIndex(b=>b.matches(":focus")),c=e[s],f=b=>{const w=e[ws(b,0,e.length-1)];this.focusItem(w)},r=b=>{c.expanded=b};i.key==="ArrowDown"?f(s+1):i.key==="ArrowUp"?f(s-1):t&&i.key==="ArrowRight"||n&&i.key==="ArrowLeft"?!c||c.disabled||c.expanded||c.isLeaf&&!c.lazy?f(s+1):r(!0):t&&i.key==="ArrowLeft"||n&&i.key==="ArrowRight"?!c||c.disabled||c.isLeaf||!c.expanded?f(s-1):r(!1):i.key==="Home"?f(0):i.key==="End"?f(e.length-1):(i.key==="Enter"||i.key===" ")&&(c.disabled||this.selectItem(c))}}handleClick(i){const e=i.target,t=e.closest("sl-tree-item"),n=i.composedPath().some(s=>{var c;return(c=s==null?void 0:s.classList)==null?void 0:c.contains("tree-item__expand-button")});!t||t.disabled||e!==this.clickTarget||(n?t.expanded=!t.expanded:this.selectItem(t))}handleMouseDown(i){this.clickTarget=i.target}handleSlotChange(){this.getAllTreeItems().forEach(this.initTreeItem)}async handleSelectionChange(){const i=this.selection==="multiple",e=this.getAllTreeItems();this.setAttribute("aria-multiselectable",i?"true":"false");for(const t of e)t.selectable=i;i&&(await this.updateComplete,[...this.querySelectorAll(":scope > sl-tree-item")].forEach(t=>gk(t,!0)))}get selectedItems(){const i=this.getAllTreeItems(),e=t=>t.selected;return i.filter(e)}getFocusableItems(){const i=this.getAllTreeItems(),e=new Set;return i.filter(t=>{var n;if(t.disabled)return!1;const s=(n=t.parentElement)==null?void 0:n.closest("[role=treeitem]");return s&&(!s.expanded||s.loading||e.has(s))&&e.add(t),!e.has(t)})}render(){return ei`
      <div
        part="base"
        class="tree"
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
        @mousedown=${this.handleMouseDown}
      >
        <slot @slotchange=${this.handleSlotChange}></slot>
        <span hidden aria-hidden="true"><slot name="expand-icon"></slot></span>
        <span hidden aria-hidden="true"><slot name="collapse-icon"></slot></span>
      </div>
    `}};Mf.styles=[qi,w8];J([yi("slot:not([name])")],Mf.prototype,"defaultSlot",2);J([yi("slot[name=expand-icon]")],Mf.prototype,"expandedIconSlot",2);J([yi("slot[name=collapse-icon]")],Mf.prototype,"collapsedIconSlot",2);J([be()],Mf.prototype,"selection",2);J([hi("selection")],Mf.prototype,"handleSelectionChange",1);Mf.define("sl-tree");var A8=ji`
  :host(:not(:focus-within)) {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    clip: rect(0 0 0 0) !important;
    clip-path: inset(50%) !important;
    border: none !important;
    overflow: hidden !important;
    white-space: nowrap !important;
    padding: 0 !important;
  }
`,UE=class extends Li{render(){return ei` <slot></slot> `}};UE.styles=[qi,A8];UE.define("sl-visually-hidden");var T8=ji`
  :host {
    --padding: 0;

    display: none;
  }

  :host([active]) {
    display: block;
  }

  .tab-panel {
    display: block;
    padding: var(--padding);
  }
`,S8=0,v0=class extends Li{constructor(){super(...arguments),this.attrId=++S8,this.componentId=`sl-tab-panel-${this.attrId}`,this.name="",this.active=!1}connectedCallback(){super.connectedCallback(),this.id=this.id.length>0?this.id:this.componentId,this.setAttribute("role","tabpanel")}handleActiveChange(){this.setAttribute("aria-hidden",this.active?"false":"true")}render(){return ei`
      <slot
        part="base"
        class=${Xi({"tab-panel":!0,"tab-panel--active":this.active})}
      ></slot>
    `}};v0.styles=[qi,T8];J([be({reflect:!0})],v0.prototype,"name",2);J([be({type:Boolean,reflect:!0})],v0.prototype,"active",2);J([hi("active")],v0.prototype,"handleActiveChange",1);v0.define("sl-tab-panel");var E8=ji`
  :host {
    display: inline-block;
  }

  .tag {
    display: flex;
    align-items: center;
    border: solid 1px;
    line-height: 1;
    white-space: nowrap;
    user-select: none;
    -webkit-user-select: none;
  }

  .tag__remove::part(base) {
    color: inherit;
    padding: 0;
  }

  /*
   * Variant modifiers
   */

  .tag--primary {
    background-color: var(--sl-color-primary-50);
    border-color: var(--sl-color-primary-200);
    color: var(--sl-color-primary-800);
  }

  .tag--primary:active > sl-icon-button {
    color: var(--sl-color-primary-600);
  }

  .tag--success {
    background-color: var(--sl-color-success-50);
    border-color: var(--sl-color-success-200);
    color: var(--sl-color-success-800);
  }

  .tag--success:active > sl-icon-button {
    color: var(--sl-color-success-600);
  }

  .tag--neutral {
    background-color: var(--sl-color-neutral-50);
    border-color: var(--sl-color-neutral-200);
    color: var(--sl-color-neutral-800);
  }

  .tag--neutral:active > sl-icon-button {
    color: var(--sl-color-neutral-600);
  }

  .tag--warning {
    background-color: var(--sl-color-warning-50);
    border-color: var(--sl-color-warning-200);
    color: var(--sl-color-warning-800);
  }

  .tag--warning:active > sl-icon-button {
    color: var(--sl-color-warning-600);
  }

  .tag--danger {
    background-color: var(--sl-color-danger-50);
    border-color: var(--sl-color-danger-200);
    color: var(--sl-color-danger-800);
  }

  .tag--danger:active > sl-icon-button {
    color: var(--sl-color-danger-600);
  }

  /*
   * Size modifiers
   */

  .tag--small {
    font-size: var(--sl-button-font-size-small);
    height: calc(var(--sl-input-height-small) * 0.8);
    line-height: calc(var(--sl-input-height-small) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-small);
    padding: 0 var(--sl-spacing-x-small);
  }

  .tag--medium {
    font-size: var(--sl-button-font-size-medium);
    height: calc(var(--sl-input-height-medium) * 0.8);
    line-height: calc(var(--sl-input-height-medium) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-medium);
    padding: 0 var(--sl-spacing-small);
  }

  .tag--large {
    font-size: var(--sl-button-font-size-large);
    height: calc(var(--sl-input-height-large) * 0.8);
    line-height: calc(var(--sl-input-height-large) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-large);
    padding: 0 var(--sl-spacing-medium);
  }

  .tag__remove {
    margin-inline-start: var(--sl-spacing-x-small);
  }

  /*
   * Pill modifier
   */

  .tag--pill {
    border-radius: var(--sl-border-radius-pill);
  }
`,C8=ji`
  :host {
    display: inline-block;
    color: var(--sl-color-neutral-600);
  }

  .icon-button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    background: none;
    border: none;
    border-radius: var(--sl-border-radius-medium);
    font-size: inherit;
    color: inherit;
    padding: var(--sl-spacing-x-small);
    cursor: pointer;
    transition: var(--sl-transition-x-fast) color;
    -webkit-appearance: none;
  }

  .icon-button:hover:not(.icon-button--disabled),
  .icon-button:focus-visible:not(.icon-button--disabled) {
    color: var(--sl-color-primary-600);
  }

  .icon-button:active:not(.icon-button--disabled) {
    color: var(--sl-color-primary-700);
  }

  .icon-button:focus {
    outline: none;
  }

  .icon-button--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .icon-button:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .icon-button__icon {
    pointer-events: none;
  }
`;/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const WO=Symbol.for(""),I8=i=>{if((i==null?void 0:i.r)===WO)return i==null?void 0:i._$litStatic$},n1=(i,...e)=>({_$litStatic$:e.reduce((t,n,s)=>t+(c=>{if(c._$litStatic$!==void 0)return c._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${c}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(n)+i[s+1],i[0]),r:WO}),_k=new Map,M8=i=>(e,...t)=>{const n=t.length;let s,c;const f=[],r=[];let b,w=0,E=!1;for(;w<n;){for(b=e[w];w<n&&(c=t[w],(s=I8(c))!==void 0);)b+=s+e[++w],E=!0;w!==n&&r.push(c),f.push(b),w++}if(w===n&&f.push(e[n]),E){const k=f.join("$$lit$$");(e=_k.get(k))===void 0&&(f.raw=f,_k.set(k,e=f)),t=r}return i(e,...t)},Ay=M8(ei);var zs=class extends Li{constructor(){super(...arguments),this.hasFocus=!1,this.label="",this.disabled=!1}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleClick(i){this.disabled&&(i.preventDefault(),i.stopPropagation())}click(){this.button.click()}focus(i){this.button.focus(i)}blur(){this.button.blur()}render(){const i=!!this.href,e=i?n1`a`:n1`button`;return Ay`
      <${e}
        part="base"
        class=${Xi({"icon-button":!0,"icon-button--disabled":!i&&this.disabled,"icon-button--focused":this.hasFocus})}
        ?disabled=${Fi(i?void 0:this.disabled)}
        type=${Fi(i?void 0:"button")}
        href=${Fi(i?this.href:void 0)}
        target=${Fi(i?this.target:void 0)}
        download=${Fi(i?this.download:void 0)}
        rel=${Fi(i&&this.target?"noreferrer noopener":void 0)}
        role=${Fi(i?void 0:"button")}
        aria-disabled=${this.disabled?"true":"false"}
        aria-label="${this.label}"
        tabindex=${this.disabled?"-1":"0"}
        @blur=${this.handleBlur}
        @focus=${this.handleFocus}
        @click=${this.handleClick}
      >
        <sl-icon
          class="icon-button__icon"
          name=${Fi(this.name)}
          library=${Fi(this.library)}
          src=${Fi(this.src)}
          aria-hidden="true"
        ></sl-icon>
      </${e}>
    `}};zs.styles=[qi,C8];zs.dependencies={"sl-icon":kr};J([yi(".icon-button")],zs.prototype,"button",2);J([Hi()],zs.prototype,"hasFocus",2);J([be()],zs.prototype,"name",2);J([be()],zs.prototype,"library",2);J([be()],zs.prototype,"src",2);J([be()],zs.prototype,"href",2);J([be()],zs.prototype,"target",2);J([be()],zs.prototype,"download",2);J([be()],zs.prototype,"label",2);J([be({type:Boolean,reflect:!0})],zs.prototype,"disabled",2);var ju=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.variant="neutral",this.size="medium",this.pill=!1,this.removable=!1}handleRemoveClick(){this.emit("sl-remove")}render(){return ei`
      <span
        part="base"
        class=${Xi({tag:!0,"tag--primary":this.variant==="primary","tag--success":this.variant==="success","tag--neutral":this.variant==="neutral","tag--warning":this.variant==="warning","tag--danger":this.variant==="danger","tag--text":this.variant==="text","tag--small":this.size==="small","tag--medium":this.size==="medium","tag--large":this.size==="large","tag--pill":this.pill,"tag--removable":this.removable})}
      >
        <slot part="content" class="tag__content"></slot>

        ${this.removable?ei`
              <sl-icon-button
                part="remove-button"
                exportparts="base:remove-button__base"
                name="x-lg"
                library="system"
                label=${this.localize.term("remove")}
                class="tag__remove"
                @click=${this.handleRemoveClick}
                tabindex="-1"
              ></sl-icon-button>
            `:""}
      </span>
    `}};ju.styles=[qi,E8];ju.dependencies={"sl-icon-button":zs};J([be({reflect:!0})],ju.prototype,"variant",2);J([be({reflect:!0})],ju.prototype,"size",2);J([be({type:Boolean,reflect:!0})],ju.prototype,"pill",2);J([be({type:Boolean})],ju.prototype,"removable",2);ju.define("sl-tag");var R8=ji`
  :host {
    display: block;
  }

  .textarea {
    display: grid;
    align-items: center;
    position: relative;
    width: 100%;
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-input-font-weight);
    line-height: var(--sl-line-height-normal);
    letter-spacing: var(--sl-input-letter-spacing);
    vertical-align: middle;
    transition:
      var(--sl-transition-fast) color,
      var(--sl-transition-fast) border,
      var(--sl-transition-fast) box-shadow,
      var(--sl-transition-fast) background-color;
    cursor: text;
  }

  /* Standard textareas */
  .textarea--standard {
    background-color: var(--sl-input-background-color);
    border: solid var(--sl-input-border-width) var(--sl-input-border-color);
  }

  .textarea--standard:hover:not(.textarea--disabled) {
    background-color: var(--sl-input-background-color-hover);
    border-color: var(--sl-input-border-color-hover);
  }
  .textarea--standard:hover:not(.textarea--disabled) .textarea__control {
    color: var(--sl-input-color-hover);
  }

  .textarea--standard.textarea--focused:not(.textarea--disabled) {
    background-color: var(--sl-input-background-color-focus);
    border-color: var(--sl-input-border-color-focus);
    color: var(--sl-input-color-focus);
    box-shadow: 0 0 0 var(--sl-focus-ring-width) var(--sl-input-focus-ring-color);
  }

  .textarea--standard.textarea--focused:not(.textarea--disabled) .textarea__control {
    color: var(--sl-input-color-focus);
  }

  .textarea--standard.textarea--disabled {
    background-color: var(--sl-input-background-color-disabled);
    border-color: var(--sl-input-border-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
  }

  .textarea__control,
  .textarea__size-adjuster {
    grid-area: 1 / 1 / 2 / 2;
  }

  .textarea__size-adjuster {
    visibility: hidden;
    pointer-events: none;
    opacity: 0;
  }

  .textarea--standard.textarea--disabled .textarea__control {
    color: var(--sl-input-color-disabled);
  }

  .textarea--standard.textarea--disabled .textarea__control::placeholder {
    color: var(--sl-input-placeholder-color-disabled);
  }

  /* Filled textareas */
  .textarea--filled {
    border: none;
    background-color: var(--sl-input-filled-background-color);
    color: var(--sl-input-color);
  }

  .textarea--filled:hover:not(.textarea--disabled) {
    background-color: var(--sl-input-filled-background-color-hover);
  }

  .textarea--filled.textarea--focused:not(.textarea--disabled) {
    background-color: var(--sl-input-filled-background-color-focus);
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .textarea--filled.textarea--disabled {
    background-color: var(--sl-input-filled-background-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
  }

  .textarea__control {
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    line-height: 1.4;
    color: var(--sl-input-color);
    border: none;
    background: none;
    box-shadow: none;
    cursor: inherit;
    -webkit-appearance: none;
  }

  .textarea__control::-webkit-search-decoration,
  .textarea__control::-webkit-search-cancel-button,
  .textarea__control::-webkit-search-results-button,
  .textarea__control::-webkit-search-results-decoration {
    -webkit-appearance: none;
  }

  .textarea__control::placeholder {
    color: var(--sl-input-placeholder-color);
    user-select: none;
    -webkit-user-select: none;
  }

  .textarea__control:focus {
    outline: none;
  }

  /*
   * Size modifiers
   */

  .textarea--small {
    border-radius: var(--sl-input-border-radius-small);
    font-size: var(--sl-input-font-size-small);
  }

  .textarea--small .textarea__control {
    padding: 0.5em var(--sl-input-spacing-small);
  }

  .textarea--medium {
    border-radius: var(--sl-input-border-radius-medium);
    font-size: var(--sl-input-font-size-medium);
  }

  .textarea--medium .textarea__control {
    padding: 0.5em var(--sl-input-spacing-medium);
  }

  .textarea--large {
    border-radius: var(--sl-input-border-radius-large);
    font-size: var(--sl-input-font-size-large);
  }

  .textarea--large .textarea__control {
    padding: 0.5em var(--sl-input-spacing-large);
  }

  /*
   * Resize types
   */

  .textarea--resize-none .textarea__control {
    resize: none;
  }

  .textarea--resize-vertical .textarea__control {
    resize: vertical;
  }

  .textarea--resize-auto .textarea__control {
    height: auto;
    resize: none;
    overflow-y: hidden;
  }
`,hr=class extends Li{constructor(){super(...arguments),this.formControlController=new Ch(this,{assumeInteractionOn:["sl-blur","sl-input"]}),this.hasSlotController=new Uo(this,"help-text","label"),this.hasFocus=!1,this.title="",this.name="",this.value="",this.size="medium",this.filled=!1,this.label="",this.helpText="",this.placeholder="",this.rows=4,this.resize="vertical",this.disabled=!1,this.readonly=!1,this.form="",this.required=!1,this.spellcheck=!0,this.defaultValue=""}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(()=>this.setTextareaHeight()),this.updateComplete.then(()=>{this.setTextareaHeight(),this.resizeObserver.observe(this.input)})}firstUpdated(){this.formControlController.updateValidity()}disconnectedCallback(){var i;super.disconnectedCallback(),this.input&&((i=this.resizeObserver)==null||i.unobserve(this.input))}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleChange(){this.value=this.input.value,this.setTextareaHeight(),this.emit("sl-change")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleInput(){this.value=this.input.value,this.emit("sl-input")}handleInvalid(i){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(i)}setTextareaHeight(){this.resize==="auto"?(this.sizeAdjuster.style.height=`${this.input.clientHeight}px`,this.input.style.height="auto",this.input.style.height=`${this.input.scrollHeight}px`):this.input.style.height=""}handleDisabledChange(){this.formControlController.setValidity(this.disabled)}handleRowsChange(){this.setTextareaHeight()}async handleValueChange(){await this.updateComplete,this.formControlController.updateValidity(),this.setTextareaHeight()}focus(i){this.input.focus(i)}blur(){this.input.blur()}select(){this.input.select()}scrollPosition(i){if(i){typeof i.top=="number"&&(this.input.scrollTop=i.top),typeof i.left=="number"&&(this.input.scrollLeft=i.left);return}return{top:this.input.scrollTop,left:this.input.scrollTop}}setSelectionRange(i,e,t="none"){this.input.setSelectionRange(i,e,t)}setRangeText(i,e,t,n="preserve"){const s=e??this.input.selectionStart,c=t??this.input.selectionEnd;this.input.setRangeText(i,s,c,n),this.value!==this.input.value&&(this.value=this.input.value,this.setTextareaHeight())}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.input.reportValidity()}setCustomValidity(i){this.input.setCustomValidity(i),this.formControlController.updateValidity()}render(){const i=this.hasSlotController.test("label"),e=this.hasSlotController.test("help-text"),t=this.label?!0:!!i,n=this.helpText?!0:!!e;return ei`
      <div
        part="form-control"
        class=${Xi({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--has-label":t,"form-control--has-help-text":n})}
      >
        <label
          part="form-control-label"
          class="form-control__label"
          for="input"
          aria-hidden=${t?"false":"true"}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <div part="form-control-input" class="form-control-input">
          <div
            part="base"
            class=${Xi({textarea:!0,"textarea--small":this.size==="small","textarea--medium":this.size==="medium","textarea--large":this.size==="large","textarea--standard":!this.filled,"textarea--filled":this.filled,"textarea--disabled":this.disabled,"textarea--focused":this.hasFocus,"textarea--empty":!this.value,"textarea--resize-none":this.resize==="none","textarea--resize-vertical":this.resize==="vertical","textarea--resize-auto":this.resize==="auto"})}
          >
            <textarea
              part="textarea"
              id="input"
              class="textarea__control"
              title=${this.title}
              name=${Fi(this.name)}
              .value=${vf(this.value)}
              ?disabled=${this.disabled}
              ?readonly=${this.readonly}
              ?required=${this.required}
              placeholder=${Fi(this.placeholder)}
              rows=${Fi(this.rows)}
              minlength=${Fi(this.minlength)}
              maxlength=${Fi(this.maxlength)}
              autocapitalize=${Fi(this.autocapitalize)}
              autocorrect=${Fi(this.autocorrect)}
              ?autofocus=${this.autofocus}
              spellcheck=${Fi(this.spellcheck)}
              enterkeyhint=${Fi(this.enterkeyhint)}
              inputmode=${Fi(this.inputmode)}
              aria-describedby="help-text"
              @change=${this.handleChange}
              @input=${this.handleInput}
              @invalid=${this.handleInvalid}
              @focus=${this.handleFocus}
              @blur=${this.handleBlur}
            ></textarea>
            <!-- This "adjuster" exists to prevent layout shifting. https://github.com/shoelace-style/shoelace/issues/2180 -->
            <div part="textarea-adjuster" class="textarea__size-adjuster" ?hidden=${this.resize!=="auto"}></div>
          </div>
        </div>

        <div
          part="form-control-help-text"
          id="help-text"
          class="form-control__help-text"
          aria-hidden=${n?"false":"true"}
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};hr.styles=[qi,If,R8];J([yi(".textarea__control")],hr.prototype,"input",2);J([yi(".textarea__size-adjuster")],hr.prototype,"sizeAdjuster",2);J([Hi()],hr.prototype,"hasFocus",2);J([be()],hr.prototype,"title",2);J([be()],hr.prototype,"name",2);J([be()],hr.prototype,"value",2);J([be({reflect:!0})],hr.prototype,"size",2);J([be({type:Boolean,reflect:!0})],hr.prototype,"filled",2);J([be()],hr.prototype,"label",2);J([be({attribute:"help-text"})],hr.prototype,"helpText",2);J([be()],hr.prototype,"placeholder",2);J([be({type:Number})],hr.prototype,"rows",2);J([be()],hr.prototype,"resize",2);J([be({type:Boolean,reflect:!0})],hr.prototype,"disabled",2);J([be({type:Boolean,reflect:!0})],hr.prototype,"readonly",2);J([be({reflect:!0})],hr.prototype,"form",2);J([be({type:Boolean,reflect:!0})],hr.prototype,"required",2);J([be({type:Number})],hr.prototype,"minlength",2);J([be({type:Number})],hr.prototype,"maxlength",2);J([be()],hr.prototype,"autocapitalize",2);J([be()],hr.prototype,"autocorrect",2);J([be()],hr.prototype,"autocomplete",2);J([be({type:Boolean})],hr.prototype,"autofocus",2);J([be()],hr.prototype,"enterkeyhint",2);J([be({type:Boolean,converter:{fromAttribute:i=>!(!i||i==="false"),toAttribute:i=>i?"true":"false"}})],hr.prototype,"spellcheck",2);J([be()],hr.prototype,"inputmode",2);J([Hm()],hr.prototype,"defaultValue",2);J([hi("disabled",{waitUntilFirstUpdate:!0})],hr.prototype,"handleDisabledChange",1);J([hi("rows",{waitUntilFirstUpdate:!0})],hr.prototype,"handleRowsChange",1);J([hi("value",{waitUntilFirstUpdate:!0})],hr.prototype,"handleValueChange",1);hr.define("sl-textarea");var k8=ji`
  :host {
    display: inline-block;
  }

  .tab {
    display: inline-flex;
    align-items: center;
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-small);
    font-weight: var(--sl-font-weight-semibold);
    border-radius: var(--sl-border-radius-medium);
    color: var(--sl-color-neutral-600);
    padding: var(--sl-spacing-medium) var(--sl-spacing-large);
    white-space: nowrap;
    user-select: none;
    -webkit-user-select: none;
    cursor: pointer;
    transition:
      var(--transition-speed) box-shadow,
      var(--transition-speed) color;
  }

  .tab:hover:not(.tab--disabled) {
    color: var(--sl-color-primary-600);
  }

  :host(:focus) {
    outline: transparent;
  }

  :host(:focus-visible) {
    color: var(--sl-color-primary-600);
    outline: var(--sl-focus-ring);
    outline-offset: calc(-1 * var(--sl-focus-ring-width) - var(--sl-focus-ring-offset));
  }

  .tab.tab--active:not(.tab--disabled) {
    color: var(--sl-color-primary-600);
  }

  .tab.tab--closable {
    padding-inline-end: var(--sl-spacing-small);
  }

  .tab.tab--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .tab__close-button {
    font-size: var(--sl-font-size-small);
    margin-inline-start: var(--sl-spacing-small);
  }

  .tab__close-button::part(base) {
    padding: var(--sl-spacing-3x-small);
  }

  @media (forced-colors: active) {
    .tab.tab--active:not(.tab--disabled) {
      outline: solid 1px transparent;
      outline-offset: -3px;
    }
  }
`,P8=0,$l=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.attrId=++P8,this.componentId=`sl-tab-${this.attrId}`,this.panel="",this.active=!1,this.closable=!1,this.disabled=!1,this.tabIndex=0}connectedCallback(){super.connectedCallback(),this.setAttribute("role","tab")}handleCloseClick(i){i.stopPropagation(),this.emit("sl-close")}handleActiveChange(){this.setAttribute("aria-selected",this.active?"true":"false")}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false"),this.disabled&&!this.active?this.tabIndex=-1:this.tabIndex=0}render(){return this.id=this.id.length>0?this.id:this.componentId,ei`
      <div
        part="base"
        class=${Xi({tab:!0,"tab--active":this.active,"tab--closable":this.closable,"tab--disabled":this.disabled})}
      >
        <slot></slot>
        ${this.closable?ei`
              <sl-icon-button
                part="close-button"
                exportparts="base:close-button__base"
                name="x-lg"
                library="system"
                label=${this.localize.term("close")}
                class="tab__close-button"
                @click=${this.handleCloseClick}
                tabindex="-1"
              ></sl-icon-button>
            `:""}
      </div>
    `}};$l.styles=[qi,k8];$l.dependencies={"sl-icon-button":zs};J([yi(".tab")],$l.prototype,"tab",2);J([be({reflect:!0})],$l.prototype,"panel",2);J([be({type:Boolean,reflect:!0})],$l.prototype,"active",2);J([be({type:Boolean,reflect:!0})],$l.prototype,"closable",2);J([be({type:Boolean,reflect:!0})],$l.prototype,"disabled",2);J([be({type:Number,reflect:!0})],$l.prototype,"tabIndex",2);J([hi("active")],$l.prototype,"handleActiveChange",1);J([hi("disabled")],$l.prototype,"handleDisabledChange",1);$l.define("sl-tab");var D8=ji`
  :host {
    --indicator-color: var(--sl-color-primary-600);
    --track-color: var(--sl-color-neutral-200);
    --track-width: 2px;

    display: block;
  }

  .tab-group {
    display: flex;
    border-radius: 0;
  }

  .tab-group__tabs {
    display: flex;
    position: relative;
  }

  .tab-group__indicator {
    position: absolute;
    transition:
      var(--sl-transition-fast) translate ease,
      var(--sl-transition-fast) width ease;
  }

  .tab-group--has-scroll-controls .tab-group__nav-container {
    position: relative;
    padding: 0 var(--sl-spacing-x-large);
  }

  .tab-group--has-scroll-controls .tab-group__scroll-button--start--hidden,
  .tab-group--has-scroll-controls .tab-group__scroll-button--end--hidden {
    visibility: hidden;
  }

  .tab-group__body {
    display: block;
    overflow: auto;
  }

  .tab-group__scroll-button {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    bottom: 0;
    width: var(--sl-spacing-x-large);
  }

  .tab-group__scroll-button--start {
    left: 0;
  }

  .tab-group__scroll-button--end {
    right: 0;
  }

  .tab-group--rtl .tab-group__scroll-button--start {
    left: auto;
    right: 0;
  }

  .tab-group--rtl .tab-group__scroll-button--end {
    left: 0;
    right: auto;
  }

  /*
   * Top
   */

  .tab-group--top {
    flex-direction: column;
  }

  .tab-group--top .tab-group__nav-container {
    order: 1;
  }

  .tab-group--top .tab-group__nav {
    display: flex;
    overflow-x: auto;

    /* Hide scrollbar in Firefox */
    scrollbar-width: none;
  }

  /* Hide scrollbar in Chrome/Safari */
  .tab-group--top .tab-group__nav::-webkit-scrollbar {
    width: 0;
    height: 0;
  }

  .tab-group--top .tab-group__tabs {
    flex: 1 1 auto;
    position: relative;
    flex-direction: row;
    border-bottom: solid var(--track-width) var(--track-color);
  }

  .tab-group--top .tab-group__indicator {
    bottom: calc(-1 * var(--track-width));
    border-bottom: solid var(--track-width) var(--indicator-color);
  }

  .tab-group--top .tab-group__body {
    order: 2;
  }

  .tab-group--top ::slotted(sl-tab-panel) {
    --padding: var(--sl-spacing-medium) 0;
  }

  /*
   * Bottom
   */

  .tab-group--bottom {
    flex-direction: column;
  }

  .tab-group--bottom .tab-group__nav-container {
    order: 2;
  }

  .tab-group--bottom .tab-group__nav {
    display: flex;
    overflow-x: auto;

    /* Hide scrollbar in Firefox */
    scrollbar-width: none;
  }

  /* Hide scrollbar in Chrome/Safari */
  .tab-group--bottom .tab-group__nav::-webkit-scrollbar {
    width: 0;
    height: 0;
  }

  .tab-group--bottom .tab-group__tabs {
    flex: 1 1 auto;
    position: relative;
    flex-direction: row;
    border-top: solid var(--track-width) var(--track-color);
  }

  .tab-group--bottom .tab-group__indicator {
    top: calc(-1 * var(--track-width));
    border-top: solid var(--track-width) var(--indicator-color);
  }

  .tab-group--bottom .tab-group__body {
    order: 1;
  }

  .tab-group--bottom ::slotted(sl-tab-panel) {
    --padding: var(--sl-spacing-medium) 0;
  }

  /*
   * Start
   */

  .tab-group--start {
    flex-direction: row;
  }

  .tab-group--start .tab-group__nav-container {
    order: 1;
  }

  .tab-group--start .tab-group__tabs {
    flex: 0 0 auto;
    flex-direction: column;
    border-inline-end: solid var(--track-width) var(--track-color);
  }

  .tab-group--start .tab-group__indicator {
    right: calc(-1 * var(--track-width));
    border-right: solid var(--track-width) var(--indicator-color);
  }

  .tab-group--start.tab-group--rtl .tab-group__indicator {
    right: auto;
    left: calc(-1 * var(--track-width));
  }

  .tab-group--start .tab-group__body {
    flex: 1 1 auto;
    order: 2;
  }

  .tab-group--start ::slotted(sl-tab-panel) {
    --padding: 0 var(--sl-spacing-medium);
  }

  /*
   * End
   */

  .tab-group--end {
    flex-direction: row;
  }

  .tab-group--end .tab-group__nav-container {
    order: 2;
  }

  .tab-group--end .tab-group__tabs {
    flex: 0 0 auto;
    flex-direction: column;
    border-left: solid var(--track-width) var(--track-color);
  }

  .tab-group--end .tab-group__indicator {
    left: calc(-1 * var(--track-width));
    border-inline-start: solid var(--track-width) var(--indicator-color);
  }

  .tab-group--end.tab-group--rtl .tab-group__indicator {
    right: calc(-1 * var(--track-width));
    left: auto;
  }

  .tab-group--end .tab-group__body {
    flex: 1 1 auto;
    order: 1;
  }

  .tab-group--end ::slotted(sl-tab-panel) {
    --padding: 0 var(--sl-spacing-medium);
  }
`,B8=ji`
  :host {
    display: contents;
  }
`,x0=class extends Li{constructor(){super(...arguments),this.observedElements=[],this.disabled=!1}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(i=>{this.emit("sl-resize",{detail:{entries:i}})}),this.disabled||this.startObserver()}disconnectedCallback(){super.disconnectedCallback(),this.stopObserver()}handleSlotChange(){this.disabled||this.startObserver()}startObserver(){const i=this.shadowRoot.querySelector("slot");if(i!==null){const e=i.assignedElements({flatten:!0});this.observedElements.forEach(t=>this.resizeObserver.unobserve(t)),this.observedElements=[],e.forEach(t=>{this.resizeObserver.observe(t),this.observedElements.push(t)})}}stopObserver(){this.resizeObserver.disconnect()}handleDisabledChange(){this.disabled?this.stopObserver():this.startObserver()}render(){return ei` <slot @slotchange=${this.handleSlotChange}></slot> `}};x0.styles=[qi,B8];J([be({type:Boolean,reflect:!0})],x0.prototype,"disabled",2);J([hi("disabled",{waitUntilFirstUpdate:!0})],x0.prototype,"handleDisabledChange",1);function O8(i,e){return{top:Math.round(i.getBoundingClientRect().top-e.getBoundingClientRect().top),left:Math.round(i.getBoundingClientRect().left-e.getBoundingClientRect().left)}}var cS=new Set;function F8(){const i=document.documentElement.clientWidth;return Math.abs(window.innerWidth-i)}function L8(){const i=Number(getComputedStyle(document.body).paddingRight.replace(/px/,""));return isNaN(i)||!i?0:i}function Ty(i){if(cS.add(i),!document.documentElement.classList.contains("sl-scroll-lock")){const e=F8()+L8();let t=getComputedStyle(document.documentElement).scrollbarGutter;(!t||t==="auto")&&(t="stable"),e<2&&(t=""),document.documentElement.style.setProperty("--sl-scroll-lock-gutter",t),document.documentElement.classList.add("sl-scroll-lock"),document.documentElement.style.setProperty("--sl-scroll-lock-size",`${e}px`)}}function Sy(i){cS.delete(i),cS.size===0&&(document.documentElement.classList.remove("sl-scroll-lock"),document.documentElement.style.removeProperty("--sl-scroll-lock-size"))}function hS(i,e,t="vertical",n="smooth"){const s=O8(i,e),c=s.top+e.scrollTop,f=s.left+e.scrollLeft,r=e.scrollLeft,b=e.scrollLeft+e.offsetWidth,w=e.scrollTop,E=e.scrollTop+e.offsetHeight;(t==="horizontal"||t==="both")&&(f<r?e.scrollTo({left:f,behavior:n}):f+i.clientWidth>b&&e.scrollTo({left:f-e.offsetWidth+i.clientWidth,behavior:n})),(t==="vertical"||t==="both")&&(c<w?e.scrollTo({top:c,behavior:n}):c+i.clientHeight>E&&e.scrollTo({top:c-e.offsetHeight+i.clientHeight,behavior:n}))}var uo=class extends Li{constructor(){super(...arguments),this.tabs=[],this.focusableTabs=[],this.panels=[],this.localize=new cr(this),this.hasScrollControls=!1,this.shouldHideScrollStartButton=!1,this.shouldHideScrollEndButton=!1,this.placement="top",this.activation="auto",this.noScrollControls=!1,this.fixedScrollControls=!1,this.scrollOffset=1}connectedCallback(){const i=Promise.all([customElements.whenDefined("sl-tab"),customElements.whenDefined("sl-tab-panel")]);super.connectedCallback(),this.resizeObserver=new ResizeObserver(()=>{this.repositionIndicator(),this.updateScrollControls()}),this.mutationObserver=new MutationObserver(e=>{const t=e.filter(({target:n})=>{if(n===this)return!0;if(n.closest("sl-tab-group")!==this)return!1;const s=n.tagName.toLowerCase();return s==="sl-tab"||s==="sl-tab-panel"});if(t.length!==0){if(t.some(n=>!["aria-labelledby","aria-controls"].includes(n.attributeName))&&setTimeout(()=>this.setAriaLabels()),t.some(n=>n.attributeName==="disabled"))this.syncTabsAndPanels();else if(t.some(n=>n.attributeName==="active")){const s=t.filter(c=>c.attributeName==="active"&&c.target.tagName.toLowerCase()==="sl-tab").map(c=>c.target).find(c=>c.active);s&&this.setActiveTab(s)}}}),this.updateComplete.then(()=>{this.syncTabsAndPanels(),this.mutationObserver.observe(this,{attributes:!0,attributeFilter:["active","disabled","name","panel"],childList:!0,subtree:!0}),this.resizeObserver.observe(this.nav),i.then(()=>{new IntersectionObserver((t,n)=>{var s;t[0].intersectionRatio>0&&(this.setAriaLabels(),this.setActiveTab((s=this.getActiveTab())!=null?s:this.tabs[0],{emitEvents:!1}),n.unobserve(t[0].target))}).observe(this.tabGroup)})})}disconnectedCallback(){var i,e;super.disconnectedCallback(),(i=this.mutationObserver)==null||i.disconnect(),this.nav&&((e=this.resizeObserver)==null||e.unobserve(this.nav))}getAllTabs(){return this.shadowRoot.querySelector('slot[name="nav"]').assignedElements()}getAllPanels(){return[...this.body.assignedElements()].filter(i=>i.tagName.toLowerCase()==="sl-tab-panel")}getActiveTab(){return this.tabs.find(i=>i.active)}handleClick(i){const t=i.target.closest("sl-tab");(t==null?void 0:t.closest("sl-tab-group"))===this&&t!==null&&this.setActiveTab(t,{scrollBehavior:"smooth"})}handleKeyDown(i){const t=i.target.closest("sl-tab");if((t==null?void 0:t.closest("sl-tab-group"))===this&&(["Enter"," "].includes(i.key)&&t!==null&&(this.setActiveTab(t,{scrollBehavior:"smooth"}),i.preventDefault()),["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(i.key))){const s=this.tabs.find(r=>r.matches(":focus")),c=this.localize.dir()==="rtl";let f=null;if((s==null?void 0:s.tagName.toLowerCase())==="sl-tab"){if(i.key==="Home")f=this.focusableTabs[0];else if(i.key==="End")f=this.focusableTabs[this.focusableTabs.length-1];else if(["top","bottom"].includes(this.placement)&&i.key===(c?"ArrowRight":"ArrowLeft")||["start","end"].includes(this.placement)&&i.key==="ArrowUp"){const r=this.tabs.findIndex(b=>b===s);f=this.findNextFocusableTab(r,"backward")}else if(["top","bottom"].includes(this.placement)&&i.key===(c?"ArrowLeft":"ArrowRight")||["start","end"].includes(this.placement)&&i.key==="ArrowDown"){const r=this.tabs.findIndex(b=>b===s);f=this.findNextFocusableTab(r,"forward")}if(!f)return;f.tabIndex=0,f.focus({preventScroll:!0}),this.activation==="auto"?this.setActiveTab(f,{scrollBehavior:"smooth"}):this.tabs.forEach(r=>{r.tabIndex=r===f?0:-1}),["top","bottom"].includes(this.placement)&&hS(f,this.nav,"horizontal"),i.preventDefault()}}}handleScrollToStart(){this.nav.scroll({left:this.localize.dir()==="rtl"?this.nav.scrollLeft+this.nav.clientWidth:this.nav.scrollLeft-this.nav.clientWidth,behavior:"smooth"})}handleScrollToEnd(){this.nav.scroll({left:this.localize.dir()==="rtl"?this.nav.scrollLeft-this.nav.clientWidth:this.nav.scrollLeft+this.nav.clientWidth,behavior:"smooth"})}setActiveTab(i,e){if(e=Eh({emitEvents:!0,scrollBehavior:"auto"},e),i!==this.activeTab&&!i.disabled){const t=this.activeTab;this.activeTab=i,this.tabs.forEach(n=>{n.active=n===this.activeTab,n.tabIndex=n===this.activeTab?0:-1}),this.panels.forEach(n=>{var s;return n.active=n.name===((s=this.activeTab)==null?void 0:s.panel)}),this.syncIndicator(),["top","bottom"].includes(this.placement)&&hS(this.activeTab,this.nav,"horizontal",e.scrollBehavior),e.emitEvents&&(t&&this.emit("sl-tab-hide",{detail:{name:t.panel}}),this.emit("sl-tab-show",{detail:{name:this.activeTab.panel}}))}}setAriaLabels(){this.tabs.forEach(i=>{const e=this.panels.find(t=>t.name===i.panel);e&&(i.setAttribute("aria-controls",e.getAttribute("id")),e.setAttribute("aria-labelledby",i.getAttribute("id")))})}repositionIndicator(){const i=this.getActiveTab();if(!i)return;const e=i.clientWidth,t=i.clientHeight,n=this.localize.dir()==="rtl",s=this.getAllTabs(),f=s.slice(0,s.indexOf(i)).reduce((r,b)=>({left:r.left+b.clientWidth,top:r.top+b.clientHeight}),{left:0,top:0});switch(this.placement){case"top":case"bottom":this.indicator.style.width=`${e}px`,this.indicator.style.height="auto",this.indicator.style.translate=n?`${-1*f.left}px`:`${f.left}px`;break;case"start":case"end":this.indicator.style.width="auto",this.indicator.style.height=`${t}px`,this.indicator.style.translate=`0 ${f.top}px`;break}}syncTabsAndPanels(){this.tabs=this.getAllTabs(),this.focusableTabs=this.tabs.filter(i=>!i.disabled),this.panels=this.getAllPanels(),this.syncIndicator(),this.updateComplete.then(()=>this.updateScrollControls())}findNextFocusableTab(i,e){let t=null;const n=e==="forward"?1:-1;let s=i+n;for(;i<this.tabs.length;){if(t=this.tabs[s]||null,t===null){e==="forward"?t=this.focusableTabs[0]:t=this.focusableTabs[this.focusableTabs.length-1];break}if(!t.disabled)break;s+=n}return t}updateScrollButtons(){this.hasScrollControls&&!this.fixedScrollControls&&(this.shouldHideScrollStartButton=this.scrollFromStart()<=this.scrollOffset,this.shouldHideScrollEndButton=this.isScrolledToEnd())}isScrolledToEnd(){return this.scrollFromStart()+this.nav.clientWidth>=this.nav.scrollWidth-this.scrollOffset}scrollFromStart(){return this.localize.dir()==="rtl"?-this.nav.scrollLeft:this.nav.scrollLeft}updateScrollControls(){this.noScrollControls?this.hasScrollControls=!1:this.hasScrollControls=["top","bottom"].includes(this.placement)&&this.nav.scrollWidth>this.nav.clientWidth+1,this.updateScrollButtons()}syncIndicator(){this.getActiveTab()?(this.indicator.style.display="block",this.repositionIndicator()):this.indicator.style.display="none"}show(i){const e=this.tabs.find(t=>t.panel===i);e&&this.setActiveTab(e,{scrollBehavior:"smooth"})}render(){const i=this.localize.dir()==="rtl";return ei`
      <div
        part="base"
        class=${Xi({"tab-group":!0,"tab-group--top":this.placement==="top","tab-group--bottom":this.placement==="bottom","tab-group--start":this.placement==="start","tab-group--end":this.placement==="end","tab-group--rtl":this.localize.dir()==="rtl","tab-group--has-scroll-controls":this.hasScrollControls})}
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
      >
        <div class="tab-group__nav-container" part="nav">
          ${this.hasScrollControls?ei`
                <sl-icon-button
                  part="scroll-button scroll-button--start"
                  exportparts="base:scroll-button__base"
                  class=${Xi({"tab-group__scroll-button":!0,"tab-group__scroll-button--start":!0,"tab-group__scroll-button--start--hidden":this.shouldHideScrollStartButton})}
                  name=${i?"chevron-right":"chevron-left"}
                  library="system"
                  tabindex="-1"
                  aria-hidden="true"
                  label=${this.localize.term("scrollToStart")}
                  @click=${this.handleScrollToStart}
                ></sl-icon-button>
              `:""}

          <div class="tab-group__nav" @scrollend=${this.updateScrollButtons}>
            <div part="tabs" class="tab-group__tabs" role="tablist">
              <div part="active-tab-indicator" class="tab-group__indicator"></div>
              <sl-resize-observer @sl-resize=${this.syncIndicator}>
                <slot name="nav" @slotchange=${this.syncTabsAndPanels}></slot>
              </sl-resize-observer>
            </div>
          </div>

          ${this.hasScrollControls?ei`
                <sl-icon-button
                  part="scroll-button scroll-button--end"
                  exportparts="base:scroll-button__base"
                  class=${Xi({"tab-group__scroll-button":!0,"tab-group__scroll-button--end":!0,"tab-group__scroll-button--end--hidden":this.shouldHideScrollEndButton})}
                  name=${i?"chevron-left":"chevron-right"}
                  library="system"
                  tabindex="-1"
                  aria-hidden="true"
                  label=${this.localize.term("scrollToEnd")}
                  @click=${this.handleScrollToEnd}
                ></sl-icon-button>
              `:""}
        </div>

        <slot part="body" class="tab-group__body" @slotchange=${this.syncTabsAndPanels}></slot>
      </div>
    `}};uo.styles=[qi,D8];uo.dependencies={"sl-icon-button":zs,"sl-resize-observer":x0};J([yi(".tab-group")],uo.prototype,"tabGroup",2);J([yi(".tab-group__body")],uo.prototype,"body",2);J([yi(".tab-group__nav")],uo.prototype,"nav",2);J([yi(".tab-group__indicator")],uo.prototype,"indicator",2);J([Hi()],uo.prototype,"hasScrollControls",2);J([Hi()],uo.prototype,"shouldHideScrollStartButton",2);J([Hi()],uo.prototype,"shouldHideScrollEndButton",2);J([be()],uo.prototype,"placement",2);J([be()],uo.prototype,"activation",2);J([be({attribute:"no-scroll-controls",type:Boolean})],uo.prototype,"noScrollControls",2);J([be({attribute:"fixed-scroll-controls",type:Boolean})],uo.prototype,"fixedScrollControls",2);J([m0({passive:!0})],uo.prototype,"updateScrollButtons",1);J([hi("noScrollControls",{waitUntilFirstUpdate:!0})],uo.prototype,"updateScrollControls",1);J([hi("placement",{waitUntilFirstUpdate:!0})],uo.prototype,"syncIndicator",1);uo.define("sl-tab-group");var z8=ji`
  :host {
    --border-radius: var(--sl-border-radius-pill);
    --color: var(--sl-color-neutral-200);
    --sheen-color: var(--sl-color-neutral-300);

    display: block;
    position: relative;
  }

  .skeleton {
    display: flex;
    width: 100%;
    height: 100%;
    min-height: 1rem;
  }

  .skeleton__indicator {
    flex: 1 1 auto;
    background: var(--color);
    border-radius: var(--border-radius);
  }

  .skeleton--sheen .skeleton__indicator {
    background: linear-gradient(270deg, var(--sheen-color), var(--color), var(--color), var(--sheen-color));
    background-size: 400% 100%;
    animation: sheen 8s ease-in-out infinite;
  }

  .skeleton--pulse .skeleton__indicator {
    animation: pulse 2s ease-in-out 0.5s infinite;
  }

  /* Forced colors mode */
  @media (forced-colors: active) {
    :host {
      --color: GrayText;
    }
  }

  @keyframes sheen {
    0% {
      background-position: 200% 0;
    }
    to {
      background-position: -200% 0;
    }
  }

  @keyframes pulse {
    0% {
      opacity: 1;
    }
    50% {
      opacity: 0.4;
    }
    100% {
      opacity: 1;
    }
  }
`,VE=class extends Li{constructor(){super(...arguments),this.effect="none"}render(){return ei`
      <div
        part="base"
        class=${Xi({skeleton:!0,"skeleton--pulse":this.effect==="pulse","skeleton--sheen":this.effect==="sheen"})}
      >
        <div part="indicator" class="skeleton__indicator"></div>
      </div>
    `}};VE.styles=[qi,z8];J([be()],VE.prototype,"effect",2);VE.define("sl-skeleton");var N8=ji`
  :host {
    --divider-width: 4px;
    --divider-hit-area: 12px;
    --min: 0%;
    --max: 100%;

    display: grid;
  }

  .start,
  .end {
    overflow: hidden;
  }

  .divider {
    flex: 0 0 var(--divider-width);
    display: flex;
    position: relative;
    align-items: center;
    justify-content: center;
    background-color: var(--sl-color-neutral-200);
    color: var(--sl-color-neutral-900);
    z-index: 1;
  }

  .divider:focus {
    outline: none;
  }

  :host(:not([disabled])) .divider:focus-visible {
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  :host([disabled]) .divider {
    cursor: not-allowed;
  }

  /* Horizontal */
  :host(:not([vertical], [disabled])) .divider {
    cursor: col-resize;
  }

  :host(:not([vertical])) .divider::after {
    display: flex;
    content: '';
    position: absolute;
    height: 100%;
    left: calc(var(--divider-hit-area) / -2 + var(--divider-width) / 2);
    width: var(--divider-hit-area);
  }

  /* Vertical */
  :host([vertical]) {
    flex-direction: column;
  }

  :host([vertical]:not([disabled])) .divider {
    cursor: row-resize;
  }

  :host([vertical]) .divider::after {
    content: '';
    position: absolute;
    width: 100%;
    top: calc(var(--divider-hit-area) / -2 + var(--divider-width) / 2);
    height: var(--divider-hit-area);
  }

  @media (forced-colors: active) {
    .divider {
      outline: solid 1px transparent;
    }
  }
`;function Ey(i,e){function t(s){const c=i.getBoundingClientRect(),f=i.ownerDocument.defaultView,r=c.left+f.scrollX,b=c.top+f.scrollY,w=s.pageX-r,E=s.pageY-b;e!=null&&e.onMove&&e.onMove(w,E)}function n(){document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",n),e!=null&&e.onStop&&e.onStop()}document.addEventListener("pointermove",t,{passive:!0}),document.addEventListener("pointerup",n),(e==null?void 0:e.initialEvent)instanceof PointerEvent&&t(e.initialEvent)}var yk=()=>null,La=class extends Li{constructor(){super(...arguments),this.isCollapsed=!1,this.localize=new cr(this),this.positionBeforeCollapsing=0,this.position=50,this.vertical=!1,this.disabled=!1,this.snapValue="",this.snapFunction=yk,this.snapThreshold=12}toSnapFunction(i){const e=i.split(" ");return({pos:t,size:n,snapThreshold:s,isRtl:c,vertical:f})=>{let r=t,b=Number.POSITIVE_INFINITY;return e.forEach(w=>{let E;if(w.startsWith("repeat(")){const F=i.substring(7,i.length-1),$=F.endsWith("%"),X=Number.parseFloat(F),W=$?n*(X/100):X;E=Math.round((c&&!f?n-t:t)/W)*W}else w.endsWith("%")?E=n*(Number.parseFloat(w)/100):E=Number.parseFloat(w);c&&!f&&(E=n-E);const k=Math.abs(t-E);k<=s&&k<b&&(r=E,b=k)}),r}}set snap(i){this.snapValue=i??"",i?this.snapFunction=typeof i=="string"?this.toSnapFunction(i):i:this.snapFunction=yk}get snap(){return this.snapValue}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(i=>this.handleResize(i)),this.updateComplete.then(()=>this.resizeObserver.observe(this)),this.detectSize(),this.cachedPositionInPixels=this.percentageToPixels(this.position)}disconnectedCallback(){var i;super.disconnectedCallback(),(i=this.resizeObserver)==null||i.unobserve(this)}detectSize(){const{width:i,height:e}=this.getBoundingClientRect();this.size=this.vertical?e:i}percentageToPixels(i){return this.size*(i/100)}pixelsToPercentage(i){return i/this.size*100}handleDrag(i){const e=this.localize.dir()==="rtl";this.disabled||(i.cancelable&&i.preventDefault(),Ey(this,{onMove:(t,n)=>{var s;let c=this.vertical?n:t;this.primary==="end"&&(c=this.size-c),c=(s=this.snapFunction({pos:c,size:this.size,snapThreshold:this.snapThreshold,isRtl:e,vertical:this.vertical}))!=null?s:c,this.position=ws(this.pixelsToPercentage(c),0,100)},initialEvent:i}))}handleKeyDown(i){if(!this.disabled&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Enter"].includes(i.key)){let e=this.position;const t=(i.shiftKey?10:1)*(this.primary==="end"?-1:1);if(i.preventDefault(),(i.key==="ArrowLeft"&&!this.vertical||i.key==="ArrowUp"&&this.vertical)&&(e-=t),(i.key==="ArrowRight"&&!this.vertical||i.key==="ArrowDown"&&this.vertical)&&(e+=t),i.key==="Home"&&(e=this.primary==="end"?100:0),i.key==="End"&&(e=this.primary==="end"?0:100),i.key==="Enter")if(this.isCollapsed)e=this.positionBeforeCollapsing,this.isCollapsed=!1;else{const n=this.position;e=0,requestAnimationFrame(()=>{this.isCollapsed=!0,this.positionBeforeCollapsing=n})}this.position=ws(e,0,100)}}handleResize(i){const{width:e,height:t}=i[0].contentRect;this.size=this.vertical?t:e,(isNaN(this.cachedPositionInPixels)||this.position===1/0)&&(this.cachedPositionInPixels=Number(this.getAttribute("position-in-pixels")),this.positionInPixels=Number(this.getAttribute("position-in-pixels")),this.position=this.pixelsToPercentage(this.positionInPixels)),this.primary&&(this.position=this.pixelsToPercentage(this.cachedPositionInPixels))}handlePositionChange(){this.cachedPositionInPixels=this.percentageToPixels(this.position),this.isCollapsed=!1,this.positionBeforeCollapsing=0,this.positionInPixels=this.percentageToPixels(this.position),this.emit("sl-reposition")}handlePositionInPixelsChange(){this.position=this.pixelsToPercentage(this.positionInPixels)}handleVerticalChange(){this.detectSize()}render(){const i=this.vertical?"gridTemplateRows":"gridTemplateColumns",e=this.vertical?"gridTemplateColumns":"gridTemplateRows",t=this.localize.dir()==="rtl",n=`
      clamp(
        0%,
        clamp(
          var(--min),
          ${this.position}% - var(--divider-width) / 2,
          var(--max)
        ),
        calc(100% - var(--divider-width))
      )
    `,s="auto";return this.primary==="end"?t&&!this.vertical?this.style[i]=`${n} var(--divider-width) ${s}`:this.style[i]=`${s} var(--divider-width) ${n}`:t&&!this.vertical?this.style[i]=`${s} var(--divider-width) ${n}`:this.style[i]=`${n} var(--divider-width) ${s}`,this.style[e]="",ei`
      <slot name="start" part="panel start" class="start"></slot>

      <div
        part="divider"
        class="divider"
        tabindex=${Fi(this.disabled?void 0:"0")}
        role="separator"
        aria-valuenow=${this.position}
        aria-valuemin="0"
        aria-valuemax="100"
        aria-label=${this.localize.term("resize")}
        @keydown=${this.handleKeyDown}
        @mousedown=${this.handleDrag}
        @touchstart=${this.handleDrag}
      >
        <slot name="divider"></slot>
      </div>

      <slot name="end" part="panel end" class="end"></slot>
    `}};La.styles=[qi,N8];J([yi(".divider")],La.prototype,"divider",2);J([be({type:Number,reflect:!0})],La.prototype,"position",2);J([be({attribute:"position-in-pixels",type:Number})],La.prototype,"positionInPixels",2);J([be({type:Boolean,reflect:!0})],La.prototype,"vertical",2);J([be({type:Boolean,reflect:!0})],La.prototype,"disabled",2);J([be()],La.prototype,"primary",2);J([be({reflect:!0})],La.prototype,"snap",1);J([be({type:Number,attribute:"snap-threshold"})],La.prototype,"snapThreshold",2);J([hi("position")],La.prototype,"handlePositionChange",1);J([hi("positionInPixels")],La.prototype,"handlePositionInPixelsChange",1);J([hi("vertical")],La.prototype,"handleVerticalChange",1);La.define("sl-split-panel");var U8=ji`
  :host {
    display: inline-block;
  }

  :host([size='small']) {
    --height: var(--sl-toggle-size-small);
    --thumb-size: calc(var(--sl-toggle-size-small) + 4px);
    --width: calc(var(--height) * 2);

    font-size: var(--sl-input-font-size-small);
  }

  :host([size='medium']) {
    --height: var(--sl-toggle-size-medium);
    --thumb-size: calc(var(--sl-toggle-size-medium) + 4px);
    --width: calc(var(--height) * 2);

    font-size: var(--sl-input-font-size-medium);
  }

  :host([size='large']) {
    --height: var(--sl-toggle-size-large);
    --thumb-size: calc(var(--sl-toggle-size-large) + 4px);
    --width: calc(var(--height) * 2);

    font-size: var(--sl-input-font-size-large);
  }

  .switch {
    position: relative;
    display: inline-flex;
    align-items: center;
    font-family: var(--sl-input-font-family);
    font-size: inherit;
    font-weight: var(--sl-input-font-weight);
    color: var(--sl-input-label-color);
    vertical-align: middle;
    cursor: pointer;
  }

  .switch__control {
    flex: 0 0 auto;
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--width);
    height: var(--height);
    background-color: var(--sl-color-neutral-400);
    border: solid var(--sl-input-border-width) var(--sl-color-neutral-400);
    border-radius: var(--height);
    transition:
      var(--sl-transition-fast) border-color,
      var(--sl-transition-fast) background-color;
  }

  .switch__control .switch__thumb {
    width: var(--thumb-size);
    height: var(--thumb-size);
    background-color: var(--sl-color-neutral-0);
    border-radius: 50%;
    border: solid var(--sl-input-border-width) var(--sl-color-neutral-400);
    translate: calc((var(--width) - var(--height)) / -2);
    transition:
      var(--sl-transition-fast) translate ease,
      var(--sl-transition-fast) background-color,
      var(--sl-transition-fast) border-color,
      var(--sl-transition-fast) box-shadow;
  }

  .switch__input {
    position: absolute;
    opacity: 0;
    padding: 0;
    margin: 0;
    pointer-events: none;
  }

  /* Hover */
  .switch:not(.switch--checked):not(.switch--disabled) .switch__control:hover {
    background-color: var(--sl-color-neutral-400);
    border-color: var(--sl-color-neutral-400);
  }

  .switch:not(.switch--checked):not(.switch--disabled) .switch__control:hover .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-neutral-400);
  }

  /* Focus */
  .switch:not(.switch--checked):not(.switch--disabled) .switch__input:focus-visible ~ .switch__control {
    background-color: var(--sl-color-neutral-400);
    border-color: var(--sl-color-neutral-400);
  }

  .switch:not(.switch--checked):not(.switch--disabled) .switch__input:focus-visible ~ .switch__control .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-primary-600);
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  /* Checked */
  .switch--checked .switch__control {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
  }

  .switch--checked .switch__control .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-primary-600);
    translate: calc((var(--width) - var(--height)) / 2);
  }

  /* Checked + hover */
  .switch.switch--checked:not(.switch--disabled) .switch__control:hover {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
  }

  .switch.switch--checked:not(.switch--disabled) .switch__control:hover .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-primary-600);
  }

  /* Checked + focus */
  .switch.switch--checked:not(.switch--disabled) .switch__input:focus-visible ~ .switch__control {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
  }

  .switch.switch--checked:not(.switch--disabled) .switch__input:focus-visible ~ .switch__control .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-primary-600);
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  /* Disabled */
  .switch--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .switch__label {
    display: inline-block;
    line-height: var(--height);
    margin-inline-start: 0.5em;
    user-select: none;
    -webkit-user-select: none;
  }

  :host([required]) .switch__label::after {
    content: var(--sl-input-required-content);
    color: var(--sl-input-required-content-color);
    margin-inline-start: var(--sl-input-required-content-offset);
  }

  @media (forced-colors: active) {
    .switch.switch--checked:not(.switch--disabled) .switch__control:hover .switch__thumb,
    .switch--checked .switch__control .switch__thumb {
      background-color: ButtonText;
    }
  }
`,Mo=class extends Li{constructor(){super(...arguments),this.formControlController=new Ch(this,{value:i=>i.checked?i.value||"on":void 0,defaultValue:i=>i.defaultChecked,setValue:(i,e)=>i.checked=e}),this.hasSlotController=new Uo(this,"help-text"),this.hasFocus=!1,this.title="",this.name="",this.size="medium",this.disabled=!1,this.checked=!1,this.defaultChecked=!1,this.form="",this.required=!1,this.helpText=""}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}firstUpdated(){this.formControlController.updateValidity()}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleInput(){this.emit("sl-input")}handleInvalid(i){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(i)}handleClick(){this.checked=!this.checked,this.emit("sl-change")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleKeyDown(i){i.key==="ArrowLeft"&&(i.preventDefault(),this.checked=!1,this.emit("sl-change"),this.emit("sl-input")),i.key==="ArrowRight"&&(i.preventDefault(),this.checked=!0,this.emit("sl-change"),this.emit("sl-input"))}handleCheckedChange(){this.input.checked=this.checked,this.formControlController.updateValidity()}handleDisabledChange(){this.formControlController.setValidity(!0)}click(){this.input.click()}focus(i){this.input.focus(i)}blur(){this.input.blur()}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.input.reportValidity()}setCustomValidity(i){this.input.setCustomValidity(i),this.formControlController.updateValidity()}render(){const i=this.hasSlotController.test("help-text"),e=this.helpText?!0:!!i;return ei`
      <div
        class=${Xi({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--has-help-text":e})}
      >
        <label
          part="base"
          class=${Xi({switch:!0,"switch--checked":this.checked,"switch--disabled":this.disabled,"switch--focused":this.hasFocus,"switch--small":this.size==="small","switch--medium":this.size==="medium","switch--large":this.size==="large"})}
        >
          <input
            class="switch__input"
            type="checkbox"
            title=${this.title}
            name=${this.name}
            value=${Fi(this.value)}
            .checked=${vf(this.checked)}
            .disabled=${this.disabled}
            .required=${this.required}
            role="switch"
            aria-checked=${this.checked?"true":"false"}
            aria-describedby="help-text"
            @click=${this.handleClick}
            @input=${this.handleInput}
            @invalid=${this.handleInvalid}
            @blur=${this.handleBlur}
            @focus=${this.handleFocus}
            @keydown=${this.handleKeyDown}
          />

          <span part="control" class="switch__control">
            <span part="thumb" class="switch__thumb"></span>
          </span>

          <div part="label" class="switch__label">
            <slot></slot>
          </div>
        </label>

        <div
          aria-hidden=${e?"false":"true"}
          class="form-control__help-text"
          id="help-text"
          part="form-control-help-text"
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};Mo.styles=[qi,If,U8];J([yi('input[type="checkbox"]')],Mo.prototype,"input",2);J([Hi()],Mo.prototype,"hasFocus",2);J([be()],Mo.prototype,"title",2);J([be()],Mo.prototype,"name",2);J([be()],Mo.prototype,"value",2);J([be({reflect:!0})],Mo.prototype,"size",2);J([be({type:Boolean,reflect:!0})],Mo.prototype,"disabled",2);J([be({type:Boolean,reflect:!0})],Mo.prototype,"checked",2);J([Hm("checked")],Mo.prototype,"defaultChecked",2);J([be({reflect:!0})],Mo.prototype,"form",2);J([be({type:Boolean,reflect:!0})],Mo.prototype,"required",2);J([be({attribute:"help-text"})],Mo.prototype,"helpText",2);J([hi("checked",{waitUntilFirstUpdate:!0})],Mo.prototype,"handleCheckedChange",1);J([hi("disabled",{waitUntilFirstUpdate:!0})],Mo.prototype,"handleDisabledChange",1);Mo.define("sl-switch");x0.define("sl-resize-observer");var V8=ji`
  :host {
    display: block;
  }

  /** The popup */
  .select {
    flex: 1 1 auto;
    display: inline-flex;
    width: 100%;
    position: relative;
    vertical-align: middle;
  }

  .select::part(popup) {
    z-index: var(--sl-z-index-dropdown);
  }

  .select[data-current-placement^='top']::part(popup) {
    transform-origin: bottom;
  }

  .select[data-current-placement^='bottom']::part(popup) {
    transform-origin: top;
  }

  /* Combobox */
  .select__combobox {
    flex: 1;
    display: flex;
    width: 100%;
    min-width: 0;
    position: relative;
    align-items: center;
    justify-content: start;
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-input-font-weight);
    letter-spacing: var(--sl-input-letter-spacing);
    vertical-align: middle;
    overflow: hidden;
    cursor: pointer;
    transition:
      var(--sl-transition-fast) color,
      var(--sl-transition-fast) border,
      var(--sl-transition-fast) box-shadow,
      var(--sl-transition-fast) background-color;
  }

  .select__display-input {
    position: relative;
    width: 100%;
    font: inherit;
    border: none;
    background: none;
    color: var(--sl-input-color);
    cursor: inherit;
    overflow: hidden;
    padding: 0;
    margin: 0;
    -webkit-appearance: none;
  }

  .select__display-input::placeholder {
    color: var(--sl-input-placeholder-color);
  }

  .select:not(.select--disabled):hover .select__display-input {
    color: var(--sl-input-color-hover);
  }

  .select__display-input:focus {
    outline: none;
  }

  /* Visually hide the display input when multiple is enabled */
  .select--multiple:not(.select--placeholder-visible) .select__display-input {
    position: absolute;
    z-index: -1;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
  }

  .select__value-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    opacity: 0;
    z-index: -1;
  }

  .select__tags {
    display: flex;
    flex: 1;
    align-items: center;
    flex-wrap: wrap;
    margin-inline-start: var(--sl-spacing-2x-small);
  }

  .select__tags::slotted(sl-tag) {
    cursor: pointer !important;
  }

  .select--disabled .select__tags,
  .select--disabled .select__tags::slotted(sl-tag) {
    cursor: not-allowed !important;
  }

  /* Standard selects */
  .select--standard .select__combobox {
    background-color: var(--sl-input-background-color);
    border: solid var(--sl-input-border-width) var(--sl-input-border-color);
  }

  .select--standard.select--disabled .select__combobox {
    background-color: var(--sl-input-background-color-disabled);
    border-color: var(--sl-input-border-color-disabled);
    color: var(--sl-input-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
    outline: none;
  }

  .select--standard:not(.select--disabled).select--open .select__combobox,
  .select--standard:not(.select--disabled).select--focused .select__combobox {
    background-color: var(--sl-input-background-color-focus);
    border-color: var(--sl-input-border-color-focus);
    box-shadow: 0 0 0 var(--sl-focus-ring-width) var(--sl-input-focus-ring-color);
  }

  /* Filled selects */
  .select--filled .select__combobox {
    border: none;
    background-color: var(--sl-input-filled-background-color);
    color: var(--sl-input-color);
  }

  .select--filled:hover:not(.select--disabled) .select__combobox {
    background-color: var(--sl-input-filled-background-color-hover);
  }

  .select--filled.select--disabled .select__combobox {
    background-color: var(--sl-input-filled-background-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
  }

  .select--filled:not(.select--disabled).select--open .select__combobox,
  .select--filled:not(.select--disabled).select--focused .select__combobox {
    background-color: var(--sl-input-filled-background-color-focus);
    outline: var(--sl-focus-ring);
  }

  /* Sizes */
  .select--small .select__combobox {
    border-radius: var(--sl-input-border-radius-small);
    font-size: var(--sl-input-font-size-small);
    min-height: var(--sl-input-height-small);
    padding-block: 0;
    padding-inline: var(--sl-input-spacing-small);
  }

  .select--small .select__clear {
    margin-inline-start: var(--sl-input-spacing-small);
  }

  .select--small .select__prefix::slotted(*) {
    margin-inline-end: var(--sl-input-spacing-small);
  }

  .select--small.select--multiple:not(.select--placeholder-visible) .select__prefix::slotted(*) {
    margin-inline-start: var(--sl-input-spacing-small);
  }

  .select--small.select--multiple:not(.select--placeholder-visible) .select__combobox {
    padding-block: 2px;
    padding-inline-start: 0;
  }

  .select--small .select__tags {
    gap: 2px;
  }

  .select--medium .select__combobox {
    border-radius: var(--sl-input-border-radius-medium);
    font-size: var(--sl-input-font-size-medium);
    min-height: var(--sl-input-height-medium);
    padding-block: 0;
    padding-inline: var(--sl-input-spacing-medium);
  }

  .select--medium .select__clear {
    margin-inline-start: var(--sl-input-spacing-medium);
  }

  .select--medium .select__prefix::slotted(*) {
    margin-inline-end: var(--sl-input-spacing-medium);
  }

  .select--medium.select--multiple:not(.select--placeholder-visible) .select__prefix::slotted(*) {
    margin-inline-start: var(--sl-input-spacing-medium);
  }

  .select--medium.select--multiple:not(.select--placeholder-visible) .select__combobox {
    padding-inline-start: 0;
    padding-block: 3px;
  }

  .select--medium .select__tags {
    gap: 3px;
  }

  .select--large .select__combobox {
    border-radius: var(--sl-input-border-radius-large);
    font-size: var(--sl-input-font-size-large);
    min-height: var(--sl-input-height-large);
    padding-block: 0;
    padding-inline: var(--sl-input-spacing-large);
  }

  .select--large .select__clear {
    margin-inline-start: var(--sl-input-spacing-large);
  }

  .select--large .select__prefix::slotted(*) {
    margin-inline-end: var(--sl-input-spacing-large);
  }

  .select--large.select--multiple:not(.select--placeholder-visible) .select__prefix::slotted(*) {
    margin-inline-start: var(--sl-input-spacing-large);
  }

  .select--large.select--multiple:not(.select--placeholder-visible) .select__combobox {
    padding-inline-start: 0;
    padding-block: 4px;
  }

  .select--large .select__tags {
    gap: 4px;
  }

  /* Pills */
  .select--pill.select--small .select__combobox {
    border-radius: var(--sl-input-height-small);
  }

  .select--pill.select--medium .select__combobox {
    border-radius: var(--sl-input-height-medium);
  }

  .select--pill.select--large .select__combobox {
    border-radius: var(--sl-input-height-large);
  }

  /* Prefix and Suffix */
  .select__prefix,
  .select__suffix {
    flex: 0;
    display: inline-flex;
    align-items: center;
    color: var(--sl-input-placeholder-color);
  }

  .select__suffix::slotted(*) {
    margin-inline-start: var(--sl-spacing-small);
  }

  /* Clear button */
  .select__clear {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: inherit;
    color: var(--sl-input-icon-color);
    border: none;
    background: none;
    padding: 0;
    transition: var(--sl-transition-fast) color;
    cursor: pointer;
  }

  .select__clear:hover {
    color: var(--sl-input-icon-color-hover);
  }

  .select__clear:focus {
    outline: none;
  }

  /* Expand icon */
  .select__expand-icon {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    transition: var(--sl-transition-medium) rotate ease;
    rotate: 0;
    margin-inline-start: var(--sl-spacing-small);
  }

  .select--open .select__expand-icon {
    rotate: -180deg;
  }

  /* Listbox */
  .select__listbox {
    display: block;
    position: relative;
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    box-shadow: var(--sl-shadow-large);
    background: var(--sl-panel-background-color);
    border: solid var(--sl-panel-border-width) var(--sl-panel-border-color);
    border-radius: var(--sl-border-radius-medium);
    padding-block: var(--sl-spacing-x-small);
    padding-inline: 0;
    overflow: auto;
    overscroll-behavior: none;

    /* Make sure it adheres to the popup's auto size */
    max-width: var(--auto-size-available-width);
    max-height: var(--auto-size-available-height);
  }

  .select__listbox ::slotted(sl-divider) {
    --spacing: var(--sl-spacing-x-small);
  }

  .select__listbox ::slotted(small) {
    display: block;
    font-size: var(--sl-font-size-small);
    font-weight: var(--sl-font-weight-semibold);
    color: var(--sl-color-neutral-500);
    padding-block: var(--sl-spacing-2x-small);
    padding-inline: var(--sl-spacing-x-large);
  }
`;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let uS=class extends _0{constructor(e){if(super(e),this.it=$r,e.type!==Sc.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===$r||e==null)return this._t=void 0,this.it=e;if(e===Da)return e;if(typeof e!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}};uS.directiveName="unsafeHTML",uS.resultType=1;const kx=g0(uS);var Yn=class extends Li{constructor(){super(...arguments),this.formControlController=new Ch(this,{assumeInteractionOn:["sl-blur","sl-input"]}),this.hasSlotController=new Uo(this,"help-text","label"),this.localize=new cr(this),this.typeToSelectString="",this.hasFocus=!1,this.displayLabel="",this.selectedOptions=[],this.valueHasChanged=!1,this.name="",this._value="",this.defaultValue="",this.size="medium",this.placeholder="",this.multiple=!1,this.maxOptionsVisible=3,this.disabled=!1,this.clearable=!1,this.open=!1,this.hoist=!1,this.filled=!1,this.pill=!1,this.label="",this.placement="bottom",this.helpText="",this.form="",this.required=!1,this.getTag=i=>ei`
      <sl-tag
        part="tag"
        exportparts="
              base:tag__base,
              content:tag__content,
              remove-button:tag__remove-button,
              remove-button__base:tag__remove-button__base
            "
        ?pill=${this.pill}
        size=${this.size}
        removable
        @sl-remove=${e=>this.handleTagRemove(e,i)}
      >
        ${i.getTextLabel()}
      </sl-tag>
    `,this.handleDocumentFocusIn=i=>{const e=i.composedPath();this&&!e.includes(this)&&this.hide()},this.handleDocumentKeyDown=i=>{const e=i.target,t=e.closest(".select__clear")!==null,n=e.closest("sl-icon-button")!==null;if(!(t||n)){if(i.key==="Escape"&&this.open&&!this.closeWatcher&&(i.preventDefault(),i.stopPropagation(),this.hide(),this.displayInput.focus({preventScroll:!0})),i.key==="Enter"||i.key===" "&&this.typeToSelectString===""){if(i.preventDefault(),i.stopImmediatePropagation(),!this.open){this.show();return}this.currentOption&&!this.currentOption.disabled&&(this.valueHasChanged=!0,this.multiple?this.toggleOptionSelection(this.currentOption):this.setSelectedOptions(this.currentOption),this.updateComplete.then(()=>{this.emit("sl-input"),this.emit("sl-change")}),this.multiple||(this.hide(),this.displayInput.focus({preventScroll:!0})));return}if(["ArrowUp","ArrowDown","Home","End"].includes(i.key)){const s=this.getAllOptions(),c=s.indexOf(this.currentOption);let f=Math.max(0,c);if(i.preventDefault(),!this.open&&(this.show(),this.currentOption))return;i.key==="ArrowDown"?(f=c+1,f>s.length-1&&(f=0)):i.key==="ArrowUp"?(f=c-1,f<0&&(f=s.length-1)):i.key==="Home"?f=0:i.key==="End"&&(f=s.length-1),this.setCurrentOption(s[f])}if(i.key&&i.key.length===1||i.key==="Backspace"){const s=this.getAllOptions();if(i.metaKey||i.ctrlKey||i.altKey)return;if(!this.open){if(i.key==="Backspace")return;this.show()}i.stopPropagation(),i.preventDefault(),clearTimeout(this.typeToSelectTimeout),this.typeToSelectTimeout=window.setTimeout(()=>this.typeToSelectString="",1e3),i.key==="Backspace"?this.typeToSelectString=this.typeToSelectString.slice(0,-1):this.typeToSelectString+=i.key.toLowerCase();for(const c of s)if(c.getTextLabel().toLowerCase().startsWith(this.typeToSelectString)){this.setCurrentOption(c);break}}}},this.handleDocumentMouseDown=i=>{const e=i.composedPath();this&&!e.includes(this)&&this.hide()}}get value(){return this._value}set value(i){this.multiple?i=Array.isArray(i)?i:i.split(" "):i=Array.isArray(i)?i.join(" "):i,this._value!==i&&(this.valueHasChanged=!0,this._value=i)}get validity(){return this.valueInput.validity}get validationMessage(){return this.valueInput.validationMessage}connectedCallback(){super.connectedCallback(),setTimeout(()=>{this.handleDefaultSlotChange()}),this.open=!1}addOpenListeners(){var i;document.addEventListener("focusin",this.handleDocumentFocusIn),document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("mousedown",this.handleDocumentMouseDown),this.getRootNode()!==document&&this.getRootNode().addEventListener("focusin",this.handleDocumentFocusIn),"CloseWatcher"in window&&((i=this.closeWatcher)==null||i.destroy(),this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>{this.open&&(this.hide(),this.displayInput.focus({preventScroll:!0}))})}removeOpenListeners(){var i;document.removeEventListener("focusin",this.handleDocumentFocusIn),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("mousedown",this.handleDocumentMouseDown),this.getRootNode()!==document&&this.getRootNode().removeEventListener("focusin",this.handleDocumentFocusIn),(i=this.closeWatcher)==null||i.destroy()}handleFocus(){this.hasFocus=!0,this.displayInput.setSelectionRange(0,0),this.emit("sl-focus")}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleLabelClick(){this.displayInput.focus()}handleComboboxMouseDown(i){const t=i.composedPath().some(n=>n instanceof Element&&n.tagName.toLowerCase()==="sl-icon-button");this.disabled||t||(i.preventDefault(),this.displayInput.focus({preventScroll:!0}),this.open=!this.open)}handleComboboxKeyDown(i){i.key!=="Tab"&&(i.stopPropagation(),this.handleDocumentKeyDown(i))}handleClearClick(i){i.stopPropagation(),this.valueHasChanged=!0,this.value!==""&&(this.setSelectedOptions([]),this.displayInput.focus({preventScroll:!0}),this.updateComplete.then(()=>{this.emit("sl-clear"),this.emit("sl-input"),this.emit("sl-change")}))}handleClearMouseDown(i){i.stopPropagation(),i.preventDefault()}handleOptionClick(i){const t=i.target.closest("sl-option"),n=this.value;t&&!t.disabled&&(this.valueHasChanged=!0,this.multiple?this.toggleOptionSelection(t):this.setSelectedOptions(t),this.updateComplete.then(()=>this.displayInput.focus({preventScroll:!0})),this.value!==n&&this.updateComplete.then(()=>{this.emit("sl-input"),this.emit("sl-change")}),this.multiple||(this.hide(),this.displayInput.focus({preventScroll:!0})))}handleDefaultSlotChange(){customElements.get("sl-option")||customElements.whenDefined("sl-option").then(()=>this.handleDefaultSlotChange());const i=this.getAllOptions(),e=this.valueHasChanged?this.value:this.defaultValue,t=Array.isArray(e)?e:[e],n=[];i.forEach(s=>n.push(s.value)),this.setSelectedOptions(i.filter(s=>t.includes(s.value)))}handleTagRemove(i,e){i.stopPropagation(),this.valueHasChanged=!0,this.disabled||(this.toggleOptionSelection(e,!1),this.updateComplete.then(()=>{this.emit("sl-input"),this.emit("sl-change")}))}getAllOptions(){return[...this.querySelectorAll("sl-option")]}getFirstOption(){return this.querySelector("sl-option")}setCurrentOption(i){this.getAllOptions().forEach(t=>{t.current=!1,t.tabIndex=-1}),i&&(this.currentOption=i,i.current=!0,i.tabIndex=0,i.focus())}setSelectedOptions(i){const e=this.getAllOptions(),t=Array.isArray(i)?i:[i];e.forEach(n=>n.selected=!1),t.length&&t.forEach(n=>n.selected=!0),this.selectionChanged()}toggleOptionSelection(i,e){e===!0||e===!1?i.selected=e:i.selected=!i.selected,this.selectionChanged()}selectionChanged(){var i,e,t;const n=this.getAllOptions();this.selectedOptions=n.filter(c=>c.selected);const s=this.valueHasChanged;if(this.multiple)this.value=this.selectedOptions.map(c=>c.value),this.placeholder&&this.value.length===0?this.displayLabel="":this.displayLabel=this.localize.term("numOptionsSelected",this.selectedOptions.length);else{const c=this.selectedOptions[0];this.value=(i=c==null?void 0:c.value)!=null?i:"",this.displayLabel=(t=(e=c==null?void 0:c.getTextLabel)==null?void 0:e.call(c))!=null?t:""}this.valueHasChanged=s,this.updateComplete.then(()=>{this.formControlController.updateValidity()})}get tags(){return this.selectedOptions.map((i,e)=>{if(e<this.maxOptionsVisible||this.maxOptionsVisible<=0){const t=this.getTag(i,e);return ei`<div @sl-remove=${n=>this.handleTagRemove(n,i)}>
          ${typeof t=="string"?kx(t):t}
        </div>`}else if(e===this.maxOptionsVisible)return ei`<sl-tag size=${this.size}>+${this.selectedOptions.length-e}</sl-tag>`;return ei``})}handleInvalid(i){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(i)}handleDisabledChange(){this.disabled&&(this.open=!1,this.handleOpenChange())}attributeChangedCallback(i,e,t){if(super.attributeChangedCallback(i,e,t),i==="value"){const n=this.valueHasChanged;this.value=this.defaultValue,this.valueHasChanged=n}}handleValueChange(){if(!this.valueHasChanged){const t=this.valueHasChanged;this.value=this.defaultValue,this.valueHasChanged=t}const i=this.getAllOptions(),e=Array.isArray(this.value)?this.value:[this.value];this.setSelectedOptions(i.filter(t=>e.includes(t.value)))}async handleOpenChange(){if(this.open&&!this.disabled){this.setCurrentOption(this.selectedOptions[0]||this.getFirstOption()),this.emit("sl-show"),this.addOpenListeners(),await Es(this),this.listbox.hidden=!1,this.popup.active=!0,requestAnimationFrame(()=>{this.setCurrentOption(this.currentOption)});const{keyframes:i,options:e}=jr(this,"select.show",{dir:this.localize.dir()});await ss(this.popup.popup,i,e),this.currentOption&&hS(this.currentOption,this.listbox,"vertical","auto"),this.emit("sl-after-show")}else{this.emit("sl-hide"),this.removeOpenListeners(),await Es(this);const{keyframes:i,options:e}=jr(this,"select.hide",{dir:this.localize.dir()});await ss(this.popup.popup,i,e),this.listbox.hidden=!0,this.popup.active=!1,this.emit("sl-after-hide")}}async show(){if(this.open||this.disabled){this.open=!1;return}return this.open=!0,No(this,"sl-after-show")}async hide(){if(!this.open||this.disabled){this.open=!1;return}return this.open=!1,No(this,"sl-after-hide")}checkValidity(){return this.valueInput.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.valueInput.reportValidity()}setCustomValidity(i){this.valueInput.setCustomValidity(i),this.formControlController.updateValidity()}focus(i){this.displayInput.focus(i)}blur(){this.displayInput.blur()}render(){const i=this.hasSlotController.test("label"),e=this.hasSlotController.test("help-text"),t=this.label?!0:!!i,n=this.helpText?!0:!!e,s=this.clearable&&!this.disabled&&this.value.length>0,c=this.placeholder&&this.value&&this.value.length<=0;return ei`
      <div
        part="form-control"
        class=${Xi({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--has-label":t,"form-control--has-help-text":n})}
      >
        <label
          id="label"
          part="form-control-label"
          class="form-control__label"
          aria-hidden=${t?"false":"true"}
          @click=${this.handleLabelClick}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <div part="form-control-input" class="form-control-input">
          <sl-popup
            class=${Xi({select:!0,"select--standard":!0,"select--filled":this.filled,"select--pill":this.pill,"select--open":this.open,"select--disabled":this.disabled,"select--multiple":this.multiple,"select--focused":this.hasFocus,"select--placeholder-visible":c,"select--top":this.placement==="top","select--bottom":this.placement==="bottom","select--small":this.size==="small","select--medium":this.size==="medium","select--large":this.size==="large"})}
            placement=${this.placement}
            strategy=${this.hoist?"fixed":"absolute"}
            flip
            shift
            sync="width"
            auto-size="vertical"
            auto-size-padding="10"
          >
            <div
              part="combobox"
              class="select__combobox"
              slot="anchor"
              @keydown=${this.handleComboboxKeyDown}
              @mousedown=${this.handleComboboxMouseDown}
            >
              <slot part="prefix" name="prefix" class="select__prefix"></slot>

              <input
                part="display-input"
                class="select__display-input"
                type="text"
                placeholder=${this.placeholder}
                .disabled=${this.disabled}
                .value=${this.displayLabel}
                autocomplete="off"
                spellcheck="false"
                autocapitalize="off"
                readonly
                aria-controls="listbox"
                aria-expanded=${this.open?"true":"false"}
                aria-haspopup="listbox"
                aria-labelledby="label"
                aria-disabled=${this.disabled?"true":"false"}
                aria-describedby="help-text"
                role="combobox"
                tabindex="0"
                @focus=${this.handleFocus}
                @blur=${this.handleBlur}
              />

              ${this.multiple?ei`<div part="tags" class="select__tags">${this.tags}</div>`:""}

              <input
                class="select__value-input"
                type="text"
                ?disabled=${this.disabled}
                ?required=${this.required}
                .value=${Array.isArray(this.value)?this.value.join(", "):this.value}
                tabindex="-1"
                aria-hidden="true"
                @focus=${()=>this.focus()}
                @invalid=${this.handleInvalid}
              />

              ${s?ei`
                    <button
                      part="clear-button"
                      class="select__clear"
                      type="button"
                      aria-label=${this.localize.term("clearEntry")}
                      @mousedown=${this.handleClearMouseDown}
                      @click=${this.handleClearClick}
                      tabindex="-1"
                    >
                      <slot name="clear-icon">
                        <sl-icon name="x-circle-fill" library="system"></sl-icon>
                      </slot>
                    </button>
                  `:""}

              <slot name="suffix" part="suffix" class="select__suffix"></slot>

              <slot name="expand-icon" part="expand-icon" class="select__expand-icon">
                <sl-icon library="system" name="chevron-down"></sl-icon>
              </slot>
            </div>

            <div
              id="listbox"
              role="listbox"
              aria-expanded=${this.open?"true":"false"}
              aria-multiselectable=${this.multiple?"true":"false"}
              aria-labelledby="label"
              part="listbox"
              class="select__listbox"
              tabindex="-1"
              @mouseup=${this.handleOptionClick}
              @slotchange=${this.handleDefaultSlotChange}
            >
              <slot></slot>
            </div>
          </sl-popup>
        </div>

        <div
          part="form-control-help-text"
          id="help-text"
          class="form-control__help-text"
          aria-hidden=${n?"false":"true"}
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};Yn.styles=[qi,If,V8];Yn.dependencies={"sl-icon":kr,"sl-popup":yr,"sl-tag":ju};J([yi(".select")],Yn.prototype,"popup",2);J([yi(".select__combobox")],Yn.prototype,"combobox",2);J([yi(".select__display-input")],Yn.prototype,"displayInput",2);J([yi(".select__value-input")],Yn.prototype,"valueInput",2);J([yi(".select__listbox")],Yn.prototype,"listbox",2);J([Hi()],Yn.prototype,"hasFocus",2);J([Hi()],Yn.prototype,"displayLabel",2);J([Hi()],Yn.prototype,"currentOption",2);J([Hi()],Yn.prototype,"selectedOptions",2);J([Hi()],Yn.prototype,"valueHasChanged",2);J([be()],Yn.prototype,"name",2);J([Hi()],Yn.prototype,"value",1);J([be({attribute:"value"})],Yn.prototype,"defaultValue",2);J([be({reflect:!0})],Yn.prototype,"size",2);J([be()],Yn.prototype,"placeholder",2);J([be({type:Boolean,reflect:!0})],Yn.prototype,"multiple",2);J([be({attribute:"max-options-visible",type:Number})],Yn.prototype,"maxOptionsVisible",2);J([be({type:Boolean,reflect:!0})],Yn.prototype,"disabled",2);J([be({type:Boolean})],Yn.prototype,"clearable",2);J([be({type:Boolean,reflect:!0})],Yn.prototype,"open",2);J([be({type:Boolean})],Yn.prototype,"hoist",2);J([be({type:Boolean,reflect:!0})],Yn.prototype,"filled",2);J([be({type:Boolean,reflect:!0})],Yn.prototype,"pill",2);J([be()],Yn.prototype,"label",2);J([be({reflect:!0})],Yn.prototype,"placement",2);J([be({attribute:"help-text"})],Yn.prototype,"helpText",2);J([be({reflect:!0})],Yn.prototype,"form",2);J([be({type:Boolean,reflect:!0})],Yn.prototype,"required",2);J([be()],Yn.prototype,"getTag",2);J([hi("disabled",{waitUntilFirstUpdate:!0})],Yn.prototype,"handleDisabledChange",1);J([hi(["defaultValue","value"],{waitUntilFirstUpdate:!0})],Yn.prototype,"handleValueChange",1);J([hi("open",{waitUntilFirstUpdate:!0})],Yn.prototype,"handleOpenChange",1);_r("select.show",{keyframes:[{opacity:0,scale:.9},{opacity:1,scale:1}],options:{duration:100,easing:"ease"}});_r("select.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.9}],options:{duration:100,easing:"ease"}});Yn.define("sl-select");y0.define("sl-spinner");var $8=ji`
  :host {
    --thumb-size: 20px;
    --tooltip-offset: 10px;
    --track-color-active: var(--sl-color-neutral-200);
    --track-color-inactive: var(--sl-color-neutral-200);
    --track-active-offset: 0%;
    --track-height: 6px;

    display: block;
  }

  .range {
    position: relative;
  }

  .range__control {
    --percent: 0%;
    -webkit-appearance: none;
    border-radius: 3px;
    width: 100%;
    height: var(--track-height);
    background: transparent;
    line-height: var(--sl-input-height-medium);
    vertical-align: middle;
    margin: 0;

    background-image: linear-gradient(
      to right,
      var(--track-color-inactive) 0%,
      var(--track-color-inactive) min(var(--percent), var(--track-active-offset)),
      var(--track-color-active) min(var(--percent), var(--track-active-offset)),
      var(--track-color-active) max(var(--percent), var(--track-active-offset)),
      var(--track-color-inactive) max(var(--percent), var(--track-active-offset)),
      var(--track-color-inactive) 100%
    );
  }

  .range--rtl .range__control {
    background-image: linear-gradient(
      to left,
      var(--track-color-inactive) 0%,
      var(--track-color-inactive) min(var(--percent), var(--track-active-offset)),
      var(--track-color-active) min(var(--percent), var(--track-active-offset)),
      var(--track-color-active) max(var(--percent), var(--track-active-offset)),
      var(--track-color-inactive) max(var(--percent), var(--track-active-offset)),
      var(--track-color-inactive) 100%
    );
  }

  /* Webkit */
  .range__control::-webkit-slider-runnable-track {
    width: 100%;
    height: var(--track-height);
    border-radius: 3px;
    border: none;
  }

  .range__control::-webkit-slider-thumb {
    border: none;
    width: var(--thumb-size);
    height: var(--thumb-size);
    border-radius: 50%;
    background-color: var(--sl-color-primary-600);
    border: solid var(--sl-input-border-width) var(--sl-color-primary-600);
    -webkit-appearance: none;
    margin-top: calc(var(--thumb-size) / -2 + var(--track-height) / 2);
    cursor: pointer;
  }

  .range__control:enabled::-webkit-slider-thumb:hover {
    background-color: var(--sl-color-primary-500);
    border-color: var(--sl-color-primary-500);
  }

  .range__control:enabled:focus-visible::-webkit-slider-thumb {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .range__control:enabled::-webkit-slider-thumb:active {
    background-color: var(--sl-color-primary-500);
    border-color: var(--sl-color-primary-500);
    cursor: grabbing;
  }

  /* Firefox */
  .range__control::-moz-focus-outer {
    border: 0;
  }

  .range__control::-moz-range-progress {
    background-color: var(--track-color-active);
    border-radius: 3px;
    height: var(--track-height);
  }

  .range__control::-moz-range-track {
    width: 100%;
    height: var(--track-height);
    background-color: var(--track-color-inactive);
    border-radius: 3px;
    border: none;
  }

  .range__control::-moz-range-thumb {
    border: none;
    height: var(--thumb-size);
    width: var(--thumb-size);
    border-radius: 50%;
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
    transition:
      var(--sl-transition-fast) border-color,
      var(--sl-transition-fast) background-color,
      var(--sl-transition-fast) color,
      var(--sl-transition-fast) box-shadow;
    cursor: pointer;
  }

  .range__control:enabled::-moz-range-thumb:hover {
    background-color: var(--sl-color-primary-500);
    border-color: var(--sl-color-primary-500);
  }

  .range__control:enabled:focus-visible::-moz-range-thumb {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .range__control:enabled::-moz-range-thumb:active {
    background-color: var(--sl-color-primary-500);
    border-color: var(--sl-color-primary-500);
    cursor: grabbing;
  }

  /* States */
  .range__control:focus-visible {
    outline: none;
  }

  .range__control:disabled {
    opacity: 0.5;
  }

  .range__control:disabled::-webkit-slider-thumb {
    cursor: not-allowed;
  }

  .range__control:disabled::-moz-range-thumb {
    cursor: not-allowed;
  }

  /* Tooltip output */
  .range__tooltip {
    position: absolute;
    z-index: var(--sl-z-index-tooltip);
    left: 0;
    border-radius: var(--sl-tooltip-border-radius);
    background-color: var(--sl-tooltip-background-color);
    font-family: var(--sl-tooltip-font-family);
    font-size: var(--sl-tooltip-font-size);
    font-weight: var(--sl-tooltip-font-weight);
    line-height: var(--sl-tooltip-line-height);
    color: var(--sl-tooltip-color);
    opacity: 0;
    padding: var(--sl-tooltip-padding);
    transition: var(--sl-transition-fast) opacity;
    pointer-events: none;
  }

  .range__tooltip:after {
    content: '';
    position: absolute;
    width: 0;
    height: 0;
    left: 50%;
    translate: calc(-1 * var(--sl-tooltip-arrow-size));
  }

  .range--tooltip-visible .range__tooltip {
    opacity: 1;
  }

  /* Tooltip on top */
  .range--tooltip-top .range__tooltip {
    top: calc(-1 * var(--thumb-size) - var(--tooltip-offset));
  }

  .range--tooltip-top .range__tooltip:after {
    border-top: var(--sl-tooltip-arrow-size) solid var(--sl-tooltip-background-color);
    border-left: var(--sl-tooltip-arrow-size) solid transparent;
    border-right: var(--sl-tooltip-arrow-size) solid transparent;
    top: 100%;
  }

  /* Tooltip on bottom */
  .range--tooltip-bottom .range__tooltip {
    bottom: calc(-1 * var(--thumb-size) - var(--tooltip-offset));
  }

  .range--tooltip-bottom .range__tooltip:after {
    border-bottom: var(--sl-tooltip-arrow-size) solid var(--sl-tooltip-background-color);
    border-left: var(--sl-tooltip-arrow-size) solid transparent;
    border-right: var(--sl-tooltip-arrow-size) solid transparent;
    bottom: 100%;
  }

  @media (forced-colors: active) {
    .range__control,
    .range__tooltip {
      border: solid 1px transparent;
    }

    .range__control::-webkit-slider-thumb {
      border: solid 1px transparent;
    }

    .range__control::-moz-range-thumb {
      border: solid 1px transparent;
    }

    .range__tooltip:after {
      display: none;
    }
  }
`,Kr=class extends Li{constructor(){super(...arguments),this.formControlController=new Ch(this),this.hasSlotController=new Uo(this,"help-text","label"),this.localize=new cr(this),this.hasFocus=!1,this.hasTooltip=!1,this.title="",this.name="",this.value=0,this.label="",this.helpText="",this.disabled=!1,this.min=0,this.max=100,this.step=1,this.tooltip="top",this.tooltipFormatter=i=>i.toString(),this.form="",this.defaultValue=0}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(()=>this.syncRange()),this.value<this.min&&(this.value=this.min),this.value>this.max&&(this.value=this.max),this.updateComplete.then(()=>{this.syncRange(),this.resizeObserver.observe(this.input)})}disconnectedCallback(){var i;super.disconnectedCallback(),(i=this.resizeObserver)==null||i.unobserve(this.input)}handleChange(){this.emit("sl-change")}handleInput(){this.value=parseFloat(this.input.value),this.emit("sl-input"),this.syncRange()}handleBlur(){this.hasFocus=!1,this.hasTooltip=!1,this.emit("sl-blur")}handleFocus(){this.hasFocus=!0,this.hasTooltip=!0,this.emit("sl-focus")}handleThumbDragStart(){this.hasTooltip=!0}handleThumbDragEnd(){this.hasTooltip=!1}syncProgress(i){this.input.style.setProperty("--percent",`${i*100}%`)}syncTooltip(i){if(this.output!==null){const e=this.input.offsetWidth,t=this.output.offsetWidth,n=getComputedStyle(this.input).getPropertyValue("--thumb-size"),s=this.localize.dir()==="rtl",c=e*i;if(s){const f=`${e-c}px + ${i} * ${n}`;this.output.style.translate=`calc((${f} - ${t/2}px - ${n} / 2))`}else{const f=`${c}px - ${i} * ${n}`;this.output.style.translate=`calc(${f} - ${t/2}px + ${n} / 2)`}}}handleValueChange(){this.formControlController.updateValidity(),this.input.value=this.value.toString(),this.value=parseFloat(this.input.value),this.syncRange()}handleDisabledChange(){this.formControlController.setValidity(this.disabled)}syncRange(){const i=Math.max(0,(this.value-this.min)/(this.max-this.min));this.syncProgress(i),this.tooltip!=="none"&&this.hasTooltip&&this.updateComplete.then(()=>this.syncTooltip(i))}handleInvalid(i){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(i)}focus(i){this.input.focus(i)}blur(){this.input.blur()}stepUp(){this.input.stepUp(),this.value!==Number(this.input.value)&&(this.value=Number(this.input.value))}stepDown(){this.input.stepDown(),this.value!==Number(this.input.value)&&(this.value=Number(this.input.value))}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.input.reportValidity()}setCustomValidity(i){this.input.setCustomValidity(i),this.formControlController.updateValidity()}render(){const i=this.hasSlotController.test("label"),e=this.hasSlotController.test("help-text"),t=this.label?!0:!!i,n=this.helpText?!0:!!e;return ei`
      <div
        part="form-control"
        class=${Xi({"form-control":!0,"form-control--medium":!0,"form-control--has-label":t,"form-control--has-help-text":n})}
      >
        <label
          part="form-control-label"
          class="form-control__label"
          for="input"
          aria-hidden=${t?"false":"true"}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <div part="form-control-input" class="form-control-input">
          <div
            part="base"
            class=${Xi({range:!0,"range--disabled":this.disabled,"range--focused":this.hasFocus,"range--rtl":this.localize.dir()==="rtl","range--tooltip-visible":this.hasTooltip,"range--tooltip-top":this.tooltip==="top","range--tooltip-bottom":this.tooltip==="bottom"})}
            @mousedown=${this.handleThumbDragStart}
            @mouseup=${this.handleThumbDragEnd}
            @touchstart=${this.handleThumbDragStart}
            @touchend=${this.handleThumbDragEnd}
          >
            <input
              part="input"
              id="input"
              class="range__control"
              title=${this.title}
              type="range"
              name=${Fi(this.name)}
              ?disabled=${this.disabled}
              min=${Fi(this.min)}
              max=${Fi(this.max)}
              step=${Fi(this.step)}
              .value=${vf(this.value.toString())}
              aria-describedby="help-text"
              @change=${this.handleChange}
              @focus=${this.handleFocus}
              @input=${this.handleInput}
              @invalid=${this.handleInvalid}
              @blur=${this.handleBlur}
            />
            ${this.tooltip!=="none"&&!this.disabled?ei`
                  <output part="tooltip" class="range__tooltip">
                    ${typeof this.tooltipFormatter=="function"?this.tooltipFormatter(this.value):this.value}
                  </output>
                `:""}
          </div>
        </div>

        <div
          part="form-control-help-text"
          id="help-text"
          class="form-control__help-text"
          aria-hidden=${n?"false":"true"}
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};Kr.styles=[qi,If,$8];J([yi(".range__control")],Kr.prototype,"input",2);J([yi(".range__tooltip")],Kr.prototype,"output",2);J([Hi()],Kr.prototype,"hasFocus",2);J([Hi()],Kr.prototype,"hasTooltip",2);J([be()],Kr.prototype,"title",2);J([be()],Kr.prototype,"name",2);J([be({type:Number})],Kr.prototype,"value",2);J([be()],Kr.prototype,"label",2);J([be({attribute:"help-text"})],Kr.prototype,"helpText",2);J([be({type:Boolean,reflect:!0})],Kr.prototype,"disabled",2);J([be({type:Number})],Kr.prototype,"min",2);J([be({type:Number})],Kr.prototype,"max",2);J([be({type:Number})],Kr.prototype,"step",2);J([be()],Kr.prototype,"tooltip",2);J([be({attribute:!1})],Kr.prototype,"tooltipFormatter",2);J([be({reflect:!0})],Kr.prototype,"form",2);J([Hm()],Kr.prototype,"defaultValue",2);J([m0({passive:!0})],Kr.prototype,"handleThumbDragStart",1);J([hi("value",{waitUntilFirstUpdate:!0})],Kr.prototype,"handleValueChange",1);J([hi("disabled",{waitUntilFirstUpdate:!0})],Kr.prototype,"handleDisabledChange",1);J([hi("hasTooltip",{waitUntilFirstUpdate:!0})],Kr.prototype,"syncRange",1);Kr.define("sl-range");var j8=ji`
  :host {
    --symbol-color: var(--sl-color-neutral-300);
    --symbol-color-active: var(--sl-color-amber-500);
    --symbol-size: 1.2rem;
    --symbol-spacing: var(--sl-spacing-3x-small);

    display: inline-flex;
  }

  .rating {
    position: relative;
    display: inline-flex;
    border-radius: var(--sl-border-radius-medium);
    vertical-align: middle;
  }

  .rating:focus {
    outline: none;
  }

  .rating:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .rating__symbols {
    display: inline-flex;
    position: relative;
    font-size: var(--symbol-size);
    line-height: 0;
    color: var(--symbol-color);
    white-space: nowrap;
    cursor: pointer;
  }

  .rating__symbols > * {
    padding: var(--symbol-spacing);
  }

  .rating__symbol--active,
  .rating__partial--filled {
    color: var(--symbol-color-active);
  }

  .rating__partial-symbol-container {
    position: relative;
  }

  .rating__partial--filled {
    position: absolute;
    top: var(--symbol-spacing);
    left: var(--symbol-spacing);
  }

  .rating__symbol {
    transition: var(--sl-transition-fast) scale;
    pointer-events: none;
  }

  .rating__symbol--hover {
    scale: 1.2;
  }

  .rating--disabled .rating__symbols,
  .rating--readonly .rating__symbols {
    cursor: default;
  }

  .rating--disabled .rating__symbol--hover,
  .rating--readonly .rating__symbol--hover {
    scale: none;
  }

  .rating--disabled {
    opacity: 0.5;
  }

  .rating--disabled .rating__symbols {
    cursor: not-allowed;
  }

  /* Forced colors mode */
  @media (forced-colors: active) {
    .rating__symbol--active {
      color: SelectedItem;
    }
  }
`;/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const GO="important",H8=" !"+GO,Qo=g0(class extends _0{constructor(i){var e;if(super(i),i.type!==Sc.ATTRIBUTE||i.name!=="style"||((e=i.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(i){return Object.keys(i).reduce((e,t)=>{const n=i[t];return n==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${n};`},"")}update(i,[e]){const{style:t}=i.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const n of this.ft)e[n]==null&&(this.ft.delete(n),n.includes("-")?t.removeProperty(n):t[n]=null);for(const n in e){const s=e[n];if(s!=null){this.ft.add(n);const c=typeof s=="string"&&s.endsWith(H8);n.includes("-")||c?t.setProperty(n,c?s.slice(0,-11):s,c?GO:""):t[n]=s}}return Da}});var Ro=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.hoverValue=0,this.isHovering=!1,this.label="",this.value=0,this.max=5,this.precision=1,this.readonly=!1,this.disabled=!1,this.getSymbol=()=>'<sl-icon name="star-fill" library="system"></sl-icon>'}getValueFromMousePosition(i){return this.getValueFromXCoordinate(i.clientX)}getValueFromTouchPosition(i){return this.getValueFromXCoordinate(i.touches[0].clientX)}getValueFromXCoordinate(i){const e=this.localize.dir()==="rtl",{left:t,right:n,width:s}=this.rating.getBoundingClientRect(),c=e?this.roundToPrecision((n-i)/s*this.max,this.precision):this.roundToPrecision((i-t)/s*this.max,this.precision);return ws(c,0,this.max)}handleClick(i){this.disabled||(this.setValue(this.getValueFromMousePosition(i)),this.emit("sl-change"))}setValue(i){this.disabled||this.readonly||(this.value=i===this.value?0:i,this.isHovering=!1)}handleKeyDown(i){const e=this.localize.dir()==="ltr",t=this.localize.dir()==="rtl",n=this.value;if(!(this.disabled||this.readonly)){if(i.key==="ArrowDown"||e&&i.key==="ArrowLeft"||t&&i.key==="ArrowRight"){const s=i.shiftKey?1:this.precision;this.value=Math.max(0,this.value-s),i.preventDefault()}if(i.key==="ArrowUp"||e&&i.key==="ArrowRight"||t&&i.key==="ArrowLeft"){const s=i.shiftKey?1:this.precision;this.value=Math.min(this.max,this.value+s),i.preventDefault()}i.key==="Home"&&(this.value=0,i.preventDefault()),i.key==="End"&&(this.value=this.max,i.preventDefault()),this.value!==n&&this.emit("sl-change")}}handleMouseEnter(i){this.isHovering=!0,this.hoverValue=this.getValueFromMousePosition(i)}handleMouseMove(i){this.hoverValue=this.getValueFromMousePosition(i)}handleMouseLeave(){this.isHovering=!1}handleTouchStart(i){this.isHovering=!0,this.hoverValue=this.getValueFromTouchPosition(i),i.preventDefault()}handleTouchMove(i){this.hoverValue=this.getValueFromTouchPosition(i)}handleTouchEnd(i){this.isHovering=!1,this.setValue(this.hoverValue),this.emit("sl-change"),i.preventDefault()}roundToPrecision(i,e=.5){const t=1/e;return Math.ceil(i*t)/t}handleHoverValueChange(){this.emit("sl-hover",{detail:{phase:"move",value:this.hoverValue}})}handleIsHoveringChange(){this.emit("sl-hover",{detail:{phase:this.isHovering?"start":"end",value:this.hoverValue}})}focus(i){this.rating.focus(i)}blur(){this.rating.blur()}render(){const i=this.localize.dir()==="rtl",e=Array.from(Array(this.max).keys());let t=0;return this.disabled||this.readonly?t=this.value:t=this.isHovering?this.hoverValue:this.value,ei`
      <div
        part="base"
        class=${Xi({rating:!0,"rating--readonly":this.readonly,"rating--disabled":this.disabled,"rating--rtl":i})}
        role="slider"
        aria-label=${this.label}
        aria-disabled=${this.disabled?"true":"false"}
        aria-readonly=${this.readonly?"true":"false"}
        aria-valuenow=${this.value}
        aria-valuemin=${0}
        aria-valuemax=${this.max}
        tabindex=${this.disabled||this.readonly?"-1":"0"}
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
        @mouseenter=${this.handleMouseEnter}
        @touchstart=${this.handleTouchStart}
        @mouseleave=${this.handleMouseLeave}
        @touchend=${this.handleTouchEnd}
        @mousemove=${this.handleMouseMove}
        @touchmove=${this.handleTouchMove}
      >
        <span class="rating__symbols">
          ${e.map(n=>t>n&&t<n+1?ei`
                <span
                  class=${Xi({rating__symbol:!0,"rating__partial-symbol-container":!0,"rating__symbol--hover":this.isHovering&&Math.ceil(t)===n+1})}
                  role="presentation"
                >
                  <div
                    style=${Qo({clipPath:i?`inset(0 ${(t-n)*100}% 0 0)`:`inset(0 0 0 ${(t-n)*100}%)`})}
                  >
                    ${kx(this.getSymbol(n+1))}
                  </div>
                  <div
                    class="rating__partial--filled"
                    style=${Qo({clipPath:i?`inset(0 0 0 ${100-(t-n)*100}%)`:`inset(0 ${100-(t-n)*100}% 0 0)`})}
                  >
                    ${kx(this.getSymbol(n+1))}
                  </div>
                </span>
              `:ei`
              <span
                class=${Xi({rating__symbol:!0,"rating__symbol--hover":this.isHovering&&Math.ceil(t)===n+1,"rating__symbol--active":t>=n+1})}
                role="presentation"
              >
                ${kx(this.getSymbol(n+1))}
              </span>
            `)}
        </span>
      </div>
    `}};Ro.styles=[qi,j8];Ro.dependencies={"sl-icon":kr};J([yi(".rating")],Ro.prototype,"rating",2);J([Hi()],Ro.prototype,"hoverValue",2);J([Hi()],Ro.prototype,"isHovering",2);J([be()],Ro.prototype,"label",2);J([be({type:Number})],Ro.prototype,"value",2);J([be({type:Number})],Ro.prototype,"max",2);J([be({type:Number})],Ro.prototype,"precision",2);J([be({type:Boolean,reflect:!0})],Ro.prototype,"readonly",2);J([be({type:Boolean,reflect:!0})],Ro.prototype,"disabled",2);J([be()],Ro.prototype,"getSymbol",2);J([m0({passive:!0})],Ro.prototype,"handleTouchMove",1);J([hi("hoverValue")],Ro.prototype,"handleHoverValueChange",1);J([hi("isHovering")],Ro.prototype,"handleIsHoveringChange",1);Ro.define("sl-rating");var W8=[{max:276e4,value:6e4,unit:"minute"},{max:72e6,value:36e5,unit:"hour"},{max:5184e5,value:864e5,unit:"day"},{max:24192e5,value:6048e5,unit:"week"},{max:28512e6,value:2592e6,unit:"month"},{max:1/0,value:31536e6,unit:"year"}],Rf=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.isoTime="",this.relativeTime="",this.date=new Date,this.format="long",this.numeric="auto",this.sync=!1}disconnectedCallback(){super.disconnectedCallback(),clearTimeout(this.updateTimeout)}render(){const i=new Date,e=new Date(this.date);if(isNaN(e.getMilliseconds()))return this.relativeTime="",this.isoTime="","";const t=e.getTime()-i.getTime(),{unit:n,value:s}=W8.find(c=>Math.abs(t)<c.max);if(this.isoTime=e.toISOString(),this.relativeTime=this.localize.relativeTime(Math.round(t/s),n,{numeric:this.numeric,style:this.format}),clearTimeout(this.updateTimeout),this.sync){let c;n==="minute"?c=Lv("second"):n==="hour"?c=Lv("minute"):n==="day"?c=Lv("hour"):c=Lv("day"),this.updateTimeout=window.setTimeout(()=>this.requestUpdate(),c)}return ei` <time datetime=${this.isoTime}>${this.relativeTime}</time> `}};J([Hi()],Rf.prototype,"isoTime",2);J([Hi()],Rf.prototype,"relativeTime",2);J([be()],Rf.prototype,"date",2);J([be()],Rf.prototype,"format",2);J([be()],Rf.prototype,"numeric",2);J([be({type:Boolean})],Rf.prototype,"sync",2);function Lv(i){const t={second:1e3,minute:6e4,hour:36e5,day:864e5}[i];return t-Date.now()%t}Rf.define("sl-relative-time");var XO=ji`
  :host {
    display: inline-block;
    position: relative;
    width: auto;
    cursor: pointer;
  }

  .button {
    display: inline-flex;
    align-items: stretch;
    justify-content: center;
    width: 100%;
    border-style: solid;
    border-width: var(--sl-input-border-width);
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-font-weight-semibold);
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
    white-space: nowrap;
    vertical-align: middle;
    padding: 0;
    transition:
      var(--sl-transition-x-fast) background-color,
      var(--sl-transition-x-fast) color,
      var(--sl-transition-x-fast) border,
      var(--sl-transition-x-fast) box-shadow;
    cursor: inherit;
  }

  .button::-moz-focus-inner {
    border: 0;
  }

  .button:focus {
    outline: none;
  }

  .button:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .button--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* When disabled, prevent mouse events from bubbling up from children */
  .button--disabled * {
    pointer-events: none;
  }

  .button__prefix,
  .button__suffix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    pointer-events: none;
  }

  .button__label {
    display: inline-block;
  }

  .button__label::slotted(sl-icon) {
    vertical-align: -2px;
  }

  /*
   * Standard buttons
   */

  /* Default */
  .button--standard.button--default {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-input-border-color);
    color: var(--sl-color-neutral-700);
  }

  .button--standard.button--default:hover:not(.button--disabled) {
    background-color: var(--sl-color-primary-50);
    border-color: var(--sl-color-primary-300);
    color: var(--sl-color-primary-700);
  }

  .button--standard.button--default:active:not(.button--disabled) {
    background-color: var(--sl-color-primary-100);
    border-color: var(--sl-color-primary-400);
    color: var(--sl-color-primary-700);
  }

  /* Primary */
  .button--standard.button--primary {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--primary:hover:not(.button--disabled) {
    background-color: var(--sl-color-primary-500);
    border-color: var(--sl-color-primary-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--primary:active:not(.button--disabled) {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  /* Success */
  .button--standard.button--success {
    background-color: var(--sl-color-success-600);
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--success:hover:not(.button--disabled) {
    background-color: var(--sl-color-success-500);
    border-color: var(--sl-color-success-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--success:active:not(.button--disabled) {
    background-color: var(--sl-color-success-600);
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  /* Neutral */
  .button--standard.button--neutral {
    background-color: var(--sl-color-neutral-600);
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--neutral:hover:not(.button--disabled) {
    background-color: var(--sl-color-neutral-500);
    border-color: var(--sl-color-neutral-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--neutral:active:not(.button--disabled) {
    background-color: var(--sl-color-neutral-600);
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  /* Warning */
  .button--standard.button--warning {
    background-color: var(--sl-color-warning-600);
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }
  .button--standard.button--warning:hover:not(.button--disabled) {
    background-color: var(--sl-color-warning-500);
    border-color: var(--sl-color-warning-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--warning:active:not(.button--disabled) {
    background-color: var(--sl-color-warning-600);
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  /* Danger */
  .button--standard.button--danger {
    background-color: var(--sl-color-danger-600);
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--danger:hover:not(.button--disabled) {
    background-color: var(--sl-color-danger-500);
    border-color: var(--sl-color-danger-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--danger:active:not(.button--disabled) {
    background-color: var(--sl-color-danger-600);
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  /*
   * Outline buttons
   */

  .button--outline {
    background: none;
    border: solid 1px;
  }

  /* Default */
  .button--outline.button--default {
    border-color: var(--sl-input-border-color);
    color: var(--sl-color-neutral-700);
  }

  .button--outline.button--default:hover:not(.button--disabled),
  .button--outline.button--default.button--checked:not(.button--disabled) {
    border-color: var(--sl-color-primary-600);
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--default:active:not(.button--disabled) {
    border-color: var(--sl-color-primary-700);
    background-color: var(--sl-color-primary-700);
    color: var(--sl-color-neutral-0);
  }

  /* Primary */
  .button--outline.button--primary {
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-primary-600);
  }

  .button--outline.button--primary:hover:not(.button--disabled),
  .button--outline.button--primary.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--primary:active:not(.button--disabled) {
    border-color: var(--sl-color-primary-700);
    background-color: var(--sl-color-primary-700);
    color: var(--sl-color-neutral-0);
  }

  /* Success */
  .button--outline.button--success {
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-success-600);
  }

  .button--outline.button--success:hover:not(.button--disabled),
  .button--outline.button--success.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--success:active:not(.button--disabled) {
    border-color: var(--sl-color-success-700);
    background-color: var(--sl-color-success-700);
    color: var(--sl-color-neutral-0);
  }

  /* Neutral */
  .button--outline.button--neutral {
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-600);
  }

  .button--outline.button--neutral:hover:not(.button--disabled),
  .button--outline.button--neutral.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--neutral:active:not(.button--disabled) {
    border-color: var(--sl-color-neutral-700);
    background-color: var(--sl-color-neutral-700);
    color: var(--sl-color-neutral-0);
  }

  /* Warning */
  .button--outline.button--warning {
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-warning-600);
  }

  .button--outline.button--warning:hover:not(.button--disabled),
  .button--outline.button--warning.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--warning:active:not(.button--disabled) {
    border-color: var(--sl-color-warning-700);
    background-color: var(--sl-color-warning-700);
    color: var(--sl-color-neutral-0);
  }

  /* Danger */
  .button--outline.button--danger {
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-danger-600);
  }

  .button--outline.button--danger:hover:not(.button--disabled),
  .button--outline.button--danger.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--danger:active:not(.button--disabled) {
    border-color: var(--sl-color-danger-700);
    background-color: var(--sl-color-danger-700);
    color: var(--sl-color-neutral-0);
  }

  @media (forced-colors: active) {
    .button.button--outline.button--checked:not(.button--disabled) {
      outline: solid 2px transparent;
    }
  }

  /*
   * Text buttons
   */

  .button--text {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-600);
  }

  .button--text:hover:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-500);
  }

  .button--text:focus-visible:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-500);
  }

  .button--text:active:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-700);
  }

  /*
   * Size modifiers
   */

  .button--small {
    height: auto;
    min-height: var(--sl-input-height-small);
    font-size: var(--sl-button-font-size-small);
    line-height: calc(var(--sl-input-height-small) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-small);
  }

  .button--medium {
    height: auto;
    min-height: var(--sl-input-height-medium);
    font-size: var(--sl-button-font-size-medium);
    line-height: calc(var(--sl-input-height-medium) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-medium);
  }

  .button--large {
    height: auto;
    min-height: var(--sl-input-height-large);
    font-size: var(--sl-button-font-size-large);
    line-height: calc(var(--sl-input-height-large) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-large);
  }

  /*
   * Pill modifier
   */

  .button--pill.button--small {
    border-radius: var(--sl-input-height-small);
  }

  .button--pill.button--medium {
    border-radius: var(--sl-input-height-medium);
  }

  .button--pill.button--large {
    border-radius: var(--sl-input-height-large);
  }

  /*
   * Circle modifier
   */

  .button--circle {
    padding-left: 0;
    padding-right: 0;
  }

  .button--circle.button--small {
    width: var(--sl-input-height-small);
    border-radius: 50%;
  }

  .button--circle.button--medium {
    width: var(--sl-input-height-medium);
    border-radius: 50%;
  }

  .button--circle.button--large {
    width: var(--sl-input-height-large);
    border-radius: 50%;
  }

  .button--circle .button__prefix,
  .button--circle .button__suffix,
  .button--circle .button__caret {
    display: none;
  }

  /*
   * Caret modifier
   */

  .button--caret .button__suffix {
    display: none;
  }

  .button--caret .button__caret {
    height: auto;
  }

  /*
   * Loading modifier
   */

  .button--loading {
    position: relative;
    cursor: wait;
  }

  .button--loading .button__prefix,
  .button--loading .button__label,
  .button--loading .button__suffix,
  .button--loading .button__caret {
    visibility: hidden;
  }

  .button--loading sl-spinner {
    --indicator-color: currentColor;
    position: absolute;
    font-size: 1em;
    height: 1em;
    width: 1em;
    top: calc(50% - 0.5em);
    left: calc(50% - 0.5em);
  }

  /*
   * Badges
   */

  .button ::slotted(sl-badge) {
    position: absolute;
    top: 0;
    right: 0;
    translate: 50% -50%;
    pointer-events: none;
  }

  .button--rtl ::slotted(sl-badge) {
    right: auto;
    left: 0;
    translate: -50% -50%;
  }

  /*
   * Button spacing
   */

  .button--has-label.button--small .button__label {
    padding: 0 var(--sl-spacing-small);
  }

  .button--has-label.button--medium .button__label {
    padding: 0 var(--sl-spacing-medium);
  }

  .button--has-label.button--large .button__label {
    padding: 0 var(--sl-spacing-large);
  }

  .button--has-prefix.button--small {
    padding-inline-start: var(--sl-spacing-x-small);
  }

  .button--has-prefix.button--small .button__label {
    padding-inline-start: var(--sl-spacing-x-small);
  }

  .button--has-prefix.button--medium {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--medium .button__label {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--large {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--large .button__label {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-suffix.button--small,
  .button--caret.button--small {
    padding-inline-end: var(--sl-spacing-x-small);
  }

  .button--has-suffix.button--small .button__label,
  .button--caret.button--small .button__label {
    padding-inline-end: var(--sl-spacing-x-small);
  }

  .button--has-suffix.button--medium,
  .button--caret.button--medium {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--medium .button__label,
  .button--caret.button--medium .button__label {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--large,
  .button--caret.button--large {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--large .button__label,
  .button--caret.button--large .button__label {
    padding-inline-end: var(--sl-spacing-small);
  }

  /*
   * Button groups support a variety of button types (e.g. buttons with tooltips, buttons as dropdown triggers, etc.).
   * This means buttons aren't always direct descendants of the button group, thus we can't target them with the
   * ::slotted selector. To work around this, the button group component does some magic to add these special classes to
   * buttons and we style them here instead.
   */

  :host([data-sl-button-group__button--first]:not([data-sl-button-group__button--last])) .button {
    border-start-end-radius: 0;
    border-end-end-radius: 0;
  }

  :host([data-sl-button-group__button--inner]) .button {
    border-radius: 0;
  }

  :host([data-sl-button-group__button--last]:not([data-sl-button-group__button--first])) .button {
    border-start-start-radius: 0;
    border-end-start-radius: 0;
  }

  /* All except the first */
  :host([data-sl-button-group__button]:not([data-sl-button-group__button--first])) {
    margin-inline-start: calc(-1 * var(--sl-input-border-width));
  }

  /* Add a visual separator between solid buttons */
  :host(
      [data-sl-button-group__button]:not(
          [data-sl-button-group__button--first],
          [data-sl-button-group__button--radio],
          [variant='default']
        ):not(:hover)
    )
    .button:after {
    content: '';
    position: absolute;
    top: 0;
    inset-inline-start: 0;
    bottom: 0;
    border-left: solid 1px rgb(128 128 128 / 33%);
    mix-blend-mode: multiply;
  }

  /* Bump hovered, focused, and checked buttons up so their focus ring isn't clipped */
  :host([data-sl-button-group__button--hover]) {
    z-index: 1;
  }

  /* Focus and checked are always on top */
  :host([data-sl-button-group__button--focus]),
  :host([data-sl-button-group__button][checked]) {
    z-index: 2;
  }
`,G8=ji`
  ${XO}

  .button__prefix,
  .button__suffix,
  .button__label {
    display: inline-flex;
    position: relative;
    align-items: center;
  }

  /* We use a hidden input so constraint validation errors work, since they don't appear to show when used with buttons.
    We can't actually hide it, though, otherwise the messages will be suppressed by the browser. */
  .hidden-input {
    all: unset;
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    outline: dotted 1px red;
    opacity: 0;
    z-index: -1;
  }
`,jl=class extends Li{constructor(){super(...arguments),this.hasSlotController=new Uo(this,"[default]","prefix","suffix"),this.hasFocus=!1,this.checked=!1,this.disabled=!1,this.size="medium",this.pill=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","presentation")}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleClick(i){if(this.disabled){i.preventDefault(),i.stopPropagation();return}this.checked=!0}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false")}focus(i){this.input.focus(i)}blur(){this.input.blur()}render(){return Ay`
      <div part="base" role="presentation">
        <button
          part="${`button${this.checked?" button--checked":""}`}"
          role="radio"
          aria-checked="${this.checked}"
          class=${Xi({button:!0,"button--default":!0,"button--small":this.size==="small","button--medium":this.size==="medium","button--large":this.size==="large","button--checked":this.checked,"button--disabled":this.disabled,"button--focused":this.hasFocus,"button--outline":!0,"button--pill":this.pill,"button--has-label":this.hasSlotController.test("[default]"),"button--has-prefix":this.hasSlotController.test("prefix"),"button--has-suffix":this.hasSlotController.test("suffix")})}
          aria-disabled=${this.disabled}
          type="button"
          value=${Fi(this.value)}
          @blur=${this.handleBlur}
          @focus=${this.handleFocus}
          @click=${this.handleClick}
        >
          <slot name="prefix" part="prefix" class="button__prefix"></slot>
          <slot part="label" class="button__label"></slot>
          <slot name="suffix" part="suffix" class="button__suffix"></slot>
        </button>
      </div>
    `}};jl.styles=[qi,G8];J([yi(".button")],jl.prototype,"input",2);J([yi(".hidden-input")],jl.prototype,"hiddenInput",2);J([Hi()],jl.prototype,"hasFocus",2);J([be({type:Boolean,reflect:!0})],jl.prototype,"checked",2);J([be()],jl.prototype,"value",2);J([be({type:Boolean,reflect:!0})],jl.prototype,"disabled",2);J([be({reflect:!0})],jl.prototype,"size",2);J([be({type:Boolean,reflect:!0})],jl.prototype,"pill",2);J([hi("disabled",{waitUntilFirstUpdate:!0})],jl.prototype,"handleDisabledChange",1);jl.define("sl-radio-button");var X8=ji`
  :host {
    display: block;
  }

  .form-control {
    position: relative;
    border: none;
    padding: 0;
    margin: 0;
  }

  .form-control__label {
    padding: 0;
  }

  .radio-group--required .radio-group__label::after {
    content: var(--sl-input-required-content);
    margin-inline-start: var(--sl-input-required-content-offset);
  }

  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
`,q8=ji`
  :host {
    display: inline-block;
  }

  .button-group {
    display: flex;
    flex-wrap: nowrap;
  }
`,kf=class extends Li{constructor(){super(...arguments),this.disableRole=!1,this.label=""}handleFocus(i){const e=Z_(i.target);e==null||e.toggleAttribute("data-sl-button-group__button--focus",!0)}handleBlur(i){const e=Z_(i.target);e==null||e.toggleAttribute("data-sl-button-group__button--focus",!1)}handleMouseOver(i){const e=Z_(i.target);e==null||e.toggleAttribute("data-sl-button-group__button--hover",!0)}handleMouseOut(i){const e=Z_(i.target);e==null||e.toggleAttribute("data-sl-button-group__button--hover",!1)}handleSlotChange(){const i=[...this.defaultSlot.assignedElements({flatten:!0})];i.forEach(e=>{const t=i.indexOf(e),n=Z_(e);n&&(n.toggleAttribute("data-sl-button-group__button",!0),n.toggleAttribute("data-sl-button-group__button--first",t===0),n.toggleAttribute("data-sl-button-group__button--inner",t>0&&t<i.length-1),n.toggleAttribute("data-sl-button-group__button--last",t===i.length-1),n.toggleAttribute("data-sl-button-group__button--radio",n.tagName.toLowerCase()==="sl-radio-button"))})}render(){return ei`
      <div
        part="base"
        class="button-group"
        role="${this.disableRole?"presentation":"group"}"
        aria-label=${this.label}
        @focusout=${this.handleBlur}
        @focusin=${this.handleFocus}
        @mouseover=${this.handleMouseOver}
        @mouseout=${this.handleMouseOut}
      >
        <slot @slotchange=${this.handleSlotChange}></slot>
      </div>
    `}};kf.styles=[qi,q8];J([yi("slot")],kf.prototype,"defaultSlot",2);J([Hi()],kf.prototype,"disableRole",2);J([be()],kf.prototype,"label",2);function Z_(i){var e;const t="sl-button, sl-radio-button";return(e=i.closest(t))!=null?e:i.querySelector(t)}var fo=class extends Li{constructor(){super(...arguments),this.formControlController=new Ch(this),this.hasSlotController=new Uo(this,"help-text","label"),this.customValidityMessage="",this.hasButtonGroup=!1,this.errorMessage="",this.defaultValue="",this.label="",this.helpText="",this.name="option",this.value="",this.size="medium",this.form="",this.required=!1}get validity(){const i=this.required&&!this.value;return this.customValidityMessage!==""?WU:i?HU:uw}get validationMessage(){const i=this.required&&!this.value;return this.customValidityMessage!==""?this.customValidityMessage:i?this.validationInput.validationMessage:""}connectedCallback(){super.connectedCallback(),this.defaultValue=this.value}firstUpdated(){this.formControlController.updateValidity()}getAllRadios(){return[...this.querySelectorAll("sl-radio, sl-radio-button")]}handleRadioClick(i){const e=i.target.closest("sl-radio, sl-radio-button"),t=this.getAllRadios(),n=this.value;!e||e.disabled||(this.value=e.value,t.forEach(s=>s.checked=s===e),this.value!==n&&(this.emit("sl-change"),this.emit("sl-input")))}handleKeyDown(i){var e;if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(i.key))return;const t=this.getAllRadios().filter(r=>!r.disabled),n=(e=t.find(r=>r.checked))!=null?e:t[0],s=i.key===" "?0:["ArrowUp","ArrowLeft"].includes(i.key)?-1:1,c=this.value;let f=t.indexOf(n)+s;f<0&&(f=t.length-1),f>t.length-1&&(f=0),this.getAllRadios().forEach(r=>{r.checked=!1,this.hasButtonGroup||r.setAttribute("tabindex","-1")}),this.value=t[f].value,t[f].checked=!0,this.hasButtonGroup?t[f].shadowRoot.querySelector("button").focus():(t[f].setAttribute("tabindex","0"),t[f].focus()),this.value!==c&&(this.emit("sl-change"),this.emit("sl-input")),i.preventDefault()}handleLabelClick(){this.focus()}handleInvalid(i){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(i)}async syncRadioElements(){var i,e;const t=this.getAllRadios();if(await Promise.all(t.map(async n=>{await n.updateComplete,n.checked=n.value===this.value,n.size=this.size})),this.hasButtonGroup=t.some(n=>n.tagName.toLowerCase()==="sl-radio-button"),t.length>0&&!t.some(n=>n.checked))if(this.hasButtonGroup){const n=(i=t[0].shadowRoot)==null?void 0:i.querySelector("button");n&&n.setAttribute("tabindex","0")}else t[0].setAttribute("tabindex","0");if(this.hasButtonGroup){const n=(e=this.shadowRoot)==null?void 0:e.querySelector("sl-button-group");n&&(n.disableRole=!0)}}syncRadios(){if(customElements.get("sl-radio")&&customElements.get("sl-radio-button")){this.syncRadioElements();return}customElements.get("sl-radio")?this.syncRadioElements():customElements.whenDefined("sl-radio").then(()=>this.syncRadios()),customElements.get("sl-radio-button")?this.syncRadioElements():customElements.whenDefined("sl-radio-button").then(()=>this.syncRadios())}updateCheckedRadio(){this.getAllRadios().forEach(e=>e.checked=e.value===this.value),this.formControlController.setValidity(this.validity.valid)}handleSizeChange(){this.syncRadios()}handleValueChange(){this.hasUpdated&&this.updateCheckedRadio()}checkValidity(){const i=this.required&&!this.value,e=this.customValidityMessage!=="";return i||e?(this.formControlController.emitInvalidEvent(),!1):!0}getForm(){return this.formControlController.getForm()}reportValidity(){const i=this.validity.valid;return this.errorMessage=this.customValidityMessage||i?"":this.validationInput.validationMessage,this.formControlController.setValidity(i),this.validationInput.hidden=!0,clearTimeout(this.validationTimeout),i||(this.validationInput.hidden=!1,this.validationInput.reportValidity(),this.validationTimeout=setTimeout(()=>this.validationInput.hidden=!0,1e4)),i}setCustomValidity(i=""){this.customValidityMessage=i,this.errorMessage=i,this.validationInput.setCustomValidity(i),this.formControlController.updateValidity()}focus(i){const e=this.getAllRadios(),t=e.find(c=>c.checked),n=e.find(c=>!c.disabled),s=t||n;s&&s.focus(i)}render(){const i=this.hasSlotController.test("label"),e=this.hasSlotController.test("help-text"),t=this.label?!0:!!i,n=this.helpText?!0:!!e,s=ei`
      <slot @slotchange=${this.syncRadios} @click=${this.handleRadioClick} @keydown=${this.handleKeyDown}></slot>
    `;return ei`
      <fieldset
        part="form-control"
        class=${Xi({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--radio-group":!0,"form-control--has-label":t,"form-control--has-help-text":n})}
        role="radiogroup"
        aria-labelledby="label"
        aria-describedby="help-text"
        aria-errormessage="error-message"
      >
        <label
          part="form-control-label"
          id="label"
          class="form-control__label"
          aria-hidden=${t?"false":"true"}
          @click=${this.handleLabelClick}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <div part="form-control-input" class="form-control-input">
          <div class="visually-hidden">
            <div id="error-message" aria-live="assertive">${this.errorMessage}</div>
            <label class="radio-group__validation">
              <input
                type="text"
                class="radio-group__validation-input"
                ?required=${this.required}
                tabindex="-1"
                hidden
                @invalid=${this.handleInvalid}
              />
            </label>
          </div>

          ${this.hasButtonGroup?ei`
                <sl-button-group part="button-group" exportparts="base:button-group__base" role="presentation">
                  ${s}
                </sl-button-group>
              `:s}
        </div>

        <div
          part="form-control-help-text"
          id="help-text"
          class="form-control__help-text"
          aria-hidden=${n?"false":"true"}
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </fieldset>
    `}};fo.styles=[qi,If,X8];fo.dependencies={"sl-button-group":kf};J([yi("slot:not([name])")],fo.prototype,"defaultSlot",2);J([yi(".radio-group__validation-input")],fo.prototype,"validationInput",2);J([Hi()],fo.prototype,"hasButtonGroup",2);J([Hi()],fo.prototype,"errorMessage",2);J([Hi()],fo.prototype,"defaultValue",2);J([be()],fo.prototype,"label",2);J([be({attribute:"help-text"})],fo.prototype,"helpText",2);J([be()],fo.prototype,"name",2);J([be({reflect:!0})],fo.prototype,"value",2);J([be({reflect:!0})],fo.prototype,"size",2);J([be({reflect:!0})],fo.prototype,"form",2);J([be({type:Boolean,reflect:!0})],fo.prototype,"required",2);J([hi("size",{waitUntilFirstUpdate:!0})],fo.prototype,"handleSizeChange",1);J([hi("value")],fo.prototype,"handleValueChange",1);fo.define("sl-radio-group");var Y8=ji`
  :host {
    --size: 128px;
    --track-width: 4px;
    --track-color: var(--sl-color-neutral-200);
    --indicator-width: var(--track-width);
    --indicator-color: var(--sl-color-primary-600);
    --indicator-transition-duration: 0.35s;

    display: inline-flex;
  }

  .progress-ring {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .progress-ring__image {
    width: var(--size);
    height: var(--size);
    rotate: -90deg;
    transform-origin: 50% 50%;
  }

  .progress-ring__track,
  .progress-ring__indicator {
    --radius: calc(var(--size) / 2 - max(var(--track-width), var(--indicator-width)) * 0.5);
    --circumference: calc(var(--radius) * 2 * 3.141592654);

    fill: none;
    r: var(--radius);
    cx: calc(var(--size) / 2);
    cy: calc(var(--size) / 2);
  }

  .progress-ring__track {
    stroke: var(--track-color);
    stroke-width: var(--track-width);
  }

  .progress-ring__indicator {
    stroke: var(--indicator-color);
    stroke-width: var(--indicator-width);
    stroke-linecap: round;
    transition-property: stroke-dashoffset;
    transition-duration: var(--indicator-transition-duration);
    stroke-dasharray: var(--circumference) var(--circumference);
    stroke-dashoffset: calc(var(--circumference) - var(--percentage) * var(--circumference));
  }

  .progress-ring__label {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    text-align: center;
    user-select: none;
    -webkit-user-select: none;
  }
`,qm=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.value=0,this.label=""}updated(i){if(super.updated(i),i.has("value")){const e=parseFloat(getComputedStyle(this.indicator).getPropertyValue("r")),t=2*Math.PI*e,n=t-this.value/100*t;this.indicatorOffset=`${n}px`}}render(){return ei`
      <div
        part="base"
        class="progress-ring"
        role="progressbar"
        aria-label=${this.label.length>0?this.label:this.localize.term("progress")}
        aria-describedby="label"
        aria-valuemin="0"
        aria-valuemax="100"
        aria-valuenow="${this.value}"
        style="--percentage: ${this.value/100}"
      >
        <svg class="progress-ring__image">
          <circle class="progress-ring__track"></circle>
          <circle class="progress-ring__indicator" style="stroke-dashoffset: ${this.indicatorOffset}"></circle>
        </svg>

        <slot id="label" part="label" class="progress-ring__label"></slot>
      </div>
    `}};qm.styles=[qi,Y8];J([yi(".progress-ring__indicator")],qm.prototype,"indicator",2);J([Hi()],qm.prototype,"indicatorOffset",2);J([be({type:Number,reflect:!0})],qm.prototype,"value",2);J([be()],qm.prototype,"label",2);qm.define("sl-progress-ring");var Z8=ji`
  :host {
    display: inline-block;
  }
`;let qO=null,YO=class{};YO.render=function(i,e){qO(i,e)};self.QrCreator=YO;(function(i){function e(r,b,w,E){var k={},F=i(w,b);F.u(r),F.J(),E=E||0;var $=F.h(),X=F.h()+2*E;return k.text=r,k.level=b,k.version=w,k.O=X,k.a=function(W,ne){return W-=E,ne-=E,0>W||W>=$||0>ne||ne>=$?!1:F.a(W,ne)},k}function t(r,b,w,E,k,F,$,X,W,ne){function _e(Te,we,Ee,Le,Je,Tt,_t){Te?(r.lineTo(we+Tt,Ee+_t),r.arcTo(we,Ee,Le,Je,F)):r.lineTo(we,Ee)}$?r.moveTo(b+F,w):r.moveTo(b,w),_e(X,E,w,E,k,-F,0),_e(W,E,k,b,k,0,-F),_e(ne,b,k,b,w,F,0),_e($,b,w,E,w,0,F)}function n(r,b,w,E,k,F,$,X,W,ne){function _e(Te,we,Ee,Le){r.moveTo(Te+Ee,we),r.lineTo(Te,we),r.lineTo(Te,we+Le),r.arcTo(Te,we,Te+Ee,we,F)}$&&_e(b,w,F,F),X&&_e(E,w,-F,F),W&&_e(E,k,-F,-F),ne&&_e(b,k,F,-F)}function s(r,b){var w=b.fill;if(typeof w=="string")r.fillStyle=w;else{var E=w.type,k=w.colorStops;if(w=w.position.map($=>Math.round($*b.size)),E==="linear-gradient")var F=r.createLinearGradient.apply(r,w);else if(E==="radial-gradient")F=r.createRadialGradient.apply(r,w);else throw Error("Unsupported fill");k.forEach(([$,X])=>{F.addColorStop($,X)}),r.fillStyle=F}}function c(r,b){e:{var w=b.text,E=b.v,k=b.N,F=b.K,$=b.P;for(k=Math.max(1,k||1),F=Math.min(40,F||40);k<=F;k+=1)try{var X=e(w,E,k,$);break e}catch{}X=void 0}if(!X)return null;for(w=r.getContext("2d"),b.background&&(w.fillStyle=b.background,w.fillRect(b.left,b.top,b.size,b.size)),E=X.O,F=b.size/E,w.beginPath(),$=0;$<E;$+=1)for(k=0;k<E;k+=1){var W=w,ne=b.left+k*F,_e=b.top+$*F,Te=$,we=k,Ee=X.a,Le=ne+F,Je=_e+F,Tt=Te-1,_t=Te+1,St=we-1,kt=we+1,Lt=Math.floor(Math.min(.5,Math.max(0,b.R))*F),si=Ee(Te,we),bi=Ee(Tt,St),ii=Ee(Tt,we);Tt=Ee(Tt,kt);var vi=Ee(Te,kt);kt=Ee(_t,kt),we=Ee(_t,we),_t=Ee(_t,St),Te=Ee(Te,St),ne=Math.round(ne),_e=Math.round(_e),Le=Math.round(Le),Je=Math.round(Je),si?t(W,ne,_e,Le,Je,Lt,!ii&&!Te,!ii&&!vi,!we&&!vi,!we&&!Te):n(W,ne,_e,Le,Je,Lt,ii&&Te&&bi,ii&&vi&&Tt,we&&vi&&kt,we&&Te&&_t)}return s(w,b),w.fill(),r}var f={minVersion:1,maxVersion:40,ecLevel:"L",left:0,top:0,size:200,fill:"#000",background:null,text:"no text",radius:.5,quiet:0};qO=function(r,b){var w={};Object.assign(w,f,r),w.N=w.minVersion,w.K=w.maxVersion,w.v=w.ecLevel,w.left=w.left,w.top=w.top,w.size=w.size,w.fill=w.fill,w.background=w.background,w.text=w.text,w.R=w.radius,w.P=w.quiet,b instanceof HTMLCanvasElement?((b.width!==w.size||b.height!==w.size)&&(b.width=w.size,b.height=w.size),b.getContext("2d").clearRect(0,0,b.width,b.height),c(b,w)):(r=document.createElement("canvas"),r.width=w.size,r.height=w.size,w=c(r,w),b.appendChild(w))}})(function(){function i(b){var w=t.s(b);return{S:function(){return 4},b:function(){return w.length},write:function(E){for(var k=0;k<w.length;k+=1)E.put(w[k],8)}}}function e(){var b=[],w=0,E={B:function(){return b},c:function(k){return(b[Math.floor(k/8)]>>>7-k%8&1)==1},put:function(k,F){for(var $=0;$<F;$+=1)E.m((k>>>F-$-1&1)==1)},f:function(){return w},m:function(k){var F=Math.floor(w/8);b.length<=F&&b.push(0),k&&(b[F]|=128>>>w%8),w+=1}};return E}function t(b,w){function E(Te,we){for(var Ee=-1;7>=Ee;Ee+=1)if(!(-1>=Te+Ee||X<=Te+Ee))for(var Le=-1;7>=Le;Le+=1)-1>=we+Le||X<=we+Le||($[Te+Ee][we+Le]=0<=Ee&&6>=Ee&&(Le==0||Le==6)||0<=Le&&6>=Le&&(Ee==0||Ee==6)||2<=Ee&&4>=Ee&&2<=Le&&4>=Le)}function k(Te,we){for(var Ee=X=4*b+17,Le=Array(Ee),Je=0;Je<Ee;Je+=1){Le[Je]=Array(Ee);for(var Tt=0;Tt<Ee;Tt+=1)Le[Je][Tt]=null}for($=Le,E(0,0),E(X-7,0),E(0,X-7),Ee=c.G(b),Le=0;Le<Ee.length;Le+=1)for(Je=0;Je<Ee.length;Je+=1){Tt=Ee[Le];var _t=Ee[Je];if($[Tt][_t]==null)for(var St=-2;2>=St;St+=1)for(var kt=-2;2>=kt;kt+=1)$[Tt+St][_t+kt]=St==-2||St==2||kt==-2||kt==2||St==0&&kt==0}for(Ee=8;Ee<X-8;Ee+=1)$[Ee][6]==null&&($[Ee][6]=Ee%2==0);for(Ee=8;Ee<X-8;Ee+=1)$[6][Ee]==null&&($[6][Ee]=Ee%2==0);for(Ee=c.w(F<<3|we),Le=0;15>Le;Le+=1)Je=!Te&&(Ee>>Le&1)==1,$[6>Le?Le:8>Le?Le+1:X-15+Le][8]=Je,$[8][8>Le?X-Le-1:9>Le?15-Le:14-Le]=Je;if($[X-8][8]=!Te,7<=b){for(Ee=c.A(b),Le=0;18>Le;Le+=1)Je=!Te&&(Ee>>Le&1)==1,$[Math.floor(Le/3)][Le%3+X-8-3]=Je;for(Le=0;18>Le;Le+=1)Je=!Te&&(Ee>>Le&1)==1,$[Le%3+X-8-3][Math.floor(Le/3)]=Je}if(W==null){for(Te=r.I(b,F),Ee=e(),Le=0;Le<ne.length;Le+=1)Je=ne[Le],Ee.put(4,4),Ee.put(Je.b(),c.f(4,b)),Je.write(Ee);for(Le=Je=0;Le<Te.length;Le+=1)Je+=Te[Le].j;if(Ee.f()>8*Je)throw Error("code length overflow. ("+Ee.f()+">"+8*Je+")");for(Ee.f()+4<=8*Je&&Ee.put(0,4);Ee.f()%8!=0;)Ee.m(!1);for(;!(Ee.f()>=8*Je)&&(Ee.put(236,8),!(Ee.f()>=8*Je));)Ee.put(17,8);var Lt=0;for(Je=Le=0,Tt=Array(Te.length),_t=Array(Te.length),St=0;St<Te.length;St+=1){var si=Te[St].j,bi=Te[St].o-si;for(Le=Math.max(Le,si),Je=Math.max(Je,bi),Tt[St]=Array(si),kt=0;kt<Tt[St].length;kt+=1)Tt[St][kt]=255&Ee.B()[kt+Lt];for(Lt+=si,kt=c.C(bi),si=n(Tt[St],kt.b()-1).l(kt),_t[St]=Array(kt.b()-1),kt=0;kt<_t[St].length;kt+=1)bi=kt+si.b()-_t[St].length,_t[St][kt]=0<=bi?si.c(bi):0}for(kt=Ee=0;kt<Te.length;kt+=1)Ee+=Te[kt].o;for(Ee=Array(Ee),kt=Lt=0;kt<Le;kt+=1)for(St=0;St<Te.length;St+=1)kt<Tt[St].length&&(Ee[Lt]=Tt[St][kt],Lt+=1);for(kt=0;kt<Je;kt+=1)for(St=0;St<Te.length;St+=1)kt<_t[St].length&&(Ee[Lt]=_t[St][kt],Lt+=1);W=Ee}for(Te=W,Ee=-1,Le=X-1,Je=7,Tt=0,we=c.F(we),_t=X-1;0<_t;_t-=2)for(_t==6&&--_t;;){for(St=0;2>St;St+=1)$[Le][_t-St]==null&&(kt=!1,Tt<Te.length&&(kt=(Te[Tt]>>>Je&1)==1),we(Le,_t-St)&&(kt=!kt),$[Le][_t-St]=kt,--Je,Je==-1&&(Tt+=1,Je=7));if(Le+=Ee,0>Le||X<=Le){Le-=Ee,Ee=-Ee;break}}}var F=s[w],$=null,X=0,W=null,ne=[],_e={u:function(Te){Te=i(Te),ne.push(Te),W=null},a:function(Te,we){if(0>Te||X<=Te||0>we||X<=we)throw Error(Te+","+we);return $[Te][we]},h:function(){return X},J:function(){for(var Te=0,we=0,Ee=0;8>Ee;Ee+=1){k(!0,Ee);var Le=c.D(_e);(Ee==0||Te>Le)&&(Te=Le,we=Ee)}k(!1,we)}};return _e}function n(b,w){if(typeof b.length>"u")throw Error(b.length+"/"+w);var E=function(){for(var F=0;F<b.length&&b[F]==0;)F+=1;for(var $=Array(b.length-F+w),X=0;X<b.length-F;X+=1)$[X]=b[X+F];return $}(),k={c:function(F){return E[F]},b:function(){return E.length},multiply:function(F){for(var $=Array(k.b()+F.b()-1),X=0;X<k.b();X+=1)for(var W=0;W<F.b();W+=1)$[X+W]^=f.i(f.g(k.c(X))+f.g(F.c(W)));return n($,0)},l:function(F){if(0>k.b()-F.b())return k;for(var $=f.g(k.c(0))-f.g(F.c(0)),X=Array(k.b()),W=0;W<k.b();W+=1)X[W]=k.c(W);for(W=0;W<F.b();W+=1)X[W]^=f.i(f.g(F.c(W))+$);return n(X,0).l(F)}};return k}t.s=function(b){for(var w=[],E=0;E<b.length;E++){var k=b.charCodeAt(E);128>k?w.push(k):2048>k?w.push(192|k>>6,128|k&63):55296>k||57344<=k?w.push(224|k>>12,128|k>>6&63,128|k&63):(E++,k=65536+((k&1023)<<10|b.charCodeAt(E)&1023),w.push(240|k>>18,128|k>>12&63,128|k>>6&63,128|k&63))}return w};var s={L:1,M:0,Q:3,H:2},c=function(){function b(k){for(var F=0;k!=0;)F+=1,k>>>=1;return F}var w=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],E={w:function(k){for(var F=k<<10;0<=b(F)-b(1335);)F^=1335<<b(F)-b(1335);return(k<<10|F)^21522},A:function(k){for(var F=k<<12;0<=b(F)-b(7973);)F^=7973<<b(F)-b(7973);return k<<12|F},G:function(k){return w[k-1]},F:function(k){switch(k){case 0:return function(F,$){return(F+$)%2==0};case 1:return function(F){return F%2==0};case 2:return function(F,$){return $%3==0};case 3:return function(F,$){return(F+$)%3==0};case 4:return function(F,$){return(Math.floor(F/2)+Math.floor($/3))%2==0};case 5:return function(F,$){return F*$%2+F*$%3==0};case 6:return function(F,$){return(F*$%2+F*$%3)%2==0};case 7:return function(F,$){return(F*$%3+(F+$)%2)%2==0};default:throw Error("bad maskPattern:"+k)}},C:function(k){for(var F=n([1],0),$=0;$<k;$+=1)F=F.multiply(n([1,f.i($)],0));return F},f:function(k,F){if(k!=4||1>F||40<F)throw Error("mode: "+k+"; type: "+F);return 10>F?8:16},D:function(k){for(var F=k.h(),$=0,X=0;X<F;X+=1)for(var W=0;W<F;W+=1){for(var ne=0,_e=k.a(X,W),Te=-1;1>=Te;Te+=1)if(!(0>X+Te||F<=X+Te))for(var we=-1;1>=we;we+=1)0>W+we||F<=W+we||(Te!=0||we!=0)&&_e==k.a(X+Te,W+we)&&(ne+=1);5<ne&&($+=3+ne-5)}for(X=0;X<F-1;X+=1)for(W=0;W<F-1;W+=1)ne=0,k.a(X,W)&&(ne+=1),k.a(X+1,W)&&(ne+=1),k.a(X,W+1)&&(ne+=1),k.a(X+1,W+1)&&(ne+=1),(ne==0||ne==4)&&($+=3);for(X=0;X<F;X+=1)for(W=0;W<F-6;W+=1)k.a(X,W)&&!k.a(X,W+1)&&k.a(X,W+2)&&k.a(X,W+3)&&k.a(X,W+4)&&!k.a(X,W+5)&&k.a(X,W+6)&&($+=40);for(W=0;W<F;W+=1)for(X=0;X<F-6;X+=1)k.a(X,W)&&!k.a(X+1,W)&&k.a(X+2,W)&&k.a(X+3,W)&&k.a(X+4,W)&&!k.a(X+5,W)&&k.a(X+6,W)&&($+=40);for(W=ne=0;W<F;W+=1)for(X=0;X<F;X+=1)k.a(X,W)&&(ne+=1);return $+=Math.abs(100*ne/F/F-50)/5*10}};return E}(),f=function(){for(var b=Array(256),w=Array(256),E=0;8>E;E+=1)b[E]=1<<E;for(E=8;256>E;E+=1)b[E]=b[E-4]^b[E-5]^b[E-6]^b[E-8];for(E=0;255>E;E+=1)w[b[E]]=E;return{g:function(k){if(1>k)throw Error("glog("+k+")");return w[k]},i:function(k){for(;0>k;)k+=255;for(;256<=k;)k-=255;return b[k]}}}(),r=function(){function b(k,F){switch(F){case s.L:return w[4*(k-1)];case s.M:return w[4*(k-1)+1];case s.Q:return w[4*(k-1)+2];case s.H:return w[4*(k-1)+3]}}var w=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],E={I:function(k,F){var $=b(k,F);if(typeof $>"u")throw Error("bad rs block @ typeNumber:"+k+"/errorCorrectLevel:"+F);k=$.length/3,F=[];for(var X=0;X<k;X+=1)for(var W=$[3*X],ne=$[3*X+1],_e=$[3*X+2],Te=0;Te<W;Te+=1){var we=_e,Ee={};Ee.o=ne,Ee.j=we,F.push(Ee)}return F}};return E}();return t}());const K8=QrCreator;var Hl=class extends Li{constructor(){super(...arguments),this.value="",this.label="",this.size=128,this.fill="black",this.background="white",this.radius=0,this.errorCorrection="H"}firstUpdated(){this.generate()}generate(){this.hasUpdated&&K8.render({text:this.value,radius:this.radius,ecLevel:this.errorCorrection,fill:this.fill,background:this.background,size:this.size*2},this.canvas)}render(){var i;return ei`
      <canvas
        part="base"
        class="qr-code"
        role="img"
        aria-label=${((i=this.label)==null?void 0:i.length)>0?this.label:this.value}
        style=${Qo({width:`${this.size}px`,height:`${this.size}px`})}
      ></canvas>
    `}};Hl.styles=[qi,Z8];J([yi("canvas")],Hl.prototype,"canvas",2);J([be()],Hl.prototype,"value",2);J([be()],Hl.prototype,"label",2);J([be({type:Number})],Hl.prototype,"size",2);J([be()],Hl.prototype,"fill",2);J([be()],Hl.prototype,"background",2);J([be({type:Number})],Hl.prototype,"radius",2);J([be({attribute:"error-correction"})],Hl.prototype,"errorCorrection",2);J([hi(["background","errorCorrection","fill","radius","size","value"])],Hl.prototype,"generate",1);Hl.define("sl-qr-code");var J8=ji`
  :host {
    display: block;
  }

  :host(:focus-visible) {
    outline: 0px;
  }

  .radio {
    display: inline-flex;
    align-items: top;
    font-family: var(--sl-input-font-family);
    font-size: var(--sl-input-font-size-medium);
    font-weight: var(--sl-input-font-weight);
    color: var(--sl-input-label-color);
    vertical-align: middle;
    cursor: pointer;
  }

  .radio--small {
    --toggle-size: var(--sl-toggle-size-small);
    font-size: var(--sl-input-font-size-small);
  }

  .radio--medium {
    --toggle-size: var(--sl-toggle-size-medium);
    font-size: var(--sl-input-font-size-medium);
  }

  .radio--large {
    --toggle-size: var(--sl-toggle-size-large);
    font-size: var(--sl-input-font-size-large);
  }

  .radio__checked-icon {
    display: inline-flex;
    width: var(--toggle-size);
    height: var(--toggle-size);
  }

  .radio__control {
    flex: 0 0 auto;
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--toggle-size);
    height: var(--toggle-size);
    border: solid var(--sl-input-border-width) var(--sl-input-border-color);
    border-radius: 50%;
    background-color: var(--sl-input-background-color);
    color: transparent;
    transition:
      var(--sl-transition-fast) border-color,
      var(--sl-transition-fast) background-color,
      var(--sl-transition-fast) color,
      var(--sl-transition-fast) box-shadow;
  }

  .radio__input {
    position: absolute;
    opacity: 0;
    padding: 0;
    margin: 0;
    pointer-events: none;
  }

  /* Hover */
  .radio:not(.radio--checked):not(.radio--disabled) .radio__control:hover {
    border-color: var(--sl-input-border-color-hover);
    background-color: var(--sl-input-background-color-hover);
  }

  /* Checked */
  .radio--checked .radio__control {
    color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-primary-600);
    background-color: var(--sl-color-primary-600);
  }

  /* Checked + hover */
  .radio.radio--checked:not(.radio--disabled) .radio__control:hover {
    border-color: var(--sl-color-primary-500);
    background-color: var(--sl-color-primary-500);
  }

  /* Checked + focus */
  :host(:focus-visible) .radio__control {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  /* Disabled */
  .radio--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* When the control isn't checked, hide the circle for Windows High Contrast mode a11y */
  .radio:not(.radio--checked) svg circle {
    opacity: 0;
  }

  .radio__label {
    display: inline-block;
    color: var(--sl-input-label-color);
    line-height: var(--toggle-size);
    margin-inline-start: 0.5em;
    user-select: none;
    -webkit-user-select: none;
  }
`,Dc=class extends Li{constructor(){super(),this.checked=!1,this.hasFocus=!1,this.size="medium",this.disabled=!1,this.handleBlur=()=>{this.hasFocus=!1,this.emit("sl-blur")},this.handleClick=()=>{this.disabled||(this.checked=!0)},this.handleFocus=()=>{this.hasFocus=!0,this.emit("sl-focus")},this.addEventListener("blur",this.handleBlur),this.addEventListener("click",this.handleClick),this.addEventListener("focus",this.handleFocus)}connectedCallback(){super.connectedCallback(),this.setInitialAttributes()}setInitialAttributes(){this.setAttribute("role","radio"),this.setAttribute("tabindex","-1"),this.setAttribute("aria-disabled",this.disabled?"true":"false")}handleCheckedChange(){this.setAttribute("aria-checked",this.checked?"true":"false"),this.setAttribute("tabindex",this.checked?"0":"-1")}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false")}render(){return ei`
      <span
        part="base"
        class=${Xi({radio:!0,"radio--checked":this.checked,"radio--disabled":this.disabled,"radio--focused":this.hasFocus,"radio--small":this.size==="small","radio--medium":this.size==="medium","radio--large":this.size==="large"})}
      >
        <span part="${`control${this.checked?" control--checked":""}`}" class="radio__control">
          ${this.checked?ei` <sl-icon part="checked-icon" class="radio__checked-icon" library="system" name="radio"></sl-icon> `:""}
        </span>

        <slot part="label" class="radio__label"></slot>
      </span>
    `}};Dc.styles=[qi,J8];Dc.dependencies={"sl-icon":kr};J([Hi()],Dc.prototype,"checked",2);J([Hi()],Dc.prototype,"hasFocus",2);J([be()],Dc.prototype,"value",2);J([be({reflect:!0})],Dc.prototype,"size",2);J([be({type:Boolean,reflect:!0})],Dc.prototype,"disabled",2);J([hi("checked")],Dc.prototype,"handleCheckedChange",1);J([hi("disabled",{waitUntilFirstUpdate:!0})],Dc.prototype,"handleDisabledChange",1);Dc.define("sl-radio");var Q8=ji`
  :host {
    display: block;
    user-select: none;
    -webkit-user-select: none;
  }

  :host(:focus) {
    outline: none;
  }

  .option {
    position: relative;
    display: flex;
    align-items: center;
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    line-height: var(--sl-line-height-normal);
    letter-spacing: var(--sl-letter-spacing-normal);
    color: var(--sl-color-neutral-700);
    padding: var(--sl-spacing-x-small) var(--sl-spacing-medium) var(--sl-spacing-x-small) var(--sl-spacing-x-small);
    transition: var(--sl-transition-fast) fill;
    cursor: pointer;
  }

  .option--hover:not(.option--current):not(.option--disabled) {
    background-color: var(--sl-color-neutral-100);
    color: var(--sl-color-neutral-1000);
  }

  .option--current,
  .option--current.option--disabled {
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
    opacity: 1;
  }

  .option--disabled {
    outline: none;
    opacity: 0.5;
    cursor: not-allowed;
  }

  .option__label {
    flex: 1 1 auto;
    display: inline-block;
    line-height: var(--sl-line-height-dense);
  }

  .option .option__check {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    visibility: hidden;
    padding-inline-end: var(--sl-spacing-2x-small);
  }

  .option--selected .option__check {
    visibility: visible;
  }

  .option__prefix,
  .option__suffix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
  }

  .option__prefix::slotted(*) {
    margin-inline-end: var(--sl-spacing-x-small);
  }

  .option__suffix::slotted(*) {
    margin-inline-start: var(--sl-spacing-x-small);
  }

  @media (forced-colors: active) {
    :host(:hover:not([aria-disabled='true'])) .option {
      outline: dashed 1px SelectedItem;
      outline-offset: -1px;
    }
  }
`,dl=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.isInitialized=!1,this.current=!1,this.selected=!1,this.hasHover=!1,this.value="",this.disabled=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","option"),this.setAttribute("aria-selected","false")}handleDefaultSlotChange(){this.isInitialized?customElements.whenDefined("sl-select").then(()=>{const i=this.closest("sl-select");i&&i.handleDefaultSlotChange()}):this.isInitialized=!0}handleMouseEnter(){this.hasHover=!0}handleMouseLeave(){this.hasHover=!1}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false")}handleSelectedChange(){this.setAttribute("aria-selected",this.selected?"true":"false")}handleValueChange(){typeof this.value!="string"&&(this.value=String(this.value)),this.value.includes(" ")&&(console.error("Option values cannot include a space. All spaces have been replaced with underscores.",this),this.value=this.value.replace(/ /g,"_"))}getTextLabel(){const i=this.childNodes;let e="";return[...i].forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&(t.hasAttribute("slot")||(e+=t.textContent)),t.nodeType===Node.TEXT_NODE&&(e+=t.textContent)}),e.trim()}render(){return ei`
      <div
        part="base"
        class=${Xi({option:!0,"option--current":this.current,"option--disabled":this.disabled,"option--selected":this.selected,"option--hover":this.hasHover})}
        @mouseenter=${this.handleMouseEnter}
        @mouseleave=${this.handleMouseLeave}
      >
        <sl-icon part="checked-icon" class="option__check" name="check" library="system" aria-hidden="true"></sl-icon>
        <slot part="prefix" name="prefix" class="option__prefix"></slot>
        <slot part="label" class="option__label" @slotchange=${this.handleDefaultSlotChange}></slot>
        <slot part="suffix" name="suffix" class="option__suffix"></slot>
      </div>
    `}};dl.styles=[qi,Q8];dl.dependencies={"sl-icon":kr};J([yi(".option__label")],dl.prototype,"defaultSlot",2);J([Hi()],dl.prototype,"current",2);J([Hi()],dl.prototype,"selected",2);J([Hi()],dl.prototype,"hasHover",2);J([be({reflect:!0})],dl.prototype,"value",2);J([be({type:Boolean,reflect:!0})],dl.prototype,"disabled",2);J([hi("disabled")],dl.prototype,"handleDisabledChange",1);J([hi("selected")],dl.prototype,"handleSelectedChange",1);J([hi("value")],dl.prototype,"handleValueChange",1);dl.define("sl-option");yr.define("sl-popup");var e$=ji`
  :host {
    --height: 1rem;
    --track-color: var(--sl-color-neutral-200);
    --indicator-color: var(--sl-color-primary-600);
    --label-color: var(--sl-color-neutral-0);

    display: block;
  }

  .progress-bar {
    position: relative;
    background-color: var(--track-color);
    height: var(--height);
    border-radius: var(--sl-border-radius-pill);
    box-shadow: inset var(--sl-shadow-small);
    overflow: hidden;
  }

  .progress-bar__indicator {
    height: 100%;
    font-family: var(--sl-font-sans);
    font-size: 12px;
    font-weight: var(--sl-font-weight-normal);
    background-color: var(--indicator-color);
    color: var(--label-color);
    text-align: center;
    line-height: var(--height);
    white-space: nowrap;
    overflow: hidden;
    transition:
      400ms width,
      400ms background-color;
    user-select: none;
    -webkit-user-select: none;
  }

  /* Indeterminate */
  .progress-bar--indeterminate .progress-bar__indicator {
    position: absolute;
    animation: indeterminate 2.5s infinite cubic-bezier(0.37, 0, 0.63, 1);
  }

  .progress-bar--indeterminate.progress-bar--rtl .progress-bar__indicator {
    animation-name: indeterminate-rtl;
  }

  @media (forced-colors: active) {
    .progress-bar {
      outline: solid 1px SelectedItem;
      background-color: var(--sl-color-neutral-0);
    }

    .progress-bar__indicator {
      outline: solid 1px SelectedItem;
      background-color: SelectedItem;
    }
  }

  @keyframes indeterminate {
    0% {
      left: -50%;
      width: 50%;
    }
    75%,
    100% {
      left: 100%;
      width: 50%;
    }
  }

  @keyframes indeterminate-rtl {
    0% {
      right: -50%;
      width: 50%;
    }
    75%,
    100% {
      right: 100%;
      width: 50%;
    }
  }
`,w0=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.value=0,this.indeterminate=!1,this.label=""}render(){return ei`
      <div
        part="base"
        class=${Xi({"progress-bar":!0,"progress-bar--indeterminate":this.indeterminate,"progress-bar--rtl":this.localize.dir()==="rtl"})}
        role="progressbar"
        title=${Fi(this.title)}
        aria-label=${this.label.length>0?this.label:this.localize.term("progress")}
        aria-valuemin="0"
        aria-valuemax="100"
        aria-valuenow=${this.indeterminate?0:this.value}
      >
        <div part="indicator" class="progress-bar__indicator" style=${Qo({width:`${this.value}%`})}>
          ${this.indeterminate?"":ei` <slot part="label" class="progress-bar__label"></slot> `}
        </div>
      </div>
    `}};w0.styles=[qi,e$];J([be({type:Number,reflect:!0})],w0.prototype,"value",2);J([be({type:Boolean,reflect:!0})],w0.prototype,"indeterminate",2);J([be()],w0.prototype,"label",2);w0.define("sl-progress-bar");var t$=ji`
  :host {
    display: block;
  }

  .menu-label {
    display: inline-block;
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-small);
    font-weight: var(--sl-font-weight-semibold);
    line-height: var(--sl-line-height-normal);
    letter-spacing: var(--sl-letter-spacing-normal);
    color: var(--sl-color-neutral-500);
    padding: var(--sl-spacing-2x-small) var(--sl-spacing-x-large);
    user-select: none;
    -webkit-user-select: none;
  }
`,ZO=class extends Li{render(){return ei` <slot part="base" class="menu-label"></slot> `}};ZO.styles=[qi,t$];ZO.define("sl-menu-label");var i$=ji`
  :host {
    display: contents;
  }
`,Bc=class extends Li{constructor(){super(...arguments),this.attrOldValue=!1,this.charData=!1,this.charDataOldValue=!1,this.childList=!1,this.disabled=!1,this.handleMutation=i=>{this.emit("sl-mutation",{detail:{mutationList:i}})}}connectedCallback(){super.connectedCallback(),this.mutationObserver=new MutationObserver(this.handleMutation),this.disabled||this.startObserver()}disconnectedCallback(){super.disconnectedCallback(),this.stopObserver()}startObserver(){const i=typeof this.attr=="string"&&this.attr.length>0,e=i&&this.attr!=="*"?this.attr.split(" "):void 0;try{this.mutationObserver.observe(this,{subtree:!0,childList:this.childList,attributes:i,attributeFilter:e,attributeOldValue:this.attrOldValue,characterData:this.charData,characterDataOldValue:this.charDataOldValue})}catch{}}stopObserver(){this.mutationObserver.disconnect()}handleDisabledChange(){this.disabled?this.stopObserver():this.startObserver()}handleChange(){this.stopObserver(),this.startObserver()}render(){return ei` <slot></slot> `}};Bc.styles=[qi,i$];J([be({reflect:!0})],Bc.prototype,"attr",2);J([be({attribute:"attr-old-value",type:Boolean,reflect:!0})],Bc.prototype,"attrOldValue",2);J([be({attribute:"char-data",type:Boolean,reflect:!0})],Bc.prototype,"charData",2);J([be({attribute:"char-data-old-value",type:Boolean,reflect:!0})],Bc.prototype,"charDataOldValue",2);J([be({attribute:"child-list",type:Boolean,reflect:!0})],Bc.prototype,"childList",2);J([be({type:Boolean,reflect:!0})],Bc.prototype,"disabled",2);J([hi("disabled")],Bc.prototype,"handleDisabledChange",1);J([hi("attr",{waitUntilFirstUpdate:!0}),hi("attr-old-value",{waitUntilFirstUpdate:!0}),hi("char-data",{waitUntilFirstUpdate:!0}),hi("char-data-old-value",{waitUntilFirstUpdate:!0}),hi("childList",{waitUntilFirstUpdate:!0})],Bc.prototype,"handleChange",1);Bc.define("sl-mutation-observer");var n$=ji`
  :host {
    display: block;
  }

  .input {
    flex: 1 1 auto;
    display: inline-flex;
    align-items: stretch;
    justify-content: start;
    position: relative;
    width: 100%;
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-input-font-weight);
    letter-spacing: var(--sl-input-letter-spacing);
    vertical-align: middle;
    overflow: hidden;
    cursor: text;
    transition:
      var(--sl-transition-fast) color,
      var(--sl-transition-fast) border,
      var(--sl-transition-fast) box-shadow,
      var(--sl-transition-fast) background-color;
  }

  /* Standard inputs */
  .input--standard {
    background-color: var(--sl-input-background-color);
    border: solid var(--sl-input-border-width) var(--sl-input-border-color);
  }

  .input--standard:hover:not(.input--disabled) {
    background-color: var(--sl-input-background-color-hover);
    border-color: var(--sl-input-border-color-hover);
  }

  .input--standard.input--focused:not(.input--disabled) {
    background-color: var(--sl-input-background-color-focus);
    border-color: var(--sl-input-border-color-focus);
    box-shadow: 0 0 0 var(--sl-focus-ring-width) var(--sl-input-focus-ring-color);
  }

  .input--standard.input--focused:not(.input--disabled) .input__control {
    color: var(--sl-input-color-focus);
  }

  .input--standard.input--disabled {
    background-color: var(--sl-input-background-color-disabled);
    border-color: var(--sl-input-border-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
  }

  .input--standard.input--disabled .input__control {
    color: var(--sl-input-color-disabled);
  }

  .input--standard.input--disabled .input__control::placeholder {
    color: var(--sl-input-placeholder-color-disabled);
  }

  /* Filled inputs */
  .input--filled {
    border: none;
    background-color: var(--sl-input-filled-background-color);
    color: var(--sl-input-color);
  }

  .input--filled:hover:not(.input--disabled) {
    background-color: var(--sl-input-filled-background-color-hover);
  }

  .input--filled.input--focused:not(.input--disabled) {
    background-color: var(--sl-input-filled-background-color-focus);
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .input--filled.input--disabled {
    background-color: var(--sl-input-filled-background-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
  }

  .input__control {
    flex: 1 1 auto;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    min-width: 0;
    height: 100%;
    color: var(--sl-input-color);
    border: none;
    background: inherit;
    box-shadow: none;
    padding: 0;
    margin: 0;
    cursor: inherit;
    -webkit-appearance: none;
  }

  .input__control::-webkit-search-decoration,
  .input__control::-webkit-search-cancel-button,
  .input__control::-webkit-search-results-button,
  .input__control::-webkit-search-results-decoration {
    -webkit-appearance: none;
  }

  .input__control:-webkit-autofill,
  .input__control:-webkit-autofill:hover,
  .input__control:-webkit-autofill:focus,
  .input__control:-webkit-autofill:active {
    box-shadow: 0 0 0 var(--sl-input-height-large) var(--sl-input-background-color-hover) inset !important;
    -webkit-text-fill-color: var(--sl-color-primary-500);
    caret-color: var(--sl-input-color);
  }

  .input--filled .input__control:-webkit-autofill,
  .input--filled .input__control:-webkit-autofill:hover,
  .input--filled .input__control:-webkit-autofill:focus,
  .input--filled .input__control:-webkit-autofill:active {
    box-shadow: 0 0 0 var(--sl-input-height-large) var(--sl-input-filled-background-color) inset !important;
  }

  .input__control::placeholder {
    color: var(--sl-input-placeholder-color);
    user-select: none;
    -webkit-user-select: none;
  }

  .input:hover:not(.input--disabled) .input__control {
    color: var(--sl-input-color-hover);
  }

  .input__control:focus {
    outline: none;
  }

  .input__prefix,
  .input__suffix {
    display: inline-flex;
    flex: 0 0 auto;
    align-items: center;
    cursor: default;
  }

  .input__prefix ::slotted(sl-icon),
  .input__suffix ::slotted(sl-icon) {
    color: var(--sl-input-icon-color);
  }

  /*
   * Size modifiers
   */

  .input--small {
    border-radius: var(--sl-input-border-radius-small);
    font-size: var(--sl-input-font-size-small);
    height: var(--sl-input-height-small);
  }

  .input--small .input__control {
    height: calc(var(--sl-input-height-small) - var(--sl-input-border-width) * 2);
    padding: 0 var(--sl-input-spacing-small);
  }

  .input--small .input__clear,
  .input--small .input__password-toggle {
    width: calc(1em + var(--sl-input-spacing-small) * 2);
  }

  .input--small .input__prefix ::slotted(*) {
    margin-inline-start: var(--sl-input-spacing-small);
  }

  .input--small .input__suffix ::slotted(*) {
    margin-inline-end: var(--sl-input-spacing-small);
  }

  .input--medium {
    border-radius: var(--sl-input-border-radius-medium);
    font-size: var(--sl-input-font-size-medium);
    height: var(--sl-input-height-medium);
  }

  .input--medium .input__control {
    height: calc(var(--sl-input-height-medium) - var(--sl-input-border-width) * 2);
    padding: 0 var(--sl-input-spacing-medium);
  }

  .input--medium .input__clear,
  .input--medium .input__password-toggle {
    width: calc(1em + var(--sl-input-spacing-medium) * 2);
  }

  .input--medium .input__prefix ::slotted(*) {
    margin-inline-start: var(--sl-input-spacing-medium);
  }

  .input--medium .input__suffix ::slotted(*) {
    margin-inline-end: var(--sl-input-spacing-medium);
  }

  .input--large {
    border-radius: var(--sl-input-border-radius-large);
    font-size: var(--sl-input-font-size-large);
    height: var(--sl-input-height-large);
  }

  .input--large .input__control {
    height: calc(var(--sl-input-height-large) - var(--sl-input-border-width) * 2);
    padding: 0 var(--sl-input-spacing-large);
  }

  .input--large .input__clear,
  .input--large .input__password-toggle {
    width: calc(1em + var(--sl-input-spacing-large) * 2);
  }

  .input--large .input__prefix ::slotted(*) {
    margin-inline-start: var(--sl-input-spacing-large);
  }

  .input--large .input__suffix ::slotted(*) {
    margin-inline-end: var(--sl-input-spacing-large);
  }

  /*
   * Pill modifier
   */

  .input--pill.input--small {
    border-radius: var(--sl-input-height-small);
  }

  .input--pill.input--medium {
    border-radius: var(--sl-input-height-medium);
  }

  .input--pill.input--large {
    border-radius: var(--sl-input-height-large);
  }

  /*
   * Clearable + Password Toggle
   */

  .input__clear,
  .input__password-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: inherit;
    color: var(--sl-input-icon-color);
    border: none;
    background: none;
    padding: 0;
    transition: var(--sl-transition-fast) color;
    cursor: pointer;
  }

  .input__clear:hover,
  .input__password-toggle:hover {
    color: var(--sl-input-icon-color-hover);
  }

  .input__clear:focus,
  .input__password-toggle:focus {
    outline: none;
  }

  /* Don't show the browser's password toggle in Edge */
  ::-ms-reveal {
    display: none;
  }

  /* Hide the built-in number spinner */
  .input--no-spin-buttons input[type='number']::-webkit-outer-spin-button,
  .input--no-spin-buttons input[type='number']::-webkit-inner-spin-button {
    -webkit-appearance: none;
    display: none;
  }

  .input--no-spin-buttons input[type='number'] {
    -moz-appearance: textfield;
  }
`,En=class extends Li{constructor(){super(...arguments),this.formControlController=new Ch(this,{assumeInteractionOn:["sl-blur","sl-input"]}),this.hasSlotController=new Uo(this,"help-text","label"),this.localize=new cr(this),this.hasFocus=!1,this.title="",this.__numberInput=Object.assign(document.createElement("input"),{type:"number"}),this.__dateInput=Object.assign(document.createElement("input"),{type:"date"}),this.type="text",this.name="",this.value="",this.defaultValue="",this.size="medium",this.filled=!1,this.pill=!1,this.label="",this.helpText="",this.clearable=!1,this.disabled=!1,this.placeholder="",this.readonly=!1,this.passwordToggle=!1,this.passwordVisible=!1,this.noSpinButtons=!1,this.form="",this.required=!1,this.spellcheck=!0}get valueAsDate(){var i;return this.__dateInput.type=this.type,this.__dateInput.value=this.value,((i=this.input)==null?void 0:i.valueAsDate)||this.__dateInput.valueAsDate}set valueAsDate(i){this.__dateInput.type=this.type,this.__dateInput.valueAsDate=i,this.value=this.__dateInput.value}get valueAsNumber(){var i;return this.__numberInput.value=this.value,((i=this.input)==null?void 0:i.valueAsNumber)||this.__numberInput.valueAsNumber}set valueAsNumber(i){this.__numberInput.valueAsNumber=i,this.value=this.__numberInput.value}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}firstUpdated(){this.formControlController.updateValidity()}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleChange(){this.value=this.input.value,this.emit("sl-change")}handleClearClick(i){i.preventDefault(),this.value!==""&&(this.value="",this.emit("sl-clear"),this.emit("sl-input"),this.emit("sl-change")),this.input.focus()}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleInput(){this.value=this.input.value,this.formControlController.updateValidity(),this.emit("sl-input")}handleInvalid(i){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(i)}handleKeyDown(i){const e=i.metaKey||i.ctrlKey||i.shiftKey||i.altKey;i.key==="Enter"&&!e&&setTimeout(()=>{!i.defaultPrevented&&!i.isComposing&&this.formControlController.submit()})}handlePasswordToggle(){this.passwordVisible=!this.passwordVisible}handleDisabledChange(){this.formControlController.setValidity(this.disabled)}handleStepChange(){this.input.step=String(this.step),this.formControlController.updateValidity()}async handleValueChange(){await this.updateComplete,this.formControlController.updateValidity()}focus(i){this.input.focus(i)}blur(){this.input.blur()}select(){this.input.select()}setSelectionRange(i,e,t="none"){this.input.setSelectionRange(i,e,t)}setRangeText(i,e,t,n="preserve"){const s=e??this.input.selectionStart,c=t??this.input.selectionEnd;this.input.setRangeText(i,s,c,n),this.value!==this.input.value&&(this.value=this.input.value)}showPicker(){"showPicker"in HTMLInputElement.prototype&&this.input.showPicker()}stepUp(){this.input.stepUp(),this.value!==this.input.value&&(this.value=this.input.value)}stepDown(){this.input.stepDown(),this.value!==this.input.value&&(this.value=this.input.value)}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.input.reportValidity()}setCustomValidity(i){this.input.setCustomValidity(i),this.formControlController.updateValidity()}render(){const i=this.hasSlotController.test("label"),e=this.hasSlotController.test("help-text"),t=this.label?!0:!!i,n=this.helpText?!0:!!e,c=this.clearable&&!this.disabled&&!this.readonly&&(typeof this.value=="number"||this.value.length>0);return ei`
      <div
        part="form-control"
        class=${Xi({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--has-label":t,"form-control--has-help-text":n})}
      >
        <label
          part="form-control-label"
          class="form-control__label"
          for="input"
          aria-hidden=${t?"false":"true"}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <div part="form-control-input" class="form-control-input">
          <div
            part="base"
            class=${Xi({input:!0,"input--small":this.size==="small","input--medium":this.size==="medium","input--large":this.size==="large","input--pill":this.pill,"input--standard":!this.filled,"input--filled":this.filled,"input--disabled":this.disabled,"input--focused":this.hasFocus,"input--empty":!this.value,"input--no-spin-buttons":this.noSpinButtons})}
          >
            <span part="prefix" class="input__prefix">
              <slot name="prefix"></slot>
            </span>

            <input
              part="input"
              id="input"
              class="input__control"
              type=${this.type==="password"&&this.passwordVisible?"text":this.type}
              title=${this.title}
              name=${Fi(this.name)}
              ?disabled=${this.disabled}
              ?readonly=${this.readonly}
              ?required=${this.required}
              placeholder=${Fi(this.placeholder)}
              minlength=${Fi(this.minlength)}
              maxlength=${Fi(this.maxlength)}
              min=${Fi(this.min)}
              max=${Fi(this.max)}
              step=${Fi(this.step)}
              .value=${vf(this.value)}
              autocapitalize=${Fi(this.autocapitalize)}
              autocomplete=${Fi(this.autocomplete)}
              autocorrect=${Fi(this.autocorrect)}
              ?autofocus=${this.autofocus}
              spellcheck=${this.spellcheck}
              pattern=${Fi(this.pattern)}
              enterkeyhint=${Fi(this.enterkeyhint)}
              inputmode=${Fi(this.inputmode)}
              aria-describedby="help-text"
              @change=${this.handleChange}
              @input=${this.handleInput}
              @invalid=${this.handleInvalid}
              @keydown=${this.handleKeyDown}
              @focus=${this.handleFocus}
              @blur=${this.handleBlur}
            />

            ${c?ei`
                  <button
                    part="clear-button"
                    class="input__clear"
                    type="button"
                    aria-label=${this.localize.term("clearEntry")}
                    @click=${this.handleClearClick}
                    tabindex="-1"
                  >
                    <slot name="clear-icon">
                      <sl-icon name="x-circle-fill" library="system"></sl-icon>
                    </slot>
                  </button>
                `:""}
            ${this.passwordToggle&&!this.disabled?ei`
                  <button
                    part="password-toggle-button"
                    class="input__password-toggle"
                    type="button"
                    aria-label=${this.localize.term(this.passwordVisible?"hidePassword":"showPassword")}
                    @click=${this.handlePasswordToggle}
                    tabindex="-1"
                  >
                    ${this.passwordVisible?ei`
                          <slot name="show-password-icon">
                            <sl-icon name="eye-slash" library="system"></sl-icon>
                          </slot>
                        `:ei`
                          <slot name="hide-password-icon">
                            <sl-icon name="eye" library="system"></sl-icon>
                          </slot>
                        `}
                  </button>
                `:""}

            <span part="suffix" class="input__suffix">
              <slot name="suffix"></slot>
            </span>
          </div>
        </div>

        <div
          part="form-control-help-text"
          id="help-text"
          class="form-control__help-text"
          aria-hidden=${n?"false":"true"}
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};En.styles=[qi,If,n$];En.dependencies={"sl-icon":kr};J([yi(".input__control")],En.prototype,"input",2);J([Hi()],En.prototype,"hasFocus",2);J([be()],En.prototype,"title",2);J([be({reflect:!0})],En.prototype,"type",2);J([be()],En.prototype,"name",2);J([be()],En.prototype,"value",2);J([Hm()],En.prototype,"defaultValue",2);J([be({reflect:!0})],En.prototype,"size",2);J([be({type:Boolean,reflect:!0})],En.prototype,"filled",2);J([be({type:Boolean,reflect:!0})],En.prototype,"pill",2);J([be()],En.prototype,"label",2);J([be({attribute:"help-text"})],En.prototype,"helpText",2);J([be({type:Boolean})],En.prototype,"clearable",2);J([be({type:Boolean,reflect:!0})],En.prototype,"disabled",2);J([be()],En.prototype,"placeholder",2);J([be({type:Boolean,reflect:!0})],En.prototype,"readonly",2);J([be({attribute:"password-toggle",type:Boolean})],En.prototype,"passwordToggle",2);J([be({attribute:"password-visible",type:Boolean})],En.prototype,"passwordVisible",2);J([be({attribute:"no-spin-buttons",type:Boolean})],En.prototype,"noSpinButtons",2);J([be({reflect:!0})],En.prototype,"form",2);J([be({type:Boolean,reflect:!0})],En.prototype,"required",2);J([be()],En.prototype,"pattern",2);J([be({type:Number})],En.prototype,"minlength",2);J([be({type:Number})],En.prototype,"maxlength",2);J([be()],En.prototype,"min",2);J([be()],En.prototype,"max",2);J([be()],En.prototype,"step",2);J([be()],En.prototype,"autocapitalize",2);J([be()],En.prototype,"autocorrect",2);J([be()],En.prototype,"autocomplete",2);J([be({type:Boolean})],En.prototype,"autofocus",2);J([be()],En.prototype,"enterkeyhint",2);J([be({type:Boolean,converter:{fromAttribute:i=>!(!i||i==="false"),toAttribute:i=>i?"true":"false"}})],En.prototype,"spellcheck",2);J([be()],En.prototype,"inputmode",2);J([hi("disabled",{waitUntilFirstUpdate:!0})],En.prototype,"handleDisabledChange",1);J([hi("step",{waitUntilFirstUpdate:!0})],En.prototype,"handleStepChange",1);J([hi("value",{waitUntilFirstUpdate:!0})],En.prototype,"handleValueChange",1);En.define("sl-input");var r$=ji`
  :host {
    display: block;
    position: relative;
    background: var(--sl-panel-background-color);
    border: solid var(--sl-panel-border-width) var(--sl-panel-border-color);
    border-radius: var(--sl-border-radius-medium);
    padding: var(--sl-spacing-x-small) 0;
    overflow: auto;
    overscroll-behavior: none;
  }

  ::slotted(sl-divider) {
    --spacing: var(--sl-spacing-x-small);
  }
`,$E=class extends Li{connectedCallback(){super.connectedCallback(),this.setAttribute("role","menu")}handleClick(i){const e=["menuitem","menuitemcheckbox"],t=i.composedPath(),n=t.find(r=>{var b;return e.includes(((b=r==null?void 0:r.getAttribute)==null?void 0:b.call(r,"role"))||"")});if(!n||t.find(r=>{var b;return((b=r==null?void 0:r.getAttribute)==null?void 0:b.call(r,"role"))==="menu"})!==this)return;const f=n;f.type==="checkbox"&&(f.checked=!f.checked),this.emit("sl-select",{detail:{item:f}})}handleKeyDown(i){if(i.key==="Enter"||i.key===" "){const e=this.getCurrentItem();i.preventDefault(),i.stopPropagation(),e==null||e.click()}else if(["ArrowDown","ArrowUp","Home","End"].includes(i.key)){const e=this.getAllItems(),t=this.getCurrentItem();let n=t?e.indexOf(t):0;e.length>0&&(i.preventDefault(),i.stopPropagation(),i.key==="ArrowDown"?n++:i.key==="ArrowUp"?n--:i.key==="Home"?n=0:i.key==="End"&&(n=e.length-1),n<0&&(n=e.length-1),n>e.length-1&&(n=0),this.setCurrentItem(e[n]),e[n].focus())}}handleMouseDown(i){const e=i.target;this.isMenuItem(e)&&this.setCurrentItem(e)}handleSlotChange(){const i=this.getAllItems();i.length>0&&this.setCurrentItem(i[0])}isMenuItem(i){var e;return i.tagName.toLowerCase()==="sl-menu-item"||["menuitem","menuitemcheckbox","menuitemradio"].includes((e=i.getAttribute("role"))!=null?e:"")}getAllItems(){return[...this.defaultSlot.assignedElements({flatten:!0})].filter(i=>!(i.inert||!this.isMenuItem(i)))}getCurrentItem(){return this.getAllItems().find(i=>i.getAttribute("tabindex")==="0")}setCurrentItem(i){this.getAllItems().forEach(t=>{t.setAttribute("tabindex",t===i?"0":"-1")})}render(){return ei`
      <slot
        @slotchange=${this.handleSlotChange}
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
        @mousedown=${this.handleMouseDown}
      ></slot>
    `}};$E.styles=[qi,r$];J([yi("slot")],$E.prototype,"defaultSlot",2);$E.define("sl-menu");var s$=ji`
  :host {
    --submenu-offset: -2px;

    display: block;
  }

  :host([inert]) {
    display: none;
  }

  .menu-item {
    position: relative;
    display: flex;
    align-items: stretch;
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    line-height: var(--sl-line-height-normal);
    letter-spacing: var(--sl-letter-spacing-normal);
    color: var(--sl-color-neutral-700);
    padding: var(--sl-spacing-2x-small) var(--sl-spacing-2x-small);
    transition: var(--sl-transition-fast) fill;
    user-select: none;
    -webkit-user-select: none;
    white-space: nowrap;
    cursor: pointer;
  }

  .menu-item.menu-item--disabled {
    outline: none;
    opacity: 0.5;
    cursor: not-allowed;
  }

  .menu-item.menu-item--loading {
    outline: none;
    cursor: wait;
  }

  .menu-item.menu-item--loading *:not(sl-spinner) {
    opacity: 0.5;
  }

  .menu-item--loading sl-spinner {
    --indicator-color: currentColor;
    --track-width: 1px;
    position: absolute;
    font-size: 0.75em;
    top: calc(50% - 0.5em);
    left: 0.65rem;
    opacity: 1;
  }

  .menu-item .menu-item__label {
    flex: 1 1 auto;
    display: inline-block;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .menu-item .menu-item__prefix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
  }

  .menu-item .menu-item__prefix::slotted(*) {
    margin-inline-end: var(--sl-spacing-x-small);
  }

  .menu-item .menu-item__suffix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
  }

  .menu-item .menu-item__suffix::slotted(*) {
    margin-inline-start: var(--sl-spacing-x-small);
  }

  /* Safe triangle */
  .menu-item--submenu-expanded::after {
    content: '';
    position: fixed;
    z-index: calc(var(--sl-z-index-dropdown) - 1);
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    clip-path: polygon(
      var(--safe-triangle-cursor-x, 0) var(--safe-triangle-cursor-y, 0),
      var(--safe-triangle-submenu-start-x, 0) var(--safe-triangle-submenu-start-y, 0),
      var(--safe-triangle-submenu-end-x, 0) var(--safe-triangle-submenu-end-y, 0)
    );
  }

  :host(:focus-visible) {
    outline: none;
  }

  :host(:hover:not([aria-disabled='true'], :focus-visible)) .menu-item,
  .menu-item--submenu-expanded {
    background-color: var(--sl-color-neutral-100);
    color: var(--sl-color-neutral-1000);
  }

  :host(:focus-visible) .menu-item {
    outline: none;
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
    opacity: 1;
  }

  .menu-item .menu-item__check,
  .menu-item .menu-item__chevron {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.5em;
    visibility: hidden;
  }

  .menu-item--checked .menu-item__check,
  .menu-item--has-submenu .menu-item__chevron {
    visibility: visible;
  }

  /* Add elevation and z-index to submenus */
  sl-popup::part(popup) {
    box-shadow: var(--sl-shadow-large);
    z-index: var(--sl-z-index-dropdown);
    margin-left: var(--submenu-offset);
  }

  .menu-item--rtl sl-popup::part(popup) {
    margin-left: calc(-1 * var(--submenu-offset));
  }

  @media (forced-colors: active) {
    :host(:hover:not([aria-disabled='true'])) .menu-item,
    :host(:focus-visible) .menu-item {
      outline: dashed 1px SelectedItem;
      outline-offset: -1px;
    }
  }

  ::slotted(sl-menu) {
    max-width: var(--auto-size-available-width) !important;
    max-height: var(--auto-size-available-height) !important;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Cy=(i,e)=>{var n;const t=i._$AN;if(t===void 0)return!1;for(const s of t)(n=s._$AO)==null||n.call(s,e,!1),Cy(s,e);return!0},r1=i=>{let e,t;do{if((e=i._$AM)===void 0)break;t=e._$AN,t.delete(i),i=e}while((t==null?void 0:t.size)===0)},KO=i=>{for(let e;e=i._$AM;i=e){let t=e._$AN;if(t===void 0)e._$AN=t=new Set;else if(t.has(i))break;t.add(i),l$(e)}};function o$(i){this._$AN!==void 0?(r1(this),this._$AM=i,KO(this)):this._$AM=i}function a$(i,e=!1,t=0){const n=this._$AH,s=this._$AN;if(s!==void 0&&s.size!==0)if(e)if(Array.isArray(n))for(let c=t;c<n.length;c++)Cy(n[c],!1),r1(n[c]);else n!=null&&(Cy(n,!1),r1(n));else Cy(this,i)}const l$=i=>{i.type==Sc.CHILD&&(i._$AP??(i._$AP=a$),i._$AQ??(i._$AQ=o$))};let c$=class extends _0{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,n){super._$AT(e,t,n),KO(this),this.isConnected=e._$AU}_$AO(e,t=!0){var n,s;e!==this.isConnected&&(this.isConnected=e,e?(n=this.reconnected)==null||n.call(this):(s=this.disconnected)==null||s.call(this)),t&&(Cy(this,e),r1(this))}setValue(e){if(MO(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const h$=()=>new u$;let u$=class{};const VT=new WeakMap,d$=g0(class extends c${render(i){return $r}update(i,[e]){var n;const t=e!==this.G;return t&&this.G!==void 0&&this.rt(void 0),(t||this.lt!==this.ct)&&(this.G=e,this.ht=(n=i.options)==null?void 0:n.host,this.rt(this.ct=i.element)),$r}rt(i){if(this.isConnected||(i=void 0),typeof this.G=="function"){const e=this.ht??globalThis;let t=VT.get(e);t===void 0&&(t=new WeakMap,VT.set(e,t)),t.get(this.G)!==void 0&&this.G.call(this.ht,void 0),t.set(this.G,i),i!==void 0&&this.G.call(this.ht,i)}else this.G.value=i}get lt(){var i,e;return typeof this.G=="function"?(i=VT.get(this.ht??globalThis))==null?void 0:i.get(this.G):(e=this.G)==null?void 0:e.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var f$=class{constructor(i,e){this.popupRef=h$(),this.enableSubmenuTimer=-1,this.isConnected=!1,this.isPopupConnected=!1,this.skidding=0,this.submenuOpenDelay=100,this.handleMouseMove=t=>{this.host.style.setProperty("--safe-triangle-cursor-x",`${t.clientX}px`),this.host.style.setProperty("--safe-triangle-cursor-y",`${t.clientY}px`)},this.handleMouseOver=()=>{this.hasSlotController.test("submenu")&&this.enableSubmenu()},this.handleKeyDown=t=>{switch(t.key){case"Escape":case"Tab":this.disableSubmenu();break;case"ArrowLeft":t.target!==this.host&&(t.preventDefault(),t.stopPropagation(),this.host.focus(),this.disableSubmenu());break;case"ArrowRight":case"Enter":case" ":this.handleSubmenuEntry(t);break}},this.handleClick=t=>{var n;t.target===this.host?(t.preventDefault(),t.stopPropagation()):t.target instanceof Element&&(t.target.tagName==="sl-menu-item"||(n=t.target.role)!=null&&n.startsWith("menuitem"))&&this.disableSubmenu()},this.handleFocusOut=t=>{t.relatedTarget&&t.relatedTarget instanceof Element&&this.host.contains(t.relatedTarget)||this.disableSubmenu()},this.handlePopupMouseover=t=>{t.stopPropagation()},this.handlePopupReposition=()=>{const t=this.host.renderRoot.querySelector("slot[name='submenu']"),n=t==null?void 0:t.assignedElements({flatten:!0}).filter(w=>w.localName==="sl-menu")[0],s=getComputedStyle(this.host).direction==="rtl";if(!n)return;const{left:c,top:f,width:r,height:b}=n.getBoundingClientRect();this.host.style.setProperty("--safe-triangle-submenu-start-x",`${s?c+r:c}px`),this.host.style.setProperty("--safe-triangle-submenu-start-y",`${f}px`),this.host.style.setProperty("--safe-triangle-submenu-end-x",`${s?c+r:c}px`),this.host.style.setProperty("--safe-triangle-submenu-end-y",`${f+b}px`)},(this.host=i).addController(this),this.hasSlotController=e}hostConnected(){this.hasSlotController.test("submenu")&&!this.host.disabled&&this.addListeners()}hostDisconnected(){this.removeListeners()}hostUpdated(){this.hasSlotController.test("submenu")&&!this.host.disabled?(this.addListeners(),this.updateSkidding()):this.removeListeners()}addListeners(){this.isConnected||(this.host.addEventListener("mousemove",this.handleMouseMove),this.host.addEventListener("mouseover",this.handleMouseOver),this.host.addEventListener("keydown",this.handleKeyDown),this.host.addEventListener("click",this.handleClick),this.host.addEventListener("focusout",this.handleFocusOut),this.isConnected=!0),this.isPopupConnected||this.popupRef.value&&(this.popupRef.value.addEventListener("mouseover",this.handlePopupMouseover),this.popupRef.value.addEventListener("sl-reposition",this.handlePopupReposition),this.isPopupConnected=!0)}removeListeners(){this.isConnected&&(this.host.removeEventListener("mousemove",this.handleMouseMove),this.host.removeEventListener("mouseover",this.handleMouseOver),this.host.removeEventListener("keydown",this.handleKeyDown),this.host.removeEventListener("click",this.handleClick),this.host.removeEventListener("focusout",this.handleFocusOut),this.isConnected=!1),this.isPopupConnected&&this.popupRef.value&&(this.popupRef.value.removeEventListener("mouseover",this.handlePopupMouseover),this.popupRef.value.removeEventListener("sl-reposition",this.handlePopupReposition),this.isPopupConnected=!1)}handleSubmenuEntry(i){const e=this.host.renderRoot.querySelector("slot[name='submenu']");if(!e){console.error("Cannot activate a submenu if no corresponding menuitem can be found.",this);return}let t=null;for(const n of e.assignedElements())if(t=n.querySelectorAll("sl-menu-item, [role^='menuitem']"),t.length!==0)break;if(!(!t||t.length===0)){t[0].setAttribute("tabindex","0");for(let n=1;n!==t.length;++n)t[n].setAttribute("tabindex","-1");this.popupRef.value&&(i.preventDefault(),i.stopPropagation(),this.popupRef.value.active?t[0]instanceof HTMLElement&&t[0].focus():(this.enableSubmenu(!1),this.host.updateComplete.then(()=>{t[0]instanceof HTMLElement&&t[0].focus()}),this.host.requestUpdate()))}}setSubmenuState(i){this.popupRef.value&&this.popupRef.value.active!==i&&(this.popupRef.value.active=i,this.host.requestUpdate())}enableSubmenu(i=!0){i?(window.clearTimeout(this.enableSubmenuTimer),this.enableSubmenuTimer=window.setTimeout(()=>{this.setSubmenuState(!0)},this.submenuOpenDelay)):this.setSubmenuState(!0)}disableSubmenu(){window.clearTimeout(this.enableSubmenuTimer),this.setSubmenuState(!1)}updateSkidding(){var i;if(!((i=this.host.parentElement)!=null&&i.computedStyleMap))return;const e=this.host.parentElement.computedStyleMap(),n=["padding-top","border-top-width","margin-top"].reduce((s,c)=>{var f;const r=(f=e.get(c))!=null?f:new CSSUnitValue(0,"px"),w=(r instanceof CSSUnitValue?r:new CSSUnitValue(0,"px")).to("px");return s-w.value},0);this.skidding=n}isExpanded(){return this.popupRef.value?this.popupRef.value.active:!1}renderSubmenu(){const i=getComputedStyle(this.host).direction==="rtl";return this.isConnected?ei`
      <sl-popup
        ${d$(this.popupRef)}
        placement=${i?"left-start":"right-start"}
        anchor="anchor"
        flip
        flip-fallback-strategy="best-fit"
        skidding="${this.skidding}"
        strategy="fixed"
        auto-size="vertical"
        auto-size-padding="10"
      >
        <slot name="submenu"></slot>
      </sl-popup>
    `:ei` <slot name="submenu" hidden></slot> `}},za=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.type="normal",this.checked=!1,this.value="",this.loading=!1,this.disabled=!1,this.hasSlotController=new Uo(this,"submenu"),this.submenuController=new f$(this,this.hasSlotController),this.handleHostClick=i=>{this.disabled&&(i.preventDefault(),i.stopImmediatePropagation())},this.handleMouseOver=i=>{this.focus(),i.stopPropagation()}}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.handleHostClick),this.addEventListener("mouseover",this.handleMouseOver)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.handleHostClick),this.removeEventListener("mouseover",this.handleMouseOver)}handleDefaultSlotChange(){const i=this.getTextLabel();if(typeof this.cachedTextLabel>"u"){this.cachedTextLabel=i;return}i!==this.cachedTextLabel&&(this.cachedTextLabel=i,this.emit("slotchange",{bubbles:!0,composed:!1,cancelable:!1}))}handleCheckedChange(){if(this.checked&&this.type!=="checkbox"){this.checked=!1,console.error('The checked attribute can only be used on menu items with type="checkbox"',this);return}this.type==="checkbox"?this.setAttribute("aria-checked",this.checked?"true":"false"):this.removeAttribute("aria-checked")}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false")}handleTypeChange(){this.type==="checkbox"?(this.setAttribute("role","menuitemcheckbox"),this.setAttribute("aria-checked",this.checked?"true":"false")):(this.setAttribute("role","menuitem"),this.removeAttribute("aria-checked"))}getTextLabel(){return fV(this.defaultSlot)}isSubmenu(){return this.hasSlotController.test("submenu")}render(){const i=this.localize.dir()==="rtl",e=this.submenuController.isExpanded();return ei`
      <div
        id="anchor"
        part="base"
        class=${Xi({"menu-item":!0,"menu-item--rtl":i,"menu-item--checked":this.checked,"menu-item--disabled":this.disabled,"menu-item--loading":this.loading,"menu-item--has-submenu":this.isSubmenu(),"menu-item--submenu-expanded":e})}
        ?aria-haspopup="${this.isSubmenu()}"
        ?aria-expanded="${!!e}"
      >
        <span part="checked-icon" class="menu-item__check">
          <sl-icon name="check" library="system" aria-hidden="true"></sl-icon>
        </span>

        <slot name="prefix" part="prefix" class="menu-item__prefix"></slot>

        <slot part="label" class="menu-item__label" @slotchange=${this.handleDefaultSlotChange}></slot>

        <slot name="suffix" part="suffix" class="menu-item__suffix"></slot>

        <span part="submenu-icon" class="menu-item__chevron">
          <sl-icon name=${i?"chevron-left":"chevron-right"} library="system" aria-hidden="true"></sl-icon>
        </span>

        ${this.submenuController.renderSubmenu()}
        ${this.loading?ei` <sl-spinner part="spinner" exportparts="base:spinner__base"></sl-spinner> `:""}
      </div>
    `}};za.styles=[qi,s$];za.dependencies={"sl-icon":kr,"sl-popup":yr,"sl-spinner":y0};J([yi("slot:not([name])")],za.prototype,"defaultSlot",2);J([yi(".menu-item")],za.prototype,"menuItem",2);J([be()],za.prototype,"type",2);J([be({type:Boolean,reflect:!0})],za.prototype,"checked",2);J([be()],za.prototype,"value",2);J([be({type:Boolean,reflect:!0})],za.prototype,"loading",2);J([be({type:Boolean,reflect:!0})],za.prototype,"disabled",2);J([hi("checked")],za.prototype,"handleCheckedChange",1);J([hi("disabled")],za.prototype,"handleDisabledChange",1);J([hi("type")],za.prototype,"handleTypeChange",1);za.define("sl-menu-item");var p$=ji`
  :host {
    --divider-width: 2px;
    --handle-size: 2.5rem;

    display: inline-block;
    position: relative;
  }

  .image-comparer {
    max-width: 100%;
    max-height: 100%;
    overflow: hidden;
  }

  .image-comparer__before,
  .image-comparer__after {
    display: block;
    pointer-events: none;
  }

  .image-comparer__before::slotted(img),
  .image-comparer__after::slotted(img),
  .image-comparer__before::slotted(svg),
  .image-comparer__after::slotted(svg) {
    display: block;
    max-width: 100% !important;
    height: auto;
  }

  .image-comparer__after {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
  }

  .image-comparer__divider {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    width: var(--divider-width);
    height: 100%;
    background-color: var(--sl-color-neutral-0);
    translate: calc(var(--divider-width) / -2);
    cursor: ew-resize;
  }

  .image-comparer__handle {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: calc(50% - (var(--handle-size) / 2));
    width: var(--handle-size);
    height: var(--handle-size);
    background-color: var(--sl-color-neutral-0);
    border-radius: var(--sl-border-radius-circle);
    font-size: calc(var(--handle-size) * 0.5);
    color: var(--sl-color-neutral-700);
    cursor: inherit;
    z-index: 10;
  }

  .image-comparer__handle:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }
`,Pf=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.position=50}handleDrag(i){const{width:e}=this.base.getBoundingClientRect(),t=this.localize.dir()==="rtl";i.preventDefault(),Ey(this.base,{onMove:n=>{this.position=parseFloat(ws(n/e*100,0,100).toFixed(2)),t&&(this.position=100-this.position)},initialEvent:i})}handleKeyDown(i){const e=this.localize.dir()==="ltr",t=this.localize.dir()==="rtl";if(["ArrowLeft","ArrowRight","Home","End"].includes(i.key)){const n=i.shiftKey?10:1;let s=this.position;i.preventDefault(),(e&&i.key==="ArrowLeft"||t&&i.key==="ArrowRight")&&(s-=n),(e&&i.key==="ArrowRight"||t&&i.key==="ArrowLeft")&&(s+=n),i.key==="Home"&&(s=0),i.key==="End"&&(s=100),s=ws(s,0,100),this.position=s}}handlePositionChange(){this.emit("sl-change")}render(){const i=this.localize.dir()==="rtl";return ei`
      <div
        part="base"
        id="image-comparer"
        class=${Xi({"image-comparer":!0,"image-comparer--rtl":i})}
        @keydown=${this.handleKeyDown}
      >
        <div class="image-comparer__image">
          <div part="before" class="image-comparer__before">
            <slot name="before"></slot>
          </div>

          <div
            part="after"
            class="image-comparer__after"
            style=${Qo({clipPath:i?`inset(0 0 0 ${100-this.position}%)`:`inset(0 ${100-this.position}% 0 0)`})}
          >
            <slot name="after"></slot>
          </div>
        </div>

        <div
          part="divider"
          class="image-comparer__divider"
          style=${Qo({left:i?`${100-this.position}%`:`${this.position}%`})}
          @mousedown=${this.handleDrag}
          @touchstart=${this.handleDrag}
        >
          <div
            part="handle"
            class="image-comparer__handle"
            role="scrollbar"
            aria-valuenow=${this.position}
            aria-valuemin="0"
            aria-valuemax="100"
            aria-controls="image-comparer"
            tabindex="0"
          >
            <slot name="handle">
              <sl-icon library="system" name="grip-vertical"></sl-icon>
            </slot>
          </div>
        </div>
      </div>
    `}};Pf.styles=[qi,p$];Pf.scopedElement={"sl-icon":kr};J([yi(".image-comparer")],Pf.prototype,"base",2);J([yi(".image-comparer__handle")],Pf.prototype,"handle",2);J([be({type:Number,reflect:!0})],Pf.prototype,"position",2);J([hi("position",{waitUntilFirstUpdate:!0})],Pf.prototype,"handlePositionChange",1);Pf.define("sl-image-comparer");var m$=ji`
  :host {
    display: block;
  }
`,$T=new Map;function g$(i,e="cors"){const t=$T.get(i);if(t!==void 0)return Promise.resolve(t);const n=fetch(i,{mode:e}).then(async s=>{const c={ok:s.ok,status:s.status,html:await s.text()};return $T.set(i,c),c});return $T.set(i,n),n}var Ym=class extends Li{constructor(){super(...arguments),this.mode="cors",this.allowScripts=!1}executeScript(i){const e=document.createElement("script");[...i.attributes].forEach(t=>e.setAttribute(t.name,t.value)),e.textContent=i.textContent,i.parentNode.replaceChild(e,i)}async handleSrcChange(){try{const i=this.src,e=await g$(i,this.mode);if(i!==this.src)return;if(!e.ok){this.emit("sl-error",{detail:{status:e.status}});return}this.innerHTML=e.html,this.allowScripts&&[...this.querySelectorAll("script")].forEach(t=>this.executeScript(t)),this.emit("sl-load")}catch{this.emit("sl-error",{detail:{status:-1}})}}render(){return ei`<slot></slot>`}};Ym.styles=[qi,m$];J([be()],Ym.prototype,"src",2);J([be()],Ym.prototype,"mode",2);J([be({attribute:"allow-scripts",type:Boolean})],Ym.prototype,"allowScripts",2);J([hi("src")],Ym.prototype,"handleSrcChange",1);Ym.define("sl-include");kr.define("sl-icon");zs.define("sl-icon-button");var _w=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.value=0,this.unit="byte",this.display="short"}render(){if(isNaN(this.value))return"";const i=["","kilo","mega","giga","tera"],e=["","kilo","mega","giga","tera","peta"],t=this.unit==="bit"?i:e,n=Math.max(0,Math.min(Math.floor(Math.log10(this.value)/3),t.length-1)),s=t[n]+this.unit,c=parseFloat((this.value/Math.pow(1e3,n)).toPrecision(3));return this.localize.number(c,{style:"unit",unit:s,unitDisplay:this.display})}};J([be({type:Number})],_w.prototype,"value",2);J([be()],_w.prototype,"unit",2);J([be()],_w.prototype,"display",2);_w.define("sl-format-bytes");var Na=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.date=new Date,this.hourFormat="auto"}render(){const i=new Date(this.date),e=this.hourFormat==="auto"?void 0:this.hourFormat==="12";if(!isNaN(i.getMilliseconds()))return ei`
      <time datetime=${i.toISOString()}>
        ${this.localize.date(i,{weekday:this.weekday,era:this.era,year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second,timeZoneName:this.timeZoneName,timeZone:this.timeZone,hour12:e})}
      </time>
    `}};J([be()],Na.prototype,"date",2);J([be()],Na.prototype,"weekday",2);J([be()],Na.prototype,"era",2);J([be()],Na.prototype,"year",2);J([be()],Na.prototype,"month",2);J([be()],Na.prototype,"day",2);J([be()],Na.prototype,"hour",2);J([be()],Na.prototype,"minute",2);J([be()],Na.prototype,"second",2);J([be({attribute:"time-zone-name"})],Na.prototype,"timeZoneName",2);J([be({attribute:"time-zone"})],Na.prototype,"timeZone",2);J([be({attribute:"hour-format"})],Na.prototype,"hourFormat",2);Na.define("sl-format-date");var Wl=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.value=0,this.type="decimal",this.noGrouping=!1,this.currency="USD",this.currencyDisplay="symbol"}render(){return isNaN(this.value)?"":this.localize.number(this.value,{style:this.type,currency:this.currency,currencyDisplay:this.currencyDisplay,useGrouping:!this.noGrouping,minimumIntegerDigits:this.minimumIntegerDigits,minimumFractionDigits:this.minimumFractionDigits,maximumFractionDigits:this.maximumFractionDigits,minimumSignificantDigits:this.minimumSignificantDigits,maximumSignificantDigits:this.maximumSignificantDigits})}};J([be({type:Number})],Wl.prototype,"value",2);J([be()],Wl.prototype,"type",2);J([be({attribute:"no-grouping",type:Boolean})],Wl.prototype,"noGrouping",2);J([be()],Wl.prototype,"currency",2);J([be({attribute:"currency-display"})],Wl.prototype,"currencyDisplay",2);J([be({attribute:"minimum-integer-digits",type:Number})],Wl.prototype,"minimumIntegerDigits",2);J([be({attribute:"minimum-fraction-digits",type:Number})],Wl.prototype,"minimumFractionDigits",2);J([be({attribute:"maximum-fraction-digits",type:Number})],Wl.prototype,"maximumFractionDigits",2);J([be({attribute:"minimum-significant-digits",type:Number})],Wl.prototype,"minimumSignificantDigits",2);J([be({attribute:"maximum-significant-digits",type:Number})],Wl.prototype,"maximumSignificantDigits",2);Wl.define("sl-format-number");var _$=ji`
  :host {
    --color: var(--sl-panel-border-color);
    --width: var(--sl-panel-border-width);
    --spacing: var(--sl-spacing-medium);
  }

  :host(:not([vertical])) {
    display: block;
    border-top: solid var(--width) var(--color);
    margin: var(--spacing) 0;
  }

  :host([vertical]) {
    display: inline-block;
    height: 100%;
    border-left: solid var(--width) var(--color);
    margin: 0 var(--spacing);
  }
`,yw=class extends Li{constructor(){super(...arguments),this.vertical=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","separator")}handleVerticalChange(){this.setAttribute("aria-orientation",this.vertical?"vertical":"horizontal")}};yw.styles=[qi,_$];J([be({type:Boolean,reflect:!0})],yw.prototype,"vertical",2);J([hi("vertical")],yw.prototype,"handleVerticalChange",1);yw.define("sl-divider");var y$=ji`
  :host {
    --size: 25rem;
    --header-spacing: var(--sl-spacing-large);
    --body-spacing: var(--sl-spacing-large);
    --footer-spacing: var(--sl-spacing-large);

    display: contents;
  }

  .drawer {
    top: 0;
    inset-inline-start: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
  }

  .drawer--contained {
    position: absolute;
    z-index: initial;
  }

  .drawer--fixed {
    position: fixed;
    z-index: var(--sl-z-index-drawer);
  }

  .drawer__panel {
    position: absolute;
    display: flex;
    flex-direction: column;
    z-index: 2;
    max-width: 100%;
    max-height: 100%;
    background-color: var(--sl-panel-background-color);
    box-shadow: var(--sl-shadow-x-large);
    overflow: auto;
    pointer-events: all;
  }

  .drawer__panel:focus {
    outline: none;
  }

  .drawer--top .drawer__panel {
    top: 0;
    inset-inline-end: auto;
    bottom: auto;
    inset-inline-start: 0;
    width: 100%;
    height: var(--size);
  }

  .drawer--end .drawer__panel {
    top: 0;
    inset-inline-end: 0;
    bottom: auto;
    inset-inline-start: auto;
    width: var(--size);
    height: 100%;
  }

  .drawer--bottom .drawer__panel {
    top: auto;
    inset-inline-end: auto;
    bottom: 0;
    inset-inline-start: 0;
    width: 100%;
    height: var(--size);
  }

  .drawer--start .drawer__panel {
    top: 0;
    inset-inline-end: auto;
    bottom: auto;
    inset-inline-start: 0;
    width: var(--size);
    height: 100%;
  }

  .drawer__header {
    display: flex;
  }

  .drawer__title {
    flex: 1 1 auto;
    font: inherit;
    font-size: var(--sl-font-size-large);
    line-height: var(--sl-line-height-dense);
    padding: var(--header-spacing);
    margin: 0;
  }

  .drawer__header-actions {
    flex-shrink: 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: end;
    gap: var(--sl-spacing-2x-small);
    padding: 0 var(--header-spacing);
  }

  .drawer__header-actions sl-icon-button,
  .drawer__header-actions ::slotted(sl-icon-button) {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-medium);
  }

  .drawer__body {
    flex: 1 1 auto;
    display: block;
    padding: var(--body-spacing);
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  .drawer__footer {
    text-align: right;
    padding: var(--footer-spacing);
  }

  .drawer__footer ::slotted(sl-button:not(:last-of-type)) {
    margin-inline-end: var(--sl-spacing-x-small);
  }

  .drawer:not(.drawer--has-footer) .drawer__footer {
    display: none;
  }

  .drawer__overlay {
    display: block;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: var(--sl-overlay-background-color);
    pointer-events: all;
  }

  .drawer--contained .drawer__overlay {
    display: none;
  }

  @media (forced-colors: active) {
    .drawer__panel {
      border: solid 1px var(--sl-color-neutral-0);
    }
  }
`;function*jE(i=document.activeElement){i!=null&&(yield i,"shadowRoot"in i&&i.shadowRoot&&i.shadowRoot.mode!=="closed"&&(yield*jU(jE(i.shadowRoot.activeElement))))}function JO(){return[...jE()].pop()}var bk=new WeakMap;function QO(i){let e=bk.get(i);return e||(e=window.getComputedStyle(i,null),bk.set(i,e)),e}function b$(i){if(typeof i.checkVisibility=="function")return i.checkVisibility({checkOpacity:!1,checkVisibilityCSS:!0});const e=QO(i);return e.visibility!=="hidden"&&e.display!=="none"}function v$(i){const e=QO(i),{overflowY:t,overflowX:n}=e;return t==="scroll"||n==="scroll"?!0:t!=="auto"||n!=="auto"?!1:i.scrollHeight>i.clientHeight&&t==="auto"||i.scrollWidth>i.clientWidth&&n==="auto"}function x$(i){const e=i.tagName.toLowerCase(),t=Number(i.getAttribute("tabindex"));if(i.hasAttribute("tabindex")&&(isNaN(t)||t<=-1)||i.hasAttribute("disabled")||i.closest("[inert]"))return!1;if(e==="input"&&i.getAttribute("type")==="radio"){const c=i.getRootNode(),f=`input[type='radio'][name="${i.getAttribute("name")}"]`,r=c.querySelector(`${f}:checked`);return r?r===i:c.querySelector(f)===i}return b$(i)?(e==="audio"||e==="video")&&i.hasAttribute("controls")||i.hasAttribute("tabindex")||i.hasAttribute("contenteditable")&&i.getAttribute("contenteditable")!=="false"||["button","input","select","textarea","a","audio","video","summary","iframe"].includes(e)?!0:v$(i):!1}function w$(i){var e,t;const n=dS(i),s=(e=n[0])!=null?e:null,c=(t=n[n.length-1])!=null?t:null;return{start:s,end:c}}function A$(i,e){var t;return((t=i.getRootNode({composed:!0}))==null?void 0:t.host)!==e}function dS(i){const e=new WeakMap,t=[];function n(s){if(s instanceof Element){if(s.hasAttribute("inert")||s.closest("[inert]")||e.has(s))return;e.set(s,!0),!t.includes(s)&&x$(s)&&t.push(s),s instanceof HTMLSlotElement&&A$(s,i)&&s.assignedElements({flatten:!0}).forEach(c=>{n(c)}),s.shadowRoot!==null&&s.shadowRoot.mode==="open"&&n(s.shadowRoot)}for(const c of s.children)n(c)}return n(i),t.sort((s,c)=>{const f=Number(s.getAttribute("tabindex"))||0;return(Number(c.getAttribute("tabindex"))||0)-f})}var K_=[],eF=class{constructor(i){this.tabDirection="forward",this.handleFocusIn=()=>{this.isActive()&&this.checkFocus()},this.handleKeyDown=e=>{var t;if(e.key!=="Tab"||this.isExternalActivated||!this.isActive())return;const n=JO();if(this.previousFocus=n,this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus))return;e.shiftKey?this.tabDirection="backward":this.tabDirection="forward";const s=dS(this.element);let c=s.findIndex(r=>r===n);this.previousFocus=this.currentFocus;const f=this.tabDirection==="forward"?1:-1;for(;;){c+f>=s.length?c=0:c+f<0?c=s.length-1:c+=f,this.previousFocus=this.currentFocus;const r=s[c];if(this.tabDirection==="backward"&&this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus)||r&&this.possiblyHasTabbableChildren(r))return;e.preventDefault(),this.currentFocus=r,(t=this.currentFocus)==null||t.focus({preventScroll:!1});const b=[...jE()];if(b.includes(this.currentFocus)||!b.includes(this.previousFocus))break}setTimeout(()=>this.checkFocus())},this.handleKeyUp=()=>{this.tabDirection="forward"},this.element=i,this.elementsWithTabbableControls=["iframe"]}activate(){K_.push(this.element),document.addEventListener("focusin",this.handleFocusIn),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}deactivate(){K_=K_.filter(i=>i!==this.element),this.currentFocus=null,document.removeEventListener("focusin",this.handleFocusIn),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}isActive(){return K_[K_.length-1]===this.element}activateExternal(){this.isExternalActivated=!0}deactivateExternal(){this.isExternalActivated=!1}checkFocus(){if(this.isActive()&&!this.isExternalActivated){const i=dS(this.element);if(!this.element.matches(":focus-within")){const e=i[0],t=i[i.length-1],n=this.tabDirection==="forward"?e:t;typeof(n==null?void 0:n.focus)=="function"&&(this.currentFocus=n,n.focus({preventScroll:!1}))}}}possiblyHasTabbableChildren(i){return this.elementsWithTabbableControls.includes(i.tagName.toLowerCase())||i.hasAttribute("controls")}},HE=i=>{var e;const{activeElement:t}=document;t&&i.contains(t)&&((e=document.activeElement)==null||e.blur())};function vk(i){return i.charAt(0).toUpperCase()+i.slice(1)}var Ua=class extends Li{constructor(){super(...arguments),this.hasSlotController=new Uo(this,"footer"),this.localize=new cr(this),this.modal=new eF(this),this.open=!1,this.label="",this.placement="end",this.contained=!1,this.noHeader=!1,this.handleDocumentKeyDown=i=>{this.contained||i.key==="Escape"&&this.modal.isActive()&&this.open&&(i.stopImmediatePropagation(),this.requestClose("keyboard"))}}firstUpdated(){this.drawer.hidden=!this.open,this.open&&(this.addOpenListeners(),this.contained||(this.modal.activate(),Ty(this)))}disconnectedCallback(){super.disconnectedCallback(),Sy(this),this.removeOpenListeners()}requestClose(i){if(this.emit("sl-request-close",{cancelable:!0,detail:{source:i}}).defaultPrevented){const t=jr(this,"drawer.denyClose",{dir:this.localize.dir()});ss(this.panel,t.keyframes,t.options);return}this.hide()}addOpenListeners(){var i;"CloseWatcher"in window?((i=this.closeWatcher)==null||i.destroy(),this.contained||(this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>this.requestClose("keyboard"))):document.addEventListener("keydown",this.handleDocumentKeyDown)}removeOpenListeners(){var i;document.removeEventListener("keydown",this.handleDocumentKeyDown),(i=this.closeWatcher)==null||i.destroy()}async handleOpenChange(){if(this.open){this.emit("sl-show"),this.addOpenListeners(),this.originalTrigger=document.activeElement,this.contained||(this.modal.activate(),Ty(this));const i=this.querySelector("[autofocus]");i&&i.removeAttribute("autofocus"),await Promise.all([Es(this.drawer),Es(this.overlay)]),this.drawer.hidden=!1,requestAnimationFrame(()=>{this.emit("sl-initial-focus",{cancelable:!0}).defaultPrevented||(i?i.focus({preventScroll:!0}):this.panel.focus({preventScroll:!0})),i&&i.setAttribute("autofocus","")});const e=jr(this,`drawer.show${vk(this.placement)}`,{dir:this.localize.dir()}),t=jr(this,"drawer.overlay.show",{dir:this.localize.dir()});await Promise.all([ss(this.panel,e.keyframes,e.options),ss(this.overlay,t.keyframes,t.options)]),this.emit("sl-after-show")}else{HE(this),this.emit("sl-hide"),this.removeOpenListeners(),this.contained||(this.modal.deactivate(),Sy(this)),await Promise.all([Es(this.drawer),Es(this.overlay)]);const i=jr(this,`drawer.hide${vk(this.placement)}`,{dir:this.localize.dir()}),e=jr(this,"drawer.overlay.hide",{dir:this.localize.dir()});await Promise.all([ss(this.overlay,e.keyframes,e.options).then(()=>{this.overlay.hidden=!0}),ss(this.panel,i.keyframes,i.options).then(()=>{this.panel.hidden=!0})]),this.drawer.hidden=!0,this.overlay.hidden=!1,this.panel.hidden=!1;const t=this.originalTrigger;typeof(t==null?void 0:t.focus)=="function"&&setTimeout(()=>t.focus()),this.emit("sl-after-hide")}}handleNoModalChange(){this.open&&!this.contained&&(this.modal.activate(),Ty(this)),this.open&&this.contained&&(this.modal.deactivate(),Sy(this))}async show(){if(!this.open)return this.open=!0,No(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,No(this,"sl-after-hide")}render(){return ei`
      <div
        part="base"
        class=${Xi({drawer:!0,"drawer--open":this.open,"drawer--top":this.placement==="top","drawer--end":this.placement==="end","drawer--bottom":this.placement==="bottom","drawer--start":this.placement==="start","drawer--contained":this.contained,"drawer--fixed":!this.contained,"drawer--rtl":this.localize.dir()==="rtl","drawer--has-footer":this.hasSlotController.test("footer")})}
      >
        <div part="overlay" class="drawer__overlay" @click=${()=>this.requestClose("overlay")} tabindex="-1"></div>

        <div
          part="panel"
          class="drawer__panel"
          role="dialog"
          aria-modal="true"
          aria-hidden=${this.open?"false":"true"}
          aria-label=${Fi(this.noHeader?this.label:void 0)}
          aria-labelledby=${Fi(this.noHeader?void 0:"title")}
          tabindex="0"
        >
          ${this.noHeader?"":ei`
                <header part="header" class="drawer__header">
                  <h2 part="title" class="drawer__title" id="title">
                    <!-- If there's no label, use an invisible character to prevent the header from collapsing -->
                    <slot name="label"> ${this.label.length>0?this.label:"\uFEFF"} </slot>
                  </h2>
                  <div part="header-actions" class="drawer__header-actions">
                    <slot name="header-actions"></slot>
                    <sl-icon-button
                      part="close-button"
                      exportparts="base:close-button__base"
                      class="drawer__close"
                      name="x-lg"
                      label=${this.localize.term("close")}
                      library="system"
                      @click=${()=>this.requestClose("close-button")}
                    ></sl-icon-button>
                  </div>
                </header>
              `}

          <slot part="body" class="drawer__body"></slot>

          <footer part="footer" class="drawer__footer">
            <slot name="footer"></slot>
          </footer>
        </div>
      </div>
    `}};Ua.styles=[qi,y$];Ua.dependencies={"sl-icon-button":zs};J([yi(".drawer")],Ua.prototype,"drawer",2);J([yi(".drawer__panel")],Ua.prototype,"panel",2);J([yi(".drawer__overlay")],Ua.prototype,"overlay",2);J([be({type:Boolean,reflect:!0})],Ua.prototype,"open",2);J([be({reflect:!0})],Ua.prototype,"label",2);J([be({reflect:!0})],Ua.prototype,"placement",2);J([be({type:Boolean,reflect:!0})],Ua.prototype,"contained",2);J([be({attribute:"no-header",type:Boolean,reflect:!0})],Ua.prototype,"noHeader",2);J([hi("open",{waitUntilFirstUpdate:!0})],Ua.prototype,"handleOpenChange",1);J([hi("contained",{waitUntilFirstUpdate:!0})],Ua.prototype,"handleNoModalChange",1);_r("drawer.showTop",{keyframes:[{opacity:0,translate:"0 -100%"},{opacity:1,translate:"0 0"}],options:{duration:250,easing:"ease"}});_r("drawer.hideTop",{keyframes:[{opacity:1,translate:"0 0"},{opacity:0,translate:"0 -100%"}],options:{duration:250,easing:"ease"}});_r("drawer.showEnd",{keyframes:[{opacity:0,translate:"100%"},{opacity:1,translate:"0"}],rtlKeyframes:[{opacity:0,translate:"-100%"},{opacity:1,translate:"0"}],options:{duration:250,easing:"ease"}});_r("drawer.hideEnd",{keyframes:[{opacity:1,translate:"0"},{opacity:0,translate:"100%"}],rtlKeyframes:[{opacity:1,translate:"0"},{opacity:0,translate:"-100%"}],options:{duration:250,easing:"ease"}});_r("drawer.showBottom",{keyframes:[{opacity:0,translate:"0 100%"},{opacity:1,translate:"0 0"}],options:{duration:250,easing:"ease"}});_r("drawer.hideBottom",{keyframes:[{opacity:1,translate:"0 0"},{opacity:0,translate:"0 100%"}],options:{duration:250,easing:"ease"}});_r("drawer.showStart",{keyframes:[{opacity:0,translate:"-100%"},{opacity:1,translate:"0"}],rtlKeyframes:[{opacity:0,translate:"100%"},{opacity:1,translate:"0"}],options:{duration:250,easing:"ease"}});_r("drawer.hideStart",{keyframes:[{opacity:1,translate:"0"},{opacity:0,translate:"-100%"}],rtlKeyframes:[{opacity:1,translate:"0"},{opacity:0,translate:"100%"}],options:{duration:250,easing:"ease"}});_r("drawer.denyClose",{keyframes:[{scale:1},{scale:1.01},{scale:1}],options:{duration:250}});_r("drawer.overlay.show",{keyframes:[{opacity:0},{opacity:1}],options:{duration:250}});_r("drawer.overlay.hide",{keyframes:[{opacity:1},{opacity:0}],options:{duration:250}});Ua.define("sl-drawer");var T$=ji`
  :host {
    display: inline-block;
  }

  .dropdown::part(popup) {
    z-index: var(--sl-z-index-dropdown);
  }

  .dropdown[data-current-placement^='top']::part(popup) {
    transform-origin: bottom;
  }

  .dropdown[data-current-placement^='bottom']::part(popup) {
    transform-origin: top;
  }

  .dropdown[data-current-placement^='left']::part(popup) {
    transform-origin: right;
  }

  .dropdown[data-current-placement^='right']::part(popup) {
    transform-origin: left;
  }

  .dropdown__trigger {
    display: block;
  }

  .dropdown__panel {
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    box-shadow: var(--sl-shadow-large);
    border-radius: var(--sl-border-radius-medium);
    pointer-events: none;
  }

  .dropdown--open .dropdown__panel {
    display: block;
    pointer-events: all;
  }

  /* When users slot a menu, make sure it conforms to the popup's auto-size */
  ::slotted(sl-menu) {
    max-width: var(--auto-size-available-width) !important;
    max-height: var(--auto-size-available-height) !important;
  }
`,po=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.open=!1,this.placement="bottom-start",this.disabled=!1,this.stayOpenOnSelect=!1,this.distance=0,this.skidding=0,this.hoist=!1,this.sync=void 0,this.handleKeyDown=i=>{this.open&&i.key==="Escape"&&(i.stopPropagation(),this.hide(),this.focusOnTrigger())},this.handleDocumentKeyDown=i=>{var e;if(i.key==="Escape"&&this.open&&!this.closeWatcher){i.stopPropagation(),this.focusOnTrigger(),this.hide();return}if(i.key==="Tab"){if(this.open&&((e=document.activeElement)==null?void 0:e.tagName.toLowerCase())==="sl-menu-item"){i.preventDefault(),this.hide(),this.focusOnTrigger();return}const t=(n,s)=>{if(!n)return null;const c=n.closest(s);if(c)return c;const f=n.getRootNode();return f instanceof ShadowRoot?t(f.host,s):null};setTimeout(()=>{var n;const s=((n=this.containingElement)==null?void 0:n.getRootNode())instanceof ShadowRoot?JO():document.activeElement;(!this.containingElement||t(s,this.containingElement.tagName.toLowerCase())!==this.containingElement)&&this.hide()})}},this.handleDocumentMouseDown=i=>{const e=i.composedPath();this.containingElement&&!e.includes(this.containingElement)&&this.hide()},this.handlePanelSelect=i=>{const e=i.target;!this.stayOpenOnSelect&&e.tagName.toLowerCase()==="sl-menu"&&(this.hide(),this.focusOnTrigger())}}connectedCallback(){super.connectedCallback(),this.containingElement||(this.containingElement=this)}firstUpdated(){this.panel.hidden=!this.open,this.open&&(this.addOpenListeners(),this.popup.active=!0)}disconnectedCallback(){super.disconnectedCallback(),this.removeOpenListeners(),this.hide()}focusOnTrigger(){const i=this.trigger.assignedElements({flatten:!0})[0];typeof(i==null?void 0:i.focus)=="function"&&i.focus()}getMenu(){return this.panel.assignedElements({flatten:!0}).find(i=>i.tagName.toLowerCase()==="sl-menu")}handleTriggerClick(){this.open?this.hide():(this.show(),this.focusOnTrigger())}async handleTriggerKeyDown(i){if([" ","Enter"].includes(i.key)){i.preventDefault(),this.handleTriggerClick();return}const e=this.getMenu();if(e){const t=e.getAllItems(),n=t[0],s=t[t.length-1];["ArrowDown","ArrowUp","Home","End"].includes(i.key)&&(i.preventDefault(),this.open||(this.show(),await this.updateComplete),t.length>0&&this.updateComplete.then(()=>{(i.key==="ArrowDown"||i.key==="Home")&&(e.setCurrentItem(n),n.focus()),(i.key==="ArrowUp"||i.key==="End")&&(e.setCurrentItem(s),s.focus())}))}}handleTriggerKeyUp(i){i.key===" "&&i.preventDefault()}handleTriggerSlotChange(){this.updateAccessibleTrigger()}updateAccessibleTrigger(){const e=this.trigger.assignedElements({flatten:!0}).find(n=>w$(n).start);let t;if(e){switch(e.tagName.toLowerCase()){case"sl-button":case"sl-icon-button":t=e.button;break;default:t=e}t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-expanded",this.open?"true":"false")}}async show(){if(!this.open)return this.open=!0,No(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,No(this,"sl-after-hide")}reposition(){this.popup.reposition()}addOpenListeners(){var i;this.panel.addEventListener("sl-select",this.handlePanelSelect),"CloseWatcher"in window?((i=this.closeWatcher)==null||i.destroy(),this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>{this.hide(),this.focusOnTrigger()}):this.panel.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("mousedown",this.handleDocumentMouseDown)}removeOpenListeners(){var i;this.panel&&(this.panel.removeEventListener("sl-select",this.handlePanelSelect),this.panel.removeEventListener("keydown",this.handleKeyDown)),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("mousedown",this.handleDocumentMouseDown),(i=this.closeWatcher)==null||i.destroy()}async handleOpenChange(){if(this.disabled){this.open=!1;return}if(this.updateAccessibleTrigger(),this.open){this.emit("sl-show"),this.addOpenListeners(),await Es(this),this.panel.hidden=!1,this.popup.active=!0;const{keyframes:i,options:e}=jr(this,"dropdown.show",{dir:this.localize.dir()});await ss(this.popup.popup,i,e),this.emit("sl-after-show")}else{this.emit("sl-hide"),this.removeOpenListeners(),await Es(this);const{keyframes:i,options:e}=jr(this,"dropdown.hide",{dir:this.localize.dir()});await ss(this.popup.popup,i,e),this.panel.hidden=!0,this.popup.active=!1,this.emit("sl-after-hide")}}render(){return ei`
      <sl-popup
        part="base"
        exportparts="popup:base__popup"
        id="dropdown"
        placement=${this.placement}
        distance=${this.distance}
        skidding=${this.skidding}
        strategy=${this.hoist?"fixed":"absolute"}
        flip
        shift
        auto-size="vertical"
        auto-size-padding="10"
        sync=${Fi(this.sync?this.sync:void 0)}
        class=${Xi({dropdown:!0,"dropdown--open":this.open})}
      >
        <slot
          name="trigger"
          slot="anchor"
          part="trigger"
          class="dropdown__trigger"
          @click=${this.handleTriggerClick}
          @keydown=${this.handleTriggerKeyDown}
          @keyup=${this.handleTriggerKeyUp}
          @slotchange=${this.handleTriggerSlotChange}
        ></slot>

        <div aria-hidden=${this.open?"false":"true"} aria-labelledby="dropdown">
          <slot part="panel" class="dropdown__panel"></slot>
        </div>
      </sl-popup>
    `}};po.styles=[qi,T$];po.dependencies={"sl-popup":yr};J([yi(".dropdown")],po.prototype,"popup",2);J([yi(".dropdown__trigger")],po.prototype,"trigger",2);J([yi(".dropdown__panel")],po.prototype,"panel",2);J([be({type:Boolean,reflect:!0})],po.prototype,"open",2);J([be({reflect:!0})],po.prototype,"placement",2);J([be({type:Boolean,reflect:!0})],po.prototype,"disabled",2);J([be({attribute:"stay-open-on-select",type:Boolean,reflect:!0})],po.prototype,"stayOpenOnSelect",2);J([be({attribute:!1})],po.prototype,"containingElement",2);J([be({type:Number})],po.prototype,"distance",2);J([be({type:Number})],po.prototype,"skidding",2);J([be({type:Boolean})],po.prototype,"hoist",2);J([be({reflect:!0})],po.prototype,"sync",2);J([hi("open",{waitUntilFirstUpdate:!0})],po.prototype,"handleOpenChange",1);_r("dropdown.show",{keyframes:[{opacity:0,scale:.9},{opacity:1,scale:1}],options:{duration:100,easing:"ease"}});_r("dropdown.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.9}],options:{duration:100,easing:"ease"}});po.define("sl-dropdown");var S$=ji`
  :host {
    --error-color: var(--sl-color-danger-600);
    --success-color: var(--sl-color-success-600);

    display: inline-block;
  }

  .copy-button__button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    background: none;
    border: none;
    border-radius: var(--sl-border-radius-medium);
    font-size: inherit;
    color: inherit;
    padding: var(--sl-spacing-x-small);
    cursor: pointer;
    transition: var(--sl-transition-x-fast) color;
  }

  .copy-button--success .copy-button__button {
    color: var(--success-color);
  }

  .copy-button--error .copy-button__button {
    color: var(--error-color);
  }

  .copy-button__button:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .copy-button__button[disabled] {
    opacity: 0.5;
    cursor: not-allowed !important;
  }

  slot {
    display: inline-flex;
  }
`,Ys=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.isCopying=!1,this.status="rest",this.value="",this.from="",this.disabled=!1,this.copyLabel="",this.successLabel="",this.errorLabel="",this.feedbackDuration=1e3,this.tooltipPlacement="top",this.hoist=!1}async handleCopy(){if(this.disabled||this.isCopying)return;this.isCopying=!0;let i=this.value;if(this.from){const e=this.getRootNode(),t=this.from.includes("."),n=this.from.includes("[")&&this.from.includes("]");let s=this.from,c="";t?[s,c]=this.from.trim().split("."):n&&([s,c]=this.from.trim().replace(/\]$/,"").split("["));const f="getElementById"in e?e.getElementById(s):null;f?n?i=f.getAttribute(c)||"":t?i=f[c]||"":i=f.textContent||"":(this.showStatus("error"),this.emit("sl-error"))}if(!i)this.showStatus("error"),this.emit("sl-error");else try{await navigator.clipboard.writeText(i),this.showStatus("success"),this.emit("sl-copy",{detail:{value:i}})}catch{this.showStatus("error"),this.emit("sl-error")}}async showStatus(i){const e=this.copyLabel||this.localize.term("copy"),t=this.successLabel||this.localize.term("copied"),n=this.errorLabel||this.localize.term("error"),s=i==="success"?this.successIcon:this.errorIcon,c=jr(this,"copy.in",{dir:"ltr"}),f=jr(this,"copy.out",{dir:"ltr"});this.tooltip.content=i==="success"?t:n,await this.copyIcon.animate(f.keyframes,f.options).finished,this.copyIcon.hidden=!0,this.status=i,s.hidden=!1,await s.animate(c.keyframes,c.options).finished,setTimeout(async()=>{await s.animate(f.keyframes,f.options).finished,s.hidden=!0,this.status="rest",this.copyIcon.hidden=!1,await this.copyIcon.animate(c.keyframes,c.options).finished,this.tooltip.content=e,this.isCopying=!1},this.feedbackDuration)}render(){const i=this.copyLabel||this.localize.term("copy");return ei`
      <sl-tooltip
        class=${Xi({"copy-button":!0,"copy-button--success":this.status==="success","copy-button--error":this.status==="error"})}
        content=${i}
        placement=${this.tooltipPlacement}
        ?disabled=${this.disabled}
        ?hoist=${this.hoist}
        exportparts="
          base:tooltip__base,
          base__popup:tooltip__base__popup,
          base__arrow:tooltip__base__arrow,
          body:tooltip__body
        "
      >
        <button
          class="copy-button__button"
          part="button"
          type="button"
          ?disabled=${this.disabled}
          @click=${this.handleCopy}
        >
          <slot part="copy-icon" name="copy-icon">
            <sl-icon library="system" name="copy"></sl-icon>
          </slot>
          <slot part="success-icon" name="success-icon" hidden>
            <sl-icon library="system" name="check"></sl-icon>
          </slot>
          <slot part="error-icon" name="error-icon" hidden>
            <sl-icon library="system" name="x-lg"></sl-icon>
          </slot>
        </button>
      </sl-tooltip>
    `}};Ys.styles=[qi,S$];Ys.dependencies={"sl-icon":kr,"sl-tooltip":qs};J([yi('slot[name="copy-icon"]')],Ys.prototype,"copyIcon",2);J([yi('slot[name="success-icon"]')],Ys.prototype,"successIcon",2);J([yi('slot[name="error-icon"]')],Ys.prototype,"errorIcon",2);J([yi("sl-tooltip")],Ys.prototype,"tooltip",2);J([Hi()],Ys.prototype,"isCopying",2);J([Hi()],Ys.prototype,"status",2);J([be()],Ys.prototype,"value",2);J([be()],Ys.prototype,"from",2);J([be({type:Boolean,reflect:!0})],Ys.prototype,"disabled",2);J([be({attribute:"copy-label"})],Ys.prototype,"copyLabel",2);J([be({attribute:"success-label"})],Ys.prototype,"successLabel",2);J([be({attribute:"error-label"})],Ys.prototype,"errorLabel",2);J([be({attribute:"feedback-duration",type:Number})],Ys.prototype,"feedbackDuration",2);J([be({attribute:"tooltip-placement"})],Ys.prototype,"tooltipPlacement",2);J([be({type:Boolean})],Ys.prototype,"hoist",2);_r("copy.in",{keyframes:[{scale:".25",opacity:".25"},{scale:"1",opacity:"1"}],options:{duration:100}});_r("copy.out",{keyframes:[{scale:"1",opacity:"1"},{scale:".25",opacity:"0"}],options:{duration:100}});Ys.define("sl-copy-button");var E$=ji`
  :host {
    display: block;
  }

  .details {
    border: solid 1px var(--sl-color-neutral-200);
    border-radius: var(--sl-border-radius-medium);
    background-color: var(--sl-color-neutral-0);
    overflow-anchor: none;
  }

  .details--disabled {
    opacity: 0.5;
  }

  .details__header {
    display: flex;
    align-items: center;
    border-radius: inherit;
    padding: var(--sl-spacing-medium);
    user-select: none;
    -webkit-user-select: none;
    cursor: pointer;
  }

  .details__header::-webkit-details-marker {
    display: none;
  }

  .details__header:focus {
    outline: none;
  }

  .details__header:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: calc(1px + var(--sl-focus-ring-offset));
  }

  .details--disabled .details__header {
    cursor: not-allowed;
  }

  .details--disabled .details__header:focus-visible {
    outline: none;
    box-shadow: none;
  }

  .details__summary {
    flex: 1 1 auto;
    display: flex;
    align-items: center;
  }

  .details__summary-icon {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    transition: var(--sl-transition-medium) rotate ease;
  }

  .details--open .details__summary-icon {
    rotate: 90deg;
  }

  .details--open.details--rtl .details__summary-icon {
    rotate: -90deg;
  }

  .details--open slot[name='expand-icon'],
  .details:not(.details--open) slot[name='collapse-icon'] {
    display: none;
  }

  .details__body {
    overflow: hidden;
  }

  .details__content {
    display: block;
    padding: var(--sl-spacing-medium);
  }
`,Gl=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.open=!1,this.disabled=!1}firstUpdated(){this.body.style.height=this.open?"auto":"0",this.open&&(this.details.open=!0),this.detailsObserver=new MutationObserver(i=>{for(const e of i)e.type==="attributes"&&e.attributeName==="open"&&(this.details.open?this.show():this.hide())}),this.detailsObserver.observe(this.details,{attributes:!0})}disconnectedCallback(){var i;super.disconnectedCallback(),(i=this.detailsObserver)==null||i.disconnect()}handleSummaryClick(i){i.preventDefault(),this.disabled||(this.open?this.hide():this.show(),this.header.focus())}handleSummaryKeyDown(i){(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),this.open?this.hide():this.show()),(i.key==="ArrowUp"||i.key==="ArrowLeft")&&(i.preventDefault(),this.hide()),(i.key==="ArrowDown"||i.key==="ArrowRight")&&(i.preventDefault(),this.show())}async handleOpenChange(){if(this.open){if(this.details.open=!0,this.emit("sl-show",{cancelable:!0}).defaultPrevented){this.open=!1,this.details.open=!1;return}await Es(this.body);const{keyframes:e,options:t}=jr(this,"details.show",{dir:this.localize.dir()});await ss(this.body,Qx(e,this.body.scrollHeight),t),this.body.style.height="auto",this.emit("sl-after-show")}else{if(this.emit("sl-hide",{cancelable:!0}).defaultPrevented){this.details.open=!0,this.open=!0;return}await Es(this.body);const{keyframes:e,options:t}=jr(this,"details.hide",{dir:this.localize.dir()});await ss(this.body,Qx(e,this.body.scrollHeight),t),this.body.style.height="auto",this.details.open=!1,this.emit("sl-after-hide")}}async show(){if(!(this.open||this.disabled))return this.open=!0,No(this,"sl-after-show")}async hide(){if(!(!this.open||this.disabled))return this.open=!1,No(this,"sl-after-hide")}render(){const i=this.localize.dir()==="rtl";return ei`
      <details
        part="base"
        class=${Xi({details:!0,"details--open":this.open,"details--disabled":this.disabled,"details--rtl":i})}
      >
        <summary
          part="header"
          id="header"
          class="details__header"
          role="button"
          aria-expanded=${this.open?"true":"false"}
          aria-controls="content"
          aria-disabled=${this.disabled?"true":"false"}
          tabindex=${this.disabled?"-1":"0"}
          @click=${this.handleSummaryClick}
          @keydown=${this.handleSummaryKeyDown}
        >
          <slot name="summary" part="summary" class="details__summary">${this.summary}</slot>

          <span part="summary-icon" class="details__summary-icon">
            <slot name="expand-icon">
              <sl-icon library="system" name=${i?"chevron-left":"chevron-right"}></sl-icon>
            </slot>
            <slot name="collapse-icon">
              <sl-icon library="system" name=${i?"chevron-left":"chevron-right"}></sl-icon>
            </slot>
          </span>
        </summary>

        <div class="details__body" role="region" aria-labelledby="header">
          <slot part="content" id="content" class="details__content"></slot>
        </div>
      </details>
    `}};Gl.styles=[qi,E$];Gl.dependencies={"sl-icon":kr};J([yi(".details")],Gl.prototype,"details",2);J([yi(".details__header")],Gl.prototype,"header",2);J([yi(".details__body")],Gl.prototype,"body",2);J([yi(".details__expand-icon-slot")],Gl.prototype,"expandIconSlot",2);J([be({type:Boolean,reflect:!0})],Gl.prototype,"open",2);J([be()],Gl.prototype,"summary",2);J([be({type:Boolean,reflect:!0})],Gl.prototype,"disabled",2);J([hi("open",{waitUntilFirstUpdate:!0})],Gl.prototype,"handleOpenChange",1);_r("details.show",{keyframes:[{height:"0",opacity:"0"},{height:"auto",opacity:"1"}],options:{duration:250,easing:"linear"}});_r("details.hide",{keyframes:[{height:"auto",opacity:"1"},{height:"0",opacity:"0"}],options:{duration:250,easing:"linear"}});Gl.define("sl-details");var C$=ji`
  :host {
    --width: 31rem;
    --header-spacing: var(--sl-spacing-large);
    --body-spacing: var(--sl-spacing-large);
    --footer-spacing: var(--sl-spacing-large);

    display: contents;
  }

  .dialog {
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: var(--sl-z-index-dialog);
  }

  .dialog__panel {
    display: flex;
    flex-direction: column;
    z-index: 2;
    width: var(--width);
    max-width: calc(100% - var(--sl-spacing-2x-large));
    max-height: calc(100% - var(--sl-spacing-2x-large));
    background-color: var(--sl-panel-background-color);
    border-radius: var(--sl-border-radius-medium);
    box-shadow: var(--sl-shadow-x-large);
  }

  .dialog__panel:focus {
    outline: none;
  }

  /* Ensure there's enough vertical padding for phones that don't update vh when chrome appears (e.g. iPhone) */
  @media screen and (max-width: 420px) {
    .dialog__panel {
      max-height: 80vh;
    }
  }

  .dialog--open .dialog__panel {
    display: flex;
    opacity: 1;
  }

  .dialog__header {
    flex: 0 0 auto;
    display: flex;
  }

  .dialog__title {
    flex: 1 1 auto;
    font: inherit;
    font-size: var(--sl-font-size-large);
    line-height: var(--sl-line-height-dense);
    padding: var(--header-spacing);
    margin: 0;
  }

  .dialog__header-actions {
    flex-shrink: 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: end;
    gap: var(--sl-spacing-2x-small);
    padding: 0 var(--header-spacing);
  }

  .dialog__header-actions sl-icon-button,
  .dialog__header-actions ::slotted(sl-icon-button) {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-medium);
  }

  .dialog__body {
    flex: 1 1 auto;
    display: block;
    padding: var(--body-spacing);
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  .dialog__footer {
    flex: 0 0 auto;
    text-align: right;
    padding: var(--footer-spacing);
  }

  .dialog__footer ::slotted(sl-button:not(:first-of-type)) {
    margin-inline-start: var(--sl-spacing-x-small);
  }

  .dialog:not(.dialog--has-footer) .dialog__footer {
    display: none;
  }

  .dialog__overlay {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: var(--sl-overlay-background-color);
  }

  @media (forced-colors: active) {
    .dialog__panel {
      border: solid 1px var(--sl-color-neutral-0);
    }
  }
`,Oc=class extends Li{constructor(){super(...arguments),this.hasSlotController=new Uo(this,"footer"),this.localize=new cr(this),this.modal=new eF(this),this.open=!1,this.label="",this.noHeader=!1,this.handleDocumentKeyDown=i=>{i.key==="Escape"&&this.modal.isActive()&&this.open&&(i.stopPropagation(),this.requestClose("keyboard"))}}firstUpdated(){this.dialog.hidden=!this.open,this.open&&(this.addOpenListeners(),this.modal.activate(),Ty(this))}disconnectedCallback(){super.disconnectedCallback(),this.modal.deactivate(),Sy(this),this.removeOpenListeners()}requestClose(i){if(this.emit("sl-request-close",{cancelable:!0,detail:{source:i}}).defaultPrevented){const t=jr(this,"dialog.denyClose",{dir:this.localize.dir()});ss(this.panel,t.keyframes,t.options);return}this.hide()}addOpenListeners(){var i;"CloseWatcher"in window?((i=this.closeWatcher)==null||i.destroy(),this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>this.requestClose("keyboard")):document.addEventListener("keydown",this.handleDocumentKeyDown)}removeOpenListeners(){var i;(i=this.closeWatcher)==null||i.destroy(),document.removeEventListener("keydown",this.handleDocumentKeyDown)}async handleOpenChange(){if(this.open){this.emit("sl-show"),this.addOpenListeners(),this.originalTrigger=document.activeElement,this.modal.activate(),Ty(this);const i=this.querySelector("[autofocus]");i&&i.removeAttribute("autofocus"),await Promise.all([Es(this.dialog),Es(this.overlay)]),this.dialog.hidden=!1,requestAnimationFrame(()=>{this.emit("sl-initial-focus",{cancelable:!0}).defaultPrevented||(i?i.focus({preventScroll:!0}):this.panel.focus({preventScroll:!0})),i&&i.setAttribute("autofocus","")});const e=jr(this,"dialog.show",{dir:this.localize.dir()}),t=jr(this,"dialog.overlay.show",{dir:this.localize.dir()});await Promise.all([ss(this.panel,e.keyframes,e.options),ss(this.overlay,t.keyframes,t.options)]),this.emit("sl-after-show")}else{HE(this),this.emit("sl-hide"),this.removeOpenListeners(),this.modal.deactivate(),await Promise.all([Es(this.dialog),Es(this.overlay)]);const i=jr(this,"dialog.hide",{dir:this.localize.dir()}),e=jr(this,"dialog.overlay.hide",{dir:this.localize.dir()});await Promise.all([ss(this.overlay,e.keyframes,e.options).then(()=>{this.overlay.hidden=!0}),ss(this.panel,i.keyframes,i.options).then(()=>{this.panel.hidden=!0})]),this.dialog.hidden=!0,this.overlay.hidden=!1,this.panel.hidden=!1,Sy(this);const t=this.originalTrigger;typeof(t==null?void 0:t.focus)=="function"&&setTimeout(()=>t.focus()),this.emit("sl-after-hide")}}async show(){if(!this.open)return this.open=!0,No(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,No(this,"sl-after-hide")}render(){return ei`
      <div
        part="base"
        class=${Xi({dialog:!0,"dialog--open":this.open,"dialog--has-footer":this.hasSlotController.test("footer")})}
      >
        <div part="overlay" class="dialog__overlay" @click=${()=>this.requestClose("overlay")} tabindex="-1"></div>

        <div
          part="panel"
          class="dialog__panel"
          role="dialog"
          aria-modal="true"
          aria-hidden=${this.open?"false":"true"}
          aria-label=${Fi(this.noHeader?this.label:void 0)}
          aria-labelledby=${Fi(this.noHeader?void 0:"title")}
          tabindex="-1"
        >
          ${this.noHeader?"":ei`
                <header part="header" class="dialog__header">
                  <h2 part="title" class="dialog__title" id="title">
                    <slot name="label"> ${this.label.length>0?this.label:"\uFEFF"} </slot>
                  </h2>
                  <div part="header-actions" class="dialog__header-actions">
                    <slot name="header-actions"></slot>
                    <sl-icon-button
                      part="close-button"
                      exportparts="base:close-button__base"
                      class="dialog__close"
                      name="x-lg"
                      label=${this.localize.term("close")}
                      library="system"
                      @click="${()=>this.requestClose("close-button")}"
                    ></sl-icon-button>
                  </div>
                </header>
              `}
          ${""}
          <div part="body" class="dialog__body" tabindex="-1"><slot></slot></div>

          <footer part="footer" class="dialog__footer">
            <slot name="footer"></slot>
          </footer>
        </div>
      </div>
    `}};Oc.styles=[qi,C$];Oc.dependencies={"sl-icon-button":zs};J([yi(".dialog")],Oc.prototype,"dialog",2);J([yi(".dialog__panel")],Oc.prototype,"panel",2);J([yi(".dialog__overlay")],Oc.prototype,"overlay",2);J([be({type:Boolean,reflect:!0})],Oc.prototype,"open",2);J([be({reflect:!0})],Oc.prototype,"label",2);J([be({attribute:"no-header",type:Boolean,reflect:!0})],Oc.prototype,"noHeader",2);J([hi("open",{waitUntilFirstUpdate:!0})],Oc.prototype,"handleOpenChange",1);_r("dialog.show",{keyframes:[{opacity:0,scale:.8},{opacity:1,scale:1}],options:{duration:250,easing:"ease"}});_r("dialog.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.8}],options:{duration:250,easing:"ease"}});_r("dialog.denyClose",{keyframes:[{scale:1},{scale:1.02},{scale:1}],options:{duration:250}});_r("dialog.overlay.show",{keyframes:[{opacity:0},{opacity:1}],options:{duration:250}});_r("dialog.overlay.hide",{keyframes:[{opacity:1},{opacity:0}],options:{duration:250}});Oc.define("sl-dialog");Ls.define("sl-checkbox");var I$=ji`
  :host {
    --grid-width: 280px;
    --grid-height: 200px;
    --grid-handle-size: 16px;
    --slider-height: 15px;
    --slider-handle-size: 17px;
    --swatch-size: 25px;

    display: inline-block;
  }

  .color-picker {
    width: var(--grid-width);
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    color: var(--color);
    background-color: var(--sl-panel-background-color);
    border-radius: var(--sl-border-radius-medium);
    user-select: none;
    -webkit-user-select: none;
  }

  .color-picker--inline {
    border: solid var(--sl-panel-border-width) var(--sl-panel-border-color);
  }

  .color-picker--inline:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .color-picker__grid {
    position: relative;
    height: var(--grid-height);
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%),
      linear-gradient(to right, #fff 0%, rgba(255, 255, 255, 0) 100%);
    border-top-left-radius: var(--sl-border-radius-medium);
    border-top-right-radius: var(--sl-border-radius-medium);
    cursor: crosshair;
    forced-color-adjust: none;
  }

  .color-picker__grid-handle {
    position: absolute;
    width: var(--grid-handle-size);
    height: var(--grid-handle-size);
    border-radius: 50%;
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25);
    border: solid 2px white;
    margin-top: calc(var(--grid-handle-size) / -2);
    margin-left: calc(var(--grid-handle-size) / -2);
    transition: var(--sl-transition-fast) scale;
  }

  .color-picker__grid-handle--dragging {
    cursor: none;
    scale: 1.5;
  }

  .color-picker__grid-handle:focus-visible {
    outline: var(--sl-focus-ring);
  }

  .color-picker__controls {
    padding: var(--sl-spacing-small);
    display: flex;
    align-items: center;
  }

  .color-picker__sliders {
    flex: 1 1 auto;
  }

  .color-picker__slider {
    position: relative;
    height: var(--slider-height);
    border-radius: var(--sl-border-radius-pill);
    box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2);
    forced-color-adjust: none;
  }

  .color-picker__slider:not(:last-of-type) {
    margin-bottom: var(--sl-spacing-small);
  }

  .color-picker__slider-handle {
    position: absolute;
    top: calc(50% - var(--slider-handle-size) / 2);
    width: var(--slider-handle-size);
    height: var(--slider-handle-size);
    background-color: white;
    border-radius: 50%;
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25);
    margin-left: calc(var(--slider-handle-size) / -2);
  }

  .color-picker__slider-handle:focus-visible {
    outline: var(--sl-focus-ring);
  }

  .color-picker__hue {
    background-image: linear-gradient(
      to right,
      rgb(255, 0, 0) 0%,
      rgb(255, 255, 0) 17%,
      rgb(0, 255, 0) 33%,
      rgb(0, 255, 255) 50%,
      rgb(0, 0, 255) 67%,
      rgb(255, 0, 255) 83%,
      rgb(255, 0, 0) 100%
    );
  }

  .color-picker__alpha .color-picker__alpha-gradient {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: inherit;
  }

  .color-picker__preview {
    flex: 0 0 auto;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 2.25rem;
    height: 2.25rem;
    border: none;
    border-radius: var(--sl-border-radius-circle);
    background: none;
    margin-left: var(--sl-spacing-small);
    cursor: copy;
    forced-color-adjust: none;
  }

  .color-picker__preview:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: inherit;
    box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2);

    /* We use a custom property in lieu of currentColor because of https://bugs.webkit.org/show_bug.cgi?id=216780 */
    background-color: var(--preview-color);
  }

  .color-picker__preview:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .color-picker__preview-color {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: solid 1px rgba(0, 0, 0, 0.125);
  }

  .color-picker__preview-color--copied {
    animation: pulse 0.75s;
  }

  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 var(--sl-color-primary-500);
    }
    70% {
      box-shadow: 0 0 0 0.5rem transparent;
    }
    100% {
      box-shadow: 0 0 0 0 transparent;
    }
  }

  .color-picker__user-input {
    display: flex;
    padding: 0 var(--sl-spacing-small) var(--sl-spacing-small) var(--sl-spacing-small);
  }

  .color-picker__user-input sl-input {
    min-width: 0; /* fix input width in Safari */
    flex: 1 1 auto;
  }

  .color-picker__user-input sl-button-group {
    margin-left: var(--sl-spacing-small);
  }

  .color-picker__user-input sl-button {
    min-width: 3.25rem;
    max-width: 3.25rem;
    font-size: 1rem;
  }

  .color-picker__swatches {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    grid-gap: 0.5rem;
    justify-items: center;
    border-top: solid 1px var(--sl-color-neutral-200);
    padding: var(--sl-spacing-small);
    forced-color-adjust: none;
  }

  .color-picker__swatch {
    position: relative;
    width: var(--swatch-size);
    height: var(--swatch-size);
    border-radius: var(--sl-border-radius-small);
  }

  .color-picker__swatch .color-picker__swatch-color {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: solid 1px rgba(0, 0, 0, 0.125);
    border-radius: inherit;
    cursor: pointer;
  }

  .color-picker__swatch:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .color-picker__transparent-bg {
    background-image: linear-gradient(45deg, var(--sl-color-neutral-300) 25%, transparent 25%),
      linear-gradient(45deg, transparent 75%, var(--sl-color-neutral-300) 75%),
      linear-gradient(45deg, transparent 75%, var(--sl-color-neutral-300) 75%),
      linear-gradient(45deg, var(--sl-color-neutral-300) 25%, transparent 25%);
    background-size: 10px 10px;
    background-position:
      0 0,
      0 0,
      -5px -5px,
      5px 5px;
  }

  .color-picker--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .color-picker--disabled .color-picker__grid,
  .color-picker--disabled .color-picker__grid-handle,
  .color-picker--disabled .color-picker__slider,
  .color-picker--disabled .color-picker__slider-handle,
  .color-picker--disabled .color-picker__preview,
  .color-picker--disabled .color-picker__swatch,
  .color-picker--disabled .color-picker__swatch-color {
    pointer-events: none;
  }

  /*
   * Color dropdown
   */

  .color-dropdown::part(panel) {
    max-height: none;
    background-color: var(--sl-panel-background-color);
    border: solid var(--sl-panel-border-width) var(--sl-panel-border-color);
    border-radius: var(--sl-border-radius-medium);
    overflow: visible;
  }

  .color-dropdown__trigger {
    display: inline-block;
    position: relative;
    background-color: transparent;
    border: none;
    cursor: pointer;
    forced-color-adjust: none;
  }

  .color-dropdown__trigger.color-dropdown__trigger--small {
    width: var(--sl-input-height-small);
    height: var(--sl-input-height-small);
    border-radius: var(--sl-border-radius-circle);
  }

  .color-dropdown__trigger.color-dropdown__trigger--medium {
    width: var(--sl-input-height-medium);
    height: var(--sl-input-height-medium);
    border-radius: var(--sl-border-radius-circle);
  }

  .color-dropdown__trigger.color-dropdown__trigger--large {
    width: var(--sl-input-height-large);
    height: var(--sl-input-height-large);
    border-radius: var(--sl-border-radius-circle);
  }

  .color-dropdown__trigger:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: inherit;
    background-color: currentColor;
    box-shadow:
      inset 0 0 0 2px var(--sl-input-border-color),
      inset 0 0 0 4px var(--sl-color-neutral-0);
  }

  .color-dropdown__trigger--empty:before {
    background-color: transparent;
  }

  .color-dropdown__trigger:focus-visible {
    outline: none;
  }

  .color-dropdown__trigger:focus-visible:not(.color-dropdown__trigger--disabled) {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .color-dropdown__trigger.color-dropdown__trigger--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`,br=class extends Li{constructor(){super(...arguments),this.formControlController=new Ch(this,{assumeInteractionOn:["click"]}),this.hasSlotController=new Uo(this,"[default]","prefix","suffix"),this.localize=new cr(this),this.hasFocus=!1,this.invalid=!1,this.title="",this.variant="default",this.size="medium",this.caret=!1,this.disabled=!1,this.loading=!1,this.outline=!1,this.pill=!1,this.circle=!1,this.type="button",this.name="",this.value="",this.href="",this.rel="noreferrer noopener"}get validity(){return this.isButton()?this.button.validity:uw}get validationMessage(){return this.isButton()?this.button.validationMessage:""}firstUpdated(){this.isButton()&&this.formControlController.updateValidity()}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleClick(){this.type==="submit"&&this.formControlController.submit(this),this.type==="reset"&&this.formControlController.reset(this)}handleInvalid(i){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(i)}isButton(){return!this.href}isLink(){return!!this.href}handleDisabledChange(){this.isButton()&&this.formControlController.setValidity(this.disabled)}click(){this.button.click()}focus(i){this.button.focus(i)}blur(){this.button.blur()}checkValidity(){return this.isButton()?this.button.checkValidity():!0}getForm(){return this.formControlController.getForm()}reportValidity(){return this.isButton()?this.button.reportValidity():!0}setCustomValidity(i){this.isButton()&&(this.button.setCustomValidity(i),this.formControlController.updateValidity())}render(){const i=this.isLink(),e=i?n1`a`:n1`button`;return Ay`
      <${e}
        part="base"
        class=${Xi({button:!0,"button--default":this.variant==="default","button--primary":this.variant==="primary","button--success":this.variant==="success","button--neutral":this.variant==="neutral","button--warning":this.variant==="warning","button--danger":this.variant==="danger","button--text":this.variant==="text","button--small":this.size==="small","button--medium":this.size==="medium","button--large":this.size==="large","button--caret":this.caret,"button--circle":this.circle,"button--disabled":this.disabled,"button--focused":this.hasFocus,"button--loading":this.loading,"button--standard":!this.outline,"button--outline":this.outline,"button--pill":this.pill,"button--rtl":this.localize.dir()==="rtl","button--has-label":this.hasSlotController.test("[default]"),"button--has-prefix":this.hasSlotController.test("prefix"),"button--has-suffix":this.hasSlotController.test("suffix")})}
        ?disabled=${Fi(i?void 0:this.disabled)}
        type=${Fi(i?void 0:this.type)}
        title=${this.title}
        name=${Fi(i?void 0:this.name)}
        value=${Fi(i?void 0:this.value)}
        href=${Fi(i&&!this.disabled?this.href:void 0)}
        target=${Fi(i?this.target:void 0)}
        download=${Fi(i?this.download:void 0)}
        rel=${Fi(i?this.rel:void 0)}
        role=${Fi(i?void 0:"button")}
        aria-disabled=${this.disabled?"true":"false"}
        tabindex=${this.disabled?"-1":"0"}
        @blur=${this.handleBlur}
        @focus=${this.handleFocus}
        @invalid=${this.isButton()?this.handleInvalid:null}
        @click=${this.handleClick}
      >
        <slot name="prefix" part="prefix" class="button__prefix"></slot>
        <slot part="label" class="button__label"></slot>
        <slot name="suffix" part="suffix" class="button__suffix"></slot>
        ${this.caret?Ay` <sl-icon part="caret" class="button__caret" library="system" name="caret"></sl-icon> `:""}
        ${this.loading?Ay`<sl-spinner part="spinner"></sl-spinner>`:""}
      </${e}>
    `}};br.styles=[qi,XO];br.dependencies={"sl-icon":kr,"sl-spinner":y0};J([yi(".button")],br.prototype,"button",2);J([Hi()],br.prototype,"hasFocus",2);J([Hi()],br.prototype,"invalid",2);J([be()],br.prototype,"title",2);J([be({reflect:!0})],br.prototype,"variant",2);J([be({reflect:!0})],br.prototype,"size",2);J([be({type:Boolean,reflect:!0})],br.prototype,"caret",2);J([be({type:Boolean,reflect:!0})],br.prototype,"disabled",2);J([be({type:Boolean,reflect:!0})],br.prototype,"loading",2);J([be({type:Boolean,reflect:!0})],br.prototype,"outline",2);J([be({type:Boolean,reflect:!0})],br.prototype,"pill",2);J([be({type:Boolean,reflect:!0})],br.prototype,"circle",2);J([be()],br.prototype,"type",2);J([be()],br.prototype,"name",2);J([be()],br.prototype,"value",2);J([be()],br.prototype,"href",2);J([be()],br.prototype,"target",2);J([be()],br.prototype,"rel",2);J([be()],br.prototype,"download",2);J([be()],br.prototype,"form",2);J([be({attribute:"formaction"})],br.prototype,"formAction",2);J([be({attribute:"formenctype"})],br.prototype,"formEnctype",2);J([be({attribute:"formmethod"})],br.prototype,"formMethod",2);J([be({attribute:"formnovalidate",type:Boolean})],br.prototype,"formNoValidate",2);J([be({attribute:"formtarget"})],br.prototype,"formTarget",2);J([hi("disabled",{waitUntilFirstUpdate:!0})],br.prototype,"handleDisabledChange",1);function ao(i,e){M$(i)&&(i="100%");const t=R$(i);return i=e===360?i:Math.min(e,Math.max(0,parseFloat(i))),t&&(i=parseInt(String(i*e),10)/100),Math.abs(i-e)<1e-6?1:(e===360?i=(i<0?i%e+e:i%e)/parseFloat(String(e)):i=i%e/parseFloat(String(e)),i)}function zv(i){return Math.min(1,Math.max(0,i))}function M$(i){return typeof i=="string"&&i.indexOf(".")!==-1&&parseFloat(i)===1}function R$(i){return typeof i=="string"&&i.indexOf("%")!==-1}function tF(i){return i=parseFloat(i),(isNaN(i)||i<0||i>1)&&(i=1),i}function Nv(i){return Number(i)<=1?`${Number(i)*100}%`:i}function of(i){return i.length===1?"0"+i:String(i)}function k$(i,e,t){return{r:ao(i,255)*255,g:ao(e,255)*255,b:ao(t,255)*255}}function xk(i,e,t){i=ao(i,255),e=ao(e,255),t=ao(t,255);const n=Math.max(i,e,t),s=Math.min(i,e,t);let c=0,f=0;const r=(n+s)/2;if(n===s)f=0,c=0;else{const b=n-s;switch(f=r>.5?b/(2-n-s):b/(n+s),n){case i:c=(e-t)/b+(e<t?6:0);break;case e:c=(t-i)/b+2;break;case t:c=(i-e)/b+4;break}c/=6}return{h:c,s:f,l:r}}function jT(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*(6*t):t<1/2?e:t<2/3?i+(e-i)*(2/3-t)*6:i}function P$(i,e,t){let n,s,c;if(i=ao(i,360),e=ao(e,100),t=ao(t,100),e===0)s=t,c=t,n=t;else{const f=t<.5?t*(1+e):t+e-t*e,r=2*t-f;n=jT(r,f,i+1/3),s=jT(r,f,i),c=jT(r,f,i-1/3)}return{r:n*255,g:s*255,b:c*255}}function wk(i,e,t){i=ao(i,255),e=ao(e,255),t=ao(t,255);const n=Math.max(i,e,t),s=Math.min(i,e,t);let c=0;const f=n,r=n-s,b=n===0?0:r/n;if(n===s)c=0;else{switch(n){case i:c=(e-t)/r+(e<t?6:0);break;case e:c=(t-i)/r+2;break;case t:c=(i-e)/r+4;break}c/=6}return{h:c,s:b,v:f}}function D$(i,e,t){i=ao(i,360)*6,e=ao(e,100),t=ao(t,100);const n=Math.floor(i),s=i-n,c=t*(1-e),f=t*(1-s*e),r=t*(1-(1-s)*e),b=n%6,w=[t,f,c,c,r,t][b],E=[r,t,t,f,c,c][b],k=[c,c,r,t,t,f][b];return{r:w*255,g:E*255,b:k*255}}function Ak(i,e,t,n){const s=[of(Math.round(i).toString(16)),of(Math.round(e).toString(16)),of(Math.round(t).toString(16))];return n&&s[0].startsWith(s[0].charAt(1))&&s[1].startsWith(s[1].charAt(1))&&s[2].startsWith(s[2].charAt(1))?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function B$(i,e,t,n,s){const c=[of(Math.round(i).toString(16)),of(Math.round(e).toString(16)),of(Math.round(t).toString(16)),of(F$(n))];return s&&c[0].startsWith(c[0].charAt(1))&&c[1].startsWith(c[1].charAt(1))&&c[2].startsWith(c[2].charAt(1))&&c[3].startsWith(c[3].charAt(1))?c[0].charAt(0)+c[1].charAt(0)+c[2].charAt(0)+c[3].charAt(0):c.join("")}function O$(i,e,t,n){const s=i/100,c=e/100,f=t/100,r=n/100,b=255*(1-s)*(1-r),w=255*(1-c)*(1-r),E=255*(1-f)*(1-r);return{r:b,g:w,b:E}}function Tk(i,e,t){let n=1-i/255,s=1-e/255,c=1-t/255,f=Math.min(n,s,c);return f===1?(n=0,s=0,c=0):(n=(n-f)/(1-f)*100,s=(s-f)/(1-f)*100,c=(c-f)/(1-f)*100),f*=100,{c:Math.round(n),m:Math.round(s),y:Math.round(c),k:Math.round(f)}}function F$(i){return Math.round(parseFloat(i)*255).toString(16)}function Sk(i){return Ia(i)/255}function Ia(i){return parseInt(i,16)}function L$(i){return{r:i>>16,g:(i&65280)>>8,b:i&255}}const fS={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function z$(i){let e={r:0,g:0,b:0},t=1,n=null,s=null,c=null,f=!1,r=!1;return typeof i=="string"&&(i=V$(i)),typeof i=="object"&&(Ta(i.r)&&Ta(i.g)&&Ta(i.b)?(e=k$(i.r,i.g,i.b),f=!0,r=String(i.r).substr(-1)==="%"?"prgb":"rgb"):Ta(i.h)&&Ta(i.s)&&Ta(i.v)?(n=Nv(i.s),s=Nv(i.v),e=D$(i.h,n,s),f=!0,r="hsv"):Ta(i.h)&&Ta(i.s)&&Ta(i.l)?(n=Nv(i.s),c=Nv(i.l),e=P$(i.h,n,c),f=!0,r="hsl"):Ta(i.c)&&Ta(i.m)&&Ta(i.y)&&Ta(i.k)&&(e=O$(i.c,i.m,i.y,i.k),f=!0,r="cmyk"),Object.prototype.hasOwnProperty.call(i,"a")&&(t=i.a)),t=tF(t),{ok:f,format:i.format||r,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}const N$="[-\\+]?\\d+%?",U$="[-\\+]?\\d*\\.\\d+%?",Mu="(?:"+U$+")|(?:"+N$+")",HT="[\\s|\\(]+("+Mu+")[,|\\s]+("+Mu+")[,|\\s]+("+Mu+")\\s*\\)?",Uv="[\\s|\\(]+("+Mu+")[,|\\s]+("+Mu+")[,|\\s]+("+Mu+")[,|\\s]+("+Mu+")\\s*\\)?",nl={CSS_UNIT:new RegExp(Mu),rgb:new RegExp("rgb"+HT),rgba:new RegExp("rgba"+Uv),hsl:new RegExp("hsl"+HT),hsla:new RegExp("hsla"+Uv),hsv:new RegExp("hsv"+HT),hsva:new RegExp("hsva"+Uv),cmyk:new RegExp("cmyk"+Uv),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function V$(i){if(i=i.trim().toLowerCase(),i.length===0)return!1;let e=!1;if(fS[i])i=fS[i],e=!0;else if(i==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};let t=nl.rgb.exec(i);return t?{r:t[1],g:t[2],b:t[3]}:(t=nl.rgba.exec(i),t?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=nl.hsl.exec(i),t?{h:t[1],s:t[2],l:t[3]}:(t=nl.hsla.exec(i),t?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=nl.hsv.exec(i),t?{h:t[1],s:t[2],v:t[3]}:(t=nl.hsva.exec(i),t?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=nl.cmyk.exec(i),t?{c:t[1],m:t[2],y:t[3],k:t[4]}:(t=nl.hex8.exec(i),t?{r:Ia(t[1]),g:Ia(t[2]),b:Ia(t[3]),a:Sk(t[4]),format:e?"name":"hex8"}:(t=nl.hex6.exec(i),t?{r:Ia(t[1]),g:Ia(t[2]),b:Ia(t[3]),format:e?"name":"hex"}:(t=nl.hex4.exec(i),t?{r:Ia(t[1]+t[1]),g:Ia(t[2]+t[2]),b:Ia(t[3]+t[3]),a:Sk(t[4]+t[4]),format:e?"name":"hex8"}:(t=nl.hex3.exec(i),t?{r:Ia(t[1]+t[1]),g:Ia(t[2]+t[2]),b:Ia(t[3]+t[3]),format:e?"name":"hex"}:!1))))))))))}function Ta(i){return typeof i=="number"?!Number.isNaN(i):nl.CSS_UNIT.test(i)}class is{constructor(e="",t={}){if(e instanceof is)return e;typeof e=="number"&&(e=L$(e)),this.originalInput=e;const n=z$(e);this.originalInput=e,this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a,this.roundA=Math.round(100*this.a)/100,this.format=t.format??n.format,this.gradientType=t.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=n.ok}isDark(){return this.getBrightness()<128}isLight(){return!this.isDark()}getBrightness(){const e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3}getLuminance(){const e=this.toRgb();let t,n,s;const c=e.r/255,f=e.g/255,r=e.b/255;return c<=.03928?t=c/12.92:t=Math.pow((c+.055)/1.055,2.4),f<=.03928?n=f/12.92:n=Math.pow((f+.055)/1.055,2.4),r<=.03928?s=r/12.92:s=Math.pow((r+.055)/1.055,2.4),.2126*t+.7152*n+.0722*s}getAlpha(){return this.a}setAlpha(e){return this.a=tF(e),this.roundA=Math.round(100*this.a)/100,this}isMonochrome(){const{s:e}=this.toHsl();return e===0}toHsv(){const e=wk(this.r,this.g,this.b);return{h:e.h*360,s:e.s,v:e.v,a:this.a}}toHsvString(){const e=wk(this.r,this.g,this.b),t=Math.round(e.h*360),n=Math.round(e.s*100),s=Math.round(e.v*100);return this.a===1?`hsv(${t}, ${n}%, ${s}%)`:`hsva(${t}, ${n}%, ${s}%, ${this.roundA})`}toHsl(){const e=xk(this.r,this.g,this.b);return{h:e.h*360,s:e.s,l:e.l,a:this.a}}toHslString(){const e=xk(this.r,this.g,this.b),t=Math.round(e.h*360),n=Math.round(e.s*100),s=Math.round(e.l*100);return this.a===1?`hsl(${t}, ${n}%, ${s}%)`:`hsla(${t}, ${n}%, ${s}%, ${this.roundA})`}toHex(e=!1){return Ak(this.r,this.g,this.b,e)}toHexString(e=!1){return"#"+this.toHex(e)}toHex8(e=!1){return B$(this.r,this.g,this.b,this.a,e)}toHex8String(e=!1){return"#"+this.toHex8(e)}toHexShortString(e=!1){return this.a===1?this.toHexString(e):this.toHex8String(e)}toRgb(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}}toRgbString(){const e=Math.round(this.r),t=Math.round(this.g),n=Math.round(this.b);return this.a===1?`rgb(${e}, ${t}, ${n})`:`rgba(${e}, ${t}, ${n}, ${this.roundA})`}toPercentageRgb(){const e=t=>`${Math.round(ao(t,255)*100)}%`;return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}}toPercentageRgbString(){const e=t=>Math.round(ao(t,255)*100);return this.a===1?`rgb(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%)`:`rgba(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%, ${this.roundA})`}toCmyk(){return{...Tk(this.r,this.g,this.b)}}toCmykString(){const{c:e,m:t,y:n,k:s}=Tk(this.r,this.g,this.b);return`cmyk(${e}, ${t}, ${n}, ${s})`}toName(){if(this.a===0)return"transparent";if(this.a<1)return!1;const e="#"+Ak(this.r,this.g,this.b,!1);for(const[t,n]of Object.entries(fS))if(e===n)return t;return!1}toString(e){const t=!!e;e=e??this.format;let n=!1;const s=this.a<1&&this.a>=0;return!t&&s&&(e.startsWith("hex")||e==="name")?e==="name"&&this.a===0?this.toName():this.toRgbString():(e==="rgb"&&(n=this.toRgbString()),e==="prgb"&&(n=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(n=this.toHexString()),e==="hex3"&&(n=this.toHexString(!0)),e==="hex4"&&(n=this.toHex8String(!0)),e==="hex8"&&(n=this.toHex8String()),e==="name"&&(n=this.toName()),e==="hsl"&&(n=this.toHslString()),e==="hsv"&&(n=this.toHsvString()),e==="cmyk"&&(n=this.toCmykString()),n||this.toHexString())}toNumber(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)}clone(){return new is(this.toString())}lighten(e=10){const t=this.toHsl();return t.l+=e/100,t.l=zv(t.l),new is(t)}brighten(e=10){const t=this.toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),new is(t)}darken(e=10){const t=this.toHsl();return t.l-=e/100,t.l=zv(t.l),new is(t)}tint(e=10){return this.mix("white",e)}shade(e=10){return this.mix("black",e)}desaturate(e=10){const t=this.toHsl();return t.s-=e/100,t.s=zv(t.s),new is(t)}saturate(e=10){const t=this.toHsl();return t.s+=e/100,t.s=zv(t.s),new is(t)}greyscale(){return this.desaturate(100)}spin(e){const t=this.toHsl(),n=(t.h+e)%360;return t.h=n<0?360+n:n,new is(t)}mix(e,t=50){const n=this.toRgb(),s=new is(e).toRgb(),c=t/100,f={r:(s.r-n.r)*c+n.r,g:(s.g-n.g)*c+n.g,b:(s.b-n.b)*c+n.b,a:(s.a-n.a)*c+n.a};return new is(f)}analogous(e=6,t=30){const n=this.toHsl(),s=360/t,c=[this];for(n.h=(n.h-(s*e>>1)+720)%360;--e;)n.h=(n.h+s)%360,c.push(new is(n));return c}complement(){const e=this.toHsl();return e.h=(e.h+180)%360,new is(e)}monochromatic(e=6){const t=this.toHsv(),{h:n}=t,{s}=t;let{v:c}=t;const f=[],r=1/e;for(;e--;)f.push(new is({h:n,s,v:c})),c=(c+r)%1;return f}splitcomplement(){const e=this.toHsl(),{h:t}=e;return[this,new is({h:(t+72)%360,s:e.s,l:e.l}),new is({h:(t+216)%360,s:e.s,l:e.l})]}onBackground(e){const t=this.toRgb(),n=new is(e).toRgb(),s=t.a+n.a*(1-t.a);return new is({r:(t.r*t.a+n.r*n.a*(1-t.a))/s,g:(t.g*t.a+n.g*n.a*(1-t.a))/s,b:(t.b*t.a+n.b*n.a*(1-t.a))/s,a:s})}triad(){return this.polyad(3)}tetrad(){return this.polyad(4)}polyad(e){const t=this.toHsl(),{h:n}=t,s=[this],c=360/e;for(let f=1;f<e;f++)s.push(new is({h:(n+f*c)%360,s:t.s,l:t.l}));return s}equals(e){const t=new is(e);return this.format==="cmyk"||t.format==="cmyk"?this.toCmykString()===t.toCmykString():this.toRgbString()===t.toRgbString()}}var Ek="EyeDropper"in window,Zn=class extends Li{constructor(){super(),this.formControlController=new Ch(this),this.isSafeValue=!1,this.localize=new cr(this),this.hasFocus=!1,this.isDraggingGridHandle=!1,this.isEmpty=!1,this.inputValue="",this.hue=0,this.saturation=100,this.brightness=100,this.alpha=100,this.value="",this.defaultValue="",this.label="",this.format="hex",this.inline=!1,this.size="medium",this.noFormatToggle=!1,this.name="",this.disabled=!1,this.hoist=!1,this.opacity=!1,this.uppercase=!1,this.swatches="",this.form="",this.required=!1,this.handleFocusIn=()=>{this.hasFocus=!0,this.emit("sl-focus")},this.handleFocusOut=()=>{this.hasFocus=!1,this.emit("sl-blur")},this.addEventListener("focusin",this.handleFocusIn),this.addEventListener("focusout",this.handleFocusOut)}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}firstUpdated(){this.input.updateComplete.then(()=>{this.formControlController.updateValidity()})}handleCopy(){this.input.select(),document.execCommand("copy"),this.previewButton.focus(),this.previewButton.classList.add("color-picker__preview-color--copied"),this.previewButton.addEventListener("animationend",()=>{this.previewButton.classList.remove("color-picker__preview-color--copied")})}handleFormatToggle(){const i=["hex","rgb","hsl","hsv"],e=(i.indexOf(this.format)+1)%i.length;this.format=i[e],this.setColor(this.value),this.emit("sl-change"),this.emit("sl-input")}handleAlphaDrag(i){const e=this.shadowRoot.querySelector(".color-picker__slider.color-picker__alpha"),t=e.querySelector(".color-picker__slider-handle"),{width:n}=e.getBoundingClientRect();let s=this.value,c=this.value;t.focus(),i.preventDefault(),Ey(e,{onMove:f=>{this.alpha=ws(f/n*100,0,100),this.syncValues(),this.value!==c&&(c=this.value,this.emit("sl-input"))},onStop:()=>{this.value!==s&&(s=this.value,this.emit("sl-change"))},initialEvent:i})}handleHueDrag(i){const e=this.shadowRoot.querySelector(".color-picker__slider.color-picker__hue"),t=e.querySelector(".color-picker__slider-handle"),{width:n}=e.getBoundingClientRect();let s=this.value,c=this.value;t.focus(),i.preventDefault(),Ey(e,{onMove:f=>{this.hue=ws(f/n*360,0,360),this.syncValues(),this.value!==c&&(c=this.value,this.emit("sl-input"))},onStop:()=>{this.value!==s&&(s=this.value,this.emit("sl-change"))},initialEvent:i})}handleGridDrag(i){const e=this.shadowRoot.querySelector(".color-picker__grid"),t=e.querySelector(".color-picker__grid-handle"),{width:n,height:s}=e.getBoundingClientRect();let c=this.value,f=this.value;t.focus(),i.preventDefault(),this.isDraggingGridHandle=!0,Ey(e,{onMove:(r,b)=>{this.saturation=ws(r/n*100,0,100),this.brightness=ws(100-b/s*100,0,100),this.syncValues(),this.value!==f&&(f=this.value,this.emit("sl-input"))},onStop:()=>{this.isDraggingGridHandle=!1,this.value!==c&&(c=this.value,this.emit("sl-change"))},initialEvent:i})}handleAlphaKeyDown(i){const e=i.shiftKey?10:1,t=this.value;i.key==="ArrowLeft"&&(i.preventDefault(),this.alpha=ws(this.alpha-e,0,100),this.syncValues()),i.key==="ArrowRight"&&(i.preventDefault(),this.alpha=ws(this.alpha+e,0,100),this.syncValues()),i.key==="Home"&&(i.preventDefault(),this.alpha=0,this.syncValues()),i.key==="End"&&(i.preventDefault(),this.alpha=100,this.syncValues()),this.value!==t&&(this.emit("sl-change"),this.emit("sl-input"))}handleHueKeyDown(i){const e=i.shiftKey?10:1,t=this.value;i.key==="ArrowLeft"&&(i.preventDefault(),this.hue=ws(this.hue-e,0,360),this.syncValues()),i.key==="ArrowRight"&&(i.preventDefault(),this.hue=ws(this.hue+e,0,360),this.syncValues()),i.key==="Home"&&(i.preventDefault(),this.hue=0,this.syncValues()),i.key==="End"&&(i.preventDefault(),this.hue=360,this.syncValues()),this.value!==t&&(this.emit("sl-change"),this.emit("sl-input"))}handleGridKeyDown(i){const e=i.shiftKey?10:1,t=this.value;i.key==="ArrowLeft"&&(i.preventDefault(),this.saturation=ws(this.saturation-e,0,100),this.syncValues()),i.key==="ArrowRight"&&(i.preventDefault(),this.saturation=ws(this.saturation+e,0,100),this.syncValues()),i.key==="ArrowUp"&&(i.preventDefault(),this.brightness=ws(this.brightness+e,0,100),this.syncValues()),i.key==="ArrowDown"&&(i.preventDefault(),this.brightness=ws(this.brightness-e,0,100),this.syncValues()),this.value!==t&&(this.emit("sl-change"),this.emit("sl-input"))}handleInputChange(i){const e=i.target,t=this.value;i.stopPropagation(),this.input.value?(this.setColor(e.value),e.value=this.value):this.value="",this.value!==t&&(this.emit("sl-change"),this.emit("sl-input"))}handleInputInput(i){this.formControlController.updateValidity(),i.stopPropagation()}handleInputKeyDown(i){if(i.key==="Enter"){const e=this.value;this.input.value?(this.setColor(this.input.value),this.input.value=this.value,this.value!==e&&(this.emit("sl-change"),this.emit("sl-input")),setTimeout(()=>this.input.select())):this.hue=0}}handleInputInvalid(i){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(i)}handleTouchMove(i){i.preventDefault()}parseColor(i){const e=new is(i);if(!e.isValid)return null;const t=e.toHsl(),n={h:t.h,s:t.s*100,l:t.l*100,a:t.a},s=e.toRgb(),c=e.toHexString(),f=e.toHex8String(),r=e.toHsv(),b={h:r.h,s:r.s*100,v:r.v*100,a:r.a};return{hsl:{h:n.h,s:n.s,l:n.l,string:this.setLetterCase(`hsl(${Math.round(n.h)}, ${Math.round(n.s)}%, ${Math.round(n.l)}%)`)},hsla:{h:n.h,s:n.s,l:n.l,a:n.a,string:this.setLetterCase(`hsla(${Math.round(n.h)}, ${Math.round(n.s)}%, ${Math.round(n.l)}%, ${n.a.toFixed(2).toString()})`)},hsv:{h:b.h,s:b.s,v:b.v,string:this.setLetterCase(`hsv(${Math.round(b.h)}, ${Math.round(b.s)}%, ${Math.round(b.v)}%)`)},hsva:{h:b.h,s:b.s,v:b.v,a:b.a,string:this.setLetterCase(`hsva(${Math.round(b.h)}, ${Math.round(b.s)}%, ${Math.round(b.v)}%, ${b.a.toFixed(2).toString()})`)},rgb:{r:s.r,g:s.g,b:s.b,string:this.setLetterCase(`rgb(${Math.round(s.r)}, ${Math.round(s.g)}, ${Math.round(s.b)})`)},rgba:{r:s.r,g:s.g,b:s.b,a:s.a,string:this.setLetterCase(`rgba(${Math.round(s.r)}, ${Math.round(s.g)}, ${Math.round(s.b)}, ${s.a.toFixed(2).toString()})`)},hex:this.setLetterCase(c),hexa:this.setLetterCase(f)}}setColor(i){const e=this.parseColor(i);return e===null?!1:(this.hue=e.hsva.h,this.saturation=e.hsva.s,this.brightness=e.hsva.v,this.alpha=this.opacity?e.hsva.a*100:100,this.syncValues(),!0)}setLetterCase(i){return typeof i!="string"?"":this.uppercase?i.toUpperCase():i.toLowerCase()}async syncValues(){const i=this.parseColor(`hsva(${this.hue}, ${this.saturation}%, ${this.brightness}%, ${this.alpha/100})`);i!==null&&(this.format==="hsl"?this.inputValue=this.opacity?i.hsla.string:i.hsl.string:this.format==="rgb"?this.inputValue=this.opacity?i.rgba.string:i.rgb.string:this.format==="hsv"?this.inputValue=this.opacity?i.hsva.string:i.hsv.string:this.inputValue=this.opacity?i.hexa:i.hex,this.isSafeValue=!0,this.value=this.inputValue,await this.updateComplete,this.isSafeValue=!1)}handleAfterHide(){this.previewButton.classList.remove("color-picker__preview-color--copied")}handleEyeDropper(){if(!Ek)return;new EyeDropper().open().then(e=>{const t=this.value;this.setColor(e.sRGBHex),this.value!==t&&(this.emit("sl-change"),this.emit("sl-input"))}).catch(()=>{})}selectSwatch(i){const e=this.value;this.disabled||(this.setColor(i),this.value!==e&&(this.emit("sl-change"),this.emit("sl-input")))}getHexString(i,e,t,n=100){const s=new is(`hsva(${i}, ${e}%, ${t}%, ${n/100})`);return s.isValid?s.toHex8String():""}stopNestedEventPropagation(i){i.stopImmediatePropagation()}handleFormatChange(){this.syncValues()}handleOpacityChange(){this.alpha=100}handleValueChange(i,e){if(this.isEmpty=!e,e||(this.hue=0,this.saturation=0,this.brightness=100,this.alpha=100),!this.isSafeValue){const t=this.parseColor(e);t!==null?(this.inputValue=this.value,this.hue=t.hsva.h,this.saturation=t.hsva.s,this.brightness=t.hsva.v,this.alpha=t.hsva.a*100,this.syncValues()):this.inputValue=i??""}}focus(i){this.inline?this.base.focus(i):this.trigger.focus(i)}blur(){var i;const e=this.inline?this.base:this.trigger;this.hasFocus&&(e.focus({preventScroll:!0}),e.blur()),(i=this.dropdown)!=null&&i.open&&this.dropdown.hide()}getFormattedValue(i="hex"){const e=this.parseColor(`hsva(${this.hue}, ${this.saturation}%, ${this.brightness}%, ${this.alpha/100})`);if(e===null)return"";switch(i){case"hex":return e.hex;case"hexa":return e.hexa;case"rgb":return e.rgb.string;case"rgba":return e.rgba.string;case"hsl":return e.hsl.string;case"hsla":return e.hsla.string;case"hsv":return e.hsv.string;case"hsva":return e.hsva.string;default:return""}}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return!this.inline&&!this.validity.valid?(this.dropdown.show(),this.addEventListener("sl-after-show",()=>this.input.reportValidity(),{once:!0}),this.disabled||this.formControlController.emitInvalidEvent(),!1):this.input.reportValidity()}setCustomValidity(i){this.input.setCustomValidity(i),this.formControlController.updateValidity()}render(){const i=this.saturation,e=100-this.brightness,t=Array.isArray(this.swatches)?this.swatches:this.swatches.split(";").filter(s=>s.trim()!==""),n=ei`
      <div
        part="base"
        class=${Xi({"color-picker":!0,"color-picker--inline":this.inline,"color-picker--disabled":this.disabled,"color-picker--focused":this.hasFocus})}
        aria-disabled=${this.disabled?"true":"false"}
        aria-labelledby="label"
        tabindex=${this.inline?"0":"-1"}
      >
        ${this.inline?ei`
              <sl-visually-hidden id="label">
                <slot name="label">${this.label}</slot>
              </sl-visually-hidden>
            `:null}

        <div
          part="grid"
          class="color-picker__grid"
          style=${Qo({backgroundColor:this.getHexString(this.hue,100,100)})}
          @pointerdown=${this.handleGridDrag}
          @touchmove=${this.handleTouchMove}
        >
          <span
            part="grid-handle"
            class=${Xi({"color-picker__grid-handle":!0,"color-picker__grid-handle--dragging":this.isDraggingGridHandle})}
            style=${Qo({top:`${e}%`,left:`${i}%`,backgroundColor:this.getHexString(this.hue,this.saturation,this.brightness,this.alpha)})}
            role="application"
            aria-label="HSV"
            tabindex=${Fi(this.disabled?void 0:"0")}
            @keydown=${this.handleGridKeyDown}
          ></span>
        </div>

        <div class="color-picker__controls">
          <div class="color-picker__sliders">
            <div
              part="slider hue-slider"
              class="color-picker__hue color-picker__slider"
              @pointerdown=${this.handleHueDrag}
              @touchmove=${this.handleTouchMove}
            >
              <span
                part="slider-handle hue-slider-handle"
                class="color-picker__slider-handle"
                style=${Qo({left:`${this.hue===0?0:100/(360/this.hue)}%`})}
                role="slider"
                aria-label="hue"
                aria-orientation="horizontal"
                aria-valuemin="0"
                aria-valuemax="360"
                aria-valuenow=${`${Math.round(this.hue)}`}
                tabindex=${Fi(this.disabled?void 0:"0")}
                @keydown=${this.handleHueKeyDown}
              ></span>
            </div>

            ${this.opacity?ei`
                  <div
                    part="slider opacity-slider"
                    class="color-picker__alpha color-picker__slider color-picker__transparent-bg"
                    @pointerdown="${this.handleAlphaDrag}"
                    @touchmove=${this.handleTouchMove}
                  >
                    <div
                      class="color-picker__alpha-gradient"
                      style=${Qo({backgroundImage:`linear-gradient(
                          to right,
                          ${this.getHexString(this.hue,this.saturation,this.brightness,0)} 0%,
                          ${this.getHexString(this.hue,this.saturation,this.brightness,100)} 100%
                        )`})}
                    ></div>
                    <span
                      part="slider-handle opacity-slider-handle"
                      class="color-picker__slider-handle"
                      style=${Qo({left:`${this.alpha}%`})}
                      role="slider"
                      aria-label="alpha"
                      aria-orientation="horizontal"
                      aria-valuemin="0"
                      aria-valuemax="100"
                      aria-valuenow=${Math.round(this.alpha)}
                      tabindex=${Fi(this.disabled?void 0:"0")}
                      @keydown=${this.handleAlphaKeyDown}
                    ></span>
                  </div>
                `:""}
          </div>

          <button
            type="button"
            part="preview"
            class="color-picker__preview color-picker__transparent-bg"
            aria-label=${this.localize.term("copy")}
            style=${Qo({"--preview-color":this.getHexString(this.hue,this.saturation,this.brightness,this.alpha)})}
            @click=${this.handleCopy}
          ></button>
        </div>

        <div class="color-picker__user-input" aria-live="polite">
          <sl-input
            part="input"
            type="text"
            name=${this.name}
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
            value=${this.isEmpty?"":this.inputValue}
            ?required=${this.required}
            ?disabled=${this.disabled}
            aria-label=${this.localize.term("currentValue")}
            @keydown=${this.handleInputKeyDown}
            @sl-change=${this.handleInputChange}
            @sl-input=${this.handleInputInput}
            @sl-invalid=${this.handleInputInvalid}
            @sl-blur=${this.stopNestedEventPropagation}
            @sl-focus=${this.stopNestedEventPropagation}
          ></sl-input>

          <sl-button-group>
            ${this.noFormatToggle?"":ei`
                  <sl-button
                    part="format-button"
                    aria-label=${this.localize.term("toggleColorFormat")}
                    exportparts="
                      base:format-button__base,
                      prefix:format-button__prefix,
                      label:format-button__label,
                      suffix:format-button__suffix,
                      caret:format-button__caret
                    "
                    @click=${this.handleFormatToggle}
                    @sl-blur=${this.stopNestedEventPropagation}
                    @sl-focus=${this.stopNestedEventPropagation}
                  >
                    ${this.setLetterCase(this.format)}
                  </sl-button>
                `}
            ${Ek?ei`
                  <sl-button
                    part="eye-dropper-button"
                    exportparts="
                      base:eye-dropper-button__base,
                      prefix:eye-dropper-button__prefix,
                      label:eye-dropper-button__label,
                      suffix:eye-dropper-button__suffix,
                      caret:eye-dropper-button__caret
                    "
                    @click=${this.handleEyeDropper}
                    @sl-blur=${this.stopNestedEventPropagation}
                    @sl-focus=${this.stopNestedEventPropagation}
                  >
                    <sl-icon
                      library="system"
                      name="eyedropper"
                      label=${this.localize.term("selectAColorFromTheScreen")}
                    ></sl-icon>
                  </sl-button>
                `:""}
          </sl-button-group>
        </div>

        ${t.length>0?ei`
              <div part="swatches" class="color-picker__swatches">
                ${t.map(s=>{const c=this.parseColor(s);return c?ei`
                    <div
                      part="swatch"
                      class="color-picker__swatch color-picker__transparent-bg"
                      tabindex=${Fi(this.disabled?void 0:"0")}
                      role="button"
                      aria-label=${s}
                      @click=${()=>this.selectSwatch(s)}
                      @keydown=${f=>!this.disabled&&f.key==="Enter"&&this.setColor(c.hexa)}
                    >
                      <div
                        class="color-picker__swatch-color"
                        style=${Qo({backgroundColor:c.hexa})}
                      ></div>
                    </div>
                  `:(console.error(`Unable to parse swatch color: "${s}"`,this),"")})}
              </div>
            `:""}
      </div>
    `;return this.inline?n:ei`
      <sl-dropdown
        class="color-dropdown"
        aria-disabled=${this.disabled?"true":"false"}
        .containingElement=${this}
        ?disabled=${this.disabled}
        ?hoist=${this.hoist}
        @sl-after-hide=${this.handleAfterHide}
      >
        <button
          part="trigger"
          slot="trigger"
          class=${Xi({"color-dropdown__trigger":!0,"color-dropdown__trigger--disabled":this.disabled,"color-dropdown__trigger--small":this.size==="small","color-dropdown__trigger--medium":this.size==="medium","color-dropdown__trigger--large":this.size==="large","color-dropdown__trigger--empty":this.isEmpty,"color-dropdown__trigger--focused":this.hasFocus,"color-picker__transparent-bg":!0})}
          style=${Qo({color:this.getHexString(this.hue,this.saturation,this.brightness,this.alpha)})}
          type="button"
        >
          <sl-visually-hidden>
            <slot name="label">${this.label}</slot>
          </sl-visually-hidden>
        </button>
        ${n}
      </sl-dropdown>
    `}};Zn.styles=[qi,I$];Zn.dependencies={"sl-button-group":kf,"sl-button":br,"sl-dropdown":po,"sl-icon":kr,"sl-input":En,"sl-visually-hidden":UE};J([yi('[part~="base"]')],Zn.prototype,"base",2);J([yi('[part~="input"]')],Zn.prototype,"input",2);J([yi(".color-dropdown")],Zn.prototype,"dropdown",2);J([yi('[part~="preview"]')],Zn.prototype,"previewButton",2);J([yi('[part~="trigger"]')],Zn.prototype,"trigger",2);J([Hi()],Zn.prototype,"hasFocus",2);J([Hi()],Zn.prototype,"isDraggingGridHandle",2);J([Hi()],Zn.prototype,"isEmpty",2);J([Hi()],Zn.prototype,"inputValue",2);J([Hi()],Zn.prototype,"hue",2);J([Hi()],Zn.prototype,"saturation",2);J([Hi()],Zn.prototype,"brightness",2);J([Hi()],Zn.prototype,"alpha",2);J([be()],Zn.prototype,"value",2);J([Hm()],Zn.prototype,"defaultValue",2);J([be()],Zn.prototype,"label",2);J([be()],Zn.prototype,"format",2);J([be({type:Boolean,reflect:!0})],Zn.prototype,"inline",2);J([be({reflect:!0})],Zn.prototype,"size",2);J([be({attribute:"no-format-toggle",type:Boolean})],Zn.prototype,"noFormatToggle",2);J([be()],Zn.prototype,"name",2);J([be({type:Boolean,reflect:!0})],Zn.prototype,"disabled",2);J([be({type:Boolean})],Zn.prototype,"hoist",2);J([be({type:Boolean})],Zn.prototype,"opacity",2);J([be({type:Boolean})],Zn.prototype,"uppercase",2);J([be()],Zn.prototype,"swatches",2);J([be({reflect:!0})],Zn.prototype,"form",2);J([be({type:Boolean,reflect:!0})],Zn.prototype,"required",2);J([m0({passive:!1})],Zn.prototype,"handleTouchMove",1);J([hi("format",{waitUntilFirstUpdate:!0})],Zn.prototype,"handleFormatChange",1);J([hi("opacity",{waitUntilFirstUpdate:!0})],Zn.prototype,"handleOpacityChange",1);J([hi("value")],Zn.prototype,"handleValueChange",1);Zn.define("sl-color-picker");var $$=ji`
  :host {
    --border-color: var(--sl-color-neutral-200);
    --border-radius: var(--sl-border-radius-medium);
    --border-width: 1px;
    --padding: var(--sl-spacing-large);

    display: inline-block;
  }

  .card {
    display: flex;
    flex-direction: column;
    background-color: var(--sl-panel-background-color);
    box-shadow: var(--sl-shadow-x-small);
    border: solid var(--border-width) var(--border-color);
    border-radius: var(--border-radius);
  }

  .card__image {
    display: flex;
    border-top-left-radius: var(--border-radius);
    border-top-right-radius: var(--border-radius);
    margin: calc(-1 * var(--border-width));
    overflow: hidden;
  }

  .card__image::slotted(img) {
    display: block;
    width: 100%;
  }

  .card:not(.card--has-image) .card__image {
    display: none;
  }

  .card__header {
    display: block;
    border-bottom: solid var(--border-width) var(--border-color);
    padding: calc(var(--padding) / 2) var(--padding);
  }

  .card:not(.card--has-header) .card__header {
    display: none;
  }

  .card:not(.card--has-image) .card__header {
    border-top-left-radius: var(--border-radius);
    border-top-right-radius: var(--border-radius);
  }

  .card__body {
    display: block;
    padding: var(--padding);
  }

  .card--has-footer .card__footer {
    display: block;
    border-top: solid var(--border-width) var(--border-color);
    padding: var(--padding);
  }

  .card:not(.card--has-footer) .card__footer {
    display: none;
  }
`,iF=class extends Li{constructor(){super(...arguments),this.hasSlotController=new Uo(this,"footer","header","image")}render(){return ei`
      <div
        part="base"
        class=${Xi({card:!0,"card--has-footer":this.hasSlotController.test("footer"),"card--has-image":this.hasSlotController.test("image"),"card--has-header":this.hasSlotController.test("header")})}
      >
        <slot name="image" part="image" class="card__image"></slot>
        <slot name="header" part="header" class="card__header"></slot>
        <slot part="body" class="card__body"></slot>
        <slot name="footer" part="footer" class="card__footer"></slot>
      </div>
    `}};iF.styles=[qi,$$];iF.define("sl-card");var j$=class{constructor(i,e){this.timerId=0,this.activeInteractions=0,this.paused=!1,this.stopped=!0,this.pause=()=>{this.activeInteractions++||(this.paused=!0,this.host.requestUpdate())},this.resume=()=>{--this.activeInteractions||(this.paused=!1,this.host.requestUpdate())},i.addController(this),this.host=i,this.tickCallback=e}hostConnected(){this.host.addEventListener("mouseenter",this.pause),this.host.addEventListener("mouseleave",this.resume),this.host.addEventListener("focusin",this.pause),this.host.addEventListener("focusout",this.resume),this.host.addEventListener("touchstart",this.pause,{passive:!0}),this.host.addEventListener("touchend",this.resume)}hostDisconnected(){this.stop(),this.host.removeEventListener("mouseenter",this.pause),this.host.removeEventListener("mouseleave",this.resume),this.host.removeEventListener("focusin",this.pause),this.host.removeEventListener("focusout",this.resume),this.host.removeEventListener("touchstart",this.pause),this.host.removeEventListener("touchend",this.resume)}start(i){this.stop(),this.stopped=!1,this.timerId=window.setInterval(()=>{this.paused||this.tickCallback()},i)}stop(){clearInterval(this.timerId),this.stopped=!0,this.host.requestUpdate()}},H$=ji`
  :host {
    --slide-gap: var(--sl-spacing-medium, 1rem);
    --aspect-ratio: 16 / 9;
    --scroll-hint: 0px;

    display: flex;
  }

  .carousel {
    display: grid;
    grid-template-columns: min-content 1fr min-content;
    grid-template-rows: 1fr min-content;
    grid-template-areas:
      '. slides .'
      '. pagination .';
    gap: var(--sl-spacing-medium);
    align-items: center;
    min-height: 100%;
    min-width: 100%;
    position: relative;
  }

  .carousel__pagination {
    grid-area: pagination;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--sl-spacing-small);
  }

  .carousel__slides {
    grid-area: slides;

    display: grid;
    height: 100%;
    width: 100%;
    align-items: center;
    justify-items: center;
    overflow: auto;
    overscroll-behavior-x: contain;
    scrollbar-width: none;
    aspect-ratio: calc(var(--aspect-ratio) * var(--slides-per-page));
    border-radius: var(--sl-border-radius-small);

    --slide-size: calc((100% - (var(--slides-per-page) - 1) * var(--slide-gap)) / var(--slides-per-page));
  }

  @media (prefers-reduced-motion) {
    :where(.carousel__slides) {
      scroll-behavior: auto;
    }
  }

  .carousel__slides--horizontal {
    grid-auto-flow: column;
    grid-auto-columns: var(--slide-size);
    grid-auto-rows: 100%;
    column-gap: var(--slide-gap);
    scroll-snap-type: x mandatory;
    scroll-padding-inline: var(--scroll-hint);
    padding-inline: var(--scroll-hint);
    overflow-y: hidden;
  }

  .carousel__slides--vertical {
    grid-auto-flow: row;
    grid-auto-columns: 100%;
    grid-auto-rows: var(--slide-size);
    row-gap: var(--slide-gap);
    scroll-snap-type: y mandatory;
    scroll-padding-block: var(--scroll-hint);
    padding-block: var(--scroll-hint);
    overflow-x: hidden;
  }

  .carousel__slides--dragging {
  }

  :host([vertical]) ::slotted(sl-carousel-item) {
    height: 100%;
  }

  .carousel__slides::-webkit-scrollbar {
    display: none;
  }

  .carousel__navigation {
    grid-area: navigation;
    display: contents;
    font-size: var(--sl-font-size-x-large);
  }

  .carousel__navigation-button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    background: none;
    border: none;
    border-radius: var(--sl-border-radius-small);
    font-size: inherit;
    color: var(--sl-color-neutral-600);
    padding: var(--sl-spacing-x-small);
    cursor: pointer;
    transition: var(--sl-transition-medium) color;
    appearance: none;
  }

  .carousel__navigation-button--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .carousel__navigation-button--disabled::part(base) {
    pointer-events: none;
  }

  .carousel__navigation-button--previous {
    grid-column: 1;
    grid-row: 1;
  }

  .carousel__navigation-button--next {
    grid-column: 3;
    grid-row: 1;
  }

  .carousel__pagination-item {
    display: block;
    cursor: pointer;
    background: none;
    border: 0;
    border-radius: var(--sl-border-radius-circle);
    width: var(--sl-spacing-small);
    height: var(--sl-spacing-small);
    background-color: var(--sl-color-neutral-300);
    padding: 0;
    margin: 0;
  }

  .carousel__pagination-item--active {
    background-color: var(--sl-color-neutral-700);
    transform: scale(1.2);
  }

  /* Focus styles */
  .carousel__slides:focus-visible,
  .carousel__navigation-button:focus-visible,
  .carousel__pagination-item:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*W$(i,e){if(i!==void 0){let t=0;for(const n of i)yield e(n,t++)}}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*G$(i,e,t=1){const n=e===void 0?0:i;e??(e=i);for(let s=n;t>0?s<e:e<s;s+=t)yield s}var as=class extends Li{constructor(){super(...arguments),this.loop=!1,this.navigation=!1,this.pagination=!1,this.autoplay=!1,this.autoplayInterval=3e3,this.slidesPerPage=1,this.slidesPerMove=1,this.orientation="horizontal",this.mouseDragging=!1,this.activeSlide=0,this.scrolling=!1,this.dragging=!1,this.autoplayController=new j$(this,()=>this.next()),this.dragStartPosition=[-1,-1],this.localize=new cr(this),this.pendingSlideChange=!1,this.handleMouseDrag=i=>{this.dragging||(this.scrollContainer.style.setProperty("scroll-snap-type","none"),this.dragging=!0,this.dragStartPosition=[i.clientX,i.clientY]),this.scrollContainer.scrollBy({left:-i.movementX,top:-i.movementY,behavior:"instant"})},this.handleMouseDragEnd=()=>{const i=this.scrollContainer;document.removeEventListener("pointermove",this.handleMouseDrag,{capture:!0});const e=i.scrollLeft,t=i.scrollTop;i.style.removeProperty("scroll-snap-type"),i.style.setProperty("overflow","hidden");const n=i.scrollLeft,s=i.scrollTop;i.style.removeProperty("overflow"),i.style.setProperty("scroll-snap-type","none"),i.scrollTo({left:e,top:t,behavior:"instant"}),requestAnimationFrame(async()=>{(e!==n||t!==s)&&(i.scrollTo({left:n,top:s,behavior:rS()?"auto":"smooth"}),await No(i,"scrollend")),i.style.removeProperty("scroll-snap-type"),this.dragging=!1,this.dragStartPosition=[-1,-1],this.handleScrollEnd()})},this.handleSlotChange=i=>{i.some(t=>[...t.addedNodes,...t.removedNodes].some(n=>this.isCarouselItem(n)&&!n.hasAttribute("data-clone")))&&this.initializeSlides(),this.requestUpdate()}}connectedCallback(){super.connectedCallback(),this.setAttribute("role","region"),this.setAttribute("aria-label",this.localize.term("carousel"))}disconnectedCallback(){var i;super.disconnectedCallback(),(i=this.mutationObserver)==null||i.disconnect()}firstUpdated(){this.initializeSlides(),this.mutationObserver=new MutationObserver(this.handleSlotChange),this.mutationObserver.observe(this,{childList:!0,subtree:!0})}willUpdate(i){(i.has("slidesPerMove")||i.has("slidesPerPage"))&&(this.slidesPerMove=Math.min(this.slidesPerMove,this.slidesPerPage))}getPageCount(){const i=this.getSlides().length,{slidesPerPage:e,slidesPerMove:t,loop:n}=this,s=n?i/t:(i-e)/t+1;return Math.ceil(s)}getCurrentPage(){return Math.ceil(this.activeSlide/this.slidesPerMove)}canScrollNext(){return this.loop||this.getCurrentPage()<this.getPageCount()-1}canScrollPrev(){return this.loop||this.getCurrentPage()>0}getSlides({excludeClones:i=!0}={}){return[...this.children].filter(e=>this.isCarouselItem(e)&&(!i||!e.hasAttribute("data-clone")))}handleClick(i){if(this.dragging&&this.dragStartPosition[0]>0&&this.dragStartPosition[1]>0){const e=Math.abs(this.dragStartPosition[0]-i.clientX),t=Math.abs(this.dragStartPosition[1]-i.clientY);Math.sqrt(e*e+t*t)>=10&&i.preventDefault()}}handleKeyDown(i){if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(i.key)){const e=i.target,t=this.localize.dir()==="rtl",n=e.closest('[part~="pagination-item"]')!==null,s=i.key==="ArrowDown"||!t&&i.key==="ArrowRight"||t&&i.key==="ArrowLeft",c=i.key==="ArrowUp"||!t&&i.key==="ArrowLeft"||t&&i.key==="ArrowRight";i.preventDefault(),c&&this.previous(),s&&this.next(),i.key==="Home"&&this.goToSlide(0),i.key==="End"&&this.goToSlide(this.getSlides().length-1),n&&this.updateComplete.then(()=>{var f;const r=(f=this.shadowRoot)==null?void 0:f.querySelector('[part~="pagination-item--active"]');r&&r.focus()})}}handleMouseDragStart(i){this.mouseDragging&&i.button===0&&(i.preventDefault(),document.addEventListener("pointermove",this.handleMouseDrag,{capture:!0,passive:!0}),document.addEventListener("pointerup",this.handleMouseDragEnd,{capture:!0,once:!0}))}handleScroll(){this.scrolling=!0,this.pendingSlideChange||this.synchronizeSlides()}synchronizeSlides(){const i=new IntersectionObserver(e=>{i.disconnect();for(const r of e){const b=r.target;b.toggleAttribute("inert",!r.isIntersecting),b.classList.toggle("--in-view",r.isIntersecting),b.setAttribute("aria-hidden",r.isIntersecting?"false":"true")}const t=e.find(r=>r.isIntersecting);if(!t)return;const n=this.getSlides({excludeClones:!1}),s=this.getSlides().length,c=n.indexOf(t.target),f=this.loop?c-this.slidesPerPage:c;if(this.activeSlide=(Math.ceil(f/this.slidesPerMove)*this.slidesPerMove+s)%s,!this.scrolling&&this.loop&&t.target.hasAttribute("data-clone")){const r=Number(t.target.getAttribute("data-clone"));this.goToSlide(r,"instant")}},{root:this.scrollContainer,threshold:.6});this.getSlides({excludeClones:!1}).forEach(e=>{i.observe(e)})}handleScrollEnd(){!this.scrolling||this.dragging||(this.scrolling=!1,this.pendingSlideChange=!1,this.synchronizeSlides())}isCarouselItem(i){return i instanceof Element&&i.tagName.toLowerCase()==="sl-carousel-item"}initializeSlides(){this.getSlides({excludeClones:!1}).forEach((i,e)=>{i.classList.remove("--in-view"),i.classList.remove("--is-active"),i.setAttribute("role","group"),i.setAttribute("aria-label",this.localize.term("slideNum",e+1)),this.pagination&&(i.setAttribute("id",`slide-${e+1}`),i.setAttribute("role","tabpanel"),i.removeAttribute("aria-label"),i.setAttribute("aria-labelledby",`tab-${e+1}`)),i.hasAttribute("data-clone")&&i.remove()}),this.updateSlidesSnap(),this.loop&&this.createClones(),this.goToSlide(this.activeSlide,"auto"),this.synchronizeSlides()}createClones(){const i=this.getSlides(),e=this.slidesPerPage,t=i.slice(-e),n=i.slice(0,e);t.reverse().forEach((s,c)=>{const f=s.cloneNode(!0);f.setAttribute("data-clone",String(i.length-c-1)),this.prepend(f)}),n.forEach((s,c)=>{const f=s.cloneNode(!0);f.setAttribute("data-clone",String(c)),this.append(f)})}handleSlideChange(){const i=this.getSlides();i.forEach((e,t)=>{e.classList.toggle("--is-active",t===this.activeSlide)}),this.hasUpdated&&this.emit("sl-slide-change",{detail:{index:this.activeSlide,slide:i[this.activeSlide]}})}updateSlidesSnap(){const i=this.getSlides(),e=this.slidesPerMove;i.forEach((t,n)=>{(n+e)%e===0?t.style.removeProperty("scroll-snap-align"):t.style.setProperty("scroll-snap-align","none")})}handleAutoplayChange(){this.autoplayController.stop(),this.autoplay&&this.autoplayController.start(this.autoplayInterval)}previous(i="smooth"){this.goToSlide(this.activeSlide-this.slidesPerMove,i)}next(i="smooth"){this.goToSlide(this.activeSlide+this.slidesPerMove,i)}goToSlide(i,e="smooth"){const{slidesPerPage:t,loop:n}=this,s=this.getSlides(),c=this.getSlides({excludeClones:!1});if(!s.length)return;const f=n?(i+s.length)%s.length:ws(i,0,s.length-t);this.activeSlide=f;const r=this.localize.dir()==="rtl",b=ws(i+(n?t:0)+(r?t-1:0),0,c.length-1),w=c[b];this.scrollToSlide(w,rS()?"auto":e)}scrollToSlide(i,e="smooth"){this.pendingSlideChange=!0,window.requestAnimationFrame(()=>{if(!this.scrollContainer)return;const t=this.scrollContainer,n=t.getBoundingClientRect(),s=i.getBoundingClientRect(),c=s.left-n.left,f=s.top-n.top;c||f?(this.pendingSlideChange=!0,t.scrollTo({left:c+t.scrollLeft,top:f+t.scrollTop,behavior:e})):this.pendingSlideChange=!1})}render(){const{slidesPerMove:i,scrolling:e}=this,t=this.getPageCount(),n=this.getCurrentPage(),s=this.canScrollPrev(),c=this.canScrollNext(),f=this.localize.dir()==="ltr";return ei`
      <div part="base" class="carousel">
        <div
          id="scroll-container"
          part="scroll-container"
          class="${Xi({carousel__slides:!0,"carousel__slides--horizontal":this.orientation==="horizontal","carousel__slides--vertical":this.orientation==="vertical","carousel__slides--dragging":this.dragging})}"
          style="--slides-per-page: ${this.slidesPerPage};"
          aria-busy="${e?"true":"false"}"
          aria-atomic="true"
          tabindex="0"
          @keydown=${this.handleKeyDown}
          @mousedown="${this.handleMouseDragStart}"
          @scroll="${this.handleScroll}"
          @scrollend=${this.handleScrollEnd}
          @click=${this.handleClick}
        >
          <slot></slot>
        </div>

        ${this.navigation?ei`
              <div part="navigation" class="carousel__navigation">
                <button
                  part="navigation-button navigation-button--previous"
                  class="${Xi({"carousel__navigation-button":!0,"carousel__navigation-button--previous":!0,"carousel__navigation-button--disabled":!s})}"
                  aria-label="${this.localize.term("previousSlide")}"
                  aria-controls="scroll-container"
                  aria-disabled="${s?"false":"true"}"
                  @click=${s?()=>this.previous():null}
                >
                  <slot name="previous-icon">
                    <sl-icon library="system" name="${f?"chevron-left":"chevron-right"}"></sl-icon>
                  </slot>
                </button>

                <button
                  part="navigation-button navigation-button--next"
                  class=${Xi({"carousel__navigation-button":!0,"carousel__navigation-button--next":!0,"carousel__navigation-button--disabled":!c})}
                  aria-label="${this.localize.term("nextSlide")}"
                  aria-controls="scroll-container"
                  aria-disabled="${c?"false":"true"}"
                  @click=${c?()=>this.next():null}
                >
                  <slot name="next-icon">
                    <sl-icon library="system" name="${f?"chevron-right":"chevron-left"}"></sl-icon>
                  </slot>
                </button>
              </div>
            `:""}
        ${this.pagination?ei`
              <div part="pagination" role="tablist" class="carousel__pagination">
                ${W$(G$(t),r=>{const b=r===n;return ei`
                    <button
                      part="pagination-item ${b?"pagination-item--active":""}"
                      class="${Xi({"carousel__pagination-item":!0,"carousel__pagination-item--active":b})}"
                      role="tab"
                      id="tab-${r+1}"
                      aria-controls="slide-${r+1}"
                      aria-selected="${b?"true":"false"}"
                      aria-label="${b?this.localize.term("slideNum",r+1):this.localize.term("goToSlide",r+1,t)}"
                      tabindex=${b?"0":"-1"}
                      @click=${()=>this.goToSlide(r*i)}
                      @keydown=${this.handleKeyDown}
                    ></button>
                  `})}
              </div>
            `:""}
      </div>
    `}};as.styles=[qi,H$];as.dependencies={"sl-icon":kr};J([be({type:Boolean,reflect:!0})],as.prototype,"loop",2);J([be({type:Boolean,reflect:!0})],as.prototype,"navigation",2);J([be({type:Boolean,reflect:!0})],as.prototype,"pagination",2);J([be({type:Boolean,reflect:!0})],as.prototype,"autoplay",2);J([be({type:Number,attribute:"autoplay-interval"})],as.prototype,"autoplayInterval",2);J([be({type:Number,attribute:"slides-per-page"})],as.prototype,"slidesPerPage",2);J([be({type:Number,attribute:"slides-per-move"})],as.prototype,"slidesPerMove",2);J([be()],as.prototype,"orientation",2);J([be({type:Boolean,reflect:!0,attribute:"mouse-dragging"})],as.prototype,"mouseDragging",2);J([yi(".carousel__slides")],as.prototype,"scrollContainer",2);J([yi(".carousel__pagination")],as.prototype,"paginationContainer",2);J([Hi()],as.prototype,"activeSlide",2);J([Hi()],as.prototype,"scrolling",2);J([Hi()],as.prototype,"dragging",2);J([m0({passive:!0})],as.prototype,"handleScroll",1);J([hi("loop",{waitUntilFirstUpdate:!0}),hi("slidesPerPage",{waitUntilFirstUpdate:!0})],as.prototype,"initializeSlides",1);J([hi("activeSlide")],as.prototype,"handleSlideChange",1);J([hi("slidesPerMove")],as.prototype,"updateSlidesSnap",1);J([hi("autoplay")],as.prototype,"handleAutoplayChange",1);as.define("sl-carousel");var X$=(i,e)=>{let t=0;return function(...n){window.clearTimeout(t),t=window.setTimeout(()=>{i.call(this,...n)},e)}},Ck=(i,e,t)=>{const n=i[e];i[e]=function(...s){n.call(this,...s),t.call(this,n,...s)}};(()=>{if(typeof window>"u")return;if(!("onscrollend"in window)){const e=new Set,t=new WeakMap,n=c=>{for(const f of c.changedTouches)e.add(f.identifier)},s=c=>{for(const f of c.changedTouches)e.delete(f.identifier)};document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",s,!0),document.addEventListener("touchcancel",s,!0),Ck(EventTarget.prototype,"addEventListener",function(c,f){if(f!=="scrollend")return;const r=X$(()=>{e.size?r():this.dispatchEvent(new Event("scrollend"))},100);c.call(this,"scroll",r,{passive:!0}),t.set(this,r)}),Ck(EventTarget.prototype,"removeEventListener",function(c,f){if(f!=="scrollend")return;const r=t.get(this);r&&c.call(this,"scroll",r,{passive:!0})})}})();var q$=ji`
  :host {
    --aspect-ratio: inherit;

    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    width: 100%;
    max-height: 100%;
    aspect-ratio: var(--aspect-ratio);
    scroll-snap-align: start;
    scroll-snap-stop: always;
  }

  ::slotted(img) {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover;
  }
`,nF=class extends Li{connectedCallback(){super.connectedCallback()}render(){return ei` <slot></slot> `}};nF.styles=[qi,q$];nF.define("sl-carousel-item");var Y$=ji`
  :host {
    display: inline-flex;
  }

  .breadcrumb-item {
    display: inline-flex;
    align-items: center;
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-small);
    font-weight: var(--sl-font-weight-semibold);
    color: var(--sl-color-neutral-600);
    line-height: var(--sl-line-height-normal);
    white-space: nowrap;
  }

  .breadcrumb-item__label {
    display: inline-block;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    line-height: inherit;
    text-decoration: none;
    color: inherit;
    background: none;
    border: none;
    border-radius: var(--sl-border-radius-medium);
    padding: 0;
    margin: 0;
    cursor: pointer;
    transition: var(--sl-transition-fast) --color;
  }

  :host(:not(:last-of-type)) .breadcrumb-item__label {
    color: var(--sl-color-primary-600);
  }

  :host(:not(:last-of-type)) .breadcrumb-item__label:hover {
    color: var(--sl-color-primary-500);
  }

  :host(:not(:last-of-type)) .breadcrumb-item__label:active {
    color: var(--sl-color-primary-600);
  }

  .breadcrumb-item__label:focus {
    outline: none;
  }

  .breadcrumb-item__label:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .breadcrumb-item__prefix,
  .breadcrumb-item__suffix {
    display: none;
    flex: 0 0 auto;
    display: flex;
    align-items: center;
  }

  .breadcrumb-item--has-prefix .breadcrumb-item__prefix {
    display: inline-flex;
    margin-inline-end: var(--sl-spacing-x-small);
  }

  .breadcrumb-item--has-suffix .breadcrumb-item__suffix {
    display: inline-flex;
    margin-inline-start: var(--sl-spacing-x-small);
  }

  :host(:last-of-type) .breadcrumb-item__separator {
    display: none;
  }

  .breadcrumb-item__separator {
    display: inline-flex;
    align-items: center;
    margin: 0 var(--sl-spacing-x-small);
    user-select: none;
    -webkit-user-select: none;
  }
`,Hu=class extends Li{constructor(){super(...arguments),this.hasSlotController=new Uo(this,"prefix","suffix"),this.renderType="button",this.rel="noreferrer noopener"}setRenderType(){const i=this.defaultSlot.assignedElements({flatten:!0}).filter(e=>e.tagName.toLowerCase()==="sl-dropdown").length>0;if(this.href){this.renderType="link";return}if(i){this.renderType="dropdown";return}this.renderType="button"}hrefChanged(){this.setRenderType()}handleSlotChange(){this.setRenderType()}render(){return ei`
      <div
        part="base"
        class=${Xi({"breadcrumb-item":!0,"breadcrumb-item--has-prefix":this.hasSlotController.test("prefix"),"breadcrumb-item--has-suffix":this.hasSlotController.test("suffix")})}
      >
        <span part="prefix" class="breadcrumb-item__prefix">
          <slot name="prefix"></slot>
        </span>

        ${this.renderType==="link"?ei`
              <a
                part="label"
                class="breadcrumb-item__label breadcrumb-item__label--link"
                href="${this.href}"
                target="${Fi(this.target?this.target:void 0)}"
                rel=${Fi(this.target?this.rel:void 0)}
              >
                <slot @slotchange=${this.handleSlotChange}></slot>
              </a>
            `:""}
        ${this.renderType==="button"?ei`
              <button part="label" type="button" class="breadcrumb-item__label breadcrumb-item__label--button">
                <slot @slotchange=${this.handleSlotChange}></slot>
              </button>
            `:""}
        ${this.renderType==="dropdown"?ei`
              <div part="label" class="breadcrumb-item__label breadcrumb-item__label--drop-down">
                <slot @slotchange=${this.handleSlotChange}></slot>
              </div>
            `:""}

        <span part="suffix" class="breadcrumb-item__suffix">
          <slot name="suffix"></slot>
        </span>

        <span part="separator" class="breadcrumb-item__separator" aria-hidden="true">
          <slot name="separator"></slot>
        </span>
      </div>
    `}};Hu.styles=[qi,Y$];J([yi("slot:not([name])")],Hu.prototype,"defaultSlot",2);J([Hi()],Hu.prototype,"renderType",2);J([be()],Hu.prototype,"href",2);J([be()],Hu.prototype,"target",2);J([be()],Hu.prototype,"rel",2);J([hi("href",{waitUntilFirstUpdate:!0})],Hu.prototype,"hrefChanged",1);Hu.define("sl-breadcrumb-item");kf.define("sl-button-group");var Z$=ji`
  :host {
    display: inline-block;

    --size: 3rem;
  }

  .avatar {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: var(--size);
    height: var(--size);
    background-color: var(--sl-color-neutral-400);
    font-family: var(--sl-font-sans);
    font-size: calc(var(--size) * 0.5);
    font-weight: var(--sl-font-weight-normal);
    color: var(--sl-color-neutral-0);
    user-select: none;
    -webkit-user-select: none;
    vertical-align: middle;
  }

  .avatar--circle,
  .avatar--circle .avatar__image {
    border-radius: var(--sl-border-radius-circle);
  }

  .avatar--rounded,
  .avatar--rounded .avatar__image {
    border-radius: var(--sl-border-radius-medium);
  }

  .avatar--square {
    border-radius: 0;
  }

  .avatar__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .avatar__initials {
    line-height: 1;
    text-transform: uppercase;
  }

  .avatar__image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    overflow: hidden;
  }
`,Fc=class extends Li{constructor(){super(...arguments),this.hasError=!1,this.image="",this.label="",this.initials="",this.loading="eager",this.shape="circle"}handleImageChange(){this.hasError=!1}handleImageLoadError(){this.hasError=!0,this.emit("sl-error")}render(){const i=ei`
      <img
        part="image"
        class="avatar__image"
        src="${this.image}"
        loading="${this.loading}"
        alt=""
        @error="${this.handleImageLoadError}"
      />
    `;let e=ei``;return this.initials?e=ei`<div part="initials" class="avatar__initials">${this.initials}</div>`:e=ei`
        <div part="icon" class="avatar__icon" aria-hidden="true">
          <slot name="icon">
            <sl-icon name="person-fill" library="system"></sl-icon>
          </slot>
        </div>
      `,ei`
      <div
        part="base"
        class=${Xi({avatar:!0,"avatar--circle":this.shape==="circle","avatar--rounded":this.shape==="rounded","avatar--square":this.shape==="square"})}
        role="img"
        aria-label=${this.label}
      >
        ${this.image&&!this.hasError?i:e}
      </div>
    `}};Fc.styles=[qi,Z$];Fc.dependencies={"sl-icon":kr};J([Hi()],Fc.prototype,"hasError",2);J([be()],Fc.prototype,"image",2);J([be()],Fc.prototype,"label",2);J([be()],Fc.prototype,"initials",2);J([be()],Fc.prototype,"loading",2);J([be({reflect:!0})],Fc.prototype,"shape",2);J([hi("image")],Fc.prototype,"handleImageChange",1);Fc.define("sl-avatar");var K$=ji`
  .breadcrumb {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
  }
`,Zm=class extends Li{constructor(){super(...arguments),this.localize=new cr(this),this.separatorDir=this.localize.dir(),this.label=""}getSeparator(){const e=this.separatorSlot.assignedElements({flatten:!0})[0].cloneNode(!0);return[e,...e.querySelectorAll("[id]")].forEach(t=>t.removeAttribute("id")),e.setAttribute("data-default",""),e.slot="separator",e}handleSlotChange(){const i=[...this.defaultSlot.assignedElements({flatten:!0})].filter(e=>e.tagName.toLowerCase()==="sl-breadcrumb-item");i.forEach((e,t)=>{const n=e.querySelector('[slot="separator"]');n===null?e.append(this.getSeparator()):n.hasAttribute("data-default")&&n.replaceWith(this.getSeparator()),t===i.length-1?e.setAttribute("aria-current","page"):e.removeAttribute("aria-current")})}render(){return this.separatorDir!==this.localize.dir()&&(this.separatorDir=this.localize.dir(),this.updateComplete.then(()=>this.handleSlotChange())),ei`
      <nav part="base" class="breadcrumb" aria-label=${this.label}>
        <slot @slotchange=${this.handleSlotChange}></slot>
      </nav>

      <span hidden aria-hidden="true">
        <slot name="separator">
          <sl-icon name=${this.localize.dir()==="rtl"?"chevron-left":"chevron-right"} library="system"></sl-icon>
        </slot>
      </span>
    `}};Zm.styles=[qi,K$];Zm.dependencies={"sl-icon":kr};J([yi("slot")],Zm.prototype,"defaultSlot",2);J([yi('slot[name="separator"]')],Zm.prototype,"separatorSlot",2);J([be()],Zm.prototype,"label",2);Zm.define("sl-breadcrumb");br.define("sl-button");var J$=ji`
  :host {
    --control-box-size: 3rem;
    --icon-size: calc(var(--control-box-size) * 0.625);

    display: inline-flex;
    position: relative;
    cursor: pointer;
  }

  img {
    display: block;
    width: 100%;
    height: 100%;
  }

  img[aria-hidden='true'] {
    display: none;
  }

  .animated-image__control-box {
    display: flex;
    position: absolute;
    align-items: center;
    justify-content: center;
    top: calc(50% - var(--control-box-size) / 2);
    right: calc(50% - var(--control-box-size) / 2);
    width: var(--control-box-size);
    height: var(--control-box-size);
    font-size: var(--icon-size);
    background: none;
    border: solid 2px currentColor;
    background-color: rgb(0 0 0 /50%);
    border-radius: var(--sl-border-radius-circle);
    color: white;
    pointer-events: none;
    transition: var(--sl-transition-fast) opacity;
  }

  :host([play]:hover) .animated-image__control-box {
    opacity: 1;
  }

  :host([play]:not(:hover)) .animated-image__control-box {
    opacity: 0;
  }

  :host([play]) slot[name='play-icon'],
  :host(:not([play])) slot[name='pause-icon'] {
    display: none;
  }
`,Xl=class extends Li{constructor(){super(...arguments),this.isLoaded=!1}handleClick(){this.play=!this.play}handleLoad(){const i=document.createElement("canvas"),{width:e,height:t}=this.animatedImage;i.width=e,i.height=t,i.getContext("2d").drawImage(this.animatedImage,0,0,e,t),this.frozenFrame=i.toDataURL("image/gif"),this.isLoaded||(this.emit("sl-load"),this.isLoaded=!0)}handleError(){this.emit("sl-error")}handlePlayChange(){this.play&&(this.animatedImage.src="",this.animatedImage.src=this.src)}handleSrcChange(){this.isLoaded=!1}render(){return ei`
      <div class="animated-image">
        <img
          class="animated-image__animated"
          src=${this.src}
          alt=${this.alt}
          crossorigin="anonymous"
          aria-hidden=${this.play?"false":"true"}
          @click=${this.handleClick}
          @load=${this.handleLoad}
          @error=${this.handleError}
        />

        ${this.isLoaded?ei`
              <img
                class="animated-image__frozen"
                src=${this.frozenFrame}
                alt=${this.alt}
                aria-hidden=${this.play?"true":"false"}
                @click=${this.handleClick}
              />

              <div part="control-box" class="animated-image__control-box">
                <slot name="play-icon"><sl-icon name="play-fill" library="system"></sl-icon></slot>
                <slot name="pause-icon"><sl-icon name="pause-fill" library="system"></sl-icon></slot>
              </div>
            `:""}
      </div>
    `}};Xl.styles=[qi,J$];Xl.dependencies={"sl-icon":kr};J([yi(".animated-image__animated")],Xl.prototype,"animatedImage",2);J([Hi()],Xl.prototype,"frozenFrame",2);J([Hi()],Xl.prototype,"isLoaded",2);J([be()],Xl.prototype,"src",2);J([be()],Xl.prototype,"alt",2);J([be({type:Boolean,reflect:!0})],Xl.prototype,"play",2);J([hi("play",{waitUntilFirstUpdate:!0})],Xl.prototype,"handlePlayChange",1);J([hi("src")],Xl.prototype,"handleSrcChange",1);Xl.define("sl-animated-image");var Q$=ji`
  :host {
    display: inline-flex;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: max(12px, 0.75em);
    font-weight: var(--sl-font-weight-semibold);
    letter-spacing: var(--sl-letter-spacing-normal);
    line-height: 1;
    border-radius: var(--sl-border-radius-small);
    border: solid 1px var(--sl-color-neutral-0);
    white-space: nowrap;
    padding: 0.35em 0.6em;
    user-select: none;
    -webkit-user-select: none;
    cursor: inherit;
  }

  /* Variant modifiers */
  .badge--primary {
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .badge--success {
    background-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .badge--neutral {
    background-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .badge--warning {
    background-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  .badge--danger {
    background-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  /* Pill modifier */
  .badge--pill {
    border-radius: var(--sl-border-radius-pill);
  }

  /* Pulse modifier */
  .badge--pulse {
    animation: pulse 1.5s infinite;
  }

  .badge--pulse.badge--primary {
    --pulse-color: var(--sl-color-primary-600);
  }

  .badge--pulse.badge--success {
    --pulse-color: var(--sl-color-success-600);
  }

  .badge--pulse.badge--neutral {
    --pulse-color: var(--sl-color-neutral-600);
  }

  .badge--pulse.badge--warning {
    --pulse-color: var(--sl-color-warning-600);
  }

  .badge--pulse.badge--danger {
    --pulse-color: var(--sl-color-danger-600);
  }

  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 var(--pulse-color);
    }
    70% {
      box-shadow: 0 0 0 0.5rem transparent;
    }
    100% {
      box-shadow: 0 0 0 0 transparent;
    }
  }
`,A0=class extends Li{constructor(){super(...arguments),this.variant="primary",this.pill=!1,this.pulse=!1}render(){return ei`
      <span
        part="base"
        class=${Xi({badge:!0,"badge--primary":this.variant==="primary","badge--success":this.variant==="success","badge--neutral":this.variant==="neutral","badge--warning":this.variant==="warning","badge--danger":this.variant==="danger","badge--pill":this.pill,"badge--pulse":this.pulse})}
        role="status"
      >
        <slot></slot>
      </span>
    `}};A0.styles=[qi,Q$];J([be({reflect:!0})],A0.prototype,"variant",2);J([be({type:Boolean,reflect:!0})],A0.prototype,"pill",2);J([be({type:Boolean,reflect:!0})],A0.prototype,"pulse",2);A0.define("sl-badge");var ej=ji`
  :host {
    display: contents;

    /* For better DX, we'll reset the margin here so the base part can inherit it */
    margin: 0;
  }

  .alert {
    position: relative;
    display: flex;
    align-items: stretch;
    background-color: var(--sl-panel-background-color);
    border: solid var(--sl-panel-border-width) var(--sl-panel-border-color);
    border-top-width: calc(var(--sl-panel-border-width) * 3);
    border-radius: var(--sl-border-radius-medium);
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-small);
    font-weight: var(--sl-font-weight-normal);
    line-height: 1.6;
    color: var(--sl-color-neutral-700);
    margin: inherit;
    overflow: hidden;
  }

  .alert:not(.alert--has-icon) .alert__icon,
  .alert:not(.alert--closable) .alert__close-button {
    display: none;
  }

  .alert__icon {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-large);
    padding-inline-start: var(--sl-spacing-large);
  }

  .alert--has-countdown {
    border-bottom: none;
  }

  .alert--primary {
    border-top-color: var(--sl-color-primary-600);
  }

  .alert--primary .alert__icon {
    color: var(--sl-color-primary-600);
  }

  .alert--success {
    border-top-color: var(--sl-color-success-600);
  }

  .alert--success .alert__icon {
    color: var(--sl-color-success-600);
  }

  .alert--neutral {
    border-top-color: var(--sl-color-neutral-600);
  }

  .alert--neutral .alert__icon {
    color: var(--sl-color-neutral-600);
  }

  .alert--warning {
    border-top-color: var(--sl-color-warning-600);
  }

  .alert--warning .alert__icon {
    color: var(--sl-color-warning-600);
  }

  .alert--danger {
    border-top-color: var(--sl-color-danger-600);
  }

  .alert--danger .alert__icon {
    color: var(--sl-color-danger-600);
  }

  .alert__message {
    flex: 1 1 auto;
    display: block;
    padding: var(--sl-spacing-large);
    overflow: hidden;
  }

  .alert__close-button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-medium);
    margin-inline-end: var(--sl-spacing-medium);
    align-self: center;
  }

  .alert__countdown {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: calc(var(--sl-panel-border-width) * 3);
    background-color: var(--sl-panel-border-color);
    display: flex;
  }

  .alert__countdown--ltr {
    justify-content: flex-end;
  }

  .alert__countdown .alert__countdown-elapsed {
    height: 100%;
    width: 0;
  }

  .alert--primary .alert__countdown-elapsed {
    background-color: var(--sl-color-primary-600);
  }

  .alert--success .alert__countdown-elapsed {
    background-color: var(--sl-color-success-600);
  }

  .alert--neutral .alert__countdown-elapsed {
    background-color: var(--sl-color-neutral-600);
  }

  .alert--warning .alert__countdown-elapsed {
    background-color: var(--sl-color-warning-600);
  }

  .alert--danger .alert__countdown-elapsed {
    background-color: var(--sl-color-danger-600);
  }

  .alert__timer {
    display: none;
  }
`,Va=class Kd extends Li{constructor(){super(...arguments),this.hasSlotController=new Uo(this,"icon","suffix"),this.localize=new cr(this),this.open=!1,this.closable=!1,this.variant="primary",this.duration=1/0,this.remainingTime=this.duration}static get toastStack(){return this.currentToastStack||(this.currentToastStack=Object.assign(document.createElement("div"),{className:"sl-toast-stack"})),this.currentToastStack}firstUpdated(){this.base.hidden=!this.open}restartAutoHide(){this.handleCountdownChange(),clearTimeout(this.autoHideTimeout),clearInterval(this.remainingTimeInterval),this.open&&this.duration<1/0&&(this.autoHideTimeout=window.setTimeout(()=>this.hide(),this.duration),this.remainingTime=this.duration,this.remainingTimeInterval=window.setInterval(()=>{this.remainingTime-=100},100))}pauseAutoHide(){var e;(e=this.countdownAnimation)==null||e.pause(),clearTimeout(this.autoHideTimeout),clearInterval(this.remainingTimeInterval)}resumeAutoHide(){var e;this.duration<1/0&&(this.autoHideTimeout=window.setTimeout(()=>this.hide(),this.remainingTime),this.remainingTimeInterval=window.setInterval(()=>{this.remainingTime-=100},100),(e=this.countdownAnimation)==null||e.play())}handleCountdownChange(){if(this.open&&this.duration<1/0&&this.countdown){const{countdownElement:e}=this,t="100%",n="0";this.countdownAnimation=e.animate([{width:t},{width:n}],{duration:this.duration,easing:"linear"})}}handleCloseClick(){this.hide()}async handleOpenChange(){if(this.open){this.emit("sl-show"),this.duration<1/0&&this.restartAutoHide(),await Es(this.base),this.base.hidden=!1;const{keyframes:e,options:t}=jr(this,"alert.show",{dir:this.localize.dir()});await ss(this.base,e,t),this.emit("sl-after-show")}else{HE(this),this.emit("sl-hide"),clearTimeout(this.autoHideTimeout),clearInterval(this.remainingTimeInterval),await Es(this.base);const{keyframes:e,options:t}=jr(this,"alert.hide",{dir:this.localize.dir()});await ss(this.base,e,t),this.base.hidden=!0,this.emit("sl-after-hide")}}handleDurationChange(){this.restartAutoHide()}async show(){if(!this.open)return this.open=!0,No(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,No(this,"sl-after-hide")}async toast(){return new Promise(e=>{this.handleCountdownChange(),Kd.toastStack.parentElement===null&&document.body.append(Kd.toastStack),Kd.toastStack.appendChild(this),requestAnimationFrame(()=>{this.clientWidth,this.show()}),this.addEventListener("sl-after-hide",()=>{Kd.toastStack.removeChild(this),e(),Kd.toastStack.querySelector("sl-alert")===null&&Kd.toastStack.remove()},{once:!0})})}render(){return ei`
      <div
        part="base"
        class=${Xi({alert:!0,"alert--open":this.open,"alert--closable":this.closable,"alert--has-countdown":!!this.countdown,"alert--has-icon":this.hasSlotController.test("icon"),"alert--primary":this.variant==="primary","alert--success":this.variant==="success","alert--neutral":this.variant==="neutral","alert--warning":this.variant==="warning","alert--danger":this.variant==="danger"})}
        role="alert"
        aria-hidden=${this.open?"false":"true"}
        @mouseenter=${this.pauseAutoHide}
        @mouseleave=${this.resumeAutoHide}
      >
        <div part="icon" class="alert__icon">
          <slot name="icon"></slot>
        </div>

        <div part="message" class="alert__message" aria-live="polite">
          <slot></slot>
        </div>

        ${this.closable?ei`
              <sl-icon-button
                part="close-button"
                exportparts="base:close-button__base"
                class="alert__close-button"
                name="x-lg"
                library="system"
                label=${this.localize.term("close")}
                @click=${this.handleCloseClick}
              ></sl-icon-button>
            `:""}

        <div role="timer" class="alert__timer">${this.remainingTime}</div>

        ${this.countdown?ei`
              <div
                class=${Xi({alert__countdown:!0,"alert__countdown--ltr":this.countdown==="ltr"})}
              >
                <div class="alert__countdown-elapsed"></div>
              </div>
            `:""}
      </div>
    `}};Va.styles=[qi,ej];Va.dependencies={"sl-icon-button":zs};J([yi('[part~="base"]')],Va.prototype,"base",2);J([yi(".alert__countdown-elapsed")],Va.prototype,"countdownElement",2);J([be({type:Boolean,reflect:!0})],Va.prototype,"open",2);J([be({type:Boolean,reflect:!0})],Va.prototype,"closable",2);J([be({reflect:!0})],Va.prototype,"variant",2);J([be({type:Number})],Va.prototype,"duration",2);J([be({type:String,reflect:!0})],Va.prototype,"countdown",2);J([Hi()],Va.prototype,"remainingTime",2);J([hi("open",{waitUntilFirstUpdate:!0})],Va.prototype,"handleOpenChange",1);J([hi("duration")],Va.prototype,"handleDurationChange",1);var tj=Va;_r("alert.show",{keyframes:[{opacity:0,scale:.8},{opacity:1,scale:1}],options:{duration:250,easing:"ease"}});_r("alert.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.8}],options:{duration:250,easing:"ease"}});tj.define("sl-alert");const ij=[{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0)"},{offset:.2,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0)"},{offset:.4,easing:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",transform:"translate3d(0, -30px, 0) scaleY(1.1)"},{offset:.43,easing:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",transform:"translate3d(0, -30px, 0) scaleY(1.1)"},{offset:.53,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0)"},{offset:.7,easing:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",transform:"translate3d(0, -15px, 0) scaleY(1.05)"},{offset:.8,"transition-timing-function":"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0) scaleY(0.95)"},{offset:.9,transform:"translate3d(0, -4px, 0) scaleY(1.02)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0)"}],nj=[{offset:0,opacity:"1"},{offset:.25,opacity:"0"},{offset:.5,opacity:"1"},{offset:.75,opacity:"0"},{offset:1,opacity:"1"}],rj=[{offset:0,transform:"translateX(0)"},{offset:.065,transform:"translateX(-6px) rotateY(-9deg)"},{offset:.185,transform:"translateX(5px) rotateY(7deg)"},{offset:.315,transform:"translateX(-3px) rotateY(-5deg)"},{offset:.435,transform:"translateX(2px) rotateY(3deg)"},{offset:.5,transform:"translateX(0)"}],sj=[{offset:0,transform:"scale(1)"},{offset:.14,transform:"scale(1.3)"},{offset:.28,transform:"scale(1)"},{offset:.42,transform:"scale(1.3)"},{offset:.7,transform:"scale(1)"}],oj=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.111,transform:"translate3d(0, 0, 0)"},{offset:.222,transform:"skewX(-12.5deg) skewY(-12.5deg)"},{offset:.33299999999999996,transform:"skewX(6.25deg) skewY(6.25deg)"},{offset:.444,transform:"skewX(-3.125deg) skewY(-3.125deg)"},{offset:.555,transform:"skewX(1.5625deg) skewY(1.5625deg)"},{offset:.6659999999999999,transform:"skewX(-0.78125deg) skewY(-0.78125deg)"},{offset:.777,transform:"skewX(0.390625deg) skewY(0.390625deg)"},{offset:.888,transform:"skewX(-0.1953125deg) skewY(-0.1953125deg)"},{offset:1,transform:"translate3d(0, 0, 0)"}],aj=[{offset:0,transform:"scale3d(1, 1, 1)"},{offset:.5,transform:"scale3d(1.05, 1.05, 1.05)"},{offset:1,transform:"scale3d(1, 1, 1)"}],lj=[{offset:0,transform:"scale3d(1, 1, 1)"},{offset:.3,transform:"scale3d(1.25, 0.75, 1)"},{offset:.4,transform:"scale3d(0.75, 1.25, 1)"},{offset:.5,transform:"scale3d(1.15, 0.85, 1)"},{offset:.65,transform:"scale3d(0.95, 1.05, 1)"},{offset:.75,transform:"scale3d(1.05, 0.95, 1)"},{offset:1,transform:"scale3d(1, 1, 1)"}],cj=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.1,transform:"translate3d(-10px, 0, 0)"},{offset:.2,transform:"translate3d(10px, 0, 0)"},{offset:.3,transform:"translate3d(-10px, 0, 0)"},{offset:.4,transform:"translate3d(10px, 0, 0)"},{offset:.5,transform:"translate3d(-10px, 0, 0)"},{offset:.6,transform:"translate3d(10px, 0, 0)"},{offset:.7,transform:"translate3d(-10px, 0, 0)"},{offset:.8,transform:"translate3d(10px, 0, 0)"},{offset:.9,transform:"translate3d(-10px, 0, 0)"},{offset:1,transform:"translate3d(0, 0, 0)"}],hj=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.1,transform:"translate3d(-10px, 0, 0)"},{offset:.2,transform:"translate3d(10px, 0, 0)"},{offset:.3,transform:"translate3d(-10px, 0, 0)"},{offset:.4,transform:"translate3d(10px, 0, 0)"},{offset:.5,transform:"translate3d(-10px, 0, 0)"},{offset:.6,transform:"translate3d(10px, 0, 0)"},{offset:.7,transform:"translate3d(-10px, 0, 0)"},{offset:.8,transform:"translate3d(10px, 0, 0)"},{offset:.9,transform:"translate3d(-10px, 0, 0)"},{offset:1,transform:"translate3d(0, 0, 0)"}],uj=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.1,transform:"translate3d(0, -10px, 0)"},{offset:.2,transform:"translate3d(0, 10px, 0)"},{offset:.3,transform:"translate3d(0, -10px, 0)"},{offset:.4,transform:"translate3d(0, 10px, 0)"},{offset:.5,transform:"translate3d(0, -10px, 0)"},{offset:.6,transform:"translate3d(0, 10px, 0)"},{offset:.7,transform:"translate3d(0, -10px, 0)"},{offset:.8,transform:"translate3d(0, 10px, 0)"},{offset:.9,transform:"translate3d(0, -10px, 0)"},{offset:1,transform:"translate3d(0, 0, 0)"}],dj=[{offset:.2,transform:"rotate3d(0, 0, 1, 15deg)"},{offset:.4,transform:"rotate3d(0, 0, 1, -10deg)"},{offset:.6,transform:"rotate3d(0, 0, 1, 5deg)"},{offset:.8,transform:"rotate3d(0, 0, 1, -5deg)"},{offset:1,transform:"rotate3d(0, 0, 1, 0deg)"}],fj=[{offset:0,transform:"scale3d(1, 1, 1)"},{offset:.1,transform:"scale3d(0.9, 0.9, 0.9) rotate3d(0, 0, 1, -3deg)"},{offset:.2,transform:"scale3d(0.9, 0.9, 0.9) rotate3d(0, 0, 1, -3deg)"},{offset:.3,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)"},{offset:.4,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg)"},{offset:.5,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)"},{offset:.6,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg)"},{offset:.7,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)"},{offset:.8,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg)"},{offset:.9,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)"},{offset:1,transform:"scale3d(1, 1, 1)"}],pj=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.15,transform:"translate3d(-25%, 0, 0) rotate3d(0, 0, 1, -5deg)"},{offset:.3,transform:"translate3d(20%, 0, 0) rotate3d(0, 0, 1, 3deg)"},{offset:.45,transform:"translate3d(-15%, 0, 0) rotate3d(0, 0, 1, -3deg)"},{offset:.6,transform:"translate3d(10%, 0, 0) rotate3d(0, 0, 1, 2deg)"},{offset:.75,transform:"translate3d(-5%, 0, 0) rotate3d(0, 0, 1, -1deg)"},{offset:1,transform:"translate3d(0, 0, 0)"}],mj=[{offset:0,transform:"translateY(-1200px) scale(0.7)",opacity:"0.7"},{offset:.8,transform:"translateY(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"scale(1)",opacity:"1"}],gj=[{offset:0,transform:"translateX(-2000px) scale(0.7)",opacity:"0.7"},{offset:.8,transform:"translateX(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"scale(1)",opacity:"1"}],_j=[{offset:0,transform:"translateX(2000px) scale(0.7)",opacity:"0.7"},{offset:.8,transform:"translateX(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"scale(1)",opacity:"1"}],yj=[{offset:0,transform:"translateY(1200px) scale(0.7)",opacity:"0.7"},{offset:.8,transform:"translateY(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"scale(1)",opacity:"1"}],bj=[{offset:0,transform:"scale(1)",opacity:"1"},{offset:.2,transform:"translateY(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"translateY(700px) scale(0.7)",opacity:"0.7"}],vj=[{offset:0,transform:"scale(1)",opacity:"1"},{offset:.2,transform:"translateX(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"translateX(-2000px) scale(0.7)",opacity:"0.7"}],xj=[{offset:0,transform:"scale(1)",opacity:"1"},{offset:.2,transform:"translateX(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"translateX(2000px) scale(0.7)",opacity:"0.7"}],wj=[{offset:0,transform:"scale(1)",opacity:"1"},{offset:.2,transform:"translateY(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"translateY(-700px) scale(0.7)",opacity:"0.7"}],Aj=[{offset:0,opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.2,transform:"scale3d(1.1, 1.1, 1.1)"},{offset:.2,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.4,transform:"scale3d(0.9, 0.9, 0.9)"},{offset:.4,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"scale3d(1.03, 1.03, 1.03)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.8,transform:"scale3d(0.97, 0.97, 0.97)"},{offset:.8,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,opacity:"1",transform:"scale3d(1, 1, 1)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],Tj=[{offset:0,opacity:"0",transform:"translate3d(0, -3000px, 0) scaleY(3)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"translate3d(0, 25px, 0) scaleY(0.9)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.75,transform:"translate3d(0, -10px, 0) scaleY(0.95)"},{offset:.75,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.9,transform:"translate3d(0, 5px, 0) scaleY(0.985)"},{offset:.9,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,transform:"translate3d(0, 0, 0)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],Sj=[{offset:0,opacity:"0",transform:"translate3d(-3000px, 0, 0) scaleX(3)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"translate3d(25px, 0, 0) scaleX(1)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.75,transform:"translate3d(-10px, 0, 0) scaleX(0.98)"},{offset:.75,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.9,transform:"translate3d(5px, 0, 0) scaleX(0.995)"},{offset:.9,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,transform:"translate3d(0, 0, 0)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],Ej=[{offset:0,opacity:"0",transform:"translate3d(3000px, 0, 0) scaleX(3)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"translate3d(-25px, 0, 0) scaleX(1)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.75,transform:"translate3d(10px, 0, 0) scaleX(0.98)"},{offset:.75,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.9,transform:"translate3d(-5px, 0, 0) scaleX(0.995)"},{offset:.9,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,transform:"translate3d(0, 0, 0)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],Cj=[{offset:0,opacity:"0",transform:"translate3d(0, 3000px, 0) scaleY(5)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"translate3d(0, -20px, 0) scaleY(0.9)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.75,transform:"translate3d(0, 10px, 0) scaleY(0.95)"},{offset:.75,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.9,transform:"translate3d(0, -5px, 0) scaleY(0.985)"},{offset:.9,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,transform:"translate3d(0, 0, 0)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],Ij=[{offset:.2,transform:"scale3d(0.9, 0.9, 0.9)"},{offset:.5,opacity:"1",transform:"scale3d(1.1, 1.1, 1.1)"},{offset:.55,opacity:"1",transform:"scale3d(1.1, 1.1, 1.1)"},{offset:1,opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"}],Mj=[{offset:.2,transform:"translate3d(0, 10px, 0) scaleY(0.985)"},{offset:.4,opacity:"1",transform:"translate3d(0, -20px, 0) scaleY(0.9)"},{offset:.45,opacity:"1",transform:"translate3d(0, -20px, 0) scaleY(0.9)"},{offset:1,opacity:"0",transform:"translate3d(0, 2000px, 0) scaleY(3)"}],Rj=[{offset:.2,opacity:"1",transform:"translate3d(20px, 0, 0) scaleX(0.9)"},{offset:1,opacity:"0",transform:"translate3d(-2000px, 0, 0) scaleX(2)"}],kj=[{offset:.2,opacity:"1",transform:"translate3d(-20px, 0, 0) scaleX(0.9)"},{offset:1,opacity:"0",transform:"translate3d(2000px, 0, 0) scaleX(2)"}],Pj=[{offset:.2,transform:"translate3d(0, -10px, 0) scaleY(0.985)"},{offset:.4,opacity:"1",transform:"translate3d(0, 20px, 0) scaleY(0.9)"},{offset:.45,opacity:"1",transform:"translate3d(0, 20px, 0) scaleY(0.9)"},{offset:1,opacity:"0",transform:"translate3d(0, -2000px, 0) scaleY(3)"}],Dj=[{offset:0,opacity:"0"},{offset:1,opacity:"1"}],Bj=[{offset:0,opacity:"0",transform:"translate3d(-100%, 100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],Oj=[{offset:0,opacity:"0",transform:"translate3d(100%, 100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],Fj=[{offset:0,opacity:"0",transform:"translate3d(0, -100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],Lj=[{offset:0,opacity:"0",transform:"translate3d(0, -2000px, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],zj=[{offset:0,opacity:"0",transform:"translate3d(-100%, 0, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],Nj=[{offset:0,opacity:"0",transform:"translate3d(-2000px, 0, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],Uj=[{offset:0,opacity:"0",transform:"translate3d(100%, 0, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],Vj=[{offset:0,opacity:"0",transform:"translate3d(2000px, 0, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],$j=[{offset:0,opacity:"0",transform:"translate3d(-100%, -100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],jj=[{offset:0,opacity:"0",transform:"translate3d(100%, -100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],Hj=[{offset:0,opacity:"0",transform:"translate3d(0, 100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],Wj=[{offset:0,opacity:"0",transform:"translate3d(0, 2000px, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],Gj=[{offset:0,opacity:"1"},{offset:1,opacity:"0"}],Xj=[{offset:0,opacity:"1",transform:"translate3d(0, 0, 0)"},{offset:1,opacity:"0",transform:"translate3d(-100%, 100%, 0)"}],qj=[{offset:0,opacity:"1",transform:"translate3d(0, 0, 0)"},{offset:1,opacity:"0",transform:"translate3d(100%, 100%, 0)"}],Yj=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(0, 100%, 0)"}],Zj=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(0, 2000px, 0)"}],Kj=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(-100%, 0, 0)"}],Jj=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(-2000px, 0, 0)"}],Qj=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(100%, 0, 0)"}],eH=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(2000px, 0, 0)"}],tH=[{offset:0,opacity:"1",transform:"translate3d(0, 0, 0)"},{offset:1,opacity:"0",transform:"translate3d(-100%, -100%, 0)"}],iH=[{offset:0,opacity:"1",transform:"translate3d(0, 0, 0)"},{offset:1,opacity:"0",transform:"translate3d(100%, -100%, 0)"}],nH=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(0, -100%, 0)"}],rH=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(0, -2000px, 0)"}],sH=[{offset:0,transform:"perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 0) rotate3d(0, 1, 0, -360deg)",easing:"ease-out"},{offset:.4,transform:`perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 150px)
      rotate3d(0, 1, 0, -190deg)`,easing:"ease-out"},{offset:.5,transform:`perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 150px)
      rotate3d(0, 1, 0, -170deg)`,easing:"ease-in"},{offset:.8,transform:`perspective(400px) scale3d(0.95, 0.95, 0.95) translate3d(0, 0, 0)
      rotate3d(0, 1, 0, 0deg)`,easing:"ease-in"},{offset:1,transform:"perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 0) rotate3d(0, 1, 0, 0deg)",easing:"ease-in"}],oH=[{offset:0,transform:"perspective(400px) rotate3d(1, 0, 0, 90deg)",easing:"ease-in",opacity:"0"},{offset:.4,transform:"perspective(400px) rotate3d(1, 0, 0, -20deg)",easing:"ease-in"},{offset:.6,transform:"perspective(400px) rotate3d(1, 0, 0, 10deg)",opacity:"1"},{offset:.8,transform:"perspective(400px) rotate3d(1, 0, 0, -5deg)"},{offset:1,transform:"perspective(400px)"}],aH=[{offset:0,transform:"perspective(400px) rotate3d(0, 1, 0, 90deg)",easing:"ease-in",opacity:"0"},{offset:.4,transform:"perspective(400px) rotate3d(0, 1, 0, -20deg)",easing:"ease-in"},{offset:.6,transform:"perspective(400px) rotate3d(0, 1, 0, 10deg)",opacity:"1"},{offset:.8,transform:"perspective(400px) rotate3d(0, 1, 0, -5deg)"},{offset:1,transform:"perspective(400px)"}],lH=[{offset:0,transform:"perspective(400px)"},{offset:.3,transform:"perspective(400px) rotate3d(1, 0, 0, -20deg)",opacity:"1"},{offset:1,transform:"perspective(400px) rotate3d(1, 0, 0, 90deg)",opacity:"0"}],cH=[{offset:0,transform:"perspective(400px)"},{offset:.3,transform:"perspective(400px) rotate3d(0, 1, 0, -15deg)",opacity:"1"},{offset:1,transform:"perspective(400px) rotate3d(0, 1, 0, 90deg)",opacity:"0"}],hH=[{offset:0,transform:"translate3d(-100%, 0, 0) skewX(30deg)",opacity:"0"},{offset:.6,transform:"skewX(-20deg)",opacity:"1"},{offset:.8,transform:"skewX(5deg)"},{offset:1,transform:"translate3d(0, 0, 0)"}],uH=[{offset:0,transform:"translate3d(100%, 0, 0) skewX(-30deg)",opacity:"0"},{offset:.6,transform:"skewX(20deg)",opacity:"1"},{offset:.8,transform:"skewX(-5deg)"},{offset:1,transform:"translate3d(0, 0, 0)"}],dH=[{offset:0,opacity:"1"},{offset:1,transform:"translate3d(-100%, 0, 0) skewX(-30deg)",opacity:"0"}],fH=[{offset:0,opacity:"1"},{offset:1,transform:"translate3d(100%, 0, 0) skewX(30deg)",opacity:"0"}],pH=[{offset:0,transform:"rotate3d(0, 0, 1, -200deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],mH=[{offset:0,transform:"rotate3d(0, 0, 1, -45deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],gH=[{offset:0,transform:"rotate3d(0, 0, 1, 45deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],_H=[{offset:0,transform:"rotate3d(0, 0, 1, 45deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],yH=[{offset:0,transform:"rotate3d(0, 0, 1, -90deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],bH=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, 200deg)",opacity:"0"}],vH=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, 45deg)",opacity:"0"}],xH=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, -45deg)",opacity:"0"}],wH=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, -45deg)",opacity:"0"}],AH=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, 90deg)",opacity:"0"}],TH=[{offset:0,transform:"translate3d(0, -100%, 0)",visibility:"visible"},{offset:1,transform:"translate3d(0, 0, 0)"}],SH=[{offset:0,transform:"translate3d(-100%, 0, 0)",visibility:"visible"},{offset:1,transform:"translate3d(0, 0, 0)"}],EH=[{offset:0,transform:"translate3d(100%, 0, 0)",visibility:"visible"},{offset:1,transform:"translate3d(0, 0, 0)"}],CH=[{offset:0,transform:"translate3d(0, 100%, 0)",visibility:"visible"},{offset:1,transform:"translate3d(0, 0, 0)"}],IH=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:1,visibility:"hidden",transform:"translate3d(0, 100%, 0)"}],MH=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:1,visibility:"hidden",transform:"translate3d(-100%, 0, 0)"}],RH=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:1,visibility:"hidden",transform:"translate3d(100%, 0, 0)"}],kH=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:1,visibility:"hidden",transform:"translate3d(0, -100%, 0)"}],PH=[{offset:0,easing:"ease-in-out"},{offset:.2,transform:"rotate3d(0, 0, 1, 80deg)",easing:"ease-in-out"},{offset:.4,transform:"rotate3d(0, 0, 1, 60deg)",easing:"ease-in-out",opacity:"1"},{offset:.6,transform:"rotate3d(0, 0, 1, 80deg)",easing:"ease-in-out"},{offset:.8,transform:"rotate3d(0, 0, 1, 60deg)",easing:"ease-in-out",opacity:"1"},{offset:1,transform:"translate3d(0, 700px, 0)",opacity:"0"}],DH=[{offset:0,opacity:"0",transform:"scale(0.1) rotate(30deg)","transform-origin":"center bottom"},{offset:.5,transform:"rotate(-10deg)"},{offset:.7,transform:"rotate(3deg)"},{offset:1,opacity:"1",transform:"scale(1)"}],BH=[{offset:0,opacity:"0",transform:"translate3d(-100%, 0, 0) rotate3d(0, 0, 1, -120deg)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],OH=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(100%, 0, 0) rotate3d(0, 0, 1, 120deg)"}],FH=[{offset:0,opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"},{offset:.5,opacity:"1"}],LH=[{offset:0,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, -1000px, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:.6,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, 60px, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],zH=[{offset:0,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(-1000px, 0, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:.6,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(10px, 0, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],NH=[{offset:0,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(1000px, 0, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:.6,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(-10px, 0, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],UH=[{offset:0,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, 1000px, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:.6,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, -60px, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],VH=[{offset:0,opacity:"1"},{offset:.5,opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"},{offset:1,opacity:"0"}],$H=[{offset:.4,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, -60px, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:1,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, 2000px, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],jH=[{offset:.4,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(42px, 0, 0)"},{offset:1,opacity:"0",transform:"scale(0.1) translate3d(-2000px, 0, 0)"}],HH=[{offset:.4,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(-42px, 0, 0)"},{offset:1,opacity:"0",transform:"scale(0.1) translate3d(2000px, 0, 0)"}],WH=[{offset:.4,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, 60px, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:1,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, -2000px, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],rF={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",easeInSine:"cubic-bezier(0.47, 0, 0.745, 0.715)",easeOutSine:"cubic-bezier(0.39, 0.575, 0.565, 1)",easeInOutSine:"cubic-bezier(0.445, 0.05, 0.55, 0.95)",easeInQuad:"cubic-bezier(0.55, 0.085, 0.68, 0.53)",easeOutQuad:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",easeInOutQuad:"cubic-bezier(0.455, 0.03, 0.515, 0.955)",easeInCubic:"cubic-bezier(0.55, 0.055, 0.675, 0.19)",easeOutCubic:"cubic-bezier(0.215, 0.61, 0.355, 1)",easeInOutCubic:"cubic-bezier(0.645, 0.045, 0.355, 1)",easeInQuart:"cubic-bezier(0.895, 0.03, 0.685, 0.22)",easeOutQuart:"cubic-bezier(0.165, 0.84, 0.44, 1)",easeInOutQuart:"cubic-bezier(0.77, 0, 0.175, 1)",easeInQuint:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",easeOutQuint:"cubic-bezier(0.23, 1, 0.32, 1)",easeInOutQuint:"cubic-bezier(0.86, 0, 0.07, 1)",easeInExpo:"cubic-bezier(0.95, 0.05, 0.795, 0.035)",easeOutExpo:"cubic-bezier(0.19, 1, 0.22, 1)",easeInOutExpo:"cubic-bezier(1, 0, 0, 1)",easeInCirc:"cubic-bezier(0.6, 0.04, 0.98, 0.335)",easeOutCirc:"cubic-bezier(0.075, 0.82, 0.165, 1)",easeInOutCirc:"cubic-bezier(0.785, 0.135, 0.15, 0.86)",easeInBack:"cubic-bezier(0.6, -0.28, 0.735, 0.045)",easeOutBack:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",easeInOutBack:"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},GH=Object.freeze(Object.defineProperty({__proto__:null,backInDown:mj,backInLeft:gj,backInRight:_j,backInUp:yj,backOutDown:bj,backOutLeft:vj,backOutRight:xj,backOutUp:wj,bounce:ij,bounceIn:Aj,bounceInDown:Tj,bounceInLeft:Sj,bounceInRight:Ej,bounceInUp:Cj,bounceOut:Ij,bounceOutDown:Mj,bounceOutLeft:Rj,bounceOutRight:kj,bounceOutUp:Pj,easings:rF,fadeIn:Dj,fadeInBottomLeft:Bj,fadeInBottomRight:Oj,fadeInDown:Fj,fadeInDownBig:Lj,fadeInLeft:zj,fadeInLeftBig:Nj,fadeInRight:Uj,fadeInRightBig:Vj,fadeInTopLeft:$j,fadeInTopRight:jj,fadeInUp:Hj,fadeInUpBig:Wj,fadeOut:Gj,fadeOutBottomLeft:Xj,fadeOutBottomRight:qj,fadeOutDown:Yj,fadeOutDownBig:Zj,fadeOutLeft:Kj,fadeOutLeftBig:Jj,fadeOutRight:Qj,fadeOutRightBig:eH,fadeOutTopLeft:tH,fadeOutTopRight:iH,fadeOutUp:nH,fadeOutUpBig:rH,flash:nj,flip:sH,flipInX:oH,flipInY:aH,flipOutX:lH,flipOutY:cH,headShake:rj,heartBeat:sj,hinge:PH,jackInTheBox:DH,jello:oj,lightSpeedInLeft:hH,lightSpeedInRight:uH,lightSpeedOutLeft:dH,lightSpeedOutRight:fH,pulse:aj,rollIn:BH,rollOut:OH,rotateIn:pH,rotateInDownLeft:mH,rotateInDownRight:gH,rotateInUpLeft:_H,rotateInUpRight:yH,rotateOut:bH,rotateOutDownLeft:vH,rotateOutDownRight:xH,rotateOutUpLeft:wH,rotateOutUpRight:AH,rubberBand:lj,shake:cj,shakeX:hj,shakeY:uj,slideInDown:TH,slideInLeft:SH,slideInRight:EH,slideInUp:CH,slideOutDown:IH,slideOutLeft:MH,slideOutRight:RH,slideOutUp:kH,swing:dj,tada:fj,wobble:pj,zoomIn:FH,zoomInDown:LH,zoomInLeft:zH,zoomInRight:NH,zoomInUp:UH,zoomOut:VH,zoomOutDown:$H,zoomOutLeft:jH,zoomOutRight:HH,zoomOutUp:WH},Symbol.toStringTag,{value:"Module"}));var XH=ji`
  :host {
    display: contents;
  }
`,Zs=class extends Li{constructor(){super(...arguments),this.hasStarted=!1,this.name="none",this.play=!1,this.delay=0,this.direction="normal",this.duration=1e3,this.easing="linear",this.endDelay=0,this.fill="auto",this.iterations=1/0,this.iterationStart=0,this.playbackRate=1,this.handleAnimationFinish=()=>{this.play=!1,this.hasStarted=!1,this.emit("sl-finish")},this.handleAnimationCancel=()=>{this.play=!1,this.hasStarted=!1,this.emit("sl-cancel")}}get currentTime(){var i,e;return(e=(i=this.animation)==null?void 0:i.currentTime)!=null?e:0}set currentTime(i){this.animation&&(this.animation.currentTime=i)}connectedCallback(){super.connectedCallback(),this.createAnimation()}disconnectedCallback(){super.disconnectedCallback(),this.destroyAnimation()}handleSlotChange(){this.destroyAnimation(),this.createAnimation()}async createAnimation(){var i,e;const t=(i=rF[this.easing])!=null?i:this.easing,n=(e=this.keyframes)!=null?e:GH[this.name],c=(await this.defaultSlot).assignedElements()[0];return!c||!n?!1:(this.destroyAnimation(),this.animation=c.animate(n,{delay:this.delay,direction:this.direction,duration:this.duration,easing:t,endDelay:this.endDelay,fill:this.fill,iterationStart:this.iterationStart,iterations:this.iterations}),this.animation.playbackRate=this.playbackRate,this.animation.addEventListener("cancel",this.handleAnimationCancel),this.animation.addEventListener("finish",this.handleAnimationFinish),this.play?(this.hasStarted=!0,this.emit("sl-start")):this.animation.pause(),!0)}destroyAnimation(){this.animation&&(this.animation.cancel(),this.animation.removeEventListener("cancel",this.handleAnimationCancel),this.animation.removeEventListener("finish",this.handleAnimationFinish),this.hasStarted=!1)}handleAnimationChange(){this.hasUpdated&&this.createAnimation()}handlePlayChange(){return this.animation?(this.play&&!this.hasStarted&&(this.hasStarted=!0,this.emit("sl-start")),this.play?this.animation.play():this.animation.pause(),!0):!1}handlePlaybackRateChange(){this.animation&&(this.animation.playbackRate=this.playbackRate)}cancel(){var i;(i=this.animation)==null||i.cancel()}finish(){var i;(i=this.animation)==null||i.finish()}render(){return ei` <slot @slotchange=${this.handleSlotChange}></slot> `}};Zs.styles=[qi,XH];J([EV("slot")],Zs.prototype,"defaultSlot",2);J([be()],Zs.prototype,"name",2);J([be({type:Boolean,reflect:!0})],Zs.prototype,"play",2);J([be({type:Number})],Zs.prototype,"delay",2);J([be()],Zs.prototype,"direction",2);J([be({type:Number})],Zs.prototype,"duration",2);J([be()],Zs.prototype,"easing",2);J([be({attribute:"end-delay",type:Number})],Zs.prototype,"endDelay",2);J([be()],Zs.prototype,"fill",2);J([be({type:Number})],Zs.prototype,"iterations",2);J([be({attribute:"iteration-start",type:Number})],Zs.prototype,"iterationStart",2);J([be({attribute:!1})],Zs.prototype,"keyframes",2);J([be({attribute:"playback-rate",type:Number})],Zs.prototype,"playbackRate",2);J([hi(["name","delay","direction","duration","easing","endDelay","fill","iterations","iterationsStart","keyframes"])],Zs.prototype,"handleAnimationChange",1);J([hi("play")],Zs.prototype,"handlePlayChange",1);J([hi("playbackRate")],Zs.prototype,"handlePlaybackRateChange",1);Zs.define("sl-animation");function qH(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Px={exports:{}},YH=Px.exports,Ik;function ZH(){return Ik||(Ik=1,function(i,e){(function(t,n){i.exports=n()})(YH,function(){var t,n,s;function c(r,b){if(!t)t=b;else if(!n)n=b;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",E={};t(E),s=b(E),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(s.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}c(["exports"],function(r){var b=1e-6,w=typeof Float32Array<"u"?Float32Array:Array;function E(h,o){var l=o[0],d=o[1],p=o[2],_=o[3],y=l*_-p*d;return y?(h[0]=_*(y=1/y),h[1]=-d*y,h[2]=-p*y,h[3]=l*y,h):null}function k(){var h=new w(9);return w!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h}function F(h,o){var l=o[0],d=o[1],p=o[2],_=o[3],y=o[4],A=o[5],S=o[6],I=o[7],R=o[8];return h[0]=y*R-A*I,h[1]=p*I-d*R,h[2]=d*A-p*y,h[3]=A*S-_*R,h[4]=l*R-p*S,h[5]=p*_-l*A,h[6]=_*I-y*S,h[7]=d*S-l*I,h[8]=l*y-d*_,h}function $(h,o,l){var d=o[0],p=o[1],_=o[2],y=o[3],A=o[4],S=o[5],I=o[6],R=o[7],P=o[8],B=l[0],N=l[1],U=l[2],j=l[3],K=l[4],ee=l[5],le=l[6],re=l[7],G=l[8];return h[0]=B*d+N*y+U*I,h[1]=B*p+N*A+U*R,h[2]=B*_+N*S+U*P,h[3]=j*d+K*y+ee*I,h[4]=j*p+K*A+ee*R,h[5]=j*_+K*S+ee*P,h[6]=le*d+re*y+G*I,h[7]=le*p+re*A+G*R,h[8]=le*_+re*S+G*P,h}function X(){var h=new w(16);return w!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h}function W(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function ne(h,o){var l=o[0],d=o[1],p=o[2],_=o[3],y=o[4],A=o[5],S=o[6],I=o[7],R=o[8],P=o[9],B=o[10],N=o[11],U=o[12],j=o[13],K=o[14],ee=o[15],le=l*A-d*y,re=l*S-p*y,G=l*I-_*y,ie=d*S-p*A,ae=d*I-_*A,fe=p*I-_*S,Ce=R*j-P*U,Be=R*K-B*U,Fe=R*ee-N*U,Ve=P*K-B*j,et=P*ee-N*j,mt=B*ee-N*K,ht=le*mt-re*et+G*Ve+ie*Fe-ae*Be+fe*Ce;return ht?(h[0]=(A*mt-S*et+I*Ve)*(ht=1/ht),h[1]=(p*et-d*mt-_*Ve)*ht,h[2]=(j*fe-K*ae+ee*ie)*ht,h[3]=(B*ae-P*fe-N*ie)*ht,h[4]=(S*Fe-y*mt-I*Be)*ht,h[5]=(l*mt-p*Fe+_*Be)*ht,h[6]=(K*G-U*fe-ee*re)*ht,h[7]=(R*fe-B*G+N*re)*ht,h[8]=(y*et-A*Fe+I*Ce)*ht,h[9]=(d*Fe-l*et-_*Ce)*ht,h[10]=(U*ae-j*G+ee*le)*ht,h[11]=(P*G-R*ae-N*le)*ht,h[12]=(A*Be-y*Ve-S*Ce)*ht,h[13]=(l*Ve-d*Be+p*Ce)*ht,h[14]=(j*re-U*ie-K*le)*ht,h[15]=(R*ie-P*re+B*le)*ht,h):null}function _e(h,o,l){var d=o[0],p=o[1],_=o[2],y=o[3],A=o[4],S=o[5],I=o[6],R=o[7],P=o[8],B=o[9],N=o[10],U=o[11],j=o[12],K=o[13],ee=o[14],le=o[15],re=l[0],G=l[1],ie=l[2],ae=l[3];return h[0]=re*d+G*A+ie*P+ae*j,h[1]=re*p+G*S+ie*B+ae*K,h[2]=re*_+G*I+ie*N+ae*ee,h[3]=re*y+G*R+ie*U+ae*le,h[4]=(re=l[4])*d+(G=l[5])*A+(ie=l[6])*P+(ae=l[7])*j,h[5]=re*p+G*S+ie*B+ae*K,h[6]=re*_+G*I+ie*N+ae*ee,h[7]=re*y+G*R+ie*U+ae*le,h[8]=(re=l[8])*d+(G=l[9])*A+(ie=l[10])*P+(ae=l[11])*j,h[9]=re*p+G*S+ie*B+ae*K,h[10]=re*_+G*I+ie*N+ae*ee,h[11]=re*y+G*R+ie*U+ae*le,h[12]=(re=l[12])*d+(G=l[13])*A+(ie=l[14])*P+(ae=l[15])*j,h[13]=re*p+G*S+ie*B+ae*K,h[14]=re*_+G*I+ie*N+ae*ee,h[15]=re*y+G*R+ie*U+ae*le,h}function Te(h,o,l){var d,p,_,y,A,S,I,R,P,B,N,U,j=l[0],K=l[1],ee=l[2];return o===h?(h[12]=o[0]*j+o[4]*K+o[8]*ee+o[12],h[13]=o[1]*j+o[5]*K+o[9]*ee+o[13],h[14]=o[2]*j+o[6]*K+o[10]*ee+o[14],h[15]=o[3]*j+o[7]*K+o[11]*ee+o[15]):(p=o[1],_=o[2],y=o[3],A=o[4],S=o[5],I=o[6],R=o[7],P=o[8],B=o[9],N=o[10],U=o[11],h[0]=d=o[0],h[1]=p,h[2]=_,h[3]=y,h[4]=A,h[5]=S,h[6]=I,h[7]=R,h[8]=P,h[9]=B,h[10]=N,h[11]=U,h[12]=d*j+A*K+P*ee+o[12],h[13]=p*j+S*K+B*ee+o[13],h[14]=_*j+I*K+N*ee+o[14],h[15]=y*j+R*K+U*ee+o[15]),h}function we(h,o,l){var d=l[0],p=l[1],_=l[2];return h[0]=o[0]*d,h[1]=o[1]*d,h[2]=o[2]*d,h[3]=o[3]*d,h[4]=o[4]*p,h[5]=o[5]*p,h[6]=o[6]*p,h[7]=o[7]*p,h[8]=o[8]*_,h[9]=o[9]*_,h[10]=o[10]*_,h[11]=o[11]*_,h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15],h}function Ee(h,o,l){var d=Math.sin(l),p=Math.cos(l),_=o[4],y=o[5],A=o[6],S=o[7],I=o[8],R=o[9],P=o[10],B=o[11];return o!==h&&(h[0]=o[0],h[1]=o[1],h[2]=o[2],h[3]=o[3],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[4]=_*p+I*d,h[5]=y*p+R*d,h[6]=A*p+P*d,h[7]=S*p+B*d,h[8]=I*p-_*d,h[9]=R*p-y*d,h[10]=P*p-A*d,h[11]=B*p-S*d,h}function Le(h,o,l){var d=Math.sin(l),p=Math.cos(l),_=o[0],y=o[1],A=o[2],S=o[3],I=o[8],R=o[9],P=o[10],B=o[11];return o!==h&&(h[4]=o[4],h[5]=o[5],h[6]=o[6],h[7]=o[7],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[0]=_*p-I*d,h[1]=y*p-R*d,h[2]=A*p-P*d,h[3]=S*p-B*d,h[8]=_*d+I*p,h[9]=y*d+R*p,h[10]=A*d+P*p,h[11]=S*d+B*p,h}function Je(h,o,l){var d=Math.sin(l),p=Math.cos(l),_=o[0],y=o[1],A=o[2],S=o[3],I=o[4],R=o[5],P=o[6],B=o[7];return o!==h&&(h[8]=o[8],h[9]=o[9],h[10]=o[10],h[11]=o[11],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[0]=_*p+I*d,h[1]=y*p+R*d,h[2]=A*p+P*d,h[3]=S*p+B*d,h[4]=I*p-_*d,h[5]=R*p-y*d,h[6]=P*p-A*d,h[7]=B*p-S*d,h}function Tt(h,o){return h[0]=o[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=o[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=o[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function _t(h,o,l){var d,p,_,y=l[0],A=l[1],S=l[2],I=Math.hypot(y,A,S);return I<b?null:(y*=I=1/I,A*=I,S*=I,d=Math.sin(o),p=Math.cos(o),h[0]=y*y*(_=1-p)+p,h[1]=A*y*_+S*d,h[2]=S*y*_-A*d,h[3]=0,h[4]=y*A*_-S*d,h[5]=A*A*_+p,h[6]=S*A*_+y*d,h[7]=0,h[8]=y*S*_+A*d,h[9]=A*S*_-y*d,h[10]=S*S*_+p,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h)}function St(h,o){var l=o[0],d=o[1],p=o[2],_=o[3],y=l+l,A=d+d,S=p+p,I=l*y,R=d*y,P=d*A,B=p*y,N=p*A,U=p*S,j=_*y,K=_*A,ee=_*S;return h[0]=1-P-U,h[1]=R+ee,h[2]=B-K,h[3]=0,h[4]=R-ee,h[5]=1-I-U,h[6]=N+j,h[7]=0,h[8]=B+K,h[9]=N-j,h[10]=1-I-P,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}Math.hypot||(Math.hypot=function(){for(var h=0,o=arguments.length;o--;)h+=arguments[o]*arguments[o];return Math.sqrt(h)});var kt=_e;function Lt(){var h=new w(3);return w!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function si(h){var o=new w(3);return o[0]=h[0],o[1]=h[1],o[2]=h[2],o}function bi(h){return Math.hypot(h[0],h[1],h[2])}function ii(h,o,l){var d=new w(3);return d[0]=h,d[1]=o,d[2]=l,d}function vi(h,o,l){return h[0]=o[0]+l[0],h[1]=o[1]+l[1],h[2]=o[2]+l[2],h}function Zi(h,o,l){return h[0]=o[0]-l[0],h[1]=o[1]-l[1],h[2]=o[2]-l[2],h}function Cn(h,o,l){return h[0]=o[0]*l[0],h[1]=o[1]*l[1],h[2]=o[2]*l[2],h}function nr(h,o,l){return h[0]=Math.min(o[0],l[0]),h[1]=Math.min(o[1],l[1]),h[2]=Math.min(o[2],l[2]),h}function vr(h,o,l){return h[0]=Math.max(o[0],l[0]),h[1]=Math.max(o[1],l[1]),h[2]=Math.max(o[2],l[2]),h}function Qi(h,o,l){return h[0]=o[0]*l,h[1]=o[1]*l,h[2]=o[2]*l,h}function Gr(h,o,l,d){return h[0]=o[0]+l[0]*d,h[1]=o[1]+l[1]*d,h[2]=o[2]+l[2]*d,h}function Js(h,o){var l=o[0]-h[0],d=o[1]-h[1],p=o[2]-h[2];return l*l+d*d+p*p}function mo(h){var o=h[0],l=h[1],d=h[2];return o*o+l*l+d*d}function Is(h,o){return h[0]=-o[0],h[1]=-o[1],h[2]=-o[2],h}function on(h,o){var l=o[0],d=o[1],p=o[2],_=l*l+d*d+p*p;return _>0&&(_=1/Math.sqrt(_)),h[0]=o[0]*_,h[1]=o[1]*_,h[2]=o[2]*_,h}function cn(h,o){return h[0]*o[0]+h[1]*o[1]+h[2]*o[2]}function rr(h,o,l){var d=o[0],p=o[1],_=o[2],y=l[0],A=l[1],S=l[2];return h[0]=p*S-_*A,h[1]=_*y-d*S,h[2]=d*A-p*y,h}function go(h,o,l,d){var p=o[0],_=o[1],y=o[2];return h[0]=p+d*(l[0]-p),h[1]=_+d*(l[1]-_),h[2]=y+d*(l[2]-y),h}function jn(h,o,l){var d=o[0],p=o[1],_=o[2],y=l[3]*d+l[7]*p+l[11]*_+l[15];return h[0]=(l[0]*d+l[4]*p+l[8]*_+l[12])/(y=y||1),h[1]=(l[1]*d+l[5]*p+l[9]*_+l[13])/y,h[2]=(l[2]*d+l[6]*p+l[10]*_+l[14])/y,h}function Yl(h,o,l){var d=o[0],p=o[1],_=o[2];return h[0]=d*l[0]+p*l[3]+_*l[6],h[1]=d*l[1]+p*l[4]+_*l[7],h[2]=d*l[2]+p*l[5]+_*l[8],h}function aa(h,o,l){var d=l[0],p=l[1],_=l[2],y=o[0],A=o[1],S=o[2],I=p*S-_*A,R=_*y-d*S,P=d*A-p*y,B=p*P-_*R,N=_*I-d*P,U=d*R-p*I,j=2*l[3];return R*=j,P*=j,N*=2,U*=2,h[0]=y+(I*=j)+(B*=2),h[1]=A+R+N,h[2]=S+P+U,h}function fs(h,o){return h[0]===o[0]&&h[1]===o[1]&&h[2]===o[2]}var sr=Zi,Wu=Cn,$a=bi;function ps(){var h=new w(4);return w!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0,h[3]=0),h}function Vo(h,o,l){return h[0]=o[0]*l,h[1]=o[1]*l,h[2]=o[2]*l,h[3]=o[3]*l,h}function la(h,o){var l=o[0],d=o[1],p=o[2],_=o[3],y=l*l+d*d+p*p+_*_;return y>0&&(y=1/Math.sqrt(y)),h[0]=l*y,h[1]=d*y,h[2]=p*y,h[3]=_*y,h}function ls(h,o,l){var d=o[0],p=o[1],_=o[2],y=o[3];return h[0]=l[0]*d+l[4]*p+l[8]*_+l[12]*y,h[1]=l[1]*d+l[5]*p+l[9]*_+l[13]*y,h[2]=l[2]*d+l[6]*p+l[10]*_+l[14]*y,h[3]=l[3]*d+l[7]*p+l[11]*_+l[15]*y,h}function ko(){var h=new w(4);return w!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h[3]=1,h}function ja(h){return h[0]=0,h[1]=0,h[2]=0,h[3]=1,h}function $o(h,o,l){l*=.5;var d=o[0],p=o[1],_=o[2],y=o[3],A=Math.sin(l),S=Math.cos(l);return h[0]=d*S+y*A,h[1]=p*S+_*A,h[2]=_*S-p*A,h[3]=y*S-d*A,h}function ca(h,o,l){l*=.5;var d=o[0],p=o[1],_=o[2],y=o[3],A=Math.sin(l),S=Math.cos(l);return h[0]=d*S-_*A,h[1]=p*S+y*A,h[2]=_*S+d*A,h[3]=y*S-p*A,h}Lt(),ps();var ms,gs,Lc,Ha,Zl,Po=la,ha=(ms=Lt(),gs=ii(1,0,0),Lc=ii(0,1,0),function(h,o,l){var d=cn(o,l);return d<-.999999?(rr(ms,gs,o),$a(ms)<1e-6&&rr(ms,Lc,o),on(ms,ms),function(p,_,y){y*=.5;var A=Math.sin(y);p[0]=A*_[0],p[1]=A*_[1],p[2]=A*_[2],p[3]=Math.cos(y)}(h,ms,Math.PI),h):d>.999999?(h[0]=0,h[1]=0,h[2]=0,h[3]=1,h):(rr(ms,o,l),h[0]=ms[0],h[1]=ms[1],h[2]=ms[2],h[3]=1+d,Po(h,h))});function Ms(){var h=new w(2);return w!=Float32Array&&(h[0]=0,h[1]=0),h}function Wa(h,o){var l=new w(2);return l[0]=h,l[1]=o,l}function Ga(h,o,l){return h[0]=o[0]+l[0],h[1]=o[1]+l[1],h}function jo(h,o,l){return h[0]=o[0]-l[0],h[1]=o[1]-l[1],h}function er(h,o,l){return h[0]=o[0]*l,h[1]=o[1]*l,h}function ua(h){return Math.hypot(h[0],h[1])}function ml(h,o){var l=o[0],d=o[1],p=l*l+d*d;return p>0&&(p=1/Math.sqrt(p)),h[0]=o[0]*p,h[1]=o[1]*p,h}function On(h,o){return h[0]*o[0]+h[1]*o[1]}function Qs(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}ko(),ko(),k(),Ms();var Xa,Nr,zc=function(){if(Zl)return Ha;function h(o,l,d,p){this.cx=3*o,this.bx=3*(d-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=l,this.p2x=d,this.p2y=p}return Zl=1,Ha=h,h.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,l){if(l===void 0&&(l=1e-6),o<0)return 0;if(o>1)return 1;for(var d=o,p=0;p<8;p++){var _=this.sampleCurveX(d)-o;if(Math.abs(_)<l)return d;var y=this.sampleCurveDerivativeX(d);if(Math.abs(y)<1e-6)break;d-=_/y}var A=0,S=1;for(d=o,p=0;p<20&&(_=this.sampleCurveX(d),!(Math.abs(_-o)<l));p++)o>_?A=d:S=d,d=.5*(S-A)+A;return d},solve:function(o,l){return this.sampleCurveY(this.solveCurveX(o,l))}},Ha}(),Mh=Qs(zc);function ke(){if(Nr)return Xa;function h(o,l){this.x=o,this.y=l}return Nr=1,Xa=h,h.prototype={clone:function(){return new h(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,l){return this.clone()._rotateAround(o,l)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var l=o.x-this.x,d=o.y-this.y;return l*l+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,l){return Math.atan2(this.x*l-this.y*o,this.x*o+this.y*l)},_matMult:function(o){var l=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=l,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var l=Math.cos(o),d=Math.sin(o),p=d*this.x+l*this.y;return this.x=l*this.x-d*this.y,this.y=p,this},_rotateAround:function(o,l){var d=Math.cos(o),p=Math.sin(o),_=l.y+p*(this.x-l.x)+d*(this.y-l.y);return this.x=l.x+d*(this.x-l.x)-p*(this.y-l.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(o){return o instanceof h?o:Array.isArray(o)?new h(o[0],o[1]):o},Xa}var ue=Qs(ke());function st(h,o){if(Array.isArray(h)){if(!Array.isArray(o)||h.length!==o.length)return!1;for(let l=0;l<h.length;l++)if(!st(h[l],o[l]))return!1;return!0}if(typeof h=="object"&&h!==null&&o!==null){if(typeof o!="object"||Object.keys(h).length!==Object.keys(o).length)return!1;for(const l in h)if(!st(h[l],o[l]))return!1;return!0}return h===o}const Pt=Math.PI/180,Oe=180/Math.PI;function H(h){return h*Pt}function te(h){return h*Oe}const oe=[[0,0],[1,0],[1,1],[0,1]];function Ae(h){if(h<=0)return 0;if(h>=1)return 1;const o=h*h,l=o*h;return 4*(h<.5?l:3*(h-o)+l-.75)}function ye(h,o,l,d){const p=new Mh(h,o,l,d);return function(_){return p.solve(_)}}const Me=ye(.25,.1,.25,1);function De(h,o,l){return Math.min(l,Math.max(o,h))}function ze(h,o,l){return(l=De((l-h)/(o-h),0,1))*l*(3-2*l)}function We(h,o,l){const d=l-o,p=((h-o)%d+d)%d+o;return p===o?l:p}function nt(h,o,l){if(!h.length)return l(null,[]);let d=h.length;const p=new Array(h.length);let _=null;h.forEach((y,A)=>{o(y,(S,I)=>{S&&(_=S),p[A]=I,--d==0&&l(_,p)})})}function Ge(h,...o){for(const l of o)for(const d in l)h[d]=l[d];return h}let Rt=1;function zt(){return Rt++}function Yt(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))}function gi(h,o){h.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function xi(h,o,l){const d={};for(const p in h)d[p]=o.call(this,h[p],p,h);return d}function Si(h,o,l){const d={};for(const p in h)o.call(this,h[p],p,h)&&(d[p]=h[p]);return d}function Pi(h){return Array.isArray(h)?h.map(Pi):typeof h=="object"&&h?xi(h,Pi):h}const Hn={};function Bi(h){Hn[h]||(typeof console<"u"&&console.warn(h),Hn[h]=!0)}function yn(h,o,l){return(l.y-h.y)*(o.x-h.x)>(o.y-h.y)*(l.x-h.x)}function en(h){let o=0;for(let l,d,p=0,_=h.length,y=_-1;p<_;y=p++)l=h[p],d=h[y],o+=(d.x-l.x)*(l.y+d.y);return o}function An([h,o,l]){const d=H(o+90),p=H(l);return{x:h*Math.cos(d)*Math.sin(p),y:h*Math.sin(d)*Math.sin(p),z:h*Math.cos(p),azimuthal:o,polar:l}}function In(h){return(typeof self<"u"||h!==void 0)&&typeof WorkerGlobalScope<"u"&&(h!==void 0?h:self)instanceof WorkerGlobalScope}function pr(h){const o={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,p,_)=>{const y=p||_;return o[d]=!y||y.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Pr=null;function Xr(h,o){return[h[4*o],h[4*o+1],h[4*o+2],h[4*o+3]]}function cs(h,o,l,d){for(;o<l;){const p=o+l>>1;h[p]<d?o=p+1:l=p}return o}function gl(h,o,l,d){for(;o<l;){const p=o+l>>1;h[p]<=d?o=p+1:l=p}return o}function Rs(h){return h>0?1/(1.001-h):1+h}function ks(h){return h>0?1-1/(1.001-h):-h}function Jr(h,o,l){return(h-o.min)*(l.max-l.min)/(o.max-o.min)+l.min}const _s={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!_s.API_URL)return null;try{const h=new URL(_s.API_URL);return h.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":h.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function qa(h){return _s.API_URL_REGEX.test(h)}function Nc(h){return _s.API_SPRITE_REGEX.test(h)}let Gu,Rh,Lf,Xu,Uc,qu;function ig(){return Gu==null&&(Gu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Gu}const da={now:()=>Xu!==void 0?Xu:performance.now(),setNow(h){Xu=h},restoreNow(){Xu=void 0},frame(h){const o=requestAnimationFrame(h);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(h,o=0){const{width:l,height:d}=h;Uc||(Uc=document.createElement("canvas"));const p=Uc.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>Uc.width||d>Uc.height)&&(Uc.width=l,Uc.height=d),p.clearRect(-o,-o,l+2*o,d+2*o),p.drawImage(h,0,0,l,d),p.getImageData(-o,-o,l+2*o,d+2*o)},resolveURL:h=>(Rh||(Rh=document.createElement("a")),Rh.href=h,Rh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Lf==null&&(Lf=window.matchMedia("(prefers-reduced-motion: reduce)")),Lf.matches)},hasCanvasFingerprintNoise(){if(qu!==void 0)return qu;if(!ig())return qu=!1,!1;const h=new OffscreenCanvas(85,1),o=h.getContext("2d",{willReadFrequently:!0});let l=0;for(let p=0;p<h.width;++p)o.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,o.fillRect(p,0,1,1);const d=o.getImageData(0,0,h.width,h.height);l=0;for(let p=0;p<d.data.length;++p)if(p%4!=3&&l++!==d.data[p])return qu=!0,!0;return qu=!1,!1}};function ng(h,o){const l=h.indexOf("?");if(l<0)return`${h}?${new URLSearchParams(o).toString()}`;const d=new URLSearchParams(h.slice(l));for(const p in o)d.set(p,o[p]);return`${h.slice(0,l)}?${d.toString()}`}function _o(h,o={persistentParams:[]}){const l=h.indexOf("?");if(l<0)return h;const d=new URLSearchParams,p=new URLSearchParams(h.slice(l));for(const y of o.persistentParams){const A=p.get(y);A&&d.set(y,A)}const _=d.toString();return`${h.slice(0,l)}${_.length>0?`?${_}`:""}`}const fa="mapbox-tiles";let _l=500,pa=50;const yl=["language","worldview","jobid"];let Ho,Yu;function rg(){try{return caches}catch{}}function bl(){const h=rg();h&&Ho==null&&(Ho=h.open(fa))}let Zu=1/0;const sg={supported:!1,testSupport:function(h){!zf&&Ns&&(Nf?O0(h):Ku=h)}};let Ku,Ns,zf=!1,Nf=!1;const kh=typeof self<"u"?self:{};function O0(h){const o=h.createTexture();h.bindTexture(h.TEXTURE_2D,o);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Ns),h.isContextLost())return;sg.supported=!0}catch{}h.deleteTexture(o),zf=!0}kh.document&&(Ns=kh.document.createElement("img"),Ns.onload=function(){Ku&&O0(Ku),Ku=null,Nf=!0},Ns.onerror=function(){zf=!0,Ku=null},Ns.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Uf={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Uf);class Vf extends Error{constructor(o,l,d){l===401&&qa(d)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ki=In()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ph=function(h,o){if(!(/^file:/.test(l=h.url)||/^file:/.test(Ki())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,p){const _=new AbortController,y=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Ki(),referrerPolicy:d.referrerPolicy,signal:_.signal});let A=!1,S=!1;const I=(R=y.url).indexOf("sku=")>0&&qa(R);var R;d.type==="json"&&y.headers.set("Accept","application/json");const P=(N,U,j)=>{if(S)return;if(N&&N.message!=="SecurityError"&&Bi(N.toString()),U&&j)return B(U);const K=Date.now();fetch(y).then(ee=>{if(ee.ok){const le=I?ee.clone():null;return B(ee,le,K)}return p(new Vf(ee.statusText,ee.status,d.url))}).catch(ee=>{ee.name!=="AbortError"&&p(new Error(`${ee.message} ${d.url}`))})},B=(N,U,j)=>{(d.type==="arrayBuffer"?N.arrayBuffer():d.type==="json"?N.json():N.text()).then(K=>{S||(U&&j&&function(ee,le,re){if(bl(),Ho==null)return;const G=pr(le.headers.get("Cache-Control")||"");if(G["no-store"])return;const ie={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((Ce,Be)=>ie.headers.set(Be,Ce)),G["max-age"]&&ie.headers.set("Expires",new Date(re+1e3*G["max-age"]).toUTCString());const ae=ie.headers.get("Expires");if(!ae||new Date(ae).getTime()-re<42e4)return;let fe=_o(ee.url,{persistentParams:yl});if(le.status===206){const Ce=ee.headers.get("Range");if(!Ce)return;ie.status=200,fe=ng(fe,{range:Ce})}(function(Ce,Be){if(Yu===void 0)try{new Response(new ReadableStream),Yu=!0}catch{Yu=!1}Yu?Be(Ce.body):Ce.blob().then(Be).catch(Fe=>Bi(Fe.message))})(le,Ce=>{const Be=new Response((Fe=le.status)!==200&&Fe!==404&&[101,103,204,205,304].includes(Fe)?null:Ce,ie);var Fe;bl(),Ho!=null&&Ho.then(Ve=>Ve.put(fe,Be)).catch(Ve=>Bi(Ve.message))})}(y,U,j),A=!0,p(null,K,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(K=>{S||p(new Error(K.message))})};return I?function(N,U){if(bl(),Ho==null)return U(null);Ho.then(j=>{let K=_o(N.url,{persistentParams:yl});const ee=N.headers.get("Range");ee&&(K=ng(K,{range:ee})),j.match(K).then(le=>{const re=function(G){if(!G)return!1;const ie=new Date(G.headers.get("Expires")||0),ae=pr(G.headers.get("Cache-Control")||"");return Number(ie)>Date.now()&&!ae["no-cache"]}(le);j.delete(K).catch(U),re&&j.put(K,le.clone()).catch(U),U(null,le,re)}).catch(U)}).catch(U)}(y,P):P(null,null),{cancel:()=>{S=!0,A||_.abort()}}}(h,o);if(In(self)&&self.worker.actor)return self.worker.actor.send("getResource",h,o,void 0,!0)}var l;return function(d,p){const _=new XMLHttpRequest;_.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const y in d.headers)_.setRequestHeader(y,d.headers[y]);return d.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=d.credentials==="include",_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let y=_.response;if(d.type==="json")try{y=JSON.parse(_.response)}catch(A){return p(A)}p(null,y,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else p(new Vf(_.statusText,_.status,d.url))},_.send(d.body),{cancel:()=>_.abort()}}(h,o)},Dh=function(h,o){return Ph(Ge(h,{type:"arrayBuffer"}),o)};function Dw(h){const o=document.createElement("a");return o.href=h,o.protocol===location.protocol&&o.host===location.host}const F0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Vc,Kl;Vc=[],Kl=0;const Bh=function(h,o){if(sg.supported&&(h.headers||(h.headers={}),h.headers.accept="image/webp,*/*"),Kl>=_s.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:h,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return Vc.push(_),_}Kl++;let l=!1;const d=()=>{if(!l)for(l=!0,Kl--;Vc.length&&Kl<_s.MAX_PARALLEL_IMAGE_REQUESTS;){const _=Vc.shift(),{requestParameters:y,callback:A,cancelled:S}=_;S||(_.cancel=Bh(y,A).cancel)}},p=Dh(h,(_,y,A,S)=>{d(),_?o(_):y&&(self.createImageBitmap?function(I,R){const P=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(P).then(B=>{R(null,B)}).catch(B=>{R(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(I,R)=>o(I,R,A,S)):function(I,R){const P=new Image;P.onload=()=>{R(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=F0})},P.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new Blob([new Uint8Array(I)],{type:"image/png"});P.src=I.byteLength?URL.createObjectURL(B):F0}(y,(I,R)=>o(I,R,A,S)))});return{cancel:()=>{p.cancel(),d()}}};var L0,og,$c,Ju={exports:{}},Oh={exports:{}},$f={exports:{}},ag=function(){if($c)return Ju.exports;$c=1;var h=(L0||(L0=1,Oh.exports=function(l,d){var p,_,y,A,S,I,R,P;for(_=l.length-(p=3&l.length),y=d,S=3432918353,I=461845907,P=0;P<_;)R=255&l.charCodeAt(P)|(255&l.charCodeAt(++P))<<8|(255&l.charCodeAt(++P))<<16|(255&l.charCodeAt(++P))<<24,++P,y=27492+(65535&(A=5*(65535&(y=(y^=R=(65535&(R=(R=(65535&R)*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*I+(((R>>>16)*I&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(R=0,p){case 3:R^=(255&l.charCodeAt(P+2))<<16;case 2:R^=(255&l.charCodeAt(P+1))<<8;case 1:y^=R=(65535&(R=(R=(65535&(R^=255&l.charCodeAt(P)))*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*I+(((R>>>16)*I&65535)<<16)&4294967295}return y^=l.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Oh.exports),o=(og||(og=1,$f.exports=function(l,d){for(var p,_=l.length,y=d^_,A=0;_>=4;)p=1540483477*(65535&(p=255&l.charCodeAt(A)|(255&l.charCodeAt(++A))<<8|(255&l.charCodeAt(++A))<<16|(255&l.charCodeAt(++A))<<24))+((1540483477*(p>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++A;switch(_){case 3:y^=(255&l.charCodeAt(A+2))<<16;case 2:y^=(255&l.charCodeAt(A+1))<<8;case 1:y=1540483477*(65535&(y^=255&l.charCodeAt(A)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),$f.exports);return Ju.exports=h,Ju.exports.murmur3=h,Ju.exports.murmur2=o,Ju.exports}(),yo=Qs(ag);class Jl{constructor(o,...l){Ge(this,l[0]||{}),this.type=o}}class lg extends Jl{constructor(o,l={}){super("error",Ge({error:o},l))}}function cg(h,o,l){l[h]&&l[h].indexOf(o)!==-1||(l[h]=l[h]||[],l[h].push(o))}function jf(h,o,l){if(l&&l[h]){const d=l[h].indexOf(o);d!==-1&&l[h].splice(d,1)}}class jc{on(o,l){return this._listeners=this._listeners||{},cg(o,l,this._listeners),this}off(o,l){return jf(o,l,this._listeners),jf(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},cg(o,l,this._oneTimeListeners),this):new Promise(d=>{this.once(o,d)})}fire(o,l){const d=typeof o=="string"?new Jl(o,l):o,p=d.type;if(this.listens(p)){d.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const S of _)S.call(this,d);const y=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const S of y)jf(p,S,this._oneTimeListeners),S.call(this,d);const A=this._eventedParent;A&&(Ge(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(d))}else d instanceof lg&&console.error(d.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}class bo{constructor(o){typeof o=="string"?this.name=o:(this.name=o.name,this.iconsetId=o.iconsetId)}static from(o){return new bo(o)}static toString(o){return o.iconsetId?`${o.name}${o.iconsetId}`:o.name}static parse(o){const[l,d]=o.split("");return new bo({name:l,iconsetId:d})}static isEqual(o,l){return o.name===l.name&&o.iconsetId===l.iconsetId}toString(){return bo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var hg,Hf={},Qu=function(){if(hg)return Hf;hg=1;var h={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(_){return(_=Math.round(_))<0?0:_>255?255:_}function l(_){return o(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function d(_){return(y=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:y>1?1:y;var y}function p(_,y,A){return A<0?A+=1:A>1&&(A-=1),6*A<1?_+(y-_)*A*6:2*A<1?y:3*A<2?_+(y-_)*(2/3-A)*6:_}try{Hf.parseCSSColor=function(_){var y,A=_.replace(/ /g,"").toLowerCase();if(A in h)return h[A].slice();if(A[0]==="#")return A.length===4?(y=parseInt(A.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:A.length===7&&(y=parseInt(A.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var S=A.indexOf("("),I=A.indexOf(")");if(S!==-1&&I+1===A.length){var R=A.substr(0,S),P=A.substr(S+1,I-(S+1)).split(","),B=1;switch(R){case"rgba":if(P.length!==4)return null;B=d(P.pop());case"rgb":return P.length!==3?null:[l(P[0]),l(P[1]),l(P[2]),B];case"hsla":if(P.length!==4)return null;B=d(P.pop());case"hsl":if(P.length!==3)return null;var N=(parseFloat(P[0])%360+360)%360/360,U=d(P[1]),j=d(P[2]),K=j<=.5?j*(U+1):j+U-j*U,ee=2*j-K;return[o(255*p(ee,K,N+1/3)),o(255*p(ee,K,N)),o(255*p(ee,K,N-1/3)),B];default:return null}}return null}}catch{}return Hf}();class rn{constructor(o,l,d,p=1){this.r=o,this.g=l,this.b=d,this.a=p}static parse(o){if(!o)return;if(o instanceof rn)return o;if(typeof o!="string")return;const l=Qu.parseCSSColor(o);return l?new rn(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toStringPremultipliedAlpha(){const[o,l,d,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(d)},${p})`}toString(){const[o,l,d,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*o)},${Math.round(255*l)},${Math.round(255*d)},${p})`}toRenderColor(o){const{r:l,g:d,b:p,a:_}=this;return new z0(o,l,d,p,_)}clone(){return new rn(this.r,this.g,this.b,this.a)}}class z0{constructor(o,l,d,p,_){if(o){const y=o.image.height,A=y*y;l=_===0?0:l/_*(y-1),d=_===0?0:d/_*(y-1),p=_===0?0:p/_*(y-1);const S=Math.floor(l),I=Math.floor(d),R=Math.floor(p),P=Math.ceil(l),B=Math.ceil(d),N=Math.ceil(p),U=l-S,j=d-I,K=p-R,ee=o.image.data,le=4*(S+I*A+R*y),re=4*(S+I*A+N*y),G=4*(S+B*A+R*y),ie=4*(S+B*A+N*y),ae=4*(P+I*A+R*y),fe=4*(P+I*A+N*y),Ce=4*(P+B*A+R*y),Be=4*(P+B*A+N*y);if(le<0||Be>=ee.length)throw new Error("out of range");this.r=ri(ri(ri(ee[le],ee[re],K),ri(ee[G],ee[ie],K),j),ri(ri(ee[ae],ee[fe],K),ri(ee[Ce],ee[Be],K),j),U)/255*_,this.g=ri(ri(ri(ee[le+1],ee[re+1],K),ri(ee[G+1],ee[ie+1],K),j),ri(ri(ee[ae+1],ee[fe+1],K),ri(ee[Ce+1],ee[Be+1],K),j),U)/255*_,this.b=ri(ri(ri(ee[le+2],ee[re+2],K),ri(ee[G+2],ee[ie+2],K),j),ri(ri(ee[ae+2],ee[fe+2],K),ri(ee[Ce+2],ee[Be+2],K),j),U)/255*_,this.a=_}else this.r=l,this.g=d,this.b=p,this.a=_}toArray(){const{r:o,g:l,b:d,a:p}=this;return p===0?[0,0,0,0]:[255*o/p,255*l/p,255*d/p,p]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:o,g:l,b:d,a:p}=this,_=Math.min(Math.max(o/p,0),1),y=Math.min(Math.max(l/p,0),1),A=Math.min(Math.max(d/p,0),1),S=Math.min(_,y,A),I=Math.max(_,y,A),R=(S+I)/2;if(S===I)return[0,0,100*R,p];const P=I-S,B=R>.5?P/(2-I-S):P/(I+S);let N=0;return I===_?N=(y-A)/P+(y<A?6:0):I===y?N=(A-_)/P+2:I===A&&(N=(_-y)/P+4),N*=60,[Math.min(Math.max(N,0),360),Math.min(Math.max(100*B,0),100),Math.min(Math.max(100*R,0),100),p]}toArray01(){const{r:o,g:l,b:d,a:p}=this;return p===0?[0,0,0,0]:[o/p,l/p,d/p,p]}toArray01Scaled(o){const{r:l,g:d,b:p,a:_}=this;return _===0?[0,0,0]:[l/_*o,d/_*o,p/_*o]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:d,a:p}=this;return[o,l,d,p]}toArray01Linear(){const{r:o,g:l,b:d,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(o/p,2.2),Math.pow(l/p,2.2),Math.pow(d/p,2.2),p]}}function ri(h,o,l){return h*(1-l)+o*l}function N0(h,o,l){return h.map((d,p)=>ri(d,o[p],l))}function Wf(h){return h*h*h*h*h}rn.black=new rn(0,0,0,1),rn.white=new rn(1,1,1,1),rn.transparent=new rn(0,0,0,0),rn.red=new rn(1,0,0,1),rn.blue=new rn(0,0,1,1);var Gf=Object.freeze({__proto__:null,array:N0,color:function(h,o,l){return new rn(ri(h.r,o.r,l),ri(h.g,o.g,l),ri(h.b,o.b,l),ri(h.a,o.a,l))},easeIn:Wf,number:ri});function ed(h,...o){for(const l of o)for(const d in l)h[d]=l[d];return h}class Wo extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}class Hc{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[d,p]of l)this.bindings[d]=p}concat(o){return new Hc(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Ql={kind:"null"},ti={kind:"number"},bn={kind:"string"},hn={kind:"boolean"},eo={kind:"color"},ec={kind:"object"},an={kind:"value"},Wc={kind:"collator"},td={kind:"formatted"},id={kind:"resolvedImage"};function Us(h,o){return{kind:"array",itemType:h,N:o}}function Dr(h){if(h.kind==="array"){const o=Dr(h.itemType);return typeof h.N=="number"?`array<${o}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${o}>`}return h.kind}const Bw=[Ql,ti,bn,hn,eo,td,ec,Us(an),id];function nd(h,o){if(o.kind==="error")return null;if(h.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!nd(h.itemType,o.itemType))&&(typeof h.N!="number"||h.N===o.N))return null}else{if(h.kind===o.kind)return null;if(h.kind==="value"){for(const l of Bw)if(!nd(l,o))return null}}return`Expected ${Dr(h)} but found ${Dr(o)} instead.`}function ug(h,o){return o.some(l=>l.kind===h.kind)}function Fh(h,o){return o.some(l=>l==="null"?h===null:l==="array"?Array.isArray(h):l==="object"?h&&!Array.isArray(h)&&typeof h=="object":l===typeof h)}class tc{constructor(o,l,d){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xf{constructor(o,l,d,p,_){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=d,this.fontStack=p,this.textColor=_}}class Vs{constructor(o){this.sections=o}static fromString(o){return new Vs([new Xf(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||!!o.image&&o.image.hasPrimary())}static factory(o){return o instanceof Vs?o:Vs.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){const p=l.image.getPrimary().id.toString();o.push(["image",p]);continue}o.push(l.text);const d={};l.fontStack&&(d["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(d["font-scale"]=l.scale),l.textColor&&(d["text-color"]=["rgba"].concat(l.textColor.toRenderColor(null).toArray())),o.push(d)}return o}}class ma{constructor(o,l={}){if(this.id=bo.from(o),this.options=Object.assign({},l),l.transform){const{a:d,b:p,c:_,d:y,e:A,f:S}=l.transform;this.options.transform=new DOMMatrix([d,p,_,y,A,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:o,b:l,c:d,d:p,e:_,f:y}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:o,b:l,c:d,d:p,e:_,f:y}})}static parse(o){let l,d,p,_;try{({name:l,iconsetId:d,params:p,transform:_}=JSON.parse(o)||{})}catch{return null}if(!l)return null;const{a:y,b:A,c:S,d:I,e:R,f:P}=_||{};return new ma({name:l,iconsetId:d},{params:p,transform:new DOMMatrix([y,A,S,I,R,P])})}scaleSelf(o,l){return this.options.transform.scaleSelf(o,l),this}}class to{constructor(o,l,d,p,_=!1){this.primaryId=bo.from(o),this.primaryOptions=l,d&&(this.secondaryId=bo.from(d)),this.secondaryOptions=p,this.available=_}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ma(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ma(this.secondaryId,this.secondaryOptions):null}static from(o){return typeof o=="string"?to.build({name:o}):o}static build(o,l,d,p){return!o||typeof o=="object"&&!("name"in o)?null:new to(o,d,l,p)}}function U0(h,o,l,d){return typeof h=="number"&&h>=0&&h<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[h,o,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[h,o,l,d]:[h,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Lh(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof rn||h instanceof tc||h instanceof Vs||h instanceof to)return!0;if(Array.isArray(h)){for(const o of h)if(!Lh(o))return!1;return!0}if(typeof h=="object"){for(const o in h)if(!Lh(h[o]))return!1;return!0}return!1}function Ur(h){if(h===null)return Ql;if(typeof h=="string")return bn;if(typeof h=="boolean")return hn;if(typeof h=="number")return ti;if(h instanceof rn)return eo;if(h instanceof tc)return Wc;if(h instanceof Vs)return td;if(h instanceof to)return id;if(Array.isArray(h)){const o=h.length;let l;for(const d of h){const p=Ur(d);if(l){if(l===p)continue;l=an;break}l=p}return Us(l||an,o)}return ec}function $s(h){const o=typeof h;return h===null?"":o==="string"||o==="number"||o==="boolean"?String(h):h instanceof rn?h.toStringPremultipliedAlpha():h instanceof Vs||h instanceof to?h.toString():JSON.stringify(h)}class Ri{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(o.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Lh(o[1]))return l.error("invalid value");const d=o[1];let p=Ur(d);const _=l.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new Ri(p,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof rn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Vs?this.value.serialize():this.value}}class Wt{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const rd={string:bn,number:ti,boolean:hn,object:ec};class di{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let d,p=1;const _=o[0];if(_==="array"){let A,S;if(o.length>2){const I=o[1];if(typeof I!="string"||!(I in rd)||I==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);A=rd[I],p++}else A=an;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);S=o[2],p++}d=Us(A,S)}else d=rd[_];const y=[];for(;p<o.length;p++){const A=l.parse(o[p],p,an);if(!A)return null;y.push(A)}return new di(d,y)}evaluate(o){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(o);if(!nd(this.type,Ur(d)))return d;if(l===this.args.length-1)throw new Wt(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${Dr(Ur(d))} but was expected to be of type ${Dr(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if(o.kind==="array"){const d=o.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){l.push(d.kind);const p=o.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(d=>d.serialize()))}}class Gc{constructor(o){this.type=td,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[1];if(!Array.isArray(d)&&typeof d=="object")return l.error("First argument must be an image or text section.");const p=[];let _=!1;for(let y=1;y<=o.length-1;++y){const A=o[y];if(_&&typeof A=="object"&&!Array.isArray(A)){_=!1;let S=null;if(A["font-scale"]&&(S=l.parseObjectValue(A["font-scale"],y,"font-scale",ti),!S))return null;let I=null;if(A["text-font"]&&(I=l.parseObjectValue(A["text-font"],y,"text-font",Us(bn)),!I))return null;let R=null;if(A["text-color"]&&(R=l.parseObjectValue(A["text-color"],y,"text-color",eo),!R))return null;const P=p[p.length-1];P.scale=S,P.font=I,P.textColor=R}else{const S=l.parse(o[y],y,an);if(!S)return null;const I=S.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:S,scale:null,font:null,textColor:null})}}return new Gc(p)}evaluate(o){return new Vs(this.sections.map(l=>{const d=l.content.evaluate(o);return Ur(d)===id?new Xf("",d,null,null,null):new Xf($s(d),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const d={};l.scale&&(d["font-scale"]=l.scale.serialize()),l.font&&(d["text-font"]=l.font.serialize()),l.textColor&&(d["text-color"]=l.textColor.serialize()),o.push(d)}return o}}class zh{constructor(o,l,d,p){this._imageWarnHistory={},this.type=id,this.namePrimary=o,this.nameSecondary=l,d&&(this.paramsPrimary=d.params,this.iconsetIdPrimary=d.iconset?d.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(o,l){if(o.length<2)return l.error("Expected two or more arguments.");let d=1;const p=[];function _(){if(d<o.length){const A=l.parse(o[d],d++,bn);return A?(p.push({image:A,options:{}}),!0):(l.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(d<o.length){const S=o[d];if((A=S)===null||typeof A!="object"||Array.isArray(A))return!0;const I=S.params,R=S.iconset,P=l.concat(d);if(!I&&!R)return d++,!0;if(I){if(typeof I!="object"||I.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const B={},N=P.concat(void 0,"params");for(const U in I){if(!U)return N.error("Image parameter name should be non-empty"),!1;const j=N.concat(void 0,U).parse(I[U],void 0,eo,void 0,{typeAnnotation:"coerce"});if(!j)return!1;B[U]=j}p[p.length-1].options.params=B}if(R){if(typeof R!="object"||R.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!R.id)return P.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=R}return d++,!0}var A;return!0}for(let A=0;A<2;A++)if(!_()||!y())return;return new zh(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(o,l){const d={};if(l){for(const p in l)if(l[p])try{d[p]=l[p].evaluate(o)}catch{continue}if(Object.keys(d).length!==0)return{params:d}}}evaluate(o){const l={name:this.namePrimary.evaluate(o),iconsetId:this.iconsetIdPrimary},d=this.nameSecondary?{name:this.nameSecondary.evaluate(o),iconsetId:this.iconsetIdSecondary}:void 0,p=to.build(l,d,this.paramsPrimary?this.evaluateParams(o,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(o,this.paramsSecondary):void 0);if(p&&o.availableImages){const _=p.getPrimary().id;if(p.available=o.availableImages.some(y=>bo.isEqual(y,_)),p.available){const y=p.getSecondary()?p.getSecondary().id:null;y&&(p.available=o.availableImages.some(A=>bo.isEqual(A,y)))}}return p}eachChild(o){if(o(this.namePrimary),this.paramsPrimary)for(const l in this.paramsPrimary)this.paramsPrimary[l]&&o(this.paramsPrimary[l]);if(this.nameSecondary&&(o(this.nameSecondary),this.paramsSecondary))for(const l in this.paramsSecondary)this.paramsSecondary[l]&&o(this.paramsSecondary[l])}outputDefined(){return!1}serializeOptions(o,l){const d={};if(l&&(d.iconset={id:l}),o){d.params={};for(const p in o)o[p]&&(d.params[p]=o[p].serialize())}return Object.keys(d).length>0?d:void 0}serialize(){const o=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const l=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);l&&o.push(l)}if(this.nameSecondary&&(o.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const l=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);l&&o.push(l)}return o}}function fi(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}const V0={"to-boolean":hn,"to-color":eo,"to-number":ti,"to-string":bn};class ga{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[0],p=[];let _=Ql;if(d==="to-array"){if(!Array.isArray(o[1]))return null;const y=o[1].length;if(l.expectedType){if(l.expectedType.kind!=="array")return l.error(`Expected ${l.expectedType.kind} but found array.`);_=Us(l.expectedType.itemType,y)}else{if(!(y>0&&Lh(o[1][0])))return null;_=Us(Ur(o[1][0]),y)}for(let A=0;A<y;A++){const S=o[1][A];let I;if(fi(S)==="array")I=l.parse(S,void 0,_.itemType);else{const R=fi(S);if(R!==_.itemType.kind)return l.error(`Expected ${_.itemType.kind} but found ${R}.`);I=l.registry.literal.parse(["literal",S===void 0?null:S],l)}if(!I)return null;p.push(I)}}else{if((d==="to-boolean"||d==="to-string")&&o.length!==2)return l.error("Expected one argument.");_=V0[d];for(let y=1;y<o.length;y++){const A=l.parse(o[y],y,an);if(!A)return null;p.push(A)}}return new ga(_,p)}evaluate(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){let l,d;for(const p of this.args){if(l=p.evaluate(o),d=null,l instanceof rn)return l;if(typeof l=="string"){const _=o.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:U0(l[0],l[1],l[2],l[3]),!d))return new rn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Wt(d||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const d of this.args){if(l=d.evaluate(o),l===null)return 0;const p=Number(l);if(!isNaN(p))return p}throw new Wt(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?Vs.fromString($s(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?to.build($s(this.args[0].evaluate(o))):this.type.kind==="array"?this.args.map(l=>l.evaluate(o)):$s(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Gc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new zh(this.args[0]).serialize();const o=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}const $0=["Unknown","Point","LineString","Polygon"];class qf{constructor(o,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:d,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*l-o[0])+this.featureDistanceData.bearing[1]*(p*l-o[1])}return 0}parseColor(o){let l=this._parseColorCache[o];return l||(l=this._parseColorCache[o]=rn.parse(o)),l}getConfig(o){return this.options?this.options.get(o):null}}class Ps{constructor(o,l,d,p,_){this.name=o,this.type=l,this._evaluate=d,this.args=p,this._overloadIndex=_}evaluate(o){if(!this._evaluate){const l=Ps.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const d=o[0],p=Ps.definitions[d];if(!p)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,A=[];let S=null,I=-1;for(const[R,P]of y){if(Array.isArray(R)&&R.length!==o.length-1)continue;A.push(R),I++,S=new J0(l.registry,l.path,null,l.scope,void 0,l._scope,l.options);const B=[];let N=!1;for(let U=1;U<o.length;U++){const j=o[U],K=Array.isArray(R)?R[U-1]:R.type,ee=S.parse(j,1+B.length,K);if(!ee){N=!0;break}B.push(ee)}if(!N)if(Array.isArray(R)&&R.length!==B.length)S.error(`Expected ${R.length} arguments, but found ${B.length} instead.`);else{for(let U=0;U<B.length;U++){const j=Array.isArray(R)?R[U]:R.type,K=B[U];S.concat(U+1).checkSubtype(j,K.type)}if(S.errors.length===0)return new Ps(d,_,P,B,I)}}if(A.length===1)l.errors.push(...S.errors);else{const R=(A.length?A:y.map(([B])=>B)).map(js).join(" | "),P=[];for(let B=1;B<o.length;B++){const N=l.parse(o[B],1+P.length);if(!N)return null;P.push(Dr(N.type))}l.error(`Expected arguments of type ${R}, but found (${P.join(", ")}) instead.`)}return null}static register(o,l){Ps.definitions=l;for(const d in l)o[d]=Ps}}function js(h){return Array.isArray(h)?`(${h.map(Dr).join(", ")})`:`(${Dr(h.type)}...)`}class Nh{constructor(o,l,d){this.type=Wc,this.locale=d,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(o.length!==2)return l.error("Expected one argument.");const d=o[1];if(typeof d!="object"||Array.isArray(d))return l.error("Collator options argument must be an object.");const p=d["case-sensitive"]===void 0?l.parse(!1,1,hn):l.parseObjectValue(d["case-sensitive"],1,"case-sensitive",hn);if(!p)return null;const _=d["diacritic-sensitive"]===void 0?l.parse(!1,1,hn):l.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",hn);if(!_)return null;let y=null;return d.locale&&(y=l.parseObjectValue(d.locale,1,"locale",bn),!y)?null:new Nh(p,_,y)}evaluate(o){return new tc(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function ic(h,o,l=0,d=h.length-1,p=qc){for(;d>l;){if(d-l>600){const S=d-l+1,I=o-l+1,R=Math.log(S),P=.5*Math.exp(2*R/3),B=.5*Math.sqrt(R*P*(S-P)/S)*(I-S/2<0?-1:1);ic(h,o,Math.max(l,Math.floor(o-I*P/S+B)),Math.min(d,Math.floor(o+(S-I)*P/S+B)),p)}const _=h[o];let y=l,A=d;for(Xc(h,l,o),p(h[d],_)>0&&Xc(h,l,d);y<A;){for(Xc(h,y,A),y++,A--;p(h[y],_)<0;)y++;for(;p(h[A],_)>0;)A--}p(h[l],_)===0?Xc(h,l,A):(A++,Xc(h,A,d)),A<=o&&(l=A+1),o<=A&&(d=A-1)}}function Xc(h,o,l){const d=h[o];h[o]=h[l],h[l]=d}function qc(h,o){return h<o?-1:h>o?1:0}function Hs(h){let o=0;for(let l,d,p=0,_=h.length,y=_-1;p<_;y=p++)l=h[p],d=h[y],o+=(d.x-l.x)*(l.y+d.y);return o}function sd(h,o){h[0]=Math.min(h[0],o[0]),h[1]=Math.min(h[1],o[1]),h[2]=Math.max(h[2],o[0]),h[3]=Math.max(h[3],o[1])}function od(h,o){return!(h[0]<=o[0]||h[2]>=o[2]||h[1]<=o[1]||h[3]>=o[3])}function Ow(h,o,l){const d=h[0]-o[0],p=h[1]-o[1],_=h[0]-l[0],y=h[1]-l[1];return d*y-_*p==0&&d*_<=0&&p*y<=0}function vl(h,o,l=!1){let d=!1;for(let A=0,S=o.length;A<S;A++){const I=o[A];for(let R=0,P=I.length,B=P-1;R<P;B=R++){const N=I[B],U=I[R];if(Ow(h,N,U))return l;(_=N)[1]>(p=h)[1]!=(y=U)[1]>p[1]&&p[0]<(y[0]-_[0])*(p[1]-_[1])/(y[1]-_[1])+_[0]&&(d=!d)}}var p,_,y;return d}function dg(h,o,l,d){const p=d[0]-l[0],_=d[1]-l[1],y=(h[0]-l[0])*_-p*(h[1]-l[1]),A=(o[0]-l[0])*_-p*(o[1]-l[1]);return y>0&&A<0||y<0&&A>0}function Ya(h,o,l,d){return(p=[d[0]-l[0],d[1]-l[1]])[0]*(_=[o[0]-h[0],o[1]-h[1]])[1]-p[1]*_[0]!=0&&!(!dg(h,o,l,d)||!dg(l,d,h,o));var p,_}function fg(h){const o=new ue(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new ue(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const d of h[0])o.x>d.x&&(o.x=d.x),o.y>d.y&&(o.y=d.y),l.x<d.x&&(l.x=d.x),l.y<d.y&&(l.y=d.y);return{min:o,max:l}}const nc=8192;function Fw(h,o){const l=(180+h[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,p=Math.pow(2,o.z);return[Math.round(l*p*nc),Math.round(d*p*nc)]}function Lw(h,o){for(let l=0;l<o.length;l++)if(vl(h,o[l]))return!0;return!1}function j0(h,o,l){for(const d of l)for(let p=0,_=d.length,y=_-1;p<_;y=p++)if(Ya(h,o,d[y],d[p]))return!0;return!1}function H0(h,o){for(let l=0;l<h.length;++l)if(!vl(h[l],o))return!1;for(let l=0;l<h.length-1;++l)if(j0(h[l],h[l+1],o))return!1;return!0}function zw(h,o){for(let l=0;l<o.length;l++)if(H0(h,o[l]))return!0;return!1}function Yf(h,o,l){const d=[];for(let p=0;p<h.length;p++){const _=[];for(let y=0;y<h[p].length;y++){const A=Fw(h[p][y],l);sd(o,A),_.push(A)}d.push(_)}return d}function W0(h,o,l){const d=[];for(let p=0;p<h.length;p++){const _=Yf(h[p],o,l);d.push(_)}return d}function rc(h,o,l,d){if(h[0]<l[0]||h[0]>l[2]){const p=.5*d;let _=h[0]-l[0]>p?-d:l[0]-h[0]>p?d:0;_===0&&(_=h[0]-l[2]>p?-d:l[2]-h[0]>p?d:0),h[0]+=_}sd(o,h)}function G0(h,o,l,d){const p=Math.pow(2,d.z)*nc,_=[d.x*nc,d.y*nc],y=[];if(!h)return y;for(const A of h)for(const S of A){const I=[S.x+_[0],S.y+_[1]];rc(I,o,l,p),y.push(I)}return y}function X0(h,o,l,d){const p=Math.pow(2,d.z)*nc,_=[d.x*nc,d.y*nc],y=[];if(!h)return y;for(const S of h){const I=[];for(const R of S){const P=[R.x+_[0],R.y+_[1]];sd(o,P),I.push(P)}y.push(I)}if(o[2]-o[0]<=p/2){(A=o)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const S of y)for(const I of S)rc(I,o,l,p)}var A;return y}class xl{constructor(o,l){this.type=hn,this.geojson=o,this.geometries=l}static parse(o,l){if(o.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Lh(o[1])){const d=o[1];if(d.type==="FeatureCollection")for(let p=0;p<d.features.length;++p){const _=d.features[p].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new xl(d,d.features[p].geometry)}else if(d.type==="Feature"){const p=d.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new xl(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new xl(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(l,d){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(d.type==="Polygon"){const A=Yf(d.coordinates,_,y),S=G0(l.geometry(),p,_,y);if(!od(p,_))return!1;for(const I of S)if(!vl(I,A))return!1}if(d.type==="MultiPolygon"){const A=W0(d.coordinates,_,y),S=G0(l.geometry(),p,_,y);if(!od(p,_))return!1;for(const I of S)if(!Lw(I,A))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(l,d){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(d.type==="Polygon"){const A=Yf(d.coordinates,_,y),S=X0(l.geometry(),p,_,y);if(!od(p,_))return!1;for(const I of S)if(!H0(I,A))return!1}if(d.type==="MultiPolygon"){const A=W0(d.coordinates,_,y),S=X0(l.geometry(),p,_,y);if(!od(p,_))return!1;for(const I of S)if(!zw(I,A))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ad={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},pg=1/298.257223563,Go=pg*(2-pg),Uh=Math.PI/180;class Vh{static fromTile(o,l,d){const p=Math.PI*(1-2*(o+.5)/Math.pow(2,l)),_=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Uh;return new Vh(_,d)}static get units(){return ad}constructor(o,l){if(o===void 0)throw new Error("No latitude given.");if(l&&!ad[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(ad).join(", ")}`);const d=6378.137*Uh*(l?ad[l]:1),p=Math.cos(o*Uh),_=1/(1-Go*(1-p*p)),y=Math.sqrt(_);this.kx=d*y*p,this.ky=d*y*_*(1-Go)}distance(o,l){const d=Do(o[0]-l[0])*this.kx,p=(o[1]-l[1])*this.ky;return Math.sqrt(d*d+p*p)}bearing(o,l){const d=Do(l[0]-o[0])*this.kx;return Math.atan2(d,(l[1]-o[1])*this.ky)/Uh}destination(o,l,d){const p=d*Uh;return this.offset(o,Math.sin(p)*l,Math.cos(p)*l)}offset(o,l,d){return[o[0]+l/this.kx,o[1]+d/this.ky]}lineDistance(o){let l=0;for(let d=0;d<o.length-1;d++)l+=this.distance(o[d],o[d+1]);return l}area(o){let l=0;for(let d=0;d<o.length;d++){const p=o[d];for(let _=0,y=p.length,A=y-1;_<y;A=_++)l+=Do(p[_][0]-p[A][0])*(p[_][1]+p[A][1])*(d?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(o,l){let d=0;if(l<=0)return o[0];for(let p=0;p<o.length-1;p++){const _=o[p],y=o[p+1],A=this.distance(_,y);if(d+=A,d>l)return Zf(_,y,(l-(d-A))/A)}return o[o.length-1]}pointToSegmentDistance(o,l,d){let[p,_]=l,y=Do(d[0]-p)*this.kx,A=(d[1]-_)*this.ky;if(y!==0||A!==0){const S=(Do(o[0]-p)*this.kx*y+(o[1]-_)*this.ky*A)/(y*y+A*A);S>1?(p=d[0],_=d[1]):S>0&&(p+=y/this.kx*S,_+=A/this.ky*S)}return y=Do(o[0]-p)*this.kx,A=(o[1]-_)*this.ky,Math.sqrt(y*y+A*A)}pointOnLine(o,l){let d=1/0,p=o[0][0],_=o[0][1],y=0,A=0;for(let S=0;S<o.length-1;S++){let I=o[S][0],R=o[S][1],P=Do(o[S+1][0]-I)*this.kx,B=(o[S+1][1]-R)*this.ky,N=0;P===0&&B===0||(N=(Do(l[0]-I)*this.kx*P+(l[1]-R)*this.ky*B)/(P*P+B*B),N>1?(I=o[S+1][0],R=o[S+1][1]):N>0&&(I+=P/this.kx*N,R+=B/this.ky*N)),P=Do(l[0]-I)*this.kx,B=(l[1]-R)*this.ky;const U=P*P+B*B;U<d&&(d=U,p=I,_=R,y=S,A=N)}return{point:[p,_],index:y,t:Math.max(0,Math.min(1,A))}}lineSlice(o,l,d){let p=this.pointOnLine(d,o),_=this.pointOnLine(d,l);if(p.index>_.index||p.index===_.index&&p.t>_.t){const I=p;p=_,_=I}const y=[p.point],A=p.index+1,S=_.index;!mg(d[A],y[0])&&A<=S&&y.push(d[A]);for(let I=A+1;I<=S;I++)y.push(d[I]);return mg(d[S],_.point)||y.push(_.point),y}lineSliceAlong(o,l,d){let p=0;const _=[];for(let y=0;y<d.length-1;y++){const A=d[y],S=d[y+1],I=this.distance(A,S);if(p+=I,p>o&&_.length===0&&_.push(Zf(A,S,(o-(p-I))/I)),p>=l)return _.push(Zf(A,S,(l-(p-I))/I)),_;p>o&&_.push(S)}return _}bufferPoint(o,l){const d=l/this.ky,p=l/this.kx;return[o[0]-p,o[1]-d,o[0]+p,o[1]+d]}bufferBBox(o,l){const d=l/this.ky,p=l/this.kx;return[o[0]-p,o[1]-d,o[2]+p,o[3]+d]}insideBBox(o,l){return Do(o[0]-l[0])>=0&&Do(o[0]-l[2])<=0&&o[1]>=l[1]&&o[1]<=l[3]}}function mg(h,o){return h[0]===o[0]&&h[1]===o[1]}function Zf(h,o,l){const d=Do(o[0]-h[0]);return[h[0]+d*l,h[1]+(o[1]-h[1])*l]}function Do(h){for(;h<-180;)h+=360;for(;h>180;)h-=360;return h}class Kf{constructor(o=[],l=(d,p)=>d<p?-1:d>p?1:0){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:d}=this,p=l[o];for(;o>0;){const _=o-1>>1,y=l[_];if(d(p,y)>=0)break;l[o]=y,o=_}l[o]=p}_down(o){const{data:l,compare:d}=this,p=this.length>>1,_=l[o];for(;o<p;){let y=1+(o<<1);const A=y+1;if(A<this.length&&d(l[A],l[y])<0&&(y=A),d(l[y],_)>=0)break;l[o]=l[y],o=y}l[o]=_}}var Dt=8192;function gg(h,o){return o.dist-h.dist}const Jf=100,Qf=50;function _g(h){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==h.length)return!1;for(let l=0;l<o.length;l++)if(o[l]!==h[l])return!1;return!0}function Yc(h){return h[1]-h[0]+1}function Xo(h,o){const l=h[1]>=h[0]&&h[1]<o;return l||console.warn("Distance Expression: Index is out of range"),l}function $h(h,o){if(h[0]>h[1])return[null,null];const l=Yc(h);if(o){if(l===2)return[h,null];const d=Math.floor(l/2);return[[h[0],h[0]+d],[h[0]+d,h[1]]]}{if(l===1)return[h,null];const d=Math.floor(l/2)-1;return[[h[0],h[0]+d],[h[0]+d+1,h[1]]]}}function sc(h,o){const l=[1/0,1/0,-1/0,-1/0];if(!Xo(o,h.length))return l;for(let d=o[0];d<=o[1];++d)sd(l,h[d]);return l}function ld(h){const o=[1/0,1/0,-1/0,-1/0];for(let l=0;l<h.length;++l)for(let d=0;d<h[l].length;++d)sd(o,h[l][d]);return o}function Zc(h,o,l){if(_g(h)||_g(o))return NaN;let d=0,p=0;return h[2]<o[0]&&(d=o[0]-h[2]),h[0]>o[2]&&(d=h[0]-o[2]),h[1]>o[3]&&(p=h[1]-o[3]),h[3]<o[1]&&(p=o[1]-h[3]),l.distance([0,0],[d,p])}function jh(h){return 360*h-180}function Wi(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function yg(h,o){const l=Math.pow(2,o.z),d=(h.y/Dt+o.y)/l;return[jh((h.x/Dt+o.x)/l),Wi(d)]}function Nw(h,o){const l=[];for(let d=0;d<h.length;++d)l.push(yg(h[d],o));return l}function q0(h,o,l){const d=l.pointOnLine(o,h).point;return l.distance(h,d)}function bg(h,o,l,d,p){const _=l.slice(d[0],d[1]+1);let y=1/0;for(let A=o[0];A<=o[1];++A)if((y=Math.min(y,q0(h[A],_,p)))===0)return 0;return y}function vg(h,o,l,d,p){const _=Math.min(p.pointToSegmentDistance(h,l,d),p.pointToSegmentDistance(o,l,d)),y=Math.min(p.pointToSegmentDistance(l,h,o),p.pointToSegmentDistance(d,h,o));return Math.min(_,y)}function Kn(h,o,l,d,p){if(!Xo(o,h.length)||!Xo(d,l.length))return NaN;let _=1/0;for(let y=o[0];y<o[1];++y)for(let A=d[0];A<d[1];++A){if(Ya(h[y],h[y+1],l[A],l[A+1]))return 0;_=Math.min(_,vg(h[y],h[y+1],l[A],l[A+1],p))}return _}function Uw(h,o,l,d,p){if(!Xo(o,h.length)||!Xo(d,l.length))return NaN;let _=1/0;for(let y=o[0];y<=o[1];++y)for(let A=d[0];A<=d[1];++A)if((_=Math.min(_,p.distance(h[y],l[A])))===0)return _;return _}function Vw(h,o,l){if(vl(h,o,!0))return 0;let d=1/0;for(const p of o){const _=p.length;if(_<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[_-1]&&(d=Math.min(d,l.pointToSegmentDistance(h,p[_-1],p[0])))===0||(d=Math.min(d,q0(h,p,l)))===0)return d}return d}function $w(h,o,l,d){if(!Xo(o,h.length))return NaN;for(let _=o[0];_<=o[1];++_)if(vl(h[_],l,!0))return 0;let p=1/0;for(let _=o[0];_<o[1];++_)for(const y of l)for(let A=0,S=y.length,I=S-1;A<S;I=A++){if(Ya(h[_],h[_+1],y[I],y[A]))return 0;p=Math.min(p,vg(h[_],h[_+1],y[I],y[A],d))}return p}function Y0(h,o){for(const l of h)for(let d=0;d<=l.length-1;++d)if(vl(l[d],o,!0))return!0;return!1}function jw(h,o,l,d=1/0){const p=ld(h),_=ld(o);if(d!==1/0&&Zc(p,_,l)>=d)return d;if(od(p,_)){if(Y0(h,o))return 0}else if(Y0(o,h))return 0;let y=d;for(const A of h)for(let S=0,I=A.length,R=I-1;S<I;R=S++)for(const P of o)for(let B=0,N=P.length,U=N-1;B<N;U=B++){if(Ya(A[R],A[S],P[U],P[B]))return 0;y=Math.min(y,vg(A[R],A[S],P[U],P[B],l))}return y}function ep(h,o,l,d,p,_,y){if(_===null||y===null)return;const A=Zc(sc(d,_),sc(p,y),l);A<o&&h.push({dist:A,range1:_,range2:y})}function Hw(h,o,l,d,p=1/0){let _=Math.min(d.distance(h[0],l[0][0]),p);if(_===0)return _;const y=new Kf([{dist:0,range1:[0,h.length-1],range2:[0,0]}],gg),A=o?Qf:Jf,S=ld(l);for(;y.length;){const I=y.pop();if(I.dist>=_)continue;const R=I.range1;if(Yc(R)<=A){if(!Xo(R,h.length))return NaN;if(o){const P=$w(h,R,l,d);if((_=Math.min(_,P))===0)return _}else for(let P=R[0];P<=R[1];++P){const B=Vw(h[P],l,d);if((_=Math.min(_,B))===0)return _}}else{const P=$h(R,o);if(P[0]!==null){const B=Zc(sc(h,P[0]),S,d);B<_&&y.push({dist:B,range1:P[0],range2:[0,0]})}if(P[1]!==null){const B=Zc(sc(h,P[1]),S,d);B<_&&y.push({dist:B,range1:P[1],range2:[0,0]})}}}return _}function Z0(h,o,l,d,p,_=1/0){let y=Math.min(_,p.distance(h[0],l[0]));if(y===0)return y;const A=new Kf([{dist:0,range1:[0,h.length-1],range2:[0,l.length-1]}],gg),S=o?Qf:Jf,I=d?Qf:Jf;for(;A.length;){const R=A.pop();if(R.dist>=y)continue;const P=R.range1,B=R.range2;if(Yc(P)<=S&&Yc(B)<=I){if(!Xo(P,h.length)||!Xo(B,l.length))return NaN;if(o&&d?y=Math.min(y,Kn(h,P,l,B,p)):o||d?o&&!d?y=Math.min(y,bg(l,B,h,P,p)):!o&&d&&(y=Math.min(y,bg(h,P,l,B,p))):y=Math.min(y,Uw(h,P,l,B,p)),y===0)return y}else{const N=$h(P,o),U=$h(B,d);ep(A,y,p,h,l,N[0],U[0]),ep(A,y,p,h,l,N[0],U[1]),ep(A,y,p,h,l,N[1],U[0]),ep(A,y,p,h,l,N[1],U[1])}}return y}function xg(h,o,l,d,p=1/0){let _=p;const y=sc(h,[0,h.length-1]);for(const A of l)if(!(_!==1/0&&Zc(y,sc(A,[0,A.length-1]),d)>=_)&&(_=Math.min(_,Z0(h,o,A,!0,d,_)),_===0))return _;return _}function tp(h,o,l,d,p=1/0){let _=p;const y=sc(h,[0,h.length-1]);for(const A of l){if(_!==1/0&&Zc(y,ld(A),d)>=_)continue;const S=Hw(h,o,A,d,_);if(isNaN(S))return S;if((_=Math.min(_,S))===0)return _}return _}function wg(h){return h==="Point"||h==="MultiPoint"||h==="LineString"||h==="MultiLineString"||h==="Polygon"||h==="MultiPolygon"}class Kc{constructor(o,l){this.type=ti,this.geojson=o,this.geometries=l}static parse(o,l){if(o.length!==2)return l.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(Lh(o[1])){const d=o[1];if(d.type==="FeatureCollection"){for(let p=0;p<d.features.length;++p)if(wg(d.features[p].geometry.type))return new Kc(d,d.features[p].geometry)}else if(d.type==="Feature"){if(wg(d.geometry.type))return new Kc(d,d.geometry)}else if(wg(d.type))return new Kc(d,d)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const l=o.geometry(),d=o.canonicalID();if(l!=null&&d!=null){if(o.geometryType()==="Point")return function(p,_,y){const A=[];for(const I of p)for(const R of I)A.push(yg(R,_));const S=new Vh(A[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?Z0(A,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",S):y.type==="MultiLineString"?xg(A,!1,y.coordinates,S):y.type==="Polygon"||y.type==="MultiPolygon"?tp(A,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,S):null}(l,d,this.geometries);if(o.geometryType()==="LineString")return function(p,_,y){const A=[];for(const I of p){const R=[];for(const P of I)R.push(yg(P,_));A.push(R)}const S=new Vh(A[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return xg(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",A,S);if(y.type==="MultiLineString"){let I=1/0;for(let R=0;R<y.coordinates.length;R++){const P=xg(y.coordinates[R],!0,A,S,I);if(isNaN(P))return P;if((I=Math.min(I,P))===0)return I}return I}if(y.type==="Polygon"||y.type==="MultiPolygon"){let I=1/0;for(let R=0;R<A.length;R++){const P=tp(A[R],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,S,I);if(isNaN(P))return P;if((I=Math.min(I,P))===0)return I}return I}return null}(l,d,this.geometries);if(o.geometryType()==="Polygon")return function(p,_,y){const A=[];for(const I of function(R,P){const B=R.length;if(B<=1)return[R];const N=[];let U,j;for(let K=0;K<B;K++){const ee=Hs(R[K]);ee!==0&&(R[K].area=Math.abs(ee),j===void 0&&(j=ee<0),j===ee<0?(U&&N.push(U),U=[R[K]]):U.push(R[K]))}return U&&N.push(U),N}(p)){const R=[];for(let P=0;P<I.length;++P)R.push(Nw(I[P],_));A.push(R)}const S=new Vh(A[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return tp(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",A,S);if(y.type==="MultiLineString"){let I=1/0;for(let R=0;R<y.coordinates.length;R++){const P=tp(y.coordinates[R],!0,A,S,I);if(isNaN(P))return P;if((I=Math.min(I,P))===0)return I}return I}return y.type==="Polygon"||y.type==="MultiPolygon"?function(I,R,P){let B=1/0;for(const N of I)for(const U of R){const j=jw(N,U,P,B);if(isNaN(j))return j;if((B=Math.min(B,j))===0)return B}return B}(y.type==="Polygon"?[y.coordinates]:y.coordinates,A,S):null}(l,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ag(h,o){switch(h){case"string":return $s(o);case"number":return+o;case"boolean":return!!o;case"color":return rn.parse(o);case"formatted":return Vs.fromString($s(o));case"resolvedImage":return to.build($s(o))}return o}function K0(h,o,l,d){return d!==void 0&&(h=d*Math.round(h/d)),o!==void 0&&h<o&&(h=o),l!==void 0&&h>l&&(h=l),h}class Hh{constructor(o,l,d){this.type=o,this.key=l,this.scope=d}static parse(o,l){let d=l.expectedType;if(d==null&&(d=an),o.length<2||o.length>3)return l.error("Invalid number of arguments for 'config' expression.");const p=l.parse(o[1],1);if(!(p instanceof Ri))return l.error("Key name of 'config' expression must be a string literal.");if(o.length>=3){const _=l.parse(o[2],2);return _ instanceof Ri?new Hh(d,$s(p.value),$s(_.value)):l.error("Scope of 'config' expression must be a string literal.")}return new Hh(d,$s(p.value))}evaluate(o){const l=[this.key,this.scope,o.scope].filter(Boolean).join(""),d=o.getConfig(l);if(!d)return null;const{type:p,value:_,values:y,minValue:A,maxValue:S,stepValue:I}=d,R=d.default.evaluate(o);let P=R;if(_){const B=o.scope;o.scope=(B||"").split("").slice(1).join(""),P=_.evaluate(o),o.scope=B}return p&&(P=Ag(p,P)),P===void 0||A===void 0&&S===void 0&&I===void 0||(typeof P=="number"?P=K0(P,A,S,I):Array.isArray(P)&&(P=P.map(B=>typeof B=="number"?K0(B,A,S,I):B))),_!==void 0&&P!==void 0&&y&&!y.includes(P)&&(P=R,p&&(P=Ag(p,P))),(p&&p!==this.type||P!==void 0&&Ur(P)!==this.type)&&(P=Ag(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.key),o}}function cd(h){if(h instanceof Ps&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof xl||h instanceof Kc)return!1;let o=!0;return h.eachChild(l=>{o&&!cd(l)&&(o=!1)}),o}function ip(h){if(h instanceof Ps&&h.name==="feature-state")return!1;let o=!0;return h.eachChild(l=>{o&&!ip(l)&&(o=!1)}),o}function np(h){if(h instanceof Hh)return new Set([h.key]);let o=new Set;return h.eachChild(l=>{o=new Set([...o,...np(l)])}),o}function Wh(h,o){if(h instanceof Ps&&o.indexOf(h.name)>=0)return!1;let l=!0;return h.eachChild(d=>{l&&!Wh(d,o)&&(l=!1)}),l}class rp{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(o.length!==2||typeof o[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const d=o[1];return l.scope.has(d)?new rp(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Tg{constructor(o,l=[],d,p=new Hc,_=[],y,A){this.registry=o,this.path=l,this.key=l.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=p,this.errors=_,this.expectedType=d,this._scope=y,this.options=A}parse(o,l,d,p,_={}){return l||d?this.concat(l,null,d,p)._parse(o,_):this._parse(o,_)}parseObjectValue(o,l,d,p,_,y={}){return this.concat(l,d,p,_)._parse(o,y)}_parse(o,l){function d(p,_,y){return y==="assert"?new di(_,[p]):y==="coerce"?new ga(_,[p]):p}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof o[0]=="string"?this.registry[o[0]]:void 0;if(p){let _=p.parse(o,this);if(!_)return null;if(this.expectedType){const y=this.expectedType,A=_.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||A.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(y,A))return null}else _=d(_,y,l.typeAnnotation||"coerce");else _=d(_,y,l.typeAnnotation||"assert")}if(!(_ instanceof Ri)&&_.type.kind!=="resolvedImage"&&Sg(_)){const y=new qf(this._scope,this.options);try{_=new Ri(_.type,_.evaluate(y))}catch(A){return this.error(A.message),null}}return _}return ga.parse(["to-array",o],this)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,d,p){let _=typeof o=="number"?this.path.concat(o):this.path;_=typeof l=="string"?_.concat(l):_;const y=p?this.scope.concat(p):this.scope;return new Tg(this.registry,_,d||null,y,this.errors,this._scope,this.options)}error(o,...l){const d=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new Wo(d,o))}checkSubtype(o,l){const d=nd(o,l);return d&&this.error(d),d}}var J0=Tg;function Sg(h){if(h instanceof rp)return Sg(h.boundExpression);if(h instanceof Ps&&h.name==="error"||h instanceof Nh||h instanceof xl||h instanceof Kc||h instanceof Hh)return!1;const o=h instanceof ga||h instanceof di;let l=!0;return h.eachChild(d=>{l=o?l&&Sg(d):l&&d instanceof Ri}),!!l&&cd(h)&&Wh(h,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function sp(h,o){const l=h.length-1;let d,p,_=0,y=l,A=0;for(;_<=y;)if(A=Math.floor((_+y)/2),d=h[A],p=h[A+1],d<=o){if(A===l||o<p)return A;_=A+1}else{if(!(d>o))throw new Wt("Input is not a number.");y=A-1}return 0}class hd{constructor(o,l,d){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[p,_]of d)this.labels.push(p),this.outputs.push(_)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(o[1],1,ti);if(!d)return null;const p=[];let _=null;l.expectedType&&l.expectedType.kind!=="value"&&(_=l.expectedType);for(let y=1;y<o.length;y+=2){const A=y===1?-1/0:o[y],S=o[y+1],I=y,R=y+1;if(typeof A!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=A)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const P=l.parse(S,R,_);if(!P)return null;_=_||P.type,p.push([A,P])}return new hd(_,d,p)}evaluate(o){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(o);const p=this.input.evaluate(o);if(p<=l[0])return d[0].evaluate(o);const _=l.length;return p>=l[_-1]?d[_-1].evaluate(o):d[sp(l,p)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}const Q0=.95047,eb=1.08883,tb=4/29,Gh=6/29,ib=3*Gh*Gh,Ww=Gh*Gh*Gh,Eg=Math.PI/180,Gw=180/Math.PI;function op(h){return h>Ww?Math.pow(h,1/3):h/ib+tb}function Cg(h){return h>Gh?h*h*h:ib*(h-tb)}function Ig(h){return 255*(h<=.0031308?12.92*h:1.055*Math.pow(h,1/2.4)-.055)}function Mg(h){return(h/=255)<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function Rg(h){const o=Mg(h.r),l=Mg(h.g),d=Mg(h.b),p=op((.4124564*o+.3575761*l+.1804375*d)/Q0),_=op((.2126729*o+.7151522*l+.072175*d)/1);return{l:116*_-16,a:500*(p-_),b:200*(_-op((.0193339*o+.119192*l+.9503041*d)/eb)),alpha:h.a}}function kg(h){let o=(h.l+16)/116,l=isNaN(h.a)?o:o+h.a/500,d=isNaN(h.b)?o:o-h.b/200;return o=1*Cg(o),l=Q0*Cg(l),d=eb*Cg(d),new rn(Ig(3.2404542*l-1.5371385*o-.4985314*d),Ig(-.969266*l+1.8760108*o+.041556*d),Ig(.0556434*l-.2040259*o+1.0572252*d),h.alpha)}function Xh(h,o,l){const d=o-h;return h+l*(d>180||d<-180?d-360*Math.round(d/360):d)}const qh={forward:Rg,reverse:kg,interpolate:function(h,o,l){return{l:ri(h.l,o.l,l),a:ri(h.a,o.a,l),b:ri(h.b,o.b,l),alpha:ri(h.alpha,o.alpha,l)}}},Yh={forward:function(h){const{l:o,a:l,b:d}=Rg(h),p=Math.atan2(d,l)*Gw;return{h:p<0?p+360:p,c:Math.sqrt(l*l+d*d),l:o,alpha:h.a}},reverse:function(h){const o=h.h*Eg,l=h.c;return kg({l:h.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:h.alpha})},interpolate:function(h,o,l){return{h:Xh(h.h,o.h,l),c:ri(h.c,o.c,l),l:ri(h.l,o.l,l),alpha:ri(h.alpha,o.alpha,l)}}};var nb=Object.freeze({__proto__:null,hcl:Yh,lab:qh});class io{constructor(o,l,d,p,_){this.type=o,this.operator=l,this.interpolation=d,this.input=p,this.labels=[],this.outputs=[];for(const[y,A]of _)this.labels.push(y),this.outputs.push(A)}static interpolationFactor(o,l,d,p){let _=0;if(o.name==="exponential")_=ud(l,o.base,d,p);else if(o.name==="linear")_=ud(l,1,d,p);else if(o.name==="cubic-bezier"){const y=o.controlPoints;_=new Mh(y[0],y[1],y[2],y[3]).solve(ud(l,1,d,p))}return _}static parse(o,l){let[d,p,_,...y]=o;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const I=p[1];if(typeof I!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const I=p.slice(1);if(I.length!==4||I.some(R=>typeof R!="number"||R<0||R>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length-1>3&&(o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,ti),!_)return null;const A=[];let S=null;d==="interpolate-hcl"||d==="interpolate-lab"?S=eo:l.expectedType&&l.expectedType.kind!=="value"&&(S=l.expectedType);for(let I=0;I<y.length;I+=2){const R=y[I],P=y[I+1],B=I+3,N=I+4;if(typeof R!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(A.length&&A[A.length-1][0]>=R)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const U=l.parse(P,N,S);if(!U)return null;S=S||U.type,A.push([R,U])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new io(S,d,p,_,A):l.error(`Type ${Dr(S)} is not interpolatable.`)}evaluate(o){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(o);const p=this.input.evaluate(o);if(p<=l[0])return d[0].evaluate(o);const _=l.length;if(p>=l[_-1])return d[_-1].evaluate(o);const y=sp(l,p),A=io.interpolationFactor(this.interpolation,p,l[y],l[y+1]),S=d[y].evaluate(o),I=d[y+1].evaluate(o);return this.operator==="interpolate"?Gf[this.type.kind.toLowerCase()](S,I,A):this.operator==="interpolate-hcl"?Yh.reverse(Yh.interpolate(Yh.forward(S),Yh.forward(I),A)):qh.reverse(qh.interpolate(qh.forward(S),qh.forward(I),A))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const l=[this.operator,o,this.input.serialize()];for(let d=0;d<this.labels.length;d++)l.push(this.labels[d],this.outputs[d].serialize());return l}}function ud(h,o,l,d){const p=d-l,_=h-l;return p===0?0:o===1?_/p:(Math.pow(o,_)-1)/(Math.pow(o,p)-1)}class ap{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let d=null;const p=l.expectedType;p&&p.kind!=="value"&&(d=p);const _=[];for(const A of o.slice(1)){const S=l.parse(A,1+_.length,d,void 0,{typeAnnotation:"omit"});if(!S)return null;d=d||S.type,_.push(S)}const y=p&&_.some(A=>nd(p,A.type));return new ap(y?an:d,_)}evaluate(o){let l,d=null,p=0;for(const _ of this.args){if(p++,d=_.evaluate(o),d&&d instanceof to&&!d.available&&(l||(l=d),d=null,p===this.args.length))return l;if(d!==null)break}return d}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class lp{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const d=[];for(let _=1;_<o.length-1;_+=2){const y=o[_];if(typeof y!="string")return l.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);const A=l.parse(o[_+1],_+1);if(!A)return null;d.push([y,A])}const p=l.parse(o[o.length-1],o.length-1,l.expectedType,d);return p?new lp(d,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,d]of this.bindings)o.push(l,d.serialize());return o.push(this.result.serialize()),o}}class cp{constructor(o,l,d){this.type=o,this.index=l,this.input=d}static parse(o,l){if(o.length!==3)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,ti),p=l.parse(o[2],2,Us(l.expectedType||an));return d&&p?new cp(p.type.itemType,d,p):null}evaluate(o){const l=this.index.evaluate(o),d=this.input.evaluate(o);if(l<0)throw new Wt(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new Wt(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new Wt(`Array index must be an integer, but found ${l} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return d[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class hp{constructor(o,l,d){this.type=o,this.index=l,this.input=d}static parse(o,l){if(o.length!==3)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,ti),p=l.parse(o[2],2,Us(l.expectedType||an));return d&&p?new hp(p.type.itemType,d,p):null}evaluate(o){const l=this.index.evaluate(o),d=this.input.evaluate(o);if(l<0)throw new Wt(`Array index out of bounds: ${l} < 0.`);if(l>d.length-1)throw new Wt(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l===Math.floor(l))return d[l];const p=Math.floor(l),_=Math.ceil(l),y=d[p],A=d[_];if(typeof y!="number"||typeof A!="number")throw new Wt(`Cannot interpolate between non-number values at index ${l}.`);const S=l-p;return y*(1-S)+A*S}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Pg{constructor(o,l){this.type=hn,this.needle=o,this.haystack=l}static parse(o,l){if(o.length!==3)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,an),p=l.parse(o[2],2,an);return d&&p?ug(d.type,[hn,bn,ti,Ql,an])?new Pg(d,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(d.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(d==null)return!1;if(!Fh(l,["boolean","string","number","null"]))throw new Wt(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(Ur(l))} instead.`);if(!Fh(d,["string","array"]))throw new Wt(`Expected second argument to be of type array or string, but found ${Dr(Ur(d))} instead.`);return d.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class up{constructor(o,l,d){this.type=ti,this.needle=o,this.haystack=l,this.fromIndex=d}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,an),p=l.parse(o[2],2,an);if(!d||!p)return null;if(!ug(d.type,[hn,bn,ti,Ql,an]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(d.type)} instead`);if(o.length===4){const _=l.parse(o[3],3,ti);return _?new up(d,p,_):null}return new up(d,p)}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!Fh(l,["boolean","string","number","null"]))throw new Wt(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(Ur(l))} instead.`);if(!Fh(d,["string","array"]))throw new Wt(`Expected second argument to be of type array or string, but found ${Dr(Ur(d))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(o);return d.indexOf(l,p)}return d.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Dg{constructor(o,l,d,p,_,y){this.inputType=o,this.type=l,this.input=d,this.cases=p,this.outputs=_,this.otherwise=y}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let d,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const _={},y=[];for(let I=2;I<o.length-1;I+=2){let R=o[I];const P=o[I+1];Array.isArray(R)||(R=[R]);const B=l.concat(I);if(R.length===0)return B.error("Expected at least one branch label.");for(const U of R){if(typeof U!="number"&&typeof U!="string")return B.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return B.error("Numeric branch labels must be integer values.");if(d){if(B.checkSubtype(d,Ur(U)))return null}else d=Ur(U);if(_[String(U)]!==void 0)return B.error("Branch labels must be unique.");_[String(U)]=y.length}const N=l.parse(P,I,p);if(!N)return null;p=p||N.type,y.push(N)}const A=l.parse(o[1],1,an);if(!A)return null;const S=l.parse(o[o.length-1],o.length-1,p);return S?A.type.kind!=="value"&&l.concat(1).checkSubtype(d,A.type)?null:new Dg(d,p,A,_,y,S):null}evaluate(o){const l=this.input.evaluate(o);return(Ur(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),d=[],p={};for(const y of l){const A=p[this.cases[y]];A===void 0?(p[this.cases[y]]=d.length,d.push([this.cases[y],[y]])):d[A][1].push(y)}const _=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,A]of d)o.push(A.length===1?_(A[0]):A.map(_)),o.push(this.outputs[y].serialize());return o.push(this.otherwise.serialize()),o}}class dp{constructor(o,l,d){this.type=o,this.branches=l,this.otherwise=d}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);const p=[];for(let y=1;y<o.length-1;y+=2){const A=l.parse(o[y],y,hn);if(!A)return null;const S=l.parse(o[y+1],y+1,d);if(!S)return null;p.push([A,S]),d=d||S.type}const _=l.parse(o[o.length-1],o.length-1,d);return _?new dp(d,p,_):null}evaluate(o){for(const[l,d]of this.branches)if(l.evaluate(o))return d.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,d]of this.branches)o(l),o(d);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class dd{constructor(o,l,d,p){this.type=o,this.input=l,this.beginIndex=d,this.endIndex=p}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,an),p=l.parse(o[2],2,ti);if(!d||!p)return null;if(!ug(d.type,[Us(an),bn,an]))return l.error(`Expected first argument to be of type array or string, but found ${Dr(d.type)} instead`);if(o.length===4){const _=l.parse(o[3],3,ti);return _?new dd(d.type,d,p,_):null}return new dd(d.type,d,p)}evaluate(o){const l=this.input.evaluate(o),d=this.beginIndex.evaluate(o);if(!Fh(l,["string","array"]))throw new Wt(`Expected first argument to be of type array or string, but found ${Dr(Ur(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(o);return l.slice(d,p)}return l.slice(d)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function fd(h,o){return h==="=="||h==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function rb(h,o,l,d){return d.compare(o,l)===0}function Jc(h,o,l){const d=h!=="=="&&h!=="!=";return class sF{constructor(_,y,A){this.type=hn,this.lhs=_,this.rhs=y,this.collator=A,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");const A=_[0];let S=y.parse(_[1],1,an);if(!S)return null;if(!fd(A,S.type))return y.concat(1).error(`"${A}" comparisons are not supported for type '${Dr(S.type)}'.`);let I=y.parse(_[2],2,an);if(!I)return null;if(!fd(A,I.type))return y.concat(2).error(`"${A}" comparisons are not supported for type '${Dr(I.type)}'.`);if(S.type.kind!==I.type.kind&&S.type.kind!=="value"&&I.type.kind!=="value")return y.error(`Cannot compare types '${Dr(S.type)}' and '${Dr(I.type)}'.`);d&&(S.type.kind==="value"&&I.type.kind!=="value"?S=new di(I.type,[S]):S.type.kind!=="value"&&I.type.kind==="value"&&(I=new di(S.type,[I])));let R=null;if(_.length===4){if(S.type.kind!=="string"&&I.type.kind!=="string"&&S.type.kind!=="value"&&I.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(R=y.parse(_[3],3,Wc),!R)return null}return new sF(S,I,R)}evaluate(_){const y=this.lhs.evaluate(_),A=this.rhs.evaluate(_);if(d&&this.hasUntypedArgument){const S=Ur(y),I=Ur(A);if(S.kind!==I.kind||S.kind!=="string"&&S.kind!=="number")throw new Wt(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${S.kind}, ${I.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const S=Ur(y),I=Ur(A);if(S.kind!=="string"||I.kind!=="string")return o(_,y,A)}return this.collator?l(_,y,A,this.collator.evaluate(_)):o(_,y,A)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[h];return this.eachChild(y=>{_.push(y.serialize())}),_}}}const Xw=Jc("==",function(h,o,l){return o===l},rb),qw=Jc("!=",function(h,o,l){return o!==l},function(h,o,l,d){return!rb(0,o,l,d)}),sb=Jc("<",function(h,o,l){return o<l},function(h,o,l,d){return d.compare(o,l)<0}),ob=Jc(">",function(h,o,l){return o>l},function(h,o,l,d){return d.compare(o,l)>0}),Yw=Jc("<=",function(h,o,l){return o<=l},function(h,o,l,d){return d.compare(o,l)<=0}),Zw=Jc(">=",function(h,o,l){return o>=l},function(h,o,l,d){return d.compare(o,l)>=0});class Bg{constructor(o,l,d,p,_,y){this.type=bn,this.number=o,this.locale=l,this.currency=d,this.unit=p,this.minFractionDigits=_,this.maxFractionDigits=y}static parse(o,l){if(o.length!==3)return l.error("Expected two arguments.");const d=l.parse(o[1],1,ti);if(!d)return null;const p=o[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=l.parseObjectValue(p.locale,2,"locale",bn),!_))return null;let y=null;if(p.currency&&(y=l.parseObjectValue(p.currency,2,"currency",bn),!y))return null;let A=null;if(p.unit&&(A=l.parseObjectValue(p.unit,2,"unit",bn),!A))return null;let S=null;if(p["min-fraction-digits"]&&(S=l.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",ti),!S))return null;let I=null;return p["max-fraction-digits"]&&(I=l.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",ti),!I)?null:new Bg(d,_,y,A,S,I)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class pd{constructor(o){this.type=ti,this.input=o}static parse(o,l){if(o.length!==2)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const d=l.parse(o[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Dr(d.type)} instead.`):new pd(d):null}evaluate(o){const l=this.input.evaluate(o);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Wt(`Expected value to be of type string or array, but found ${Dr(Ur(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}function ab(h){return function(){h=1831565813+(h|=0)|0;let o=Math.imul(h^h>>>15,1|h);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const Qc={"==":Xw,"!=":qw,">":ob,"<":sb,">=":Zw,"<=":Yw,array:di,at:cp,"at-interpolated":hp,boolean:di,case:dp,coalesce:ap,collator:Nh,format:Gc,image:zh,in:Pg,"index-of":up,interpolate:io,"interpolate-hcl":io,"interpolate-lab":io,length:pd,let:lp,literal:Ri,match:Dg,number:di,"number-format":Bg,object:di,slice:dd,step:hd,string:di,"to-boolean":ga,"to-color":ga,"to-number":ga,"to-string":ga,var:rp,within:xl,distance:Kc,config:Hh};function lb(h,[o,l,d,p]){o=o.evaluate(h),l=l.evaluate(h),d=d.evaluate(h);const _=p?p.evaluate(h):1,y=U0(o,l,d,_);if(y)throw new Wt(y);return new rn(o/255*_,l/255*_,d/255*_,_)}function cb(h,[o,l,d,p]){o=o.evaluate(h),l=l.evaluate(h),d=d.evaluate(h);const _=p?p.evaluate(h):1,y=function(I,R,P,B){return typeof I=="number"&&I>=0&&I<=360?typeof R=="number"&&R>=0&&R<=100&&typeof P=="number"&&P>=0&&P<=100?B===void 0||typeof B=="number"&&B>=0&&B<=1?null:`Invalid hsla value [${[I,R,P,B].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof B=="number"?[I,R,P,B]:[I,R,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof B=="number"?[I,R,P,B]:[I,R,P]).join(", ")}]: 'h' must be between 0 and 360.`}(o,l,d,_);if(y)throw new Wt(y);const A=`hsla(${o}, ${l}%, ${d}%, ${_})`,S=rn.parse(A);if(!S)throw new Wt(`Failed to parse HSLA color: ${A}`);return S}function Og(h,o){return h in o}function fp(h,o){const l=o[h];return l===void 0?null:l}function oc(h){return{type:h}}function hb(h){return{result:"success",value:h}}function Bo(h){return{result:"error",value:h}}function Fg(h,o){return!!h&&!!h.parameters&&h.parameters.indexOf(o)>-1}function pp(h){return h["property-type"]==="data-driven"}function ub(h){return Fg(h.expression,"measure-light")}function Lg(h){return Fg(h.expression,"zoom")}function mp(h){return!!h.expression&&h.expression.interpolated}function gp(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function db(h){return h}function _p(h,o){const l=o.type==="color",d=h.stops&&typeof h.stops[0][0]=="object",p=d||!(d||h.property!==void 0),_=h.type||(mp(o)?"exponential":"interval");if(l&&((h=ed({},h)).stops&&(h.stops=h.stops.map(I=>[I[0],rn.parse(I[1])])),h.default=rn.parse(h.default?h.default:o.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!nb[h.colorSpace])throw new Error(`Unknown color space: ${h.colorSpace}`);let y,A,S;if(_==="exponential")y=wl;else if(_==="interval")y=Kw;else if(_==="categorical"){y=fb,A=Object.create(null);for(const I of h.stops)A[I[0]]=I[1];S=typeof h.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);y=Jw}if(d){const I={},R=[];for(let N=0;N<h.stops.length;N++){const U=h.stops[N],j=U[0].zoom;I[j]===void 0&&(I[j]={zoom:j,type:h.type,property:h.property,default:h.default,stops:[]},R.push(j)),I[j].stops.push([U[0].value,U[1]])}const P=[];for(const N of R)P.push([I[N].zoom,_p(I[N],o)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:io.interpolationFactor.bind(void 0,B),zoomStops:P.map(N=>N[0]),evaluate:({zoom:N},U)=>wl({stops:P,base:h.base},o,N).evaluate(N,U)}}if(p){const I=_==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:io.interpolationFactor.bind(void 0,I),zoomStops:h.stops.map(R=>R[0]),evaluate:({zoom:R})=>y(h,o,R,A,S)}}return{kind:"source",evaluate(I,R){const P=R&&R.properties?R.properties[h.property]:void 0;return P===void 0?eh(h.default,o.default):y(h,o,P,A,S)}}}function eh(h,o,l){return h!==void 0?h:o!==void 0?o:l!==void 0?l:void 0}function fb(h,o,l,d,p){return eh(typeof l===p?d[l]:void 0,h.default,o.default)}function Kw(h,o,l){if(fi(l)!=="number")return eh(h.default,o.default);const d=h.stops.length;if(d===1||l<=h.stops[0][0])return h.stops[0][1];if(l>=h.stops[d-1][0])return h.stops[d-1][1];const p=sp(h.stops.map(_=>_[0]),l);return h.stops[p][1]}function wl(h,o,l){const d=h.base!==void 0?h.base:1;if(fi(l)!=="number")return eh(h.default,o.default);const p=h.stops.length;if(p===1||l<=h.stops[0][0])return h.stops[0][1];if(l>=h.stops[p-1][0])return h.stops[p-1][1];const _=sp(h.stops.map(R=>R[0]),l),y=function(R,P,B,N){const U=N-B,j=R-B;return U===0?0:P===1?j/U:(Math.pow(P,j)-1)/(Math.pow(P,U)-1)}(l,d,h.stops[_][0],h.stops[_+1][0]),A=h.stops[_][1],S=h.stops[_+1][1];let I=Gf[o.type]||db;if(h.colorSpace&&h.colorSpace!=="rgb"){const R=nb[h.colorSpace];I=(P,B)=>R.reverse(R.interpolate(R.forward(P),R.forward(B),y))}return typeof A.evaluate=="function"?{evaluate(...R){const P=A.evaluate.apply(void 0,R),B=S.evaluate.apply(void 0,R);if(P!==void 0&&B!==void 0)return I(P,B,y)}}:I(A,S,y)}function Jw(h,o,l){return o.type==="color"?l=rn.parse(l):o.type==="formatted"?l=Vs.fromString(l.toString()):o.type==="resolvedImage"?l=to.build(l.toString()):fi(l)===o.type||o.type==="enum"&&o.values[l]||(l=void 0),eh(l,h.default,o.default)}Ps.register(Qc,{error:[{kind:"error"},[bn],(h,[o])=>{throw new Wt(o.evaluate(h))}],typeof:[bn,[an],(h,[o])=>Dr(Ur(o.evaluate(h)))],"to-rgba":[Us(ti,4),[eo],(h,[o])=>o.evaluate(h).toRenderColor(null).toArray()],"to-hsla":[Us(ti,4),[eo],(h,[o])=>o.evaluate(h).toRenderColor(null).toHslaArray()],rgb:[eo,[ti,ti,ti],lb],rgba:[eo,[ti,ti,ti,ti],lb],hsl:[eo,[ti,ti,ti],cb],hsla:[eo,[ti,ti,ti,ti],cb],has:{type:hn,overloads:[[[bn],(h,[o])=>Og(o.evaluate(h),h.properties())],[[bn,ec],(h,[o,l])=>Og(o.evaluate(h),l.evaluate(h))]]},get:{type:an,overloads:[[[bn],(h,[o])=>fp(o.evaluate(h),h.properties())],[[bn,ec],(h,[o,l])=>fp(o.evaluate(h),l.evaluate(h))]]},"feature-state":[an,[bn],(h,[o])=>fp(o.evaluate(h),h.featureState||{})],properties:[ec,[],h=>h.properties()],"geometry-type":[bn,[],h=>h.geometryType()],id:[an,[],h=>h.id()],zoom:[ti,[],h=>h.globals.zoom],pitch:[ti,[],h=>h.globals.pitch||0],"distance-from-center":[ti,[],h=>h.distanceFromCenter()],"measure-light":[ti,[bn],(h,[o])=>h.measureLight(o.evaluate(h))],"heatmap-density":[ti,[],h=>h.globals.heatmapDensity||0],"line-progress":[ti,[],h=>h.globals.lineProgress||0],"raster-value":[ti,[],h=>h.globals.rasterValue||0],"raster-particle-speed":[ti,[],h=>h.globals.rasterParticleSpeed||0],"sky-radial-progress":[ti,[],h=>h.globals.skyRadialProgress||0],accumulated:[an,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[ti,oc(ti),(h,o)=>{let l=0;for(const d of o)l+=d.evaluate(h);return l}],"*":[ti,oc(ti),(h,o)=>{let l=1;for(const d of o)l*=d.evaluate(h);return l}],"-":{type:ti,overloads:[[[ti,ti],(h,[o,l])=>o.evaluate(h)-l.evaluate(h)],[[ti],(h,[o])=>-o.evaluate(h)]]},"/":[ti,[ti,ti],(h,[o,l])=>o.evaluate(h)/l.evaluate(h)],"%":[ti,[ti,ti],(h,[o,l])=>o.evaluate(h)%l.evaluate(h)],ln2:[ti,[],()=>Math.LN2],pi:[ti,[],()=>Math.PI],e:[ti,[],()=>Math.E],"^":[ti,[ti,ti],(h,[o,l])=>Math.pow(o.evaluate(h),l.evaluate(h))],sqrt:[ti,[ti],(h,[o])=>Math.sqrt(o.evaluate(h))],log10:[ti,[ti],(h,[o])=>Math.log(o.evaluate(h))/Math.LN10],ln:[ti,[ti],(h,[o])=>Math.log(o.evaluate(h))],log2:[ti,[ti],(h,[o])=>Math.log(o.evaluate(h))/Math.LN2],sin:[ti,[ti],(h,[o])=>Math.sin(o.evaluate(h))],cos:[ti,[ti],(h,[o])=>Math.cos(o.evaluate(h))],tan:[ti,[ti],(h,[o])=>Math.tan(o.evaluate(h))],asin:[ti,[ti],(h,[o])=>Math.asin(o.evaluate(h))],acos:[ti,[ti],(h,[o])=>Math.acos(o.evaluate(h))],atan:[ti,[ti],(h,[o])=>Math.atan(o.evaluate(h))],min:[ti,oc(ti),(h,o)=>Math.min(...o.map(l=>l.evaluate(h)))],max:[ti,oc(ti),(h,o)=>Math.max(...o.map(l=>l.evaluate(h)))],abs:[ti,[ti],(h,[o])=>Math.abs(o.evaluate(h))],round:[ti,[ti],(h,[o])=>{const l=o.evaluate(h);return l<0?-Math.round(-l):Math.round(l)}],floor:[ti,[ti],(h,[o])=>Math.floor(o.evaluate(h))],ceil:[ti,[ti],(h,[o])=>Math.ceil(o.evaluate(h))],"filter-==":[hn,[bn,an],(h,[o,l])=>h.properties()[o.value]===l.value],"filter-id-==":[hn,[an],(h,[o])=>h.id()===o.value],"filter-type-==":[hn,[bn],(h,[o])=>h.geometryType()===o.value],"filter-<":[hn,[bn,an],(h,[o,l])=>{const d=h.properties()[o.value],p=l.value;return typeof d==typeof p&&d<p}],"filter-id-<":[hn,[an],(h,[o])=>{const l=h.id(),d=o.value;return typeof l==typeof d&&l<d}],"filter->":[hn,[bn,an],(h,[o,l])=>{const d=h.properties()[o.value],p=l.value;return typeof d==typeof p&&d>p}],"filter-id->":[hn,[an],(h,[o])=>{const l=h.id(),d=o.value;return typeof l==typeof d&&l>d}],"filter-<=":[hn,[bn,an],(h,[o,l])=>{const d=h.properties()[o.value],p=l.value;return typeof d==typeof p&&d<=p}],"filter-id-<=":[hn,[an],(h,[o])=>{const l=h.id(),d=o.value;return typeof l==typeof d&&l<=d}],"filter->=":[hn,[bn,an],(h,[o,l])=>{const d=h.properties()[o.value],p=l.value;return typeof d==typeof p&&d>=p}],"filter-id->=":[hn,[an],(h,[o])=>{const l=h.id(),d=o.value;return typeof l==typeof d&&l>=d}],"filter-has":[hn,[an],(h,[o])=>o.value in h.properties()],"filter-has-id":[hn,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[hn,[Us(bn)],(h,[o])=>o.value.indexOf(h.geometryType())>=0],"filter-id-in":[hn,[Us(an)],(h,[o])=>o.value.indexOf(h.id())>=0],"filter-in-small":[hn,[bn,Us(an)],(h,[o,l])=>l.value.indexOf(h.properties()[o.value])>=0],"filter-in-large":[hn,[bn,Us(an)],(h,[o,l])=>function(d,p,_,y){for(;_<=y;){const A=_+y>>1;if(p[A]===d)return!0;p[A]>d?y=A-1:_=A+1}return!1}(h.properties()[o.value],l.value,0,l.value.length-1)],all:{type:hn,overloads:[[[hn,hn],(h,[o,l])=>o.evaluate(h)&&l.evaluate(h)],[oc(hn),(h,o)=>{for(const l of o)if(!l.evaluate(h))return!1;return!0}]]},any:{type:hn,overloads:[[[hn,hn],(h,[o,l])=>o.evaluate(h)||l.evaluate(h)],[oc(hn),(h,o)=>{for(const l of o)if(l.evaluate(h))return!0;return!1}]]},"!":[hn,[hn],(h,[o])=>!o.evaluate(h)],"is-supported-script":[hn,[bn],(h,[o])=>{const l=h.globals&&h.globals.isSupportedScript;return!l||l(o.evaluate(h))}],upcase:[bn,[bn],(h,[o])=>o.evaluate(h).toUpperCase()],downcase:[bn,[bn],(h,[o])=>o.evaluate(h).toLowerCase()],concat:[bn,oc(an),(h,o)=>o.map(l=>$s(l.evaluate(h))).join("")],"resolved-locale":[bn,[Wc],(h,[o])=>o.evaluate(h).resolvedLocale()],random:[ti,[ti,ti,an],(h,o)=>{const[l,d,p]=o.map(y=>y.evaluate(h));if(l>d||l===d)return l;let _;if(typeof p=="string")_=function(y){let A=0;if(y.length===0)return A;for(let S=0;S<y.length;S++)A=(A<<5)-A+y.charCodeAt(S),A|=0;return A}(p);else{if(typeof p!="number")throw new Wt(`Invalid seed input: ${p}`);_=p}return l+ab(_)()*(d-l)}]});class zg{constructor(o,l,d,p){this.expression=o,this._warningHistory={},this._evaluator=new qf(d,p),this._defaultValue=l?function(_){return _.type==="color"&&(gp(_.default)||Array.isArray(_.default))?new rn(0,0,0,0):_.type==="color"?rn.parse(_.default)||null:_.default===void 0?null:_.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this.configDependencies=np(o)}evaluateWithoutErrorHandling(o,l,d,p,_,y,A,S){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,d,p,_,y,A,S){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=S||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Wt(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function yp(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in Qc}function Zh(h,o,l,d){const p=new J0(Qc,[],o?function(y){const A={color:eo,string:bn,number:ti,enum:bn,boolean:hn,formatted:td,resolvedImage:id};return y.type==="array"?Us(A[y.value]||an,y.length):A[y.type]}(o):void 0,void 0,void 0,l,d),_=p.parse(h,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?hb(new zg(_,o,l,d)):Bo(p.errors)}class th{constructor(o,l,d,p){this.kind=o,this._styleExpression=l,this.isLightConstant=d,this.isLineProgressConstant=p,this.isStateDependent=o!=="constant"&&!ip(l.expression),this.configDependencies=np(l.expression)}evaluateWithoutErrorHandling(o,l,d,p,_,y){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,p,_,y)}evaluate(o,l,d,p,_,y){return this._styleExpression.evaluate(o,l,d,p,_,y)}}class Kh{constructor(o,l,d,p,_,y){this.kind=o,this.zoomStops=d,this._styleExpression=l,this.isStateDependent=o!=="camera"&&!ip(l.expression),this.isLightConstant=_,this.isLineProgressConstant=y,this.configDependencies=np(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(o,l,d,p,_,y){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,p,_,y)}evaluate(o,l,d,p,_,y){return this._styleExpression.evaluate(o,l,d,p,_,y)}interpolationFactor(o,l,d){return this.interpolationType?io.interpolationFactor(this.interpolationType,o,l,d):0}}function md(h,o,l,d){if((h=Zh(h,o,l,d)).result==="error")return h;const p=h.value.expression,_=cd(p);if(!_&&!pp(o))return Bo([new Wo("","data expressions not supported")]);const y=Wh(p,["zoom","pitch","distance-from-center"]);if(!y&&!Lg(o))return Bo([new Wo("","zoom expressions not supported")]);const A=Wh(p,["measure-light"]);if(!A&&!ub(o))return Bo([new Wo("","measure-light expression not supported")]);const S=Wh(p,["line-progress"]);if(!S&&!function(P){return Fg(P.expression,"line-progress")}(o))return Bo([new Wo("","line-progress expression not supported")]);const I=o.expression&&o.expression.relaxZoomRestriction,R=bp(p);return R||y||I?R instanceof Wo?Bo([R]):R instanceof io&&!mp(o)?Bo([new Wo("",'"interpolate" expressions cannot be used with this property')]):hb(R?new Kh(_&&S?"camera":"composite",h.value,R.labels,R instanceof io?R.interpolation:void 0,A,S):new th(_&&S?"constant":"source",h.value,A,S)):Bo([new Wo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class gd{constructor(o,l){this._parameters=o,this._specification=l,ed(this,_p(this._parameters,this._specification))}static deserialize(o){return new gd(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function bp(h){let o=null;if(h instanceof lp)o=bp(h.result);else if(h instanceof ap){for(const l of h.args)if(o=bp(l),o)break}else(h instanceof hd||h instanceof io)&&h.input instanceof Ps&&h.input.name==="zoom"&&(o=h);return o instanceof Wo||h.eachChild(l=>{const d=bp(l);d instanceof Wo?o=d:o&&d&&o!==d&&(o=new Wo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var Ng,vp,Ug=function(){if(vp)return Ng;vp=1,Ng=o;var h=3;function o(l,d,p){var _=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var y=new Int32Array(this.arrayBuffer);l=y[0],this.d=(d=y[1])+2*(p=y[2]);for(var A=0;A<this.d*this.d;A++){var S=y[h+A],I=y[h+A+1];_.push(S===I?null:y.subarray(S,I))}var R=y[h+_.length+1];this.keys=y.subarray(y[h+_.length],R),this.bboxes=y.subarray(R),this.insert=this._insertReadonly}else{this.d=d+2*p;for(var P=0;P<this.d*this.d;P++)_.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=l,this.padding=p,this.scale=d/l,this.uid=0;var B=p/d*l;this.min=-B,this.max=l+B}return o.prototype.insert=function(l,d,p,_,y){this._forEachCell(d,p,_,y,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(y)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(l,d,p,_,y,A){this.cells[y].push(A)},o.prototype.query=function(l,d,p,_,y){var A=this.min,S=this.max;if(l<=A&&d<=A&&S<=p&&S<=_&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(l,d,p,_,this._queryCell,I,{},y),I},o.prototype._queryCell=function(l,d,p,_,y,A,S,I){var R=this.cells[y];if(R!==null)for(var P=this.keys,B=this.bboxes,N=0;N<R.length;N++){var U=R[N];if(S[U]===void 0){var j=4*U;(I?I(B[j+0],B[j+1],B[j+2],B[j+3]):l<=B[j+2]&&d<=B[j+3]&&p>=B[j+0]&&_>=B[j+1])?(S[U]=!0,A.push(P[U])):S[U]=!1}}},o.prototype._forEachCell=function(l,d,p,_,y,A,S,I){for(var R=this._convertToCellCoord(l),P=this._convertToCellCoord(d),B=this._convertToCellCoord(p),N=this._convertToCellCoord(_),U=R;U<=B;U++)for(var j=P;j<=N;j++){var K=this.d*j+U;if((!I||I(this._convertFromCellCoord(U),this._convertFromCellCoord(j),this._convertFromCellCoord(U+1),this._convertFromCellCoord(j+1)))&&y.call(this,l,d,p,_,K,A,S,I))return}},o.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},o.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,d=h+this.cells.length+1+1,p=0,_=0;_<this.cells.length;_++)p+=this.cells[_].length;var y=new Int32Array(d+p+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var A=d,S=0;S<l.length;S++){var I=l[S];y[h+S]=A,y.set(I,A),A+=I.length}return y[h+l.length]=A,y.set(this.keys,A),y[h+l.length+1]=A+=this.keys.length,y.set(this.bboxes,A),A+=this.bboxes.length,y.buffer},Ng}(),Jh=Qs(Ug);const _d={};function Ut(h,o,l={}){Object.defineProperty(h,"_classRegistryKey",{value:o,writable:!1}),_d[o]={klass:h,omit:l.omit||[]}}Ut(Object,"Object"),Jh.serialize=function(h,o){const l=h.toArrayBuffer();return o&&o.add(l),{buffer:l}},Jh.deserialize=function(h){return new Jh(h.buffer)},Object.defineProperty(Jh,"name",{value:"Grid"}),Ut(Jh,"Grid"),typeof DOMMatrix<"u"&&Ut(DOMMatrix,"DOMMatrix"),Ut(rn,"Color"),Ut(Error,"Error"),Ut(Vs,"Formatted"),Ut(Xf,"FormattedSection"),Ut(Vf,"AJAXError"),Ut(to,"ResolvedImage"),Ut(gd,"StylePropertyFunction"),Ut(zg,"StyleExpression",{omit:["_evaluator"]}),Ut(bo,"ImageId"),Ut(ma,"ImageVariant"),Ut(Kh,"ZoomDependentExpression"),Ut(th,"ZoomConstantExpression"),Ut(Ps,"CompoundExpression",{omit:["_evaluate"]});for(const h in Qc)_d[Qc[h]._classRegistryKey]||Ut(Qc[h],`Expression${h}`);function yd(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function ih(h){return self.ImageBitmap&&h instanceof ImageBitmap}function ac(h,o){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp)return h;if(yd(h)||ih(h))return o&&o.add(h),h;if(ArrayBuffer.isView(h))return o&&o.add(h.buffer),h;if(h instanceof ImageData)return o&&o.add(h.data.buffer),h;if(Array.isArray(h)){const l=[];for(const d of h)l.push(ac(d,o));return l}if(h instanceof Map){const l={$name:"Map",entries:[]};for(const[d,p]of h.entries())l.entries.push(ac(d),ac(p,o));return l}if(h instanceof Set){const l={$name:"Set"};let d=0;for(const p of h.values())l[++d]=ac(p);return l}if(h instanceof DOMMatrix){const l={$name:"DOMMatrix"},d=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const p of d)l[p]=h[p];return l}if(typeof h=="bigint")return{$name:"BigInt",value:h.toString()};if(typeof h=="object"){const l=h.constructor,d=l._classRegistryKey;if(!d)throw new Error(`Can't serialize object of unregistered class "${l.name}".`);const p=l.serialize?l.serialize(h,o):{};if(!l.serialize){for(const _ in h)h.hasOwnProperty(_)&&(_d[d].omit.indexOf(_)>=0||(p[_]=ac(h[_],o)));h instanceof Error&&(p.message=h.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(p.$name=d),p}throw new Error("can't serialize object of type "+typeof h)}function lc(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||yd(h)||ih(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(lc);if(typeof h=="object"){const o=h.$name||"Object";if(o==="Map"){const p=h.entries||[],_=new Map;for(let y=0;y<p.length;y+=2)_.set(lc(p[y]),lc(p[y+1]));return _}if(o==="Set"){const p=new Set;for(const _ of Object.keys(h))_!=="$name"&&p.add(lc(h[_]));return p}if(o==="DOMMatrix"){let p;return p=h.is2D?[h.a,h.b,h.c,h.d,h.e,h.f]:[h.m11,h.m12,h.m13,h.m14,h.m21,h.m22,h.m23,h.m24,h.m31,h.m32,h.m33,h.m34,h.m41,h.m42,h.m43,h.m44],new DOMMatrix(p)}if(o==="BigInt")return BigInt(h.value);const{klass:l}=_d[o];if(!l)throw new Error(`Can't deserialize unregistered class "${o}".`);if(l.deserialize)return l.deserialize(h);const d=Object.create(l.prototype);for(const p of Object.keys(h))p!=="$name"&&(d[p]=lc(h[p]));return d}throw new Error("can't deserialize object of type "+typeof h)}const oi={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519,Osage:h=>h>=66736&&h<=66815,"CJK Unified Ideographs Extension B":h=>h>=131072&&h<=173791};function Vg(h){for(const o of h)if(bd(o.charCodeAt(0)))return!0;return!1}function Qw(h){for(const o of h)if(!pb(o.charCodeAt(0)))return!1;return!0}function pb(h){return!(oi.Arabic(h)||oi["Arabic Supplement"](h)||oi["Arabic Extended-A"](h)||oi["Arabic Presentation Forms-A"](h)||oi["Arabic Presentation Forms-B"](h))}function bd(h){return!(h!==746&&h!==747&&(h<4352||!(oi["Bopomofo Extended"](h)||oi.Bopomofo(h)||oi["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||oi["CJK Compatibility Ideographs"](h)||oi["CJK Compatibility"](h)||oi["CJK Radicals Supplement"](h)||oi["CJK Strokes"](h)||!(!oi["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||oi["CJK Unified Ideographs Extension A"](h)||oi["CJK Unified Ideographs"](h)||oi["Enclosed CJK Letters and Months"](h)||oi["Hangul Compatibility Jamo"](h)||oi["Hangul Jamo Extended-A"](h)||oi["Hangul Jamo Extended-B"](h)||oi["Hangul Jamo"](h)||oi["Hangul Syllables"](h)||oi.Hiragana(h)||oi["Ideographic Description Characters"](h)||oi.Kanbun(h)||oi["Kangxi Radicals"](h)||oi["Katakana Phonetic Extensions"](h)||oi.Katakana(h)&&h!==12540||!(!oi["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!oi["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||oi["Unified Canadian Aboriginal Syllabics"](h)||oi["Unified Canadian Aboriginal Syllabics Extended"](h)||oi["Vertical Forms"](h)||oi["Yijing Hexagram Symbols"](h)||oi["Yi Syllables"](h)||oi["Yi Radicals"](h))))}function mb(h){return!(bd(h)||function(o){return!!(oi["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||oi["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||oi["Letterlike Symbols"](o)||oi["Number Forms"](o)||oi["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||oi["Control Pictures"](o)&&o!==9251||oi["Optical Character Recognition"](o)||oi["Enclosed Alphanumerics"](o)||oi["Geometric Shapes"](o)||oi["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||oi["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||oi["CJK Symbols and Punctuation"](o)||oi.Katakana(o)||oi["Private Use Area"](o)||oi["CJK Compatibility Forms"](o)||oi["Small Form Variants"](o)||oi["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(h))}function eA(h){return oi.Arabic(h)||oi["Arabic Supplement"](h)||oi["Arabic Extended-A"](h)||oi["Arabic Presentation Forms-A"](h)||oi["Arabic Presentation Forms-B"](h)}function gb(h){return h>=1424&&h<=2303||oi["Arabic Presentation Forms-A"](h)||oi["Arabic Presentation Forms-B"](h)}function tA(h,o){return!(!o&&gb(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||oi.Khmer(h))}function iA(h){for(const o of h)if(gb(o.charCodeAt(0)))return!0;return!1}const $g="deferred",jg="loading",Hg="loaded";let Wg=null,vo="unavailable",cc=null;const nh=function(h){h&&typeof h=="string"&&h.indexOf("NetworkError")>-1&&(vo="error"),Wg&&Wg(h)};function xp(){wp.fire(new Jl("pluginStateChange",{pluginStatus:vo,pluginURL:cc}))}const wp=new jc,Qh=function(){return vo},_b=function(){if(vo!==$g||!cc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");vo=jg,xp(),cc&&Dh({url:cc},h=>{h?nh(h):(vo=Hg,xp())})},qo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>vo===Hg||qo.applyArabicShaping!=null,isLoading:()=>vo===jg,setState(h){vo=h.pluginStatus,cc=h.pluginURL},isParsed:()=>qo.applyArabicShaping!=null&&qo.processBidirectionalText!=null&&qo.processStyledBidirectionalText!=null,getPluginURL:()=>cc};class pn{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(l,d){for(const p of l)if(!tA(p.charCodeAt(0),d))return!1;return!0}(o,qo.isLoaded())}}class vd{constructor(o,l,d,p){this.property=o,this.value=l,this.expression=function(_,y,A,S){if(gp(_))return new gd(_,y);if(yp(_)||Array.isArray(_)&&_.length>0){const I=md(_,y,A,S);if(I.result==="error")throw new Error(I.value.map(R=>`${R.key}: ${R.message}`).join(", "));return I.value}{let I=_;return typeof _=="string"&&y.type==="color"&&(I=rn.parse(_)),{kind:"constant",configDependencies:new Set,evaluate:()=>I}}}(l===void 0?o.specification.default:l,o.specification,d,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,l,d){return this.property.possiblyEvaluate(this,o,l,d)}}class hc{constructor(o,l,d){this.property=o,this.value=new vd(o,void 0,l,d)}transitioned(o,l){return new bb(this.property,this.value,l,Ge({},o.transition,this.transition),o.now)}untransitioned(){return new bb(this.property,this.value,null,{},0)}}class yb{constructor(o,l,d){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=l,this._options=d,this.configDependencies=new Set}getValue(o){return Pi(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new hc(this._values[o].property,this._scope,this._options)),this._values[o].value=new vd(this._values[o].property,l===null?void 0:Pi(l),this._scope,this._options),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]))}setTransitionOrValue(o,l){l&&(this._options=l);const d=this._properties.properties;if(o)for(const p in o){const _=o[p];if(p.endsWith("-transition")){const y=p.slice(0,-11);d[y]&&this.setTransition(y,_)}else d.hasOwnProperty(p)&&this.setValue(p,_)}}getTransition(o){return Pi(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new hc(this._values[o].property)),this._values[o].transition=Pi(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(o[l]=d);const p=this.getTransition(l);p!==void 0&&(o[`${l}-transition`]=p)}return o}transitioned(o,l){const d=new vb(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].transitioned(o,l._values[p]);return d}untransitioned(){const o=new vb(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class bb{constructor(o,l,d,p,_){const y=p.delay||0,A=p.duration||0;_=_||0,this.property=o,this.value=l,this.begin=_+y,this.end=this.begin+A,o.specification.transition&&(p.delay||p.duration)&&(this.prior=d)}possiblyEvaluate(o,l,d){const p=o.now||0,_=this.value.possiblyEvaluate(o,l,d),y=this.prior;if(y){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return y.possiblyEvaluate(o,l,d);{const A=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(o,l,d),_,Ae(A))}}return _}}class vb{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,d){const p=new rh(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(o,l,d);return p}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class nA{constructor(o,l,d){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=l,this._options=d,this.configDependencies=new Set}getValue(o){return Pi(this._values[o].value)}setValue(o,l){this._values[o]=new vd(this._values[o].property,l===null?void 0:Pi(l),this._scope,this._options),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]))}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(o[l]=d)}return o}possiblyEvaluate(o,l,d){const p=new rh(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(o,l,d);return p}}class eu{constructor(o,l,d){this.property=o,this.value=l,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,l,d,p){return this.property.evaluate(this.value,this.parameters,o,l,d,p)}}class rh{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class It{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,d){const p=Gf[this.specification.type];return p?p(o,l,d):o}}class Nt{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,d,p){return new eu(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(l,null,{},d,p)}:o.expression,l)}interpolate(o,l,d){if(o.value.kind!=="constant"||l.value.kind!=="constant")return o;if(o.value.value===void 0||l.value.value===void 0)return new eu(this,{kind:"constant",value:void 0},o.parameters);const p=Gf[this.specification.type];return p?new eu(this,{kind:"constant",value:p(o.value.value,l.value.value,d)},o.parameters):o}evaluate(o,l,d,p,_,y){return o.kind==="constant"?o.value:o.evaluate(l,d,p,_,y)}}class sh{constructor(o){this.specification=o}possiblyEvaluate(o,l,d,p){return!!o.expression.evaluate(l,null,{},d,p)}interpolate(){return!1}}class or{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new pn(0,{});for(const d in o){const p=o[d];p.specification.overridable&&this.overridableProperties.push(d);const _=this.defaultPropertyValues[d]=new vd(p,void 0),y=this.defaultTransitionablePropertyValues[d]=new hc(p);this.defaultTransitioningPropertyValues[d]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=_.possiblyEvaluate(l)}}}Ut(Nt,"DataDrivenProperty"),Ut(It,"DataConstantProperty"),Ut(sh,"ColorRampProperty");var He=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function _a(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Ap(h){if(Array.isArray(h))return h.map(Ap);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const o={};for(const l in h)o[l]=Ap(h[l]);return o}return _a(h)}function Tp(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const o of h.slice(1))if(!Tp(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}function Gg(h,o="",l=null,d="fill"){if(h==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Tp(h)||(h=Sp(h));const p=h;let _=!0;try{_=function(R){if(!tu(R))return R;let P=Ap(R);return wb(P),P=xb(P),P}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let y=null,A=null;if(d!=="background"&&d!=="sky"&&d!=="slot"){A=He[`filter_${d}`];const R=Zh(_,A,o,l);if(R.result==="error")throw new Error(R.value.map(P=>`${P.key}: ${P.message}`).join(", "));y=(P,B,N)=>R.value.evaluate(P,B,{},N)}let S=null,I=null;if(_!==p){const R=Zh(p,A,o,l);if(R.result==="error")throw new Error(R.value.map(P=>`${P.key}: ${P.message}`).join(", "));S=(P,B,N,U,j)=>R.value.evaluate(P,B,{},N,void 0,void 0,U,j),I=!cd(R.value.expression)}return{filter:y,dynamicFilter:S||void 0,needGeometry:Ab(_),needFeature:!!I}}function xb(h){if(!Array.isArray(h))return h;const o=function(l){if(rA.has(l[0])){for(let d=1;d<l.length;d++)if(tu(l[d]))return!0}return l}(h);return o===!0?o:o.map(l=>xb(l))}function wb(h){let o=!1;const l=[];if(h[0]==="case"){for(let d=1;d<h.length-1;d+=2)o=o||tu(h[d]),l.push(h[d+1]);l.push(h[h.length-1])}else if(h[0]==="match"){o=o||tu(h[1]);for(let d=2;d<h.length-1;d+=2)l.push(h[d+1]);l.push(h[h.length-1])}else if(h[0]==="step"){o=o||tu(h[1]);for(let d=1;d<h.length-1;d+=2)l.push(h[d+1])}o&&(h.length=0,h.push("any",...l));for(let d=1;d<h.length;d++)wb(h[d])}function tu(h){if(!Array.isArray(h))return!1;if((o=h[0])==="pitch"||o==="distance-from-center")return!0;var o;for(let l=1;l<h.length;l++)if(tu(h[l]))return!0;return!1}const rA=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function sA(h,o){return h<o?-1:h>o?1:0}function Ab(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let o=1;o<h.length;o++)if(Ab(h[o]))return!0;return!1}function Sp(h){if(!h)return!0;const o=h[0];return h.length<=1?o!=="any":o==="=="?Xg(h[1],h[2],"=="):o==="!="?Ep(Xg(h[1],h[2],"==")):o==="<"||o===">"||o==="<="||o===">="?Xg(h[1],h[2],o):o==="any"?(l=h.slice(1),["any"].concat(l.map(Sp))):o==="all"?["all"].concat(h.slice(1).map(Sp)):o==="none"?["all"].concat(h.slice(1).map(Sp).map(Ep)):o==="in"?qg(h[1],h.slice(2)):o==="!in"?Ep(qg(h[1],h.slice(2))):o==="has"?Tb(h[1]):o!=="!has"||Ep(Tb(h[1]));var l}function Xg(h,o,l){switch(h){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,h,o]}}function qg(h,o){if(o.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",h,["literal",o.sort(sA)]]:["filter-in-small",h,["literal",o]]}}function Tb(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Ep(h){return["!",h]}const xd="";function oh(h,o){return o?`${h}${xd}${o}`:h}const Yg="-transition",uc=new Set(["fill","line","background","hillshade","raster"]);class Ws extends jc{constructor(o,l,d,p,_){if(super(),this.id=o.id,this.fqid=oh(this.id,d),this.type=o.type,this.scope=d,this.lut=p,this.options=_,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,o.type!=="custom"){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&o.type!=="background"&&o.type!=="sky"&&o.type!=="slot"){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const y=Zh(this.filter,He[`filter_${o.type}`]);y.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...y.value.configDependencies]))}if(o.slot&&(this.slot=o.slot),l.layout&&(this._unevaluatedLayout=new nA(l.layout,this.scope,_),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),l.paint){this._transitionablePaint=new yb(l.paint,this.scope,_);for(const y in o.paint)this.setPaintProperty(y,o.paint[y]);for(const y in o.layout)this.setLayoutProperty(y,o.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rh(l.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D(!0)&&uc.has(this.type)}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l){if(this.type==="custom"&&o==="visibility")return void(this.visibility=l);const d=this._unevaluatedLayout;d._properties.properties[o]&&(d.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),o==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return o.endsWith(Yg)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l){const d=this._transitionablePaint,p=d._properties.properties;if(o.endsWith(Yg)){const P=o.slice(0,-11);return p[P]&&d.setTransition(P,l||void 0),!1}if(!p[o])return!1;const _=d._values[o],y=_.value.isDataDriven(),A=_.value;d.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(o);const S=d._values[o].value,I=S.isDataDriven(),R=o.endsWith("pattern")||o==="line-dasharray";return I||y||R||this._handleOverridablePaintPropertyUpdate(o,A,S)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,l,d){return null}_handleOverridablePaintPropertyUpdate(o,l,d){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){return Si({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(o,l)=>!(o===void 0||l==="layout"&&!Object.keys(o).length||l==="paint"&&!Object.keys(o).length))}is3D(o){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof eu&&pp(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=Gg(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&(o.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(o){}queryIntersectsFeature(o,l,d,p,_,y,A,S,I){}}const oA={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wd{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Un{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.add(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function tn(h,o=1){let l=0,d=0;return{members:h.map(p=>{const _=oA[p.type].BYTES_PER_ELEMENT,y=l=Zg(l,Math.max(o,_)),A=p.components||1;return d=Math.max(d,_),l+=_*A,{name:p.name,type:p.type,components:A,offset:y}}),size:Zg(l,Math.max(d,o)),alignment:o}}function Zg(h,o){return Math.ceil(h/o)*o}class Al extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const p=2*o;return this.int16[p+0]=l,this.int16[p+1]=d,o}}Al.prototype.bytesPerElement=4,Ut(Al,"StructArrayLayout2i4");class Cp extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const _=3*o;return this.int16[_+0]=l,this.int16[_+1]=d,this.int16[_+2]=p,o}}Cp.prototype.bytesPerElement=6,Ut(Cp,"StructArrayLayout3i6");class ah extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,d,p)}emplace(o,l,d,p,_){const y=4*o;return this.int16[y+0]=l,this.int16[y+1]=d,this.int16[y+2]=p,this.int16[y+3]=_,o}}ah.prototype.bytesPerElement=8,Ut(ah,"StructArrayLayout4i8");class iu extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}iu.prototype.bytesPerElement=4,Ut(iu,"StructArrayLayout1f4");class Ip extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const _=4*o,y=2*o;return this.int16[_+0]=l,this.int16[_+1]=d,this.float32[y+1]=p,o}}Ip.prototype.bytesPerElement=8,Ut(Ip,"StructArrayLayout2i1f8");class nu extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const _=4*o;return this.int16[_+0]=l,this.int16[_+1]=d,this.int16[_+2]=p,o}}nu.prototype.bytesPerElement=8,Ut(nu,"StructArrayLayout3i8");class Kg extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p,_)}emplace(o,l,d,p,_,y){const A=5*o;return this.int16[A+0]=l,this.int16[A+1]=d,this.int16[A+2]=p,this.int16[A+3]=_,this.int16[A+4]=y,o}}Kg.prototype.bytesPerElement=10,Ut(Kg,"StructArrayLayout5i10");class Jg extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,d,p,_,y,A)}emplace(o,l,d,p,_,y,A,S){const I=6*o,R=12*o,P=3*o;return this.int16[I+0]=l,this.int16[I+1]=d,this.uint8[R+4]=p,this.uint8[R+5]=_,this.uint8[R+6]=y,this.uint8[R+7]=A,this.float32[P+2]=S,o}}Jg.prototype.bytesPerElement=12,Ut(Jg,"StructArrayLayout2i4ub1f12");class Za extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const _=3*o;return this.float32[_+0]=l,this.float32[_+1]=d,this.float32[_+2]=p,o}}Za.prototype.bytesPerElement=12,Ut(Za,"StructArrayLayout3f12");class Tl extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p,_)}emplace(o,l,d,p,_,y){const A=6*o,S=3*o;return this.uint16[A+0]=l,this.uint16[A+1]=d,this.uint16[A+2]=p,this.uint16[A+3]=_,this.float32[S+2]=y,o}}Tl.prototype.bytesPerElement=12,Ut(Tl,"StructArrayLayout4ui1f12");class Mp extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,d,p)}emplace(o,l,d,p,_){const y=4*o;return this.uint16[y+0]=l,this.uint16[y+1]=d,this.uint16[y+2]=p,this.uint16[y+3]=_,o}}Mp.prototype.bytesPerElement=8,Ut(Mp,"StructArrayLayout4ui8");class lh extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y){const A=this.length;return this.resize(A+1),this.emplace(A,o,l,d,p,_,y)}emplace(o,l,d,p,_,y,A){const S=6*o;return this.int16[S+0]=l,this.int16[S+1]=d,this.int16[S+2]=p,this.int16[S+3]=_,this.int16[S+4]=y,this.int16[S+5]=A,o}}lh.prototype.bytesPerElement=12,Ut(lh,"StructArrayLayout6i12");class ru extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A,S,I,R,P,B){const N=this.length;return this.resize(N+1),this.emplace(N,o,l,d,p,_,y,A,S,I,R,P,B)}emplace(o,l,d,p,_,y,A,S,I,R,P,B,N){const U=12*o;return this.int16[U+0]=l,this.int16[U+1]=d,this.int16[U+2]=p,this.int16[U+3]=_,this.uint16[U+4]=y,this.uint16[U+5]=A,this.uint16[U+6]=S,this.uint16[U+7]=I,this.int16[U+8]=R,this.int16[U+9]=P,this.int16[U+10]=B,this.int16[U+11]=N,o}}ru.prototype.bytesPerElement=24,Ut(ru,"StructArrayLayout4i4ui4i24");class no extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y){const A=this.length;return this.resize(A+1),this.emplace(A,o,l,d,p,_,y)}emplace(o,l,d,p,_,y,A){const S=10*o,I=5*o;return this.int16[S+0]=l,this.int16[S+1]=d,this.int16[S+2]=p,this.float32[I+2]=_,this.float32[I+3]=y,this.float32[I+4]=A,o}}no.prototype.bytesPerElement=20,Ut(no,"StructArrayLayout3i3f20");class Ka extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,d,p)}emplace(o,l,d,p,_){const y=4*o;return this.float32[y+0]=l,this.float32[y+1]=d,this.float32[y+2]=p,this.float32[y+3]=_,o}}Ka.prototype.bytesPerElement=16,Ut(Ka,"StructArrayLayout4f16");class Qg extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Qg.prototype.bytesPerElement=4,Ut(Qg,"StructArrayLayout1ul4");class dc extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const p=2*o;return this.uint16[p+0]=l,this.uint16[p+1]=d,o}}dc.prototype.bytesPerElement=4,Ut(dc,"StructArrayLayout2ui4");class e_ extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A,S,I,R,P,B,N){const U=this.length;return this.resize(U+1),this.emplace(U,o,l,d,p,_,y,A,S,I,R,P,B,N)}emplace(o,l,d,p,_,y,A,S,I,R,P,B,N,U){const j=20*o,K=10*o;return this.int16[j+0]=l,this.int16[j+1]=d,this.int16[j+2]=p,this.int16[j+3]=_,this.int16[j+4]=y,this.float32[K+3]=A,this.float32[K+4]=S,this.float32[K+5]=I,this.float32[K+6]=R,this.int16[j+14]=P,this.uint32[K+8]=B,this.uint16[j+18]=N,this.uint16[j+19]=U,o}}e_.prototype.bytesPerElement=40,Ut(e_,"StructArrayLayout5i4f1i1ul2ui40");class Rp extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,d,p,_,y,A)}emplace(o,l,d,p,_,y,A,S){const I=8*o;return this.int16[I+0]=l,this.int16[I+1]=d,this.int16[I+2]=p,this.int16[I+4]=_,this.int16[I+5]=y,this.int16[I+6]=A,this.int16[I+7]=S,o}}Rp.prototype.bytesPerElement=16,Ut(Rp,"StructArrayLayout3i2i2i16");class Ad extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p,_)}emplace(o,l,d,p,_,y){const A=4*o,S=8*o;return this.float32[A+0]=l,this.float32[A+1]=d,this.float32[A+2]=p,this.int16[S+6]=_,this.int16[S+7]=y,o}}Ad.prototype.bytesPerElement=16,Ut(Ad,"StructArrayLayout2f1f2i16");class t_ extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y){const A=this.length;return this.resize(A+1),this.emplace(A,o,l,d,p,_,y)}emplace(o,l,d,p,_,y,A){const S=20*o,I=5*o;return this.uint8[S+0]=l,this.uint8[S+1]=d,this.float32[I+1]=p,this.float32[I+2]=_,this.float32[I+3]=y,this.float32[I+4]=A,o}}t_.prototype.bytesPerElement=20,Ut(t_,"StructArrayLayout2ub4f20");class qr extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,d)}emplace(o,l,d,p){const _=3*o;return this.uint16[_+0]=l,this.uint16[_+1]=d,this.uint16[_+2]=p,o}}qr.prototype.bytesPerElement=6,Ut(qr,"StructArrayLayout3ui6");class i_ extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K,ee,le,re,G,ie){const ae=this.length;return this.resize(ae+1),this.emplace(ae,o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K,ee,le,re,G,ie)}emplace(o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K,ee,le,re,G,ie,ae){const fe=30*o,Ce=15*o,Be=60*o;return this.int16[fe+0]=l,this.int16[fe+1]=d,this.int16[fe+2]=p,this.float32[Ce+2]=_,this.float32[Ce+3]=y,this.uint16[fe+8]=A,this.uint16[fe+9]=S,this.uint32[Ce+5]=I,this.uint32[Ce+6]=R,this.uint32[Ce+7]=P,this.uint16[fe+16]=B,this.uint16[fe+17]=N,this.uint16[fe+18]=U,this.float32[Ce+10]=j,this.float32[Ce+11]=K,this.uint8[Be+48]=ee,this.uint8[Be+49]=le,this.uint8[Be+50]=re,this.uint32[Ce+13]=G,this.int16[fe+28]=ie,this.uint8[Be+58]=ae,o}}i_.prototype.bytesPerElement=60,Ut(i_,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class n_ extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K,ee,le,re,G,ie,ae,fe,Ce,Be,Fe,Ve,et,mt,ht,pt,xt,Ke){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K,ee,le,re,G,ie,ae,fe,Ce,Be,Fe,Ve,et,mt,ht,pt,xt,Ke)}emplace(o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K,ee,le,re,G,ie,ae,fe,Ce,Be,Fe,Ve,et,mt,ht,pt,xt,Ke,ft){const Ye=20*o,Qe=40*o,At=80*o;return this.float32[Ye+0]=l,this.float32[Ye+1]=d,this.int16[Qe+4]=p,this.int16[Qe+5]=_,this.int16[Qe+6]=y,this.int16[Qe+7]=A,this.int16[Qe+8]=S,this.int16[Qe+9]=I,this.int16[Qe+10]=R,this.int16[Qe+11]=P,this.int16[Qe+12]=B,this.uint16[Qe+13]=N,this.uint16[Qe+14]=U,this.uint16[Qe+15]=j,this.uint16[Qe+16]=K,this.uint16[Qe+17]=ee,this.uint16[Qe+18]=le,this.uint16[Qe+19]=re,this.uint16[Qe+20]=G,this.uint16[Qe+21]=ie,this.uint16[Qe+22]=ae,this.uint16[Qe+23]=fe,this.uint16[Qe+24]=Ce,this.uint16[Qe+25]=Be,this.uint16[Qe+26]=Fe,this.uint16[Qe+27]=Ve,this.uint32[Ye+14]=et,this.float32[Ye+15]=mt,this.float32[Ye+16]=ht,this.float32[Ye+17]=pt,this.float32[Ye+18]=xt,this.uint8[At+76]=Ke,this.uint16[Qe+39]=ft,o}}n_.prototype.bytesPerElement=80,Ut(n_,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class fc extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,p,_)}emplace(o,l,d,p,_,y){const A=5*o;return this.float32[A+0]=l,this.float32[A+1]=d,this.float32[A+2]=p,this.float32[A+3]=_,this.float32[A+4]=y,o}}fc.prototype.bytesPerElement=20,Ut(fc,"StructArrayLayout5f20");class Td extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,d,p,_,y,A)}emplace(o,l,d,p,_,y,A,S){const I=7*o;return this.float32[I+0]=l,this.float32[I+1]=d,this.float32[I+2]=p,this.float32[I+3]=_,this.float32[I+4]=y,this.float32[I+5]=A,this.float32[I+6]=S,o}}Td.prototype.bytesPerElement=28,Ut(Td,"StructArrayLayout7f28");class r_ extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A,S,I,R,P){const B=this.length;return this.resize(B+1),this.emplace(B,o,l,d,p,_,y,A,S,I,R,P)}emplace(o,l,d,p,_,y,A,S,I,R,P,B){const N=11*o;return this.float32[N+0]=l,this.float32[N+1]=d,this.float32[N+2]=p,this.float32[N+3]=_,this.float32[N+4]=y,this.float32[N+5]=A,this.float32[N+6]=S,this.float32[N+7]=I,this.float32[N+8]=R,this.float32[N+9]=P,this.float32[N+10]=B,o}}r_.prototype.bytesPerElement=44,Ut(r_,"StructArrayLayout11f44");class kp extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A,S,I){const R=this.length;return this.resize(R+1),this.emplace(R,o,l,d,p,_,y,A,S,I)}emplace(o,l,d,p,_,y,A,S,I,R){const P=9*o;return this.float32[P+0]=l,this.float32[P+1]=d,this.float32[P+2]=p,this.float32[P+3]=_,this.float32[P+4]=y,this.float32[P+5]=A,this.float32[P+6]=S,this.float32[P+7]=I,this.float32[P+8]=R,o}}kp.prototype.bytesPerElement=36,Ut(kp,"StructArrayLayout9f36");class ch extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const p=2*o;return this.float32[p+0]=l,this.float32[p+1]=d,o}}ch.prototype.bytesPerElement=8,Ut(ch,"StructArrayLayout2f8");class s_ extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,d,p)}emplace(o,l,d,p,_){const y=6*o;return this.uint32[3*o+0]=l,this.uint16[y+2]=d,this.uint16[y+3]=p,this.uint16[y+4]=_,o}}s_.prototype.bytesPerElement=12,Ut(s_,"StructArrayLayout1ul3ui12");class Sd extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}Sd.prototype.bytesPerElement=2,Ut(Sd,"StructArrayLayout1ui2");class su extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K){const ee=this.length;return this.resize(ee+1),this.emplace(ee,o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K)}emplace(o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K,ee){const le=16*o;return this.float32[le+0]=l,this.float32[le+1]=d,this.float32[le+2]=p,this.float32[le+3]=_,this.float32[le+4]=y,this.float32[le+5]=A,this.float32[le+6]=S,this.float32[le+7]=I,this.float32[le+8]=R,this.float32[le+9]=P,this.float32[le+10]=B,this.float32[le+11]=N,this.float32[le+12]=U,this.float32[le+13]=j,this.float32[le+14]=K,this.float32[le+15]=ee,o}}su.prototype.bytesPerElement=64,Ut(su,"StructArrayLayout16f64");class Ed extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,p,_,y,A){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,d,p,_,y,A)}emplace(o,l,d,p,_,y,A,S){const I=10*o,R=5*o;return this.uint16[I+0]=l,this.uint16[I+1]=d,this.uint16[I+2]=p,this.uint16[I+3]=_,this.float32[R+2]=y,this.float32[R+3]=A,this.float32[R+4]=S,o}}Ed.prototype.bytesPerElement=20,Ut(Ed,"StructArrayLayout4ui3f20");class o_ extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.int16[1*o+0]=l,o}}o_.prototype.bytesPerElement=2,Ut(o_,"StructArrayLayout1i2");class Pp extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint8[1*o+0]=l,o}}Pp.prototype.bytesPerElement=1,Ut(Pp,"StructArrayLayout1ub1");class Sb extends wd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Sb.prototype.size=40;class Dp extends e_{get(o){return new Sb(this,o)}}Ut(Dp,"CollisionBoxArray");class Eb extends wd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}Eb.prototype.size=60;class Cb extends i_{get(o){return new Eb(this,o)}}Ut(Cb,"PlacedSymbolArray");class Ib extends wd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Ib.prototype.size=80;class Mb extends n_{get(o){return new Ib(this,o)}}Ut(Mb,"SymbolInstanceArray");class a_ extends iu{getoffsetX(o){return this.float32[1*o+0]}}Ut(a_,"GlyphOffsetArray");class Rb extends Al{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Ut(Rb,"SymbolLineVertexArray");class kb extends wd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kb.prototype.size=12;class Pb extends s_{get(o){return new kb(this,o)}}Ut(Pb,"FeatureIndexArray");class Db extends dc{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Ut(Db,"FillExtrusionCentroidArray");class Bb extends wd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Bb.prototype.size=6;class Ob extends Cp{get(o){return new Bb(this,o)}}Ut(Ob,"FillExtrusionWallArray");const aA=tn([{name:"a_pos",components:2,type:"Int16"}],4),lA=tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Gn{constructor(o=[]){this.segments=o}_prepareSegment(o,l,d,p){let _=this.segments[this.segments.length-1];return o>Gn.MAX_VERTEX_ARRAY_LENGTH&&Bi(`Max vertices per segment is ${Gn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!_||_.vertexLength+o>Gn.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:l,primitiveOffset:d,vertexLength:0,primitiveLength:0},p!==void 0&&(_.sortKey=p),this.segments.push(_)),_}prepareSegment(o,l,d,p){return this._prepareSegment(o,l.length,d.length,p)}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,d,p){return new Gn([{vertexOffset:o,primitiveOffset:l,vertexLength:d,primitiveLength:p,vaos:{},sortKey:0}])}}function Fb(h,o){return 256*(h=De(Math.floor(h),0,255))+De(Math.floor(o),0,255)}Gn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut(Gn,"SegmentVector");const cA=tn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ou=tn([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),hA=tn([{name:"a_dash",components:4,type:"Uint16"}]);class au{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,l,d,p){this.ids.push(Lb(o)),this.positions.push(l,d,p)}eachPosition(o,l){const d=Lb(o);let p=0,_=this.ids.length-1;for(;p<_;){const y=p+_>>1;this.ids[y]>=d?_=y:p=y+1}for(;this.ids[p]===d;)l(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(o,l){const d=new Float64Array(o.ids),p=new Uint32Array(o.positions);return Bp(d,p,0,d.length-1),l&&(l.add(d.buffer),l.add(p.buffer)),{ids:d,positions:p}}static deserialize(o){const l=new au;let d;l.ids=o.ids,l.positions=o.positions;for(const p of l.ids)p!==d&&l.uniqueIds.push(p),d=p;return l.indexed=!0,l}}function Lb(h){const o=+h;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:yo(String(h))}function Bp(h,o,l,d){for(;l<d;){const p=h[l+d>>1];let _=l-1,y=d+1;for(;;){do _++;while(h[_]<p);do y--;while(h[y]>p);if(_>=y)break;Cd(h,_,y),Cd(o,3*_,3*y),Cd(o,3*_+1,3*y+1),Cd(o,3*_+2,3*y+2)}y-l<d-y?(Bp(h,o,l,y),l=y+1):(Bp(h,o,y+1,d),d=y)}}function Cd(h,o,l){const d=h[o];h[o]=h[l],h[l]=d}Ut(au,"FeaturePositionMap");class Ja{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}set(o,l,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Op extends Ja{constructor(o){super(o),this.current=0}set(o,l,d){this.fetchUniformLocation(o,l)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class Ar extends Ja{constructor(o){super(o),this.current=0}set(o,l,d){this.fetchUniformLocation(o,l)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class ya extends Ja{constructor(o){super(o),this.current=[0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class Id extends Ja{constructor(o){super(o),this.current=[0,0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class Fp extends Ja{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class zb extends Ja{constructor(o){super(o),this.current=rn.transparent.toRenderColor(null)}set(o,l,d){this.fetchUniformLocation(o,l)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const uA=new Float32Array(16);class Md extends Ja{constructor(o){super(o),this.current=uA}set(o,l,d){if(this.fetchUniformLocation(o,l)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let p=1;p<16;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const Nb=new Float32Array(9),l_=new Float32Array(4);class Yo extends Ja{constructor(o){super(o),this.current=l_}set(o,l,d){if(this.fetchUniformLocation(o,l)){for(let p=0;p<4;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function Rd(h){return[Fb(255*h.r,255*h.g),Fb(255*h.b,255*h.a)]}class kd{constructor(o,l,d,p){this.value=o,this.uniformNames=l.map(_=>`u_${_}`),this.type=d,this.context=p}setUniform(o,l,d,p,_){const y=p.constantOr(this.value);l.set(o,_,y instanceof rn?y.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(o,l){return this.type==="color"?new zb(o):new Ar(o)}}class lu{constructor(o,l){this.uniformNames=l.map(d=>`u_${d}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(o,l){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br),this.patternTransition=l?l.tl.concat(l.br):this.pattern}setUniform(o,l,d,p,_){let y=null;_!=="u_pattern"&&_!=="u_dash"||(y=this.pattern),_==="u_pattern_b"&&(y=this.patternTransition),_==="u_pixel_ratio"&&(y=this.pixelRatio),y&&l.set(o,_,y)}getBinding(o,l){return l==="u_pattern"||l==="u_pattern_b"||l==="u_dash"?new Fp(o):new Ar(o)}}class Sl{constructor(o,l,d,p){this.expression=o,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(o,l,d,p,_,y,A){const S=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new pn(0,{brightness:y}),l,{},_,p,A):this.expression.kind==="constant"&&this.expression.value,R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new pn(0,{brightness:y}),l,{},_,p,A):this.lutExpression.value)==="none";this.paintVertexArray.resize(o),this._setPaintValue(S,o,I,R?null:this.context.lut)}updatePaintArray(o,l,d,p,_,y,A){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:A},d,p,void 0,_):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new pn(0,{brightness:A}),d,p,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(o,l,S,I?null:this.context.lut)}_setPaintValue(o,l,d,p){if(this.type==="color"){const _=Rd(d.toRenderColor(p));for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,_[0],_[1])}else{for(let _=o;_<l;_++)this.paintVertexArray.emplace(_,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ba{constructor(o,l,d,p,_,y){this.expression=o,this.uniformNames=l.map(A=>`u_${A}_t`),this.type=d,this.useIntegerZoom=p,this.context=_,this.maxValue=0,this.paintVertexAttributes=l.map(A=>({name:`a_${A}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(o,l,d,p,_,y,A){const S=this.expression.evaluate(new pn(this.context.zoom,{brightness:y}),l,{},_,p,A),I=this.expression.evaluate(new pn(this.context.zoom+1,{brightness:y}),l,{},_,p,A),R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new pn(0,{brightness:y}),l,{},_,p,A):this.lutExpression.value)==="none",P=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(P,o,S,I,R?null:this.context.lut)}updatePaintArray(o,l,d,p,_,y,A){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:A},d,p,void 0,_),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:A},d,p,void 0,_),R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new pn(0,{brightness:A}),d,p,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(o,l,S,I,R?null:this.context.lut)}_setPaintValue(o,l,d,p,_){if(this.type==="color"){const y=Rd(d.toRenderColor(_)),A=Rd(d.toRenderColor(_));for(let S=o;S<l;S++)this.paintVertexArray.emplace(S,y[0],y[1],A[0],A[1])}else{for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,d,p);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,d,p,_){const y=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,A=De(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);l.set(o,_,A)}getBinding(o,l){return new Ar(o)}}class va{constructor(o,l,d,p,_){this.expression=o,this.layerId=_,this.paintVertexAttributes=(d==="array"?hA:cA).members;for(let y=0;y<l.length;++y);this.paintVertexArray=new p,this.paintTransitionVertexArray=new Tl}populatePaintArray(o,l,d,p){const _=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(_,o,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(o,l,d,p,_,y,A){this._setPaintValues(o,l,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(o,l,d,p){if(!p||!d)return;const _=p[d[0]],y=p[d[1]];if(_){if(_){const{tl:A,br:S,pixelRatio:I}=_;for(let R=o;R<l;R++)this.paintVertexArray.emplace(R,A[0],A[1],S[0],S[1],I)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:A,br:S,pixelRatio:I}=y;for(let R=o;R<l;R++)this.paintTransitionVertexArray.emplace(R,A[0],A[1],S[0],S[1],I)}}}upload(o){const l=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,l)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=o.createVertexBuffer(this.paintTransitionVertexArray,ou.members,l))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class pc{constructor(o,l,d=()=>!0){this.binders={},this._buffers=[],this.context=l;const p=[];for(const _ in o.paint._values){const y=o.paint.get(_);if(_.endsWith("-use-theme")||!d(_)||!(y instanceof eu&&pp(y.property.specification)))continue;const A=a(_,o.type),S=y.value,I=y.property.specification.type,R=!!y.property.useIntegerZoom,P=_==="line-dasharray"||_.endsWith("pattern"),B=o.paint.get(`${_}-use-theme`),N=_==="line-dasharray"&&o.layout.get("line-cap").value.kind!=="constant"||B&&B.value.kind!=="constant";if(S.kind!=="constant"||N)if(S.kind==="source"||N||P){const U=v(_,I,"source");this.binders[_]=P?new va(S,A,I,U,o.id):new Sl(S,A,I,U),p.push(`/a_${_}`)}else{const U=v(_,I,"composite");this.binders[_]=new ba(S,A,I,R,l,U),p.push(`/z_${_}`)}else this.binders[_]=P?new lu(S.value,A):new kd(S.value,A,I,l),p.push(`/u_${_}`);B&&(this.binders[_].lutExpression=B.value)}this.cacheKey=p.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof Sl||l instanceof ba?l.maxValue:0}populatePaintArrays(o,l,d,p,_,y,A){for(const S in this.binders){const I=this.binders[S];I.context=this.context,(I instanceof Sl||I instanceof ba||I instanceof va)&&I.populatePaintArray(o,l,d,p,_,y,A)}}setConstantPatternPositions(o,l){for(const d in this.binders){const p=this.binders[d];p instanceof lu&&p.setConstantPatternPositions(o,l)}}getPatternTransitionVertexBuffer(o){const l=this.binders[o];return l instanceof va?l.paintTransitionVertexBuffer:null}updatePaintArrays(o,l,d,p,_,y,A,S,I){let R=!1;const P=Object.keys(o),B=P.length!==0&&!S,N=B?P:l.uniqueIds;this.context.lut=_.lut;for(const U in this.binders){const j=this.binders[U];if(j.context=this.context,(j instanceof Sl||j instanceof ba||j instanceof va)&&j.expression&&j.expression.kind&&j.expression.kind!=="constant"&&(j.expression.isStateDependent===!0||j.expression.isLightConstant===!1)){const K=_.paint.get(U);j.expression=K.value;for(const ee of N){const le=o[ee.toString()];l.eachPosition(ee,(re,G,ie)=>{const ae=p.feature(re);j.updatePaintArray(G,ie,ae,le,y,A,I)})}if(!B)for(const ee of d.uniqueIds){const le=o[ee.toString()];d.eachPosition(ee,(re,G,ie)=>{const ae=p.feature(re);j.updatePaintArray(G,ie,ae,le,y,A,I)})}R=!0}}return R}defines(){const o=[];for(const l in this.binders){const d=this.binders[l];(d instanceof kd||d instanceof lu)&&o.push(...d.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Sl||d instanceof ba||d instanceof va)for(let p=0;p<d.paintVertexAttributes.length;p++)o.push(d.paintVertexAttributes[p].name);if(d instanceof va)for(let p=0;p<ou.members.length;p++)o.push(ou.members[p].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof kd||d instanceof lu||d instanceof ba)for(const p of d.uniformNames)o.push(p)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof kd||p instanceof lu||p instanceof ba)for(const _ of p.uniformNames)l.push({name:_,property:d,binding:p.getBinding(o,_)})}return l}setUniforms(o,l,d,p,_){for(const{name:y,property:A,binding:S}of d)this.binders[A].setUniform(o,S,_,p.get(A),y)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Sl||l instanceof ba||l instanceof va)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer),l instanceof va&&l.paintTransitionVertexBuffer&&this._buffers.push(l.paintTransitionVertexBuffer)}}upload(o){for(const l in this.binders){const d=this.binders[l];(d instanceof Sl||d instanceof ba||d instanceof va)&&d.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof Sl||l instanceof ba||l instanceof va)&&l.destroy()}}}class hh{constructor(o,l,d=()=>!0){this.programConfigurations={};for(const p of o)this.programConfigurations[p.id]=new pc(p,l,d);this.needsUpload=!1,this._featureMap=new au,this._featureMapWithoutIds=new au,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,l,d,p,_,y,A,S){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(o,l,p,_,y,A,S);l.id!==void 0?this._featureMap.add(l.id,d,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,d,p,_,y,A){for(const S of d)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,l,S,p,_,y,A||0)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const m={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function a(h,o){return m[h]||[h.replace(`${o}-`,"").replace(/-/g,"_")]}const u={"line-pattern":{source:Tl,composite:Tl},"fill-pattern":{source:Tl,composite:Tl},"fill-extrusion-pattern":{source:Tl,composite:Tl},"line-dasharray":{source:Mp,composite:Mp}},g={color:{source:ch,composite:Ka},number:{source:iu,composite:ch}};function v(h,o,l){const d=u[h];return d&&d[l]||g[o][l]}Ut(kd,"ConstantBinder"),Ut(lu,"PatternConstantBinder"),Ut(Sl,"SourceExpressionBinder"),Ut(va,"PatternCompositeBinder"),Ut(ba,"CompositeExpressionBinder"),Ut(pc,"ProgramConfiguration",{omit:["_buffers"]}),Ut(hh,"ProgramConfigurationSet");const x=Dt/Math.PI/2,T=5,C=6,M=16383,D=64,O=[D,32,16],z=-x,L=x;function V(h,o,l,d=x){return l=H(l),[h*Math.sin(l)*d,-o*d,h*Math.cos(l)*d]}function Y(h,o,l){return V(Math.cos(H(h)),Math.sin(H(h)),o,l)}const q=63710088e-1,Q=2*Math.PI*q;class Z{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Z(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,d=this.lat*l,p=o.lat*l,_=Math.sin(d)*Math.sin(p)+Math.cos(d)*Math.cos(p)*Math.cos((o.lng-this.lng)*l);return q*Math.acos(Math.min(_,1))}toBounds(o=0){const l=360*o/40075017,d=l/Math.cos(Math.PI/180*this.lat);return new se({lng:this.lng-d,lat:this.lat-l},{lng:this.lng+d,lat:this.lat+l})}toEcef(o){return Y(this.lat,this.lng,x+o*x/q)}static convert(o){if(o instanceof Z)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Z(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Z(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class se{constructor(o,l){if(o)if(l)this.setSouthWest(o).setNorthEast(l);else if(o.length===4){const d=o;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{const d=o;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(o){return this._ne=o instanceof Z?new Z(o.lng,o.lat):Z.convert(o),this}setSouthWest(o){return this._sw=o instanceof Z?new Z(o.lng,o.lat):Z.convert(o),this}extend(o){const l=this._sw,d=this._ne;let p,_;if(o instanceof Z)p=o,_=o;else{if(!(o instanceof se))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(se.convert(o)):this.extend(Z.convert(o)):typeof o=="object"&&o!==null&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Z.convert(o)):this;if(p=o._sw,_=o._ne,!p||!_)return this}return l||d?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),d.lng=Math.max(_.lng,d.lng),d.lat=Math.max(_.lat,d.lat)):(this._sw=new Z(p.lng,p.lat),this._ne=new Z(_.lng,_.lat)),this}getCenter(){return new Z((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Z(this.getWest(),this.getNorth())}getSouthEast(){return new Z(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:d}=Z.convert(o);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(o){if(o)return o instanceof se?o:new se(o)}}const de=0,me=25.5;function Se(h){return Q*Math.cos(h*Math.PI/180)}function ve(h){return(180+h)/360}function xe(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function ge(h,o){return h/Se(o)}function Ie(h){return 360*h-180}function Re(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function Xe(h,o){return h*Se(Re(o))}const je=85.051129;function lt(h){return Math.cos(H(De(h,-85.051129,je)))}function it(h,o){const l=De(o,de,me),d=Math.pow(2,l);return lt(h)*Q/(512*d)}function Ct(h){return 1/Math.cos(h*Math.PI/180)}function $e(h,o=0){const l=Math.exp(Math.PI*(1-(h.y+o/Dt)/(1<<h.z)*2));return 80150034*l/(l*l+1)/Dt/(1<<h.z)}class qe{constructor(o,l,d=0){this.x=+o,this.y=+l,this.z=+d}static fromLngLat(o,l=0){const d=Z.convert(o);return new qe(ve(d.lng),xe(d.lat),ge(l,d.lat))}toLngLat(){return new Z(Ie(this.x),Re(this.y))}toAltitude(){return Xe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Q*Ct(Re(this.y))}}function Ue(h,o,l,d,p,_,y,A,S){const I=(o+d)/2,R=(l+p)/2,P=new ue(I,R);A(P),function(B,N,U,j,K,ee){const le=U-K,re=j-ee;return Math.abs((j-N)*le-(U-B)*re)/Math.hypot(le,re)}(P.x,P.y,_.x,_.y,y.x,y.y)>=S?(Ue(h,o,l,I,R,_,P,A,S),Ue(h,I,R,d,p,P,y,A,S)):h.push(y)}function ut(h,o,l){let d=h[0],p=d.x,_=d.y;o(d);const y=[d];for(let A=1;A<h.length;A++){const S=h[A],{x:I,y:R}=S;o(S),Ue(y,p,_,I,R,d,S,o,l),p=I,_=R,d=S}return y}function Ze(h,o,l,d){if(d(o,l)){const p=o.add(l)._mult(.5);Ze(h,o,p,d),Ze(h,p,l,d)}else h.push(l)}function gt(h,o){let l=h[0];const d=[l];for(let p=1;p<h.length;p++){const _=h[p];Ze(d,l,_,o),l=_}return d}const ct=Math.pow(2,14)-1,yt=-ct-1;function vt(h,o){const l=Math.round(h.x*o),d=Math.round(h.y*o);return h.x=De(l,yt,ct),h.y=De(d,yt,ct),(l<h.x||l>h.x+1||d<h.y||d>h.y+1)&&Bi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),h}function jt(h,o,l){const d=h.loadGeometry(),p=h.extent,_=Dt/p;if(o&&l&&l.projection.isReprojectedInTileSpace){const y=1<<o.z,{scale:A,x:S,y:I,projection:R}=l,P=B=>{const N=Ie((o.x+B.x/p)/y),U=Re((o.y+B.y/p)/y),j=R.project(N,U);B.x=(j.x*A-S)*p,B.y=(j.y*A-I)*p};for(let B=0;B<d.length;B++)if(h.type!==1)d[B]=ut(d[B],P,1);else{const N=[];for(const U of d[B])U.x<0||U.x>=p||U.y<0||U.y>=p||(P(U),N.push(U));d[B]=N}}for(const y of d)for(const A of y)vt(A,_);return d}function Jt(h,o){return{type:h.type,id:h.id,properties:h.properties,geometry:o?jt(h):[]}}function Vt(h,o,l,d,p){h.emplaceBack(2*o+(d+1)/2,2*l+(p+1)/2)}function Qt(h,o,l){h.emplaceBack(o.x,o.y,o.z,l[0]*16384,l[1]*16384,l[2]*16384)}class Gt{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Al,this.indexArray=new qr,this.segments=new Gn,this.programConfigurations=new hh(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}updateFootprints(o,l){}populate(o,l,d,p){const _=this.layers[0],y=[];let A=null;_.type==="circle"&&(A=_.layout.get("circle-sort-key"));for(const{feature:I,id:R,index:P,sourceLayerIndex:B}of o){const N=this.layers[0]._featureFilter.needGeometry,U=Jt(I,N);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),U,d))continue;const j=A?A.evaluate(U,{},d):void 0,K={id:R,properties:I.properties,type:I.type,sourceLayerIndex:B,index:P,geometry:N?U.geometry:jt(I,d,p),patterns:{},sortKey:j};y.push(K)}A&&y.sort((I,R)=>I.sortKey-R.sortKey);let S=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new lh,S=p.projection);for(const I of y){const{geometry:R,index:P,sourceLayerIndex:B}=I,N=o[P].feature;this.addFeature(I,R,P,l.availableImages,d,S,l.brightness),l.featureIndex.insert(N,R,P,B,this.index)}}update(o,l,d,p,_,y,A){this.programConfigurations.updatePaintArrays(o,l,_,d,p,y,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,aA.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,lA.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,d,p,_,y,A){for(const S of l)for(const I of S){const R=I.x,P=I.y;if(R<0||R>=Dt||P<0||P>=Dt)continue;if(y){const U=y.projectTilePoint(R,P,_),j=y.upVector(_,R,P),K=this.globeExtVertexArray;Qt(K,U,j),Qt(K,U,j),Qt(K,U,j),Qt(K,U,j)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),N=B.vertexLength;Vt(this.layoutVertexArray,R,P,-1,-1),Vt(this.layoutVertexArray,R,P,1,-1),Vt(this.layoutVertexArray,R,P,1,1),Vt(this.layoutVertexArray,R,P,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+2,N+3),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,{},p,_,A)}}function ai(h,o){for(let l=0;l<h.length;l++)if(gn(o,h[l]))return!0;for(let l=0;l<o.length;l++)if(gn(h,o[l]))return!0;return!!un(h,o)}function mi(h,o,l){return!!gn(h,o)||!!wi(o,h,l)}function Oi(h,o){if(h.length===1)return Ji(o,h[0]);for(let l=0;l<o.length;l++){const d=o[l];for(let p=0;p<d.length;p++)if(gn(h,d[p]))return!0}for(let l=0;l<h.length;l++)if(Ji(o,h[l]))return!0;for(let l=0;l<o.length;l++)if(un(h,o[l]))return!0;return!1}function mn(h,o,l){if(h.length>1){if(un(h,o))return!0;for(let d=0;d<o.length;d++)if(wi(o[d],h,l))return!0}for(let d=0;d<h.length;d++)if(wi(h[d],o,l))return!0;return!1}function un(h,o){if(h.length===0||o.length===0)return!1;for(let l=0;l<h.length-1;l++){const d=h[l],p=h[l+1];for(let _=0;_<o.length-1;_++)if(zi(d,p,o[_],o[_+1]))return!0}return!1}function zi(h,o,l,d){return yn(h,l,d)!==yn(o,l,d)&&yn(h,o,l)!==yn(h,o,d)}function tr(h,o,l){return(h.x-l.x)*(o.y-l.y)-(h.y-l.y)*(o.x-l.x)}function Wn(h,o,l,d){const p=tr(h,o,d),_=tr(h,o,l);if(Math.sign(p)===Math.sign(_))return;const y=tr(l,d,h),A=y+_-p;return Math.sign(y)!==Math.sign(A)?[y/(y-A),_/(_-p)]:void 0}function wi(h,o,l){const d=l*l;if(o.length===1)return h.distSqr(o[0])<d;for(let p=1;p<o.length;p++)if($i(h,o[p-1],o[p])<d)return!0;return!1}function $i(h,o,l){const d=o.distSqr(l);if(d===0)return h.distSqr(o);const p=((h.x-o.x)*(l.x-o.x)+(h.y-o.y)*(l.y-o.y))/d;return h.distSqr(p<0?o:p>1?l:l.sub(o)._mult(p)._add(o))}function Ji(h,o){let l,d,p,_=!1;for(let y=0;y<h.length;y++){l=h[y];for(let A=0,S=l.length-1;A<l.length;S=A++)d=l[A],p=l[S],d.y>o.y!=p.y>o.y&&o.x<(p.x-d.x)*(o.y-d.y)/(p.y-d.y)+d.x&&(_=!_)}return _}function gn(h,o){let l=!1;for(let d=0,p=h.length-1;d<h.length;p=d++){const _=h[d],y=h[p];_.y>o.y!=y.y>o.y&&o.x<(y.x-_.x)*(o.y-_.y)/(y.y-_.y)+_.x&&(l=!l)}return l}function Cr(h,o,l,d,p){for(const y of h)if(o<=y.x&&l<=y.y&&d>=y.x&&p>=y.y)return!0;const _=[new ue(o,l),new ue(o,p),new ue(d,p),new ue(d,l)];if(h.length>2){for(const y of _)if(gn(h,y))return!0}for(let y=0;y<h.length-1;y++)if(ar(h[y],h[y+1],_))return!0;return!1}function ar(h,o,l){const d=l[0],p=l[2];if(h.x<d.x&&o.x<d.x||h.x>p.x&&o.x>p.x||h.y<d.y&&o.y<d.y||h.y>p.y&&o.y>p.y)return!1;const _=yn(h,o,l[0]);return _!==yn(h,o,l[1])||_!==yn(h,o,l[2])||_!==yn(h,o,l[3])}function Tr(h,o,l,d,p,_){let y=o.y-h.y,A=h.x-o.x;if(_=_||0){const S=y*y+A*A;if(S===0)return!0;const I=Math.sqrt(S);y/=I,A/=I}return!((l.x-h.x)*y+(l.y-h.y)*A-_<0||(d.x-h.x)*y+(d.y-h.y)*A-_<0||(p.x-h.x)*y+(p.y-h.y)*A-_<0)}function Vn(h,o,l,d,p,_,y){return!(Tr(h,o,d,p,_,y)||Tr(o,l,d,p,_,y)||Tr(l,h,d,p,_,y)||Tr(d,p,h,o,l,y)||Tr(p,_,h,o,l,y)||Tr(_,d,h,o,l,y))}function Ei(h,o,l){const d=o.paint.get(h).value;return d.kind==="constant"?d.value:l.programConfigurations.get(o.id).getMaxValue(h)}function Fn(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function Yi(h,o,l,d,p){if(!o[0]&&!o[1])return h;const _=ue.convert(o)._mult(p);l==="viewport"&&_._rotate(-d);const y=[];for(let A=0;A<h.length;A++)y.push(h[A].sub(_));return y}function Ln(h,o,l,d){const p=ue.convert(h)._mult(d);return o==="viewport"&&p._rotate(-l),p}let sn,$n;function Yr(h,o,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[h*d-2*Math.PI*6378137/2,o*d-2*Math.PI*6378137/2]}Ut(Gt,"CircleBucket",{omit:["layers"]});class Mn{constructor(o,l,d){this.z=o,this.x=l,this.y=d,this.key=hs(0,o,o,l,d)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const d=function(_,y,A){var S=Yr(256*_,256*(y=Math.pow(2,A)-y-1),A),I=Yr(256*(_+1),256*(y+1),A);return S[0]+","+S[1]+","+I[0]+","+I[1]}(this.x,this.y,this.z),p=function(_,y,A){let S,I="";for(let R=_;R>0;R--)S=1<<R-1,I+=(y&S?1:0)+(A&S?2:0);return I}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qr{constructor(o,l){this.wrap=o,this.canonical=l,this.key=hs(o,l.z,l.z,l.x,l.y)}}class xr{constructor(o,l,d,p,_){this.overscaledZ=o,this.wrap=l,this.canonical=new Mn(d,+p,+_),this.key=l===0&&o===d?this.canonical.key:hs(l,o,d,p,_)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new xr(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xr(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return hs(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-o;return hs(this.wrap*+l,o,o,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new xr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,p=2*this.canonical.y;return[new xr(l,this.wrap,l,d,p),new xr(l,this.wrap,l,d+1,p),new xr(l,this.wrap,l,d,p+1),new xr(l,this.wrap,l,d+1,p+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new xr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new xr(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function hs(h,o,l,d,p){const _=1<<Math.min(l,22);let y=_*(p%_)+d%_;return h&&l<22&&(y+=_*_*((h<0?-2*h-1:2*h)%(1<<2*(22-l)))),16*(32*y+l)+(o-l)}const xa=[h=>{let o=h.canonical.x-1,l=h.wrap;return o<0&&(o=(1<<h.canonical.z)-1,l--),new xr(h.overscaledZ,l,h.canonical.z,o,h.canonical.y)},h=>{let o=h.canonical.x+1,l=h.wrap;return o===1<<h.canonical.z&&(o=0,l++),new xr(h.overscaledZ,l,h.canonical.z,o,h.canonical.y)},h=>new xr(h.overscaledZ,h.wrap,h.canonical.z,h.canonical.x,(h.canonical.y===0?1<<h.canonical.z:h.canonical.y)-1),h=>new xr(h.overscaledZ,h.wrap,h.canonical.z,h.canonical.x,h.canonical.y===(1<<h.canonical.z)-1?0:h.canonical.y+1)];Ut(Mn,"CanonicalTileID"),Ut(xr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const El=tn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:xo}=El,Zo=tn([{name:"a_pos_3",components:3,type:"Int16"}]);var Qa=tn([{name:"a_pos",type:"Int16",components:2}]);class el{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,d){const p=On(l,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1])/p;return d[0]=this.pos[0]+this.dir[0]*_,d[1]=this.pos[1]+this.dir[1]*_,!0}}class wa{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,d){const p=cn(l,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/p;return d[0]=this.pos[0]+this.dir[0]*_,d[1]=this.pos[1]+this.dir[1]*_,d[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(o,l,d){if(function(N,U){var j=N[0],K=N[1],ee=N[2],le=U[0],re=U[1],G=U[2];return Math.abs(j-le)<=b*Math.max(1,Math.abs(j),Math.abs(le))&&Math.abs(K-re)<=b*Math.max(1,Math.abs(K),Math.abs(re))&&Math.abs(ee-G)<=b*Math.max(1,Math.abs(ee),Math.abs(G))}(this.pos,o)||l===0)return d[0]=d[1]=d[2]=0,!1;const[p,_,y]=this.dir,A=this.pos[0]-o[0],S=this.pos[1]-o[1],I=this.pos[2]-o[2],R=p*p+_*_+y*y,P=2*(A*p+S*_+I*y),B=P*P-4*R*(A*A+S*S+I*I-l*l);if(B<0){const N=Math.max(-P/2,0),U=A+p*N,j=S+_*N,K=I+y*N,ee=Math.hypot(U,j,K);return d[0]=U*l/ee,d[1]=j*l/ee,d[2]=K*l/ee,!1}{const N=(-P-Math.sqrt(B))/(2*R);if(N<0){const U=Math.hypot(A,S,I);return d[0]=A*l/U,d[1]=S*l/U,d[2]=I*l/U,!1}return d[0]=A+p*N,d[1]=S+_*N,d[2]=I+y*N,!0}}}class cu{constructor(o,l,d,p,_){this.TL=o,this.TR=l,this.BR=d,this.BL=p,this.horizon=_}static fromInvProjectionMatrix(o,l,d){const p=[-1,1,1],_=[1,1,1],y=[1,-1,1],A=[-1,-1,1],S=jn(p,p,o),I=jn(_,_,o),R=jn(y,y,o),P=jn(A,A,o);return new cu(S,I,R,P,l/d)}}function uh(h,o,l){let d=1/0,p=-1/0;const _=[];for(const y of h){sr(_,y,o);const A=cn(_,l);d=Math.min(d,A),p=Math.max(p,A)}return[d,p]}function Lp(h,o){let l=!0;for(let d=0;d<h.planes.length;d++){const p=h.planes[d];let _=0;for(let y=0;y<o.length;y++)_+=cn(p,o[y])+p[3]>=0;if(_===0)return 0;_!==o.length&&(l=!1)}return l?2:1}function zp(h,o){for(const l of h.projections){const d=uh(o,h.points[0],l.axis);if(l.projection[1]<d[0]||l.projection[0]>d[1])return 0}return 1}function Np(h,o){let l=0;const d=[0,0,0,0];for(let y=0;y<h.length;y++)d[0]=h[y][0],d[1]=h[y][1],d[2]=h[y][2],d[3]=1,(p=d)[0]*(_=o)[0]+p[1]*_[1]+p[2]*_[2]+p[3]*_[3]>=0&&l++;var p,_;return l}class Pd{constructor(o,l){this.points=o||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=zn.fromPoints(this.points),this.projections=[],this.frustumEdges=[sr([],this.points[2],this.points[3]),sr([],this.points[0],this.points[3]),sr([],this.points[4],this.points[0]),sr([],this.points[5],this.points[1]),sr([],this.points[6],this.points[2]),sr([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const p=[0,-d[2],d[1]],_=[d[2],0,-d[0]];this.projections.push({axis:p,projection:uh(this.points,this.points[0],p)}),this.projections.push({axis:_,projection:uh(this.points,this.points[0],_)})}}static fromInvProjectionMatrix(o,l,d,p){const _=Math.pow(2,d),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const R=ls([],I,o),P=1/R[3]/l*_;return(B=R)[0]=(N=R)[0]*(U=[P,P,p?1/R[3]:P,P])[0],B[1]=N[1]*U[1],B[2]=N[2]*U[2],B[3]=N[3]*U[3],B;var B,N,U}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const R=on([],rr([],sr([],y[I[0]],y[I[1]]),sr([],y[I[2]],y[I[1]]))),P=-cn(R,y[I[1]]);return R.concat(P)}),S=[];for(let I=0;I<y.length;I++)S.push([y[I][0],y[I][1],y[I][2]]);return new Pd(S,A)}intersectsPrecise(o,l,d){for(let p=0;p<l.length;p++)if(!Np(o,l[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!Np(o,this.planes[p]))return 0;for(const p of d)for(const _ of this.frustumEdges){const y=rr([],p,_),A=bi(y);if(A===0)continue;Qi(y,y,1/A);const S=uh(this.points,this.points[0],y),I=uh(o,this.points[0],y);if(S[0]>I[1]||I[0]>S[1])return 0}return 1}containsPoint(o){for(const l of this.planes){const d=l[3];if(cn([l[0],l[1],l[2]],o)+d<0)return!1}return!0}}class zn{static fromPoints(o){const l=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const p of o)nr(l,l,p),vr(d,d,p);return new zn(l,d)}static fromTileIdAndHeight(o,l,d){const p=1<<o.canonical.z,_=o.canonical.x,y=o.canonical.y;return new zn([_/p,y/p,l],[(_+1)/p,(y+1)/p,d])}static applyTransform(o,l){const d=o.getCorners();for(let p=0;p<d.length;++p)jn(d[p],d[p],l);return zn.fromPoints(d)}static applyTransformFast(o,l){const d=[l[12],l[13],l[14]],p=[...d];for(let _=0;_<3;_++)for(let y=0;y<3;y++){const A=l[4*y+_],S=A*o.min[y],I=A*o.max[y];d[_]+=Math.min(S,I),p[_]+=Math.max(S,I)}return new zn(d,p)}static projectAabbCorners(o,l){const d=o.getCorners();for(let p=0;p<d.length;++p)jn(d[p],d[p],l);return d}constructor(o,l){this.min=o,this.max=l,this.center=Qi([],vi([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],d=si(this.min),p=si(this.max);for(let _=0;_<l.length;_++)d[_]=l[_]?this.min[_]:this.center[_],p[_]=l[_]?this.center[_]:this.max[_];return p[2]=this.max[2],new zn(d,p)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?Lp(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?Lp(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,l){return l||this.intersects(o)?zp(o,this.getCorners()):0}intersectsPreciseFlat(o,l){return l||this.intersectsFlat(o)?zp(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let l=0;l<3;++l)if(this.min[l]>o.max[l]||o.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o.min[l]),this.max[l]=Math.max(this.max[l],o.max[l])}encapsulatePoint(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o[l]),this.max[l]=Math.max(this.max[l],o[l])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}function hu(h){return h*x/q}Ut(zn,"Aabb");const c_=[new zn([z,z,z],[L,L,L]),new zn([z,z,z],[0,0,L]),new zn([0,z,z],[L,0,L]),new zn([z,0,z],[0,L,L]),new zn([0,0,z],[L,L,L])];function nI(h,o,l,d=!0){const p=Qi([],h._camera.position,h.worldSize),_=[o,l,1,1];ls(_,_,h.pixelMatrixInverse),Vo(_,_,1/_[3]);const y=on([],sr([],_,p)),A=h.globeMatrix,S=[A[12],A[13],A[14]],I=sr([],S,p),R=bi(I),P=on([],I),B=h.worldSize/(2*Math.PI),N=cn(P,y),U=Math.asin(B/R);if(U<Math.acos(N)){if(!d)return null;const Fe=[],Ve=[];Qi(Fe,y,R/N),on(Ve,sr(Ve,Fe,I)),on(y,vi(y,I,Qi(y,Ve,Math.tan(U)*R)))}const j=[];new wa(p,y).closestPointOnSphere(S,B,j);const K=on([],Xr(A,0)),ee=on([],Xr(A,1)),le=on([],Xr(A,2)),re=cn(K,j),G=cn(ee,j),ie=cn(le,j),ae=te(Math.asin(-G/B));let fe=te(Math.atan2(re,ie));fe=h.center.lng+function(Fe,Ve){const et=(Ve-Fe+180)%360-180;return et<-180?et+360:et}(h.center.lng,fe);const Ce=ve(fe),Be=De(xe(ae),0,1);return new qe(Ce,Be)}class xN{constructor(o,l,d){this.a=sr([],o,d),this.b=sr([],l,d),this.center=d;const p=on([],this.a),_=on([],this.b);this.angle=Math.acos(cn(p,_))}}function dA(h,o){if(h.angle===0)return null;let l;return l=h.a[o]===0?1/h.angle*.5*Math.PI:1/h.angle*Math.atan(h.b[o]/h.a[o]/Math.sin(h.angle)-1/Math.tan(h.angle)),l<0||l>1?null:function(d,p,_,y){const A=Math.sin(_);return d*(Math.sin((1-y)*_)/A)+p*(Math.sin(y*_)/A)}(h.a[o],h.b[o],h.angle,De(l,0,1))+h.center[o]}function mc(h){if(h.z<=1)return c_[h.z+2*h.y+h.x];const o=fA(Ub(h));return zn.fromPoints(o)}function dh(h,o,l){return Qi(h,h,1-l),Gr(h,h,o,l)}function rI(h,o,l){for(const d of h)jn(d,d,o),Qi(d,d,l)}function sI(h,o,l,d){const p=o/h.worldSize,_=h.globeMatrix;if(l.z<=1){const Be=mc(l).getCorners();return rI(Be,_,p),zn.fromPoints(Be)}const y=Ub(l,d),A=fA(y,x+hu(h._tileCoverLift));rI(A,_,p);const S=Number.MAX_VALUE,I=[-S,-S,-S],R=[S,S,S];if(y.contains(h.center)){for(const Ve of A)nr(R,R,Ve),vr(I,I,Ve);I[2]=0;const Be=h.point,Fe=[Be.x*p,Be.y*p,0];return nr(R,R,Fe),vr(I,I,Fe),new zn(R,I)}if(h._tileCoverLift>0){for(const Be of A)nr(R,R,Be),vr(I,I,Be);return new zn(R,I)}const P=[_[12]*p,_[13]*p,_[14]*p],B=y.getCenter(),N=De(h.center.lat,-85.051129,je),U=De(B.lat,-85.051129,je),j=ve(h.center.lng),K=xe(N);let ee=j-ve(B.lng);const le=K-xe(U);ee>.5?ee-=1:ee<-.5&&(ee+=1);let re=0;Math.abs(ee)>Math.abs(le)?re=ee>=0?1:3:(re=le>=0?0:2,Gr(P,P,[_[4]*p,_[5]*p,_[6]*p],-Math.sin(H(le>=0?y.getSouth():y.getNorth()))*x));const G=A[re],ie=A[(re+1)%4],ae=new xN(G,ie,P),fe=[dA(ae,0)||G[0],dA(ae,1)||G[1],dA(ae,2)||G[2]],Ce=uu(h.zoom);if(Ce>0){const Be=function({x:Ve,y:et,z:mt},ht,pt,xt,Ke){const ft=1/(1<<mt);let Ye=Ve*ft,Qe=Ye+ft,At=et*ft,Et=At+ft,Kt=0;const $t=(Ye+Qe)/2-xt;return $t>.5?Kt=-1:$t<-.5&&(Kt=1),Ye=((Ye+Kt)*ht-(xt*=ht))*pt+xt,Qe=((Qe+Kt)*ht-xt)*pt+xt,At=(At*ht-(Ke*=ht))*pt+Ke,Et=(Et*ht-Ke)*pt+Ke,[[Ye,Et,0],[Qe,Et,0],[Qe,At,0],[Ye,At,0]]}(l,o,h._pixelsPerMercatorPixel,j,K);for(let Ve=0;Ve<A.length;Ve++)dh(A[Ve],Be[Ve],Ce);const Fe=vi([],Be[re],Be[(re+1)%4]);Qi(Fe,Fe,.5),dh(fe,Fe,Ce)}for(const Be of A)nr(R,R,Be),vr(I,I,Be);return R[2]=Math.min(G[2],ie[2]),nr(R,R,fe),vr(I,I,fe),new zn(R,I)}function Ub({x:h,y:o,z:l},d=!1){const p=1/(1<<l),_=new Z(Ie(h*p),o===(1<<l)-1&&d?-90:Re((o+1)*p)),y=new Z(Ie((h+1)*p),o===0&&d?90:Re(o*p));return new se(_,y)}function fA(h,o=x){const l=H(h.getNorth()),d=H(h.getSouth()),p=Math.cos(l),_=Math.cos(d),y=Math.sin(l),A=Math.sin(d),S=h.getWest(),I=h.getEast();return[V(_,A,S,o),V(_,A,I,o),V(p,y,I,o),V(p,y,S,o)]}function h_(h,o,l,d){const p=1<<l.z,_=(h/Dt+l.x)/p;return Y(Re((o/Dt+l.y)/p),Ie(_),d)}function Vb({min:h,max:o}){return M/Math.max(o[0]-h[0],o[1]-h[1],o[2]-h[2])}const oI=new Float64Array(16);function $b(h){const o=Vb(h),l=Tt(oI,[o,o,o]);return Te(l,l,Is([],h.min))}function pA(h){const o=(d=h.min,(l=oI)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=d[0],l[13]=d[1],l[14]=d[2],l[15]=1,l);var l,d;const p=1/Vb(h);return we(o,o,[p,p,p])}function mA(h){const o=Dt/(2*Math.PI);return h/(2*Math.PI)/o}function aI(h,o){return Dt/(512*Math.pow(2,h))*Vb(mc(o))}function lI(h,o,l,d,p){const _=mA(l),y=[h,o,-l/(2*Math.PI)],A=W(new Float64Array(16));return Te(A,A,y),we(A,A,[_,_,_]),Ee(A,A,H(-p)),Le(A,A,H(-d)),A}function uu(h){return ze(T,C,h)}function cI(h,o){const l=Y(o.lat,o.lng),d=function(U){const j=Y(U._center.lat,U._center.lng);let K=rr([],ii(0,1,0),j);const ee=_t([],-U.angle,j);K=jn(K,K,ee),_t(ee,-U._pitch,K);const le=on([],j);return Qi(le,le,hu(U.cameraToCenterDistance/U.pixelsPerMeter)),jn(le,le,ee),vi([],j,le)}(h);return y=(p=Zi([],d,l))[0],A=p[1],S=p[2],I=(_=l)[0],R=_[1],P=_[2],N=(B=Math.sqrt(y*y+A*A+S*S)*Math.sqrt(I*I+R*R+P*P))&&cn(p,_)/B,Math.acos(Math.min(Math.max(N,-1),1));var p,_,y,A,S,I,R,P,B,N}function gA(h,o){return cI(h,o)>Math.PI/2*1.01}const hI=H(85),wN=Math.cos(hI),AN=Math.sin(hI),TN=X(),uI=h=>{const o=[];return h.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o};function dI(h,o,l,d,p,_,y,A,S){if(_&&h.queryGeometry.isAboveHorizon)return!1;_&&(S*=h.pixelToTileUnitsFactor);const I=h.tileID.canonical,R=l.projection.upVectorScale(I,l.center.lat,l.worldSize).metersToTile;for(const P of o)for(const B of P){const N=B.add(A),U=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(N.x,N.y,!0):0,j=l.projection.projectTilePoint(N.x,N.y,I);if(U>0){const re=l.projection.upVector(I,N.x,N.y);j.x+=re[0]*R*U,j.y+=re[1]*R*U,j.z+=re[2]*R*U}const K=_?N:SN(j.x,j.y,j.z,d),ee=_?h.tilespaceRays.map(re=>CN(re,U)):h.queryGeometry.screenGeometry,le=ls([],[j.x,j.y,j.z,1],d);if(!y&&_?S*=le[3]/l.cameraToCenterDistance:y&&!_&&(S*=l.cameraToCenterDistance/le[3]),_){const re=Re((B.y/Dt+I.y)/(1<<I.z));S/=l.projection.pixelsPerMeter(re,1)/ge(1,re)}if(mi(ee,K,S))return!0}return!1}function SN(h,o,l,d){const p=ls([],[h,o,l,1],d);return new ue(p[0]/p[3],p[1]/p[3])}const fI=ii(0,0,0),EN=ii(0,0,1);function CN(h,o){const l=Lt();return fI[2]=o,h.intersectsPlane(fI,EN,l),new ue(l[0],l[1])}class pI extends Gt{}let mI,gI,_I,yI;function bI(h,{width:o,height:l},d,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==o*l*d)throw new RangeError("mismatched image size")}else p=new Uint8Array(o*l*d);return h.width=o,h.height=l,h.data=p,h}function vI(h,o,l){const{width:d,height:p}=o;d===h.width&&p===h.height||(_A(h,o,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,d),height:Math.min(h.height,p)},l,null),h.width=d,h.height=p,h.data=o.data)}function _A(h,o,l,d,p,_,y,A){if(p.width===0||p.height===0)return o;if(p.width>h.width||p.height>h.height||l.x>h.width-p.width||l.y>h.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>o.width||p.height>o.height||d.x>o.width-p.width||d.y>o.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const S=h.data,I=o.data,R=_===4&&A;for(let P=0;P<p.height;P++){const B=((l.y+P)*h.width+l.x)*_,N=((d.y+P)*o.width+d.x)*_;if(R)for(let U=0;U<p.width;U++){const j=B+U*_+3,K=N+U*_;I[K+0]=255,I[K+1]=255,I[K+2]=255,I[K+3]=S[j]}else if(y)for(let U=0;U<p.width;U++){const j=B+U*_,K=N+U*_,ee=S[j+3],le=new rn(S[j+0]/255*ee,S[j+1]/255*ee,S[j+2]/255*ee,ee).toRenderColor(y).toArray();I[K+0]=le[0],I[K+1]=le[1],I[K+2]=le[2],I[K+3]=le[3]}else for(let U=0;U<p.width*_;U++)I[N+U]=S[B+U]}return o}Ut(pI,"HeatmapBucket",{omit:["layers"]});class du{constructor(o,l){bI(this,o,1,l)}resize(o){vI(this,new du(o),1)}clone(){return new du({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,p,_){_A(o,l,d,p,_,1,null)}}class ys{constructor(o,l){bI(this,o,4,l)}resize(o){vI(this,new ys(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,p,_,y,A){_A(o,l,d,p,_,4,y,A)}}class xI{constructor(o,l){this.width=o.width,this.height=o.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function u_(h){const o={},l=h.resolution||256,d=h.clips?h.clips.length:1,p=h.image||new ys({width:l,height:d}),_=(y,A,S)=>{o[h.evaluationKey]=S;const I=h.expression.evaluate(o);I&&(p.data[y+A+0]=Math.floor(255*I.r/I.a),p.data[y+A+1]=Math.floor(255*I.g/I.a),p.data[y+A+2]=Math.floor(255*I.b/I.a),p.data[y+A+3]=Math.floor(255*I.a))};if(h.clips)for(let y=0,A=0;y<d;++y,A+=4*l)for(let S=0,I=0;S<l;S++,I+=4){const R=S/(l-1),{start:P,end:B}=h.clips[y];_(A,I,P*(1-R)+B*R)}else for(let y=0,A=0;y<l;y++,A+=4)_(0,A,y/(l-1));return p}Ut(du,"AlphaImage"),Ut(ys,"RGBAImage");const IN=tn([{name:"a_pos",components:2,type:"Int16"}],4),MN=tn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),RN=tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),kN=tn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function d_(h,o,l=2){const d=o&&o.length,p=d?o[0]*l:h.length;let _=wI(h,0,p,l,!0);const y=[];if(!_||_.next===_.prev)return y;let A,S,I;if(d&&(_=function(R,P,B,N){const U=[];for(let j=0,K=P.length;j<K;j++){const ee=wI(R,P[j]*N,j<K-1?P[j+1]*N:R.length,N,!1);ee===ee.next&&(ee.steiner=!0),U.push(NN(ee))}U.sort(FN);for(let j=0;j<U.length;j++)B=LN(U[j],B);return B}(h,o,_,l)),h.length>80*l){A=1/0,S=1/0;let R=-1/0,P=-1/0;for(let B=l;B<p;B+=l){const N=h[B],U=h[B+1];N<A&&(A=N),U<S&&(S=U),N>R&&(R=N),U>P&&(P=U)}I=Math.max(R-A,P-S),I=I!==0?32767/I:0}return f_(_,y,l,A,S,I,0),y}function wI(h,o,l,d,p){let _;if(p===function(y,A,S,I){let R=0;for(let P=A,B=S-I;P<S;P+=I)R+=(y[B]-y[P])*(y[P+1]+y[B+1]),B=P;return R}(h,o,l,d)>0)for(let y=o;y<l;y+=d)_=EI(y/d|0,h[y],h[y+1],_);else for(let y=l-d;y>=o;y-=d)_=EI(y/d|0,h[y],h[y+1],_);return _&&Up(_,_.next)&&(g_(_),_=_.next),_}function Dd(h,o){if(!h)return h;o||(o=h);let l,d=h;do if(l=!1,d.steiner||!Up(d,d.next)&&Zr(d.prev,d,d.next)!==0)d=d.next;else{if(g_(d),d=o=d.prev,d===d.next)break;l=!0}while(l||d!==o);return o}function f_(h,o,l,d,p,_,y){if(!h)return;!y&&_&&function(S,I,R,P){let B=S;do B.z===0&&(B.z=yA(B.x,B.y,I,R,P)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==S);B.prevZ.nextZ=null,B.prevZ=null,function(N){let U,j=1;do{let K,ee=N;N=null;let le=null;for(U=0;ee;){U++;let re=ee,G=0;for(let ae=0;ae<j&&(G++,re=re.nextZ,re);ae++);let ie=j;for(;G>0||ie>0&&re;)G!==0&&(ie===0||!re||ee.z<=re.z)?(K=ee,ee=ee.nextZ,G--):(K=re,re=re.nextZ,ie--),le?le.nextZ=K:N=K,K.prevZ=le,le=K;ee=re}le.nextZ=null,j*=2}while(U>1)}(B)}(h,d,p,_);let A=h;for(;h.prev!==h.next;){const S=h.prev,I=h.next;if(_?DN(h,d,p,_):PN(h))o.push(S.i,h.i,I.i),g_(h),h=I.next,A=I.next;else if((h=I)===A){y?y===1?f_(h=BN(Dd(h),o),o,l,d,p,_,2):y===2&&ON(h,o,l,d,p,_):f_(Dd(h),o,l,d,p,_,1);break}}}function PN(h){const o=h.prev,l=h,d=h.next;if(Zr(o,l,d)>=0)return!1;const p=o.x,_=l.x,y=d.x,A=o.y,S=l.y,I=d.y,R=Math.min(p,_,y),P=Math.min(A,S,I),B=Math.max(p,_,y),N=Math.max(A,S,I);let U=d.next;for(;U!==o;){if(U.x>=R&&U.x<=B&&U.y>=P&&U.y<=N&&p_(p,A,_,S,y,I,U.x,U.y)&&Zr(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function DN(h,o,l,d){const p=h.prev,_=h,y=h.next;if(Zr(p,_,y)>=0)return!1;const A=p.x,S=_.x,I=y.x,R=p.y,P=_.y,B=y.y,N=Math.min(A,S,I),U=Math.min(R,P,B),j=Math.max(A,S,I),K=Math.max(R,P,B),ee=yA(N,U,o,l,d),le=yA(j,K,o,l,d);let re=h.prevZ,G=h.nextZ;for(;re&&re.z>=ee&&G&&G.z<=le;){if(re.x>=N&&re.x<=j&&re.y>=U&&re.y<=K&&re!==p&&re!==y&&p_(A,R,S,P,I,B,re.x,re.y)&&Zr(re.prev,re,re.next)>=0||(re=re.prevZ,G.x>=N&&G.x<=j&&G.y>=U&&G.y<=K&&G!==p&&G!==y&&p_(A,R,S,P,I,B,G.x,G.y)&&Zr(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;re&&re.z>=ee;){if(re.x>=N&&re.x<=j&&re.y>=U&&re.y<=K&&re!==p&&re!==y&&p_(A,R,S,P,I,B,re.x,re.y)&&Zr(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;G&&G.z<=le;){if(G.x>=N&&G.x<=j&&G.y>=U&&G.y<=K&&G!==p&&G!==y&&p_(A,R,S,P,I,B,G.x,G.y)&&Zr(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function BN(h,o){let l=h;do{const d=l.prev,p=l.next.next;!Up(d,p)&&TI(d,l,l.next,p)&&m_(d,p)&&m_(p,d)&&(o.push(d.i,l.i,p.i),g_(l),g_(l.next),l=h=p),l=l.next}while(l!==h);return Dd(l)}function ON(h,o,l,d,p,_){let y=h;do{let A=y.next.next;for(;A!==y.prev;){if(y.i!==A.i&&UN(y,A)){let S=SI(y,A);return y=Dd(y,y.next),S=Dd(S,S.next),f_(y,o,l,d,p,_,0),void f_(S,o,l,d,p,_,0)}A=A.next}y=y.next}while(y!==h)}function FN(h,o){let l=h.x-o.x;return l===0&&(l=h.y-o.y,l===0)&&(l=(h.next.y-h.y)/(h.next.x-h.x)-(o.next.y-o.y)/(o.next.x-o.x)),l}function LN(h,o){const l=function(p,_){let y=_;const A=p.x,S=p.y;let I,R=-1/0;if(Up(p,y))return y;do{if(Up(p,y.next))return y.next;if(S<=y.y&&S>=y.next.y&&y.next.y!==y.y){const j=y.x+(S-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(j<=A&&j>R&&(R=j,I=y.x<y.next.x?y:y.next,j===A))return I}y=y.next}while(y!==_);if(!I)return null;const P=I,B=I.x,N=I.y;let U=1/0;y=I;do{if(A>=y.x&&y.x>=B&&A!==y.x&&AI(S<N?A:R,S,B,N,S<N?R:A,S,y.x,y.y)){const j=Math.abs(S-y.y)/(A-y.x);m_(y,p)&&(j<U||j===U&&(y.x>I.x||y.x===I.x&&zN(I,y)))&&(I=y,U=j)}y=y.next}while(y!==P);return I}(h,o);if(!l)return o;const d=SI(l,h);return Dd(d,d.next),Dd(l,l.next)}function zN(h,o){return Zr(h.prev,h,o.prev)<0&&Zr(o.next,h,h.next)<0}function yA(h,o,l,d,p){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-l)*p|0)|h<<8))|h<<4))|h<<2))|h<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-d)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function NN(h){let o=h,l=h;do(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next;while(o!==h);return l}function AI(h,o,l,d,p,_,y,A){return(p-y)*(o-A)>=(h-y)*(_-A)&&(h-y)*(d-A)>=(l-y)*(o-A)&&(l-y)*(_-A)>=(p-y)*(d-A)}function p_(h,o,l,d,p,_,y,A){return!(h===y&&o===A)&&AI(h,o,l,d,p,_,y,A)}function UN(h,o){return h.next.i!==o.i&&h.prev.i!==o.i&&!function(l,d){let p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==d.i&&p.next.i!==d.i&&TI(p,p.next,l,d))return!0;p=p.next}while(p!==l);return!1}(h,o)&&(m_(h,o)&&m_(o,h)&&function(l,d){let p=l,_=!1;const y=(l.x+d.x)/2,A=(l.y+d.y)/2;do p.y>A!=p.next.y>A&&p.next.y!==p.y&&y<(p.next.x-p.x)*(A-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==l);return _}(h,o)&&(Zr(h.prev,h,o.prev)||Zr(h,o.prev,o))||Up(h,o)&&Zr(h.prev,h,h.next)>0&&Zr(o.prev,o,o.next)>0)}function Zr(h,o,l){return(o.y-h.y)*(l.x-o.x)-(o.x-h.x)*(l.y-o.y)}function Up(h,o){return h.x===o.x&&h.y===o.y}function TI(h,o,l,d){const p=Hb(Zr(h,o,l)),_=Hb(Zr(h,o,d)),y=Hb(Zr(l,d,h)),A=Hb(Zr(l,d,o));return p!==_&&y!==A||!(p!==0||!jb(h,l,o))||!(_!==0||!jb(h,d,o))||!(y!==0||!jb(l,h,d))||!(A!==0||!jb(l,o,d))}function jb(h,o,l){return o.x<=Math.max(h.x,l.x)&&o.x>=Math.min(h.x,l.x)&&o.y<=Math.max(h.y,l.y)&&o.y>=Math.min(h.y,l.y)}function Hb(h){return h>0?1:h<0?-1:0}function m_(h,o){return Zr(h.prev,h,h.next)<0?Zr(h,o,h.next)>=0&&Zr(h,h.prev,o)>=0:Zr(h,o,h.prev)<0||Zr(h,h.next,o)<0}function SI(h,o){const l=bA(h.i,h.x,h.y),d=bA(o.i,o.x,o.y),p=h.next,_=o.prev;return h.next=o,o.prev=h,l.next=p,p.prev=l,d.next=l,l.prev=d,_.next=d,d.prev=_,d}function EI(h,o,l,d){const p=bA(h,o,l);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function g_(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function bA(h,o,l){return{i:h,x:o,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Wb(h,o){const l=h.length;if(l<=1)return[h];const d=[];let p,_;for(let y=0;y<l;y++){const A=en(h[y]);A!==0&&(h[y].area=Math.abs(A),_===void 0&&(_=A<0),_===A<0?(p&&d.push(p),p=[h[y]]):p.push(h[y]))}if(p&&d.push(p),o>1)for(let y=0;y<d.length;y++)d[y].length<=o||(ic(d[y],o,1,d[y].length-1,VN),d[y]=d[y].slice(0,o));return d}function VN(h,o){return o.area-h.area}function CI(h,o,l=1){if(!h)return null;const d=typeof h=="string"?to.from(h).getPrimary():h.getPrimary(),p=typeof h=="string"?null:h.getSecondary();for(const _ of[d,p]){if(!_)continue;const y=_.id.toString();o.has(y)||o.set(y,[]),_.scaleSelf(l),o.get(y).push(_)}return{primary:d.toString(),secondary:p?p.toString():null}}function vA(h,o,l,d){const p=d.patternDependencies;let _=!1;for(const y of o){const A=y.paint.get(`${h}-pattern`);A.isConstant()||(_=!0),CI(A.constantOr(null),p,l)&&(_=!0)}return _}function xA(h,o,l,d,p,_){const y=_.patternDependencies;for(const A of o){const S=A.paint.get(`${h}-pattern`).value;if(S.kind!=="constant"){let I=S.evaluate({zoom:d},l,{},_.availableImages);I=I&&I.name?I.name:I;const R=CI(I,y,p);if(!R)continue;const{primary:P,secondary:B}=R;P&&(l.patterns[A.id]=[P,B].filter(Boolean))}}return l}var wA,II,AA,MI,TA,RI,kI,Gb={};function PI(){if(II)return wA;II=1;var h=ke();function o(p,_,y,A,S){this.properties={},this.extent=y,this.type=0,this._pbf=p,this._geometry=-1,this._keys=A,this._values=S,p.readFields(l,this,_)}function l(p,_,y){p==1?_.id=y.readVarint():p==2?function(A,S){for(var I=A.readVarint()+A.pos;A.pos<I;){var R=S._keys[A.readVarint()],P=S._values[A.readVarint()];S.properties[R]=P}}(y,_):p==3?_.type=y.readVarint():p==4&&(_._geometry=y.pos)}function d(p){for(var _,y,A=0,S=0,I=p.length,R=I-1;S<I;R=S++)A+=((y=p[R]).x-(_=p[S]).x)*(_.y+y.y);return A}return wA=o,o.types=["Unknown","Point","LineString","Polygon"],o.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var _,y=p.readVarint()+p.pos,A=1,S=0,I=0,R=0,P=[];p.pos<y;){if(S<=0){var B=p.readVarint();A=7&B,S=B>>3}if(S--,A===1||A===2)I+=p.readSVarint(),R+=p.readSVarint(),A===1&&(_&&P.push(_),_=[]),_.push(new h(I,R));else{if(A!==7)throw new Error("unknown command "+A);_&&_.push(_[0].clone())}}return _&&P.push(_),P},o.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var _=p.readVarint()+p.pos,y=1,A=0,S=0,I=0,R=1/0,P=-1/0,B=1/0,N=-1/0;p.pos<_;){if(A<=0){var U=p.readVarint();y=7&U,A=U>>3}if(A--,y===1||y===2)(S+=p.readSVarint())<R&&(R=S),S>P&&(P=S),(I+=p.readSVarint())<B&&(B=I),I>N&&(N=I);else if(y!==7)throw new Error("unknown command "+y)}return[R,B,P,N]},o.prototype.toGeoJSON=function(p,_,y){var A,S,I=this.extent*Math.pow(2,y),R=this.extent*p,P=this.extent*_,B=this.loadGeometry(),N=o.types[this.type];function U(ee){for(var le=0;le<ee.length;le++){var re=ee[le];ee[le]=[360*(re.x+R)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(re.y+P)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(A=0;A<B.length;A++)j[A]=B[A][0];U(B=j);break;case 2:for(A=0;A<B.length;A++)U(B[A]);break;case 3:for(B=function(ee){var le=ee.length;if(le<=1)return[ee];for(var re,G,ie=[],ae=0;ae<le;ae++){var fe=d(ee[ae]);fe!==0&&(G===void 0&&(G=fe<0),G===fe<0?(re&&ie.push(re),re=[ee[ae]]):re.push(ee[ae]))}return re&&ie.push(re),ie}(B),A=0;A<B.length;A++)for(S=0;S<B[A].length;S++)U(B[A][S])}B.length===1?B=B[0]:N="Multi"+N;var K={type:"Feature",geometry:{type:N,coordinates:B},properties:this.properties};return"id"in this&&(K.id=this.id),K},wA}function DI(){if(MI)return AA;MI=1;var h=PI();function o(d,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(l,this,p),this.length=this._features.length}function l(d,p,_){d===15?p.version=_.readVarint():d===1?p.name=_.readString():d===5?p.extent=_.readVarint():d===2?p._features.push(_.pos):d===3?p._keys.push(_.readString()):d===4&&p._values.push(function(y){for(var A=null,S=y.readVarint()+y.pos;y.pos<S;){var I=y.readVarint()>>3;A=I===1?y.readString():I===2?y.readFloat():I===3?y.readDouble():I===4?y.readVarint64():I===5?y.readVarint():I===6?y.readSVarint():I===7?y.readBoolean():null}return A}(_))}return AA=o,o.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var p=this._pbf.readVarint()+this._pbf.pos;return new h(this._pbf,p,this.extent,this._keys,this._values)},AA}function BI(){return kI||(kI=1,Gb.VectorTile=function(){if(RI)return TA;RI=1;var h=DI();function o(l,d,p){if(l===3){var _=new h(p,p.readVarint()+p.pos);_.length&&(d[_.name]=_)}}return TA=function(l,d){this.layers=l.readFields(o,{},d)},TA}(),Gb.VectorTileFeature=PI(),Gb.VectorTileLayer=DI()),Gb}var fu=BI();const Bd="3d_elevation_id",OI="level";class $N{constructor(){this._valid=!1}reset(o){return this.feature=o,this._valid=!0,this._geometry=o.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(o,l){return this._valid&&o(l(this._geometry)),this}require(o,l,d){return this.get(o,!0,l,d)}optional(o,l,d){return this.get(o,!1,l,d)}success(){return this._valid}get(o,l,d,p){const _=this.feature.properties.hasOwnProperty(o)?+this.feature.properties[o]:void 0;return this._valid&&_!==void 0&&!Number.isNaN(_)?d(p?p(_):_):l&&(this._valid=!1),this}}class FI{constructor(o,l){this.featureFunc=o,this.vertexFunc=l}parseFeature(o,l,d){return this.featureFunc(o,l,d)}parseVertex(o,l,d){return this.vertexFunc(o,l,d)}}const jN=new FI((h,o,l)=>h.reset(o).require(Bd,d=>{l.id=d}).optional("fixed_height_relative",d=>{l.constantHeight=d},Od.decodeRelativeHeight).geometry(d=>{l.bounds=d},fg).success(),(h,o,l)=>h.reset(o).require(Bd,d=>{l.id=d}).require("elevation_idx",d=>{l.idx=d}).require("extent",d=>{l.extent=d}).require("height_relative",d=>{l.height=d},Od.decodeRelativeHeight).geometry(d=>{l.position=d},Od.getPoint).success()),HN=new FI((h,o,l)=>h.reset(o).require(Bd,d=>{l.id=d}).optional("fixed_height",d=>{l.constantHeight=d},Od.decodeMetricHeight).geometry(d=>{l.bounds=d},fg).success(),(h,o,l)=>h.reset(o).require(Bd,d=>{l.id=d}).require("elevation_idx",d=>{l.idx=d}).require("extent",d=>{l.extent=d}).require("height",d=>{l.height=d},Od.decodeMetricHeight).geometry(d=>{l.position=d},Od.getPoint).success());class Od{static getPoint(o){return Wa(o[0][0].x,o[0][0].y)}static decodeRelativeHeight(o){return 1e-4*o*5}static decodeMetricHeight(o){return 1e-4*o}static parse(o){const l=[],d=[],p=o.length,_=new $N;for(let A=0;A<p;A++){const S=o.feature(A),I=S.properties.hasOwnProperty("version")?String(S.properties.version):void 0,R=(y=I)?y==="1.0.1"?HN:void 0:jN;if(R===void 0){Bi(`Unknown elevation feature version number ${I||"(unknown)"}`);continue}const P=S.properties.hasOwnProperty("type")?S.properties.type:void 0;if(P){if(fu.VectorTileFeature.types[S.type]==="Point"&&P==="curve_point"){const B={};R.parseVertex(_,S,B)&&l.push(B)}else if(fu.VectorTileFeature.types[S.type]==="Polygon"&&P==="curve_meta"){const B={};R.parseFeature(_,S,B)&&d.push(B)}}}var y;return{vertices:l,features:d}}}class LI{constructor(o,l){this.feature=o,this.metersToTile=l,this.index=0}get(){const o=this.feature.vertices[this.index],l=this.feature.vertexProps[this.index].dir,d=l[1],p=-l[0],_=(o.extent+1)*this.metersToTile;return[new ue(Math.trunc(o.position[0]+d*_),Math.trunc(o.position[1]+p*_)),new ue(Math.trunc(o.position[0]-d*_),Math.trunc(o.position[1]-p*_))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class SA{constructor(o,l,d,p,_,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=o,this.heightRange={min:d,max:d},this.safeArea=l,this.constantHeight=d,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=_,this.edges=this.edges.filter(A=>{return A.a<this.vertices.length&&A.b<this.vertices.length&&!((S=this.vertices[A.a].position)[0]===(I=this.vertices[A.b].position)[0]&&S[1]===I[1]);var S,I}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const A of this.vertices)this.vertexProps.push({dir:Wa(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,A.height),this.heightRange.max=Math.max(this.heightRange.max,A.height);for(const A of this.edges){const S=this.vertices[A.a].position,I=this.vertices[A.b].position,R=jo(Ms(),I,S),P=ua(R),B=er(Ms(),R,1/P);this.edgeProps.push({vec:R,dir:B,len:P});const N=this.vertexProps[A.a].dir,U=this.vertexProps[A.b].dir;Ga(N,N,B),Ga(U,U,B)}for(const A of this.vertexProps)A.dir[0]===0&&A.dir[1]===0||ml(A.dir,A.dir);this.tessellate(y)}}pointElevation(o){if(this.constantHeight!=null)return this.constantHeight;const l=this.getClosestEdge(o);if(l==null)return 0;const[d,p]=l;return((_,y,A)=>(1-A)*_+A*y)(this.vertices[this.edges[d].a].height,this.vertices[this.edges[d].b].height,p)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(o){if(this.edges.length===0)return;let l=0,d=Number.POSITIVE_INFINITY,p=0;const _=Wa(o.x,o.y);for(let y=0;y<this.edges.length;y++){const A=this.edges[y],S=this.edgeProps[y].dir,I=new el(_,this.edgeProps[y].dir),R=this.vertices[A.a].position,P=this.vertices[A.b].position,B=Ms(),N=Ms(),U=I.intersectsPlane(R,this.vertexProps[A.a].dir,B),j=I.intersectsPlane(P,this.vertexProps[A.b].dir,N);if(!U||!j)continue;const K=jo(Ms(),N,B),ee=jo(Ms(),_,B),le=On(K,K),re=le>0?On(ee,K)/le:0,G=De(re,0,1),ie=Math.abs((re-G)*this.edgeProps[y].len),ae=jo(Ms(),_,R),fe=ie+Math.abs(On(ae,Wa(S[1],-S[0])));fe<d&&(l=y,d=fe,p=G)}return[l,p]}tessellate(o){for(let l=this.edges.length-1;l>=0;--l){const d=this.edges[l].a,p=this.edges[l].b,{position:_,height:y,extent:A}=this.vertices[d],{position:S,height:I,extent:R}=this.vertices[p],P=this.vertexProps[d].dir,B=this.vertexProps[p].dir,N=ii(_[0]/o,_[1]/o,y),U=ii(S[0]/o,S[1]/o,I),j=ii(P[1],-P[0],0);Qi(j,j,A);const K=ii(B[1],-B[0],0);if(Qi(K,K,R),this.distSqLines(ii(N[0]+.5*j[0],N[1]+.5*j[1],N[2]+.5*j[2]),ii(U[0]-.5*K[0],U[1]-.5*K[1],U[2]-.5*K[2]),ii(N[0]-.5*j[0],N[1]-.5*j[1],N[2]-.5*j[2]),ii(U[0]+.5*K[0],U[1]+.5*K[1],U[2]+.5*K[2]))<=.0025000000000000005)continue;const ee=this.vertices.length,le=Ga(Ms(),_,S);this.vertices.push({position:er(le,le,.5),height:.5*(y+I),extent:.5*(A+R)});const re=Ga(Ms(),P,B);this.vertexProps.push({dir:ml(re,re)}),this.edges.splice(l,1),this.edgeProps.splice(l,1),this.edges.push({a:d,b:ee}),this.edges.push({a:ee,b:p});const G=jo(Ms(),this.vertices[ee].position,_),ie=ua(G),ae={vec:G,dir:er(Ms(),G,1/ie),len:ie};this.edgeProps.push(ae),this.edgeProps.push(ae)}}distSqLines(o,l,d,p){const _=Zi(Lt(),l,o),y=Zi(Lt(),p,d),A=Zi(Lt(),o,d),S=cn(_,_),I=cn(_,y),R=cn(_,A),P=cn(y,y),B=cn(y,A),N=S*P-I*I;if(N===0){const K=cn(A,y)/cn(y,y);return Js(go(Lt(),d,p,K),o)}const U=(I*B-R*P)/N,j=(S*B-I*R)/N;return Js(go(Lt(),o,l,U),go(Lt(),d,p,j))}}class EA{static parseFrom(o,l){const d=Od.parse(o);if(!d)return[];let{vertices:p,features:_}=d;const y=1/$e(l);_.sort((R,P)=>R.id-P.id),p.sort((R,P)=>R.id-P.id||R.idx-P.idx),p=p.filter((R,P,B)=>P===B.findIndex(N=>N.id===R.id&&N.idx===R.idx));const A=new Array;let S=0;const I=p.length;for(const R of _){if(R.constantHeight){A.push(new SA(R.id,R.bounds,R.constantHeight));continue}for(;S!==I&&p[S].id<R.id;)S++;if(S===I||p[S].id!==R.id)continue;const P=new Array,B=new Array,N=S;for(;S!==I&&p[S].id===R.id;){const U=p[S];if(P.push({position:U.position,height:U.height,extent:U.extent}),S!==N&&p[S-1].idx===U.idx-1){const j=S-N;B.push({a:j-1,b:j})}S++}A.push(new SA(R.id,R.bounds,void 0,P,B,y))}return A}static getElevationFeature(o,l){if(!l)return;const d=+o.properties[Bd];return Number.isNaN(d)?void 0:l.find(p=>p.id===d)}}class zI{constructor(o,l){this.zScale=1,this.xOffset=0,this.yOffset=0,o.equals(l)||(this.zScale=Math.pow(2,l.z-o.z),this.xOffset=(o.x*this.zScale-l.x)*Dt,this.yOffset=(o.y*this.zScale-l.y)*Dt)}constantElevation(o,l){if(o.constantHeight!=null)return this.computeBiasedHeight(o.constantHeight,l)}pointElevation(o,l,d){const p=this.constantElevation(l,d);return p??(o.x=o.x*this.zScale+this.xOffset,o.y=o.y*this.zScale+this.yOffset,this.computeBiasedHeight(l.pointElevation(o),d))}computeBiasedHeight(o,l){return l<=0?o:o+l*ze(0,l,o>=0?o:Math.abs(.5*o))}}Ut(SA,"ElevationFeature");class NI{constructor(){this.polygons=new Map}add(o,...l){this.polygons.has(o)?this.polygons.get(o).push(...l):this.polygons.set(o,l)}merge(o){for(const[l,d]of o.polygons)this.add(l,...d)}}class Fd{constructor(){this.portals=[]}static evaluate(o){if(o.length===0)return new Fd;let l=[];for(const I of o)l.push(...I.portals);if(l.length===0)return new Fd;const d=(I,R)=>I<=0&&R<=0||I>=Dt&&R>=Dt;for(const I of l){const R=I.va,P=I.vb;(d(R.x,P.x)||d(R.y,P.y))&&(I.type="border")}const p=l.filter(I=>I.type!=="unevaluated"),_=l.filter(I=>I.type==="unevaluated");if(_.length===0)return new Fd;_.sort((I,R)=>I.hash===R.hash?I.isTunnel===R.isTunnel?0:I.isTunnel?-1:1:I.hash<R.hash?1:-1),l=p.concat(_);let y=p.length,A=y,S=y;do if(A++,A===l.length||l[y].hash!==l[A].hash){if(A-y==2){S<y&&(l[S]=l[y],l[y]=null);const I=l[S],R=l[A-1];I.type=I.isTunnel!==R.isTunnel?"tunnel":"polygon",I.connection={a:I.connection.a,b:R.connection.a},S++}y=A}while(y!==l.length);return l.splice(S),l.sort((I,R)=>I.hash<R.hash?1:-1),{portals:l}}}Ut(Fd,"ElevationPortalGraph"),Ut(NI,"ElevationPolygons");class WN{constructor(o,l,d){this.outPositions=o,this.outNormals=l,this.outIndices=d,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(o,l,d){let p=o[2];d!=null&&(p*=d);const _=this.getVec3Bits(o)<<96n|this.getVec3Bits(l),y=this.vertexLookup.get(_);if(y!=null)return y;const A=this.outPositions.length;this.vertexLookup.set(_,A);const S=Math.trunc(16384*l[0]),I=Math.trunc(16384*l[1]),R=Math.trunc(16384*l[2]);return this.outPositions.emplaceBack(o[0],o[1],p),this.outNormals.emplaceBack(S,I,R),A}addVertices(o,l,...d){const p=[];for(const _ of d){const y=this.addVertex(_,o,l);p.push(y)}return p}addTriangles(o,l,d){if(l&&d){const p=d.length===1,_=ii(0,0,0);for(let y=0;y<o.length;y+=3){const A=l[o[y+0]],S=l[o[y+1]],I=l[o[y+2]],R=p?d[0]:d[o[y+1]],P=p?d[0]:d[o[y+2]],B=this.addVertex(ii(A.x,A.y,p?d[0]:d[o[y+0]]),_),N=this.addVertex(ii(S.x,S.y,R),_),U=this.addVertex(ii(I.x,I.y,P),_);this.outIndices.emplaceBack(B,N,U)}}else for(let p=0;p<o.length;p+=3)this.outIndices.emplaceBack(o[p+0],o[p+1],o[p+2])}addQuad(o,l){const d=this.addVertices(l,void 0,...o.map(S=>ii(S.coord.x,S.coord.y,S.height))),[p,_,y,A]=d;this.addTriangles([p,_,y,y,A,p])}getBits(o){return this.view.setFloat32(0,o),BigInt(this.view.getUint32(0))}getVec3Bits(o){return this.getBits(o[0])<<64n|this.getBits(o[1])<<32n|this.getBits(o[2])}}class Ko{constructor(o){this.unevaluatedPortals=new Fd,this.portalPolygons=new NI,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Ip,this.vertexNormals=new nu,this.indexArray=new qr,this.tileToMeters=$e(o)}addVertices(o,l){const d=this.unevalVertices.length;for(let p=0;p<o.length;p++)this.unevalVertices.push(o[p]),this.unevalHeights.push(l[p]);return d}addTriangles(o,l,d){const p=d?this.unevalTunnelTriangles:this.unevalTriangles;for(const _ of o)p.push(_+l)}addRenderableRing(o,l,d,p,_){const y=[new ue(_.min.x,_.min.y),new ue(_.max.x,_.min.y),new ue(_.max.x,_.max.y),new ue(_.min.x,_.max.y)];for(let A=0;A<d-1;A++){const S=l+A,I=S+1,R=this.unevalVertices[S],P=this.unevalVertices[I];if(!(R.x>=_.min.x&&R.x<=_.max.x&&R.y>=_.min.y&&R.y<=_.max.y||P.x>=_.min.x&&P.x<=_.max.x&&P.y>=_.min.y&&P.y<=_.max.y||ar(R,P,y))||this.isOnBorder(R.x,P.x)||this.isOnBorder(R.y,P.y))continue;const B=Ko.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[I]);let N,U=this.vertexHashLookup.get(Ko.computePosHash(R));U!=null?N=U.next:(U=this.vertexHashLookup.get(Ko.computePosHash(P)),N=U!=null?U.prev:B),this.unevalEdges.push({polygonIdx:o,a:S,b:I,hash:B,portalHash:N,isTunnel:p,type:"unevaluated"})}}addPortalCandidates(o,l,d,p,_){if(l.length===0)return;this.portalPolygons.add(o,{geometry:l,zLevel:_});const y=l[0];this.vertexHashLookup.clear();let A=Ko.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let S=0;S<y.length-1;S++){const I=y[S+0],R=y[S+1],P=Wa(R.x-I.x,R.y-I.y),B=ua(P);if(B===0)continue;let N="unevaluated";const U=p.pointElevation(I),j=p.pointElevation(R);Math.abs(U)<.01&&Math.abs(j)<.01?N="entrance":(this.isOnBorder(I.x,R.x)||this.isOnBorder(I.y,R.y))&&(N="border");const K=Ko.computeEdgeHash(I,R);this.unevaluatedPortals.portals.push({connection:{a:o,b:void 0},va:I,vb:R,vab:P,length:B,hash:K,isTunnel:d,type:N});const ee=Ko.computePosHash(I);this.vertexHashLookup.set(ee,{prev:A,next:K}),A=K}}construct(o){if(this.unevalVertices.length===0)return;const l=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),d=P=>{P.primitiveLength=this.indexArray.length-P.primitiveOffset},p=new WN(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(o.portals,this.unevalEdges);const _=l(),y=l(),A=l(),S=(P,B)=>{P.sort((U,j)=>U.type===B&&j.type!==B?-1:U.type!==B&&j.type===B?1:0);const N=P.findIndex(U=>U.type!==B);return N>=0?N:P.length};let I=0;this.unevalEdges.length>0&&(I=S(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},this.tileToMeters));const R=l();if(this.unevalEdges.length>0){const P=this.unevalEdges.splice(I),B=S(P,"tunnel")+I;this.unevalEdges.push(...P),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},{min:I,max:B})}d(A),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),d(R),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),d(y),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),d(_),this.maskSegments=Gn.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.depthSegments=Gn.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableSegments=Gn.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.shadowCasterSegments=Gn.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength)}upload(o){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=o.createVertexBuffer(this.vertexPositions,RN.members),this.vertexBufferNormal=o.createVertexBuffer(this.vertexNormals,kN.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(o,l,d,p,_){const y=new Map;for(let A=p;A<_;A++){const S=d[A],I=S.a,R=S.b,P=Ko.computePosHash(o[I]),B=Ko.computePosHash(o[R]);y.has(P)||y.set(P,{}),y.has(B)||y.set(B,{});const N=y.get(P),U=y.get(B);l[I]<=0&&l[R]<=0||(N.to=R,U.from=I)}return y}constructBridgeStructures(o,l,d,p,_,y){const A=this.computeVertexConnections(l,d,p,_.min,_.max),S=1/y,I=.5*S,R=B=>ii(l[B].x,l[B].y,d[B]*S),P=B=>{const N=A.get(Ko.computePosHash(l[B])),U=N.from,j=N.to;if(!U||!j)return;const K=R(U),ee=R(B),le=R(j),re=ii(0,0,0);if(!fs(K,ee)){const ie=sr(Lt(),ee,K);vi(re,re,on(ie,ie))}if(!fs(le,ee)){const ie=sr(Lt(),le,ee);vi(re,re,on(ie,ie))}const G=$a(re);return G>0?Qi(re,re,1/G):void 0};for(let B=_.min;B<_.max;B++){const N=p[B],U=this.prepareEdgePoints(l,d,N,(wt,pi)=>wt>pi);if(U==null)continue;const j=U[0],K=U[1],ee=ii(j.coord.x,j.coord.y,S*j.height),le=ii(K.coord.x,K.coord.y,S*K.height);if(fs(ee,le))continue;const re=sr(Lt(),le,ee);on(re,re);const G=wt=>on(wt,wt),ie=P(N.a)||re,ae=P(N.b)||re,fe=G(ii(ie[1],-ie[0],0)),Ce=G(ii(ae[1],-ae[0],0)),Be=G(rr(Lt(),fe,ie)),Fe=G(rr(Lt(),Ce,ae)),Ve=Lt(),et=[vi(Lt(),ee,Qi(Ve,sr(Ve,fe,Be),I)),vi(Lt(),ee,Qi(Ve,vi(Ve,fe,Be),I)),vi(Lt(),ee,Qi(Ve,Be,I)),ee],mt=[vi(Lt(),le,Qi(Ve,sr(Ve,Ce,Fe),I)),vi(Lt(),le,Qi(Ve,vi(Ve,Ce,Fe),I)),vi(Lt(),le,Qi(Ve,Fe,I)),le],[ht,pt]=o.addVertices(fe,y,et[0],et[1]),[xt,Ke]=o.addVertices(Ce,y,mt[0],mt[1]);o.addTriangles([ht,pt,xt,pt,Ke,xt]);const[ft,Ye]=o.addVertices(Be,y,et[1],et[2]),[Qe,At]=o.addVertices(Fe,y,mt[1],mt[2]);o.addTriangles([ft,Ye,Qe,Ye,At,Qe]);const[Et,Kt]=o.addVertices(Is(fe,fe),y,et[2],et[3]),[$t,Bt]=o.addVertices(Is(Ce,Ce),y,mt[2],mt[3]);o.addTriangles([Et,Kt,$t,Kt,Bt,$t])}}constructTunnelStructures(o,l,d,p,_,y){const A=S=>on(S,S);for(let S=_.min;S<_.max;S++){const I=this.prepareEdgePoints(l,d,p[S],(N,U)=>N<U);if(I==null)continue;const[R,P]=I,B=A(ii(P.coord.y-R.coord.y,-(P.coord.x-R.coord.x),0));o.addQuad([R,P,{coord:P.coord,height:p[S].isTunnel?-.1:0},{coord:R.coord,height:p[S].isTunnel?-.1:0}],B)}for(let S=y.min;S<y.max;S++){const I=p[S],R=l[I.a],P=l[I.b],B=A(ii(P.y-R.y,-(P.x-R.x),0));o.addQuad([{coord:P,height:0},{coord:R,height:0},{coord:R,height:d[I.a]+4},{coord:P,height:d[I.b]+4}],B),o.addQuad([{coord:R,height:0},{coord:P,height:0},{coord:P,height:d[I.b]+4},{coord:R,height:d[I.a]+4}],B)}}prepareEdgePoints(o,l,d,p){let _=l[d.a],y=l[d.b];const A=p(_,0),S=p(y,0);if(A&&S)return[{coord:o[d.a],height:_},{coord:o[d.b],height:y}];if(!A&&!S)return;const I=o[d.a].clone(),R=o[d.b].clone();if(A){if(!S){const P=y/(y-_);R.x=ri(R.x,I.x,P),R.y=ri(R.y,I.y,P),y=ri(y,_,P)}}else{const P=_/(_-y);I.x=ri(I.x,R.x,P),I.y=ri(I.y,R.y,P),_=ri(_,y,P)}return[{coord:I,height:_},{coord:R,height:y}]}prepareEdges(o,l){if(l.length===0)return;l.sort((A,S)=>A.hash===S.hash?S.polygonIdx-A.polygonIdx:S.hash>A.hash?1:-1);let d=0,p=0,_=0,y=l[d].polygonIdx;do p++,(p===l.length||l[d].hash!==l[p].hash)&&((p-d==1||l[p-1].polygonIdx!==y)&&(_<d&&(l[_]=l[d],l[d]=null),l[_].type="none",_++),d=p,d!==l.length&&(y=l[d].polygonIdx));while(d!==l.length);if(l.splice(_),l.length!==0&&o.length!==0){l.sort((I,R)=>I.portalHash<R.portalHash?1:-1);let A=0,S=0;for(;A!==l.length&&S!==o.length;){const I=l[A],R=o[S];I.portalHash>R.hash?A++:R.hash>I.portalHash?S++:(I.type=R.type,A++)}}}isOnBorder(o,l){return o<=0&&l<=0||o>=Dt&&l>=Dt}static computeEdgeHash(o,l){return(o.y===l.y&&o.x>l.x||o.y>l.y)&&([o,l]=[l,o]),BigInt(Ko.computePosHash(o))<<32n|BigInt(Ko.computePosHash(l))}static computePosHash(o){return((65535&o.x)<<16|65535&o.y)>>>0}}var UI,VI={exports:{}},$I=(UI||(UI=1,function(h,o){(function(l){function d(he,pe){return he>pe?1:he<pe?-1:0}var p=function(he,pe){he===void 0&&(he=d),pe===void 0&&(pe=!1),this._compare=he,this._root=null,this._size=0,this._noDuplicates=!!pe},_={size:{configurable:!0}};function y(he,pe,tt,Mt,Ft){var Ot=Ft-Mt;if(Ot>0){var Zt=Mt+Math.floor(Ot/2),ci={key:pe[Zt],data:tt[Zt],parent:he};return ci.left=y(ci,pe,tt,Mt,Zt),ci.right=y(ci,pe,tt,Zt+1,Ft),ci}return null}function A(he,pe,tt,Mt,Ft){if(!(tt>=Mt)){for(var Ot=he[tt+Mt>>1],Zt=tt-1,ci=Mt+1;;){do Zt++;while(Ft(he[Zt],Ot)<0);do ci--;while(Ft(he[ci],Ot)>0);if(Zt>=ci)break;var Ni=he[Zt];he[Zt]=he[ci],he[ci]=Ni,Ni=pe[Zt],pe[Zt]=pe[ci],pe[ci]=Ni}A(he,pe,tt,ci,Ft),A(he,pe,ci+1,Mt,Ft)}}p.prototype.rotateLeft=function(he){var pe=he.right;pe&&(he.right=pe.left,pe.left&&(pe.left.parent=he),pe.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=pe:he.parent.right=pe:this._root=pe,pe&&(pe.left=he),he.parent=pe},p.prototype.rotateRight=function(he){var pe=he.left;pe&&(he.left=pe.right,pe.right&&(pe.right.parent=he),pe.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=pe:he.parent.right=pe:this._root=pe,pe&&(pe.right=he),he.parent=pe},p.prototype._splay=function(he){for(;he.parent;){var pe=he.parent;pe.parent?pe.left===he&&pe.parent.left===pe?(this.rotateRight(pe.parent),this.rotateRight(pe)):pe.right===he&&pe.parent.right===pe?(this.rotateLeft(pe.parent),this.rotateLeft(pe)):pe.left===he&&pe.parent.right===pe?(this.rotateRight(pe),this.rotateLeft(pe)):(this.rotateLeft(pe),this.rotateRight(pe)):pe.left===he?this.rotateRight(pe):this.rotateLeft(pe)}},p.prototype.splay=function(he){for(var pe,tt,Mt,Ft,Ot;he.parent;)(tt=(pe=he.parent).parent)&&tt.parent?((Mt=tt.parent).left===tt?Mt.left=he:Mt.right=he,he.parent=Mt):(he.parent=null,this._root=he),Ft=he.left,Ot=he.right,he===pe.left?(tt&&(tt.left===pe?(pe.right?(tt.left=pe.right,tt.left.parent=tt):tt.left=null,pe.right=tt,tt.parent=pe):(Ft?(tt.right=Ft,Ft.parent=tt):tt.right=null,he.left=tt,tt.parent=he)),Ot?(pe.left=Ot,Ot.parent=pe):pe.left=null,he.right=pe,pe.parent=he):(tt&&(tt.right===pe?(pe.left?(tt.right=pe.left,tt.right.parent=tt):tt.right=null,pe.left=tt,tt.parent=pe):(Ot?(tt.left=Ot,Ot.parent=tt):tt.left=null,he.right=tt,tt.parent=he)),Ft?(pe.right=Ft,Ft.parent=pe):pe.right=null,he.left=pe,pe.parent=he)},p.prototype.replace=function(he,pe){he.parent?he===he.parent.left?he.parent.left=pe:he.parent.right=pe:this._root=pe,pe&&(pe.parent=he.parent)},p.prototype.minNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.left;)he=he.left;return he},p.prototype.maxNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.right;)he=he.right;return he},p.prototype.insert=function(he,pe){var tt=this._root,Mt=null,Ft=this._compare;if(this._noDuplicates)for(;tt;){if(Mt=tt,Ft(tt.key,he)===0)return;tt=Ft(tt.key,he)<0?tt.right:tt.left}else for(;tt;)Mt=tt,tt=Ft(tt.key,he)<0?tt.right:tt.left;return tt={key:he,data:pe,left:null,right:null,parent:Mt},Mt?Ft(Mt.key,tt.key)<0?Mt.right=tt:Mt.left=tt:this._root=tt,this.splay(tt),this._size++,tt},p.prototype.find=function(he){for(var pe=this._root,tt=this._compare;pe;){var Mt=tt(pe.key,he);if(Mt<0)pe=pe.right;else{if(!(Mt>0))return pe;pe=pe.left}}return null},p.prototype.contains=function(he){for(var pe=this._root,tt=this._compare;pe;){var Mt=tt(he,pe.key);if(Mt===0)return!0;pe=Mt<0?pe.left:pe.right}return!1},p.prototype.remove=function(he){var pe=this.find(he);if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var tt=this.minNode(pe.right);tt.parent!==pe&&(this.replace(tt,tt.right),tt.right=pe.right,tt.right.parent=tt),this.replace(pe,tt),tt.left=pe.left,tt.left.parent=tt}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},p.prototype.removeNode=function(he){if(!he)return!1;if(this.splay(he),he.left)if(he.right){var pe=this.minNode(he.right);pe.parent!==he&&(this.replace(pe,pe.right),pe.right=he.right,pe.right.parent=pe),this.replace(he,pe),pe.left=he.left,pe.left.parent=pe}else this.replace(he,he.left);else this.replace(he,he.right);return this._size--,!0},p.prototype.erase=function(he){var pe=this.find(he);if(pe){this.splay(pe);var tt=pe.left,Mt=pe.right,Ft=null;tt&&(tt.parent=null,Ft=this.maxNode(tt),this.splay(Ft),this._root=Ft),Mt&&(tt?Ft.right=Mt:this._root=Mt,Mt.parent=Ft),this._size--}},p.prototype.pop=function(){var he=this._root,pe=null;if(he){for(;he.left;)he=he.left;pe={key:he.key,data:he.data},this.remove(he.key)}return pe},p.prototype.next=function(he){var pe=he;if(pe)if(pe.right)for(pe=pe.right;pe&&pe.left;)pe=pe.left;else for(pe=he.parent;pe&&pe.right===he;)he=pe,pe=pe.parent;return pe},p.prototype.prev=function(he){var pe=he;if(pe)if(pe.left)for(pe=pe.left;pe&&pe.right;)pe=pe.right;else for(pe=he.parent;pe&&pe.left===he;)he=pe,pe=pe.parent;return pe},p.prototype.forEach=function(he){for(var pe=this._root,tt=[],Mt=!1,Ft=0;!Mt;)pe?(tt.push(pe),pe=pe.left):tt.length>0?(he(pe=tt.pop(),Ft++),pe=pe.right):Mt=!0;return this},p.prototype.range=function(he,pe,tt,Mt){for(var Ft=[],Ot=this._compare,Zt=this._root;Ft.length!==0||Zt;)if(Zt)Ft.push(Zt),Zt=Zt.left;else{if(Ot((Zt=Ft.pop()).key,pe)>0)break;if(Ot(Zt.key,he)>=0&&tt.call(Mt,Zt))return this;Zt=Zt.right}return this},p.prototype.keys=function(){for(var he=this._root,pe=[],tt=[],Mt=!1;!Mt;)he?(pe.push(he),he=he.left):pe.length>0?(he=pe.pop(),tt.push(he.key),he=he.right):Mt=!0;return tt},p.prototype.values=function(){for(var he=this._root,pe=[],tt=[],Mt=!1;!Mt;)he?(pe.push(he),he=he.left):pe.length>0?(he=pe.pop(),tt.push(he.data),he=he.right):Mt=!0;return tt},p.prototype.at=function(he){for(var pe=this._root,tt=[],Mt=!1,Ft=0;!Mt;)if(pe)tt.push(pe),pe=pe.left;else if(tt.length>0){if(pe=tt.pop(),Ft===he)return pe;Ft++,pe=pe.right}else Mt=!0;return null},p.prototype.load=function(he,pe,tt){if(he===void 0&&(he=[]),pe===void 0&&(pe=[]),tt===void 0&&(tt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Mt=he.length;return tt&&A(he,pe,0,Mt-1,this._compare),this._root=y(null,he,pe,0,Mt),this._size=Mt,this},p.prototype.min=function(){var he=this.minNode(this._root);return he?he.key:null},p.prototype.max=function(){var he=this.maxNode(this._root);return he?he.key:null},p.prototype.isEmpty=function(){return this._root===null},_.size.get=function(){return this._size},p.createTree=function(he,pe,tt,Mt,Ft){return new p(tt,Ft).load(he,pe,Mt)},Object.defineProperties(p.prototype,_);var S=0,I=1,R=2,P=3,B=0,N=1,U=2,j=3;function K(he,pe,tt){pe===null?(he.inOut=!1,he.otherInOut=!0):(he.isSubject===pe.isSubject?(he.inOut=!pe.inOut,he.otherInOut=pe.otherInOut):(he.inOut=!pe.otherInOut,he.otherInOut=pe.isVertical()?!pe.inOut:pe.inOut),pe&&(he.prevInResult=!ee(pe,tt)||pe.isVertical()?pe.prevInResult:pe));var Mt=ee(he,tt);he.resultTransition=Mt?function(Ft,Ot){var Zt,ci=!Ft.inOut,Ni=!Ft.otherInOut;switch(Ot){case B:Zt=ci&&Ni;break;case N:Zt=ci||Ni;break;case j:Zt=ci^Ni;break;case U:Zt=Ft.isSubject?ci&&!Ni:Ni&&!ci}return Zt?1:-1}(he,tt):0}function ee(he,pe){switch(he.type){case S:switch(pe){case B:return!he.otherInOut;case N:return he.otherInOut;case U:return he.isSubject&&he.otherInOut||!he.isSubject&&!he.otherInOut;case j:return!0}break;case R:return pe===B||pe===N;case P:return pe===U;case I:return!1}return!1}var le=function(he,pe,tt,Mt,Ft){this.left=pe,this.point=he,this.otherEvent=tt,this.isSubject=Mt,this.type=Ft||S,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},re={inResult:{configurable:!0}};function G(he,pe){return he[0]===pe[0]&&he[1]===pe[1]}le.prototype.isBelow=function(he){var pe=this.point,tt=this.otherEvent.point;return this.left?(pe[0]-he[0])*(tt[1]-he[1])-(tt[0]-he[0])*(pe[1]-he[1])>0:(tt[0]-he[0])*(pe[1]-he[1])-(pe[0]-he[0])*(tt[1]-he[1])>0},le.prototype.isAbove=function(he){return!this.isBelow(he)},le.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},re.inResult.get=function(){return this.resultTransition!==0},le.prototype.clone=function(){var he=new le(this.point,this.left,this.otherEvent,this.isSubject,this.type);return he.contourId=this.contourId,he.resultTransition=this.resultTransition,he.prevInResult=this.prevInResult,he.isExteriorRing=this.isExteriorRing,he.inOut=this.inOut,he.otherInOut=this.otherInOut,he},Object.defineProperties(le.prototype,re);var ie=11102230246251565e-32,ae=134217729,fe=(3+8*ie)*ie;function Ce(he,pe,tt,Mt,Ft){var Ot,Zt,ci,Ni,Ui=pe[0],Ii=Mt[0],dn=0,Tn=0;Ii>Ui==Ii>-Ui?(Ot=Ui,Ui=pe[++dn]):(Ot=Ii,Ii=Mt[++Tn]);var Vi=0;if(dn<he&&Tn<tt)for(Ii>Ui==Ii>-Ui?(ci=Ot-((Zt=Ui+Ot)-Ui),Ui=pe[++dn]):(ci=Ot-((Zt=Ii+Ot)-Ii),Ii=Mt[++Tn]),Ot=Zt,ci!==0&&(Ft[Vi++]=ci);dn<he&&Tn<tt;)Ii>Ui==Ii>-Ui?(ci=Ot-((Zt=Ot+Ui)-(Ni=Zt-Ot))+(Ui-Ni),Ui=pe[++dn]):(ci=Ot-((Zt=Ot+Ii)-(Ni=Zt-Ot))+(Ii-Ni),Ii=Mt[++Tn]),Ot=Zt,ci!==0&&(Ft[Vi++]=ci);for(;dn<he;)ci=Ot-((Zt=Ot+Ui)-(Ni=Zt-Ot))+(Ui-Ni),Ui=pe[++dn],Ot=Zt,ci!==0&&(Ft[Vi++]=ci);for(;Tn<tt;)ci=Ot-((Zt=Ot+Ii)-(Ni=Zt-Ot))+(Ii-Ni),Ii=Mt[++Tn],Ot=Zt,ci!==0&&(Ft[Vi++]=ci);return Ot===0&&Vi!==0||(Ft[Vi++]=Ot),Vi}function Be(he){return new Float64Array(he)}var Fe=33306690738754716e-32,Ve=22204460492503146e-32,et=11093356479670487e-47,mt=Be(4),ht=Be(8),pt=Be(12),xt=Be(16),Ke=Be(4);function ft(he,pe,tt){var Mt=function(Ft,Ot,Zt,ci,Ni,Ui){var Ii=(Ot-Ui)*(Zt-Ni),dn=(Ft-Ni)*(ci-Ui),Tn=Ii-dn;if(Ii===0||dn===0||Ii>0!=dn>0)return Tn;var Vi=Math.abs(Ii+dn);return Math.abs(Tn)>=Fe*Vi?Tn:-function(Xn,kn,ln,lr,Dn,Sn,Pn){var fn,ki,_n,qn,li,Gi,Bn,ir,Nn,Br,xn,Ir,wo,bs,us,Ao,yc,Or,Vr=Xn-Dn,vs=ln-Dn,Gs=kn-Sn,Ds=lr-Sn;mt[0]=(us=(ir=Vr-(Bn=(Gi=ae*Vr)-(Gi-Vr)))*(Br=Ds-(Nn=(Gi=ae*Ds)-(Gi-Ds)))-((bs=Vr*Ds)-Bn*Nn-ir*Nn-Bn*Br))-((xn=us-(yc=(ir=Gs-(Bn=(Gi=ae*Gs)-(Gi-Gs)))*(Br=vs-(Nn=(Gi=ae*vs)-(Gi-vs)))-((Ao=Gs*vs)-Bn*Nn-ir*Nn-Bn*Br)))+(li=us-xn))+(li-yc),mt[1]=(wo=bs-((Ir=bs+xn)-(li=Ir-bs))+(xn-li))-((xn=wo-Ao)+(li=wo-xn))+(li-Ao),mt[2]=Ir-((Or=Ir+xn)-(li=Or-Ir))+(xn-li),mt[3]=Or;var bu=function(Lue,GR){for(var XR=GR[0],RT=1;RT<4;RT++)XR+=GR[RT];return XR}(0,mt),H_=Ve*Pn;if(bu>=H_||-bu>=H_||(fn=Xn-(Vr+(li=Xn-Vr))+(li-Dn),_n=ln-(vs+(li=ln-vs))+(li-Dn),ki=kn-(Gs+(li=kn-Gs))+(li-Sn),qn=lr-(Ds+(li=lr-Ds))+(li-Sn),fn===0&&ki===0&&_n===0&&qn===0)||(H_=et*Pn+fe*Math.abs(bu),(bu+=Vr*qn+Ds*fn-(Gs*_n+vs*ki))>=H_||-bu>=H_))return bu;Ke[0]=(us=(ir=fn-(Bn=(Gi=ae*fn)-(Gi-fn)))*(Br=Ds-(Nn=(Gi=ae*Ds)-(Gi-Ds)))-((bs=fn*Ds)-Bn*Nn-ir*Nn-Bn*Br))-((xn=us-(yc=(ir=ki-(Bn=(Gi=ae*ki)-(Gi-ki)))*(Br=vs-(Nn=(Gi=ae*vs)-(Gi-vs)))-((Ao=ki*vs)-Bn*Nn-ir*Nn-Bn*Br)))+(li=us-xn))+(li-yc),Ke[1]=(wo=bs-((Ir=bs+xn)-(li=Ir-bs))+(xn-li))-((xn=wo-Ao)+(li=wo-xn))+(li-Ao),Ke[2]=Ir-((Or=Ir+xn)-(li=Or-Ir))+(xn-li),Ke[3]=Or;var MU=Ce(4,mt,4,Ke,ht);Ke[0]=(us=(ir=Vr-(Bn=(Gi=ae*Vr)-(Gi-Vr)))*(Br=qn-(Nn=(Gi=ae*qn)-(Gi-qn)))-((bs=Vr*qn)-Bn*Nn-ir*Nn-Bn*Br))-((xn=us-(yc=(ir=Gs-(Bn=(Gi=ae*Gs)-(Gi-Gs)))*(Br=_n-(Nn=(Gi=ae*_n)-(Gi-_n)))-((Ao=Gs*_n)-Bn*Nn-ir*Nn-Bn*Br)))+(li=us-xn))+(li-yc),Ke[1]=(wo=bs-((Ir=bs+xn)-(li=Ir-bs))+(xn-li))-((xn=wo-Ao)+(li=wo-xn))+(li-Ao),Ke[2]=Ir-((Or=Ir+xn)-(li=Or-Ir))+(xn-li),Ke[3]=Or;var RU=Ce(MU,ht,4,Ke,pt);Ke[0]=(us=(ir=fn-(Bn=(Gi=ae*fn)-(Gi-fn)))*(Br=qn-(Nn=(Gi=ae*qn)-(Gi-qn)))-((bs=fn*qn)-Bn*Nn-ir*Nn-Bn*Br))-((xn=us-(yc=(ir=ki-(Bn=(Gi=ae*ki)-(Gi-ki)))*(Br=_n-(Nn=(Gi=ae*_n)-(Gi-_n)))-((Ao=ki*_n)-Bn*Nn-ir*Nn-Bn*Br)))+(li=us-xn))+(li-yc),Ke[1]=(wo=bs-((Ir=bs+xn)-(li=Ir-bs))+(xn-li))-((xn=wo-Ao)+(li=wo-xn))+(li-Ao),Ke[2]=Ir-((Or=Ir+xn)-(li=Or-Ir))+(xn-li),Ke[3]=Or;var kU=Ce(RU,pt,4,Ke,xt);return xt[kU-1]}(Ft,Ot,Zt,ci,Ni,Ui,Vi)}(he[0],he[1],pe[0],pe[1],tt[0],tt[1]);return Mt>0?-1:Mt<0?1:0}function Ye(he,pe){var tt=he.point,Mt=pe.point;return tt[0]>Mt[0]?1:tt[0]<Mt[0]?-1:tt[1]!==Mt[1]?tt[1]>Mt[1]?1:-1:function(Ft,Ot,Zt,ci){return Ft.left!==Ot.left?Ft.left?1:-1:ft(Zt,Ft.otherEvent.point,Ot.otherEvent.point)!==0?Ft.isBelow(Ot.otherEvent.point)?-1:1:!Ft.isSubject&&Ot.isSubject?1:-1}(he,pe,tt)}function Qe(he,pe,tt){var Mt=new le(pe,!1,he,he.isSubject),Ft=new le(pe,!0,he.otherEvent,he.isSubject);return G(he.point,he.otherEvent.point)&&console.warn("what is that, a collapsed segment?",he),Mt.contourId=Ft.contourId=he.contourId,Ye(Ft,he.otherEvent)>0&&(he.otherEvent.left=!0,Ft.left=!1),he.otherEvent.otherEvent=Ft,he.otherEvent=Mt,tt.push(Ft),tt.push(Mt),tt}function At(he,pe){return he[0]*pe[1]-he[1]*pe[0]}function Et(he,pe){return he[0]*pe[0]+he[1]*pe[1]}function Kt(he,pe,tt){var Mt=function(Ni,Ui,Ii,dn,Tn){var Vi=[Ui[0]-Ni[0],Ui[1]-Ni[1]],Xn=[dn[0]-Ii[0],dn[1]-Ii[1]];function kn(Gi,Bn,ir){return[Gi[0]+Bn*ir[0],Gi[1]+Bn*ir[1]]}var ln=[Ii[0]-Ni[0],Ii[1]-Ni[1]],lr=At(Vi,Xn),Dn=lr*lr,Sn=Et(Vi,Vi);if(Dn>0){var Pn=At(ln,Xn)/lr;if(Pn<0||Pn>1)return null;var fn=At(ln,Vi)/lr;return fn<0||fn>1?null:Pn===0||Pn===1?[kn(Ni,Pn,Vi)]:fn===0||fn===1?[kn(Ii,fn,Xn)]:[kn(Ni,Pn,Vi)]}if((Dn=(lr=At(ln,Vi))*lr)>0)return null;var ki=Et(Vi,ln)/Sn,_n=ki+Et(Vi,Xn)/Sn,qn=Math.min(ki,_n),li=Math.max(ki,_n);return qn<=1&&li>=0?qn===1?[kn(Ni,qn>0?qn:0,Vi)]:li===0?[kn(Ni,li<1?li:1,Vi)]:[kn(Ni,qn>0?qn:0,Vi),kn(Ni,li<1?li:1,Vi)]:null}(he.point,he.otherEvent.point,pe.point,pe.otherEvent.point),Ft=Mt?Mt.length:0;if(Ft===0||Ft===1&&(G(he.point,pe.point)||G(he.otherEvent.point,pe.otherEvent.point))||Ft===2&&he.isSubject===pe.isSubject)return 0;if(Ft===1)return G(he.point,Mt[0])||G(he.otherEvent.point,Mt[0])||Qe(he,Mt[0],tt),G(pe.point,Mt[0])||G(pe.otherEvent.point,Mt[0])||Qe(pe,Mt[0],tt),1;var Ot=[],Zt=!1,ci=!1;return G(he.point,pe.point)?Zt=!0:Ye(he,pe)===1?Ot.push(pe,he):Ot.push(he,pe),G(he.otherEvent.point,pe.otherEvent.point)?ci=!0:Ye(he.otherEvent,pe.otherEvent)===1?Ot.push(pe.otherEvent,he.otherEvent):Ot.push(he.otherEvent,pe.otherEvent),Zt&&ci||Zt?(pe.type=I,he.type=pe.inOut===he.inOut?R:P,Zt&&!ci&&Qe(Ot[1].otherEvent,Ot[0].point,tt),2):ci?(Qe(Ot[0],Ot[1].point,tt),3):Ot[0]!==Ot[3].otherEvent?(Qe(Ot[0],Ot[1].point,tt),Qe(Ot[1],Ot[2].point,tt),3):(Qe(Ot[0],Ot[1].point,tt),Qe(Ot[3].otherEvent,Ot[2].point,tt),3)}function $t(he,pe){if(he===pe)return 0;if(ft(he.point,he.otherEvent.point,pe.point)!==0||ft(he.point,he.otherEvent.point,pe.otherEvent.point)!==0)return G(he.point,pe.point)?he.isBelow(pe.otherEvent.point)?-1:1:he.point[0]===pe.point[0]?he.point[1]<pe.point[1]?-1:1:Ye(he,pe)===1?pe.isAbove(he.point)?-1:1:he.isBelow(pe.point)?-1:1;if(he.isSubject!==pe.isSubject)return he.isSubject?-1:1;var tt=he.point,Mt=pe.point;return tt[0]===Mt[0]&&tt[1]===Mt[1]?(tt=he.otherEvent.point)[0]===(Mt=pe.otherEvent.point)[0]&&tt[1]===Mt[1]?0:he.contourId>pe.contourId?1:-1:Ye(he,pe)===1?1:-1}var Bt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function wt(he,pe,tt,Mt){var Ft,Ot=he+1,Zt=pe[he].point,ci=pe.length;for(Ot<ci&&(Ft=pe[Ot].point);Ot<ci&&Ft[0]===Zt[0]&&Ft[1]===Zt[1];){if(!tt[Ot])return Ot;++Ot<ci&&(Ft=pe[Ot].point)}for(Ot=he-1;tt[Ot]&&Ot>Mt;)Ot--;return Ot}Bt.prototype.isExterior=function(){return this.holeOf==null};var pi=qt,Xt=qt;function qt(he,pe){if(!(this instanceof qt))return new qt(he,pe);if(this.data=he||[],this.length=this.data.length,this.compare=pe||ui,this.length>0)for(var tt=(this.length>>1)-1;tt>=0;tt--)this._down(tt)}function ui(he,pe){return he<pe?-1:he>pe?1:0}qt.prototype={push:function(he){this.data.push(he),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var he=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),he}},peek:function(){return this.data[0]},_up:function(he){for(var pe=this.data,tt=this.compare,Mt=pe[he];he>0;){var Ft=he-1>>1,Ot=pe[Ft];if(tt(Mt,Ot)>=0)break;pe[he]=Ot,he=Ft}pe[he]=Mt},_down:function(he){for(var pe=this.data,tt=this.compare,Mt=this.length>>1,Ft=pe[he];he<Mt;){var Ot=1+(he<<1),Zt=Ot+1,ci=pe[Ot];if(Zt<this.length&&tt(pe[Zt],ci)<0&&(Ot=Zt,ci=pe[Zt]),tt(ci,Ft)>=0)break;pe[he]=ci,he=Ot}pe[he]=Ft}},pi.default=Xt;var Ai=Math.max,Ti=Math.min,Di=0;function Mi(he,pe,tt,Mt,Ft,Ot){var Zt,ci,Ni,Ui,Ii,dn;for(Zt=0,ci=he.length-1;Zt<ci;Zt++)if(Ui=he[Zt+1],Ii=new le(Ni=he[Zt],!1,void 0,pe),dn=new le(Ui,!1,Ii,pe),Ii.otherEvent=dn,Ni[0]!==Ui[0]||Ni[1]!==Ui[1]){Ii.contourId=dn.contourId=tt,Ot||(Ii.isExteriorRing=!1,dn.isExteriorRing=!1),Ye(Ii,dn)>0?dn.left=!0:Ii.left=!0;var Tn=Ni[0],Vi=Ni[1];Ft[0]=Ti(Ft[0],Tn),Ft[1]=Ti(Ft[1],Vi),Ft[2]=Ai(Ft[2],Tn),Ft[3]=Ai(Ft[3],Vi),Mt.push(Ii),Mt.push(dn)}}var Ci=[];function vn(he,pe,tt){typeof he[0][0][0]=="number"&&(he=[he]),typeof pe[0][0][0]=="number"&&(pe=[pe]);var Mt=function(Vi,Xn,kn){var ln=null;return Vi.length*Xn.length==0&&(kn===B?ln=Ci:kn===U?ln=Vi:kn!==N&&kn!==j||(ln=Vi.length===0?Xn:Vi)),ln}(he,pe,tt);if(Mt)return Mt===Ci?null:Mt;var Ft=[1/0,1/0,-1/0,-1/0],Ot=[1/0,1/0,-1/0,-1/0],Zt=function(Vi,Xn,kn,ln,lr){var Dn,Sn,Pn,fn,ki,_n,qn=new pi(null,Ye);for(Pn=0,fn=Vi.length;Pn<fn;Pn++)for(ki=0,_n=(Dn=Vi[Pn]).length;ki<_n;ki++)(Sn=ki===0)&&Di++,Mi(Dn[ki],!0,Di,qn,kn,Sn);for(Pn=0,fn=Xn.length;Pn<fn;Pn++)for(ki=0,_n=(Dn=Xn[Pn]).length;ki<_n;ki++)Sn=ki===0,lr===U&&(Sn=!1),Sn&&Di++,Mi(Dn[ki],!1,Di,qn,ln,Sn);return qn}(he,pe,Ft,Ot,tt);if(Mt=function(Vi,Xn,kn,ln,lr){var Dn=null;return(kn[0]>ln[2]||ln[0]>kn[2]||kn[1]>ln[3]||ln[1]>kn[3])&&(lr===B?Dn=Ci:lr===U?Dn=Vi:lr!==N&&lr!==j||(Dn=Vi.concat(Xn))),Dn}(he,pe,Ft,Ot,tt))return Mt===Ci?null:Mt;for(var ci=function(Vi){var Xn,kn,ln=function(Pn){var fn,ki,_n,qn,li=[];for(ki=0,_n=Pn.length;ki<_n;ki++)((fn=Pn[ki]).left&&fn.inResult||!fn.left&&fn.otherEvent.inResult)&&li.push(fn);for(var Gi=!1;!Gi;)for(Gi=!0,ki=0,_n=li.length;ki<_n;ki++)ki+1<_n&&Ye(li[ki],li[ki+1])===1&&(qn=li[ki],li[ki]=li[ki+1],li[ki+1]=qn,Gi=!1);for(ki=0,_n=li.length;ki<_n;ki++)(fn=li[ki]).otherPos=ki;for(ki=0,_n=li.length;ki<_n;ki++)(fn=li[ki]).left||(qn=fn.otherPos,fn.otherPos=fn.otherEvent.otherPos,fn.otherEvent.otherPos=qn);return li}(Vi),lr={},Dn=[],Sn=function(){if(!lr[Xn]){var Pn=Dn.length,fn=function(li,Gi,Bn){var ir=new Bt;if(li.prevInResult!=null){var Nn=li.prevInResult,Br=Nn.outputContourId;if(Nn.resultTransition>0){var xn=Gi[Br];if(xn.holeOf!=null){var Ir=xn.holeOf;Gi[Ir].holeIds.push(Bn),ir.holeOf=Ir,ir.depth=Gi[Br].depth}else Gi[Br].holeIds.push(Bn),ir.holeOf=Br,ir.depth=Gi[Br].depth+1}else ir.holeOf=null,ir.depth=Gi[Br].depth}else ir.holeOf=null,ir.depth=0;return ir}(ln[Xn],Dn,Pn),ki=function(li){lr[li]=!0,li<ln.length&&ln[li]&&(ln[li].outputContourId=Pn)},_n=Xn,qn=Xn;for(fn.points.push(ln[Xn].point);ki(_n),ki(_n=ln[_n].otherPos),fn.points.push(ln[_n].point),!((_n=wt(_n,ln,lr,qn))==qn||_n>=ln.length)&&ln[_n];);Dn.push(fn)}};for(Xn=0,kn=ln.length;Xn<kn;Xn++)Sn();return Dn}(function(Vi,Xn,kn,ln,lr,Dn){for(var Sn,Pn,fn,ki=new p($t),_n=[],qn=Math.min(ln[2],lr[2]);Vi.length!==0;){var li=Vi.pop();if(_n.push(li),Dn===B&&li.point[0]>qn||Dn===U&&li.point[0]>ln[2])break;if(li.left){Pn=Sn=ki.insert(li),Sn=Sn!==(fn=ki.minNode())?ki.prev(Sn):null,Pn=ki.next(Pn);var Gi=Sn?Sn.key:null;if(K(li,Gi,Dn),Pn&&Kt(li,Pn.key,Vi)===2&&(K(li,Gi,Dn),K(Pn.key,li,Dn)),Sn&&Kt(Sn.key,li,Vi)===2){var Bn=Sn;K(Gi,(Bn=Bn!==fn?ki.prev(Bn):null)?Bn.key:null,Dn),K(li,Gi,Dn)}}else Pn=Sn=ki.find(li=li.otherEvent),Sn&&Pn&&(Sn=Sn!==fn?ki.prev(Sn):null,Pn=ki.next(Pn),ki.remove(li),Pn&&Sn&&Kt(Sn.key,Pn.key,Vi))}return _n}(Zt,0,0,Ft,Ot,tt)),Ni=[],Ui=0;Ui<ci.length;Ui++){var Ii=ci[Ui];if(Ii.isExterior()){for(var dn=[Ii.points],Tn=0;Tn<Ii.holeIds.length;Tn++)dn.push(ci[Ii.holeIds[Tn]].points);Ni.push(dn)}}return Ni}var Rn={UNION:N,DIFFERENCE:U,INTERSECTION:B,XOR:j};l.diff=function(he,pe){return vn(he,pe,U)},l.intersection=function(he,pe){return vn(he,pe,B)},l.operations=Rn,l.union=function(he,pe){return vn(he,pe,N)},l.xor=function(he,pe){return vn(he,pe,j)},Object.defineProperty(l,"__esModule",{value:!0})})(o)}(0,VI.exports)),VI.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Xb(h,o,l,d){const p=[],_=d===0?(y,A,S,I,R,P)=>{y.push(new ue(P,S+(P-A)/(I-A)*(R-S)))}:(y,A,S,I,R,P)=>{y.push(new ue(A+(P-S)/(R-S)*(I-A),P))};for(const y of h){const A=[];for(const S of y){if(S.length<=2)continue;const I=[];for(let B=0;B<S.length-1;B++){const N=S[B].x,U=S[B].y,j=S[B+1].x,K=S[B+1].y,ee=d===0?N:U,le=d===0?j:K;ee<o?le>o&&_(I,N,U,j,K,o):ee>l?le<l&&_(I,N,U,j,K,l):I.push(S[B]),le<o&&ee>=o&&_(I,N,U,j,K,o),le>l&&ee<=l&&_(I,N,U,j,K,l)}let R=S[S.length-1];const P=d===0?R.x:R.y;P>=o&&P<=l&&I.push(R),I.length&&(R=I[I.length-1],I[0].x===R.x&&I[0].y===R.y||I.push(I[0]),A.push(I))}A.length&&p.push(A)}return p}function GN(h,o){const l=CA(h),d=CA([o]),p=$I.intersection(l,d);return p==null?[]:jI(p)}function XN(h,o){let d=CA(h,65536);for(;o.valid();o.next()){const[p,_]=o.get(),y=p.x*65536,A=p.y*65536,S=_.x*65536,I=_.y*65536,R=S-y,P=I-A,B=Math.hypot(R,P),N=Math.trunc(P/B*3),U=-Math.trunc(R/B*3);d=$I.diff(d,[[[y,A],[S,I],[S+N,I+U],[y+N,A+U],[y,A]]])}return jI(d,1/65536)}function CA(h,o=1){return[h.map(l=>l.map(d=>[d.x*o,d.y*o]))]}function jI(h,o=1){return h.map(l=>l.map((d,p)=>{const _=d.map(y=>new ue(y[0]*o,y[1]*o).round());return p>0&&_.reverse(),_}))}class IA{constructor(o,l){this.layoutVertexArray=new Al,this.indexArray=new qr,this.lineIndexArray=new dc,this.triangleSegments=new Gn,this.lineSegments=new Gn,this.programConfigurations=new hh(o.layers,{zoom:o.zoom,lut:o.lut}),this.uploaded=!1,l&&(this.elevatedLayoutVertexArray=new iu)}update(o,l,d,p,_,y,A){this.programConfigurations.updatePaintArrays(o,l,_,d,p,y,A)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,IN.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.lineIndexBuffer=o.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,MN.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(o,l,d,p,_,y){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,l,d,p,_,y)}}class MA{constructor(o){this.zoom=o.zoom,this.pixelRatio=o.pixelRatio,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new IA(o,!1),this.elevationBufferData=new IA(o,!0),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(o,l){}populate(o,l,d,p){this.hasPattern=vA("fill",this.layers,this.pixelRatio,l);const _=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:A,id:S,index:I,sourceLayerIndex:R}of o){const P=this.layers[0]._featureFilter.needGeometry,B=Jt(A,P);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),B,d))continue;const N=_?_.evaluate(B,{},d,l.availableImages):void 0,U={id:S,properties:A.properties,type:A.type,sourceLayerIndex:R,index:I,geometry:P?B.geometry:jt(A,d,p),patterns:{},sortKey:N};y.push(U)}_&&y.sort((A,S)=>A.sortKey-S.sortKey);for(const A of y){const{geometry:S,index:I,sourceLayerIndex:R}=A;if(this.hasPattern){const P=xA("fill",this.layers,A,this.zoom,this.pixelRatio,l);this.patternFeatures.push(P)}else this.addFeature(A,S,I,d,{},l.availableImages,l.brightness,l.elevationFeatures);l.featureIndex.insert(o[I].feature,S,I,R,this.index)}}update(o,l,d,p,_,y,A){this.bufferData.update(o,l,d,p,_,y,A),this.elevationBufferData.update(o,l,d,p,_,y,A)}addFeatures(o,l,d,p,_,y){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,l,d,p,y,o.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(o){this.bufferData.upload(o),this.elevationBufferData.upload(o),this.elevatedStructures&&this.elevatedStructures.upload(o)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(o,l,d,p,_,y=[],A,S){const I=Wb(l,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(o,I,p,d,S):this.addGeometry(I,this.bufferData),this.bufferData.populatePaintArrays(o,d,_,y,p,A),this.elevationBufferData.populatePaintArrays(o,d,_,y,p,A)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(o){this.elevatedStructures&&this.elevatedStructures.construct(o)}addElevatedRoadFeature(o,l,d,p,_){const y=new Array,A=EA.getElevationFeature(o,_);if(A){{const S=this.clipPolygonsToTile(l,1);S.length>0&&y.push({polygons:S,elevationFeature:A,elevationTileID:d})}for(const S of y)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ko(S.elevationTileID));const R=S.elevationFeature.isTunnel();let P=0;o.properties.hasOwnProperty(OI)&&(P=+o.properties[OI]);for(const B of S.polygons)this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,B,R,S.elevationFeature,P)}S.elevationFeature.constantHeight==null&&(S.polygons=this.prepareElevatedPolygons(S.polygons,S.elevationFeature,S.elevationTileID));const I=new zI(d,S.elevationTileID);this.addElevatedGeometry(S.polygons,I,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p)}}else this.addGeometry(l,this.bufferData)}addElevatedGeometry(o,l,d,p,_){const y={elevation:d,elevationSampler:l,bias:p,index:_},[A,S]=this.addGeometry(o,this.elevationBufferData,y);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:A,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,A),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(o,l,d){let p=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,y=null;d&&(y=d.elevationSampler.constantElevation(d.elevation,d.bias),y!=null&&(p=y,_=y));const A=(S,I,R)=>{if(d!=null)if(I.push(S),y!=null)l.elevatedLayoutVertexArray.emplaceBack(y),R.push(y);else{const P=d.elevationSampler.pointElevation(S,d.elevation,d.bias);l.elevatedLayoutVertexArray.emplaceBack(P),R.push(P),p=Math.min(p,P),_=Math.max(_,P)}};for(const S of o){let I=0;for(const re of S)I+=re.length;const R=l.triangleSegments.prepareSegment(I,l.layoutVertexArray,l.indexArray),P=R.vertexLength,B=[],N=[],U=[],j=[],K=[],ee=l.layoutVertexArray.length;for(const re of S){if(re.length===0)continue;re!==S[0]&&N.push(B.length/2);const G=l.lineSegments.prepareSegment(re.length,l.layoutVertexArray,l.lineIndexArray),ie=G.vertexLength;d&&K.push(l.layoutVertexArray.length-ee),A(re[0],U,j),l.layoutVertexArray.emplaceBack(re[0].x,re[0].y),l.lineIndexArray.emplaceBack(ie+re.length-1,ie),B.push(re[0].x),B.push(re[0].y);for(let ae=1;ae<re.length;ae++)A(re[ae],U,j),l.layoutVertexArray.emplaceBack(re[ae].x,re[ae].y),l.lineIndexArray.emplaceBack(ie+ae-1,ie+ae),B.push(re[ae].x),B.push(re[ae].y);G.vertexLength+=re.length,G.primitiveLength+=re.length}const le=d_(B,N);for(let re=0;re<le.length;re+=3)l.indexArray.emplaceBack(P+le[re],P+le[re+1],P+le[re+2]);if(le.length>0&&d&&this.elevationMode==="hd-road-base"){const re=d.elevation.isTunnel(),G=d.elevation.safeArea,ie=this.elevatedStructures.addVertices(U,j);this.elevatedStructures.addTriangles(le,ie,re);const ae=K.length;if(ae>0){for(let fe=0;fe<ae-1;fe++)this.elevatedStructures.addRenderableRing(d.index,K[fe]+ie,K[fe+1]-K[fe],re,G);this.elevatedStructures.addRenderableRing(d.index,K[ae-1]+ie,U.length-K[ae-1],re,G)}}R.vertexLength+=I,R.primitiveLength+=le.length/3}return[p,_]}prepareElevatedPolygons(o,l,d){const p=1/$e(d),_=[];for(const y of o){const A=XN(y,new LI(l,p));_.push(...A)}return _}clipPolygonsToTile(o,l){const d=-l,p=-l,_=Dt+l,y=Dt+l;let A=0;const S=[],I=[];for(;A<o.length;A++){const B=o[A],N=fg(B);(N.min.x>=d&&N.max.x<=_&&N.min.y>=p&&N.max.y<=y?S:I).push(B)}if(S.length===o.length)return o;const R=[new ue(d,p),new ue(_,p),new ue(_,y),new ue(d,y),new ue(d,p)],P=S;for(const B of I)P.push(...GN(B,R));return P}}let HI,WI,GI,XI;Ut(MA,"FillBucket",{omit:["layers","patternFeatures"]}),Ut(IA,"FillBufferData"),Ut(Ko,"ElevatedStructures");class RA{constructor(o,l,d,p){if(this.triangleCount=l.length/3,this.min=new ue(0,0),this.max=new ue(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||o.length===0)return;const[_,y]=[o[0].clone(),o[0].clone()];for(let P=1;P<o.length;++P){const B=o[P];_.x=Math.min(_.x,B.x),_.y=Math.min(_.y,B.y),y.x=Math.max(y.x,B.x),y.y=Math.max(y.y,B.y)}if(p){const P=Math.ceil(Math.max(y.x-_.x,y.y-_.y)/p);d=Math.max(d,P)}if(d===0)return;this.min=_,this.max=y;const A=this.max.sub(this.min);A.x=Math.max(A.x,1),A.y=Math.max(A.y,1);const S=Math.max(A.x,A.y)/d;this.cellsX=Math.max(1,Math.ceil(A.x/S)),this.cellsY=Math.max(1,Math.ceil(A.y/S)),this.xScale=1/S,this.yScale=1/S;const I=[];for(let P=0;P<this.triangleCount;P++){const B=o[l[3*P+0]].sub(this.min),N=o[l[3*P+1]].sub(this.min),U=o[l[3*P+2]].sub(this.min),j=gc(Math.floor(Math.min(B.x,N.x,U.x)),this.xScale,this.cellsX),K=gc(Math.floor(Math.max(B.x,N.x,U.x)),this.xScale,this.cellsX),ee=gc(Math.floor(Math.min(B.y,N.y,U.y)),this.yScale,this.cellsY),le=gc(Math.floor(Math.max(B.y,N.y,U.y)),this.yScale,this.cellsY),re=new ue(0,0),G=new ue(0,0),ie=new ue(0,0),ae=new ue(0,0);for(let fe=ee;fe<=le;++fe){re.y=G.y=fe*S,ie.y=ae.y=(fe+1)*S;for(let Ce=j;Ce<=K;++Ce)re.x=ie.x=Ce*S,G.x=ae.x=(Ce+1)*S,(Vn(B,N,U,re,G,ae)||Vn(B,N,U,re,ae,ie))&&I.push({cellIdx:fe*this.cellsX+Ce,triIdx:P})}}if(I.length===0)return;I.sort((P,B)=>P.cellIdx-B.cellIdx||P.triIdx-B.triIdx);let R=0;for(;R<I.length;){const P=I[R].cellIdx,B={start:this.payload.length,len:0};for(;R<I.length&&I[R].cellIdx===P;)++B.len,this.payload.push(I[R++].triIdx);this.cells[P]=B}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,l){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const d=gc(o.x-this.min.x,this.xScale,this.cellsX),p=gc(o.y-this.min.y,this.yScale,this.cellsY),_=this.cells[p*this.cellsX+d];if(_){this._lazyInitLookup();for(let y=0;y<_.len;y++){const A=this.payload[_.start+y],S=Math.floor(A/8),I=1<<A%8;if(!(this.lookup[S]&I)&&(this.lookup[S]|=I,l.push(A),l.length===this.triangleCount))return}}}query(o,l,d){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>l.x||o.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const p=gc(o.x-this.min.x,this.xScale,this.cellsX),_=gc(l.x-this.min.x,this.xScale,this.cellsX),y=gc(o.y-this.min.y,this.yScale,this.cellsY),A=gc(l.y-this.min.y,this.yScale,this.cellsY);for(let S=y;S<=A;S++)for(let I=p;I<=_;I++){const R=this.cells[S*this.cellsX+I];if(R)for(let P=0;P<R.len;P++){const B=this.payload[R.start+P],N=Math.floor(B/8),U=1<<B%8;if(!(this.lookup[N]&U)&&(this.lookup[N]|=U,d.push(B),d.length===this.triangleCount))return}}}}function gc(h,o,l){return Math.max(0,Math.min(l-1,Math.floor(h*o)))}Ut(RA,"TriangleGridIndex");class qI{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[]}updateFootprints(o,l){for(const d of this.footprints)l.push({footprint:d,id:o})}populate(o,l,d,p){const _=[];for(const{feature:y,id:A,index:S,sourceLayerIndex:I}of o){const R=this.layers[0]._featureFilter.needGeometry,P=Jt(y,R);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),P,d))continue;const B={id:A,properties:y.properties,type:y.type,sourceLayerIndex:I,index:S,geometry:R?P.geometry:jt(y,d,p),patterns:{}};_.push(B)}for(const y of _){const{geometry:A,index:S,sourceLayerIndex:I}=y;this.addFeature(y,A,S,d,{},l.availableImages,l.brightness),l.featureIndex.insert(o[S].feature,A,S,I,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(o){}update(o,l,d,p,_,y,A){}destroy(){}addFeature(o,l,d,p,_,y=[],A){for(const S of Wb(l,2)){const I=[],R=[],P=[],B=new ue(1/0,1/0),N=new ue(-1/0,-1/0);for(const K of S)if(K.length!==0){K!==S[0]&&P.push(R.length/2);for(let ee=0;ee<K.length;ee++)R.push(K[ee].x),R.push(K[ee].y),I.push(K[ee]),B.x=Math.min(B.x,K[ee].x),B.y=Math.min(B.y,K[ee].y),N.x=Math.max(N.x,K[ee].x),N.y=Math.max(N.y,K[ee].y)}const U=d_(R,P),j=new RA(I,U,8,256);this.footprints.push({vertices:I,indices:U,grid:j,min:B,max:N})}}}Ut(qI,"ClipBucket",{omit:["layers"]});const qN=tn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),YN=tn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),ZN=tn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),KN=tn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),JN=tn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),QN=tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:e5}=qN,qb=Number.MAX_SAFE_INTEGER;function YI(h,o,l,d){return h.order<o||h.order===qb||!(h.clipMask&l)||function(p,_){return _.length!==0&&_.find(y=>y===p)===void 0}(d,h.clipScope)}function Yb(h,o){return h.x-o.x||h.y-o.y}function ZI(h,o){return Yb(h.min,o.min)===0&&Yb(h.max,o.max)===0}function kA(h,o){return!(h.min.x>o.max.x||h.max.x<o.min.x||h.min.y>o.max.y||h.max.y<o.min.y)}function PA(h,o){if(h.length!==o.length)return!1;for(let l=0;l<h.length;l++)if(h[l].sourceId!==o[l].sourceId||!ZI(h[l],o[l])||h[l].order!==o[l].order||h[l].clipMask!==o[l].clipMask||!st(h[l].clipScope,o[l].clipScope))return!1;return!0}function KI(h,o,l){const d=1/Dt,p=1/(1<<l.canonical.z),_=(o.x*d+l.canonical.x)*p+l.wrap,y=(o.y*d+l.canonical.y)*p;return{min:new ue((h.x*d+l.canonical.x)*p+l.wrap,(h.y*d+l.canonical.y)*p),max:new ue(_,y)}}function t5(h,o,l){const d=1<<l.canonical.z,p=((o.x-l.wrap)*d-l.canonical.x)*Dt,_=(o.y*d-l.canonical.y)*Dt;return{min:new ue(((h.x-l.wrap)*d-l.canonical.x)*Dt,(h.y*d-l.canonical.y)*Dt),max:new ue(p,_)}}function JI(h,o,l,d,p,_,y){const A=h.indices,S=h.vertices,I=[];for(let R=d;R<d+p;R+=3){const P=o[l[R+0]+_],B=o[l[R+1]+_],N=o[l[R+2]+_],U=Math.min(P.x,B.x,N.x),j=Math.max(P.x,B.x,N.x),K=Math.min(P.y,B.y,N.y),ee=Math.max(P.y,B.y,N.y);I.length=0,h.grid.query(new ue(U,K),new ue(j,ee),I);for(let le=0;le<I.length;le++){const re=I[le];if(Vn(S[A[3*re+0]],S[A[3*re+1]],S[A[3*re+2]],P,B,N,y))return!0}}return!1}function QI(h,o,l,d){if(!h||!l)return!1;let p=h.vertices;if(!o.canonical.equals(d.canonical)||o.wrap!==d.wrap){if(l.vertices.length<h.vertices.length)return QI(l,d,h,o);const _=o.canonical,y=d.canonical,A=Math.pow(2,y.z-_.z);p=h.vertices.map(S=>new ue((S.x+_.x*Dt)*A-y.x*Dt,(S.y+_.y*Dt)*A-y.y*Dt))}return JI(l,p,h.indices,0,h.indices.length,0,0)}function e3(h,o,l,d){const p=Math.pow(2,d.z-l.z);return new ue((h+l.x*Dt)*p-d.x*Dt,(o+l.y*Dt)*p-d.y*Dt)}function t3(h,o){const l=[];o.grid.queryPoint(h,l);const d=o.indices,p=o.vertices;for(let _=0;_<l.length;_++){const y=l[_];if(gn([p[d[3*y+0]],p[d[3*y+1]],p[d[3*y+2]]],h))return!0}return!1}const DA=[new ue(0,0),new ue(Dt,0),new ue(Dt,Dt),new ue(0,Dt)];function i3(h,o){const l=[];let d=[];if(!o||h.length<2)return[h];if(h.length===2)return ar(h[0],h[1],DA)?[h]:[];for(let p=0;p<h.length+2;p++){const _=h[p%h.length],y=h[(p+1)%h.length],A=ar(p===0?h[h.length-1]:h[(p-1)%h.length],_,DA),S=ar(_,y,DA),I=A||S;I&&d.push(_),I&&S||d.length>0&&(d.length>1&&l.push(d),d=[])}return d.length>1&&l.push(d),l}const BA=fu.VectorTileFeature.types,i5=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],n5=["fill-extrusion-flood-light-ground-radius"],r5=Math.pow(2,13),s5=Math.pow(2,15)-1,n3=new ue(0,1),pu=2147483648;function __(h,o,l,d,p,_,y,A){h.emplaceBack((o<<1)+y,(l<<1)+_,(Math.floor(d*r5)<<1)+p,Math.round(A))}function y_(h,o,l){h.emplaceBack(o.x*Dt,o.y*Dt,l?1:0)}function Zb(h,o,l,d,p,_){h.emplaceBack(o.x,o.y,(l.x<<1)+d,(l.y<<1)+p,_)}function b_(h,o,l){h.emplaceBack(o.x,o.y,o.z,l[0]*16384,l[1]*16384,l[2]*16384)}class r3{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class s3{constructor(){this.centroidXY=new ue(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ue(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ue(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ue(this.max.x-this.min.x,this.max.y-this.min.y)}}class o3{constructor(){this.acc=new ue(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,l){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=l.x,o.min.y=o.max.y=l.y)}appendEdge(o,l,d){this.accCount++,this.acc._add(l);let p=!!this.borders;l.x<o.min.x?(o.min.x=l.x,p=!0):l.x>o.max.x&&(o.max.x=l.x,p=!0),l.y<o.min.y?(o.min.y=l.y,p=!0):l.y>o.max.y&&(o.max.y=l.y,p=!0),((l.x===0||l.x===Dt)&&l.x===d.x)!=((l.y===0||l.y===Dt)&&l.y===d.y)&&this.processBorderOverlap(l,d),p&&this.checkBorderIntersection(l,d)}checkBorderIntersection(o,l){l.x<0!=o.x<0&&this.addBorderIntersection(0,ri(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Dt!=o.x>Dt&&this.addBorderIntersection(1,ri(l.y,o.y,(Dt-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,ri(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Dt!=o.y>Dt&&this.addBorderIntersection(3,ri(l.x,o.x,(Dt-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[o];l<d[0]&&(d[0]=l),l>d[1]&&(d[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const d=o.x===0?0:1;this.addBorderIntersection(d,l.y),this.addBorderIntersection(d,o.y)}else{const d=o.y===0?2:3;this.addBorderIntersection(d,l.x),this.addBorderIntersection(d,o.x)}}centroid(){return this.accCount===0?new ue(0,0):new ue(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0):0}}function a3(h,o){const l=h.add(o)._unit(),d=De(h.x*l.x+h.y*l.y,-1,1);var p,_,y;return p=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(p)))/4*s5*((_=h).x*(y=o).y-_.y*y.x<0?-1:1)}const o5=[h=>h.x<0,h=>h.x>Dt,h=>h.y<0,h=>h.y>Dt];function a5(h,o,l,d){const p=[4];if(d===0)return p;l._mult(d);const _=h.sub(l),y=o.sub(l),A=[h,o,_,y];for(let S=0;S<4;S++)for(const I of A)if(o5[S](I)){p.push(S);break}return p}class l3{constructor(o){this.vertexArray=new Kg,this.indexArray=new qr,this.programConfigurations=new hh(o.layers,{zoom:o.zoom,lut:o.lut},l=>n5.includes(l)),this._segments=new Gn,this.hiddenByLandmarkVertexArray=new Pp,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Gn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(o,l,d,p=!1){const _=o.length;if(_>2){let y=Math.max(0,this._segments.get().length-1);const A=this._segments._prepareSegment(4*_,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let S;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const I=o[0],R=o[1];S=a3(I.sub(o[_-1])._perp()._unit(),R.sub(I)._perp()._unit())}for(let I=0;I<_;I++){const R=I===_-1?0:I+1,P=o[I],B=o[R],N=o[R===_-1?0:R+1],U=B.sub(P)._perp()._unit(),j=a3(U,N.sub(B)._perp()._unit()),K=S,ee=j;if(OA(P,B,l)||p&&u3(P,l)&&u3(B,l)){S=j;continue}const le=A.vertexLength;Zb(this.vertexArray,P,B,1,1,K),Zb(this.vertexArray,P,B,1,0,K),Zb(this.vertexArray,P,B,0,1,ee),Zb(this.vertexArray,P,B,0,0,ee),A.vertexLength+=4;const re=a5(P,B,U,d);for(const G of re)this._segmentToGroundQuads[y].push({id:le,region:G}),this._segmentToRegionTriCounts[y][G]+=2,A.primitiveLength+=2;S=j}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),l=o.length;for(let d=0;d<l;d++)this._segmentToGroundQuads[d].sort((p,_)=>p.region-_.region);for(let d=0;d<l;d++){const p=this._segmentToGroundQuads[d],_=o[d],y=this._segmentToRegionTriCounts[d];y.reduce((S,I)=>S+I,0);let A=0;for(let S=0;S<=4;S++){const I=y[S];if(I!==0){let R=this.regionSegments[S];R||(R=this.regionSegments[S]=new Gn);const P={vertexOffset:_.vertexOffset,primitiveOffset:_.primitiveOffset+A,vertexLength:_.vertexLength,primitiveLength:I};R.get().push(P)}A+=I}for(let S=0;S<p.length;S++){const I=p[S].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,l,d,p,_,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,l,d,p,_,y)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,YN.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,l,d,p,_,y,A){this.hasData()&&this.programConfigurations.updatePaintArrays(o,l,d,p,_,y,A)}updateHiddenByLandmark(o){if(!this.hasData())return;const l=o.groundVertexCount+o.groundVertexArrayOffset;if(o.groundVertexCount===0)return;const d=o.flags&pu?1:0;for(let p=o.groundVertexArrayOffset;p<l;++p)this.hiddenByLandmarkVertexArray.emplace(p,d);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,JN.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const l=this.regionSegments[o];l&&l.destroy()}}}}class Kb{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.pixelRatio=o.pixelRatio,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qr,this.footprintVertices=new Al,this.footprintSegments=[],this.layoutVertexArray=new ah,this.centroidVertexArray=new Db,this.wallVertexArray=new Ob,this.indexArray=new qr,this.programConfigurations=new hh(o.layers,{zoom:o.zoom,lut:o.lut},l=>i5.includes(l)),this.segments=new Gn,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new l3(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(o,l){}populate(o,l,d,p){this.features=[],this.hasPattern=vA("fill-extrusion",this.layers,this.pixelRatio,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=$e(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:_,id:y,index:A,sourceLayerIndex:S}of o){const I=this.layers[0]._featureFilter.needGeometry,R=Jt(_,I);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),R,d))continue;const P={id:y,sourceLayerIndex:S,index:A,geometry:I?R.geometry:jt(_,d,p),properties:_.properties,type:_.type,patterns:{}},B=this.layoutVertexArray.length,N=BA[P.type]==="Polygon";if(this.hasPattern)this.features.push(xA("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,l));else if(this.wallMode)for(const U of P.geometry)for(const j of i3(U,N))this.addFeature(P,[j],A,d,{},l.availableImages,p,l.brightness);else this.addFeature(P,P.geometry,A,d,{},l.availableImages,p,l.brightness);l.featureIndex.insert(_,P.geometry,A,S,this.index,B)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,l,d,p,_,y){for(const A of this.features){const S=BA[A.type]==="Polygon",{geometry:I}=A;if(this.wallMode)for(const R of I)for(const P of i3(R,S))this.addFeature(A,[P],A.index,l,d,p,_,y);else this.addFeature(A,I,A.index,l,d,p,_,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(o,l,d,p,_,y,A){this.programConfigurations.updatePaintArrays(o,l,_,d,p,y,A),this.groundEffect.update(o,l,_,d,p,y,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,e5),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,KN.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,QN.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,ZN.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,d,p,_,y,A,S){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,R=[new ue(0,0),new ue(Dt,Dt)],P=A.projection,B=P.name==="globe",N=this.wallMode||BA[o.type]==="Polygon",U=new o3;U.centroidDataIndex=this.centroidData.length;const j=new s3,K=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},p)<=0,ee=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},p);let le;if(j.height=ee,j.vertexArrayOffset=this.layoutVertexArray.length,j.groundVertexArrayOffset=this.groundEffect.vertexArray.length,B&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new lh),this.wallMode){if(B)return void Bi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;le=function(Fe){const Ve=Fe[0].x===Fe[Fe.length-1].x&&Fe[0].y===Fe[Fe.length-1].y;(function(Bt){let wt=0;const pi=Bt.length;for(let Xt=0;Xt<pi;Xt++)wt+=(Bt[(Xt+1)%pi].x-Bt[Xt].x)*(Bt[(Xt+1)%pi].y+Bt[Xt].y);return wt>=0})(Fe)||(Fe=Fe.reverse());const mt={geometry:[],joinNormals:[],indices:[]},ht=[],pt=[],xt=[];let Ke=Fe.length;for(;Ke>=2&&Fe[Ke-1].equals(Fe[Ke-2]);)Ke--;if(Ke<(Ve?3:2))return mt;let ft,Ye,Qe,At,Et,Kt=0;for(;Kt<Ke-1&&Fe[Kt].equals(Fe[Kt+1]);)Kt++;Ve&&(ft=Fe[Ke-2],Et=Fe[Kt].sub(ft)._unit()._perp());for(let Bt=Kt;Bt<Ke;Bt++){if(Qe=Bt===Ke-1?Ve?Fe[Kt+1]:void 0:Fe[Bt+1],Qe&&Fe[Bt].equals(Qe))continue;Et&&(At=Et),ft&&(Ye=ft),ft=Fe[Bt],Et=Qe?Qe.sub(ft)._unit()._perp():At,At=At||Et;let wt=At.add(Et);wt.x===0&&wt.y===0||wt._unit();const pi=wt.x*Et.x+wt.y*Et.y,Xt=pi!==0?1/pi:1/0,qt=At.x*Et.y-At.y*Et.x>0;let ui="miter";const Ai=2;ui==="miter"&&Xt>Ai&&(ui="bevel"),ui==="bevel"&&(Xt>100&&(ui="flipbevel"),Xt<Ai&&(ui="miter"));const Ti=(Di,Mi,Ci,vn)=>{const Rn=new ue(Di.x,Di.y),he=new ue(Di.x,Di.y);Rn.x+=Mi.x*vn,Rn.y+=Mi.y*vn,he.x-=Mi.x*Math.max(Ci,1),he.y-=Mi.y*Math.max(Ci,1),xt.push(Mi),ht.push(Rn),pt.push(he)};if(ui==="miter")wt._mult(Xt),Ti(ft,wt,0,0);else if(ui==="flipbevel")wt=Et.mult(-1),Ti(ft,wt,0,0),Ti(ft,wt.mult(-1),0,0);else{const Di=-Math.sqrt(Xt*Xt-1),Mi=qt?Di:0,Ci=qt?0:Di;Ye&&Ti(ft,At,Mi,Ci),Qe&&Ti(ft,Et,Mi,Ci)}}mt.geometry=[...ht,...pt.reverse(),ht[0]],mt.joinNormals=[...xt,...xt.reverse(),xt[xt.length-1]];const $t=mt.geometry.length-1;for(let Bt=0;Bt<$t/2;Bt++)if(Bt+1<$t/2){let wt=Bt,pi=Bt+1,Xt=$t-1-Bt,qt=$t-2-Bt;wt=wt===0?$t-1:wt-1,pi=pi===0?$t-1:pi-1,Xt=Xt===0?$t-1:Xt-1,qt=qt===0?$t-1:qt-1,mt.indices.push(Xt),mt.indices.push(pi),mt.indices.push(wt),mt.indices.push(Xt),mt.indices.push(qt),mt.indices.push(pi)}return mt}(l[0]),l=[le.geometry]}const re=(Fe,Ve)=>Fe<(Ve.length-1)/2||Fe===Ve.length-1,G=this.wallMode?[l]:Wb(l,500);for(let Fe=G.length-1;Fe>=0;Fe--){const Ve=G[Fe];(Ve.length===0||(ie=Ve[0]).every(et=>et.x<=0)||ie.every(et=>et.x>=Dt)||ie.every(et=>et.y<=0)||ie.every(et=>et.y>=Dt))&&G.splice(Fe,1)}var ie;let ae;if(B)ae=m3(G,R,p);else{ae=[];for(const Fe of G)ae.push({polygon:Fe,bounds:R})}const fe=N?this.edgeRadius:0,Ce=fe>0&&this.zoom<17,Be=(Fe,Ve)=>{if(Fe.length===0)return!1;const et=Fe[Fe.length-1];return Ve.x===et.x&&Ve.y===et.y};for(const{polygon:Fe,bounds:Ve}of ae){let et=0,mt=0;for(const Ke of Fe)N&&!Ke[0].equals(Ke[Ke.length-1])&&Ke.push(Ke[0]),mt+=N?Ke.length-1:Ke.length;const ht=this.segments.prepareSegment((N?5:4)*mt,this.layoutVertexArray,this.indexArray);j.footprintSegIdx<0&&(j.footprintSegIdx=this.footprintSegments.length),j.polygonSegIdx<0&&(j.polygonSegIdx=this.polygonSegments.length);const pt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},xt=new r3;if(xt.vertexOffset=this.footprintVertices.length,xt.indexOffset=3*this.footprintIndices.length,xt.ringIndices=[],N){const Ke=[],ft=[];et=ht.vertexLength;for(let Qe=0;Qe<Fe.length;Qe++){const At=Fe[Qe];At.length&&Qe!==0&&ft.push(Ke.length/2);const Et=[];let Kt,$t;Kt=At[1].sub(At[0])._perp()._unit(),xt.ringIndices.push(At.length-1);for(let Bt=1;Bt<At.length;Bt++){const wt=At[Bt],pi=At[Bt===At.length-1?1:Bt+1],Xt=wt.clone();if(fe){$t=pi.sub(wt)._perp()._unit();const qt=Kt.add($t)._unit(),ui=fe*Math.min(4,1/(Kt.x*qt.x+Kt.y*qt.y));Xt.x+=ui*qt.x,Xt.y+=ui*qt.y,Xt.x=Math.round(Xt.x),Xt.y=Math.round(Xt.y),Kt=$t}if(!K||fe!==0&&!Ce||Be(Et,Xt)||Et.push(Xt),__(this.layoutVertexArray,Xt.x,Xt.y,0,0,1,1,0),this.wallMode){const qt=re(Bt,At);y_(this.wallVertexArray,le.joinNormals[Bt],!qt)}ht.vertexLength++,this.footprintVertices.emplaceBack(wt.x,wt.y),Ke.push(wt.x,wt.y),B&&b_(this.layoutVertexExtArray,P.projectTilePoint(Xt.x,Xt.y,p),P.upVector(p,Xt.x,Xt.y))}K&&(fe===0||Ce)&&(Et.length!==0&&Be(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,Ve,I))}const Ye=this.wallMode?le.indices:d_(Ke,ft);for(let Qe=0;Qe<Ye.length;Qe+=3)this.footprintIndices.emplaceBack(xt.vertexOffset+Ye[Qe+0],xt.vertexOffset+Ye[Qe+1],xt.vertexOffset+Ye[Qe+2]),this.indexArray.emplaceBack(et+Ye[Qe],et+Ye[Qe+2],et+Ye[Qe+1]),ht.primitiveLength++;xt.indexCount+=Ye.length,xt.vertexCount+=this.footprintVertices.length-xt.vertexOffset}for(let Ke=0;Ke<Fe.length;Ke++){const ft=Fe[Ke];U.startRing(j,ft[0]);let Ye=ft.length>4&&d3(ft[ft.length-2],ft[0],ft[1]),Qe=fe?l5(ft[ft.length-2],ft[0],ft[1],fe):0;const At=[];let Et,Kt,$t;Kt=ft[1].sub(ft[0])._perp()._unit();let Bt=!0;for(let wt=1,pi=0;wt<ft.length;wt++){let Xt=ft[wt-1],qt=ft[wt];const ui=ft[wt===ft.length-1?1:wt+1];if(U.appendEdge(j,qt,Xt),OA(qt,Xt,Ve)){fe&&(Kt=ui.sub(qt)._perp()._unit(),Bt=!Bt);continue}const Ai=qt.sub(Xt)._perp(),Ti=Ai.x/(Math.abs(Ai.x)+Math.abs(Ai.y)),Di=Ai.y>0?1:0,Mi=Xt.dist(qt);if(pi+Mi>32768&&(pi=0),fe){$t=ui.sub(qt)._perp()._unit();let he=h3(Xt,qt,ui,c3(Kt,$t),fe);isNaN(he)&&(he=0);const pe=qt.sub(Xt)._unit();Xt=Xt.add(pe.mult(Qe))._round(),qt=qt.add(pe.mult(-he))._round(),Qe=he,Kt=$t,K&&this.zoom>=17&&(Be(At,Xt)||At.push(Xt),Be(At,qt)||At.push(qt))}const Ci=ht.vertexLength,vn=ft.length>4&&d3(Xt,qt,ui);let Rn=f3(pi,Ye,Bt);if(__(this.layoutVertexArray,Xt.x,Xt.y,Ti,Di,0,0,Rn),__(this.layoutVertexArray,Xt.x,Xt.y,Ti,Di,0,1,Rn),this.wallMode){const he=re(wt-1,ft),pe=le.joinNormals[wt-1];y_(this.wallVertexArray,pe,he),y_(this.wallVertexArray,pe,he)}if(pi+=Mi,Rn=f3(pi,vn,!Bt),Ye=vn,__(this.layoutVertexArray,qt.x,qt.y,Ti,Di,0,0,Rn),__(this.layoutVertexArray,qt.x,qt.y,Ti,Di,0,1,Rn),this.wallMode){const he=re(wt,ft),pe=le.joinNormals[wt];y_(this.wallVertexArray,pe,he),y_(this.wallVertexArray,pe,he)}if(ht.vertexLength+=4,this.indexArray.emplaceBack(Ci+0,Ci+1,Ci+2),this.indexArray.emplaceBack(Ci+1,Ci+3,Ci+2),ht.primitiveLength+=2,fe){const he=et+(wt===1?ft.length-2:wt-2),pe=wt===1?et:he+1;if(this.indexArray.emplaceBack(Ci+1,he,Ci+3),this.indexArray.emplaceBack(he,pe,Ci+3),ht.primitiveLength+=2,Et===void 0&&(Et=Ci),!OA(ui,ft[wt],Ve)){const tt=wt===ft.length-1?Et:ht.vertexLength;this.indexArray.emplaceBack(Ci+2,Ci+3,tt),this.indexArray.emplaceBack(Ci+3,tt+1,tt),this.indexArray.emplaceBack(Ci+3,pe,tt+1),ht.primitiveLength+=3}Bt=!Bt}if(B){const he=this.layoutVertexExtArray,pe=P.projectTilePoint(Xt.x,Xt.y,p),tt=P.projectTilePoint(qt.x,qt.y,p),Mt=P.upVector(p,Xt.x,Xt.y),Ft=P.upVector(p,qt.x,qt.y);b_(he,pe,Mt),b_(he,pe,Mt),b_(he,tt,Ft),b_(he,tt,Ft)}}N&&(et+=ft.length-1),K&&fe&&this.zoom>=17&&(At.length!==0&&Be(At,At[0])&&At.pop(),this.groundEffect.addData(At,Ve,I,fe>0))}this.footprintSegments.push(xt),pt.triangleCount=this.indexArray.length-pt.triangleArrayOffset,this.polygonSegments.push(pt),++j.footprintSegLen,++j.polygonSegLen}if(j.vertexCount=this.layoutVertexArray.length-j.vertexArrayOffset,j.groundVertexCount=this.groundEffect.vertexArray.length-j.groundVertexArrayOffset,j.vertexCount!==0){if(j.centroidXY=U.borders?n3:this.encodeCentroid(U,j),this.centroidData.push(j),U.borders){this.featuresOnBorder.push(U);const Fe=this.featuresOnBorder.length-1;for(let Ve=0;Ve<U.borders.length;Ve++)U.borders[Ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ve].push(Fe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,_,y,p,S),this.groundEffect.addPaintPropertiesData(o,d,_,y,p,S),this.maxHeight=Math.max(this.maxHeight,ee)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((l,d)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[d].borders[o][0])}splitToSubtiles(){const o=[];for(let A=0;A<this.centroidData.length;A++){const S=this.centroidData[A],I=+(S.min.y+S.max.y>Dt),R=2*I+(+(S.min.x+S.max.x>Dt)^I);for(let P=0;P<S.polygonSegLen;P++){const B=S.polygonSegIdx+P;o.push({centroidIdx:A,subtile:R,polygonSegmentIdx:B,triangleSegmentIdx:this.polygonSegments[B].triangleSegIdx})}}const l=new qr;o.sort((A,S)=>A.triangleSegmentIdx===S.triangleSegmentIdx?A.subtile-S.subtile:A.triangleSegmentIdx-S.triangleSegmentIdx);let d=0,p=0,_=0;for(const A of o){if(A.triangleSegmentIdx!==d)break;_++}const y=o.length;for(;p!==o.length;){d=o[p].triangleSegmentIdx;let A=0,S=p,I=p;for(let R=S;R<_&&o[R].subtile===A;R++)I++;for(;S!==_;){const R=o[S];A=R.subtile;const P=this.centroidData[R.centroidIdx].min.clone(),B=this.centroidData[R.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=S;U<I;U++){const j=o[U],K=this.polygonSegments[j.polygonSegmentIdx],ee=this.centroidData[j.centroidIdx].min,le=this.centroidData[j.centroidIdx].max,re=this.indexArray.uint16;for(let G=K.triangleArrayOffset;G<K.triangleArrayOffset+K.triangleCount;G++)l.emplaceBack(re[3*G],re[3*G+1],re[3*G+2]);N.primitiveLength+=K.triangleCount,P.x=Math.min(P.x,ee.x),P.y=Math.min(P.y,ee.y),B.x=Math.max(B.x,le.x),B.y=Math.max(B.y,le.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:P,max:B}),S=I;for(let U=S;U<_&&o[U].subtile===o[S].subtile;U++)I++}p=_;for(let R=p;R<y&&o[R].triangleSegmentIdx===o[p].triangleSegmentIdx;R++)_++}l._trim(),this.indexArray=l}getVisibleSegments(o,l,d){const p=new Gn;if(this.wallMode){for(const j of this.triangleSubSegments)p.segments.push(j.segment);return p}let _=0,y=0;const A=1<<o.canonical.z;if(l){const j=l.getMinMaxForTile(o);j&&(_=j.min,y=j.max)}y+=this.maxHeight;const S=o.toUnwrapped();let I;const R=[S.canonical.x/A+S.wrap,S.canonical.y/A],P=[(S.canonical.x+1)/A+S.wrap,(S.canonical.y+1)/A],B=(j,K,ee)=>[j[0]*(1-ee[0])+K[0]*ee[0],j[1]*(1-ee[1])+K[1]*ee[1]],N=[],U=[];for(const j of this.triangleSubSegments){N[0]=j.min.x/Dt,N[1]=j.min.y/Dt,U[0]=j.max.x/Dt,U[1]=j.max.y/Dt;const K=B(R,P,N),ee=B(R,P,U);if(new zn([K[0],K[1],_],[ee[0],ee[1],y]).intersectsPrecise(d)===0){I&&(p.segments.push(I),I=void 0);continue}const le=j.segment;I&&I.vertexOffset!==le.vertexOffset&&(p.segments.push(I),I=void 0),I?(I.vertexLength+=le.vertexLength,I.primitiveLength+=le.primitiveLength):I={vertexOffset:le.vertexOffset,primitiveLength:le.primitiveLength,vertexLength:le.vertexLength,primitiveOffset:le.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&p.segments.push(I),p}encodeCentroid(o,l){const d=o.centroid(),p=l.span(),_=Math.min(7,Math.round(p.x*this.tileToMeter/10)),y=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new ue(De(d.x,1,Dt-1)<<3|_,De(d.y,1,Dt-1)<<3|y)}encodeBorderCentroid(o){if(!o.borders)return new ue(0,0);const l=o.borders,d=Number.MAX_VALUE;if(l[0][0]!==d||l[1][0]!==d){const p=l[0][0]!==d?0:1;return new ue(6|(l[0][0]!==d?0:65528),(l[p][0]+l[p][1])/2<<3|6)}{const p=l[2][0]!==d?2:3;return new ue((l[p][0]+l[p][1])/2<<3|6,6|(l[2][0]!==d?0:65528))}}showCentroid(o){const l=this.centroidData[o.centroidDataIndex];l.flags&=pu,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const l=o.vertexArrayOffset,d=o.vertexCount+o.vertexArrayOffset,p=o.flags&pu?n3:o.centroidXY,_=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==p.y||_!==p.x){for(let y=l;y<d;++y)this.centroidVertexArray.emplace(y,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,l,d){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const p=l.getReplacementRegionsForTile(o.toUnwrapped());if(PA(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const _=[];for(const y of this.activeReplacements){if(y.order<d)continue;const A=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-o.canonical.z));for(const S of this.centroidData)if(!(S.flags&pu||y.min.x>S.max.x||S.min.x>y.max.x||y.min.y>S.max.y||S.min.y>y.max.y))for(let I=0;I<S.footprintSegLen;I++){const R=this.footprintSegments[S.footprintSegIdx+I];if(_.length=0,c5(this.footprintVertices,R.vertexOffset,R.vertexCount,y.footprintTileId.canonical,o.canonical,_),JI(y.footprint,_,this.footprintIndices.uint16,R.indexOffset,R.indexCount,-R.vertexOffset,-A)){S.flags|=pu;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,l,d){let p=!1;for(let _=0;_<d.footprintSegLen;_++){const y=this.footprintSegments[d.footprintSegIdx+_];let A=0;for(const S of y.ringIndices){for(let I=A,R=S+A-1;I<S+A;R=I++){const P=this.footprintVertices.int16[2*(I+y.vertexOffset)+0],B=this.footprintVertices.int16[2*(I+y.vertexOffset)+1],N=this.footprintVertices.int16[2*(R+y.vertexOffset)+1];B>l!=N>l&&o<(this.footprintVertices.int16[2*(R+y.vertexOffset)+0]-P)*(l-B)/(N-B)+P&&(p=!p)}A=S}}return p}getHeightAtTileCoord(o,l){let d=Number.NEGATIVE_INFINITY,p=!0;const _=4*(o+Dt)*Dt+(l+Dt);if(this.partLookup.hasOwnProperty(_)){const y=this.partLookup[_];return y?{height:y.height,hidden:!!(y.flags&pu)}:void 0}for(const y of this.centroidData)o>y.max.x||y.min.x>o||l>y.max.y||y.min.y>l||this.footprintContainsPoint(o,l,y)&&y&&y.height>d&&(d=y.height,this.partLookup[_]=y,p=!!(y.flags&pu));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:p};this.partLookup[_]=void 0}}function c3(h,o){const l=h.add(o)._unit();return h.x*l.x+h.y*l.y}function l5(h,o,l,d){const p=o.sub(h)._perp()._unit(),_=l.sub(o)._perp()._unit();return h3(h,o,l,c3(p,_),d)}function h3(h,o,l,d,p){const _=Math.sqrt(1-d*d);return Math.min(h.dist(o)/3,o.dist(l)/3,p*_/d)}function OA(h,o,l){return h.x<l[0].x&&o.x<l[0].x||h.x>l[1].x&&o.x>l[1].x||h.y<l[0].y&&o.y<l[0].y||h.y>l[1].y&&o.y>l[1].y}function u3(h,o){return h.x<o[0].x||h.x>o[1].x||h.y<o[0].y||h.y>o[1].y}function d3(h,o,l){if(h.x<0||h.x>=Dt||o.x<0||o.x>=Dt||l.x<0||l.x>=Dt)return!1;const d=l.sub(o),p=d.perp(),_=h.sub(o);return(d.x*_.x+d.y*_.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(_.x*_.x+_.y*_.y))>-.866&&p.x*_.x+p.y*_.y<0}function f3(h,o,l){const d=o?2|h:-3&h;return l?1|d:-2&d}function p3(){const h=Math.PI/32,o=Math.tan(h),l=q;return l*Math.sqrt(1+2*o*o)-l}function m3(h,o,l){const d=1<<l.z,p=Ie(l.x/d),_=Ie((l.x+1)/d),y=Re(l.y/d),A=Re((l.y+1)/d);return function(S,I,R,P,B=0,N){const U=[];if(!S.length||!R||!P)return U;const j=(ae,fe)=>{for(const Ce of ae)U.push({polygon:Ce,bounds:fe})},K=Math.ceil(Math.log2(R)),ee=Math.ceil(Math.log2(P)),le=K-ee,re=[];for(let ae=0;ae<Math.abs(le);ae++)re.push(le>0?0:1);for(let ae=0;ae<Math.min(K,ee);ae++)re.push(0),re.push(1);let G=S;if(G=Xb(G,I[0].y-B,I[1].y+B,1),G=Xb(G,I[0].x-B,I[1].x+B,0),!G.length)return U;const ie=[];for(re.length?ie.push({polygons:G,bounds:I,depth:0}):j(G,I);ie.length;){const ae=ie.pop(),fe=ae.depth,Ce=re[fe],Be=ae.bounds[0],Fe=ae.bounds[1],Ve=Ce===0?Be.x:Be.y,et=Ce===0?Fe.x:Fe.y,mt=N?N(Ce,Ve,et):.5*(Ve+et),ht=Xb(ae.polygons,Ve-B,mt+B,Ce),pt=Xb(ae.polygons,mt-B,et+B,Ce);if(ht.length){const xt=[Be,new ue(Ce===0?mt:Fe.x,Ce===1?mt:Fe.y)];re.length>fe+1?ie.push({polygons:ht,bounds:xt,depth:fe+1}):j(ht,xt)}if(pt.length){const xt=[new ue(Ce===0?mt:Be.x,Ce===1?mt:Be.y),Fe];re.length>fe+1?ie.push({polygons:pt,bounds:xt,depth:fe+1}):j(pt,xt)}}return U}(h,o,Math.ceil((_-p)/11.25),Math.ceil((y-A)/11.25),1,(S,I,R)=>{if(S===0)return .5*(I+R);{const P=Re((l.y+I/Dt)/d);return(xe(.5*(Re((l.y+R/Dt)/d)+P))*d-l.y)*Dt}})}function c5(h,o,l,d,p,_){const y=Math.pow(2,d.z-p.z);for(let A=0;A<l;A++){let S=h.int16[2*(A+o)+0],I=h.int16[2*(A+o)+1];S=(S+p.x*Dt)*y-d.x*Dt,I=(I+p.y*Dt)*y-d.y*Dt,_.push(new ue(S,I))}}let g3,_3;Ut(Kb,"FillExtrusionBucket",{omit:["layers","features"]}),Ut(s3,"PartData"),Ut(r3,"FootprintSegment"),Ut(o3,"BorderCentroidData"),Ut(l3,"GroundEffect");class Ld extends ue{constructor(o,l,d){super(o,l),this.z=d}}class y3 extends Ld{constructor(o,l,d,p){super(o,l,d),this.w=p}}function b3(h,o,l,d){const p=l==="x"?"y":"x",_=(d-h[l])/(o[l]-h[l]);h[p]=Math.round(h[p]+(o[p]-h[p])*_),h[l]=d,h.hasOwnProperty("z")&&(h.z=ri(h.z,o.z,_)),h.hasOwnProperty("w")&&(h.w=ri(h.w,o.w,_))}function v3(h,o,l,d){const p=l,_=d;for(const y of["x","y"]){let A=h,S=o;A[y]>=S[y]&&(A=o,S=h),A[y]<p&&S[y]>p&&b3(A,S,y,p),A[y]<_&&S[y]>_&&b3(S,A,y,_)}}function Jb(h,o,l,d,p,_){const y=[];for(let A=0;A<h.length;A++){const S=h[A];let I;const R=y.length;let P=0;for(let B=0;B<S.length-1;B++){let N=S[B],U=S[B+1],j=0;const K=P;let ee,le;_&&(j=Math.hypot(U.x-N.x,U.y-N.y),P+=j,ee=N,le=U),N.x<o&&U.x<o||(N.x<o?N=new ue(o,N.y+(o-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x<o&&(U=new ue(o,N.y+(o-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y<l&&U.y<l||(N.y<l?N=new ue(N.x+(l-N.y)/(U.y-N.y)*(U.x-N.x),l)._round():U.y<l&&(U=new ue(N.x+(l-N.y)/(U.y-N.y)*(U.x-N.x),l)._round()),N.x>=d&&U.x>=d||(N.x>=d?N=new ue(d,N.y+(d-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x>=d&&(U=new ue(d,N.y+(d-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y>=p&&U.y>=p||(N.y>=p?N=new ue(N.x+(p-N.y)/(U.y-N.y)*(U.x-N.x),p)._round():U.y>=p&&(U=new ue(N.x+(p-N.y)/(U.y-N.y)*(U.x-N.x),p)._round()),I&&N.equals(I[I.length-1])||(I=[N],y.push(I),_&&_.push({progress:{min:K+x3(ee,le,N)*j,max:1},parentIndex:A,prevPoint:ee,nextPoint:le})),I.push(U),_&&(_[_.length-1].progress.max=K+x3(ee,le,U)*j,_[_.length-1].nextPoint=le)))))}if(_&&P>0)for(let B=R;B<y.length;B++)_[B].progress.min/=P,_[B].progress.max/=P}return y}function h5(h,o,l,d,p){if(h.length<2)return void d.push(h);const _=[];for(;o.valid();){const[I,R]=o.get();for(let P=0;P<h.length-1;P++){const B=h[P],N=h[P+1],U=Wn(B,N,I,R);if(U){const[j]=U,K=new ue(ri(B.x,N.x,j),ri(B.y,N.y,j));_.push({t:P+j,distance:0,point:K})}}o.next()}if(_.length===0)return void d.push(h);_.sort((I,R)=>I.t-R.t);let y=0,A=0,S=[];for(d.push(S);y!==h.length;){if(A===_.length){for(;y!==h.length;)S.length!==0&&S[S.length-1].equals(h[y])||S.push(h[y]),y++;break}_[A].t<=y?(S.length!==0&&S[S.length-1].equals(_[A].point)||S.push(_[A].point),Math.trunc(_[A].t),A++):(S.length!==0&&S[S.length-1].equals(h[y])||S.push(h[y]),y++)}}function x3(h,o,l){return h.x!==o.x?(l.x-h.x)/(o.x-h.x):h.y!==o.y?(l.y-h.y)/(o.y-h.y):0}function v_(h,o){return h.x*o.x+h.y*o.y}function w3(h,o){if(h.length===1){let l=0;const d=o[l++];let p;for(;!p||d.equals(p);)if(p=o[l++],!p)return 1/0;for(;l<o.length;l++){const _=o[l],y=h[0],A=p.sub(d),S=_.sub(d),I=y.sub(d),R=v_(A,A),P=v_(A,S),B=v_(S,S),N=v_(I,A),U=v_(I,S),j=R*B-P*P,K=(B*N-P*U)/j,ee=(R*U-P*N)/j,le=d.z*(1-K-ee)+p.z*K+_.z*ee;if(isFinite(le))return le}return 1/0}{let l=1/0;for(const d of o)l=Math.min(l,d.z);return l}}function A3(h,o,l,d,p,_,y,A){const S=y*p.getElevationAt(h,o,!0,!0),I=_[0]!==0,R=I?_[1]===0?y*(_[0]/7-450):y*function(P,B,N){const U=Math.floor(B[0]/8),j=Math.floor(B[1]/8),K=10*(B[0]-8*U),ee=10*(B[1]-8*j),le=P.getElevationAt(U,j,!0,!0),re=P.getMeterToDEM(N),G=Math.floor(.5*(K*re-1)),ie=Math.floor(.5*(ee*re-1)),ae=P.tileCoordToPixel(U,j),fe=2*G+1,Ce=2*ie+1,Be=function(pt,xt,Ke,ft,Ye){return[pt.getElevationAtPixel(xt,Ke,!0),pt.getElevationAtPixel(xt+Ye,Ke,!0),pt.getElevationAtPixel(xt,Ke+Ye,!0),pt.getElevationAtPixel(xt+ft,Ke+Ye,!0)]}(P,ae.x-G,ae.y-ie,fe,Ce),Fe=Math.abs(Be[0]-Be[1]),Ve=Math.abs(Be[2]-Be[3]),et=Math.abs(Be[0]-Be[2])+Math.abs(Be[1]-Be[3]),mt=Math.min(.25,.5*re*(Fe+Ve)/fe),ht=Math.min(.25,.5*re*et/Ce);return le+Math.max(mt*K,ht*ee)}(p,_,A):S;return{base:S+(l===0?-1:l),top:I?Math.max(R+d,S+l+2):S+d}}const u5=tn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),d5=tn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:f5}=u5,p5=tn([{name:"a_packed",components:3,type:"Float32"}]),{members:m5}=p5,g5=tn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:_5}=g5;class T3{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new du({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const d=this.getKey(o,l);return this.positions[d]}trim(){const o=this.width,l=this.height=Yt(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,d){const p=[];let _=o.length%2==1?-o[o.length-1]*d:0,y=o[0]*d,A=!0;p.push({left:_,right:y,isDash:A,zeroLength:o[0]===0});let S=o[0];for(let I=1;I<o.length;I++){A=!A;const R=o[I];_=S*d,S+=R,y=S*d,p.push({left:_,right:y,isDash:A,zeroLength:R===0})}return p}addRoundDash(o,l,d){const p=l/2;for(let _=-d;_<=d;_++){const y=this.width*(this.nextRow+d+_);let A=0,S=o[A];for(let I=0;I<this.width;I++){I/S.right>1&&(S=o[++A]);const R=Math.abs(I-S.left),P=Math.abs(I-S.right),B=Math.min(R,P);let N;const U=_/d*(p+1);if(S.isDash){const j=p-Math.abs(U);N=Math.sqrt(B*B+j*j)}else N=p-Math.sqrt(B*B+U*U);this.image.data[y+I]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(o,l){for(let S=o.length-1;S>=0;--S){const I=o[S],R=o[S+1];I.zeroLength?o.splice(S,1):R&&R.isDash===I.isDash&&(R.left=I.left,o.splice(S,1))}const d=o[0],p=o[o.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const _=this.width*this.nextRow;let y=0,A=o[y];for(let S=0;S<this.width;S++){S/A.right>1&&(A=o[++y]);const I=Math.abs(S-A.left),R=Math.abs(S-A.right),P=Math.min(I,R);this.image.data[_+S]=Math.max(0,Math.min(255,(A.isDash?P:-P)+l+128))}}addDash(o,l){const d=this.getKey(o,l);if(this.positions[d])return this.positions[d];const p=l==="round",_=p?7:0,y=2*_+1;if(this.nextRow+y>this.height)return Bi("LineAtlas out of space"),null;o.length===0&&o.push(1);let A=0;for(let R=0;R<o.length;R++)o[R]<0&&(Bi("Negative value is found in line dasharray, replacing values with 0"),o[R]=0),A+=o[R];if(A!==0){const R=this.width/A,P=this.getDashRanges(o,this.width,R);p?this.addRoundDash(P,R,_):this.addRegularDash(P,l==="square"?.5*R:0)}const S=this.nextRow+_;this.nextRow+=y;const I={tl:[S,_],br:[A,0]};return this.positions[d]=I,I}}Ut(T3,"LineAtlas");const y5=fu.VectorTileFeature.types,b5=Math.cos(Math.PI/180*37.5),v5=Math.cos(Math.PI/180*5);class FA{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.pixelRatio=o.pixelRatio,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Jg,this.layoutVertexArray2=new Za,this.patternVertexArray=new Za,this.indexArray=new qr,this.programConfigurations=new hh(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new Gn,this.maxLineLength=0,this.zOffsetVertexArray=new Za,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:Dt/64}updateFootprints(o,l){}populate(o,l,d,p){this.hasPattern=vA("line",this.layers,this.pixelRatio,l);const _=this.layers[0].layout.get("line-sort-key");this.tileToMeter=$e(d);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const B=this.layers[0].layout.get("line-z-offset"),N=B.isConstant()&&!B.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&N?"none":"offset",this.elevationType==="offset"&&y==="none"&&Bi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const A=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&A!==void 0;const S=[];for(const{feature:B,id:N,index:U,sourceLayerIndex:j}of o){const K=this.layers[0]._featureFilter.needGeometry,ee=Jt(B,K);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),ee,d))continue;const le=_?_.evaluate(ee,{},d):void 0,re={id:N,properties:B.properties,type:B.type,sourceLayerIndex:j,index:U,geometry:K?ee.geometry:jt(B,d,p),patterns:{},sortKey:le};S.push(re)}_&&S.sort((B,N)=>B.sortKey-N.sortKey);const{lineAtlas:I,featureIndex:R}=l,P=this.addConstantDashes(I);for(const B of S){const{geometry:N,index:U,sourceLayerIndex:j}=B;if(P&&this.addFeatureDashes(B,I),this.hasPattern){const K=xA("line",this.layers,B,this.zoom,this.pixelRatio,l);this.patternFeatures.push(K)}else this.addFeature(B,N,U,d,I.positions,l.availableImages,l.brightness,l.elevationFeatures);R.insert(o[U].feature,N,U,j,this.index)}}addConstantDashes(o){let l=!1;for(const d of this.layers){const p=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if(p.kind!=="constant"||_.kind!=="constant")l=!0;else{const y=_.value,A=p.value;if(!A)continue;o.addDash(A,y)}}return l}addFeatureDashes(o,l){const d=this.zoom;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,y=p.layout.get("line-cap").value;if(_.kind==="constant"&&y.kind==="constant")continue;let A,S;if(_.kind==="constant"){if(A=_.value,!A)continue}else A=_.evaluate({zoom:d},o);S=y.kind==="constant"?y.value:y.evaluate({zoom:d},o),l.addDash(A,S),o.patterns[p.id]=[l.getKey(A,S)]}}update(o,l,d,p,_,y,A){this.programConfigurations.updatePaintArrays(o,l,_,d,p,y,A)}addFeatures(o,l,d,p,_,y){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,l,d,p,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,m5)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,_5)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,d5.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,f5),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,d,p,_,y,A,S){const I=this.layers[0].layout,R=I.get("line-join").evaluate(o,{}),P=I.get("line-cap").evaluate(o,{}),B=I.get("line-miter-limit"),N=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o,this.zOffsetValue=I.get("line-z-offset").value;const U=this.layers[0].paint.get("line-width").value;if(U.kind!=="constant"&&U.isLineProgressConstant===!1&&(this.variableWidthValue=U),this.elevationType==="road"){const j=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(o,l,p,S,R,P,B,N)){const[K,ee]=this.clipRuntimeLinesToTile(l,1);for(let le=0;le<K.length;le++){const re=K[le],G=ee[le],ie={progress:{min:G.progress.min,max:G.progress.max},nextDir:this.computeSegNextDir(G,re),prevDir:this.computeSegPrevDir(G,re)};this.addLine(re,o,p,R,P,B,N,ie)}this.fillNonElevatedRoadSegment(j)}}else for(const j of l)this.addLine(j,o,p,R,P,B,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,_,y,p,A)}computeSegNextDir(o,l){return o.nextPoint.sub(l.at(-2)).unit()}computeSegPrevDir(o,l){return l[1].sub(o.prevPoint).unit()}clipLinesToTile(o,l){return Jb(o,-l,-l,Dt+l,Dt+l)}clipRuntimeLinesToTile(o,l){const d=[];return[Jb(o,-l,-l,Dt+l,Dt+l,d),d]}addElevatedRoadFeature(o,l,d,p,_,y,A,S){const I=[],R=EA.getElevationFeature(o,p);if(R){const P=this.clipLinesToTile(l,1),B=this.prepareElevatedLines(P,R,d);for(const N of B)I.push({geometry:N,elevation:R,elevationTileID:d,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(I.length===0)return!1;for(const P of I){const B=this.layoutVertexArray.length;this.addLine(P.geometry,o,d,_,y,A,S);const N=new zI(d,P.elevationTileID);if(P.elevation)for(let U=B;U<this.layoutVertexArray.length;U++){const j=new ue(this.layoutVertexArray.int16[6*U]>>1,this.layoutVertexArray.int16[6*U+1]>>1),K=N.pointElevation(j,P.elevation,.05);this.updateHeightRange(K),this.zOffsetVertexArray.emplaceBack(K,0,0)}else this.fillNonElevatedRoadSegment(B)}return!0}prepareElevatedLines(o,l,d){if(l.constantHeight!=null)return o;const p=[],_=1/$e(d);for(const y of o)h5(y,new LI(l,_),0,p);return p}fillNonElevatedRoadSegment(o){for(let l=o;l<this.layoutVertexArray.length;l++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(o){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,o),this.heightRange.max=Math.max(this.heightRange.max,o)):this.heightRange={min:o,max:o}}addLine(o,l,d,p,_,y,A,S){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const I=p==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const R=S&&S.progress.min>0,P=S&&S.progress.max<1;if(this.lineClips){let Ce={min:this.lineClips.start,max:this.lineClips.end},Be=1;if(S){const et=this.lineClips.end-this.lineClips.start;Ce=function(mt,ht,pt){return{min:Jr(mt.min,ht,pt),max:Jr(mt.max,ht,pt)}}(S.progress,{min:0,max:1},Ce),et>0&&(Be=(Ce.max-Ce.min)/et)}const Fe=+l.properties.mapbox_clip_feature_len,Ve=+l.properties.mapbox_clip_seg_len;if(Number.isNaN(Fe)||Number.isNaN(Ve)){for(let mt=0;mt<o.length-1;mt++)this.totalDistance+=o[mt].dist(o[mt+1]);const et=this.totalDistance/(Ce.max-Ce.min);this.totalFeatureLength=Number.isFinite(et)?et:0,this.lineClips.start=Ce.min,this.lineClips.end=Ce.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Fe,this.distance=Ve*Be,this.lineClips.start=Ce.min,this.lineClips.end=Ce.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const B=y5[l.type]==="Polygon";let N=o.length;for(;N>=2&&o[N-1].equals(o[N-2]);)N--;let U=0;for(;U<N-1&&o[U].equals(o[U+1]);)U++;if(N<(B?3:2))return;p==="bevel"&&(y=1.05);const j=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let K,ee,le,re,G,ie,ae,fe;S&&S.prevDir&&(ie=S.prevDir.perp()),S&&S.nextDir&&(ae=S.nextDir.perp()),this.e1=this.e2=-1,B&&(K=o[N-2],G=o[U].sub(K)._unit()._perp());for(let Ce=U;Ce<N;Ce++){if(le=Ce===N-1?B?o[U+1]:void 0:o[Ce+1],le&&o[Ce].equals(le))continue;G&&(re=G),K&&(ee=K),K=o[Ce],fe=this.evaluateLineProgressFeatures(ee?ee.dist(K):0),G=le?le.sub(K)._unit()._perp():re,re=re||G;const Be=ee&&le;let Fe=Be?p:B||I?"butt":_;const Ve=re.x*G.x+re.y*G.y;if(I){const Ye=function(Qe){if(Qe.patternJoinNone){const At=Qe.segmentPoints.length/2,Et=Qe.lineSoFar-Qe.segmentStart;for(let Kt=0;Kt<At;++Kt){const $t=Qe.segmentPoints[2*Kt+1],Bt=Math.round(Qe.segmentPoints[2*Kt])+.5+.25*$t;Qe.patternVertexArray.emplaceBack(Bt,Et,Qe.segmentStart),Qe.patternVertexArray.emplaceBack(Bt,Et,Qe.segmentStart)}Qe.segmentPoints.length=0}Qe.e1=Qe.e2=-1};if(Be&&Ve<v5){this.updateDistance(ee,K),this.addCurrentVertex(K,re,1,1,j,fe),Ye(this),this.addCurrentVertex(K,G,-1,-1,j,fe);continue}if(ee){if(!le){this.updateDistance(ee,K),this.addCurrentVertex(K,re,1,1,j,fe),Ye(this);continue}Fe="miter"}}let et=re.add(G);et.x===0&&et.y===0||et._unit();const mt=et.x*G.x+et.y*G.y,ht=mt!==0?1/mt:1/0,pt=2*Math.sqrt(2-2*mt),xt=mt<b5&&ee&&le,Ke=re.x*G.y-re.y*G.x>0,ft=this.overscaling<=16?15*Dt/(512*this.overscaling):0;if(Be&&Fe==="round"){if(ht<A)Fe="miter";else if(ht<=2){const Ye=LA(K,-10,Dt+10);Fe=this.elevationType==="offset"&&(Ye||this.hasCrossSlope)?"miter":"fakeround"}}if(Fe==="miter"&&ht>y&&(Fe="bevel"),Fe==="bevel"&&(ht>2&&(Fe="flipbevel"),ht<y&&(Fe="miter")),ee&&!(Fe==="miter"&&xt)&&this.updateDistance(ee,K),Fe==="miter")if(xt){const Ye=K.dist(ee);if(Ye>2*ft){const At=K.sub(K.sub(ee)._mult(ft/Ye)._round());this.updateDistance(ee,At),this.addCurrentVertex(At,re,0,0,j,fe),ee=At}this.updateDistance(ee,K),et._mult(ht),this.addCurrentVertex(K,et,0,0,j,fe);const Qe=K.dist(le);if(Qe>2*ft){const At=K.add(le.sub(K)._mult(ft/Qe)._round());this.updateDistance(K,At),this.addCurrentVertex(At,G,0,0,j,fe),K=At}}else et._mult(ht),this.addCurrentVertex(K,et,0,0,j,fe);else if(Fe==="flipbevel"){if(ht>100)et=G.mult(-1);else{const Ye=ht*re.add(G).mag()/re.sub(G).mag();et._perp()._mult(Ye*(Ke?-1:1))}this.addCurrentVertex(K,et,0,0,j,fe),this.addCurrentVertex(K,et.mult(-1),0,0,j,fe)}else if(Fe==="bevel"||Fe==="fakeround"){fe!=null&&ee&&this.addCurrentVertex(K,ae||re,-1,-1,j,fe);const Ye=K.dist(ee)<=2*ft&&Fe!=="bevel",Qe=et.mult(Ke?1:-1);Qe._mult(ht);const At=G.mult(Ke?-1:1),Et=re.mult(Ke?-1:1),Kt=this.evaluateLineProgressFeatures(this.distance);if(fe==null&&(this.addHalfVertex(K,Qe.x,Qe.y,!1,!Ke,0,j,Kt),Ye||this.addHalfVertex(K,Qe.x+2*Et.x,Qe.y+2*Et.y,!1,Ke,0,j,Kt)),Fe==="fakeround"){const $t=Math.round(180*pt/Math.PI/20);this.addHalfVertex(K,Et.x,Et.y,!1,Ke,0,j,Kt);for(let Bt=0;Bt<$t;Bt++){let wt=Bt/$t;if(wt!==.5){const Xt=wt-.5;wt+=wt*Xt*(wt-1)*((1.0904+Ve*(Ve*(3.55645-1.43519*Ve)-3.2452))*Xt*Xt+(.848013+Ve*(.215638*Ve-1.06021)))}const pi=At.sub(Et)._mult(wt)._add(Et)._unit();this.addHalfVertex(K,pi.x,pi.y,!1,Ke,0,j,Kt)}this.addHalfVertex(K,At.x,At.y,!1,Ke,0,j,Kt)}Ye||fe!=null||this.addHalfVertex(K,Qe.x+2*At.x,Qe.y+2*At.y,!1,Ke,0,j,Kt),fe!=null&&le&&this.addCurrentVertex(K,ie||G,1,1,j,fe)}else if(Fe==="butt")this.addCurrentVertex(K,et,0,0,j,fe);else if(Fe==="square"){if(!ee){const Ye=R?0:-1;this.addCurrentVertex(K,et,Ye,Ye,j,fe)}if(this.addCurrentVertex(K,et,0,0,j,fe),ee){const Ye=P?0:1;this.addCurrentVertex(K,et,Ye,Ye,j,fe)}}else if(Fe==="round"){if(ee){const Ye=!Be&&ae?ae:re;this.addCurrentVertex(K,Ye,0,0,j,fe),!Be&&P||this.addCurrentVertex(K,Ye,1,1,j,fe,!0)}if(le){const Ye=!Be&&ie?ie:G;!Be&&R||this.addCurrentVertex(K,Ye,-1,-1,j,fe,!0),this.addCurrentVertex(K,Ye,0,0,j,fe)}}}}addVerticesTo(o,l,d,p,_,y,A,S,I,R){const P=(l.w-o.w)/this.tessellationStep|0;let B=0;const N=this.scaledDistance;if(P>1){this.lineSoFar=o.w;const j=(l.x-o.x)/P,K=(l.y-o.y)/P,ee=(l.z-o.z)/P,le=(l.w-o.w)/P;for(let re=1;re<P;++re){o.x+=j,o.y+=K,o.z+=ee,this.lineSoFar+=le,B+=le;const G=this.evaluateLineProgressFeatures(this.prevDistance+B);this.scaledDistance=(this.prevDistance+B)/this.totalDistance,this.addHalfVertex(o,d,p,R,!1,A,I,G),this.addHalfVertex(o,_,y,R,!0,-S,I,G)}}this.lineSoFar=l.w,this.scaledDistance=N;const U=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(l,d,p,R,!1,A,I,U),this.addHalfVertex(l,_,y,R,!0,-S,I,U)}evaluateLineProgressFeatures(o){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):Bi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let l=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(l=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:l}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:l}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:l}}addCurrentVertex(o,l,d,p,_,y,A=!1){const S=l.x+l.y*d,I=l.y-l.x*d,R=l.y*p-l.x,P=-l.y-l.x*p;if(y!=null){const B=this.elevationType==="offset",N=-10,U=Dt+10,j=y.zOffset,K=new y3(o.x,o.y,j,this.lineSoFar),ee=!!B&&LA(o,N,U),le=this.lineSoFar,re=this.distance;if(this.currentVertex)if(ee){const G=this.currentVertexIsOutside,ie=this.currentVertex,ae=new y3(o.x,o.y,j,this.lineSoFar);if(v3(ie,ae,N,U),!LA(ae,N,U)){if(G){this.e1=this.e2=-1,this.distance-=ie.dist(K),this.lineSoFar=ie.w;const fe=this.evaluateLineProgressFeatures(ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ie,S,I,A,!1,d,_,fe),this.addHalfVertex(ie,R,P,A,!0,-p,_,fe),this.prevDistance=this.distance}this.distance=this.prevDistance+ie.dist(ae),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ie,ae,S,I,R,P,d,p,_,A),this.distance=re,this.scaledDistance=this.distance/this.totalDistance}}else{const G=this.currentVertex;if(this.currentVertexIsOutside){v3(G,K,N,U),this.e1=this.e2=-1,this.distance-=G.dist(K),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=G.w;const ie=this.evaluateLineProgressFeatures(G.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(G,S,I,A,!1,d,_,ie),this.addHalfVertex(G,R,P,A,!0,-p,_,ie),this.prevDistance=this.distance,this.distance=re,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(G,K,S,I,R,P,d,p,_,A)}else ee||(this.addHalfVertex(o,S,I,A,!1,d,_,y),this.addHalfVertex(o,R,P,A,!0,-p,_,y));this.currentVertex=K,this.currentVertexIsOutside=ee,this.lineSoFar=le}else this.addHalfVertex(o,S,I,A,!1,d,_,y),this.addHalfVertex(o,R,P,A,!0,-p,_,y)}addHalfVertex({x:o,y:l},d,p,_,y,A,S,I){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,A)),this.layoutVertexArray.emplaceBack((o<<1)+(_?1:0),(l<<1)+(y?1:0),Math.round(63*d)+128,Math.round(63*p)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=ri(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const R=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),S.primitiveLength++),y?this.e2=R:this.e1=R,I!=null&&this.zOffsetVertexArray.emplaceBack(I.zOffset,I.variableWidth,I.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,l){this.prevDistance=this.distance,this.distance+=o.dist(l),this.updateScaledDistance()}}function LA(h,o,l){return h.x<o||h.x>l||h.y<o||h.y>l}let S3,E3;function C3(h,o,l){return o*(Dt/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}Ut(FA,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const I3=(h,o,l)=>(1-l)*h+l*o;function M3(h,o){return 1/C3(h,1,o.tileZoom)}function R3(h,o,l,d){return h.translatePosMatrix(d||o.tileID.projMatrix,o,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const k3=h=>{const o=[];P3(h)&&o.push("RENDER_LINE_DASH"),h.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const l=h.paint.get("line-trim-offset");l[0]===0&&l[1]===0||o.push("RENDER_LINE_TRIM_OFFSET"),h.paint.get("line-border-width").constantOr(1)!==0&&o.push("RENDER_LINE_BORDER");const d=h.layout.get("line-join").constantOr("miter")==="none",p=!!h.paint.get("line-pattern").constantOr(1);return d&&p&&o.push("LINE_JOIN_NONE"),o};function P3(h){const o=h.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}let zA;const D3=()=>zA||(zA={layout:S3||(S3=new or({"line-cap":new Nt(He.layout_line["line-cap"]),"line-join":new Nt(He.layout_line["line-join"]),"line-miter-limit":new It(He.layout_line["line-miter-limit"]),"line-round-limit":new It(He.layout_line["line-round-limit"]),"line-sort-key":new Nt(He.layout_line["line-sort-key"]),"line-z-offset":new Nt(He.layout_line["line-z-offset"]),"line-elevation-reference":new It(He.layout_line["line-elevation-reference"]),"line-cross-slope":new It(He.layout_line["line-cross-slope"]),visibility:new It(He.layout_line.visibility),"line-width-unit":new It(He.layout_line["line-width-unit"])})),paint:E3||(E3=new or({"line-opacity":new Nt(He.paint_line["line-opacity"]),"line-color":new Nt(He.paint_line["line-color"]),"line-translate":new It(He.paint_line["line-translate"]),"line-translate-anchor":new It(He.paint_line["line-translate-anchor"]),"line-width":new Nt(He.paint_line["line-width"]),"line-gap-width":new Nt(He.paint_line["line-gap-width"]),"line-offset":new Nt(He.paint_line["line-offset"]),"line-blur":new Nt(He.paint_line["line-blur"]),"line-dasharray":new Nt(He.paint_line["line-dasharray"]),"line-pattern":new Nt(He.paint_line["line-pattern"]),"line-pattern-cross-fade":new It(He.paint_line["line-pattern-cross-fade"]),"line-gradient":new sh(He.paint_line["line-gradient"]),"line-trim-offset":new It(He.paint_line["line-trim-offset"]),"line-trim-fade-range":new It(He.paint_line["line-trim-fade-range"]),"line-trim-color":new It(He.paint_line["line-trim-color"]),"line-emissive-strength":new It(He.paint_line["line-emissive-strength"]),"line-border-width":new Nt(He.paint_line["line-border-width"]),"line-border-color":new Nt(He.paint_line["line-border-color"]),"line-occlusion-opacity":new It(He.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},zA);class x5 extends Nt{possiblyEvaluate(o,l){return l=new pn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(o,l)}evaluate(o,l,d,p){return l=Ge({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(o,l,d,p)}}let x_;function B3(h,o){return o>0?o+2*h:h}const w5=tn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),A5=tn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),T5=tn([{name:"a_projected_pos",components:4,type:"Float32"}],4);tn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const S5=tn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),E5=tn([{name:"a_texb",components:2,type:"Uint16"}]),C5=tn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),I5=tn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const O3=tn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),M5=tn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);tn([{name:"triangle",components:3,type:"Uint16"}]),tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),tn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),tn([{type:"Float32",name:"offsetX"}]),tn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var es=24;function R5(h,o,l){return h.sections.forEach(d=>{d.text=function(p,_,y){const A=_.layout.get("text-transform").evaluate(y,{});return A==="uppercase"?p=p.toLocaleUpperCase():A==="lowercase"&&(p=p.toLocaleLowerCase()),qo.applyArabicShaping&&(p=qo.applyArabicShaping(p)),p}(d.text,o,l)}),h}const w_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function k5(h){return h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""}function P5(h){return h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""}var F3,NA,L3,UA={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function D5(){return F3||(F3=1,UA.read=function(h,o,l,d,p){var _,y,A=8*p-d-1,S=(1<<A)-1,I=S>>1,R=-7,P=l?p-1:0,B=l?-1:1,N=h[o+P];for(P+=B,_=N&(1<<-R)-1,N>>=-R,R+=A;R>0;_=256*_+h[o+P],P+=B,R-=8);for(y=_&(1<<-R)-1,_>>=-R,R+=d;R>0;y=256*y+h[o+P],P+=B,R-=8);if(_===0)_=1-I;else{if(_===S)return y?NaN:1/0*(N?-1:1);y+=Math.pow(2,d),_-=I}return(N?-1:1)*y*Math.pow(2,_-d)},UA.write=function(h,o,l,d,p,_){var y,A,S,I=8*_-p-1,R=(1<<I)-1,P=R>>1,B=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=d?0:_-1,U=d?1:-1,j=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(A=isNaN(o)?1:0,y=R):(y=Math.floor(Math.log(o)/Math.LN2),o*(S=Math.pow(2,-y))<1&&(y--,S*=2),(o+=y+P>=1?B/S:B*Math.pow(2,1-P))*S>=2&&(y++,S/=2),y+P>=R?(A=0,y=R):y+P>=1?(A=(o*S-1)*Math.pow(2,p),y+=P):(A=o*Math.pow(2,P-1)*Math.pow(2,p),y=0));p>=8;h[l+N]=255&A,N+=U,A/=256,p-=8);for(y=y<<p|A,I+=p;I>0;h[l+N]=255&y,N+=U,y/=256,I-=8);h[l+N-U]|=128*j}),UA}function z3(){if(L3)return NA;L3=1,NA=o;var h=D5();function o(G){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(G)?G:new Uint8Array(G||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var l=4294967296,d=1/l,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function _(G){return G.type===o.Bytes?G.readVarint()+G.pos:G.pos+1}function y(G,ie,ae){return ae?4294967296*ie+(G>>>0):4294967296*(ie>>>0)+(G>>>0)}function A(G,ie,ae){var fe=ie<=16383?1:ie<=2097151?2:ie<=268435455?3:Math.floor(Math.log(ie)/(7*Math.LN2));ae.realloc(fe);for(var Ce=ae.pos-1;Ce>=G;Ce--)ae.buf[Ce+fe]=ae.buf[Ce]}function S(G,ie){for(var ae=0;ae<G.length;ae++)ie.writeVarint(G[ae])}function I(G,ie){for(var ae=0;ae<G.length;ae++)ie.writeSVarint(G[ae])}function R(G,ie){for(var ae=0;ae<G.length;ae++)ie.writeFloat(G[ae])}function P(G,ie){for(var ae=0;ae<G.length;ae++)ie.writeDouble(G[ae])}function B(G,ie){for(var ae=0;ae<G.length;ae++)ie.writeBoolean(G[ae])}function N(G,ie){for(var ae=0;ae<G.length;ae++)ie.writeFixed32(G[ae])}function U(G,ie){for(var ae=0;ae<G.length;ae++)ie.writeSFixed32(G[ae])}function j(G,ie){for(var ae=0;ae<G.length;ae++)ie.writeFixed64(G[ae])}function K(G,ie){for(var ae=0;ae<G.length;ae++)ie.writeSFixed64(G[ae])}function ee(G,ie){return(G[ie]|G[ie+1]<<8|G[ie+2]<<16)+16777216*G[ie+3]}function le(G,ie,ae){G[ae]=ie,G[ae+1]=ie>>>8,G[ae+2]=ie>>>16,G[ae+3]=ie>>>24}function re(G,ie){return(G[ie]|G[ie+1]<<8|G[ie+2]<<16)+(G[ie+3]<<24)}return o.prototype={destroy:function(){this.buf=null},readFields:function(G,ie,ae){for(ae=ae||this.length;this.pos<ae;){var fe=this.readVarint(),Ce=fe>>3,Be=this.pos;this.type=7&fe,G(Ce,ie,this),this.pos===Be&&this.skip(fe)}return ie},readMessage:function(G,ie){return this.readFields(G,ie,this.readVarint()+this.pos)},readFixed32:function(){var G=ee(this.buf,this.pos);return this.pos+=4,G},readSFixed32:function(){var G=re(this.buf,this.pos);return this.pos+=4,G},readFixed64:function(){var G=ee(this.buf,this.pos)+ee(this.buf,this.pos+4)*l;return this.pos+=8,G},readSFixed64:function(){var G=ee(this.buf,this.pos)+re(this.buf,this.pos+4)*l;return this.pos+=8,G},readFloat:function(){var G=h.read(this.buf,this.pos,!0,23,4);return this.pos+=4,G},readDouble:function(){var G=h.read(this.buf,this.pos,!0,52,8);return this.pos+=8,G},readVarint:function(G){var ie,ae,fe=this.buf;return ie=127&(ae=fe[this.pos++]),ae<128?ie:(ie|=(127&(ae=fe[this.pos++]))<<7,ae<128?ie:(ie|=(127&(ae=fe[this.pos++]))<<14,ae<128?ie:(ie|=(127&(ae=fe[this.pos++]))<<21,ae<128?ie:function(Ce,Be,Fe){var Ve,et,mt=Fe.buf;if(Ve=(112&(et=mt[Fe.pos++]))>>4,et<128||(Ve|=(127&(et=mt[Fe.pos++]))<<3,et<128)||(Ve|=(127&(et=mt[Fe.pos++]))<<10,et<128)||(Ve|=(127&(et=mt[Fe.pos++]))<<17,et<128)||(Ve|=(127&(et=mt[Fe.pos++]))<<24,et<128)||(Ve|=(1&(et=mt[Fe.pos++]))<<31,et<128))return y(Ce,Ve,Be);throw new Error("Expected varint not more than 10 bytes")}(ie|=(15&(ae=fe[this.pos]))<<28,G,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var G=this.readVarint();return G%2==1?(G+1)/-2:G/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var G=this.readVarint()+this.pos,ie=this.pos;return this.pos=G,G-ie>=12&&p?function(ae,fe,Ce){return p.decode(ae.subarray(fe,Ce))}(this.buf,ie,G):function(ae,fe,Ce){for(var Be="",Fe=fe;Fe<Ce;){var Ve,et,mt,ht=ae[Fe],pt=null,xt=ht>239?4:ht>223?3:ht>191?2:1;if(Fe+xt>Ce)break;xt===1?ht<128&&(pt=ht):xt===2?(192&(Ve=ae[Fe+1]))==128&&(pt=(31&ht)<<6|63&Ve)<=127&&(pt=null):xt===3?(et=ae[Fe+2],(192&(Ve=ae[Fe+1]))==128&&(192&et)==128&&((pt=(15&ht)<<12|(63&Ve)<<6|63&et)<=2047||pt>=55296&&pt<=57343)&&(pt=null)):xt===4&&(et=ae[Fe+2],mt=ae[Fe+3],(192&(Ve=ae[Fe+1]))==128&&(192&et)==128&&(192&mt)==128&&((pt=(15&ht)<<18|(63&Ve)<<12|(63&et)<<6|63&mt)<=65535||pt>=1114112)&&(pt=null)),pt===null?(pt=65533,xt=1):pt>65535&&(pt-=65536,Be+=String.fromCharCode(pt>>>10&1023|55296),pt=56320|1023&pt),Be+=String.fromCharCode(pt),Fe+=xt}return Be}(this.buf,ie,G)},readBytes:function(){var G=this.readVarint()+this.pos,ie=this.buf.subarray(this.pos,G);return this.pos=G,ie},readPackedVarint:function(G,ie){if(this.type!==o.Bytes)return G.push(this.readVarint(ie));var ae=_(this);for(G=G||[];this.pos<ae;)G.push(this.readVarint(ie));return G},readPackedSVarint:function(G){if(this.type!==o.Bytes)return G.push(this.readSVarint());var ie=_(this);for(G=G||[];this.pos<ie;)G.push(this.readSVarint());return G},readPackedBoolean:function(G){if(this.type!==o.Bytes)return G.push(this.readBoolean());var ie=_(this);for(G=G||[];this.pos<ie;)G.push(this.readBoolean());return G},readPackedFloat:function(G){if(this.type!==o.Bytes)return G.push(this.readFloat());var ie=_(this);for(G=G||[];this.pos<ie;)G.push(this.readFloat());return G},readPackedDouble:function(G){if(this.type!==o.Bytes)return G.push(this.readDouble());var ie=_(this);for(G=G||[];this.pos<ie;)G.push(this.readDouble());return G},readPackedFixed32:function(G){if(this.type!==o.Bytes)return G.push(this.readFixed32());var ie=_(this);for(G=G||[];this.pos<ie;)G.push(this.readFixed32());return G},readPackedSFixed32:function(G){if(this.type!==o.Bytes)return G.push(this.readSFixed32());var ie=_(this);for(G=G||[];this.pos<ie;)G.push(this.readSFixed32());return G},readPackedFixed64:function(G){if(this.type!==o.Bytes)return G.push(this.readFixed64());var ie=_(this);for(G=G||[];this.pos<ie;)G.push(this.readFixed64());return G},readPackedSFixed64:function(G){if(this.type!==o.Bytes)return G.push(this.readSFixed64());var ie=_(this);for(G=G||[];this.pos<ie;)G.push(this.readSFixed64());return G},skip:function(G){var ie=7&G;if(ie===o.Varint)for(;this.buf[this.pos++]>127;);else if(ie===o.Bytes)this.pos=this.readVarint()+this.pos;else if(ie===o.Fixed32)this.pos+=4;else{if(ie!==o.Fixed64)throw new Error("Unimplemented type: "+ie);this.pos+=8}},writeTag:function(G,ie){this.writeVarint(G<<3|ie)},realloc:function(G){for(var ie=this.length||16;ie<this.pos+G;)ie*=2;if(ie!==this.length){var ae=new Uint8Array(ie);ae.set(this.buf),this.buf=ae,this.length=ie}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(G){this.realloc(4),le(this.buf,G,this.pos),this.pos+=4},writeSFixed32:function(G){this.realloc(4),le(this.buf,G,this.pos),this.pos+=4},writeFixed64:function(G){this.realloc(8),le(this.buf,-1&G,this.pos),le(this.buf,Math.floor(G*d),this.pos+4),this.pos+=8},writeSFixed64:function(G){this.realloc(8),le(this.buf,-1&G,this.pos),le(this.buf,Math.floor(G*d),this.pos+4),this.pos+=8},writeVarint:function(G){(G=+G||0)>268435455||G<0?function(ie,ae){var fe,Ce;if(ie>=0?(fe=ie%4294967296|0,Ce=ie/4294967296|0):(Ce=~(-ie/4294967296),4294967295^(fe=~(-ie%4294967296))?fe=fe+1|0:(fe=0,Ce=Ce+1|0)),ie>=18446744073709552e3||ie<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ae.realloc(10),function(Be,Fe,Ve){Ve.buf[Ve.pos++]=127&Be|128,Be>>>=7,Ve.buf[Ve.pos++]=127&Be|128,Be>>>=7,Ve.buf[Ve.pos++]=127&Be|128,Be>>>=7,Ve.buf[Ve.pos++]=127&Be|128,Ve.buf[Ve.pos]=127&(Be>>>=7)}(fe,0,ae),function(Be,Fe){var Ve=(7&Be)<<4;Fe.buf[Fe.pos++]|=Ve|((Be>>>=3)?128:0),Be&&(Fe.buf[Fe.pos++]=127&Be|((Be>>>=7)?128:0),Be&&(Fe.buf[Fe.pos++]=127&Be|((Be>>>=7)?128:0),Be&&(Fe.buf[Fe.pos++]=127&Be|((Be>>>=7)?128:0),Be&&(Fe.buf[Fe.pos++]=127&Be|((Be>>>=7)?128:0),Be&&(Fe.buf[Fe.pos++]=127&Be)))))}(Ce,ae)}(G,this):(this.realloc(4),this.buf[this.pos++]=127&G|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=G>>>7&127))))},writeSVarint:function(G){this.writeVarint(G<0?2*-G-1:2*G)},writeBoolean:function(G){this.writeVarint(!!G)},writeString:function(G){G=String(G),this.realloc(4*G.length),this.pos++;var ie=this.pos;this.pos=function(fe,Ce,Be){for(var Fe,Ve,et=0;et<Ce.length;et++){if((Fe=Ce.charCodeAt(et))>55295&&Fe<57344){if(!Ve){Fe>56319||et+1===Ce.length?(fe[Be++]=239,fe[Be++]=191,fe[Be++]=189):Ve=Fe;continue}if(Fe<56320){fe[Be++]=239,fe[Be++]=191,fe[Be++]=189,Ve=Fe;continue}Fe=Ve-55296<<10|Fe-56320|65536,Ve=null}else Ve&&(fe[Be++]=239,fe[Be++]=191,fe[Be++]=189,Ve=null);Fe<128?fe[Be++]=Fe:(Fe<2048?fe[Be++]=Fe>>6|192:(Fe<65536?fe[Be++]=Fe>>12|224:(fe[Be++]=Fe>>18|240,fe[Be++]=Fe>>12&63|128),fe[Be++]=Fe>>6&63|128),fe[Be++]=63&Fe|128)}return Be}(this.buf,G,this.pos);var ae=this.pos-ie;ae>=128&&A(ie,ae,this),this.pos=ie-1,this.writeVarint(ae),this.pos+=ae},writeFloat:function(G){this.realloc(4),h.write(this.buf,G,this.pos,!0,23,4),this.pos+=4},writeDouble:function(G){this.realloc(8),h.write(this.buf,G,this.pos,!0,52,8),this.pos+=8},writeBytes:function(G){var ie=G.length;this.writeVarint(ie),this.realloc(ie);for(var ae=0;ae<ie;ae++)this.buf[this.pos++]=G[ae]},writeRawMessage:function(G,ie){this.pos++;var ae=this.pos;G(ie,this);var fe=this.pos-ae;fe>=128&&A(ae,fe,this),this.pos=ae-1,this.writeVarint(fe),this.pos+=fe},writeMessage:function(G,ie,ae){this.writeTag(G,o.Bytes),this.writeRawMessage(ie,ae)},writePackedVarint:function(G,ie){ie.length&&this.writeMessage(G,S,ie)},writePackedSVarint:function(G,ie){ie.length&&this.writeMessage(G,I,ie)},writePackedBoolean:function(G,ie){ie.length&&this.writeMessage(G,B,ie)},writePackedFloat:function(G,ie){ie.length&&this.writeMessage(G,R,ie)},writePackedDouble:function(G,ie){ie.length&&this.writeMessage(G,P,ie)},writePackedFixed32:function(G,ie){ie.length&&this.writeMessage(G,N,ie)},writePackedSFixed32:function(G,ie){ie.length&&this.writeMessage(G,U,ie)},writePackedFixed64:function(G,ie){ie.length&&this.writeMessage(G,j,ie)},writePackedSFixed64:function(G,ie){ie.length&&this.writeMessage(G,K,ie)},writeBytesField:function(G,ie){this.writeTag(G,o.Bytes),this.writeBytes(ie)},writeFixed32Field:function(G,ie){this.writeTag(G,o.Fixed32),this.writeFixed32(ie)},writeSFixed32Field:function(G,ie){this.writeTag(G,o.Fixed32),this.writeSFixed32(ie)},writeFixed64Field:function(G,ie){this.writeTag(G,o.Fixed64),this.writeFixed64(ie)},writeSFixed64Field:function(G,ie){this.writeTag(G,o.Fixed64),this.writeSFixed64(ie)},writeVarintField:function(G,ie){this.writeTag(G,o.Varint),this.writeVarint(ie)},writeSVarintField:function(G,ie){this.writeTag(G,o.Varint),this.writeSVarint(ie)},writeStringField:function(G,ie){this.writeTag(G,o.Bytes),this.writeString(ie)},writeFloatField:function(G,ie){this.writeTag(G,o.Fixed32),this.writeFloat(ie)},writeDoubleField:function(G,ie){this.writeTag(G,o.Fixed64),this.writeDouble(ie)},writeBooleanField:function(G,ie){this.writeVarintField(G,!!ie)}},NA}var Qb=Qs(z3());const VA=3;function B5(h,o,l){o.glyphs=[],h===1&&l.readMessage(O5,o)}function O5(h,o,l){if(h===3){const{id:d,bitmap:p,width:_,height:y,left:A,top:S,advance:I}=l.readMessage(F5,{});o.glyphs.push({id:d,bitmap:new du({width:_+2*VA,height:y+2*VA},p),metrics:{width:_,height:y,left:A,top:S,advance:I}})}else h===4?o.ascender=l.readSVarint():h===5&&(o.descender=l.readSVarint())}function F5(h,o,l){h===1?o.id=l.readVarint():h===2?o.bitmap=l.readBytes():h===3?o.width=l.readVarint():h===4?o.height=l.readVarint():h===5?o.left=l.readSVarint():h===6?o.top=l.readSVarint():h===7&&(o.advance=l.readVarint())}const L5=VA,Oo={horizontal:1,vertical:2,horizontalOnly:3};class A_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(o,l){const d=new A_;return d.scale=o||1,d.fontStack=l,d}static forImage(o){const l=new A_;return l.image=o,l}}class Vp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l,d){const p=new Vp;for(let _=0;_<o.sections.length;_++){const y=o.sections[_];y.image?p.addImageSection(y,d):p.addTextSection(y,l)}return p}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(l,d){let p="";for(let _=0;_<l.length;_++){const y=l.charCodeAt(_+1)||null,A=l.charCodeAt(_-1)||null;p+=!d&&(y&&mb(y)&&!w_[l[_+1]]||A&&mb(A)&&!w_[l[_-1]])||!w_[l[_]]?l[_]:w_[l[_]]}return p}(this.text,o)}trim(){let o=0;for(let d=0;d<this.text.length&&ev[this.text.charCodeAt(d)];d++)o++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=o&&ev[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const d=new Vp;return d.text=this.text.substring(o,l),d.sectionIndex=this.sectionIndex.slice(o,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(A_.forText(o.scale,o.fontStack||l));const d=this.sections.length-1;for(let p=0;p<o.text.length;++p)this.sectionIndex.push(d)}addImageSection(o,l){const d=o.image?o.image.getPrimary():null;if(!d)return void Bi("Can't add FormattedSection with an empty image.");d.scaleSelf(l);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(A_.forImage(d)),this.sectionIndex.push(this.sections.length-1)):Bi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $A(h,o,l,d,p,_,y,A,S,I,R,P,B,N,U,j=1){const K=Vp.fromFeature(h,p,j);P===Oo.vertical&&K.verticalizePunctuation(B);let ee=[];const le=function(fe,Ce,Be,Fe,Ve,et){if(!fe)return[];const mt=[],ht=function(ft,Ye,Qe,At,Et,Kt){let $t=0;for(let Bt=0;Bt<ft.length();Bt++){const wt=ft.getSection(Bt);$t+=N3(ft.getCodePoint(Bt),wt,At,Et,Ye,Kt)}return $t/Math.max(1,Math.ceil($t/Qe))}(fe,Ce,Be,Fe,Ve,et),pt=fe.text.indexOf("")>=0;let xt=0;for(let ft=0;ft<fe.length();ft++){const Ye=fe.getSection(ft),Qe=fe.getCodePoint(ft);if(ev[Qe]||(xt+=N3(Qe,Ye,Fe,Ve,Ce,et)),ft<fe.length()-1){const At=!((Ke=Qe)<11904||!(oi["Bopomofo Extended"](Ke)||oi.Bopomofo(Ke)||oi["CJK Compatibility Forms"](Ke)||oi["CJK Compatibility Ideographs"](Ke)||oi["CJK Compatibility"](Ke)||oi["CJK Radicals Supplement"](Ke)||oi["CJK Strokes"](Ke)||oi["CJK Symbols and Punctuation"](Ke)||oi["CJK Unified Ideographs Extension A"](Ke)||oi["CJK Unified Ideographs"](Ke)||oi["Enclosed CJK Letters and Months"](Ke)||oi["Halfwidth and Fullwidth Forms"](Ke)||oi.Hiragana(Ke)||oi["Ideographic Description Characters"](Ke)||oi["Kangxi Radicals"](Ke)||oi["Katakana Phonetic Extensions"](Ke)||oi.Katakana(Ke)||oi["Vertical Forms"](Ke)||oi["Yi Radicals"](Ke)||oi["Yi Syllables"](Ke)));(z5[Qe]||At||Ye.image)&&mt.push(V3(ft+1,xt,ht,mt,N5(Qe,fe.getCodePoint(ft+1),At&&pt),!1))}}var Ke;return $3(V3(fe.length(),xt,ht,mt,0,!0))}(K,I,_,o,d,N),{processBidirectionalText:re,processStyledBidirectionalText:G}=qo;if(re&&K.sections.length===1){const fe=re(K.toString(),le);for(const Ce of fe){const Be=new Vp;Be.text=Ce,Be.sections=K.sections;for(let Fe=0;Fe<Ce.length;Fe++)Be.sectionIndex.push(0);ee.push(Be)}}else if(G){const fe=G(K.text,K.sectionIndex,le);for(const Ce of fe){const Be=new Vp;Be.text=Ce[0],Be.sectionIndex=Ce[1],Be.sections=K.sections,ee.push(Be)}}else ee=function(fe,Ce){const Be=[],Fe=fe.text;let Ve=0;for(const et of Ce)Be.push(fe.substring(Ve,et)),Ve=et;return Ve<Fe.length&&Be.push(fe.substring(Ve,Fe.length)),Be}(K,le);const ie=[],ae={positionedLines:ie,text:K.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(fe,Ce,Be,Fe,Ve,et,mt,ht,pt,xt,Ke,ft){let Ye=0,Qe=0,At=0;const Et=ht==="right"?1:ht==="left"?0:.5;let Kt=!1;for(const qt of Ve){const ui=qt.getSections();for(const Ai of ui){if(Ai.image)continue;const Ti=Ce[Ai.fontStack];if(Ti&&(Kt=Ti.ascender!==void 0&&Ti.descender!==void 0,!Kt))break}if(!Kt)break}let $t=0;for(const qt of Ve){qt.trim();const ui=qt.getMaxScale(),Ai=(ui-1)*es,Ti={positionedGlyphs:[],lineOffset:0};fe.positionedLines[$t]=Ti;const Di=Ti.positionedGlyphs;let Mi=0;if(!qt.length()){Qe+=et,++$t;continue}let Ci=0,vn=0;for(let he=0;he<qt.length();he++){const pe=qt.getSection(he),tt=qt.getSectionIndex(he),Mt=qt.getCodePoint(he);let Ft=pe.scale,Ot=null,Zt=null,ci=null,Ni=es,Ui=0;pt===Oo.vertical&&((Bt=Mt)===12312||Bt===12313||Bt===12316||Bt===12540||Bt===12448)&&(pt=Oo.horizontal);const Ii=!(pt===Oo.horizontal||!Ke&&!bd(Mt)||Ke&&(ev[Mt]||eA(Mt)));if(pe.image){const dn=Fe.get(pe.image.toString());if(!dn)continue;ci=pe.image,fe.iconsInText=fe.iconsInText||!0,Zt=dn.paddedRect;const Tn=dn.displaySize;Ft=Ft*es/ft,Ot={width:Tn[0],height:Tn[1],left:0,top:-3,advance:Ii?Tn[1]:Tn[0],localGlyph:!1},Ui=Kt?-Ot.height*Ft:ui*es-17-Tn[1]*Ft,Ni=Ot.advance;const Vi=(Ii?Tn[0]:Tn[1])*Ft-es*ui;Vi>0&&Vi>Mi&&(Mi=Vi)}else{const dn=Be[pe.fontStack];if(!dn)continue;dn[Mt]&&(Zt=dn[Mt]);const Tn=Ce[pe.fontStack];if(!Tn)continue;const Vi=Tn.glyphs[Mt];if(!Vi)continue;if(Ot=Vi.metrics,Ni=Mt!==8203?es:0,Kt){const Xn=Tn.ascender!==void 0?Math.abs(Tn.ascender):0,kn=Tn.descender!==void 0?Math.abs(Tn.descender):0,ln=(Xn+kn)*Ft;Ci<ln&&(Ci=ln,vn=(Xn-kn)/2*Ft),Ui=-Xn*Ft}else Ui=(ui-Ft)*es-17}Ii?(fe.verticalizable=!0,Di.push({glyph:Mt,image:ci,x:Ye,y:Qe+Ui,vertical:Ii,scale:Ft,localGlyph:Ot.localGlyph,fontStack:pe.fontStack,sectionIndex:tt,metrics:Ot,rect:Zt}),Ye+=Ni*Ft+xt):(Di.push({glyph:Mt,image:ci,x:Ye,y:Qe+Ui,vertical:Ii,scale:Ft,localGlyph:Ot.localGlyph,fontStack:pe.fontStack,sectionIndex:tt,metrics:Ot,rect:Zt}),Ye+=Ot.advance*Ft+xt)}Di.length!==0&&(At=Math.max(Ye-xt,At),Kt?j3(Di,Et,Mi,vn,et*ui/2):j3(Di,Et,Mi,0,et/2)),Ye=0;const Rn=et*ui+Mi;Ti.lineOffset=Math.max(Mi,Ai),Qe+=Rn,++$t}var Bt;const wt=Qe,{horizontalAlign:pi,verticalAlign:Xt}=jA(mt);(function(qt,ui,Ai,Ti,Di,Mi){const Ci=(ui-Ai)*Di,vn=-Mi*Ti;for(const Rn of qt)for(const he of Rn.positionedGlyphs)he.x+=Ci,he.y+=vn})(fe.positionedLines,Et,pi,Xt,At,wt),fe.top+=-Xt*wt,fe.bottom=fe.top+wt,fe.left+=-pi*At,fe.right=fe.left+At,fe.hasBaseline=Kt}(ae,o,l,d,ee,y,A,S,P,I,B,U),!function(fe){for(const Ce of fe)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(ie))return ae}const ev={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},z5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function N3(h,o,l,d,p,_){if(o.image){const y=d.get(o.image.toString());return y?y.displaySize[0]*o.scale*es/_+p:0}{const y=l[o.fontStack],A=y&&y.glyphs[h];return A?A.metrics.advance*o.scale+p:0}}function U3(h,o,l,d){const p=Math.pow(h-o,2);return d?h<o?p/2:2*p:p+Math.abs(l)*l}function N5(h,o,l){let d=0;return h===10&&(d-=1e4),l&&(d+=150),h!==40&&h!==65288||(d+=50),o!==41&&o!==65289||(d+=50),d}function V3(h,o,l,d,p,_){let y=null,A=U3(o,l,p,_);for(const S of d){const I=U3(o-S.x,l,p,_)+S.badness;I<=A&&(y=S,A=I)}return{index:h,x:o,priorBreak:y,badness:A}}function $3(h){return h?$3(h.priorBreak).concat(h.index):[]}function jA(h){let o=.5,l=.5;switch(h){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function j3(h,o,l,d,p){if(!(o||l||d||p))return;const _=h.length-1,y=h[_],A=(y.x+y.metrics.advance*y.scale)*o;for(let S=0;S<=_;S++)h[S].x-=A,h[S].y+=l+d+p}function H3(h){return h.imagePrimary!==void 0&&h.top!==void 0&&h.bottom!==void 0&&h.left!==void 0&&h.right!==void 0}function U5(h,o,l,d){const{horizontalAlign:p,verticalAlign:_}=jA(d),y=l[0]-h.displaySize[0]*p,A=l[1]-h.displaySize[1]*_;return{imagePrimary:h,imageSecondary:o,top:A,bottom:A+h.displaySize[1],left:y,right:y+h.displaySize[0]}}function W3(h,o,l,d,p,_){const y=h.imagePrimary;let A;if(y.content){const K=y.content,ee=y.pixelRatio||1;A=[K[0]/ee,K[1]/ee,y.displaySize[0]-K[2]/ee,y.displaySize[1]-K[3]/ee]}const S=o.left*_,I=o.right*_;let R,P,B,N;l==="width"||l==="both"?(N=p[0]+S-d[3],P=p[0]+I+d[1]):(N=p[0]+(S+I-y.displaySize[0])/2,P=N+y.displaySize[0]);const U=o.top*_,j=o.bottom*_;return l==="height"||l==="both"?(R=p[1]+U-d[0],B=p[1]+j+d[2]):(R=p[1]+(U+j-y.displaySize[1])/2,B=R+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:R,right:P,bottom:B,left:N,collisionPadding:A}}function G3(h){return!h.imagePrimary.stretchX}function X3(h){return!h.imagePrimary.stretchY}function q3(h){return{width:h.right-h.left,height:h.bottom-h.top}}const _c=128;function Y3(h,o){const{expression:l}=o;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new pn(h+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:p}=l;let _=0;for(;_<d.length&&d[_]<=h;)_++;_=Math.max(0,_-1);let y=_;for(;y<d.length&&d[y]<h+1;)y++;y=Math.min(d.length-1,y);const A=d[_],S=d[y];return l.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:S,interpolationType:p}:{kind:"camera",minZoom:A,maxZoom:S,minSize:l.evaluate(new pn(A)),maxSize:l.evaluate(new pn(S)),interpolationType:p}}}function HA(h,{uSize:o,uSizeT:l},{lowerSize:d,upperSize:p}){return h.kind==="source"?d/_c:h.kind==="composite"?ri(d/_c,p/_c,l):o}function T_(h,o,l=1){let d=0,p=0;if(h.kind==="constant")p=h.layoutSize*l;else if(h.kind!=="source"){const{interpolationType:_,minZoom:y,maxZoom:A}=h,S=_?De(io.interpolationFactor(_,o,y,A),0,1):0;h.kind==="camera"?p=ri(h.minSize,h.maxSize,S)*l:d=S*l}return{uSizeT:d,uSize:p}}class fh extends ue{constructor(o,l,d,p,_){super(o,l),this.angle=p,this.z=d,_!==void 0&&(this.segment=_)}clone(){return new fh(this.x,this.y,this.z,this.angle,this.segment)}}function Z3(h,o,l,d,p){if(o.segment===void 0)return!0;let _=o,y=o.segment+1,A=0;for(;A>-l/2;){if(y--,y<0)return!1;A-=h[y].dist(_),_=h[y]}A+=h[y].dist(h[y+1]),y++;const S=[];let I=0;for(;A<l/2;){const R=h[y],P=h[y+1];if(!P)return!1;let B=h[y-1].angleTo(R)-R.angleTo(P);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:A,angleDelta:B}),I+=B;A-S[0].distance>d;)I-=S.shift().angleDelta;if(I>p)return!1;y++,A+=R.dist(P)}return!0}function K3(h){let o=0;for(let l=0;l<h.length-1;l++)o+=h[l].dist(h[l+1]);return o}function J3(h,o,l){return h?.6*o*l:0}function Q3(h,o){return Math.max(h?h.right-h.left:0,o?o.right-o.left:0)}function V5(h,o,l,d,p,_){const y=J3(l,p,_),A=Q3(l,d)*_;let S=0;const I=K3(h)/2;for(let R=0;R<h.length-1;R++){const P=h[R],B=h[R+1],N=P.dist(B);if(S+N>I){const U=(I-S)/N,j=ri(P.x,B.x,U),K=ri(P.y,B.y,U),ee=new fh(j,K,0,B.angleTo(P),R);return!y||Z3(h,ee,A,y,o)?ee:void 0}S+=N}}function $5(h,o,l,d,p,_,y,A,S){const I=J3(d,_,y),R=Q3(d,p),P=R*y,B=h[0].x===0||h[0].x===S||h[0].y===0||h[0].y===S;return o-P<o/4&&(o=P+o/4),eM(h,B?o/2*A%o:(R/2+2*_)*y*A%o,o,I,l,P,B,!1,S)}function eM(h,o,l,d,p,_,y,A,S){const I=_/2,R=K3(h);let P=0,B=o-l,N=[];for(let U=0;U<h.length-1;U++){const j=h[U],K=h[U+1],ee=j.dist(K),le=K.angleTo(j);for(;B+l<P+ee;){B+=l;const re=(B-P)/ee,G=ri(j.x,K.x,re),ie=ri(j.y,K.y,re);if(G>=0&&G<S&&ie>=0&&ie<S&&B-I>=0&&B+I<=R){const ae=new fh(G,ie,0,le,U);d&&!Z3(h,ae,_,d,p)||N.push(ae)}}P+=ee}return A||N.length||y||(N=eM(h,P/2,l,d,p,_,y,!0,S)),N}function tM(h){let o=0,l=0;for(const y of h)o+=y.w*y.h,l=Math.max(l,y.w);h.sort((y,A)=>A.h-y.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let p=0,_=0;for(const y of h)for(let A=d.length-1;A>=0;A--){const S=d[A];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,_=Math.max(_,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===S.w&&y.h===S.h){const I=d.pop();A<d.length&&(d[A]=I)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(d.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:p,h:_,fill:o/(p*_)||0}}Ut(fh,"Anchor");const zd=1;class S_{static getImagePositionScale(o,l,d){if(l&&o&&o.options&&o.options.transform){const p=o.options.transform;return{x:p.a,y:p.d}}return{x:d,y:d}}constructor(o,l,d,p){this.paddedRect=o;const{pixelRatio:_,version:y,stretchX:A,stretchY:S,content:I,sdf:R,usvg:P}=l;this.pixelRatio=_,this.stretchX=A,this.stretchY=S,this.content=I,this.version=y,this.padding=d,this.sdf=R,this.scale=S_.getImagePositionScale(p,P,_)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function WA(h,o,l){const d=ma.parse(h),p=function(_,y,A=[1,1]){return{x:0,y:0,w:(_.data?_.data.width:_.width*A[0])+2*y,h:(_.data?_.data.height:_.height*A[1])+2*y}}(o,l,[d.options.transform.a,d.options.transform.d]);return{bin:p,imagePosition:new S_(p,o,l,d),imageVariant:d}}class iM{constructor(o,l,d){const p=new Map,_=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(o,p,zd,y),this.addImages(l,_,2,y);const{w:A,h:S}=tM(y),I=new ys({width:A||1,height:S||1});for(const[R,P]of o.entries()){const B=p.get(R).paddedRect;ys.copy(P.data,I,{x:0,y:0},{x:B.x+zd,y:B.y+zd},P.data,d,P.sdf)}for(const[R,P]of l.entries()){const B=_.get(R),N=B.paddedRect;let U=B.padding;const j=N.x+U,K=N.y+U,ee=P.data.width,le=P.data.height;U=U>1?U-1:U,ys.copy(P.data,I,{x:0,y:0},{x:j,y:K},P.data,d),ys.copy(P.data,I,{x:0,y:le-U},{x:j,y:K-U},{width:ee,height:U},d),ys.copy(P.data,I,{x:0,y:0},{x:j,y:K+le},{width:ee,height:U},d),ys.copy(P.data,I,{x:ee-U,y:0},{x:j-U,y:K},{width:U,height:le},d),ys.copy(P.data,I,{x:0,y:0},{x:j+ee,y:K},{width:U,height:le},d),ys.copy(P.data,I,{x:ee-U,y:le-U},{x:j-U,y:K-U},{width:U,height:U},d),ys.copy(P.data,I,{x:0,y:le-U},{x:j+ee,y:K-U},{width:U,height:U},d),ys.copy(P.data,I,{x:0,y:0},{x:j+ee,y:K+le},{width:U,height:U},d),ys.copy(P.data,I,{x:ee-U,y:0},{x:j-U,y:K+le},{width:U,height:U},d)}this.lut=d,this.image=I,this.iconPositions=p,this.patternPositions=_}addImages(o,l,d,p){for(const[_,y]of o.entries()){const{bin:A,imagePosition:S,imageVariant:I}=WA(_,y,d);l.set(_,S),p.push(A),y.hasRenderCallback&&this.haveRenderCallbacks.push(I.id)}}patchUpdatedImages(o,l,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>o.hasImage(p,d)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const p of o.getUpdatedImages(d)){for(const _ of this.iconPositions.keys()){const y=ma.parse(_);if(bo.isEqual(y.id,p)){const A=o.getImage(p,d);this.patchUpdatedImage(this.iconPositions.get(_),A,l)}}for(const _ of this.patternPositions.keys()){const y=ma.parse(_);if(bo.isEqual(y.id,p)){const A=o.getImage(p,d);this.patchUpdatedImage(this.patternPositions.get(_),A,l)}}}}patchUpdatedImage(o,l,d){if(!o||!l||o.version===l.version)return;o.version=l.version;const[p,_]=o.tl,y=o.sdf;if(this.lut||y){const A={width:l.data.width,height:l.data.height},S=new ys(A);ys.copy(l.data,S,{x:0,y:0},{x:0,y:0},A,this.lut,y),d.update(S,{position:{x:p,y:_}})}else d.update(l.data,{position:{x:p,y:_}})}}Ut(S_,"ImagePosition"),Ut(iM,"ImageAtlas");const tv=1e20;function nM(h,o,l,d,p,_,y,A,S){for(let I=o;I<o+d;I++)rM(h,l*_+I,_,p,y,A,S);for(let I=l;I<l+p;I++)rM(h,I*_+o,1,d,y,A,S)}function rM(h,o,l,d,p,_,y){_[0]=0,y[0]=-1e20,y[1]=tv,p[0]=h[o];for(let A=1,S=0,I=0;A<d;A++){p[A]=h[o+A*l];const R=A*A;do{const P=_[S];I=(p[A]-p[P]+R-P*P)/(A-P)/2}while(I<=y[S]&&--S>-1);S++,_[S]=A,y[S]=I,y[S+1]=tv}for(let A=0,S=0;A<d;A++){for(;y[S+1]<A;)S++;const I=_[S],R=A-I;h[o+A*l]=p[I]+R*R}}const Cl=2,GA={none:0,ideographs:1,all:2};class $p{constructor(o,l,d){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=d,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o,l){this.urls[l]=o}getGlyphs(o,l,d){const p=[],_=this.urls[l]||_s.GLYPHS_URL;for(const y in o)for(const A of o[y])p.push({stack:y,id:A});nt(p,({stack:y,id:A},S)=>{let I=this.entries[y];I||(I=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=I.glyphs[A];if(R!==void 0)return void S(null,{stack:y,id:A,glyph:R});if(R=this._tinySDF(I,y,A),R)return I.glyphs[A]=R,void S(null,{stack:y,id:A,glyph:R});const P=Math.floor(A/256);if(256*P>65535)return Bi("glyphs > 65535 not supported"),void S(null,{stack:y,id:A,glyph:R});if(I.ranges[P])return void S(null,{stack:y,id:A,glyph:R});let B=I.requests[P];B||(B=I.requests[P]=[],$p.loadGlyphRange(y,P,_,this.requestManager,(N,U)=>{if(U){I.ascender=U.ascender,I.descender=U.descender;for(const j in U.glyphs)this._doesCharSupportLocalGlyph(+j)||(I.glyphs[+j]=U.glyphs[+j]);I.ranges[P]=!0}for(const j of B)j(N,U);delete I.requests[P]})),B.push((N,U)=>{N?S(N):U&&S(null,{stack:y,id:A,glyph:U.glyphs[A]||null})})},(y,A)=>{if(y)d(y);else if(A){const S={};for(const{stack:I,id:R,glyph:P}of A)S[I]===void 0&&(S[I]={}),S[I].glyphs===void 0&&(S[I].glyphs={}),S[I].glyphs[R]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},S[I].ascender=this.entries[I].ascender,S[I].descender=this.entries[I].descender;d(null,S)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==GA.none&&(this.localGlyphMode===GA.all?!!this.localFontFamily:!!this.localFontFamily&&(oi["CJK Unified Ideographs"](o)||oi["Hangul Syllables"](o)||oi.Hiragana(o)||oi.Katakana(o)||oi["CJK Symbols and Punctuation"](o)||oi["CJK Unified Ideographs Extension A"](o)||oi["CJK Unified Ideographs Extension B"](o)||oi.Osage(o)))}_tinySDF(o,l,d){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let _=o.tinySDF;if(!_){let j="400";/bold/i.test(l)?j="900":/medium/i.test(l)?j="500":/light/i.test(l)&&(j="200"),_=o.tinySDF=new $p.TinySDF({fontFamily:p,fontWeight:j,fontSize:24*Cl,buffer:3*Cl,radius:8*Cl}),_.fontWeight=j}if(this.localGlyphs[_.fontWeight][d])return this.localGlyphs[_.fontWeight][d];const y=String.fromCodePoint(d),{data:A,width:S,height:I,glyphWidth:R,glyphHeight:P,glyphLeft:B,glyphTop:N,glyphAdvance:U}=_.draw(y);return this.localGlyphs[_.fontWeight][d]={id:d,bitmap:new du({width:S,height:I},A),metrics:{width:R/Cl,height:P/Cl,left:B/Cl,top:N/Cl-27,advance:U/Cl,localGlyph:!0}}}}$p.loadGlyphRange=function(h,o,l,d,p){const _=256*o,y=_+255,A=d.transformRequest(d.normalizeGlyphsURL(l).replace("{fontstack}",h).replace("{range}",`${_}-${y}`),Uf.Glyphs);Dh(A,(S,I)=>{if(S)p(S);else if(I){const R={},P=function(B){return new Qb(B).readFields(B5,{})}(I);for(const B of P.glyphs)R[B.id]=B;p(null,{glyphs:R,ascender:P.ascender,descender:P.descender})}})},$p.TinySDF=class{constructor({fontSize:h=24,buffer:o=3,radius:l=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:y="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=l;const A=this.size=h+4*o,S=this._createCanvas(A),I=this.ctx=S.getContext("2d",{willReadFrequently:!0});I.font=`${y} ${_} ${h}px ${p}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(h){const o=document.createElement("canvas");return o.width=o.height=h,o}draw(h){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(h),y=Math.ceil(l),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-p))),S=Math.min(this.size-this.buffer,y+Math.ceil(d)),I=A+2*this.buffer,R=S+2*this.buffer,P=Math.max(I*R,0),B=new Uint8ClampedArray(P),N={data:B,width:I,height:R,glyphWidth:A,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:o};if(A===0||S===0)return N;const{ctx:U,buffer:j,gridInner:K,gridOuter:ee}=this;U.clearRect(j,j,A,S),U.fillText(h,j,j+y);const le=U.getImageData(j,j,A,S);ee.fill(tv,0,P),K.fill(0,0,P);for(let re=0;re<S;re++)for(let G=0;G<A;G++){const ie=le.data[4*(re*A+G)+3]/255;if(ie===0)continue;const ae=(re+j)*I+G+j;if(ie===1)ee[ae]=0,K[ae]=tv;else{const fe=.5-ie;ee[ae]=fe>0?fe*fe:0,K[ae]=fe<0?fe*fe:0}}nM(ee,0,0,I,R,I,this.f,this.v,this.z),nM(K,j,j,A,S,I,this.f,this.v,this.z);for(let re=0;re<P;re++){const G=Math.sqrt(ee[re])-Math.sqrt(K[re]);B[re]=Math.round(255-255*(G/this.radius+this.cutoff))}return N}};const Nd=zd;function sM(h,o){return h+o[1]-o[0]}function oM(h,o,l,d,p=1){const _=[],y=h.imagePrimary,A=y.pixelRatio,S=y.paddedRect.w-2*Nd,I=y.paddedRect.h-2*Nd,R=(h.right-h.left)*p,P=(h.bottom-h.top)*p,B=y.stretchX||[[0,S]],N=y.stretchY||[[0,I]],U=B.reduce(sM,0),j=N.reduce(sM,0),K=S-U,ee=I-j;let le=0,re=U,G=0,ie=j,ae=0,fe=K,Ce=0,Be=ee;if(y.content&&d){const Ve=y.content;le=iv(B,0,Ve[0]),G=iv(N,0,Ve[1]),re=iv(B,Ve[0],Ve[2]),ie=iv(N,Ve[1],Ve[3]),ae=Ve[0]-le,Ce=Ve[1]-G,fe=Ve[2]-Ve[0]-re,Be=Ve[3]-Ve[1]-ie}const Fe=(Ve,et,mt,ht)=>{const pt=nv(Ve.stretch-le,re,R,h.left*p),xt=rv(Ve.fixed-ae,fe,Ve.stretch,U),Ke=nv(et.stretch-G,ie,P,h.top*p),ft=rv(et.fixed-Ce,Be,et.stretch,j),Ye=nv(mt.stretch-le,re,R,h.left*p),Qe=rv(mt.fixed-ae,fe,mt.stretch,U),At=nv(ht.stretch-G,ie,P,h.top*p),Et=rv(ht.fixed-Ce,Be,ht.stretch,j),Kt=new ue(pt,Ke),$t=new ue(Ye,Ke),Bt=new ue(Ye,At),wt=new ue(pt,At),pi=new ue(xt/A,ft/A),Xt=new ue(Qe/A,Et/A),qt=o*Math.PI/180;if(qt){const Ci=Math.sin(qt),vn=Math.cos(qt),Rn=[vn,-Ci,Ci,vn];Kt._matMult(Rn),$t._matMult(Rn),wt._matMult(Rn),Bt._matMult(Rn)}const ui=Ve.stretch+Ve.fixed,Ai=mt.stretch+mt.fixed,Ti=et.stretch+et.fixed,Di=ht.stretch+ht.fixed,Mi=h.imageSecondary;return{tl:Kt,tr:$t,bl:wt,br:Bt,texPrimary:{x:y.paddedRect.x+Nd+ui,y:y.paddedRect.y+Nd+Ti,w:Ai-ui,h:Di-Ti},texSecondary:Mi?{x:Mi.paddedRect.x+Nd+ui,y:Mi.paddedRect.y+Nd+Ti,w:Ai-ui,h:Di-Ti}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pi,pixelOffsetBR:Xt,minFontScaleX:fe/A/R,minFontScaleY:Be/A/P,isSDF:l}};if(d&&(y.stretchX||y.stretchY)){const Ve=aM(B,K,U),et=aM(N,ee,j);for(let mt=0;mt<Ve.length-1;mt++){const ht=Ve[mt],pt=Ve[mt+1];for(let xt=0;xt<et.length-1;xt++)_.push(Fe(ht,et[xt],pt,et[xt+1]))}}else _.push(Fe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:I+1}));return _}function iv(h,o,l){let d=0;for(const p of h)d+=Math.max(o,Math.min(l,p[1]))-Math.max(o,Math.min(l,p[0]));return d}function aM(h,o,l){const d=[{fixed:-1,stretch:0}];for(const[p,_]of h){const y=d[d.length-1];d.push({fixed:p-y.stretch,stretch:y.stretch}),d.push({fixed:p-y.stretch,stretch:y.stretch+(_-p)})}return d.push({fixed:o+Nd,stretch:l}),d}function nv(h,o,l,d){return h/o*l+d}function rv(h,o,l,d){return h-o*l/d}function j5(h,o,l,d){const p=o+h.positionedLines[d].lineOffset;return d===0?l+p/2:l+(p+(o+h.positionedLines[d-1].lineOffset))/2}function H5(h,o=1,l=!1){let d=1/0,p=1/0,_=-1/0,y=-1/0;const A=h[0];for(let N=0;N<A.length;N++){const U=A[N];(!N||U.x<d)&&(d=U.x),(!N||U.y<p)&&(p=U.y),(!N||U.x>_)&&(_=U.x),(!N||U.y>y)&&(y=U.y)}const S=Math.min(_-d,y-p);let I=S/2;const R=new Kf([],W5);if(S===0)return new ue(d,p);for(let N=d;N<_;N+=S)for(let U=p;U<y;U+=S)R.push(new jp(N+I,U+I,I,h));let P=function(N){let U=0,j=0,K=0;const ee=N[0];for(let le=0,re=ee.length,G=re-1;le<re;G=le++){const ie=ee[le],ae=ee[G],fe=ie.x*ae.y-ae.x*ie.y;j+=(ie.x+ae.x)*fe,K+=(ie.y+ae.y)*fe,U+=3*fe}return new jp(j/U,K/U,0,N)}(h),B=R.length;for(;R.length;){const N=R.pop();(N.d>P.d||!P.d)&&(P=N,l&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,B)),N.max-P.d<=o||(I=N.h/2,R.push(new jp(N.p.x-I,N.p.y-I,I,h)),R.push(new jp(N.p.x+I,N.p.y-I,I,h)),R.push(new jp(N.p.x-I,N.p.y+I,I,h)),R.push(new jp(N.p.x+I,N.p.y+I,I,h)),B+=4)}return l&&(console.log(`num probes: ${B}`),console.log(`best distance: ${P.d}`)),P.p}function W5(h,o){return o.max-h.max}class jp{constructor(o,l,d,p){this.p=new ue(o,l),this.h=d,this.d=function(_,y){let A=!1,S=1/0;for(let I=0;I<y.length;I++){const R=y[I];for(let P=0,B=R.length,N=B-1;P<B;N=P++){const U=R[P],j=R[N];U.y>_.y!=j.y>_.y&&_.x<(j.x-U.x)*(_.y-U.y)/(j.y-U.y)+U.x&&(A=!A),S=Math.min(S,$i(_,U,j))}}return(A?1:-1)*Math.sqrt(S)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const G5=Object.keys,XA=Number.POSITIVE_INFINITY,X5=Math.sqrt(2);function lM(h,[o,l]){let d=0,p=0;if(l===XA){o<0&&(o=0);const _=o/X5;switch(h){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(h){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=o;break;case"right":d=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),h){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(h){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}}return[d,p]}function sv(h,o,l,d,p,_,y,A,S){if(!o||!o.usvg)return;const I=q3(d),R=q3(p),P=_!=="both"&&_!=="width"||!G3(d)?1:Math.max(1,R.width/I.width),B=_!=="both"&&_!=="height"||!X3(d)?1:Math.max(1,R.height/I.height);l.scaleSelf(P,B);const N=l.toString();y.set(N,l),A.set(N,o);const{imagePosition:U}=WA(N,o,zd);S.set(N,U)}function cM(h,o,l,d,p,_,y,A){if(!h)return;const S=function(I,R,P,B,N){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const U=R.possiblyEvaluate(new pn(I.maxZoom),P).evaluate(N,{},P),j=R.possiblyEvaluate(new pn(I.minZoom),P).evaluate(N,{},P);return Math.max(U,j)}return R.possiblyEvaluate(new pn(B)).evaluate(N,{},P)}(o,l,d,p,_);return h.scaleSelf(S*A*y)}function hM(h,o,l,d,p,_,y,A){return{iconPrimary:cM(h.getPrimary(),o,l,d,p,_,y,A),iconSecondary:cM(h.getSecondary(),o,l,d,p,_,y,A)}}function uM(h,o,l,d){if(!h)return;const p=o.get(l.toString());if(h.imagePrimary=p,d){const _=o.get(d.toString());h.imageSecondary=_}}function q5(h,o){for(const l in h.horizontal)dM(h.horizontal[l],o);dM(h.vertical,o)}function dM(h,o){if(h){for(const l of h.positionedLines)for(const d of l.positionedGlyphs)if(d.image!==null){const p=d.image.toString();d.rect=o.get(p).paddedRect}}}function qA(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Y5(h,o,l,d,p,_,y,A,S){const I=YA(_.horizontal)||_.vertical,R=l.get("icon-text-fit-padding").evaluate(d,{},p);let P,B=o;return o&&S!=="none"&&(h.allowVerticalPlacement&&_.vertical&&(P=W3(o,_.vertical,S,R,A,y)),I&&(B=W3(o,I,S,R,A,y))),{defaultShapedIcon:B,verticallyShapedIcon:P}}function Z5(h,o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K,ee,le,re){let G=y.textMaxSize.evaluate(o,{},B);G===void 0?G=A*y.textScaleFactor:G*=y.textScaleFactor;const ie=h.layers[0].layout,ae=YA(l.horizontal)||l.vertical,fe=N.name==="globe",Ce=es,Be=h.tilePixelRatio*G/Ce,Fe=(xt=h.overscaling,h.zoom>18&&xt>2&&(xt>>=1),Math.max(Dt/(512*xt),1)*ie.get("symbol-spacing")),Ve=ie.get("text-padding")*h.tilePixelRatio,et=ie.get("icon-padding")*h.tilePixelRatio,mt=H(ie.get("text-max-angle")),ht=ie.get("icon-rotation-alignment")==="map"&&re!=="point",pt=Fe/2;var xt;h.hasAnyIconTextFit===!1&&K!=="none"&&(h.hasAnyIconTextFit=!0);const Ke=o.properties?+o.properties[Bd]:null,ft=Ke&&h.elevationFeatureIdToIndex?h.elevationFeatureIdToIndex.get(Ke):65535,Ye=(Qe,At,Et)=>{if(At.x<0||At.x>=Dt||At.y<0||At.y>=Dt)return;let Kt=null;if(fe){const{x:$t,y:Bt,z:wt}=N.projectTilePoint(At.x,At.y,Et);Kt={anchor:new fh($t,Bt,wt,0,void 0),up:N.upVector(Et,At.x,At.y)}}(function($t,Bt,wt,pi,Xt,qt,ui,Ai,Ti,Di,Mi,Ci,vn,Rn,he,pe,tt,Mt,Ft,Ot,Zt,ci,Ni,Ui,Ii,dn,Tn,Vi,Xn){const kn=$t.addToLineVertexArray(Bt,pi);let ln,lr,Dn,Sn,Pn,fn,ki,_n=0,qn=0,li=0,Gi=0,Bn=-1,ir=-1;const Nn={};let Br=yo("");const xn=wt?wt.anchor:Bt,Ir=Vi!=="none";let wo=0,bs=0;if(Ti._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Or=Ti.layout.get("text-offset").evaluate(Zt,{},Ii);wo=Or[0]*es,bs=Or[1]*es}else wo=Ti.layout.get("text-radial-offset").evaluate(Zt,{},Ii)*es,bs=XA;if($t.allowVerticalPlacement&&Xt.vertical){const Or=Xt.vertical;if(he)fn=ZA(Or),Ai&&(ki=ZA(Ai));else{const Vr=Ti.layout.get("text-rotate").evaluate(Zt,{},Ii)+90;Dn=ov(Di,xn,Bt,Mi,Ci,vn,Or,Rn,Vr,pe),Ai&&(Sn=ov(Di,xn,Bt,Mi,Ci,vn,Ai,Mt,Vr))}}if(qt){const Or=$t.iconSizeData,Vr=Ti.layout.get("icon-rotate").evaluate(Zt,{},Ii),vs=oM(qt,Vr,Ni,Ir,ci.iconScaleFactor),Gs=Ai?oM(Ai,Vr,Ni,Ir,ci.iconScaleFactor):void 0;lr=ov(Di,xn,Bt,Mi,Ci,vn,qt,Mt,Vr,null),_n=4*vs.length;let Ds=null;Or.kind==="source"?(Ds=[_c*Ti.layout.get("icon-size").evaluate(Zt,{},Ii)*ci.iconScaleFactor],Ds[0]>mu&&Bi(`${$t.layerIds[0]}: Value for "icon-size" is >= ${E_}. Reduce your "icon-size".`)):Or.kind==="composite"&&(Ds=[_c*ci.compositeIconSizes[0].evaluate(Zt,{},Ii)*ci.iconScaleFactor,_c*ci.compositeIconSizes[1].evaluate(Zt,{},Ii)*ci.iconScaleFactor],(Ds[0]>mu||Ds[1]>mu)&&Bi(`${$t.layerIds[0]}: Value for "icon-size" is >= ${E_}. Reduce your "icon-size".`)),$t.addSymbols($t.icon,vs,Ds,Ot,Ft,Zt,void 0,wt,Bt,kn.lineStartIndex,kn.lineLength,-1,Ui,Ii,dn,Tn),Bn=$t.icon.placedSymbolArray.length-1,Gs&&(qn=4*Gs.length,$t.addSymbols($t.icon,Gs,Ds,Ot,Ft,Zt,Oo.vertical,wt,Bt,kn.lineStartIndex,kn.lineLength,-1,Ui,Ii,dn,Tn),ir=$t.icon.placedSymbolArray.length-1)}for(const Or in Xt.horizontal){const Vr=Or,vs=Xt.horizontal[Vr];ln||(Br=yo(vs.text),he?Pn=ZA(vs):ln=ov(Di,xn,Bt,Mi,Ci,vn,vs,Rn,Ti.layout.get("text-rotate").evaluate(Zt,{},Ii),pe));const Gs=vs.positionedLines.length===1;if(li+=fM($t,wt,Bt,vs,ui,Ti,he,Zt,pe,kn,Xt.vertical?Oo.horizontal:Oo.horizontalOnly,Gs?G5(Xt.horizontal):[Vr],Nn,Bn,ci,Ui,Ii,dn),Gs)break}Xt.vertical&&(Gi+=fM($t,wt,Bt,Xt.vertical,ui,Ti,he,Zt,pe,kn,Oo.vertical,["vertical"],Nn,ir,ci,Ui,Ii,dn));let us=-1;const Ao=(Or,Vr)=>Or?Math.max(Or,Vr):Vr;us=Ao(Pn,us),us=Ao(fn,us),us=Ao(ki,us);const yc=us>-1?1:0;$t.glyphOffsetArray.length>=65535&&Bi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&$t.addToSortKeyRanges($t.symbolInstances.length,Zt.sortKey),$t.symbolInstances.emplaceBack(Bt.x,Bt.y,xn.x,xn.y,xn.z,Nn.right>=0?Nn.right:-1,Nn.center>=0?Nn.center:-1,Nn.left>=0?Nn.left:-1,Nn.vertical>=0?Nn.vertical:-1,Bn,ir,Br,ln!==void 0?ln:$t.collisionBoxArray.length,ln!==void 0?ln+1:$t.collisionBoxArray.length,Dn!==void 0?Dn:$t.collisionBoxArray.length,Dn!==void 0?Dn+1:$t.collisionBoxArray.length,lr!==void 0?lr:$t.collisionBoxArray.length,lr!==void 0?lr+1:$t.collisionBoxArray.length,Sn||$t.collisionBoxArray.length,Sn?Sn+1:$t.collisionBoxArray.length,Mi,li,Gi,_n,qn,yc,0,wo,bs,us,0,Ir?1:0,Xn)})(h,At,Kt,Qe,l,d,_,p,h.layers[0],h.collisionBoxArray,o.index,o.sourceLayerIndex,h.index,Ve,le,I,0,et,ht,ee,o,y,R,P,B,U,j,K,ft)};if(re==="line")for(const Qe of Jb(o.geometry,0,0,Dt,Dt)){const At=$5(Qe,Fe,mt,l.vertical||ae,d,Ce,Be,h.overscaling,Dt);for(const Et of At)ae&&K5(h,ae.text,pt,Et)||Ye(Qe,Et,B)}else if(re==="line-center"){for(const Qe of o.geometry)if(Qe.length>1){const At=V5(Qe,mt,l.vertical||ae,d,Ce,Be);At&&Ye(Qe,At,B)}}else if(o.type==="Polygon")for(const Qe of Wb(o.geometry,0)){const At=H5(Qe,16);Ye(Qe[0],new fh(At.x,At.y,0,0,void 0),B)}else if(o.type==="LineString")for(const Qe of o.geometry)Ye(Qe,new fh(Qe[0].x,Qe[0].y,0,0,void 0),B);else if(o.type==="Point")for(const Qe of o.geometry)for(const At of Qe)Ye([At],new fh(At.x,At.y,0,0,void 0),B)}const E_=255,mu=E_*_c;function fM(h,o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K,ee){const le=function(ie,ae,fe,Ce,Be,Fe,Ve,et){const mt=[];if(ae.positionedLines.length===0)return mt;const ht=Ce.layout.get("text-rotate").evaluate(Fe,{})*Math.PI/180,pt=function(Qe){const At=Qe[0],Et=Qe[1],Kt=At*Et;return Kt>0?[At,-Et]:Kt<0?[-At,Et]:At===0?[Et,At]:[Et,-At]}(fe);let xt=Math.abs(ae.top-ae.bottom);for(const Qe of ae.positionedLines)xt-=Qe.lineOffset;const Ke=ae.positionedLines.length,ft=xt/Ke;let Ye=ae.top-fe[1];for(let Qe=0;Qe<Ke;++Qe){const At=ae.positionedLines[Qe];Ye=j5(ae,ft,Ye,Qe);for(const Et of At.positionedGlyphs){if(!Et.rect)continue;const Kt=Et.rect||{};let $t=L5+1,Bt=!0,wt=1,pi=0;if(Et.image){const Zt=Ve.get(Et.image.toString());if(!Zt)continue;if(Zt.sdf){Bi("SDF images are not supported in formatted text and will be ignored.");continue}Bt=!1,wt=Zt.pixelRatio,$t=zd/wt}const Xt=(Be||et)&&Et.vertical,qt=Et.metrics.advance*Et.scale/2,ui=Et.metrics,Ai=Et.rect;if(Ai===null)continue;et&&ae.verticalizable&&(pi=Et.image?qt-Et.metrics.width*Et.scale/2:0);const Ti=Be?[Et.x+qt,Et.y]:[0,0];let Di=[0,0],Mi=[0,0],Ci=!1;Be||(Xt?(Mi=[Et.x+qt+pt[0],Et.y+pt[1]-pi],Ci=!0):Di=[Et.x+qt+fe[0],Et.y+fe[1]-pi]);const vn=Ai.w*Et.scale/(wt*(Et.localGlyph?Cl:1)),Rn=Ai.h*Et.scale/(wt*(Et.localGlyph?Cl:1));let he,pe,tt,Mt;if(Xt){const Zt=Et.y-Ye,ci=new ue(-qt,qt-Zt),Ni=-Math.PI/2,Ui=new ue(...Mi);he=new ue(-qt+Di[0],Di[1]),he._rotateAround(Ni,ci)._add(Ui),he.x+=-Zt+qt,he.y-=(ui.left-$t)*Et.scale;const Ii=Et.image?ui.advance*Et.scale:es*Et.scale,dn=String.fromCodePoint(Et.glyph);k5(dn)?he.x+=(1-$t)*Et.scale:P5(dn)?he.x+=Ii-ui.height*Et.scale+(-$t-1)*Et.scale:he.x+=Et.image||ui.width+2*$t===Ai.w&&ui.height+2*$t===Ai.h?(Ii-Rn)/2:(Ii-(ui.height+2*$t)*Et.scale)/2,pe=new ue(he.x,he.y-vn),tt=new ue(he.x+Rn,he.y),Mt=new ue(he.x+Rn,he.y-vn)}else{const Zt=(ui.left-$t)*Et.scale-qt+Di[0],ci=(-ui.top-$t)*Et.scale+Di[1],Ni=Zt+vn,Ui=ci+Rn;he=new ue(Zt,ci),pe=new ue(Ni,ci),tt=new ue(Zt,Ui),Mt=new ue(Ni,Ui)}if(ht){let Zt;Zt=Be?new ue(0,0):Ci?new ue(pt[0],pt[1]):new ue(fe[0],fe[1]),he._rotateAround(ht,Zt),pe._rotateAround(ht,Zt),tt._rotateAround(ht,Zt),Mt._rotateAround(ht,Zt)}const Ft=new ue(0,0),Ot=new ue(0,0);mt.push({tl:he,tr:pe,bl:tt,br:Mt,texPrimary:Kt,texSecondary:void 0,writingMode:ae.writingMode,glyphOffset:Ti,sectionIndex:Et.sectionIndex,isSDF:Bt,pixelOffsetTL:Ft,pixelOffsetBR:Ot,minFontScaleX:0,minFontScaleY:0})}}return mt}(0,d,S,_,y,A,p,h.allowVerticalPlacement),re=h.textSizeData;let G=null;re.kind==="source"?(G=[_c*_.layout.get("text-size").evaluate(A,{},K)*U.textScaleFactor],G[0]>mu&&Bi(`${h.layerIds[0]}: Value for "text-size" is >= ${E_}. Reduce your "text-size".`)):re.kind==="composite"&&(G=[_c*U.compositeTextSizes[0].evaluate(A,{},K)*U.textScaleFactor,_c*U.compositeTextSizes[1].evaluate(A,{},K)*U.textScaleFactor],(G[0]>mu||G[1]>mu)&&Bi(`${h.layerIds[0]}: Value for "text-size" is >= ${E_}. Reduce your "text-size".`)),h.addSymbols(h.text,le,G,S,y,A,R,o,l,I.lineStartIndex,I.lineLength,N,j,K,ee,!1);for(const ie of P)B[ie]=h.text.placedSymbolArray.length-1;return 4*le.length}function YA(h){for(const o in h)return h[o];return null}function ov(h,o,l,d,p,_,y,A,S,I){let R=y.top,P=y.bottom,B=y.left,N=y.right;if(H3(y)&&y.collisionPadding){const U=y.collisionPadding;B-=U[0],R-=U[1],N+=U[2],P+=U[3]}if(S){const U=new ue(B,R),j=new ue(N,R),K=new ue(B,P),ee=new ue(N,P),le=H(S);let re=new ue(0,0);I&&(re=new ue(I[0],I[1])),U._rotateAround(le,re),j._rotateAround(le,re),K._rotateAround(le,re),ee._rotateAround(le,re),B=Math.min(U.x,j.x,K.x,ee.x),N=Math.max(U.x,j.x,K.x,ee.x),R=Math.min(U.y,j.y,K.y,ee.y),P=Math.max(U.y,j.y,K.y,ee.y)}return h.emplaceBack(o.x,o.y,o.z,l.x,l.y,B,R,N,P,A,d,p,_),h.length-1}function ZA(h){H3(h)&&h.collisionPadding&&(h.top-=h.collisionPadding[1],h.bottom+=h.collisionPadding[3]);const o=h.bottom-h.top;return o>0?Math.max(10,o):null}function K5(h,o,l,d){const p=h.compareText;if(o in p){const _=p[o];for(let y=_.length-1;y>=0;y--)if(d.dist(_[y])<l)return!0}else p[o]=[];return p[o].push(d),!1}function pM(h,o){const l=h.fovAboveCenter,d=h.elevation?h.elevation.getMinElevationBelowMSL()*o:0,p=(h._camera.position[2]*h.worldSize-d)/Math.cos(h._pitch),_=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-h._pitch-l,.01));let y=Math.sin(h._pitch)*_+p;const A=p*(1/h._horizonShift);if(!h.elevation||h.elevation.exaggeration()===0){let S=Math.max(h.zoom-17,0);h.isOrthographic&&(S/=10),y*=1+S}return Math.min(1.01*y,A)}function C_(h,o){if(!o.isReprojectedInTileSpace)return{scale:1<<h.z,x:h.x,y:h.y,x2:h.x+1,y2:h.y+1,projection:o};const l=Math.pow(2,-h.z),d=h.x*l,p=(h.x+1)*l,_=h.y*l,y=(h.y+1)*l,A=Ie(d),S=Ie(p),I=Re(_),R=Re(y),P=o.project(A,I),B=o.project(S,I),N=o.project(S,R),U=o.project(A,R);let j=Math.min(P.x,B.x,N.x,U.x),K=Math.min(P.y,B.y,N.y,U.y),ee=Math.max(P.x,B.x,N.x,U.x),le=Math.max(P.y,B.y,N.y,U.y);const re=l/16;function G(ae,fe,Ce,Be,Fe,Ve){const et=(Ce+Fe)/2,mt=(Be+Ve)/2,ht=o.project(Ie(et),Re(mt)),pt=Math.max(0,j-ht.x,K-ht.y,ht.x-ee,ht.y-le);j=Math.min(j,ht.x),ee=Math.max(ee,ht.x),K=Math.min(K,ht.y),le=Math.max(le,ht.y),pt>re&&(G(ae,ht,Ce,Be,et,mt),G(ht,fe,et,mt,Fe,Ve))}G(P,B,d,_,p,_),G(B,N,p,_,p,y),G(N,U,p,y,d,y),G(U,P,d,y,d,_),j-=re,K-=re,ee+=re,le+=re;const ie=1/Math.max(ee-j,le-K);return{scale:ie,x:j*ie,y:K*ie,x2:ee*ie,y2:le*ie,projection:o}}function mM(h,{x:o,y:l},d=0){return new ue(((o-d)*h.scale-h.x)*Dt,(l*h.scale-h.y)*Dt)}const J5=W(new Float32Array(16));class gu{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new Z(0,0)}projectTilePoint(o,l,d){return{x:o,y:l,z:0}}locationPoint(o,l,d,p=!0){return o._coordinatePoint(o.locationCoordinate(l,d),p)}pixelsPerMeter(o,l){return ge(1,o)*l}pixelSpaceConversion(o,l,d){return 1}farthestPixelDistance(o){return pM(o,o.pixelsPerMeter)}pointCoordinate(o,l,d,p){const _=o.horizonLineFromTop(!1),y=new ue(l,Math.max(_,d));return o.rayIntersectionCoordinate(o.pointRayIntersection(y,p))}pointCoordinate3D(o,l,d){const p=new ue(l,d);if(o.elevation)return o.elevation.pointCoordinate(p);{const _=this.pointCoordinate(o,p.x,p.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(o,l){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,l.x,l.y);const d=o.horizonLineFromTop();return l.y<d}createInversionMatrix(o,l){return J5}createTileMatrix(o,l,d){let p,_,y;const A=d.canonical,S=W(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=C_(A,this);p=1,_=I.x+d.wrap*I.scale,y=I.y,we(S,S,[p/I.scale,p/I.scale,o.pixelsPerMeter/l])}else p=l/o.zoomScale(A.z),_=(A.x+Math.pow(2,A.z)*d.wrap)*p,y=A.y*p;return Te(S,S,[_,y,0]),we(S,S,[p/Dt,p/Dt,1]),S}upVector(o,l,d){return[0,0,1]}upVectorScale(o,l,d){return{metersToTile:1}}}class Q5 extends gu{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,d]=this.parallels=o.parallels||[29.5,45.5],p=Math.sin(H(l));this.n=(p+Math.sin(H(d)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:d,c:p,r0:_}=this,y=H(o-this.center[0]),A=H(l),S=Math.sqrt(p-2*d*Math.sin(A))/d;return{x:S*Math.sin(y*d),y:S*Math.cos(y*d)-_,z:0}}unproject(o,l){const{n:d,c:p,r0:_}=this,y=_+l;let A=Math.atan2(o,Math.abs(y))*Math.sign(y);y*d<0&&(A-=Math.PI*Math.sign(o)*Math.sign(y));const S=H(this.center[0])*d;A=We(A,-Math.PI-S,Math.PI-S);const I=De(te(A/d)+this.center[0],-180,180),R=Math.asin(De((p-(o*o+y*y)*d*d)/(2*d),-1,1)),P=De(te(R),-85.051129,je);return new Z(I,P)}}const I_=1.340264,M_=-.081106,R_=893e-6,k_=.003796,av=Math.sqrt(3)/2;class e6 extends gu{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const d=Math.asin(av*Math.sin(l)),p=d*d,_=p*p*p;return{x:.5*(o*Math.cos(d)/(av*(I_+3*M_*p+_*(7*R_+9*k_*p)))/Math.PI+.5),y:1-.5*(d*(I_+M_*p+_*(R_+k_*p))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,p=d*d,_=p*p*p;for(let R,P,B,N=0;N<12&&(P=d*(I_+M_*p+_*(R_+k_*p))-l,B=I_+3*M_*p+_*(7*R_+9*k_*p),R=P/B,d=De(d-R,-Math.PI/3,Math.PI/3),p=d*d,_=p*p*p,!(Math.abs(R)<1e-12));++N);const y=av*o*(I_+3*M_*p+_*(7*R_+9*k_*p))/Math.cos(d),A=Math.asin(Math.sin(d)/av),S=De(180*y/Math.PI,-180,180),I=De(180*A/Math.PI,-85.051129,je);return new Z(S,I)}}class t6 extends gu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const d=360*(o-.5),p=De(360*(.5-l),-85.051129,je);return new Z(d,p)}}const Hp=Math.PI/2;function lv(h){return Math.tan((Hp+h)/2)}class i6 extends gu{constructor(o){super(o),this.center=o.center||[0,30];const[l,d]=this.parallels=o.parallels||[30,30];let p=H(l),_=H(d);this.southernCenter=p+_<0,this.southernCenter&&(p=-p,_=-_);const y=Math.cos(p),A=lv(p);this.n=p===_?Math.sin(p):Math.log(y/Math.cos(_))/Math.log(lv(_)/A),this.f=y*Math.pow(lv(p),this.n)/this.n}project(o,l){l=H(l),this.southernCenter&&(l=-l),o=H(o-this.center[0]);const d=1e-6,{n:p,f:_}=this;_>0?l<-Hp+d&&(l=-Hp+d):l>Hp-d&&(l=Hp-d);const y=_/Math.pow(lv(l),p);let A=y*Math.sin(p*o),S=_-y*Math.cos(p*o);return A=.5*(A/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:A,y:this.southernCenter?S:1-S,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:d,f:p}=this,_=p-l,y=Math.sign(_),A=Math.sign(d)*Math.sqrt(o*o+_*_);let S=Math.atan2(o,Math.abs(_))*y;_*d<0&&(S-=Math.PI*Math.sign(o)*y);const I=De(te(S/d)+this.center[0],-180,180),R=De(te(2*Math.atan(Math.pow(p/A,1/d))-Hp),-85.051129,je);return new Z(I,this.southernCenter?-R:R)}}class gM extends gu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:ve(o),y:xe(l),z:0}}unproject(o,l){const d=Ie(o),p=Re(l);return new Z(d,p)}}const _M=H(je);class n6 extends gu{project(o,l){const d=(l=H(l))*l,p=d*d;return{x:.5*((o=H(o))*(.8707-.131979*d+p*(p*(.003971*d-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+d*(.015085+p*(.028874*d-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,p=25,_=0,y=d*d;do{y=d*d;const I=y*y;_=(d*(1.007226+y*(.015085+I*(.028874*y-.044475-.005916*I)))-l)/(1.007226+y*(.045255+I*(.259866*y-.311325-.005916*11*I))),d=De(d-_,-_M,_M)}while(Math.abs(_)>1e-6&&--p>0);y=d*d;const A=De(te(o/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),S=te(d);return new Z(A,S)}}const yM=H(je);class r6 extends gu{project(o,l){l=H(l),o=H(o);const d=Math.cos(l),p=2/Math.PI,_=Math.acos(d*Math.cos(o/2)),y=Math.sin(_)/_,A=.5*(o*p+2*d*Math.sin(o/2)/y)||0,S=.5*(l+Math.sin(l)/y)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(o,l){let d=o=(2*o-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,_=25;const y=1e-6;let A=0,S=0;do{const I=Math.cos(p),R=Math.sin(p),P=2*R*I,B=R*R,N=I*I,U=Math.cos(d/2),j=Math.sin(d/2),K=2*U*j,ee=j*j,le=1-N*U*U,re=le?1/le:0,G=le?Math.acos(I*U)*Math.sqrt(1/le):0,ie=.5*(2*G*I*j+2*d/Math.PI)-o,ae=.5*(G*R+p)-l,fe=.5*re*(N*ee+G*I*U*B)+1/Math.PI,Ce=re*(K*P/4-G*R*j),Be=.125*re*(P*j-G*R*N*K),Fe=.5*re*(B*U+G*ee*I)+.5,Ve=Ce*Be-Fe*fe;A=(ae*Ce-ie*Fe)/Ve,S=(ie*Be-ae*fe)/Ve,d=De(d-A,-Math.PI,Math.PI),p=De(p-S,-yM,yM)}while((Math.abs(A)>y||Math.abs(S)>y)&&--_>0);return new Z(te(d),te(p))}}class bM extends gu{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(H(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:d,cosPhi:p}=this;return{x:H(o)*p*d+.5,y:-Math.sin(H(l))/p*d+.5,z:0}}unproject(o,l){const{scale:d,cosPhi:p}=this,_=-(l-.5)/d,y=De(te((o-.5)/d)/p,-180,180),A=Math.asin(De(_*p,-1,1)),S=De(te(A),-85.051129,je);return new Z(y,S)}}class s6 extends gM{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,d){const p=h_(o,l,d);return jn(p,p,$b(mc(d))),{x:p[0],y:p[1],z:p[2]}}locationPoint(o,l,d){const p=Y(l.lat,l.lng),_=on([],p),y=d?o._centerAltitude+d:o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;Gr(p,p,_,ge(1,0)*Dt*y);const A=W(new Float64Array(16));return _e(A,o.pixelMatrix,o.globeMatrix),jn(p,p,A),new ue(p[0],p[1])}pixelsPerMeter(o,l){return ge(1,0)*l}pixelSpaceConversion(o,l,d){const p=ge(1,o)*l,_=ri(ge(1,45)*l,p,d);return this.pixelsPerMeter(o,l)/_}createTileMatrix(o,l,d){const p=pA(mc(d.canonical));return _e(new Float64Array(16),o.globeMatrix,p)}createInversionMatrix(o,l){const{center:d}=o,p=$b(mc(l));return Le(p,p,H(d.lng)),Ee(p,p,H(d.lat)),we(p,p,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(o,l,d,p){return nI(o,l,d,!0)||new qe(0,0)}pointCoordinate3D(o,l,d){const p=this.pointCoordinate(o,l,d,0);return[p.x,p.y,p.z]}isPointAboveHorizon(o,l){return!nI(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(p,_){const y=p.cameraToCenterDistance,A=p._centerAltitude*_,S=p._camera,I=p._camera.forward(),R=vi([],Qi([],I,-y),[0,0,A]),P=p.worldSize/(2*Math.PI),B=[0,0,-P],N=p.width/p.height,U=Math.tan(p.fovAboveCenter),j=Qi([],S.up(),U),K=Qi([],S.right(),U*N),ee=on([],vi([],vi([],I,j),K)),le=[];let re;if(new wa(R,ee).closestPointOnSphere(B,P,le)){const G=vi([],le,B),ie=sr([],G,R);re=Math.cos(p.fovAboveCenter)*bi(ie)}else{const G=sr([],R,B),ie=sr([],B,R);on(ie,ie);const ae=bi(G)-P;re=Math.sqrt(ae*(ae+2*P));const fe=Math.acos(re/(P+ae))-Math.acos(cn(I,ie));re*=Math.cos(fe)}return 1.01*re}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),d=uu(o.zoom);if(d>0){const p=pM(o,ge(1,o.center.lat)*o.worldSize),_=o.worldSize/(2*Math.PI),y=Math.max(o.width,o.height)/o.worldSize*Math.PI;return ri(l,p+_*(1-Math.cos(y)),Math.pow(d,10))}return l}upVector(o,l,d){return h_(l,d,o,1)}upVectorScale(o){return{metersToTile:hu(Vb(mc(o)))}}}function vM(h){const o=h.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(h.name){case"mercator":return new gM(h);case"equirectangular":return new t6(h);case"naturalEarth":return new n6(h);case"equalEarth":return new e6(h);case"winkelTripel":return new r6(h);case"albers":return l?new bM(h):new Q5(h);case"lambertConformalConic":return l?new bM(h):new i6(h);case"globe":return new s6(h)}throw new Error(`Invalid projection name: ${h.name}`)}const o6=fu.VectorTileFeature.types,a6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cv(h,o,l,d,p,_,y,A,S,I,R,P,B){const N=A?Math.min(mu,Math.round(A[0])):0,U=A?Math.min(mu,Math.round(A[1])):0;h.emplaceBack(o,l,Math.round(32*d),Math.round(32*p),_,y,(N<<1)+(S?1:0),U,16*I,16*R,256*P,256*B)}function hv(h,o,l){h.emplaceBack(o,l)}function uv(h,o,l,d,p,_,y){h.emplaceBack(o,l,d,p,_,y)}function dv(h,o,l,d,p){h.emplaceBack(o,l,d,p),h.emplaceBack(o,l,d,p),h.emplaceBack(o,l,d,p),h.emplaceBack(o,l,d,p)}function l6(h){for(const o of h.sections)if(iA(o.text))return!0;return!1}class KA{constructor(o){this.layoutVertexArray=new ru,this.indexArray=new qr,this.programConfigurations=o,this.segments=new Gn,this.dynamicLayoutVertexArray=new Ka,this.opacityVertexArray=new Qg,this.placedSymbolArray=new Cb,this.iconTransitioningVertexArray=new dc,this.globeExtVertexArray=new no,this.zOffsetVertexArray=new iu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(o,l,d,p,_){this.isEmpty()||(d&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,w5.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,T5.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,a6,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,E5.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,A5.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||_)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,S5.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||p)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ut(KA,"SymbolBuffers");class JA{constructor(o,l,d){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new d,this.segments=new Gn,this.collisionVertexArray=new t_,this.collisionVertexArrayExt=new Ka}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,C5.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,I5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ut(JA,"CollisionBuffers");class fv{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.lut=o.lut,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=W([]),this.placementViewportMatrix=W([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Y3(this.zoom,l["text-size"]),this.iconSizeData=Y3(this.zoom,l["icon-size"]);const d=this.layers[0].layout,p=d.get("symbol-sort-key"),_=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(y=>Oo[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new KA(new hh(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new KA(new hh(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new a_,this.lineVertexArray=new Rb,this.symbolInstances=new Mb}calculateGlyphDependencies(o,l,d,p,_){for(const y of o){const A=y.codePointAt(0);if(A===void 0)break;if(l[A]=!0,p&&_&&A<=65535){const S=w_[y];S&&(l[S.charCodeAt(0)]=!0)}}}updateFootprints(o,l){}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const d=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!PA(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(o,l,d,p){const _=this.layers[0],y=_.layout,A=this.projection.name==="globe",S=y.get("text-font"),I=y.get("text-field"),R=y.get("icon-image"),[P,B]=y.get("icon-size-scale-range"),N=De(l.scaleFactor||1,P,B),U=(I.value.kind!=="constant"||I.value.value instanceof Vs&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),j=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,K=y.get("symbol-sort-key");if(this.features=[],!U&&!j)return;const ee=l.iconDependencies,le=l.glyphDependencies,re=l.availableImages,G=new pn(this.zoom);for(const{feature:ie,id:ae,index:fe,sourceLayerIndex:Ce}of o){const Be=_._featureFilter.needGeometry,Fe=Jt(ie,Be);if(!_._featureFilter.filter(G,Fe,d))continue;if(Be||(Fe.geometry=jt(ie,d,p)),A&&ie.type!==1&&d.z<=5){const pt=Fe.geometry,xt=.98078528056,Ke=(ft,Ye)=>cn(h_(ft.x,ft.y,d,1),h_(Ye.x,Ye.y,d,1))<xt;for(let ft=0;ft<pt.length;ft++)pt[ft]=gt(pt[ft],Ke)}let Ve,et;if(U){const pt=_.getValueAndResolveTokens("text-field",Fe,d,re),xt=Vs.factory(pt);l6(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||Qh()==="unavailable"||this.hasRTLText&&qo.isParsed())&&(Ve=R5(xt,_,Fe))}if(j){const pt=_.getValueAndResolveTokens("icon-image",Fe,d,re);et=typeof pt=="string"?to.build(pt):pt}if(!Ve&&!et)continue;const mt=this.sortFeaturesByKey?K.evaluate(Fe,{},d):void 0,ht={id:ae,text:Ve,icon:et,index:fe,sourceLayerIndex:Ce,geometry:Fe.geometry,properties:ie.properties,type:o6[ie.type],sortKey:mt};if(this.features.push(ht),et){const pt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:xt,iconSecondary:Ke}=hM(et,this.iconSizeData,pt["icon-size"],d,this.zoom,ht,this.pixelRatio,N),ft=xt.id.toString();if(ee.has(ft)?ee.get(ft).push(xt):ee.set(ft,[xt]),Ke){const Ye=Ke.id.toString();ee.has(Ye)?ee.get(Ye).push(Ke):ee.set(Ye,[Ke])}}if(Ve){const pt=S.evaluate(Fe,{},d).join(","),xt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Oo.vertical)>=0;for(const Ke of Ve.sections)if(Ke.image){const ft=Ke.image.getPrimary().scaleSelf(this.pixelRatio),Ye=ft.id.toString(),Qe=ee.get(Ye)||[];Qe.push(ft),ee.set(Ye,Qe)}else{const ft=Vg(Ve.toString()),Ye=Ke.fontStack||pt,Qe=le[Ye]=le[Ye]||{};this.calculateGlyphDependencies(Ke.text,Qe,xt,this.allowVerticalPlacement,ft)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(ie){const ae={},fe={},Ce=[];let Be=0;function Fe(ht){Ce.push(ie[ht]),Be++}function Ve(ht,pt,xt){const Ke=fe[ht];return delete fe[ht],fe[pt]=Ke,Ce[Ke].geometry[0].pop(),Ce[Ke].geometry[0]=Ce[Ke].geometry[0].concat(xt[0]),Ke}function et(ht,pt,xt){const Ke=ae[pt];return delete ae[pt],ae[ht]=Ke,Ce[Ke].geometry[0].shift(),Ce[Ke].geometry[0]=xt[0].concat(Ce[Ke].geometry[0]),Ke}function mt(ht,pt,xt){const Ke=xt?pt[0][pt[0].length-1]:pt[0][0];return`${ht}:${Ke.x}:${Ke.y}`}for(let ht=0;ht<ie.length;ht++){const pt=ie[ht],xt=pt.geometry,Ke=pt.text?pt.text.toString():null;if(!Ke){Fe(ht);continue}const ft=mt(Ke,xt),Ye=mt(Ke,xt,!0);if(ft in fe&&Ye in ae&&fe[ft]!==ae[Ye]){const Qe=et(ft,Ye,xt),At=Ve(ft,Ye,Ce[Qe].geometry);delete ae[ft],delete fe[Ye],fe[mt(Ke,Ce[At].geometry,!0)]=At,Ce[Qe].geometry=null}else ft in fe?Ve(ft,Ye,xt):Ye in ae?et(ft,Ye,xt):(Fe(ht),ae[ft]=Be-1,fe[Ye]=Be-1)}return Ce.filter(ht=>ht.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",l.elevationFeatures){!this.elevationFeatures&&l.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ie of l.elevationFeatures)this.elevationFeatureIdToIndex.set(ie.id,this.elevationFeatures.length),this.elevationFeatures.push(ie)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ie,ae)=>ie.sortKey-ae.sortKey)}update(o,l,d,p,_,y,A){this.text.programConfigurations.updatePaintArrays(o,l,_,d,p,y,A),this.icon.programConfigurations.updatePaintArrays(o,l,_,d,p,y,A)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);if(d.elevationFeatureIndex===65535)continue;const p=this.elevationFeatures[d.elevationFeatureIndex];if(p){const _=.05+p.pointElevation(new ue(d.tileAnchorX,d.tileAnchorY));d.zOffset!==_&&(o=!0,d.zOffset=_)}}o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const o=(_,y,A)=>{d+=y,d>_.length&&_.resize(d);for(let S=-y;S<0;S++)_.emplace(S+d,A)},l=(_,y,A)=>{p+=y,p>_.length&&_.resize(p);for(let S=-y;S<0;S++)_.emplace(S+p,A)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,p=0;for(let _=0;_<this.symbolInstances.length;_++){const y=this.symbolInstances.get(_),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:S,numIconVertices:I}=y,R=y.zOffset,P=I>0;if((A>0||S>0)&&(o(this.text.zOffsetVertexArray,A,R),o(this.text.zOffsetVertexArray,S,R)),P){const{placedIconSymbolIndex:B,verticalPlacedIconSymbolIndex:N}=y;B>=0&&l(this.icon.zOffsetVertexArray,I,R),N>=0&&l(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=vM(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const d=this.lineVertexArray.length;if(o.segment!==void 0)for(const{x:p,y:_}of l)this.lineVertexArray.emplaceBack(p,_);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(o,l,d,p,_,y,A,S,I,R,P,B,N,U,j,K){const ee=o.indexArray,le=o.layoutVertexArray,re=o.globeExtVertexArray,G=o.segments.prepareSegment(4*l.length,le,ee,this.canOverlap?y.sortKey:void 0),ie=this.glyphOffsetArray.length,ae=G.vertexLength,fe=this.allowVerticalPlacement&&A===Oo.vertical?Math.PI/2:0,Ce=y.text&&y.text.sections;for(let Fe=0;Fe<l.length;Fe++){const{tl:Ve,tr:et,bl:mt,br:ht,texPrimary:pt,texSecondary:xt,pixelOffsetTL:Ke,pixelOffsetBR:ft,minFontScaleX:Ye,minFontScaleY:Qe,glyphOffset:At,isSDF:Et,sectionIndex:Kt}=l[Fe],$t=G.vertexLength,Bt=At[1];if(cv(le,I.x,I.y,Ve.x,Bt+Ve.y,pt.x,pt.y,d,Et,Ke.x,Ke.y,Ye,Qe),cv(le,I.x,I.y,et.x,Bt+et.y,pt.x+pt.w,pt.y,d,Et,ft.x,Ke.y,Ye,Qe),cv(le,I.x,I.y,mt.x,Bt+mt.y,pt.x,pt.y+pt.h,d,Et,Ke.x,ft.y,Ye,Qe),cv(le,I.x,I.y,ht.x,Bt+ht.y,pt.x+pt.w,pt.y+pt.h,d,Et,ft.x,ft.y,Ye,Qe),S){const{x:wt,y:pi,z:Xt}=S.anchor,[qt,ui,Ai]=S.up;uv(re,wt,pi,Xt,qt,ui,Ai),uv(re,wt,pi,Xt,qt,ui,Ai),uv(re,wt,pi,Xt,qt,ui,Ai),uv(re,wt,pi,Xt,qt,ui,Ai),dv(o.dynamicLayoutVertexArray,wt,pi,Xt,fe)}else dv(o.dynamicLayoutVertexArray,I.x,I.y,I.z,fe);if(K){const wt=xt||pt;hv(o.iconTransitioningVertexArray,wt.x,wt.y),hv(o.iconTransitioningVertexArray,wt.x+wt.w,wt.y),hv(o.iconTransitioningVertexArray,wt.x,wt.y+wt.h),hv(o.iconTransitioningVertexArray,wt.x+wt.w,wt.y+wt.h)}ee.emplaceBack($t,$t+1,$t+2),ee.emplaceBack($t+1,$t+2,$t+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(At[0]),Fe!==l.length-1&&Kt===l[Fe+1].sectionIndex||o.programConfigurations.populatePaintArrays(le.length,y,y.index,{},N,U,j,Ce&&Ce[Kt])}const Be=S?S.anchor:I;o.placedSymbolArray.emplaceBack(Be.x,Be.y,Be.z,I.x,I.y,ie,this.glyphOffsetArray.length-ie,ae,R,P,I.segment,d?d[0]:0,d?d[1]:0,p[0],p[1],A,0,0,0,B,0)}_commitLayoutVertex(o,l,d,p,_,y,A){o.emplaceBack(l,d,p,_,y,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(o,l,d,p,_,y,A){const S=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),I=S.vertexLength,R=A.tileAnchorX,P=A.tileAnchorY;for(let N=0;N<4;N++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,l,o.padding,A.zOffset),this._commitLayoutVertex(d.layoutVertexArray,p,_,y,R,P,new ue(o.x1,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,_,y,R,P,new ue(o.x2,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,_,y,R,P,new ue(o.x2,o.y2)),this._commitLayoutVertex(d.layoutVertexArray,p,_,y,R,P,new ue(o.x1,o.y2)),S.vertexLength+=4;const B=d.indexArray;B.emplaceBack(I,I+1),B.emplaceBack(I+1,I+2),B.emplaceBack(I+2,I+3),B.emplaceBack(I+3,I),S.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,d,p,_,y){for(let A=p;A<_;A++){const S=d.get(A),I=this.getSymbolInstanceTextSize(o,y,l,A);this._addCollisionDebugVertices(S,I,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(o,l,d,p,_,y){for(let A=p;A<_;A++){const S=d.get(A),I=this.getSymbolInstanceIconSize(o,l,y.placedIconSymbolIndex);this._addCollisionDebugVertices(S,I,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}generateCollisionDebugBuffers(o,l,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new JA(Rp,O3.members,dc),this.iconCollisionBox=new JA(Rp,O3.members,dc);const p=T_(this.iconSizeData,o),_=T_(this.textSizeData,o,d);for(let y=0;y<this.symbolInstances.length;y++){const A=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(_,o,l,A.textBoxStartIndex,A.textBoxEndIndex,A),this._addTextDebugCollisionBoxes(_,o,l,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A),this._addIconDebugCollisionBoxes(p,o,l,A.iconBoxStartIndex,A.iconBoxEndIndex,A),this._addIconDebugCollisionBoxes(p,o,l,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A)}}getSymbolInstanceTextSize(o,l,d,p){const _=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),y=HA(this.textSizeData,o,_)/es;return this.tilePixelRatio*y}getSymbolInstanceIconSize(o,l,d){const p=this.icon.placedSymbolArray.get(d),_=HA(this.iconSizeData,o,p);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(o,l,d,p){o.emplaceBack(l,-d,-d,p),o.emplaceBack(l,d,-d,p),o.emplaceBack(l,d,d,p),o.emplaceBack(l,-d,d,p)}_updateTextDebugCollisionBoxes(o,l,d,p,_,y,A){for(let S=p;S<_;S++){const I=d.get(S),R=this.getSymbolInstanceTextSize(o,y,l,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,I.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(o,l,d,p,_,y,A){for(let S=p;S<_;S++){const I=d.get(S),R=this.getSymbolInstanceIconSize(o,l,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,I.padding,y.zOffset)}}updateCollisionDebugBuffers(o,l,d,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const _=T_(this.iconSizeData,o,p),y=T_(this.textSizeData,o,d);for(let A=0;A<this.symbolInstances.length;A++){const S=this.symbolInstances.get(A);this._updateTextDebugCollisionBoxes(y,o,l,S.textBoxStartIndex,S.textBoxEndIndex,S,d),this._updateTextDebugCollisionBoxes(y,o,l,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,d),this._updateIconDebugCollisionBoxes(_,o,l,S.iconBoxStartIndex,S.iconBoxEndIndex,S,p),this._updateIconDebugCollisionBoxes(_,o,l,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,d,p,_,y,A,S,I){const R={};if(l<d){const{x1:P,y1:B,x2:N,y2:U,padding:j,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:re,tileAnchorY:G,featureIndex:ie}=o.get(l);R.textBox={x1:P,y1:B,x2:N,y2:U,padding:j,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:re,tileAnchorY:G},R.textFeatureIndex=ie}if(p<_){const{x1:P,y1:B,x2:N,y2:U,padding:j,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:re,tileAnchorY:G,featureIndex:ie}=o.get(p);R.verticalTextBox={x1:P,y1:B,x2:N,y2:U,padding:j,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:re,tileAnchorY:G},R.verticalTextFeatureIndex=ie}if(y<A){const{x1:P,y1:B,x2:N,y2:U,padding:j,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:re,tileAnchorY:G,featureIndex:ie}=o.get(y);R.iconBox={x1:P,y1:B,x2:N,y2:U,padding:j,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:re,tileAnchorY:G},R.iconFeatureIndex=ie}if(S<I){const{x1:P,y1:B,x2:N,y2:U,padding:j,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:re,tileAnchorY:G,featureIndex:ie}=o.get(S);R.verticalIconBox={x1:P,y1:B,x2:N,y2:U,padding:j,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:re,tileAnchorY:G},R.verticalIconFeatureIndex=ie}return R}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,l){const d=o.placedSymbolArray.get(l),p=d.vertexStartIndex+4*d.numGlyphs;for(let _=d.vertexStartIndex;_<p;_+=4)o.indexArray.emplaceBack(_,_+1,_+2),o.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(o),d=Math.cos(o),p=[],_=[],y=[];for(let A=0;A<this.symbolInstances.length;++A){y.push(A);const S=this.symbolInstances.get(A);p.push(0|Math.round(l*S.tileAnchorX+d*S.tileAnchorY)),_.push(S.featureIndex)}return y.sort((A,S)=>p[A]-p[S]||_[S]-_[A]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:I}=d;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&y!==_&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let xM,wM,QA;Ut(fv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fv.addDynamicAttributes=dv;class AM{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Ql,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut(AM,"FormatSectionOverride",{omit:["defaultValue"]});const eT=()=>QA||(QA={layout:xM||(xM=new or({"symbol-placement":new It(He.layout_symbol["symbol-placement"]),"symbol-spacing":new It(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Nt(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(He.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new It(He.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new It(He.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new It(He.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new It(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new Nt(He.layout_symbol["icon-size"]),"icon-size-scale-range":new It(He.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Nt(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nt(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new Nt(He.layout_symbol["icon-image"]),"icon-rotate":new Nt(He.layout_symbol["icon-rotate"]),"icon-padding":new It(He.layout_symbol["icon-padding"]),"icon-keep-upright":new It(He.layout_symbol["icon-keep-upright"]),"icon-offset":new Nt(He.layout_symbol["icon-offset"]),"icon-anchor":new Nt(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(He.layout_symbol["text-rotation-alignment"]),"text-field":new Nt(He.layout_symbol["text-field"]),"text-font":new Nt(He.layout_symbol["text-font"]),"text-size":new Nt(He.layout_symbol["text-size"]),"text-size-scale-range":new It(He.layout_symbol["text-size-scale-range"]),"text-max-width":new Nt(He.layout_symbol["text-max-width"]),"text-line-height":new Nt(He.layout_symbol["text-line-height"]),"text-letter-spacing":new Nt(He.layout_symbol["text-letter-spacing"]),"text-justify":new Nt(He.layout_symbol["text-justify"]),"text-radial-offset":new Nt(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(He.layout_symbol["text-variable-anchor"]),"text-anchor":new Nt(He.layout_symbol["text-anchor"]),"text-max-angle":new It(He.layout_symbol["text-max-angle"]),"text-writing-mode":new It(He.layout_symbol["text-writing-mode"]),"text-rotate":new Nt(He.layout_symbol["text-rotate"]),"text-padding":new It(He.layout_symbol["text-padding"]),"text-keep-upright":new It(He.layout_symbol["text-keep-upright"]),"text-transform":new Nt(He.layout_symbol["text-transform"]),"text-offset":new Nt(He.layout_symbol["text-offset"]),"text-allow-overlap":new It(He.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new It(He.layout_symbol["text-ignore-placement"]),"text-optional":new It(He.layout_symbol["text-optional"]),visibility:new It(He.layout_symbol.visibility)})),paint:wM||(wM=new or({"icon-opacity":new Nt(He.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Nt(He.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Nt(He.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Nt(He.paint_symbol["text-emissive-strength"]),"icon-color":new Nt(He.paint_symbol["icon-color"]),"icon-halo-color":new Nt(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new Nt(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Nt(He.paint_symbol["icon-halo-blur"]),"icon-translate":new It(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(He.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new It(He.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Nt(He.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Nt(He.paint_symbol["text-occlusion-opacity"]),"text-color":new Nt(He.paint_symbol["text-color"],{runtimeType:eo,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Nt(He.paint_symbol["text-halo-color"]),"text-halo-width":new Nt(He.paint_symbol["text-halo-width"]),"text-halo-blur":new Nt(He.paint_symbol["text-halo-blur"]),"text-translate":new It(He.paint_symbol["text-translate"]),"text-translate-anchor":new It(He.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new It(He.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new It(He.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new It(He.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new It(He.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Nt(He.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},QA);class pv extends Ws{constructor(o,l,d,p){super(o,eT(),l,d,p),this._colorAdjustmentMatrix=W([]),this.hasInitialOcclusionOpacityProperties=o.paint!==void 0&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}recalculate(o,l){super.recalculate(o,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const p=[];for(const _ of d)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,l,d,p){return this._saturation===o&&this._contrast===l&&this._brightnessMin===d&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(_,y,A,S){_=ks(_),y=Rs(y);const I=X(),R=_/3,P=1-2*R,B=[P,R,R,0,R,P,R,0,R,R,P,0,0,0,0,1],N=.5-.5*y,U=S-A;return _e(I,[U,0,0,0,0,U,0,0,0,0,U,0,A,A,A,1],[y,0,0,0,0,y,0,0,0,0,y,0,N,N,N,1]),_e(I,I,B),I}(o,l,d,p),this._saturation=o,this._contrast=l,this._brightnessMin=d,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,l,d,p){const _=this.layout.get(o).evaluate(l,{},d,p),y=this._unevaluatedLayout._values[o];return y.isDataDriven()||yp(y.value)||!_?_:function(A,S){return S.replace(/{([^{}]+)}/g,(I,R)=>R in A?String(A[R]):"")}(l.properties,_)}createBucket(o){return new fv(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of eT().paint.overridableProperties){if(!pv.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),d=new AM(l),p=new zg(d,l.property.specification,this.scope,this.options);let _=null;_=l.value.kind==="constant"||l.value.kind==="source"?new th("source",p):new Kh("composite",p,l.value.zoomStops,l.value.interpolationType),this.paint._values[o]=new eu(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&pv.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const d=o.get("text-field"),p=eT().paint.properties[l];let _=!1;const y=A=>{for(const S of A)if(p.overrides&&p.overrides.hasOverride(S))return void(_=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Vs)y(d.value.value.sections);else if(d.value.kind==="source"){const A=I=>{_||(I instanceof Ri&&Ur(I.value)===td?y(I.value.sections):I instanceof Gc?y(I.sections):I.eachChild(A))},S=d.value;S._styleExpression&&A(S._styleExpression.expression)}return _}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,l,d){return{config:new pc(this,{zoom:l,lut:d}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let TM,SM,EM,CM;var tT=tn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function iT(h){switch(h){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function nT(h){switch(h){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class rT{constructor(o,l,d,p){this.context=o,this.format=d,this.useMipmap=p&&p.useMipmap,this.texture=o.gl.createTexture(),this.update(l,{premultiply:p&&p.premultiply})}update(o,l){const d=o&&o instanceof HTMLVideoElement&&o.width===0?o.videoWidth:o.width,p=o&&o instanceof HTMLVideoElement&&o.height===0?o.videoHeight:o.height,{context:_}=this,{gl:y}=_,{x:A,y:S}=l&&l.position?l.position:{x:0,y:0},I=A+d,R=S+p;!this.size||this.size[0]===I&&this.size[1]===R||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!l||l.premultiply!==!1));const P=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&I>0&&R>0){const B=this.useMipmap?Math.floor(Math.log2(Math.max(I,R)))+1:1;y.texStorage2D(y.TEXTURE_2D,B,this.format,I,R),this.size=[I,R]}if(this.size)if(P)y.texSubImage2D(y.TEXTURE_2D,0,A,S,iT(this.format),nT(this.format),o);else{const B=o.data;B&&y.texSubImage2D(y.TEXTURE_2D,0,A,S,d,p,iT(this.format),nT(this.format),B)}this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(o,l,d=!1){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),o!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap&&!d?o===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),l!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(o,l,d,p){const{context:_}=this,{gl:y}=_;y.bindTexture(y.TEXTURE_2D,this.texture),l!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,l),this.magFilter=l),o!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?o===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),d!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,d),this.wrapS=d),p!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class mv{constructor(o,l){this.context=o,this.texture=l}bind(o,l){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),o!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o),this.minFilter=o),l!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrapS=l)}}function gv(h,o,l,d,p,_,y,A){const S=[h,o,1,l,d,1,p,_,1],I=[y,A,1],R=F([],S),[P,B,N]=Yl(I,I,R);return $(S,S,[P,0,0,0,B,0,0,0,N])}function IM(h,o,l,d,p,_,y,A){const S=function(I,R,P,B,N,U,j,K){const ee=gv(0,0,1,0,1,1,0,1),le=gv(I,R,P,B,N,U,j,K);return $(le,le,F([],ee))}(h,o,l,d,p,_,y,A);return[S[2]/S[8]/Dt,S[5]/S[8]/Dt]}function _v(h){return[h[0],Math.min(Math.max(h[1],-85.051129),je)]}class MM extends jc{constructor(o,l,d,p){super(),this.id=o,this.dispatcher=d,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=l,this._dirty=!1}load(o,l){if(this._loaded=l||!1,this.fire(new Jl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=Bh(this.map._requestManager.transformRequest(this.url,Uf.Image),(d,p)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new lg(d)):p&&(this.image=p instanceof HTMLImageElement?da.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new mv(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Jl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof mv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=o[0][1],d=o[0][1];for(const _ of o)_[1]>d&&(d=_[1]),_[1]<l&&(l=_[1]);const p=(d+l)/2;if(p>je?this.onNorthPole=!0:p<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const _=o.map(qe.fromLngLat);this.tileID=function(y){let A=1/0,S=1/0,I=-1/0,R=-1/0;for(const j of y)A=Math.min(A,j.x),S=Math.min(S,j.y),I=Math.max(I,j.x),R=Math.max(R,j.y);const P=Math.max(I-A,R-S),B=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),N=Math.pow(2,B);let U=Math.floor((A+I)/2*N);return U>1&&(U-=1),new Mn(B,U,Math.floor((S+R)/2*N))}(_),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Jl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const ee in this.tiles){const le=this.tiles[ee];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=C_(new Mn(0,0,0),this.map.transform.projection),d=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ee){const le=ee[1].x-ee[0].x,re=ee[1].y-ee[0].y,G=ee[2].x-ee[1].x,ie=ee[2].y-ee[1].y,ae=ee[3].x-ee[2].x,fe=ee[3].y-ee[2].y,Ce=ee[0].x-ee[3].x,Be=ee[0].y-ee[3].y,Fe=le*ie-G*re,Ve=G*fe-ae*ie,et=ae*Be-Ce*fe,mt=Ce*re-le*Be;return Fe>0&&Ve>0&&et>0&&mt>0||Fe<0&&Ve<0&&et<0&&mt<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=C_(this.tileID,this.map.transform.projection),[_,y,A,S]=this.coordinates.map(ee=>{const le=p.projection.project(ee[0],ee[1]);return mM(p,le)._round()});this.perspectiveTransform=IM(_.x,_.y,y.x,y.y,A.x,A.y,S.x,S.y);const I=this._boundsArray=new ah;I.emplaceBack(_.x,_.y,0,0),I.emplaceBack(y.x,y.y,Dt,0),I.emplaceBack(S.x,S.y,0,Dt),I.emplaceBack(A.x,A.y,Dt,Dt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(I,tT.members),this.boundsSegments=Gn.simpleSegment(0,0,4,2);const R=[],P=[_v((B=this.coordinates)[0]),_v(B[1]),_v(B[2]),_v(B[3])];var B;const[N,U,j,K]=function(ee){let le=ee[0][0],re=le,G=ee[0][1],ie=G;for(let ae=1;ae<ee.length;ae++)ee[ae][0]<le?le=ee[ae][0]:ee[ae][0]>re&&(re=ee[ae][0]),ee[ae][1]<G?G=ee[ae][1]:ee[ae][1]>ie&&(ie=ee[ae][1]);return[le,G,re-le,ie-G]}(P);{const ee=new ah,[le,re,G,ie]=function(Ke){let ft=Ke[0].x,Ye=ft,Qe=Ke[0].y,At=Qe;for(let Et=1;Et<Ke.length;Et++)Ke[Et].x<ft?ft=Ke[Et].x:Ke[Et].x>Ye&&(Ye=Ke[Et].x),Ke[Et].y<Qe?Qe=Ke[Et].y:Ke[Et].y>At&&(At=Ke[Et].y);return[ft,Qe,Ye-ft,At-Qe]}(d),ae=Ke=>[(Ke.x-le)/G,(Ke.y-re)/ie],[fe,Ce,Be,Fe]=d.map(ae),Ve=function(Ke,ft,Ye,Qe,At,Et,Kt,$t){const Bt=gv(0,0,1,0,1,1,0,1);return $(Bt,Bt,F([],gv(Ke,ft,Ye,Qe,At,Et,Kt,$t)))}(fe[0],fe[1],Ce[0],Ce[1],Be[0],Be[1],Fe[0],Fe[1]);this.elevatedGlobePerspectiveTransform=IM(fe[0],fe[1],Ce[0],Ce[1],Be[0],Be[1],Fe[0],Fe[1]);const et=(Ke,ft)=>{R.push(Ke.lng);const Ye=Math.round((Ke.lng-N)/j*Dt),Qe=Math.round((Ke.lat-U)/K*Dt),At=ae(ft),Et=Yl([],[At[0],At[1],1],Ve),Kt=Math.round(Et[0]/Et[2]*Dt),$t=Math.round(Et[1]/Et[2]*Dt);ee.emplaceBack(Ye,Qe,Kt,$t)},mt=d[3].x-d[0].x,ht=d[3].y-d[0].y,pt=d[2].x-d[1].x,xt=d[2].y-d[1].y;for(let Ke=0;Ke<65;Ke++){const ft=Ke/64,Ye=[d[0].x+ft*mt,d[0].y+ft*ht],Qe=[d[1].x+ft*pt,d[1].y+ft*xt],At=Qe[0]-Ye[0],Et=Qe[1]-Ye[1];for(let Kt=0;Kt<65;Kt++){const $t=Kt/64,Bt={x:Ye[0]+At*$t,y:Ye[1]+Et*$t};et(l.projection.unproject(Bt.x,Bt.y),Bt)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(ee,tT.members)}{this.maxLongitudeTriangleSize=0;let ee=[],le=new qr;const re=(G,ie,ae)=>{le.emplaceBack(G,ie,ae);const fe=R[G],Ce=R[ie],Be=R[ae],Fe=Math.min(Math.min(fe,Ce),Be),Ve=Math.max(Math.max(fe,Ce),Be)-Fe;Ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ve),ee.push(Fe+Ve/2)};for(let G=0;G<64;G++)for(let ie=0;ie<64;ie++){const ae=65*G+ie,fe=ae+1,Ce=ae+65,Be=Ce+1;re(ae,Ce,fe),re(fe,Ce,Be)}[ee,le]=function(G,ie){const ae=Array.from({length:G.length},(Be,Fe)=>Fe);ae.sort((Be,Fe)=>G[Be]-G[Fe]);const fe=[],Ce=new qr;for(let Be=0;Be<ae.length;Be++){const Fe=ae[Be];fe.push(G[Fe]);const Ve=3*Fe,et=Ve+1;Ce.emplaceBack(ie.uint16[Ve],ie.uint16[et],ie.uint16[et+1])}return[fe,Ce]}(ee,le),this.elevatedGlobeTrianglesCenterLongitudes=ee,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(le)}this.elevatedGlobeSegments=Gn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,j/Dt,0,K/Dt,0,0,U,N,0])}prepare(){const o=Object.keys(this.tiles).length!==0;if(this.tileID&&!o)return;const l=this.map.painter.context,d=l.gl;!this._dirty||this.texture instanceof mv||(this.texture?this.texture.update(this.image):(this.texture=new rT(l,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(l)}loadTile(o,l){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},l(null)):(o.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let p=(_=o+180)+360*Math.round((d[0]-_)/360);var _;const y=new Gn,A=(P,B)=>{y.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:l.segments[0].vertexLength,primitiveLength:B,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-p)<=S){const P=gl(d,0,d.length,p+S);return P===d.length||A(P,cs(d,P+1,d.length,p+360-S)-P),y}p<d[0]&&(p+=360);const I=cs(d,0,d.length,p-S);if(I===d.length)return A(0,d.length),y;A(0,I-0);const R=gl(d,I+1,d.length,p+S);return R!==d.length&&A(R,d.length-R),y}}const c6=(Math.pow(256,2)-1)/16907520;class RM extends Ws{constructor(o,l,d,p){super(o,{layout:EM||(EM=new or({visibility:new It(He.layout_raster.visibility)})),paint:CM||(CM=new or({"raster-opacity":new It(He.paint_raster["raster-opacity"]),"raster-color":new sh(He.paint_raster["raster-color"]),"raster-color-mix":new It(He.paint_raster["raster-color-mix"]),"raster-color-range":new It(He.paint_raster["raster-color-range"]),"raster-hue-rotate":new It(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(He.paint_raster["raster-brightness-max"]),"raster-saturation":new It(He.paint_raster["raster-saturation"]),"raster-contrast":new It(He.paint_raster["raster-contrast"]),"raster-resampling":new It(He.paint_raster["raster-resampling"]),"raster-fade-duration":new It(He.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new It(He.paint_raster["raster-emissive-strength"]),"raster-array-band":new It(He.paint_raster["raster-array-band"]),"raster-elevation":new It(He.paint_raster["raster-elevation"]),"raster-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},l,d,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof MM&&(o._source.onNorthPole||o._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(o){o!=="raster-color"&&o!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[d,p]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(p)||d===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=u_({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,p])}}let kM,PM,DM,BM,OM;class FM extends Ws{constructor(o,l,d,p){super(o,{layout:kM||(kM=new or({visibility:new It(He["layout_raster-particle"].visibility)})),paint:PM||(PM=new or({"raster-particle-array-band":new It(He["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new It(He["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new sh(He["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new It(He["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new It(He["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new It(He["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new It(He["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new It(He["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},l,d,p),this._updateColorRamp(),this.lastInvalidatedAt=da.now()}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){o!=="raster-particle-color"&&o!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),o==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=u_({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=da.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class h6 extends Ws{constructor(o,l){super(o,{},l,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(o){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(o){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function sT(h,o,l){const d=[0,0,1],p=ja([]);return ca(p,p,l?-H(h)+Math.PI:H(h)),$o(p,p,-H(o)),aa(d,d,p),on(d,d)}function LM(h,o){const l=yv(h.projection,h.zoom,h.width,h.height),d=function(_,y,A,S,I){const R=new Z(A.lng-180*_u,A.lat),P=new Z(A.lng+180*_u,A.lat),B=_.project(R.lng,R.lat),N=_.project(P.lng,P.lat),U=-Math.atan2(N.y-B.y,N.x-B.x),j=qe.fromLngLat(A);j.y=De(j.y,-1+_u,1-_u);const K=j.toLngLat(),ee=_.project(K.lng,K.lat),le=qe.fromLngLat(K);le.x+=_u;const re=le.toLngLat(),G=_.project(re.lng,re.lat),ie=NM(G.x-ee.x,G.y-ee.y,U),ae=qe.fromLngLat(K);ae.y+=_u;const fe=ae.toLngLat(),Ce=_.project(fe.lng,fe.lat),Be=NM(Ce.x-ee.x,Ce.y-ee.y,U),Fe=Math.abs(ie.x)/Math.abs(Be.y),Ve=W([]);Je(Ve,Ve,-U*(1-(I?0:S)));const et=W([]);return we(et,et,[1,1-(1-Fe)*S,1]),et[4]=-Be.x/Be.y*S,Je(et,et,U),_e(et,Ve,et),et}(h.projection,0,h.center,l,o),p=zM(h);return we(d,d,[p,p,1]),d}function zM(h){const o=h.projection,l=yv(h.projection,h.zoom,h.width,h.height),d=oT(o,h.center),p=oT(o,Z.convert(o.center));return Math.pow(2,d*l+(1-l)*p)}function yv(h,o,l,d,p=1/0){const _=h.range;if(!_)return 0;const y=Math.min(p,Math.max(l,d)),A=Math.log(y/1024)/Math.LN2;return ze(_[0]+A,_[1]+A,o)}const _u=1/4e4;function oT(h,o){const l=De(o.lat,-85.051129,je),d=new Z(o.lng-180*_u,l),p=new Z(o.lng+180*_u,l),_=h.project(d.lng,l),y=h.project(p.lng,l),A=qe.fromLngLat(d),S=qe.fromLngLat(p),I=y.x-_.x,R=y.y-_.y,P=S.x-A.x,B=S.y-A.y,N=Math.sqrt((P*P+B*B)/(I*I+R*R));return Math.log(N)/Math.LN2}function NM(h,o,l){const d=Math.cos(l),p=Math.sin(l);return{x:h*d-o*p,y:h*p+o*d}}function UM(h,o,l){W(h),Je(h,h,H(o[2])),Ee(h,h,H(o[0])),Le(h,h,H(o[1])),we(h,h,l),_e(h,h,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function bv(h,o,l,d,p,_,y,A){const S=[l[0]-o[0],l[1]-o[1],0],I=[d[0]-o[0],d[1]-o[1],0];if(bi(S)<1e-12||bi(I)<1e-12)return ja(h);const R=rr([],S,I);on(R,R),Zi(I,d,o),S[2]=(_-p)*A,I[2]=(y-p)*A;const P=S;return rr(P,S,I),on(P,P),ha(h,R,P)}function aT(h,o,l=!1){const d=uu(o.zoom),p=function(_,y,A){const S=y.worldSize,I=[_[12],_[13],_[14]],R=Re(I[1]/S),P=Ie(I[0]/S),B=W([]),N=ge(1,R)*S,U=ge(1,0)*S*it(R,y.zoom),j=1/mA(S);let K=U*j;if(A){const G=yv(y.projection,y.zoom,y.width,y.height,1024);K=j*y.projection.pixelSpaceConversion(y.center.lat,S,G)}const ee=Y(R,P);vi(ee,ee,Qi([],on([],ee),N*K*I[2]));const le=function(G){const ie=[G[0],G[1],G[2]];let ae=[0,1,0];const fe=rr([],ae,ie);return rr(ae,ie,fe),mo(ae)===0&&(ae=[0,1,0],rr(fe,ie,ae)),on(fe,fe),on(ae,ae),on(ie,ie),[fe[0],fe[1],fe[2],0,ae[0],ae[1],ae[2],0,ie[0],ie[1],ie[2],0,G[0],G[1],G[2],1]}(ee);we(B,B,[K,K,K*N]),Te(B,B,[-I[0],-I[1],-I[2]]);const re=_e([],y.globeMatrix,le);return _e(re,re,B),_e(re,re,_),re}(h,o,l);if(d>0){const _=function(y,A){const S=A.worldSize,I=ge(1,0)*S*it(A.center.lat,A.zoom)/mA(S),R=ge(1,A.center.lat)*S,P=W([]);return Le(P,P,H(A.center.lng)),Ee(P,P,H(A.center.lat)),Te(P,P,[0,0,x]),we(P,P,[I,I,I*R]),Te(P,P,[A.point.x-.5*S,A.point.y-.5*S,0]),_e(P,P,y),_e(P,A.globeMatrix,P)}(h,o);return function(y,A,S){const I=(U,j,K)=>{const ee=bi(U),le=bi(j),re=dh(U,j,K);return Qi(re,re,1/bi(re)*ri(ee,le,K))},R=I([y[0],y[1],y[2]],[A[0],A[1],A[2]],S),P=I([y[4],y[5],y[6]],[A[4],A[5],A[6]],S),B=I([y[8],y[9],y[10]],[A[8],A[9],A[10]],S),N=dh([y[12],y[13],y[14]],[A[12],A[13],A[14]],S);return[R[0],R[1],R[2],0,P[0],P[1],P[2],0,B[0],B[1],B[2],0,N[0],N[1],N[2],1]}(p,_,d)}return p}function VM(h,o,l,d){const p=zn.projectAabbCorners(d,l);let _=Number.MAX_VALUE,y=-1;for(let I=0;I<p.length;++I){const R=p[I];R[0]=(.5*R[0]+.5)*o.width,R[1]=(.5-.5*R[1])*o.height,R[2]<_&&(y=I,_=R[2])}const A=I=>new ue(p[I][0],p[I][1]);let S;switch(y){case 0:case 6:S=[A(1),A(5),A(4),A(7),A(3),A(2),A(1)];break;case 1:case 7:S=[A(0),A(4),A(5),A(6),A(2),A(3),A(0)];break;case 3:case 5:S=[A(1),A(0),A(4),A(7),A(6),A(2),A(1)];break;default:S=[A(1),A(5),A(6),A(7),A(3),A(0),A(1)]}if(ai(h,S))return _}const u6=tn([{name:"a_pos_3f",components:3,type:"Float32"}]),d6=tn([{name:"a_color_3f",components:3,type:"Float32"}]),f6=tn([{name:"a_color_4f",components:4,type:"Float32"}]),p6=tn([{name:"a_uv_2f",components:2,type:"Float32"}]),m6=tn([{name:"a_normal_3f",components:3,type:"Float32"}]),g6=tn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),_6=tn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),$M={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class vv{constructor(o,l,d,p){this.message=(o?`${o}: `:"")+d,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function lT(h,o){const l=h.indexOf("://")===-1;try{return new URL(h,l&&o?"http://example.com":void 0),!0}catch{return!1}}class jM{constructor(o,l){this.feature=o,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class HM{constructor(){this.instancedDataArray=new su,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class cT{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=o.projection,this.index=o.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=o.styleDefinedModelURLs}updateFootprints(o,l){}populate(o,l,d,p){this.tileToMeter=$e(d);const _=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:A,index:S,sourceLayerIndex:I}of o){const R=A??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),P=Jt(y,_);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),P,d))continue;const B={id:R,sourceLayerIndex:I,index:S,geometry:_?P.geometry:jt(y,d,p),properties:y.properties,type:y.type,patterns:{}},N=this.addFeature(B,B.geometry,P);N&&l.featureIndex.insert(y,B.geometry,S,I,this.index,this.instancesPerModel[N].instancedDataArray.length,Dt/32)}this.lookup=null}update(o,l,d,p){for(const _ in this.instancesPerModel){const y=this.instancesPerModel[_];for(const A in o)y.idToFeaturesIndex.hasOwnProperty(A)&&(this.evaluate(y.features[y.idToFeaturesIndex[A]],o[A],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];for(const p of d.features){const _=this.layers[0],y=p.feature,A=this.canonical,S=_.paint.get("model-rotation").evaluate(y,{},A),I=_.paint.get("model-scale").evaluate(y,{},A),R=_.paint.get("model-translation").evaluate(y,{},A);fs(p.rotation,S)&&fs(p.scale,I)&&fs(p.translation,R)||(this.evaluate(p,p.featureStates,d,!0),o=!0)}}return o}updateReplacement(o,l,d,p){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const _=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(PA(this.activeReplacements,_))return!1;this.activeReplacements=_;let y=!1;for(const A in this.instancesPerModel){const S=this.instancesPerModel[A],I=S.instancedDataArray;for(const R of S.features){const P=R.instancedDataOffset,B=R.instancedDataCount;for(let N=0;N<B;N++){const U=16*(N+P);let j=I.float32[U+0];const K=j>Dt;j=K?j-Dt:j;const ee=Math.floor(j),le=I.float32[U+1];let re=!1;for(const G of this.activeReplacements)if(!YI(G,d,$M.Model,p)&&!(G.min.x>ee||ee>G.max.x||G.min.y>le||le>G.max.y)&&(re=t3(e3(ee,le,o.canonical,G.footprintTileId.canonical),G.footprint),re))break;I.float32[U]=re?j+Dt:j,y=y||re!==K}}}return y}isEmpty(){for(const o in this.instancesPerModel)if(this.instancesPerModel[o].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=o.createVertexBuffer(d.instancedDataArray,g6.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const o=this.layers[0].modelManager;if(o&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)o.removeModel(l,"",!0)}addFeature(o,l,d){const p=this.layers[0],_=p.layout.get("model-id").evaluate(d,{},this.canonical);if(!_)return Bi(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),_;(lT(_,!1)||this.styleDefinedModelURLs[_]!==void 0)&&(this.modelUris.includes(_)||this.modelUris.push(_)),this.instancesPerModel[_]||(this.instancesPerModel[_]=new HM);const y=this.instancesPerModel[_],A=y.instancedDataArray,S=new jM(d,A.length);for(const I of l)for(const R of I){if(R.x<0||R.x>=Dt||R.y<0||R.y>=Dt)continue;const P=(this.lookupDim-1)/Dt,B=this.lookupDim*(R.y*P|0)+R.x*P|0;if(this.lookup){if(this.lookup[B]!==0)continue;this.lookup[B]=1}this.instanceCount++;const N=A.length;A.resize(N+1),y.instancesEvaluatedElevation.push(0),A.float32[16*N]=R.x,A.float32[16*N+1]=R.y}return S.instancedDataCount=y.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(o.id&&(y.idToFeaturesIndex[o.id]=y.features.length),y.features.push(S),this.evaluate(S,{},y,!1)),_}getModelUris(){return this.modelUris}evaluate(o,l,d,p){const _=this.layers[0],y=o.feature,A=this.canonical,S=o.rotation=_.paint.get("model-rotation").evaluate(y,l,A),I=o.scale=_.paint.get("model-scale").evaluate(y,l,A),R=o.translation=_.paint.get("model-translation").evaluate(y,l,A),P=_.paint.get("model-color").evaluate(y,l,A);P.a=_.paint.get("model-color-mix-intensity").evaluate(y,l,A);const B=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),UM(B,S,I);const N=Math.round(100*P.a)+P.b/1.05;for(let U=0;U<o.instancedDataCount;++U){const j=o.instancedDataOffset+U,K=16*j,ee=d.instancedDataArray.float32;let le=0;p&&(le=ee[K+6]-d.instancesEvaluatedElevation[j]);const re=0|ee[K+1];ee[K]=(0|ee[K])+P.r/1.05,ee[K+1]=re+P.g/1.05,ee[K+2]=N,ee[K+3]=1/(A.z>10?this.tileToMeter:$e(A,re)),ee[K+4]=R[0],ee[K+5]=R[1],ee[K+6]=R[2]+le,ee[K+7]=B[0],ee[K+8]=B[1],ee[K+9]=B[2],ee[K+10]=B[4],ee[K+11]=B[5],ee[K+12]=B[6],ee[K+13]=B[8],ee[K+14]=B[9],ee[K+15]=B[10],d.instancesEvaluatedElevation[j]=R[2]}}}let WM,GM;Ut(cT,"ModelBucket",{omit:["layers"]}),Ut(HM,"PerModelAttributes"),Ut(jM,"ModelFeature");const Ud=64,Wp={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function XM(h,o,l,d,p,_,y,A,S,I=!1){const R=l.zoom,P=l.project(d),B=it(d.lat,R),N=1/B;W(h),Te(h,h,[P.x+y[0]*N,P.y+y[1]*N,y[2]]);let U=1,j=1;const K=l.worldSize;if(I){if(l.projection.name==="mercator"){let G=0;l.elevation&&(G=l.elevation.getAtPointOrZero(new qe(P.x/K,P.y/K),0));const ie=ls([],[P.x,P.y,G,1],l.projMatrix)[3]/l.cameraToCenterDistance;U=ie,j=ie*it(l.center.lat,R)}else if(l.projection.name==="globe"){const G=aT(h,l),ie=[0,0,0,1];ls(ie,ie,_e([],l.projMatrix,G));const ae=ie[3]/l.cameraToCenterDistance,fe=uu(R),Ce=l.projection.pixelsPerMeter(d.lat,K)*it(d.lat,R),Be=l.projection.pixelsPerMeter(l.center.lat,K)*it(l.center.lat,R);U=ae/ri(Ce,lt(l.center.lat),fe),j=ae*B/Ce,U*=Be,j*=Be}}else U=N;we(h,h,[U,U,j]);const ee=[...h],le=o.orientation,re=[];if(UM(re,[le[0]+p[0],le[1]+p[1],le[2]+p[2]],_),_e(h,ee,re),A&&l.elevation){let G=0;const ie=[];if(S&&l.elevation){G=function(fe,Ce,Be,Fe,Ve){const et=Ce.elevation;if(!et)return 0;const mt=zn.projectAabbCorners(Be,Fe),ht=ge(1,Ve.lat)*Ce.worldSize,pt=function(wt,pi){const Xt=[0,0,1],qt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ui of qt){const Ai=wt[ui.corners[0]],Ti=wt[ui.corners[1]],Di=wt[ui.corners[2]],Mi=[Ti[0]-Ai[0],Ti[1]-Ai[1],pi*(Ti[2]-Ai[2])],Ci=rr(Mi,Mi,[Di[0]-Ai[0],Di[1]-Ai[1],pi*(Di[2]-Ai[2])]);on(Ci,Ci),ui.dotProductWithUp=cn(Ci,Xt)}return qt.sort((ui,Ai)=>ui.dotProductWithUp-Ai.dotProductWithUp),qt[0].corners}(mt,ht),xt=mt[pt[0]],Ke=mt[pt[1]],ft=mt[pt[2]],Ye=mt[pt[3]],Qe=et.getAtPointOrZero(new qe(xt[0]/Ce.worldSize,xt[1]/Ce.worldSize),0),At=et.getAtPointOrZero(new qe(Ke[0]/Ce.worldSize,Ke[1]/Ce.worldSize),0),Et=et.getAtPointOrZero(new qe(ft[0]/Ce.worldSize,ft[1]/Ce.worldSize),0),Kt=et.getAtPointOrZero(new qe(Ye[0]/Ce.worldSize,Ye[1]/Ce.worldSize),0),$t=(Qe+Kt)/2,Bt=(At+Et)/2;return $t>Bt?At<Et?bv(fe,Ke,Ye,xt,At,Kt,Qe,ht):bv(fe,ft,xt,Ye,Et,Qe,Kt,ht):Qe<Kt?bv(fe,xt,Ke,ft,Qe,At,Et,ht):bv(fe,Ye,ft,Ke,Kt,Et,At,ht),Math.max($t,Bt)}(ie,l,o.aabb,h,d);const ae=_e([],St([],ie),re);_e(h,ee,ae)}else G=l.elevation.getAtPointOrZero(new qe(P.x/K,P.y/K),0);G!==0&&(h[14]+=G)}}function P_(h,o,l=!1){h.uploaded||(h.gfxTexture=new rT(o,h.image,l?o.gl.R8:o.gl.RGBA8,{useMipmap:h.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),h.uploaded=!0,h.image=null)}function y6(h,o,l){h.indexBuffer=o.createIndexBuffer(h.indexArray,!1,!0),h.vertexBuffer=o.createVertexBuffer(h.vertexArray,u6.members,!1,!0),h.normalArray&&(h.normalBuffer=o.createVertexBuffer(h.normalArray,m6.members,!1,!0)),h.texcoordArray&&(h.texcoordBuffer=o.createVertexBuffer(h.texcoordArray,p6.members,!1,!0)),h.colorArray&&(h.colorBuffer=o.createVertexBuffer(h.colorArray,(h.colorArray.bytesPerElement===12?d6:f6).members,!1,!0)),h.featureArray&&(h.pbrBuffer=o.createVertexBuffer(h.featureArray,_6.members,!0)),h.segments=Gn.simpleSegment(0,0,h.vertexArray.length,h.indexArray.length);const d=h.material;d.pbrMetallicRoughness.baseColorTexture&&P_(d.pbrMetallicRoughness.baseColorTexture,o),d.pbrMetallicRoughness.metallicRoughnessTexture&&P_(d.pbrMetallicRoughness.metallicRoughnessTexture,o),d.normalTexture&&P_(d.normalTexture,o),d.occlusionTexture&&P_(d.occlusionTexture,o,l),d.emissionTexture&&P_(d.emissionTexture,o)}function hT(h,o,l){if(h.meshes)for(const d of h.meshes)y6(d,o,l);if(h.children)for(const d of h.children)hT(d,o,l)}function xv(h){if(h.meshes)for(const o of h.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(h.children)for(const o of h.children)xv(o)}function uT(h){if(h.meshes)for(const l of h.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((o=l.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(h.children)for(const l of h.children)uT(l)}class Gp{constructor(o,l,d){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=d}static create(o,l,d){const p=d||o.findDEMTileFor(l);if(!p||!p.dem)return;const _=p.dem,y=p.tileID,A=1<<l.canonical.z-y.canonical.z;return new Gp(p,_.dim/Dt/A,[(l.canonical.x/A-y.canonical.x)*_.dim,(l.canonical.y/A-y.canonical.y)*_.dim])}tileCoordToPixel(o,l){const d=l*this._scale+this._offset[1],p=Math.floor(o*this._scale+this._offset[0]),_=Math.floor(d);return new ue(p,_)}getElevationAt(o,l,d,p){const _=o*this._scale+this._offset[0],y=l*this._scale+this._offset[1],A=Math.floor(_),S=Math.floor(y),I=this._dem;return p=!!p,d?ri(ri(I.get(A,S,p),I.get(A,S+1,p),y-S),ri(I.get(A+1,S,p),I.get(A+1,S+1,p),y-S),_-A):I.get(A,S,p)}getElevationAtPixel(o,l,d){return this._dem.get(o,l,!!d)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*ge(1,o)*this._dem.stride}}const dT=new Float32Array(262144),Vd=new Uint8Array(262144);function qM(h){let o=0;if(h.meshes)for(const l of h.meshes)o=Math.max(o,l.aabb.max[2]);if(h.children)for(const l of h.children)o=Math.max(o,qM(l));return o}function YM(h,o,l){if(h.meshes)for(const d of h.meshes){if(d.aabb.min[0]===1/0)continue;const p=zn.applyTransform(d.aabb,h.matrix);l.insert(o,p.min[0],p.min[1],p.max[0],p.max[1])}if(h.children)for(const d of h.children)YM(d,o,l)}const ZM=["","wall","door","roof","window","lamp","logo"];class KM{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:qM(o)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new zn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const l=new zn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==o&&(d.transformedAabb=zn.applyTransformFast(d.aabb,this.node.matrix),l.encapsulate(d.transformedAabb)),o++;this.aabb=l}return this.aabb}}class wv{constructor(o,l,d,p,_,y,A){this.id=d,this.layers=o,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=Wp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=Wp.HasMapboxMeshFeatures),_&&(this.modelTraits|=Wp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of l)this.nodesInfo.push(new KM(S)),YM(S,A.featureIndexArray.length,A.grid),A.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,A.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(o,l){for(const d of this.getNodesInfo()){const p=d.node;p.footprint&&l.push({footprint:p.footprint,id:o})}}update(o){const l=Object.keys(o).length!==0;if(l&&!this.stateDependentLayers.length)return;const d=l?this.stateDependentLayers:this.layers;if(!st(o,this.states))for(const p of d)this.evaluate(p,o);this.states=structuredClone(o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const d of l){const p=d.node;this.uploaded?this.updatePbrBuffer(p):hT(p,o,!0)}for(const d of l)xv(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let l=!1;if(!o.meshes)return l;for(const d of o.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),l=!0);return l}needsReEvaluation(o,l,d){const p=o.transform.projectionOptions,_=o.style.getBrightness(),y=this.brightness!==_;if(!this.uploaded||this.dirty||p.name!==this.projection.name||D_(d.paint.get("model-color").value,y)||D_(d.paint.get("model-color-mix-intensity").value,y)||D_(d.paint.get("model-roughness").value,y)||D_(d.paint.get("model-emissive-strength").value,y)||D_(d.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=p,this.brightness=_;const A=this.getNodesInfo();for(const S of A)S.state=null;return!0}return!1}evaluateScale(o,l){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const d=this.getNodesInfo(),p=this.id.canonical;for(const _ of d){const y=_.feature;_.evaluatedScale=l.paint.get("model-scale").evaluate(y,{},p)}}evaluate(o,l){const d=this.getNodesInfo();for(const p of d){if(!p.node.meshes)continue;const _=p.feature,y=l&&l[_.id];if(st(y,p.state))continue;p.state=structuredClone(y);const A=p.node.meshes&&p.node.meshes[0].featureData,S=p.evaluatedColor[2],I=p.evaluatedRMEA[2],R=this.id.canonical;if(p.hasTranslucentParts=!1,A){for(let P=0;P<ZM.length;P++){const B=ZM[P];B.length&&(_.properties.part=B);const N=o.paint.get("model-color").evaluate(_,y,R).toRenderColor(null),U=o.paint.get("model-color-mix-intensity").evaluate(_,y,R);p.evaluatedColor[P]=[N.r,N.g,N.b,U],p.evaluatedRMEA[P][0]=o.paint.get("model-roughness").evaluate(_,y,R),p.evaluatedRMEA[P][2]=o.paint.get("model-emissive-strength").evaluate(_,y,R),p.evaluatedRMEA[P][3]=N.a,p.emissionHeightBasedParams[P]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,y,R),!p.hasTranslucentParts&&N.a<1&&(p.hasTranslucentParts=!0)}delete _.properties.part,v6(p,S!==p.evaluatedColor[2]||I!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(_,y,R);p.evaluatedScale=o.paint.get("model-scale").evaluate(_,y,R),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,l,d,p){const _=o.findDEMTileFor(d);if(_&&(_.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(_.dem&&_.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=_.tileID.overscaledZ;const y=Gp.create(o,d,_);if(!y)return;this.modelTraits&Wp.HasMapboxMeshFeatures&&this.updateDEM(o,y,d,p);for(const A of this.getNodesInfo()){const S=A.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const I=S.footprint.vertices;let R=y.getElevationAt(I[0].x,I[0].y,!0,!0);for(let P=1;P<I.length;P++)R=Math.min(R,y.getElevationAt(I[P].x,I[P].y,!0,!0));S.elevation=R}}this.terrainTile=_.tileID.canonical,this.terrainExaggeration=l}}updateDEM(o,l,d,p){let _=l._dem._modifiedForSources[p];if(_===void 0&&(l._dem._modifiedForSources[p]=[],_=l._dem._modifiedForSources[p]),_.includes(d.canonical))return;const y=l._dem.dim;_.push(d.canonical);let A=!1;for(const S of this.getNodesInfo()){const I=S.node;if(!I.footprint||!I.footprint.grid)continue;const R=I.footprint.grid,P=l.tileCoordToPixel(R.min.x,R.min.y),B=l.tileCoordToPixel(R.max.x,R.max.y),N=Math.min(Math.min(y-B.y,P.x),Math.min(P.y,y-B.x));if(N<0)continue;const U=De(N,2,5);let j=Math.max(0,P.x-U),K=Math.max(0,P.y-U),ee=Math.min(B.x+U,y-1),le=Math.min(B.y+U,y-1);for(let ae=K;ae<=le;++ae)for(let fe=j;fe<=ee;++fe)Vd[ae*y+fe]=255;let re=0,G=0;for(let ae=0;ae<R.cellsY;++ae)for(let fe=0;fe<R.cellsX;++fe){if(!R.cells[ae*R.cellsX+fe])continue;const Ce=l.tileCoordToPixel(R.min.x+fe/R.xScale,R.min.y+ae/R.yScale),Be=l.tileCoordToPixel(R.min.x+(fe+1)/R.xScale,R.min.y+(ae+1)/R.yScale);for(let Fe=Ce.y;Fe<=Math.min(Be.y+1,y-1);++Fe)for(let Ve=Ce.x;Ve<=Math.min(Be.x+1,y-1);++Ve)Vd[Fe*y+Ve]===255&&(Vd[Fe*y+Ve]=0,re+=l.getElevationAtPixel(Ve,Fe),G++)}const ie=re/G;j=Math.max(1,P.x-U),K=Math.max(1,P.y-U),ee=Math.min(B.x+U,y-2),le=Math.min(B.y+U,y-2),A=!0;for(let ae=K;ae<=le;++ae)for(let fe=j;fe<=ee;++fe)Vd[ae*y+fe]===0&&(dT[ae*y+fe]=l._dem.set(fe,ae,ie));for(let ae=1;ae<U;++ae){j=Math.max(1,P.x-ae),K=Math.max(1,P.y-ae),ee=Math.min(B.x+ae,y-2),le=Math.min(B.y+ae,y-2);for(let fe=K;fe<=le;++fe)for(let Ce=j;Ce<=ee;++Ce){const Be=fe*y+Ce;if(Vd[Be]===255){let Fe=0,Ve=0,et=-1,mt=-1;for(let ht=-1;ht<=1;++ht)for(let pt=-1;pt<=1;++pt){const xt=(fe+ht)*y+Ce+pt;if(Vd[xt]>=ae)continue;const Ke=dT[xt],ft=Math.abs(Ke);ft>Ve&&(Fe=Ke,Ve=ft,et=pt,mt=ht)}if(Ve>.1){const ht=1-(ae+.5*Math.abs(et*mt))/U;let pt=l._dem.get(Ce,fe)+Fe*ht;const xt=l._dem.get(Ce+et,fe+mt),Ke=l._dem.get(Ce-et,fe-mt,!0);(pt-xt)*(pt-Ke)>0&&(pt=(xt+Ke)/2),dT[Be]=l._dem.set(Ce,fe,pt),Vd[Be]=ae}}}}}A&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=da.now())}setFilter(o){this.filter=o?Gg(o):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(o=>this.filter.filter(new pn(this.id.overscaledZ),o.feature,this.id.canonical)):this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const l of o)xv(l.node),uT(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const d=l.getReplacementRegionsForTile(o.toUnwrapped()),p=this.getNodesInfo();for(let _=0;_<this.nodesInfo.length;_++){const y=p[_].node;p[_].hiddenByReplacement=!!y.footprint&&!d.find(A=>A.footprint===y.footprint)}}getHeightAtTileCoord(o,l){const d=this.getNodesInfo(),p=[],_=[0,0,0],y=W([]);for(let A=0;A<this.nodesInfo.length;A++){const S=d[A],I=S.node.meshes[0],R=I.transformedAabb;if(o<R.min[0]||l<R.min[1]||o>R.max[0]||l>R.max[1])continue;if(S.node.hidden===!0)return{height:1/0,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};ne(y,S.node.matrix),_[0]=o,_[1]=l,jn(_,_,y);const P=(_[0]-I.aabb.min[0])/(I.aabb.max[0]-I.aabb.min[0])*Ud|0,B=Math.min(63,(_[1]-I.aabb.min[1])/(I.aabb.max[1]-I.aabb.min[1])*Ud|0)*Ud+Math.min(63,P),N=I.heightmap[B];if(!(N<0&&S.node.footprint))return S.hiddenByReplacement?void 0:{height:N,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};if(S.node.footprint.grid.query(new ue(o,l),new ue(o,l),p),p.length>0)return{height:void 0,maxHeight:S.feature.properties.height,hidden:S.hiddenByReplacement,verticalScale:S.evaluatedScale[2]}}}}function D_(h,o){return h instanceof th&&!h.isLightConstant&&o}function b6(h,o,l,d,p,_,y,A){let S=(61440&o|(61440&o)>>4)>>8,I=(3840&o|(3840&o)>>4)>>4,R=240&o|(240&o)>>4;l[3]>0&&(S=ri(S,255*l[0],l[3]),I=ri(I,255*l[1],l[3]),R=ri(R,255*l[2],l[3]));const P=S<<8|I,B=R<<8|Math.floor(255*d[3]),N=function(ae){const fe=De(ae,0,2);return Math.min(Math.round(.5*fe*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],U=De(p[0],0,1),j=De(p[1],0,1),K=De(p[2],0,1),ee=De(p[3],0,1);let le,re,G,ie;if(U!==j&&y!==_&&j!==U){const ae=y-_;re=1/(ae*(j-U)),G=-(_+ae*U)/(ae*(j-U));const fe=De(p[4],-1,1);ie=Math.pow(10,fe),le=255*K<<8|255*ee}else le=65535,re=0,G=1,ie=1;if(h.emplaceBack(P,B,N,le,re,G,ie),A){const ae=A.length;A.clear();for(let fe=0;fe<ae;fe++)A.emplaceBack(P,B,N,le,re,G,ie)}}function v6(h,o,l){const d=h.node;let p=0;const _=l&Wp.HasMeshoptCompression;for(const y of d.meshes){if(d.lights&&d.lightMeshIndex===p||!y.featureData)continue;y.featureArray=new Ed,y.featureArray.reserve(y.featureData.length);let A=o;for(const S of y.featureData){const I=_?65535&S:S>>16&65535,R=_?S>>16&65535:65535&S,P=(15&R)<8?15&R:0,B=h.evaluatedRMEA[P],N=h.evaluatedColor[P],U=h.emissionHeightBasedParams[P];let j;if(A&&P===2&&d.lights&&(j=new Ed,j.resize(10*d.lights.length)),b6(y.featureArray,I,N,B,U,y.aabb.min[2],y.aabb.max[2],j),j&&A){A=!1;const K=d.meshes[d.lightMeshIndex];K.featureArray=j,K.featureArray._trim()}}y.featureArray._trim(),p++}}function JM(h,o,l,d){const p=1<<h.z;o.lat=Re((d/Dt+h.y)/p),o.lng=Ie((l/Dt+h.x)/p)}Ut(wv,"Tiled3dModelBucket",{omit:["layers"]}),Ut(KM,"Tiled3dModelFeature");const x6={circle:class extends Ws{constructor(h,o,l,d){super(h,{layout:sn||(sn=new or({"circle-sort-key":new Nt(He.layout_circle["circle-sort-key"]),"circle-elevation-reference":new It(He.layout_circle["circle-elevation-reference"]),visibility:new It(He.layout_circle.visibility)})),paint:$n||($n=new or({"circle-radius":new Nt(He.paint_circle["circle-radius"]),"circle-color":new Nt(He.paint_circle["circle-color"]),"circle-blur":new Nt(He.paint_circle["circle-blur"]),"circle-opacity":new Nt(He.paint_circle["circle-opacity"]),"circle-translate":new It(He.paint_circle["circle-translate"]),"circle-translate-anchor":new It(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Nt(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Nt(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Nt(He.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new It(He.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d)}createBucket(h){return new Gt(h)}queryRadius(h){const o=h;return Ei("circle-radius",this,o)+Ei("circle-stroke-width",this,o)+Fn(this.paint.get("circle-translate"))}queryIntersectsFeature(h,o,l,d,p,_,y,A){const S=Ln(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,h.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return dI(h,d,_,y,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(h,o,l){const d=uI(this);return{config:new pc(this,{zoom:o,lut:l}),defines:d,overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ws{createBucket(h){return new pI(h)}constructor(h,o,l,d){super(h,{layout:mI||(mI=new or({visibility:new It(He.layout_heatmap.visibility)})),paint:gI||(gI=new or({"heatmap-radius":new Nt(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Nt(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new sh(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(He.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(h){h==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=u_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(h){return Ei("heatmap-radius",this,h)}queryIntersectsFeature(h,o,l,d,p,_,y,A){const S=this.paint.get("heatmap-radius").evaluate(o,l);return dI(h,d,_,y,A,!0,!0,new ue(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(h,o,l){return h==="heatmap"?{config:new pc(this,{zoom:o,lut:l}),overrideFog:!1}:{}}},hillshade:class extends Ws{constructor(h,o,l,d){super(h,{layout:_I||(_I=new or({visibility:new It(He.layout_hillshade.visibility)})),paint:yI||(yI=new or({"hillshade-illumination-direction":new It(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(He.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new It(He.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(h,o,l){return{overrideFog:!1}}},fill:class extends Ws{constructor(h,o,l,d){super(h,{layout:HI||(HI=new or({"fill-sort-key":new Nt(He.layout_fill["fill-sort-key"]),visibility:new It(He.layout_fill.visibility),"fill-elevation-reference":new It(He.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Nt(He.layout_fill["fill-construct-bridge-guard-rail"])})),paint:WI||(WI=new or({"fill-antialias":new It(He.paint_fill["fill-antialias"]),"fill-opacity":new Nt(He.paint_fill["fill-opacity"]),"fill-color":new Nt(He.paint_fill["fill-color"]),"fill-outline-color":new Nt(He.paint_fill["fill-outline-color"]),"fill-translate":new It(He.paint_fill["fill-translate"]),"fill-translate-anchor":new It(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nt(He.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new It(He.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new It(He.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Nt(He.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Nt(He.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Nt(He.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d)}getProgramIds(){const h=this.paint.get("fill-pattern"),o=h&&h.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(h,o,l){return{config:new pc(this,{zoom:o,lut:l}),overrideFog:!1}}recalculate(h,o){super.recalculate(h,o);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(h){return new MA(h)}queryRadius(){return Fn(this.paint.get("fill-translate"))}queryIntersectsFeature(h,o,l,d,p,_){return!h.queryGeometry.isAboveHorizon&&Oi(Yi(h.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,h.pixelToTileUnitsFactor),d)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(h){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const o=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return h!=null?o&&!h:o}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ws{constructor(h,o,l,d){super(h,{layout:g3||(g3=new or({visibility:new It(He["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new It(He["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:_3||(_3=new or({"fill-extrusion-opacity":new It(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Nt(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nt(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new It(He["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Nt(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Nt(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new It(He["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new It(He["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new It(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new It(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new It(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new It(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new It(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new It(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new It(He["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new It(He["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Nt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Nt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new It(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new It(He["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new It(He["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new It(He["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Nt(He["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Nt(He["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new It(He["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(h){return new Kb(h)}queryRadius(){return Fn(this.paint.get("fill-extrusion-translate"))}is3D(h){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(h,o,l,d,p,_,y,A,S){const I=Ln(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,h.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(o,l),P=this.paint.get("fill-extrusion-base").evaluate(o,l),B=[0,0],N=A&&_.elevation,U=_.elevation?_.elevation.exaggeration():1,j=h.tile.getBucket(this);if(N&&j instanceof Kb){const G=j.centroidVertexArray,ie=S+1;ie<G.length&&(B[0]=G.geta_centroid_pos0(ie),B[1]=G.geta_centroid_pos1(ie))}if(B[0]===0&&B[1]===1)return!1;_.projection.name==="globe"&&(d=m3([d],[new ue(0,0),new ue(Dt,Dt)],h.tileID.canonical).map(G=>G.polygon).flat());const K=N?A:null,[ee,le]=function(G,ie,ae,fe,Ce,Be,Fe,Ve,et,mt,ht){return G.projection.name==="globe"?function(pt,xt,Ke,ft,Ye,Qe,At,Et,Kt,$t,Bt){const wt=[],pi=[],Xt=pt.projection.upVectorScale(Bt,pt.center.lat,pt.worldSize).metersToTile,qt=[0,0,0,1],ui=[0,0,0,1],Ai=(Di,Mi,Ci,vn)=>{Di[0]=Mi,Di[1]=Ci,Di[2]=vn,Di[3]=1},Ti=p3();Ke>0&&(Ke+=Ti),ft+=Ti;for(const Di of xt){const Mi=[],Ci=[];for(const vn of Di){const Rn=vn.x+Ye.x,he=vn.y+Ye.y,pe=pt.projection.projectTilePoint(Rn,he,Bt),tt=pt.projection.upVector(Bt,vn.x,vn.y);let Mt=Ke,Ft=ft;if(At){const Ot=A3(Rn,he,Ke,ft,At,Et,Kt,$t);Mt+=Ot.base,Ft+=Ot.top}Ke!==0?Ai(qt,pe.x+tt[0]*Xt*Mt,pe.y+tt[1]*Xt*Mt,pe.z+tt[2]*Xt*Mt):Ai(qt,pe.x,pe.y,pe.z),Ai(ui,pe.x+tt[0]*Xt*Ft,pe.y+tt[1]*Xt*Ft,pe.z+tt[2]*Xt*Ft),jn(qt,qt,Qe),jn(ui,ui,Qe),Mi.push(new Ld(qt[0],qt[1],qt[2])),Ci.push(new Ld(ui[0],ui[1],ui[2]))}wt.push(Mi),pi.push(Ci)}return[wt,pi]}(G,ie,ae,fe,Ce,Be,Fe,Ve,et,mt,ht):Fe?function(pt,xt,Ke,ft,Ye,Qe,At,Et,Kt){const $t=[],Bt=[],wt=[0,0,0,1];for(const pi of pt){const Xt=[],qt=[];for(const ui of pi){const Ai=ui.x+ft.x,Ti=ui.y+ft.y,Di=A3(Ai,Ti,xt,Ke,Qe,At,Et,Kt);wt[0]=Ai,wt[1]=Ti,wt[2]=Di.base,wt[3]=1,ls(wt,wt,Ye),wt[3]=Math.max(wt[3],1e-5);const Mi=new Ld(wt[0]/wt[3],wt[1]/wt[3],wt[2]/wt[3]);wt[0]=Ai,wt[1]=Ti,wt[2]=Di.top,wt[3]=1,ls(wt,wt,Ye),wt[3]=Math.max(wt[3],1e-5);const Ci=new Ld(wt[0]/wt[3],wt[1]/wt[3],wt[2]/wt[3]);Xt.push(Mi),qt.push(Ci)}$t.push(Xt),Bt.push(qt)}return[$t,Bt]}(ie,ae,fe,Ce,Be,Fe,Ve,et,mt):function(pt,xt,Ke,ft,Ye){const Qe=[],At=[],Et=Ye[8]*xt,Kt=Ye[9]*xt,$t=Ye[10]*xt,Bt=Ye[11]*xt,wt=Ye[8]*Ke,pi=Ye[9]*Ke,Xt=Ye[10]*Ke,qt=Ye[11]*Ke;for(const ui of pt){const Ai=[],Ti=[];for(const Di of ui){const Mi=Di.x+ft.x,Ci=Di.y+ft.y,vn=Ye[0]*Mi+Ye[4]*Ci+Ye[12],Rn=Ye[1]*Mi+Ye[5]*Ci+Ye[13],he=Ye[2]*Mi+Ye[6]*Ci+Ye[14],pe=Ye[3]*Mi+Ye[7]*Ci+Ye[15],tt=vn+Et,Mt=Rn+Kt,Ft=he+$t,Ot=Math.max(pe+Bt,1e-5),Zt=vn+wt,ci=Rn+pi,Ni=he+Xt,Ui=Math.max(pe+qt,1e-5);Ai.push(new Ld(tt/Ot,Mt/Ot,Ft/Ot)),Ti.push(new Ld(Zt/Ui,ci/Ui,Ni/Ui))}Qe.push(Ai),At.push(Ti)}return[Qe,At]}(ie,ae,fe,Ce,Be)}(_,d,P,R,I,y,K,B,U,_.center.lat,h.tileID.canonical),re=h.queryGeometry;return function(G,ie,ae){let fe=1/0;Oi(ae,ie)&&(fe=w3(ae,ie[0]));for(let Ce=0;Ce<ie.length;Ce++){const Be=ie[Ce],Fe=G[Ce];for(let Ve=0;Ve<Be.length-1;Ve++){const et=Be[Ve],mt=[et,Be[Ve+1],Fe[Ve+1],Fe[Ve],et];ai(ae,mt)&&(fe=Math.min(fe,w3(ae,mt)))}}return fe!==1/0&&fe}(ee,le,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends Ws{constructor(h,o,l,d){const p=D3();super(h,p,o,l,d),p.layout&&(this.layout=new rh(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(h){if(h==="line-gradient"){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof hd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(h,o){super.recalculate(h,o),this.paint._values["line-floorwidth"]=(()=>{if(x_)return x_;const l=D3();return x_=new x5(l.paint.properties["line-width"].specification),x_.useIntegerZoom=!0,x_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,h)}createBucket(h){return new FA(h)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(h,o,l){const d=k3(this);return{config:new pc(this,{zoom:o,lut:l}),defines:d,overrideFog:!1}}queryRadius(h){const o=h,l=B3(Ei("line-width",this,o),Ei("line-gap-width",this,o)),d=Ei("line-offset",this,o);return l/2+Math.abs(d)+Fn(this.paint.get("line-translate"))}queryIntersectsFeature(h,o,l,d,p,_){if(h.queryGeometry.isAboveHorizon)return!1;const y=Yi(h.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,h.pixelToTileUnitsFactor),A=h.pixelToTileUnitsFactor/2*B3(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),S=this.paint.get("line-offset").evaluate(o,l);return S&&(d=function(I,R){const P=[],B=new ue(0,0);for(let N=0;N<I.length;N++){const U=I[N],j=[];for(let K=0;K<U.length;K++){const ee=U[K],le=U[K+1],re=K===0?B:ee.sub(U[K-1])._unit()._perp(),G=K===U.length-1?B:le.sub(ee)._unit()._perp(),ie=re._add(G)._unit();ie._mult(1/(ie.x*G.x+ie.y*G.y)),j.push(ie._mult(R)._add(ee))}P.push(j)}return P}(d,S*h.pixelToTileUnitsFactor)),function(I,R,P){for(let B=0;B<R.length;B++){const N=R[B];if(I.length>=3){for(let U=0;U<N.length;U++)if(gn(I,N[U]))return!0}if(mn(I,N,P))return!0}return!1}(y,d,A)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(h){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:pv,background:class extends Ws{constructor(h,o,l,d){super(h,{layout:TM||(TM=new or({visibility:new It(He.layout_background.visibility)})),paint:SM||(SM=new or({"background-pitch-alignment":new It(He.paint_background["background-pitch-alignment"]),"background-color":new It(He.paint_background["background-color"]),"background-pattern":new It(He.paint_background["background-pattern"]),"background-opacity":new It(He.paint_background["background-opacity"]),"background-emissive-strength":new It(He.paint_background["background-emissive-strength"]),"background-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(h,o,l){return{overrideFog:!1}}is3D(h){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:RM,"raster-particle":FM,sky:class extends Ws{constructor(h,o,l,d){super(h,{layout:DM||(DM=new or({visibility:new It(He.layout_sky.visibility)})),paint:BM||(BM=new or({"sky-type":new It(He.paint_sky["sky-type"]),"sky-atmosphere-sun":new It(He.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new It(He.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new It(He.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new It(He.paint_sky["sky-gradient-radius"]),"sky-gradient":new sh(He.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new It(He.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new It(He.paint_sky["sky-atmosphere-color"]),"sky-opacity":new It(He.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(h){h==="sky-gradient"?this._updateColorRamp():h!=="sky-atmosphere-sun"&&h!=="sky-atmosphere-halo-color"&&h!=="sky-atmosphere-color"&&h!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=u_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(h){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=h.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(h,o){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),p=!d,_=h.style.light,y=_.properties.get("position");return p&&_.properties.get("anchor")==="viewport"&&Bi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?sT(y.azimuthal,90-y.polar,o):sT(d[0],90-d[1],o)}const l=this.paint.get("sky-gradient-center");return sT(l[0],90-l[1],o)}isSky(){return!0}markSkyboxValid(h){this._skyboxInvalidated=!1,this._lightPosition=h.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const h=this.paint.get("sky-type");return h==="atmosphere"?["skyboxCapture","skybox"]:h==="gradient"?["skyboxGradient"]:null}},slot:class extends Ws{constructor(h,o,l,d){super(h,{paint:OM||(OM=new or({}))},o,null)}},model:class extends Ws{constructor(h,o,l,d){super(h,{layout:WM||(WM=new or({visibility:new It(He.layout_model.visibility),"model-id":new Nt(He.layout_model["model-id"])})),paint:GM||(GM=new or({"model-opacity":new Nt(He.paint_model["model-opacity"]),"model-rotation":new Nt(He.paint_model["model-rotation"]),"model-scale":new Nt(He.paint_model["model-scale"]),"model-translation":new Nt(He.paint_model["model-translation"]),"model-color":new Nt(He.paint_model["model-color"]),"model-color-mix-intensity":new Nt(He.paint_model["model-color-mix-intensity"]),"model-type":new It(He.paint_model["model-type"]),"model-cast-shadows":new It(He.paint_model["model-cast-shadows"]),"model-receive-shadows":new It(He.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new It(He.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Nt(He.paint_model["model-emissive-strength"]),"model-roughness":new Nt(He.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Nt(He.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new It(He.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new It(He.paint_model["model-front-cutoff"]),"model-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(h){return new cT(h)}getProgramIds(){return["model"]}is3D(h){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(h){return h instanceof wv?Dt-1:0}queryIntersectsFeature(h,o,l,d,p,_){if(!this.modelManager)return!1;const y=this.modelManager,A=h.tile.getBucket(this);if(!(A&&A instanceof cT))return!1;for(const S in A.instancesPerModel){const I=A.instancesPerModel[S],R=o.id!==void 0?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(I.idToFeaturesIndex.hasOwnProperty(R)){const P=I.features[I.idToFeaturesIndex[R]],B=y.getModel(S,this.scope);if(!B)return!1;let N=X();const U=new Z(0,0),j=A.canonical;let K=Number.MAX_VALUE;for(let ee=0;ee<P.instancedDataCount;++ee){const le=16*(P.instancedDataOffset+ee),re=I.instancedDataArray.float32,G=[re[le+4],re[le+5],re[le+6]];JM(j,U,re[le],0|re[le+1]),XM(N,B,_,U,P.rotation,P.scale,G,!1,!1,!1),_.projection.name==="globe"&&(N=aT(N,_));const ie=_e([],_.projMatrix,N),ae=h.queryGeometry,fe=VM(ae.isPointQuery()?ae.screenBounds:ae.screenGeometry,_,ie,B.aabb);fe!=null&&(K=Math.min(fe,K))}return K!==Number.MAX_VALUE&&K}}return!1}_handleOverridablePaintPropertyUpdate(h,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven()||h!=="model-color"&&h!=="model-color-mix-intensity"&&h!=="model-rotation"&&h!=="model-scale"&&h!=="model-translation"&&h!=="model-emissive-strength")}_isPropertyZoomDependent(h){const o=this._transitionablePaint._values[h];return o!=null&&o.value!=null&&o.value.expression!=null&&o.value.expression instanceof Kh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ws{constructor(h,o,l,d){super(h,{layout:GI||(GI=new or({"clip-layer-types":new It(He.layout_clip["clip-layer-types"]),"clip-layer-scope":new It(He.layout_clip["clip-layer-scope"])})),paint:XI||(XI=new or({}))},o,l,d)}recalculate(h,o){super.recalculate(h,o)}createBucket(h){return new qI(h)}is3D(h){return!0}}};class w6{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class A6{constructor(){this.tasks={},this.taskQueue=[],gi(["process"],this),this.invoker=new w6(this.process),this.nextId=0}add(o,l){const d=this.nextId++,p=function({type:_,isSymbolTile:y,zoom:A}){return A=A||0,_==="message"?0:_!=="maybePrepare"||y?_!=="parseTile"||y?_==="parseTile"&&y?300-A:_==="maybePrepare"&&y?400-A:500:200-A:100-A}(l);if(p===0){try{o()}finally{}return null}return this.tasks[d]={fn:o,metadata:l,priority:p,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const o=this.pick();if(o===null)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const _=this.tasks[this.taskQueue[p]];_.priority<l&&(l=_.priority,o=p)}if(o===null)return null;const d=this.taskQueue[o];return this.taskQueue.splice(o,1),d}remove(){this.invoker.remove()}}class QM{constructor(o,l,d){this.target=o,this.parent=l,this.mapId=d,this.callbacks={},this.cancelCallbacks={},gi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new A6}send(o,l,d,p,_=!1,y){const A=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=y,this.callbacks[A]=d);const S=new Set;return this.target.postMessage({id:A,type:o,hasCallback:!!d,targetMapId:p,mustQueue:_,sourceMapId:this.mapId,data:ac(l,S)},S),{cancel:()=>{d&&delete this.callbacks[A],this.target.postMessage({id:A,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(o){const l=o.data;if(!l)return;const d=l.id;if(d&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const p=this.cancelCallbacks[d];delete this.cancelCallbacks[d],p&&p.cancel()}else if(l.mustQueue||In(self)){const p=this.callbacks[d],_=this.scheduler.add(()=>this.processTask(d,l),p&&p.metadata||{type:"message"});_&&(this.cancelCallbacks[d]=_)}else this.processTask(d,l)}processTask(o,l){if(delete this.cancelCallbacks[o],l.type==="<response>"){const d=this.callbacks[o];delete this.callbacks[o],d&&(l.error?d(lc(l.error)):d(null,lc(l.data)))}else{const d=new Set,p=l.hasCallback?(y,A)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:y?ac(y):null,data:ac(A,d)},d)}:()=>{},_=lc(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,_,p);else if(this.parent.getWorkerSource){const y=l.type.split("."),{source:A,scope:S}=_;this.parent.getWorkerSource(l.sourceMapId,y[0],A,S)[y[1]](_,p)}else p(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var B_={workerUrl:"",workerClass:null,workerParams:void 0};const fT="mapboxgl_preloaded_worker_pool";class $d{constructor(){this.active={}}acquire(o,l=$d.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<l;)this.workers.push(B_.workerClass!=null?new B_.workerClass:new self.Worker(B_.workerUrl,B_.workerParams));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fT]}numActive(){return Object.keys(this.active).length}}$d.workerCount=2;class Xp{constructor(o,l,d="Worker",p=$d.workerCount){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=zt();const _=this.workerPool.acquire(this.id,p);for(let y=0;y<_.length;y++){const A=new Xp.Actor(_[y],l,this.id);A.name=`${d} ${y}`,this.actors.push(A)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,l,d){nt(this.actors,(p,_)=>{p.send(o,l,_)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}let O_,pT;function Av(){return O_||(O_=new $d),O_}Xp.Actor=QM;const mT=new rn(0,0,0),gT={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},_T={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Tv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},T6={PAINT_ORDER_FILL_AND_STROKE:1},F_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},eR={MASK_TYPE_LUMINANCE:1};function S6(h,o,l){h===1&&o.icons.push(function(d,p){return function(_){if(_.usvg_tree.height||(_.usvg_tree.height=_.usvg_tree.width),!_.metadata)return _;const{metadata:y}=_;if(y.content_area){const{content_area:A}=y;A.top==null&&(A.top=A.left),A.width==null&&(A.width=_.usvg_tree.width),A.height==null&&(A.height=A.width)}return y.stretch_x&&y.stretch_x.length&&tR(y,"x"),y.stretch_y&&y.stretch_y.length&&tR(y,"y"),_}(d.readFields(E6,{name:void 0},p))}(l,l.readVarint()+l.pos))}function tR(h,o){const l=[],d=h[`stretch_${o}`];let p=null;for(let _=0;_<d.length;_++)p===null?p=l.length===0?d[0]:l[l.length-1][1]+d[_]:(l.push([p,p+d[_]]),p=null);h[`stretch_${o}_areas`]=l}function E6(h,o,l){h===1?o.name=l.readString():h===2?o.metadata=function(d,p){return d.readFields(C6,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(l,l.readVarint()+l.pos):h===3&&(o.usvg_tree=function(d,p){return d.readFields(R6,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(l,l.readVarint()+l.pos),o.data="usvg_tree")}function C6(h,o,l){h===1?o.stretch_x=l.readPackedVarint():h===2?o.stretch_y=l.readPackedVarint():h===3?o.content_area=function(d,p){return d.readFields(I6,{left:0},p)}(l,l.readVarint()+l.pos):h===4&&o.variables.push(function(d,p){return d.readFields(M6,{name:void 0},p)}(l,l.readVarint()+l.pos))}function I6(h,o,l){h===1?o.left=l.readVarint():h===2?o.width=l.readVarint():h===3?o.top=l.readVarint():h===4&&(o.height=l.readVarint())}function M6(h,o,l){h===1?o.name=l.readString():h===2&&(o.rgb_color=Cv(l.readVarint()),o.value="rgb_color")}function R6(h,o,l){h===1?o.width=o.height=l.readVarint():h===2?o.height=l.readVarint():h===3?o.children.push(Sv(l,l.readVarint()+l.pos)):h===4?o.linear_gradients.push(function(d,p){return d.readFields(L6,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(l,l.readVarint()+l.pos)):h===5?o.radial_gradients.push(function(d,p){return d.readFields(N6,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(l,l.readVarint()+l.pos)):h===7?o.clip_paths.push(function(d,p){return d.readFields(U6,{children:[]},p)}(l,l.readVarint()+l.pos)):h===8&&o.masks.push(function(d,p){const _=d.readFields(V6,{left:0,width:20,mask_type:eR.MASK_TYPE_LUMINANCE,children:[]},p);return _.height==null&&(_.height=_.width),_.top==null&&(_.top=_.left),_}(l,l.readVarint()+l.pos))}function Sv(h,o){return h.readFields(k6,{},o)}function k6(h,o,l){h===1?(o.group=function(d,p){return d.readFields(P6,{opacity:255,children:[]},p)}(l,l.readVarint()+l.pos),o.node="group"):h===2&&(o.path=function(d,p){return d.readFields(B6,{paint_order:1,commands:[],step:1,diffs:[],rule:gT.PATH_RULE_NON_ZERO},p)}(l,l.readVarint()+l.pos),o.node="path")}function P6(h,o,l){h===1?o.transform=Ev(l,l.readVarint()+l.pos):h===2?o.opacity=l.readVarint():h===5?o.clip_path_idx=l.readVarint():h===6?o.mask_idx=l.readVarint():h===7&&o.children.push(Sv(l,l.readVarint()+l.pos))}function Ev(h,o){return h.readFields(D6,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},o)}function D6(h,o,l){h===1?o.sx=l.readFloat():h===2?o.ky=l.readFloat():h===3?o.kx=l.readFloat():h===4?o.sy=l.readFloat():h===5?o.tx=l.readFloat():h===6&&(o.ty=l.readFloat())}function B6(h,o,l){h===1?o.fill=function(d,p){return d.readFields(O6,{rgb_color:mT,paint:"rgb_color",opacity:255},p)}(l,l.readVarint()+l.pos):h===2?o.stroke=function(d,p){return d.readFields(F6,{rgb_color:mT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(l,l.readVarint()+l.pos):h===3?o.paint_order=l.readVarint():h===5?l.readPackedVarint(o.commands):h===6?o.step=l.readFloat():h===7?l.readPackedSVarint(o.diffs):h===8&&(o.rule=l.readVarint())}function O6(h,o,l){h===1?(o.rgb_color=Cv(l.readVarint()),o.paint="rgb_color"):h===2?(o.linear_gradient_idx=l.readVarint(),o.paint="linear_gradient_idx"):h===3?(o.radial_gradient_idx=l.readVarint(),o.paint="radial_gradient_idx"):h===5&&(o.opacity=l.readVarint())}function Cv(h){return new rn((h>>16&255)/255,(h>>8&255)/255,(255&h)/255,1)}function F6(h,o,l){h===1?(o.rgb_color=Cv(l.readVarint()),o.paint="rgb_color"):h===2?(o.linear_gradient_idx=l.readVarint(),o.paint="linear_gradient_idx"):h===3?(o.radial_gradient_idx=l.readVarint(),o.paint="radial_gradient_idx"):h===5?l.readPackedFloat(o.dasharray):h===6?o.dashoffset=l.readFloat():h===7?o.miterlimit=l.readFloat():h===8?o.opacity=l.readVarint():h===9?o.width=l.readFloat():h===10?o.linecap=l.readVarint():h===11&&(o.linejoin=l.readVarint())}function L6(h,o,l){h===1?o.transform=Ev(l,l.readVarint()+l.pos):h===2?o.spread_method=l.readVarint():h===3?o.stops.push(iR(l,l.readVarint()+l.pos)):h===4?o.x1=l.readFloat():h===5?o.y1=l.readFloat():h===6?o.x2=l.readFloat():h===7&&(o.y2=l.readFloat())}function iR(h,o){return h.readFields(z6,{offset:0,opacity:255,rgb_color:mT},o)}function z6(h,o,l){h===1?o.offset=l.readFloat():h===2?o.opacity=l.readVarint():h===3&&(o.rgb_color=Cv(l.readVarint()))}function N6(h,o,l){h===1?o.transform=Ev(l,l.readVarint()+l.pos):h===2?o.spread_method=l.readVarint():h===3?o.stops.push(iR(l,l.readVarint()+l.pos)):h===4?o.cx=l.readFloat():h===5?o.cy=l.readFloat():h===6?o.r=l.readFloat():h===7?o.fx=l.readFloat():h===8?o.fy=l.readFloat():h===9&&(o.fr=l.readFloat())}function U6(h,o,l){h===1?o.transform=Ev(l,l.readVarint()+l.pos):h===2?o.clip_path_idx=l.readVarint():h===3&&o.children.push(Sv(l,l.readVarint()+l.pos))}function V6(h,o,l){h===1?o.left=o.top=l.readFloat():h===2?o.width=o.height=l.readFloat():h===3?o.top=l.readFloat():h===4?o.height=l.readFloat():h===5?o.mask_type=l.readVarint():h===6?o.mask_idx=l.readVarint():h===7&&o.children.push(Sv(l,l.readVarint()+l.pos))}class $6{static calculate(o={},l=[]){const d=new Map,p=new Map;if(Object.keys(o).length===0)return d;l.forEach(_=>{p.set(_.name,_.rgb_color||new rn(0,0,0))});for(const[_,y]of Object.entries(o))p.has(_)?d.set(p.get(_).toStringPremultipliedAlpha(),y):console.warn(`Ignoring unknown image variable "${_}"`);return d}}function qp(h,o=255,l){const d=o/255,p=h.toStringPremultipliedAlpha(),_=l.has(p)?l.get(p).clone():h.clone();return _.a*=d,_.toString()}function L_(h,o){if(!ig()){const l=document.createElement("canvas");return l.width=h,l.height=o,l}return new OffscreenCanvas(h,o)}function j6(h,o){const l=$6.calculate(o.params,h.metadata?h.metadata.variables:[]),d=h.usvg_tree,p=d.width,_=d.height,y=o.transform?o.transform:new DOMMatrix,A=Math.max(1,Math.round(p*y.a)),S=Math.max(1,Math.round(_*y.d)),I=new DOMMatrix([A/p,0,0,S/_,0,0]),R=L_(A,S).getContext("2d");return yT(R,I,d,d,l),R.getImageData(0,0,A,S)}function yT(h,o,l,d,p){for(const _ of d.children)nR(h,o,l,_,p)}function nR(h,o,l,d,p){d.group?(h.save(),function(_,y,A,S,I){const R=S.mask_idx!=null?A.masks[S.mask_idx]:null,P=S.clip_path_idx!=null?A.clip_paths[S.clip_path_idx]:null;if(S.transform&&(y=Iv(S.transform).preMultiplySelf(y)),!function(U,j,K){return U.opacity!==255||j||K}(S,P!=null,R!=null))return void yT(_,y,A,S,I);const B=L_(_.canvas.width,_.canvas.height),N=B.getContext("2d");yT(N,y,A,S,I),P&&hR(N,y,A,P),R&&uR(N,y,A,R,I),_.globalAlpha=S.opacity/255,_.drawImage(B,0,0)}(h,o,l,d.group,p),h.restore()):d.path&&(h.save(),function(_,y,A,S,I){const R=dR(S);_.setTransform(y),S.paint_order===T6.PAINT_ORDER_FILL_AND_STROKE?(rR(_,A,S,R,I),oR(_,A,S,R,I)):(oR(_,A,S,R,I),rR(_,A,S,R,I))}(h,o,l,d.path,p),h.restore())}function rR(h,o,l,d,p){const _=l.fill;if(!_)return;const y=_.opacity/255;switch(_.paint){case"rgb_color":h.fillStyle=qp(_.rgb_color,_.opacity,p);break;case"linear_gradient_idx":h.fillStyle=aR(h,o.linear_gradients[_.linear_gradient_idx],y,p);break;case"radial_gradient_idx":h.fillStyle=lR(h,o.radial_gradients[_.radial_gradient_idx],y,p)}h.fill(d,sR(l))}function sR(h){return h.rule===gT.PATH_RULE_NON_ZERO?"nonzero":h.rule===gT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function oR(h,o,l,d,p){const _=l.stroke;if(!_)return;h.lineWidth=_.width,h.miterLimit=_.miterlimit,h.setLineDash(_.dasharray),h.lineDashOffset=_.dashoffset;const y=_.opacity/255;switch(_.paint){case"rgb_color":h.strokeStyle=qp(_.rgb_color,_.opacity,p);break;case"linear_gradient_idx":h.strokeStyle=aR(h,o.linear_gradients[_.linear_gradient_idx],y,p);break;case"radial_gradient_idx":h.strokeStyle=lR(h,o.radial_gradients[_.radial_gradient_idx],y,p)}switch(_.linejoin){case Tv.LINE_JOIN_MITER_CLIP:case Tv.LINE_JOIN_MITER:h.lineJoin="miter";break;case Tv.LINE_JOIN_ROUND:h.lineJoin="round";break;case Tv.LINE_JOIN_BEVEL:h.lineJoin="bevel"}switch(_.linecap){case _T.LINE_CAP_BUTT:h.lineCap="butt";break;case _T.LINE_CAP_ROUND:h.lineCap="round";break;case _T.LINE_CAP_SQUARE:h.lineCap="square"}h.stroke(d)}function aR(h,o,l,d){if(o.stops.length===1){const B=o.stops[0];return qp(B.rgb_color,B.opacity*l,d)}const p=Iv(o.transform),{x1:_,y1:y,x2:A,y2:S}=o,I=p.transformPoint(new DOMPoint(_,y)),R=p.transformPoint(new DOMPoint(A,S)),P=h.createLinearGradient(I.x,I.y,R.x,R.y);for(const B of o.stops)P.addColorStop(B.offset,qp(B.rgb_color,B.opacity*l,d));return P}function lR(h,o,l,d){if(o.stops.length===1){const B=o.stops[0];return qp(B.rgb_color,B.opacity*l,d)}const p=Iv(o.transform),{fx:_,fy:y,cx:A,cy:S}=o,I=p.transformPoint(new DOMPoint(_,y)),R=p.transformPoint(new DOMPoint(A,S)),P=h.createRadialGradient(I.x,I.y,0,R.x,R.y,o.r*((p.a+p.d)/2));for(const B of o.stops)P.addColorStop(B.offset,qp(B.rgb_color,B.opacity*l,d));return P}function cR(h,o,l,d){const p=d.transform?Iv(d.transform).preMultiplySelf(o):o,_=L_(h.canvas.width,h.canvas.height),y=_.getContext("2d");for(const S of d.children)if(S.group)cR(y,p,l,S.group);else if(S.path){const I=S.path,R=new Path2D;R.addPath(dR(I),p),y.fill(R,sR(I))}const A=d.clip_path_idx!=null?l.clip_paths[d.clip_path_idx]:null;A&&hR(y,p,l,A),h.globalCompositeOperation="source-over",h.drawImage(_,0,0)}function hR(h,o,l,d){const p=L_(h.canvas.width,h.canvas.height);cR(p.getContext("2d"),o,l,d),h.globalCompositeOperation="destination-in",h.drawImage(p,0,0)}function uR(h,o,l,d,p){if(d.children.length===0)return;const _=d.mask_idx!=null?l.masks[d.mask_idx]:null;_&&uR(h,o,l,_,p);const y=h.canvas.width,A=h.canvas.height,S=L_(y,A),I=S.getContext("2d"),R=d.width,P=d.height,B=d.left,N=d.top,U=new Path2D,j=new Path2D;j.rect(B,N,R,P),U.addPath(j,o),I.clip(U);for(const le of d.children)nR(I,o,l,le,p);const K=I.getImageData(0,0,y,A),ee=K.data;if(d.mask_type===eR.MASK_TYPE_LUMINANCE)for(let le=0;le<ee.length;le+=4)ee[le+3]=ee[le+3]/255*(.2126*ee[le]+.7152*ee[le+1]+.0722*ee[le+2]);I.putImageData(K,0,0),h.globalCompositeOperation="destination-in",h.drawImage(S,0,0)}function Iv(h){return h?new DOMMatrix([h.sx,h.ky,h.kx,h.sy,h.tx,h.ty]):new DOMMatrix}function dR(h){const o=new Path2D,l=h.step;let d=h.diffs[0]*l,p=h.diffs[1]*l;o.moveTo(d,p);for(let _=0,y=2;_<h.commands.length;_++)switch(h.commands[_]){case F_.PATH_COMMAND_MOVE:d+=h.diffs[y++]*l,p+=h.diffs[y++]*l,o.moveTo(d,p);break;case F_.PATH_COMMAND_LINE:d+=h.diffs[y++]*l,p+=h.diffs[y++]*l,o.lineTo(d,p);break;case F_.PATH_COMMAND_QUAD:{const A=d+h.diffs[y++]*l,S=p+h.diffs[y++]*l;d=A+h.diffs[y++]*l,p=S+h.diffs[y++]*l,o.quadraticCurveTo(A,S,d,p);break}case F_.PATH_COMMAND_CUBIC:{const A=d+h.diffs[y++]*l,S=p+h.diffs[y++]*l,I=A+h.diffs[y++]*l,R=S+h.diffs[y++]*l;d=I+h.diffs[y++]*l,p=R+h.diffs[y++]*l,o.bezierCurveTo(A,S,I,R,d,p);break}case F_.PATH_COMMAND_CLOSE:o.closePath()}return o}class Mv{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const l=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,l),l}put(o,l){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,l)}delete(o){this.cache.delete(o)}}Ut(Mv,"LRUCache");class bT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(o){return new ys(o,o.data)}getFromCache(o,l,d){return this.cacheMap.has(d)||this.cacheMap.set(d,new Mv(150)),this.cacheMap.get(d).get(oh(o.toString(),l))}setInCache(o,l,d,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new Mv(150));const _=this.cacheDependenciesMap.get(p),y=oh(o.id.toString(),d);_.get(y)||_.set(y,new Set);const A=this.cacheMap.get(p),S=o.toString();_.get(y).add(S),A.put(oh(o.toString(),d),l)}removeImagesFromCacheByIds(o,l,d=0){if(!this.cacheMap.has(d)||!this.cacheDependenciesMap.has(d))return;const p=this.cacheMap.get(d),_=this.cacheDependenciesMap.get(d);for(const y of o){const A=oh(y.toString(),l);if(_.has(A)){for(const S of _.get(A))p.delete(S);_.delete(A)}}}rasterize(o,l,d,p,_=j6){const y=this.getFromCache(o,d,p);if(y)return y.clone();const A=_(l.icon,o.options),S=bT._getImage(A);return this.setInCache(o,S,d,p),S.clone()}}class fR{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const d=this.toIdx(o,l);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function pR(h,o,l,d){let p=0,_=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(d[y])<1e-15){if(l[y]<h[y]||l[y]>o[y])return null}else{const A=1/d[y];let S=(h[y]-l[y])*A,I=(o[y]-l[y])*A;if(S>I){const R=S;S=I,I=R}if(S>p&&(p=S),I<_&&(_=I),p>_)return null}return p}function mR(h,o,l,d,p,_,y,A,S,I,R){const P=d-h,B=p-o,N=_-l,U=y-h,j=A-o,K=S-l,ee=R[1]*K-R[2]*j,le=R[2]*U-R[0]*K,re=R[0]*j-R[1]*U,G=P*ee+B*le+N*re;if(Math.abs(G)<1e-15)return null;const ie=1/G,ae=I[0]-h,fe=I[1]-o,Ce=I[2]-l,Be=(ae*ee+fe*le+Ce*re)*ie;if(Be<0||Be>1)return null;const Fe=fe*N-Ce*B,Ve=Ce*P-ae*N,et=ae*B-fe*P,mt=(R[0]*Fe+R[1]*Ve+R[2]*et)*ie;return mt<0||Be+mt>1?null:(U*Fe+j*Ve+K*et)*ie}function gR(h,o,l){return(h-o)/(l-o)}function _R(h,o,l,d,p,_,y,A,S){const I=1<<l,R=_-d,P=y-p,B=(h+1)/I*R+d,N=(o+0)/I*P+p,U=(o+1)/I*P+p;A[0]=(h+0)/I*R+d,A[1]=N,S[0]=B,S[1]=U}class yR{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(_){const y=Math.ceil(Math.log2(_.dim/8)),A=[];let S=Math.ceil(Math.pow(2,y));const I=1/S,R=(N,U,j,K,ee)=>{const le=K?1:0,re=(N+1)*j-le,G=U*j,ie=(U+1)*j-le;ee[0]=N*j,ee[1]=G,ee[2]=re,ee[3]=ie};let P=new fR(S);const B=[];for(let N=0;N<S*S;N++){R(N%S,Math.floor(N/S),I,!1,B);const U=yu(B[0],B[1],_),j=yu(B[2],B[1],_),K=yu(B[2],B[3],_),ee=yu(B[0],B[3],_);P.minimums.push(Math.min(U,j,K,ee)),P.maximums.push(Math.max(U,j,K,ee)),P.leaves.push(1)}for(A.push(P),S/=2;S>=1;S/=2){const N=A[A.length-1];P=new fR(S);for(let U=0;U<S*S;U++){R(U%S,Math.floor(U/S),2,!0,B);const j=N.getElevation(B[0],B[1]),K=N.getElevation(B[2],B[1]),ee=N.getElevation(B[2],B[3]),le=N.getElevation(B[0],B[3]),re=N.isLeaf(B[0],B[1]),G=N.isLeaf(B[2],B[1]),ie=N.isLeaf(B[2],B[3]),ae=N.isLeaf(B[0],B[3]),fe=Math.min(j.min,K.min,ee.min,le.min),Ce=Math.max(j.max,K.max,ee.max,le.max),Be=re&&G&&ie&&ae;P.maximums.push(Ce),P.minimums.push(fe),P.leaves.push(Ce-fe<=5&&Be?1:0)}A.push(P)}return A}(this.dem),d=l.length-1,p=l[d];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,d,0)}raycastRoot(o,l,d,p,_,y,A=1){return pR([o,l,-100],[d,p,this.maximums[0]*A],_,y)}raycast(o,l,d,p,_,y,A=1){if(!this.nodeCount)return null;const S=this.raycastRoot(o,l,d,p,_,y,A);if(S==null)return null;const I=[],R=[],P=[],B=[],N=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:U,t:j,nodex:K,nodey:ee,depth:le}=N.pop();if(this.leaves[U]){_R(K,ee,le,o,l,d,p,P,B);const G=1<<le,ie=(K+0)/G,ae=(K+1)/G,fe=(ee+0)/G,Ce=(ee+1)/G,Be=yu(ie,fe,this.dem)*A,Fe=yu(ae,fe,this.dem)*A,Ve=yu(ae,Ce,this.dem)*A,et=yu(ie,Ce,this.dem)*A,mt=mR(P[0],P[1],Be,B[0],P[1],Fe,B[0],B[1],Ve,_,y),ht=mR(B[0],B[1],Ve,P[0],B[1],et,P[0],P[1],Be,_,y),pt=Math.min(mt!==null?mt:Number.MAX_VALUE,ht!==null?ht:Number.MAX_VALUE);if(pt!==Number.MAX_VALUE)return pt;{const xt=Gr([],_,y,j);if(bR(Be,Fe,et,Ve,gR(xt[0],P[0],B[0]),gR(xt[1],P[1],B[1]))>=xt[2])return j}continue}let re=0;for(let G=0;G<this._siblingOffset.length;G++){_R((K<<1)+this._siblingOffset[G][0],(ee<<1)+this._siblingOffset[G][1],le+1,o,l,d,p,P,B),P[2]=-100,B[2]=this.maximums[this.childOffsets[U]+G]*A;const ie=pR(P,B,_,y);if(ie!=null){const ae=ie;I[G]=ae;let fe=!1;for(let Ce=0;Ce<re&&!fe;Ce++)ae>=I[R[Ce]]&&(R.splice(Ce,0,G),fe=!0);fe||(R[re]=G),re++}}for(let G=0;G<re;G++){const ie=R[G];N.push({idx:this.childOffsets[U]+ie,t:I[ie],nodex:(K<<1)+this._siblingOffset[ie][0],nodey:(ee<<1)+this._siblingOffset[ie][1],depth:le+1})}}return null}_addNode(o,l,d){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,d,p,_){if(o[p].isLeaf(l,d)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const y=p-1,A=o[y];let S=0,I=0;for(let R=0;R<this._siblingOffset.length;R++){const P=2*l+this._siblingOffset[R][0],B=2*d+this._siblingOffset[R][1],N=A.getElevation(P,B),U=A.isLeaf(P,B),j=this._addNode(N.min,N.max,U);U&&(S|=1<<R),I||(I=j)}for(let R=0;R<this._siblingOffset.length;R++)S&1<<R||this._construct(o,2*l+this._siblingOffset[R][0],2*d+this._siblingOffset[R][1],y,I+R)}}function bR(h,o,l,d,p,_){return ri(ri(h,l,_),ri(o,d,_),p)}function yu(h,o,l){const d=l.dim,p=De(h*d-.5,0,d-1),_=De(o*d-.5,0,d-1),y=Math.floor(p),A=Math.floor(_),S=Math.min(y+1,d-1),I=Math.min(A+1,d-1);return bR(l.get(y,A),l.get(S,A),l.get(y,I),l.get(S,I),p-y,_-A)}const H6={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function W6(h,o,l){return(256*h*256+256*o+l)/10-1e4}function G6(h,o,l){return 256*h+o+l/256-32768}class Rv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,d,p=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void Bi(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const _=this.dim=l.height-2,y=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let S=0;S<_;S++)y[this._idx(-1,S)]=y[this._idx(0,S)],y[this._idx(_,S)]=y[this._idx(_-1,S)],y[this._idx(S,-1)]=y[this._idx(S,0)],y[this._idx(S,_)]=y[this._idx(S,_-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(_,-1)]=y[this._idx(_-1,0)],y[this._idx(-1,_)]=y[this._idx(0,_-1)],y[this._idx(_,_)]=y[this._idx(_-1,_-1)]}const A=d==="terrarium"?G6:W6;for(let S=0;S<y.length;++S){const I=4*S;this.floatView[S]=A(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=da.now()}_buildQuadTree(){this._tree=new yR(this)}get(o,l,d=!1){d&&(o=De(o,-1,this.dim),l=De(l,-1,this.dim));const p=this._idx(o,l);return this.floatView[p]}set(o,l,d){const p=this._idx(o,l),_=this.floatView[p];return this.floatView[p]=d,d-_}static getUnpackVector(o){return H6[o]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const d=[0,0,0,0],p=Rv.getUnpackVector(l);let _=Math.floor((o+p[3])/p[2]);return d[2]=_%256,_=Math.floor(_/256),d[1]=_%256,_=Math.floor(_/256),d[0]=_,d}getPixels(){return new xI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,d){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,_=l*this.dim+this.dim,y=d*this.dim,A=d*this.dim+this.dim;switch(l){case-1:p=_-1;break;case 1:_=p+1}switch(d){case-1:y=A-1;break;case 1:A=y+1}const S=-l*this.dim,I=-d*this.dim;for(let R=y;R<A;R++)for(let P=p;P<_;P++){const B=4*this._idx(P,R),N=4*this._idx(P+S,R+I);this.pixels[B+0]=o.pixels[N+0],this.pixels[B+1]=o.pixels[N+1],this.pixels[B+2]=o.pixels[N+2],this.pixels[B+3]=o.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function X6(h,o,l){h===1?o.headerLength=l.readFixed32():h===2?o.x=l.readVarint():h===3?o.y=l.readVarint():h===4?o.z=l.readVarint():h===5&&o.layers.push(function(d,p){return d.readFields(J6,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(l,l.readVarint()+l.pos))}function q6(h,o,l){h===1?(o.delta_filter=function(d,p){return d.readFields(Y6,{blockSize:0},p)}(l,l.readVarint()+l.pos),o.filter="delta_filter"):h===2?(l.readVarint(),o.filter="zigzag_filter"):h===3?(l.readVarint(),o.filter="bitshuffle_filter"):h===4&&(l.readVarint(),o.filter="byteshuffle_filter")}function Y6(h,o,l){h===1&&(o.blockSize=l.readVarint())}function Z6(h,o,l){h===1?(l.readVarint(),o.codec="gzip_data"):h===2?(l.readVarint(),o.codec="jpeg_image"):h===3?(l.readVarint(),o.codec="webp_image"):h===4&&(l.readVarint(),o.codec="png_image")}function K6(h,o,l){let d=0,p=0;h===1?o.firstByte=l.readFixed64():h===2?o.lastByte=l.readFixed64():h===3?o.filters.push(function(_,y){return _.readFields(q6,{},y)}(l,l.readVarint()+l.pos)):h===4?o.codec=function(_,y){return _.readFields(Z6,{},y)}(l,l.readVarint()+l.pos):h===5?p=l.readFloat():h===6?d=l.readFloat():h===7?o.bands.push(l.readString()):h===8?o.offset=l.readDouble():h===9&&(o.scale=l.readDouble()),o.offset===0&&(o.offset=p),o.scale===0&&(o.scale=d)}function J6(h,o,l){h===1?o.version=l.readVarint():h===2?o.name=l.readString():h===3?o.units=l.readString():h===4?o.tileSize=l.readVarint():h===5?o.buffer=l.readVarint():h===6?o.pixelFormat=l.readVarint():h===7&&o.dataIndex.push(function(d,p){return d.readFields(K6,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(l,l.readVarint()+l.pos))}function Q6(h,o,l){if(h===2)(function(d,p,_){d.readFields(eU,_,p)})(l,l.readVarint()+l.pos,o);else if(h===3)throw new Error("Not implemented")}function eU(h,o,l){if(h===1){let d=0;const p=l.readVarint()+l.pos;for(;l.pos<p;)o[d++]=l.readVarint()}}function tU(h,o){if(o.length!==4)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let l=o[3];for(let d=2;d>=1;d--){const p=d===1?1:0,_=d===2?1:0;for(let y=0;y<o[0];y++){const A=o[1]*y;for(let S=p;S<o[1];S++){const I=o[2]*(S+A);for(let R=_;R<o[2];R++){const P=o[3]*(R+I);for(let B=0;B<o[3];B++){const N=P+B;h[N]+=h[N-l]}}}}l*=o[d]}return h}function iU(h){for(let o=0,l=h.length;o<l;o++)h[o]=h[o]>>>1^-(1&h[o]);return h}function nU(h,o){switch(o){case"uint32":return h;case"uint16":for(let l=0;l<h.length;l+=2){const d=h[l],p=h[l+1];h[l]=(240&d)>>4|(61440&d)>>8|(240&p)<<4|61440&p,h[l+1]=15&d|(3840&d)>>4|(15&p)<<8|(3840&p)<<4}return h;case"uint8":for(let l=0;l<h.length;l+=4){const d=h[l],p=h[l+1],_=h[l+2],y=h[l+3];h[l+0]=(192&d)>>6|(192&p)>>4|(192&_)>>2|192&y,h[l+1]=(48&d)>>4|(48&p)>>2|48&_|(48&y)<<2,h[l+2]=(12&d)>>2|12&p|(12&_)<<2|(12&y)<<4,h[l+3]=3&d|(3&p)<<2|(3&_)<<4|(3&y)<<6}return h;default:throw new Error(`Invalid pixel format, "${o}"`)}}Ut(Rv,"DEMData"),Ut(yR,"DemMinMaxQuadTree",{omit:["dem"]});var Aa=Uint8Array,z_=Uint16Array,rU=Int32Array,vR=new Aa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xR=new Aa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),sU=new Aa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wR=function(h,o){for(var l=new z_(31),d=0;d<31;++d)l[d]=o+=1<<h[d-1];var p=new rU(l[30]);for(d=1;d<30;++d)for(var _=l[d];_<l[d+1];++_)p[_]=_-l[d]<<5|d;return{b:l,r:p}},AR=wR(vR,2),TR=AR.b,oU=AR.r;TR[28]=258,oU[258]=28;for(var aU=wR(xR,0).b,SR=new z_(32768),Lr=0;Lr<32768;++Lr){var Yp=(43690&Lr)>>1|(21845&Lr)<<1;SR[Lr]=((65280&(Yp=(61680&(Yp=(52428&Yp)>>2|(13107&Yp)<<2))>>4|(3855&Yp)<<4))>>8|(255&Yp)<<8)>>1}var N_=function(h,o,l){for(var d=h.length,p=0,_=new z_(o);p<d;++p)h[p]&&++_[h[p]-1];var y,A=new z_(o);for(p=1;p<o;++p)A[p]=A[p-1]+_[p-1]<<1;y=new z_(1<<o);var S=15-o;for(p=0;p<d;++p)if(h[p])for(var I=p<<4|h[p],R=o-h[p],P=A[h[p]-1]++<<R,B=P|(1<<R)-1;P<=B;++P)y[SR[P]>>S]=I;return y},U_=new Aa(288);for(Lr=0;Lr<144;++Lr)U_[Lr]=8;for(Lr=144;Lr<256;++Lr)U_[Lr]=9;for(Lr=256;Lr<280;++Lr)U_[Lr]=7;for(Lr=280;Lr<288;++Lr)U_[Lr]=8;var ER=new Aa(32);for(Lr=0;Lr<32;++Lr)ER[Lr]=5;var lU=N_(U_,9),cU=N_(ER,5),vT=function(h){for(var o=h[0],l=1;l<h.length;++l)h[l]>o&&(o=h[l]);return o},Il=function(h,o,l){var d=o/8|0;return(h[d]|h[d+1]<<8)>>(7&o)&l},xT=function(h,o){var l=o/8|0;return(h[l]|h[l+1]<<8|h[l+2]<<16)>>(7&o)},hU=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ml=function(h,o,l){var d=new Error(o||hU[h]);if(d.code=h,Error.captureStackTrace&&Error.captureStackTrace(d,Ml),!l)throw d;return d},uU=new Aa(0),dU=typeof TextDecoder<"u"&&new TextDecoder;try{dU.decode(uU,{stream:!0})}catch{}const fU={gzip_data:"gzip"};class tl extends Error{constructor(o){super(o),this.name="MRTError"}}const pU={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},CR={uint32:1,uint16:2,uint8:4},mU={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let wT;class kv{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const l=this.layers[o];if(!l)throw new tl(`Layer '${o}' not found`);return l}getHeaderLength(o){const l=new Uint8Array(o),d=new DataView(o);if(l[0]!==13)throw new tl("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(o){const l=new Uint8Array(o),d=this.getHeaderLength(o);if(l.length<d)throw new tl(`Expected header with length >= ${d} but got buffer of length ${l.length}`);const p=function(_,y){return _.readFields(X6,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new wT(l.subarray(0,d)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new tl(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const _ of p.layers)this.layers[_.name]=new IR(_,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const l=[],d=this.getLayer(o.layerName);for(let p of o.blockIndices){const _=d.dataIndex[p],y=_.firstByte-o.firstByte,A=_.lastByte-o.firstByte;if(d._blocksInProgress.has(p))continue;const S={layerName:d.name,firstByte:y,lastByte:A,pixelFormat:d.pixelFormat,blockIndex:p,blockShape:[_.bands.length].concat(d.bandShape),buffer:d.buffer,codec:_.codec.codec,filters:_.filters.map(I=>I.filter)};d._blocksInProgress.add(p),l.push(S)}return new MR(l,()=>{l.forEach(p=>d._blocksInProgress.delete(p.blockIndex))},(p,_)=>{if(l.forEach(y=>d._blocksInProgress.delete(y.blockIndex)),p)throw p;_.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class IR{constructor({version:o,name:l,units:d,tileSize:p,pixelFormat:_,buffer:y,dataIndex:A},S){if(this.version=o,this.version!==1)throw new tl(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=l,this.units=d,this.tileSize=p,this.buffer=y,this.pixelFormat=pU[_],this.dataIndex=A,this.bandShape=[p+2*y,p+2*y,CR[this.pixelFormat]],this._decodedBlocks=new Mv(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return CR[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const l=o.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,o.data)}getBlockForBand(o){let l=0;switch(typeof o){case"string":for(const[d,p]of this.dataIndex.entries()){for(const[_,y]of p.bands.entries())if(y===o)return{bandIndex:l+_,blockIndex:d,blockBandIndex:_};l+=p.bands.length}break;case"number":for(const[d,p]of this.dataIndex.entries()){if(o>=l&&o<l+p.bands.length)return{bandIndex:o,blockIndex:d,blockBandIndex:o-l};l+=p.bands.length}break;default:throw new tl(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(o){let l=1/0,d=-1/0;const p=[],_=new Set;for(const y of o){const{blockIndex:A}=this.getBlockForBand(y);if(A<0)throw new tl(`Invalid band: ${JSON.stringify(y)}`);const S=this.dataIndex[A];p.includes(A)||p.push(A),_.add(A),l=Math.min(l,S.firstByte),d=Math.max(d,S.lastByte)}if(_.size>this.cacheSize)throw new tl(`Number of blocks to decode (${_.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:d,blockIndices:p}}hasBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0}hasDataForBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(o){const{blockIndex:l,blockBandIndex:d}=this.getBlockForBand(o);if(l<0)throw new tl(`Band not found: ${JSON.stringify(o)}`);const p=this._decodedBlocks.get(l.toString());if(!p)throw new tl(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const _=this.dataIndex[l],y=this.bandShape.reduce((I,R)=>I*R,1),A=d*y,S=p.subarray(A,A+y);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:_.offset,scale:_.scale}}}kv.setPbf=function(h){wT=h};class MR{constructor(o,l,d){this.tasks=o,this._onCancel=l,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,l){this._finalized||(this._onComplete(o,l),this._finalized=!0)}}kv.performDecoding=function(h,o){const l=new Uint8Array(h);return Promise.all(o.tasks.map(d=>{const{layerName:p,firstByte:_,lastByte:y,pixelFormat:A,blockShape:S,blockIndex:I,filters:R,codec:P}=d,B=l.subarray(_,y+1),N=new Uint32Array(S[0]*S[1]*S[2]);let U;if(P!=="gzip_data")throw new tl(`Unhandled codec: ${P}`);return U=function(j,K){if(!globalThis.DecompressionStream&&K==="gzip_data")return Promise.resolve(((G=function(fe){fe[0]==31&&fe[1]==139&&fe[2]==8||Ml(6,"invalid gzip data");var Ce=fe[3],Be=10;4&Ce&&(Be+=2+(fe[10]|fe[11]<<8));for(var Fe=(Ce>>3&1)+(Ce>>4&1);Fe>0;Fe-=!fe[Be++]);return Be+(2&Ce)}(re=j))+8>re.length&&Ml(6,"invalid gzip data"),function(fe,Ce,Be,Fe){var Ve=fe.length;if(!Ve||Ce.f&&!Ce.l)return Be||new Aa(0);var et=!Be,mt=et||Ce.i!=2,ht=Ce.i;et&&(Be=new Aa(3*Ve));var pt,xt,Ke=function(lr){var Dn=Be.length;if(lr>Dn){var Sn=new Aa(Math.max(2*Dn,lr));Sn.set(Be),Be=Sn}},ft=Ce.f||0,Ye=Ce.p||0,Qe=Ce.b||0,At=Ce.l,Et=Ce.d,Kt=Ce.m,$t=Ce.n,Bt=8*Ve;do{if(!At){ft=Il(fe,Ye,1);var wt=Il(fe,Ye+1,3);if(Ye+=3,!wt){var pi=fe[(he=4+((Ye+7)/8|0))-4]|fe[he-3]<<8,Xt=he+pi;if(Xt>Ve){ht&&Ml(0);break}mt&&Ke(Qe+pi),Be.set(fe.subarray(he,Xt),Qe),Ce.b=Qe+=pi,Ce.p=Ye=8*Xt,Ce.f=ft;continue}if(wt==1)At=lU,Et=cU,Kt=9,$t=5;else if(wt==2){var qt=Il(fe,Ye,31)+257,ui=Il(fe,Ye+10,15)+4,Ai=qt+Il(fe,Ye+5,31)+1;Ye+=14;for(var Ti=new Aa(Ai),Di=new Aa(19),Mi=0;Mi<ui;++Mi)Di[sU[Mi]]=Il(fe,Ye+3*Mi,7);Ye+=3*ui;var Ci=vT(Di),vn=(1<<Ci)-1,Rn=N_(Di,Ci);for(Mi=0;Mi<Ai;){var he,pe=Rn[Il(fe,Ye,vn)];if(Ye+=15&pe,(he=pe>>4)<16)Ti[Mi++]=he;else{var tt=0,Mt=0;for(he==16?(Mt=3+Il(fe,Ye,3),Ye+=2,tt=Ti[Mi-1]):he==17?(Mt=3+Il(fe,Ye,7),Ye+=3):he==18&&(Mt=11+Il(fe,Ye,127),Ye+=7);Mt--;)Ti[Mi++]=tt}}var Ft=Ti.subarray(0,qt),Ot=Ti.subarray(qt);Kt=vT(Ft),$t=vT(Ot),At=N_(Ft,Kt),Et=N_(Ot,$t)}else Ml(1);if(Ye>Bt){ht&&Ml(0);break}}mt&&Ke(Qe+131072);for(var Zt=(1<<Kt)-1,ci=(1<<$t)-1,Ni=Ye;;Ni=Ye){var Ui=(tt=At[xT(fe,Ye)&Zt])>>4;if((Ye+=15&tt)>Bt){ht&&Ml(0);break}if(tt||Ml(2),Ui<256)Be[Qe++]=Ui;else{if(Ui==256){Ni=Ye,At=null;break}var Ii=Ui-254;Ui>264&&(Ii=Il(fe,Ye,(1<<(Vi=vR[Mi=Ui-257]))-1)+TR[Mi],Ye+=Vi);var dn=Et[xT(fe,Ye)&ci],Tn=dn>>4;if(dn||Ml(3),Ye+=15&dn,Ot=aU[Tn],Tn>3){var Vi=xR[Tn];Ot+=xT(fe,Ye)&(1<<Vi)-1,Ye+=Vi}if(Ye>Bt){ht&&Ml(0);break}mt&&Ke(Qe+131072);var Xn=Qe+Ii;if(Qe<Ot){var kn=0-Ot,ln=Math.min(Ot,Xn);for(kn+Qe<0&&Ml(3);Qe<ln;++Qe)Be[Qe]=(void 0)[kn+Qe]}for(;Qe<Xn;++Qe)Be[Qe]=Be[Qe-Ot]}}Ce.l=At,Ce.p=Ni,Ce.b=Qe,Ce.f=ft,At&&(ft=1,Ce.m=Kt,Ce.d=Et,Ce.n=$t)}while(!ft);return Qe!=Be.length&&et?(pt=Be,((xt=Qe)==null||xt>pt.length)&&(xt=pt.length),new Aa(pt.subarray(0,xt))):Be.subarray(0,Qe)}(re.subarray(G,-8),{i:2},new Aa(((ee=re)[(le=ee.length)-4]|ee[le-3]<<8|ee[le-2]<<16|ee[le-1]<<24)>>>0))));var ee,le,re,G;const ie=fU[K];if(!ie)throw new Error(`Unhandled codec: ${K}`);const ae=new globalThis.DecompressionStream(ie);return new Response(new Blob([j]).stream().pipeThrough(ae)).arrayBuffer().then(fe=>new Uint8Array(fe))}(B,P).then(j=>(function(K,ee){K.readFields(Q6,ee)}(new wT(j),N),new mU[A](N.buffer))),U.then(j=>{for(let K=R.length-1;K>=0;K--)switch(R[K]){case"delta_filter":tU(j,S);break;case"zigzag_filter":iU(j);break;case"bitshuffle_filter":nU(j,A);break;default:throw new tl(`Unhandled filter "${R[K]}"`)}return{layerName:p,blockIndex:I,data:j}}).catch(j=>{throw j})}))},Ut(MR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ut(kv,"MapboxRasterTile"),Ut(IR,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let V_,AT,Rl,Zp,TT,Kp=null;function RR(){return In(self)&&self.worker.dracoUrl?self.worker.dracoUrl:AT||_s.DRACO_URL}function kR(){if(In(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Zp)return Zp;const h=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Zp=WebAssembly.validate(h)?_s.MESHOPT_SIMD_URL:_s.MESHOPT_URL,Zp}const Pv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},gU={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},$_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function PR(h,o,l){const d=l.json.bufferViews.length,p=l.buffers.length;o.bufferView=d,l.json.bufferViews[d]={buffer:p,byteLength:h.byteLength},l.buffers[p]=h}const ST="KHR_draco_mesh_compression";function _U(h,o){const l=h.extensions&&h.extensions[ST];if(!l)return;const d=new Rl.Decoder,p=FR(o,l.bufferView),_=new Rl.Mesh;if(!d.DecodeArrayToMesh(p,p.byteLength,_))throw new Error("Failed to decode Draco mesh");const y=o.json.accessors[h.indices],A=Pv[y.componentType],S=y.count*A.BYTES_PER_ELEMENT,I=Rl._malloc(S);A===Uint16Array?d.GetTrianglesUInt16Array(_,S,I):d.GetTrianglesUInt32Array(_,S,I),PR(Rl.memory.buffer.slice(I,I+S),y,o),Rl._free(I);for(const R of Object.keys(l.attributes)){const P=d.GetAttributeByUniqueId(_,l.attributes[R]),B=o.json.accessors[h.attributes[R]],N=gU[B.componentType],U=B.count*$_[B.type]*Pv[B.componentType].BYTES_PER_ELEMENT,j=Rl._malloc(U);d.GetAttributeDataArrayForAllPoints(_,P,Rl[N],U,j),PR(Rl.memory.buffer.slice(j,j+U),B,o),Rl._free(j)}d.destroy(),_.destroy(),delete h.extensions[ST]}const Dv="EXT_meshopt_compression";function yU(h,o){if(!h.extensions||!h.extensions[Dv])return;const l=h.extensions[Dv],d=new Uint8Array(o.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),p=new Uint8Array(l.count*l.byteStride);TT.decodeGltfBuffer(p,l.count,l.byteStride,d,l.mode,l.filter),h.buffer=o.buffers.length,h.byteOffset=0,o.buffers[h.buffer]=p.buffer,delete h.extensions[Dv]}const DR=1179937895,BR=new TextDecoder("utf8");function OR(h,o){return new URL(h,o).href}function bU(h,o,l,d){return fetch(OR(h.uri,d)).then(p=>p.arrayBuffer()).then(p=>{o.buffers[l]=p})}function FR(h,o){const l=h.json.bufferViews[o];return new Uint8Array(h.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function vU(h,o,l,d){if(h.uri){const p=OR(h.uri,d);return fetch(p).then(_=>_.blob()).then(_=>createImageBitmap(_)).then(_=>{o.images[l]=_})}if(h.bufferView!==void 0){const p=FR(o,h.bufferView),_=new Blob([p],{type:h.mimeType});return createImageBitmap(_).then(y=>{o.images[l]=y})}}function LR(h,o=0,l){const d={json:null,images:[],buffers:[]};if(new Uint32Array(h,o,1)[0]===DR){const R=new Uint32Array(h,o);let P=2;const B=(R[P++]>>2)-3,N=R[P++]>>2;if(P++,d.json=JSON.parse(BR.decode(R.subarray(P,P+N))),P+=N,P<B){const U=R[P++];P++;const j=o+(P<<2);d.buffers[0]=h.slice(j,j+U)}}else d.json=JSON.parse(BR.decode(new Uint8Array(h,o)));const{buffers:p,images:_,meshes:y,extensionsUsed:A,bufferViews:S}=d.json;let I=Promise.resolve();if(p){const R=[];for(let P=0;P<p.length;P++){const B=p[P];B.uri?R.push(bU(B,d,P,l)):d.buffers[P]||(d.buffers[P]=null)}I=Promise.all(R)}return I.then(()=>{const R=[],P=A&&A.includes(ST),B=A&&A.includes(Dv);if(P&&R.push(function(){if(!Rl)return V_??(V_=function(N){let U,j=null;function K(){U=new Uint8Array(j.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const le={a:{a:ee,d:function(re,G,ie){return U.copyWithin(re,G,G+ie)},c:function(re){const G=U.length,ie=Math.max(re>>>0,Math.ceil(1.2*G)),ae=Math.ceil((ie-G)/65536);try{return j.grow(ae),K(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,le):N.then(re=>re.arrayBuffer()).then(re=>WebAssembly.instantiate(re,le))).then(re=>{const{Rb:G,Qb:ie,P:ae,T:fe,X:Ce,Ja:Be,La:Fe,Qa:Ve,Va:et,Wa:mt,eb:ht,jb:pt,f:xt,e:Ke,yb:ft,zb:Ye,Ab:Qe,Bb:At,Db:Et,Gb:Kt}=re.instance.exports;j=Ke;const $t=(()=>{let Bt=0,wt=0,pi=0,Xt=0;return qt=>{pi&&(G(Xt),G(Bt),wt+=pi,pi=Bt=0),Bt||(wt+=128,Bt=ie(wt));const ui=qt.length+7&-8;let Ai=Bt;ui>=wt&&(pi=ui,Ai=Xt=ie(ui));for(let Ti=0;Ti<qt.length;Ti++)U[Ai+Ti]=qt[Ti];return Ai}})();return K(),xt(),{memory:Ke,_free:G,_malloc:ie,Mesh:class{constructor(){this.ptr=ae()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=Be()}destroy(){pt(this.ptr)}DecodeArrayToMesh(Bt,wt,pi){const Xt=$t(Bt),qt=Fe(this.ptr,Xt,wt,pi.ptr);return!!Ce(qt)}GetAttributeByUniqueId(Bt,wt){return{ptr:Ve(this.ptr,Bt.ptr,wt)}}GetTrianglesUInt16Array(Bt,wt,pi){et(this.ptr,Bt.ptr,wt,pi)}GetTrianglesUInt32Array(Bt,wt,pi){mt(this.ptr,Bt.ptr,wt,pi)}GetAttributeDataArrayForAllPoints(Bt,wt,pi,Xt,qt){ht(this.ptr,Bt.ptr,wt.ptr,pi,Xt,qt)}},DT_INT8:ft(),DT_UINT8:Ye(),DT_INT16:Qe(),DT_UINT16:At(),DT_UINT32:Et(),DT_FLOAT32:Kt()}})}(fetch(RR())),V_.then(N=>{Rl=N,V_=void 0}))}()),B&&R.push(function(){if(TT)return;const N=function(U){let j;const K=WebAssembly.instantiateStreaming(U,{}).then(re=>{j=re.instance,j.exports.__wasm_call_ctors()}),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:K,supported:!0,decodeGltfBuffer(re,G,ie,ae,fe,Ce){(function(Be,Fe,Ve,et,mt,ht,pt){const xt=Be.exports.sbrk,Ke=et+3&-4,ft=xt(Ke*mt),Ye=xt(ht.length),Qe=new Uint8Array(Be.exports.memory.buffer);Qe.set(ht,Ye);const At=Fe(ft,et,mt,Ye,ht.length);if(At===0&&pt&&pt(ft,Ke,mt),Ve.set(Qe.subarray(ft,ft+et*mt)),xt(ft-xt(0)),At!==0)throw new Error(`Malformed buffer data: ${At}`)})(j,j.exports[le[fe]],re,G,ie,ae,j.exports[ee[Ce]])}}}(fetch(kR()));return N.ready.then(()=>{TT=N})}()),_)for(let N=0;N<_.length;N++)R.push(vU(_[N],d,N,l));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(P&&y)for(const{primitives:N}of y)for(const U of N)_U(U,d);if(B&&y&&S)for(const N of S)yU(N,d);return d})})}function jd(h,o){const l=h.json.bufferViews[o.bufferView],d=Pv[o.componentType];return new d(h.buffers[l.buffer],(o.byteOffset||0)+(l.byteOffset||0),o.count*(l.byteStride&&l.byteStride!==$_[o.type]*d.BYTES_PER_ELEMENT?l.byteStride/d.BYTES_PER_ELEMENT:$_[o.type]))}function ET(h,o,l,d){const p=Pv[o.componentType],_=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),y=h.json.bufferViews[o.bufferView],A=y.byteStride?y.byteStride/p.BYTES_PER_ELEMENT:$_[o.type],S=l.float32,I=S.length/l.capacity;for(let R=0,P=0;R<o.count*A;R+=A,P+=I)for(let B=0;B<I;B++)S[P+B]=d[R+B]*_;l._trim()}function xU(h,o,l){const d=h.indices,p=h.attributes,_={};_.indexArray=new qr;const y=o.json.accessors[d],A=y.count/3;_.indexArray.reserve(A);const S=jd(o,y);for(let B=0;B<A;B++)_.indexArray.emplaceBack(S[3*B],S[3*B+1],S[3*B+2]);_.indexArray._trim(),_.vertexArray=new Za;const I=o.json.accessors[p.POSITION];_.vertexArray.reserve(I.count);const R=jd(o,I);for(let B=0;B<I.count;B++)_.vertexArray.emplaceBack(R[3*B],R[3*B+1],R[3*B+2]);if(_.vertexArray._trim(),_.aabb=new zn(I.min,I.max),_.centroid=function(B,N){const U=[0,0,0],j=B.length;if(j>0){for(let K=0;K<j;K++){const ee=3*B[K];U[0]+=N[ee],U[1]+=N[ee+1],U[2]+=N[ee+2]}U[0]/=j,U[1]/=j,U[2]/=j}return U}(S,R),p.COLOR_0!==void 0){const B=o.json.accessors[p.COLOR_0],N=$_[B.type],U=jd(o,B);_.colorArray=N===3?new Za:new Ka,_.colorArray.resize(B.count),ET(o,B,_.colorArray,U)}if(p.NORMAL!==void 0){_.normalArray=new Za;const B=o.json.accessors[p.NORMAL];_.normalArray.resize(B.count);const N=jd(o,B);ET(o,B,_.normalArray,N)}if(p.TEXCOORD_0!==void 0&&l.length>0){_.texcoordArray=new ch;const B=o.json.accessors[p.TEXCOORD_0];_.texcoordArray.resize(B.count);const N=jd(o,B);ET(o,B,_.texcoordArray,N)}if(p._FEATURE_ID_RGBA4444!==void 0){const B=o.json.accessors[p._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(_.featureData=jd(o,B))}p._FEATURE_RGBA4444!==void 0&&(_.featureData=new Uint32Array(jd(o,o.json.accessors[p._FEATURE_RGBA4444]).buffer));const P=h.material;return _.material=function(B,N){const{emissiveFactor:U=[0,0,0],alphaMode:j="OPAQUE",alphaCutoff:K=.5,normalTexture:ee,occlusionTexture:le,emissiveTexture:re,doubleSided:G}=B,{baseColorFactor:ie=[1,1,1,1],metallicFactor:ae=1,roughnessFactor:fe=1,baseColorTexture:Ce,metallicRoughnessTexture:Be}=B.pbrMetallicRoughness||{},Fe=le?N[le.index]:void 0;if(le&&le.extensions&&le.extensions.KHR_texture_transform&&Fe){const Ve=le.extensions.KHR_texture_transform;Fe.offsetScale=[Ve.offset[0],Ve.offset[1],Ve.scale[0],Ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new rn(...ie),metallicFactor:ae,roughnessFactor:fe,baseColorTexture:Ce?N[Ce.index]:void 0,metallicRoughnessTexture:Be?N[Be.index]:void 0},doubleSided:G,emissiveFactor:U,alphaMode:j,alphaCutoff:K,normalTexture:ee?N[ee.index]:void 0,occlusionTexture:Fe,emissionTexture:re?N[re.index]:void 0,defined:B.defined===void 0}}(P!==void 0?o.json.materials[P]:{defined:!1},l),_}function zR(h,o,l){const{matrix:d,rotation:p,translation:_,scale:y,mesh:A,extras:S,children:I}=h,R={};if(R.matrix=d||function(P,B,N,U){var j=B[0],K=B[1],ee=B[2],le=B[3],re=j+j,G=K+K,ie=ee+ee,ae=j*re,fe=j*G,Ce=j*ie,Be=K*G,Fe=K*ie,Ve=ee*ie,et=le*re,mt=le*G,ht=le*ie,pt=U[0],xt=U[1],Ke=U[2];return P[0]=(1-(Be+Ve))*pt,P[1]=(fe+ht)*pt,P[2]=(Ce-mt)*pt,P[3]=0,P[4]=(fe-ht)*xt,P[5]=(1-(ae+Ve))*xt,P[6]=(Fe+et)*xt,P[7]=0,P[8]=(Ce+mt)*Ke,P[9]=(Fe-et)*Ke,P[10]=(1-(ae+Be))*Ke,P[11]=0,P[12]=N[0],P[13]=N[1],P[14]=N[2],P[15]=1,P}([],p||[0,0,0,1],_||[0,0,0],y||[1,1,1]),A!==void 0){R.meshes=l[A];const P=R.anchor=[0,0];for(const B of R.meshes){const{min:N,max:U}=B.aabb;P[0]+=N[0]+U[0],P[1]+=N[1]+U[1]}P[0]=Math.floor(P[0]/R.meshes.length/2),P[1]=Math.floor(P[1]/R.meshes.length/2)}if(S&&(S.id&&(R.id=S.id),S.lights&&(R.lights=function(P){if(!P.length)return[];const B=function(ee){const le=atob(ee),re=new Uint8Array(le.length);for(let G=0;G<le.length;G++)re[G]=le.codePointAt(G);return re}(P),N=[],U=B.length/24,j=new Uint16Array(B.buffer),K=new Float32Array(B.buffer);for(let ee=0;ee<U;ee++){const le=j[2*ee*6]/30,re=j[2*ee*6+1]/30,G=j[2*ee*6+10]/100,ie=K[6*ee+1],ae=K[6*ee+2],fe=K[6*ee+3],Ce=K[6*ee+4],Be=fe-ie,Fe=Ce-ae,Ve=Math.hypot(Be,Fe);N.push({pos:[ie+.5*Be,ae+.5*Fe,re],normal:[Fe/Ve,-Be/Ve,0],width:Ve,height:le,depth:G,points:[ie,ae,fe,Ce]})}return N}(S.lights))),I){const P=[];for(const B of I)P.push(zR(o.json.nodes[B],o,l));R.children=P}return R}function wU(h){if(h.vertices.length===0||h.indices.length===0)return null;const o=new RA(h.vertices,h.indices,8,256),[l,d]=[o.min.clone(),o.max.clone()];return{vertices:h.vertices,indices:h.indices,grid:o,min:l,max:d}}function AU(h){if(!h.extras||!h.extras.ground)return null;const o=h.extras.ground;if(!o||!Array.isArray(o)||o.length===0)return null;const l=o[0];if(!l||!Array.isArray(l)||l.length===0)return null;const d=[];for(const y of l){if(!Array.isArray(y)||y.length!==2)continue;const A=y[0],S=y[1];typeof A=="number"&&typeof S=="number"&&d.push(new ue(A,S))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let p=0;for(let y=0;y<d.length;y++){const A=d[y],S=d[(y+1)%d.length],I=d[(y+2)%d.length];p+=(A.x-S.x)*(I.y-S.y)-(I.x-S.x)*(A.y-S.y)}p>0&&d.reverse();const _=d_(d.flatMap(y=>[y.x,y.y]),[]);return _.length===0?null:{vertices:d,indices:_}}function TU(h,o){const l=[],d=[];let p=0;const _=[];for(const y of h){p=l.length;const A=y.vertexArray.float32,S=y.indexArray.uint16;for(let I=0;I<y.vertexArray.length;I++)_[0]=A[3*I+0],_[1]=A[3*I+1],_[2]=A[3*I+2],jn(_,_,o),l.push(new ue(_[0],_[1]));for(let I=0;I<3*y.indexArray.length;I++)d.push(S[I]+p)}if(d.length%3!=0)return null;for(let y=0;y<d.length;y+=3){const A=l[d[y+0]],S=l[d[y+1]],I=l[d[y+2]];(A.x-S.x)*(I.y-S.y)-(I.x-S.x)*(A.y-S.y)>0&&([d[y+1],d[y+2]]=[d[y+2],d[y+1]])}return{vertices:l,indices:d}}function NR(h){const o=function(S,I){const R=[],P=WebGL2RenderingContext;if(S.json.textures)for(const B of S.json.textures){const N={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};B.sampler!==void 0&&Object.assign(N,S.json.samplers[B.sampler]),R.push({image:I[B.source],sampler:N,uploaded:!1})}return R}(h,h.images),l=function(S,I){const R=[];for(const P of S.json.meshes){const B=[];for(const N of P.primitives)B.push(xU(N,S,I));R.push(B)}return R}(h,o),{scenes:d,scene:p,nodes:_}=h.json,y=d?d[p||0].nodes:_,A=[];for(const S of y)A.push(zR(_[S],h,l));return function(S,I,R){const P={},B=new Set;for(let N=0;N<S.length;N++){const U=R[I[N]];if(!U.extras)continue;const j=U.extras["mapbox:footprint:version"],K=U.extras["mapbox:footprint:id"];(j||K)&&B.add(N),j==="1.0.0"&&K&&(P[K]=N)}for(let N=0;N<S.length;N++){if(B.has(N))continue;const U=S[N],j=R[I[N]];if(!j.extras)continue;let K=null;U.id in P&&(K=TU(S[P[U.id]].meshes,U.matrix)),K||(K=AU(j)),K&&(U.footprint=wU(K))}if(B.size>0){const N=Array.from(B.values()).sort((U,j)=>U-j);for(let U=N.length-1;U>=0;U--)S.splice(N[U],1)}}(A,y,h.json.nodes),A}function SU(h){h.heightmap=new Float32Array(4096),h.heightmap.fill(-1);const o=h.vertexArray.float32,l=h.aabb.min[0]-1,d=h.aabb.min[1]-1,p=Ud/(h.aabb.max[0]-l+2),_=Ud/(h.aabb.max[1]-d+2);for(let y=0;y<o.length;y+=3){const A=o[y+2],S=(o[y+0]-l)*p|0,I=(o[y+1]-d)*_|0;A>h.heightmap[I*Ud+S]&&(h.heightmap[I*Ud+S]=A)}}function EU(h,o){const l={};l.indexArray=new qr,l.indexArray.reserve(4*h.length),l.vertexArray=new Za,l.vertexArray.reserve(10*h.length),l.colorArray=new Ka,l.vertexArray.reserve(10*h.length);let d=0;for(const y of h){const A=Math.min(10,Math.max(4,1.3*y.height))*o,S=[-y.normal[1],y.normal[0],0],I=Math.min(.29,.1*y.width/y.depth),R=y.width-2*y.depth*o*(I+.01),P=Gr([],y.pos,S,R/2),B=Gr([],y.pos,S,-R/2),N=[P[0],P[1],P[2]+y.height],U=[B[0],B[1],B[2]+y.height],j=Gr([],y.normal,S,I);Qi(j,j,A);const K=Gr([],y.normal,S,-I);Qi(K,K,A),vi(j,P,j),vi(K,B,K),P[2]+=.1,B[2]+=.1,l.vertexArray.emplaceBack(j[0],j[1],j[2]),l.vertexArray.emplaceBack(K[0],K[1],K[2]),l.vertexArray.emplaceBack(P[0],P[1],P[2]),l.vertexArray.emplaceBack(B[0],B[1],B[2]),l.vertexArray.emplaceBack(N[0],N[1],N[2]),l.vertexArray.emplaceBack(U[0],U[1],U[2]),l.vertexArray.emplaceBack(P[0],P[1],P[2]),l.vertexArray.emplaceBack(B[0],B[1],B[2]),l.vertexArray.emplaceBack(j[0],j[1],j[2]),l.vertexArray.emplaceBack(K[0],K[1],K[2]);const ee=R/A/2;l.colorArray.emplaceBack(-ee-I,-1,ee,.8),l.colorArray.emplaceBack(ee+I,-1,ee,.8),l.colorArray.emplaceBack(-ee,0,ee,1.3),l.colorArray.emplaceBack(ee,0,ee,1.3),l.colorArray.emplaceBack(ee+I,-.8,ee,.7),l.colorArray.emplaceBack(ee+I,-.8,ee,.7),l.colorArray.emplaceBack(0,0,ee,1.3),l.colorArray.emplaceBack(0,0,ee,1.3),l.colorArray.emplaceBack(ee+I,-1.2,ee,.8),l.colorArray.emplaceBack(ee+I,-1.2,ee,.8),l.indexArray.emplaceBack(6+d,4+d,8+d),l.indexArray.emplaceBack(7+d,9+d,5+d),l.indexArray.emplaceBack(0+d,1+d,2+d),l.indexArray.emplaceBack(1+d,3+d,2+d),d+=10}const p={defined:!0,emissiveFactor:[0,0,0]},_={};return _.baseColorFactor=rn.white,p.pbrMetallicRoughness=_,l.material=p,l.aabb=new zn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}class UR{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const d=o[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const CU=["id","tile","layer","source","sourceLayer","state"];class Jp{constructor(o,l,d,p,_){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=d,this._y=p,this.properties=o.properties,this.id=_}clone(){const o=new Jp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state=Object.assign({},this.state)),this.layer&&(o.layer=Object.assign({},this.layer)),this.source&&(o.source=this.source),this.sourceLayer&&(o.sourceLayer=this.sourceLayer),o}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of CU)this[l]!==void 0&&(o[l]=this[l]);return o}}class VR{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Jh(Dt,16,0),this.featureIndexArray=new Pb,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,l,d,p,_,y=0,A=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,p,_,y);const I=this.grid;for(let R=0;R<l.length;R++){const P=l[R],B=[1/0,1/0,-1/0,-1/0];for(let N=0;N<P.length;N++){const U=P[N];B[0]=Math.min(B[0],U.x),B[1]=Math.min(B[1],U.y),B[2]=Math.max(B[2],U.x),B[3]=Math.max(B[3],U.y)}A!==0&&(B[0]-=A,B[1]-=A,B[2]+=A,B[3]+=A),B[0]<Dt&&B[1]<Dt&&B[2]>=0&&B[3]>=0&&I.insert(S,B[0],B[1],B[2],B[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fu.VectorTile(new Qb(this.rawTileData)).layers,this.sourceLayerCoder=new UR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l){const{tilespaceGeometry:d,transform:p,tileTransform:_,pixelPosMatrix:y,availableImages:A}=l;this.loadVTLayers(),this.serializedLayersCache.clear();const S=d.bufferedTilespaceBounds,I=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(N,U,j,K)=>Cr(d.bufferedTilespaceGeometry,N,U,j,K));I.sort(IU);let R=null;p.elevation&&I.length>0&&(R=Gp.create(p.elevation,this.tileID));const P={};let B;for(let N=0;N<I.length;N++){const U=I[N];if(U===B)continue;B=U;const j=this.featureIndexArray.get(U);let K=null;this.is3DTile?this.loadMatchingModelFeature(P,j,o,d,p):this.loadMatchingFeature(P,j,o,A,(ee,le,re,G=0)=>(K||(K=jt(ee,this.tileID.canonical,_)),le.queryIntersectsFeature(d,ee,re,K,this.z,p,y,R,G)))}return P}loadMatchingFeature(o,l,d,p,_){const{featureIndex:y,bucketIndex:A,sourceLayerIndex:S,layoutVertexArrayOffset:I}=l,R=this.bucketLayerIDs[A],P=d.layers,B=Object.keys(P);if(B.length&&!function(ee,le){for(let re=0;re<ee.length;re++)if(le.indexOf(ee[re])>=0)return!0;return!1}(B,R))return;const N=d.sourceCache,U=this.sourceLayerCoder.decode(S),j=this.vtLayers[U].feature(y),K=this.getId(j,U);for(let ee=0;ee<R.length;ee++){const le=R[ee];if(!P[le])continue;const{styleLayer:re,targets:G}=P[le];let ie={};K!==void 0&&(ie=N.getFeatureState(re.sourceLayer,K));const ae=!_||_(j,re,ie,I);if(!ae)continue;const fe=new Jp(j,this.z,this.x,this.y,K);fe.tile=this.tileID.canonical,fe.state=ie;let Ce=this.serializedLayersCache.get(le);Ce||(Ce=re.serialize(),Ce.id=le,this.serializedLayersCache.set(le,Ce)),fe.source=Ce.source,fe.sourceLayer=Ce["source-layer"],fe.layer=Ge({},Ce),fe.layer.paint=$R(Ce.paint,re.paint,j,ie,p),fe.layer.layout=$R(Ce.layout,re.layout,j,ie,p);let Be=!1;for(const Fe of G){this.updateFeatureProperties(fe,Fe);const{filter:Ve}=Fe;if(Ve){if(j.properties=fe.properties,Ve.needGeometry){const et=Jt(j,!0);if(!Ve.filter(new pn(this.tileID.overscaledZ),et,this.tileID.canonical))continue}else if(!Ve.filter(new pn(this.tileID.overscaledZ),j))continue}Be=!0,Fe.targetId&&this.addFeatureVariant(fe,Fe)}Be&&this.appendToResult(o,le,y,fe,ae)}}loadMatchingModelFeature(o,l,d,p,_){const y=this.bucketLayerIDs[0][0],A=d.layers;if(!A[y])return;const{styleLayer:S,targets:I}=A[y];if(S.type!=="model")return;const R=p.tile,P=l.featureIndex,B=R.getBucket(S);if(!(B&&B instanceof wv))return;const N=function(Ce,Be,Fe,Ve){const et=Ce.getNodesInfo()[Be];if(et.hiddenByReplacement||!et.node.meshes)return;let mt=Number.MAX_VALUE;const ht=et.node,pt=Fe.tile,xt=Ve.calculatePosMatrix(pt.tileID.toUnwrapped(),Ve.worldSize),Ke=et.evaluatedScale;let ft=0;Ve.elevation&&ht.elevation&&(ft=ht.elevation*Ve.elevation.exaggeration()),Te(xt,xt,[(ht.anchor?ht.anchor[0]:0)*(Ke[0]-1),(ht.anchor?ht.anchor[1]:0)*(Ke[1]-1),ft]),we(xt,xt,Ke);const Ye=Fe.queryGeometry,Qe=Ye.isPointQuery()?Ye.screenBounds:Ye.screenGeometry,At=function(Kt){const $t=_e([],xt,Kt.matrix);_e($t,Ve.expandedFarZProjMatrix,$t);for(let Bt=0;Bt<Kt.meshes.length;++Bt){const wt=Kt.meshes[Bt];if(Bt===Kt.lightMeshIndex)continue;const pi=VM(Qe,Ve,$t,wt.aabb);pi!=null&&(mt=Math.min(pi,mt))}if(Kt.children)for(const Bt of Kt.children)At(Bt)};if(At(ht),mt===Number.MAX_VALUE)return;const Et=new Z(0,0);return JM(pt.tileID.canonical,Et,et.node.anchor[0],et.node.anchor[1]),{intersectionZ:mt,position:Et,feature:et.feature}}(B,P,p,_);if(!N)return;const{z:U,x:j,y:K}=R.tileID.canonical,{feature:ee,intersectionZ:le,position:re}=N;let G={};ee.id!==void 0&&(G=d.sourceCache.getFeatureState(S.sourceLayer,ee.id));const ie=new Jp({},U,j,K,ee.id);ie.tile=this.tileID.canonical,ie.state=G,ie.properties=ee.properties,ie.geometry={type:"Point",coordinates:[re.lng,re.lat]};let ae=this.serializedLayersCache.get(y);ae||(ae=S.serialize(),ae.id=y,this.serializedLayersCache.set(y,ae)),ie.source=ae.source,ie.sourceLayer=ae["source-layer"],ie.layer=Ge({},ae);let fe=!1;for(const Ce of I){this.updateFeatureProperties(ie,Ce);const{filter:Be}=Ce;if(Be){if(ee.properties=ie.properties,Be.needGeometry){if(!Be.filter(new pn(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!Be.filter(new pn(this.tileID.overscaledZ),ee))continue}fe=!0,Ce.targetId&&this.addFeatureVariant(ie,Ce)}fe&&this.appendToResult(o,y,P,ie,le)}updateFeatureProperties(o,l,d){if(l.properties){const p={};for(const _ in l.properties){const y=l.properties[_].evaluate({zoom:this.z},o._vectorTileFeature,o.state,o.tile,d);y!=null&&(p[_]=y)}o.properties=p}}addFeatureVariant(o,l,d){const p={target:l.target,namespace:l.namespace,uniqueFeatureID:l.uniqueFeatureID};l.properties&&(p.properties=o.properties),o.variants=o.variants||{},o.variants[l.targetId]=o.variants[l.targetId]||[],o.variants[l.targetId].push(p)}appendToResult(o,l,d,p,_){let y=o[l];y===void 0&&(y=o[l]=[]),y.push({featureIndex:d,feature:p,intersectionZ:_})}lookupSymbolFeatures(o,l,d,p,_){const y={};this.loadVTLayers();for(const A of o)this.loadMatchingFeature(y,{bucketIndex:l,sourceLayerIndex:d,featureIndex:A,layoutVertexArrayOffset:0},p,_);return y}loadFeature(o){const{featureIndex:l,sourceLayerIndex:d}=o;this.loadVTLayers();const p=this.sourceLayerCoder.decode(d),_=this.vtFeatures[p];if(_[l])return _[l];const y=this.vtLayers[p].feature(l);return _[l]=y,y}hasLayer(o){for(const l of this.bucketLayerIDs)for(const d of l)if(o===d)return!0;return!1}getId(o,l){let d=o.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[l];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const _=Zh(p);if(_.result!=="success"){const y=_.value.map(A=>`${A.key}: ${A.message}`).join(", ");return void Bi(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=_.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new qf),d=this.promoteIdExpression.evaluate({zoom:0},o)}else d=o.properties[p];typeof d=="boolean"&&(d=Number(d))}return d}}function $R(h,o,l,d,p){return xi(h,(_,y)=>{const A=o instanceof rh?o.get(y):null;return A&&A.evaluate?A.evaluate(l,d,void 0,p):A})}function IU(h,o){return o-h}Ut(VR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const jR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class CT{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,d]=new Uint8Array(o,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=d>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=jR[15&d];if(!_)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(o,2,1),[A]=new Uint32Array(o,4,1);return new CT(A,y,_,o)}constructor(o,l=64,d=Float64Array,p){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const _=jR.indexOf(this.ArrayType),y=2*o*this.ArrayType.BYTES_PER_ELEMENT,A=o*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-A%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${d}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+A+S,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+y+A+S),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+A+S,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=o,this.coords[this._pos++]=l,d}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return IT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,d,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:y,nodeSize:A}=this,S=[0,_.length-1,0],I=[];for(;S.length;){const R=S.pop()||0,P=S.pop()||0,B=S.pop()||0;if(P-B<=A){for(let K=B;K<=P;K++){const ee=y[2*K],le=y[2*K+1];ee>=o&&ee<=d&&le>=l&&le<=p&&I.push(_[K])}continue}const N=B+P>>1,U=y[2*N],j=y[2*N+1];U>=o&&U<=d&&j>=l&&j<=p&&I.push(_[N]),(R===0?o<=U:l<=j)&&(S.push(B),S.push(N-1),S.push(1-R)),(R===0?d>=U:p>=j)&&(S.push(N+1),S.push(P),S.push(1-R))}return I}within(o,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:y}=this,A=[0,p.length-1,0],S=[],I=d*d;for(;A.length;){const R=A.pop()||0,P=A.pop()||0,B=A.pop()||0;if(P-B<=y){for(let K=B;K<=P;K++)WR(_[2*K],_[2*K+1],o,l)<=I&&S.push(p[K]);continue}const N=B+P>>1,U=_[2*N],j=_[2*N+1];WR(U,j,o,l)<=I&&S.push(p[N]),(R===0?o-d<=U:l-d<=j)&&(A.push(B),A.push(N-1),A.push(1-R)),(R===0?o+d>=U:l+d>=j)&&(A.push(N+1),A.push(P),A.push(1-R))}return S}}function IT(h,o,l,d,p,_){if(p-d<=l)return;const y=d+p>>1;HR(h,o,y,d,p,_),IT(h,o,l,d,y-1,1-_),IT(h,o,l,y+1,p,1-_)}function HR(h,o,l,d,p,_){for(;p>d;){if(p-d>600){const I=p-d+1,R=l-d+1,P=Math.log(I),B=.5*Math.exp(2*P/3),N=.5*Math.sqrt(P*B*(I-B)/I)*(R-I/2<0?-1:1);HR(h,o,l,Math.max(d,Math.floor(l-R*B/I+N)),Math.min(p,Math.floor(l+(I-R)*B/I+N)),_)}const y=o[2*l+_];let A=d,S=p;for(j_(h,o,d,l),o[2*p+_]>y&&j_(h,o,d,p);A<S;){for(j_(h,o,A,S),A++,S--;o[2*A+_]<y;)A++;for(;o[2*S+_]>y;)S--}o[2*d+_]===y?j_(h,o,d,S):(S++,j_(h,o,S,p)),S<=l&&(d=S+1),l<=S&&(p=S-1)}}function j_(h,o,l,d){MT(h,l,d),MT(o,2*l,2*d),MT(o,2*l+1,2*d+1)}function MT(h,o,l){const d=h[o];h[o]=h[l],h[l]=d}function WR(h,o,l,d){const p=h-l,_=o-d;return p*p+_*_}r.$=Ps,r.A=Jl,r.B=ma,r.C=oh,r.D=Xp,r.E=jc,r.F=2,r.G=S_,r.H=tM,r.I=bo,r.J=class extends vv{},r.K=fi,r.L=ed,r.M=_a,r.N=mp,r.O=pp,r.P=ue,r.Q=Lg,r.R=Uf,r.S=yp,r.T=rT,r.U=Ap,r.V=vv,r.W=md,r.X=Zh,r.Y=ip,r.Z=Wh,r._=cd,r.a=function(h){return _s.API_CDN_URL_REGEX.test(h)},r.a$=zt,r.a0=Qu,r.a1=Tp,r.a2=gp,r.a3=ub,r.a4=function(h){const o=h.value;let l=[];if(!o)return l;const d=fi(o);return d!=="string"?(l=l.concat([new vv(h.key,o,`string expected, "${d}" found`)]),l):(lT(o,!0)||(l=l.concat([new vv(h.key,o,`invalid url "${o}"`)])),l)},r.a5=He,r.a6=yb,r.a7=or,r.a8=It,r.a9=class{constructor(h){this.specification=h}possiblyEvaluate(h,o){return An(h.expression.evaluate(o))}interpolate(h,o,l){return{x:ri(h.x,o.x,l),y:ri(h.y,o.y,l),z:ri(h.z,o.z,l),azimuthal:ri(h.azimuthal,o.azimuthal,l),polar:ri(h.polar,o.polar,l)}}},r.aA=ls,r.aB=gn,r.aC=ut,r.aD=De,r.aE=x,r.aF=function(h,o){const l={};for(let d=0;d<o.length;d++){const p=o[d];p in h&&(l[p]=h[p])}return l},r.aG=se,r.aH=xe,r.aI=class{constructor(h){this.entries={},this.scheduler=h}request(h,o,l,d){const p=this.entries[h]=this.entries[h]||{callbacks:[]};if(p.result){const[_,y]=p.result;return this.scheduler?this.scheduler.add(()=>{d(_,y)},o):d(_,y),()=>{}}return p.callbacks.push(d),p.cancel||(p.cancel=l((_,y)=>{p.result=[_,y];for(const A of p.callbacks)this.scheduler?this.scheduler.add(()=>{A(_,y)},o):A(_,y);setTimeout(()=>delete this.entries[h],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==d),p.callbacks.length||(p.cancel(),delete this.entries[h]))}}},r.aJ=function(h,o,l){const d=JSON.stringify(h.request);return h.data&&(this.deduped.entries[d]={result:[null,h.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:h.isSymbolTile,zoom:h.tileZoom},p=>{const _=Dh(h.request,(y,A,S,I)=>{y?p(y):A&&p(null,{vectorTile:l?void 0:new fu.VectorTile(new Qb(A)),rawData:A,cacheControl:S,expires:I})});return()=>{_.cancel(),p()}},o)},r.aK=function(h){Zu++,Zu>pa&&(h.getActor().send("enforceCacheSizeLimit",_l),Zu=0)},r.aL=function(h){return h<=1?1:Math.pow(2,Math.floor(Math.log(h)/Math.LN2))},r.aM=xr,r.aN=RM,r.aO=FM,r.aP=MM,r.aQ=function(h,o){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let d=0;d<h.length;d++){const p=document.createElement("source");Dw(h[d])||(l.crossOrigin="Anonymous"),p.src=h[d],l.appendChild(p)}return{cancel:()=>{}}},r.aR=mv,r.aS=function(h){return fetch(h).then(o=>o.arrayBuffer()).then(o=>LR(o,0,h))},r.aT=NR,r.aU=class{constructor(h,o,l,d){this.id=h,this.position=o!=null?new Z(o[0],o[1]):new Z(0,0),this.orientation=l??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new zn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(h,o){if(_e(h.matrix,o,h.matrix),h.meshes)for(const l of h.meshes){const d=zn.applyTransformFast(l.aabb,h.matrix);this.aabb.encapsulate(d)}if(h.children)for(const l of h.children)this._applyTransformations(l,h.matrix)}computeBoundsAndApplyParent(){const h=W([]);for(const o of this.nodes)this._applyTransformations(o,h)}computeModelMatrix(h,o,l,d,p,_,y=!1){XM(this.matrix,this,h.transform,this.position,o,l,d,p,_,y)}upload(h){if(!this.uploaded){for(const o of this.nodes)hT(o,h);for(const o of this.nodes)xv(o);this.uploaded=!0}}destroy(){for(const h of this.nodes)uT(h)}},r.aV=gi,r.aW=C_,r.aX=Ie,r.aY=Re,r.aZ=ah,r.a_=qr,r.aa=pn,r.ab=Kh,r.ac=qe,r.ad=jn,r.ae=bi,r.af=ze,r.ag=rh,r.ah=uu,r.ai=ri,r.aj=Dt,r.ak=N0,r.al=H,r.am=rn,r.an=class{constructor(h){this.specification=h}possiblyEvaluate(h,o){return function([l,d]){const p=An([1,l,d]);return{x:p.x,y:p.y,z:p.z}}(h.expression.evaluate(o))}interpolate(h,o,l){return{x:ri(h.x,o.x,l),y:ri(h.y,o.y,l),z:ri(h.z,o.z,l)}}},r.ao=function(h,o,l=0,d=!0){const p=new ue(l,l),_=h.sub(p),y=o.add(p),A=[_,new ue(y.x,_.y),y,new ue(_.x,y.y)];return d&&A.push(_.clone()),A},r.ap=function(h,o){const l=[];for(let d=0;d<h.length;d++){const p=We(d-1,-1,h.length-1),_=We(d+1,-1,h.length-1),y=h[d],A=h[_],S=h[p].sub(y).unit(),I=A.sub(y).unit(),R=I.angleWithSep(S.x,S.y),P=S.add(I).unit().mult(-1*o/Math.sin(R/2));l.push(y.add(P))}return l},r.aq=mM,r.ar=Cr,r.as=function(h,o,l=0){return ii(((o.x-l)*h.scale-h.x)*Dt,(o.y*h.scale-h.y)*Dt,Xe(o.z,o.y))},r.at=sr,r.au=on,r.av=wa,r.aw=C3,r.ax=function(h){let o=1/0,l=1/0,d=-1/0,p=-1/0;for(const _ of h)o=Math.min(o,_.x),l=Math.min(l,_.y),d=Math.max(d,_.x),p=Math.max(p,_.y);return{min:new ue(o,l),max:new ue(d,p)}},r.ay=ve,r.az=_e,r.b=function(h){return _s.API_FONTS_REGEX.test(h)},r.b$=Qi,r.b0=Dp,r.b1=fv,r.b2=function(){qo.isLoading()||qo.isLoaded()||Qh()!=="deferred"||_b()},r.b3=Gg,r.b4=Jt,r.b5=Jp,r.b6=pr,r.b7=FA,r.b8=MA,r.b9=jt,r.bA=function(h,o){const{x:l,y:d}=h.point,p=lI(l,d,h.worldSize/h._pixelsPerMercatorPixel,0,0);return _e(p,p,pA(mc(o)))},r.bB=E,r.bC=function(h){return h[0]=0,h[1]=0,h[2]=0,h},r.bD=function(h,o){return Math.hypot(o[0]-h[0],o[1]-h[1],o[2]-h[2])},r.bE=cn,r.bF=Gr,r.bG=rr,r.bH=T_,r.bI=Oo,r.bJ=HA,r.bK=function(h,o,l,d,p){const _=5*o+2;h.float32[_+0]=l,h.float32[_+1]=d,h.float32[_+2]=p},r.bL=dv,r.bM=Jb,r.bN=ai,r.bO=es,r.bP=YI,r.bQ=$M,r.bR=e3,r.bS=t3,r.bT=qA,r.bU=lM,r.bV=jA,r.bW=CT,r.bX=We,r.bY=ja,r.bZ=function(h,o,l){l*=.5;var d=o[0],p=o[1],_=o[2],y=o[3],A=Math.sin(l),S=Math.cos(l);return h[0]=d*S+p*A,h[1]=p*S-d*A,h[2]=_*S+y*A,h[3]=y*S-_*A,h},r.b_=$o,r.ba=Al,r.bb=Sd,r.bc=Qa,r.bd=Gn,r.be=d_,r.bf=tT,r.bg=function(h,o){const l=uu(o.zoom);if(l===0)return mc(h);const d=Ub(h),p=fA(d),_=ve(d.getWest())*o.worldSize,y=ve(d.getEast())*o.worldSize,A=xe(d.getNorth())*o.worldSize,S=xe(d.getSouth())*o.worldSize,I=[_,A,0],R=[y,A,0],P=[_,S,0],B=[y,S,0],N=ne([],o.globeMatrix);return jn(I,I,N),jn(R,R,N),jn(P,P,N),jn(B,B,N),p[0]=dh(p[0],P,l),p[1]=dh(p[1],B,l),p[2]=dh(p[2],R,l),p[3]=dh(p[3],I,l),zn.fromPoints(p)},r.bh=$b,r.bi=ne,r.bj=h_,r.bk=dh,r.bl=Cp,r.bm=Zo,r.bn=Tt,r.bo=Te,r.bp=kv,r.bq=Qb,r.br=Dh,r.bs=function(h,o){const l=[];for(const d in h)d in o||l.push(d);return l},r.bt=nt,r.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bv=st,r.bw=function(h){var o=new w(16);return o[0]=h[0],o[1]=h[1],o[2]=h[2],o[3]=h[3],o[4]=h[4],o[5]=h[5],o[6]=h[6],o[7]=h[7],o[8]=h[8],o[9]=h[9],o[10]=h[10],o[11]=h[11],o[12]=h[12],o[13]=h[13],o[14]=h[14],o[15]=h[15],o},r.bx=W,r.by=Je,r.bz=X,r.c=Nc,r.c$=function(h){return h({pluginStatus:vo,pluginURL:cc}),wp.on("pluginStateChange",h),h},r.c0=$a,r.c1=Xr,r.c2=function(h,o){return h[0]=-o[0],h[1]=-o[1],h[2]=-o[2],h[3]=o[3],h},r.c3=St,r.c4=function(h,o,l,d,p){var _,y=1/Math.tan(o/2);return h[0]=y/l,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=y,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,p!=null&&p!==1/0?(h[10]=(p+d)*(_=1/(d-p)),h[14]=2*p*d*_):(h[10]=-1,h[14]=-2*d),h},r.c5=function(h,o,l,d,p,_,y){var A=1/(o-l),S=1/(d-p),I=1/(_-y);return h[0]=-2*A,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*S,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*I,h[11]=0,h[12]=(o+l)*A,h[13]=(p+d)*S,h[14]=(y+_)*I,h[15]=1,h},r.c6=ge,r.c7=function(h,o,l){h[4*o+0]=l[0],h[4*o+1]=l[1],h[4*o+2]=l[2],h[4*o+3]=l[3]},r.c8=Md,r.c9=ya,r.cA=yv,r.cB=kt,r.cC=LM,r.cD=function(h){const o=LM(h,!0);return E([],[o[0],o[1],o[4],o[5]])},r.cE=we,r.cF=cu,r.cG=Ee,r.cH=function(h){const{x:o,y:l}=h.point,{lng:d,lat:p}=h._center;return lI(o,l,h.worldSize,d,p)},r.cI=Cn,r.cJ=te,r.cK=hs,r.cL=T,r.cM=function(h,o,l){let d=0;for(let p=0;p<2;++p)h[p]>0&&(d+=(h[p]-0)*(h[p]-0)),o[p]<0&&(d+=(0-o[p])*(0-o[p]));return d},r.cN=45,r.cO=Wf,r.cP=Se,r.cQ=Fp,r.cR=function(h,o,l){const d=Math.sqrt(h*h+o*o+l*l),p=d>0?Math.acos(l/d)*Oe:0;let _=h!==0||o!==0?Math.atan2(-o,-h)*Oe+90:0;return _<0&&(_+=360),[d,_,p]},r.cS=ii,r.cT=$e,r.cU=vi,r.cV=zn,r.cW=An,r.cX=function(h){return[Math.pow(h[0],1/2.2),Math.pow(h[1],1/2.2),Math.pow(h[2],1/2.2)]},r.cY=Zi,r.cZ=lT,r.c_=function(h,o){return h.readFields(S6,{icons:[]},o)},r.ca=Id,r.cb=Ar,r.cc=Op,r.cd=Z,r.ce=vM,r.cf=function(){var h=new w(4);return w!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},r.cg=function(h,o,l){var d=o[0],p=o[1],_=o[2],y=o[3],A=Math.sin(l),S=Math.cos(l);return h[0]=d*S+_*A,h[1]=p*S+y*A,h[2]=d*-A+_*S,h[3]=p*-A+y*S,h},r.ch=function(h,o){return h[0]===o[0]&&h[1]===o[1]&&h[2]===o[2]&&h[3]===o[3]},r.ci=fs,r.cj=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},r.ck=Po,r.cl=aa,r.cm=Qr,r.cn=Pd,r.co=zM,r.cp=Mn,r.cq=sI,r.cr=function(h,o,l,d,p,_,y,A,S){if(S.name==="globe")return sI(h,o,new Mn(l,d,p),!1);const I=C_({z:l,x:d,y:p},S);return new zn([(_+I.x/I.scale)*o,o*(I.y/I.scale),y],[(_+I.x2/I.scale)*o,o*(I.y2/I.scale),A])},r.cs=function(h,o,l){return h[0]=Math.min(o[0],l[0]),h[1]=Math.min(o[1],l[1]),h[2]=Math.min(o[2],l[2]),h[3]=Math.min(o[3],l[3]),h},r.ct=function(h,o,l){return h[0]=Math.max(o[0],l[0]),h[1]=Math.max(o[1],l[1]),h[2]=Math.max(o[2],l[2]),h[3]=Math.max(o[3],l[3]),h},r.cu=function(h){const o=Math.round((h+45+360)%360/90)%4;return oe[o]},r.cv=je,r.cw=Vo,r.cx=C,r.cy=function(h){const o=W(new Float64Array(16));_e(o,h.pixelMatrix,h.globeMatrix);const l=[0,z,0],d=[0,L,0];return jn(l,l,o),jn(d,d,o),[l[0]>0&&l[0]<=h.width&&l[1]>0&&l[1]<=h.height&&!gA(h,new Z(h.center.lat,90)),d[0]>0&&d[0]<=h.width&&d[1]>0&&d[1]<=h.height&&!gA(h,new Z(h.center.lat,-90))]},r.cz=function(h,o){const{scale:l}=h.tileTransform,d=l*Dt/(h.tileSize*Math.pow(2,o.zoom-h.tileID.overscaledZ+h.tileID.canonical.z));return function(p,_,y){var A=_[1],S=_[2],I=_[3],R=y[0],P=y[1];return p[0]=_[0]*R,p[1]=A*R,p[2]=S*P,p[3]=I*P,p}(new Float32Array(4),o.inverseAdjustmentMatrix,[d,d])},r.d=function(h){return _s.API_TILEJSON_REGEX.test(h)},r.d$=o_,r.d0=Av,r.d1=$p,r.d2=GA,r.d3=Ki,r.d4=nh,r.d5=_o,r.d6=yo,r.d7=Pi,r.d8=function(h){const o=h.indexOf(xd);return o>=0?h.slice(0,o):h},r.d9=function(h){return h.indexOf(xd)>=0},r.dA=aI,r.dB=ks,r.dC=Rs,r.dD=256,r.dE=function(h,o){const l=[0,0,0];return jn(l,l,$b(mc(o.canonical))),jn(l,l,h),l},r.dF=h=>({u_camera_to_center_distance:new Ar(h),u_extrude_scale:new Yo(h),u_device_pixel_ratio:new Ar(h),u_matrix:new Md(h),u_inv_rot_matrix:new Md(h),u_merc_center:new ya(h),u_tile_id:new Id(h),u_zoom_transition:new Ar(h),u_up_dir:new Id(h),u_emissive_strength:new Ar(h)}),r.dG=h=>({u_matrix:new Md(h),u_pixels_to_tile_units:new Yo(h),u_device_pixel_ratio:new Ar(h),u_width_scale:new Ar(h),u_floor_width_scale:new Ar(h),u_units_to_pixels:new ya(h),u_dash_image:new Op(h),u_gradient_image:new Op(h),u_image_height:new Ar(h),u_texsize:new ya(h),u_tile_units_to_pixels:new Ar(h),u_alpha_discard_threshold:new Ar(h),u_trim_offset:new ya(h),u_trim_fade_range:new ya(h),u_trim_color:new Fp(h),u_emissive_strength:new Ar(h),u_zbias_factor:new Ar(h),u_tile_to_meter:new Ar(h),u_ground_shadow_factor:new Id(h)}),r.dH=h=>({u_matrix:new Md(h),u_texsize:new ya(h),u_pixels_to_tile_units:new Yo(h),u_device_pixel_ratio:new Ar(h),u_width_scale:new Ar(h),u_floor_width_scale:new Ar(h),u_image:new Op(h),u_units_to_pixels:new ya(h),u_tile_units_to_pixels:new Ar(h),u_alpha_discard_threshold:new Ar(h),u_trim_offset:new ya(h),u_trim_fade_range:new ya(h),u_trim_color:new Fp(h),u_emissive_strength:new Ar(h),u_zbias_factor:new Ar(h),u_tile_to_meter:new Ar(h),u_ground_shadow_factor:new Id(h),u_pattern_transition:new Ar(h)}),r.dI=Ad,r.dJ=M5,r.dK=uI,r.dL=(h,o,l,d,p,_)=>{const y=h.transform,A=y.projection.name==="globe";let S;if(_.paint.get("circle-pitch-alignment")==="map")if(A){const R=aI(y.zoom,o.canonical)*y._pixelsPerMercatorPixel;S=Float32Array.from([R,0,0,R])}else S=y.calculatePixelsToTileUnitsMatrix(l);else S=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:h.transform.getCameraToCenterDistance(y.projection),u_matrix:h.translatePosMatrix(o.projMatrix,l,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:da.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:TN,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:_.paint.get("circle-emissive-strength")};if(A){I.u_inv_rot_matrix=d,I.u_merc_center=p,I.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],I.u_zoom_transition=uu(y.zoom);const R=p[0]*Dt,P=p[1]*Dt;I.u_up_dir=y.projection.upVector(new Mn(0,0,0),R,P)}return I},r.dM=k3,r.dN=to,r.dO=(h,o,l,d,p,_,y,A,S,I)=>{const R=h.transform,P=R.pitch<15?I3(.07,.7,De((14-R.zoom)/5,0,1)):.07,B=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:R3(h,o,l,d),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:R.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:p,u_width_scale:_,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:M3(o,R),u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(B?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:$e(o.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:I}},r.dP=(h,o,l,d,p,_,y,A,S,I)=>{const R=h.transform,P=R.calculatePixelsToTileUnitsMatrix(o),B=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=R.pitch<15?I3(.07,.7,De((14-R.zoom)/5,0,1)):.07;return{u_matrix:R3(h,o,l,d),u_pixels_to_tile_units:P,u_device_pixel_ratio:_,u_width_scale:y,u_floor_width_scale:A,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:P3(l)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:M3(o,h.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(B?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:$e(o.tileID.canonical,0),u_ground_shadow_factor:I}},r.dQ=Yt,r.dR=u_,r.dS=Xe,r.dT=p3,r.dU=xa,r.dV=Kb,r.dW=pu,r.dX=450,r.dY=7,r.dZ=c6,r.d_=tn,r.da=function(h){const o=h.lastIndexOf(xd);return o>=0?h.slice(o+1):""},r.db=function(h){const o=[],l=h.id;return l===void 0&&o.push({message:`layers.${l}: missing required property "id"`}),h.render===void 0&&o.push({message:`layers.${l}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},r.dc=function(h,o,l,d){return h.type==="custom"?new h6(h,o):new x6[h.type](h,o,l,d)},r.dd=Si,r.de=function(h){const o=h.indexOf(xd);return o>=0?h.slice(o+1):""},r.df=class extends Jp{constructor(h,o){super(h._vectorTileFeature,h._z,h._x,h._y,h.id),h.state&&(this.state=Object.assign({},h.state)),this.target=o.target,this.namespace=o.namespace,o.properties&&(this.properties=o.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=h.source,this.sourceLayer=h.sourceLayer,this.layer=h.layer)}toJSON(){const h=super.toJSON();return h.target=this.target,h.namespace=this.namespace,h}},r.dg=wp,r.dh=Ph,r.di=zb,r.dj=class extends Ja{constructor(h){super(h),this.current=Nb}set(h,o,l){if(this.fetchUniformLocation(h,o)){for(let d=0;d<9;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},r.dk=Ae,r.dl=function(h,o,l){const d=uu(l.zoom),p=h.style.map._antialias,_=h.terrain&&h.terrain.exaggeration()>0;return d===0&&!p&&!_},r.dm=function(h){const o=h.pixelsPerMeter,l=o/ge(1,h.center.lat),d=W(new Float64Array(16));return Te(d,d,[h.point.x,h.point.y,0]),we(d,d,[l,l,o]),Float32Array.from(d)},r.dn=Ub,r.dp=function(h){const o=je-5;h=De(h,-80.051129,o)/o*90;const l=Math.pow(Math.abs(Math.sin(H(h))),3);return Math.round(l*(O.length-1))},r.dq=function(h,o,l,d){const p=o.getNorth(),_=o.getSouth(),y=o.getWest(),A=o.getEast(),S=1<<h.z,I=A-y,R=p-_,P=I/D,B=-R/O[l],N=[0,P,0,B,0,0,p,y,0];if(h.z>0){const U=180/d;$(N,N,[U/I+1,0,0,0,U/R+1,0,-.5*U/P,.5*U/B,1])}return N[2]=S,N[5]=h.x,N[8]=h.y,N},r.dr=mc,r.ds=function(h,o,l){const d=W(new Float64Array(16)),p=(o/(1<<h)-.5)*Math.PI*2;return Le(d,l.globeMatrix,p),Float32Array.from(d)},r.dt=class{isDataAvailableAtPoint(h){const o=this._source();if(this.isUsingMockSource()||!o||h.y<0||h.y>1)return!1;const l=o.getSource().maxzoom,d=1<<l,p=Math.floor(h.x),_=Math.floor((h.x-p)*d),y=Math.floor(h.y*d),A=this.findDEMTileFor(new xr(l,p,l,_,y));return!(!A||!A.dem)}getAtPointOrZero(h,o=0){return this.getAtPoint(h,o)||0}getAtPoint(h,o,l=!0){if(this.isUsingMockSource())return null;o==null&&(o=null);const d=this._source();if(!d||h.y<0||h.y>1)return o;const p=d.getSource().maxzoom,_=1<<p,y=Math.floor(h.x),A=h.x-y,S=new xr(p,y,p,Math.floor(A*_),Math.floor(h.y*_)),I=this.findDEMTileFor(S);if(!I||!I.dem)return o;const R=I.dem,P=1<<I.tileID.canonical.z,B=(A*P-I.tileID.canonical.x)*R.dim,N=(h.y*P-I.tileID.canonical.y)*R.dim,U=Math.floor(B),j=Math.floor(N);return(l?this.exaggeration():1)*ri(ri(R.get(U,j),R.get(U,j+1),N-j),ri(R.get(U+1,j),R.get(U+1,j+1),N-j),B-U)}getAtTileOffset(h,o,l){const d=1<<h.canonical.z;return this.getAtPointOrZero(new qe(h.wrap+(h.canonical.x+o/Dt)/d,(h.canonical.y+l/Dt)/d))}getAtTileOffsetFunc(h,o,l,d){return p=>{const _=this.getAtTileOffset(h,p.x,p.y),y=d.upVector(h.canonical,p.x,p.y);return Qi(y,y,_*d.upVectorScale(h.canonical,o,l).metersToTile),y}}getForTilePoints(h,o,l,d){if(this.isUsingMockSource())return!1;const p=Gp.create(this,h,d);return!!p&&(o.forEach(_=>{_[2]=this.exaggeration()*p.getElevationAt(_[0],_[1],l)}),!0)}getMinMaxForTile(h){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(h);if(!o||!o.dem)return null;const l=o.dem.tree,d=o.tileID,p=1<<h.canonical.z-d.canonical.z;let _=h.canonical.x/p-d.canonical.x,y=h.canonical.y/p-d.canonical.y,A=0;for(let S=0;S<h.canonical.z-d.canonical.z&&!l.leaves[A];S++){_*=2,y*=2;const I=2*Math.floor(y)+Math.floor(_);A=l.childOffsets[A]+I,_%=1,y%=1}return{min:this.exaggeration()*l.minimums[A],max:this.exaggeration()*l.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(h,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(h){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(h){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const h=this.visibleDemTiles;if(h.length===0)return null;let o=!1,l=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const p of h){const _=this.getMinMaxForTile(p.tileID);_&&(l=Math.min(l,_.min),d=Math.max(d,_.max),o=!0)}return o?{min:l,max:d}:null}},r.du=xI,r.dv=hu,r.dw=function(h,o){return[Math.pow(h[0],2.2)*o,Math.pow(h[1],2.2)*o,Math.pow(h[2],2.2)*o]},r.dx=k,r.dy=function(h,o){var l=Math.sin(o),d=Math.cos(o);return h[0]=d,h[1]=l,h[2]=0,h[3]=-l,h[4]=d,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},r.dz=Yl,r.e=_s,r.e$=UR,r.e0=256,r.e1=pA,r.e2=Za,r.e3=Le,r.e4=function(h,o){return h[0]=o[0],h[1]=o[1],h[2]=o[2],h[3]=o[4],h[4]=o[5],h[5]=o[6],h[6]=o[8],h[7]=o[9],h[8]=o[10],h},r.e5=fc,r.e6=Td,r.e7=function(h,o,l,d,p){return De((h-o)/(l-o)*(p-d)+d,d,p)},r.e8=ca,r.e9=function(h,o){var l=o[0],d=o[1],p=o[2],_=o[3],y=o[4],A=o[5],S=o[6],I=o[7],R=o[8],P=R*y-A*I,B=-R*_+A*S,N=I*_-y*S,U=l*P+d*B+p*N;return U?(h[0]=P*(U=1/U),h[1]=(-R*d+p*I)*U,h[2]=(A*d-p*y)*U,h[3]=B*U,h[4]=(R*l-p*S)*U,h[5]=(-A*l+p*_)*U,h[6]=N*U,h[7]=(-I*l+d*S)*U,h[8]=(y*l-d*_)*U,h):null},r.eA=function(h,o,l){return h[0]=o[0]/l[0],h[1]=o[1]/l[1],h[2]=o[2]/l[2],h},r.eB=Wu,r.eC=Y,r.eD=mo,r.eE=function(h,o,l,d){return h[0]=o,h[1]=l,h[2]=d,h},r.eF=function([h,o,l]){const d=Math.hypot(h,o,l),p=Math.atan2(h,l),_=.5*Math.PI-Math.acos(-o/d);return new Z(te(p),te(_))},r.eG=la,r.eH=oT,r.eI=function(h){const o=h.navigator?h.navigator.userAgent:null;return!!function(l){if(Pr==null){const d=l.navigator?l.navigator.userAgent:null;Pr=!!l.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return Pr}(h)&&!(!o||!(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.eJ=function(h,o){_l=h,pa=o},r.eK=gA,r.eL=cI,r.eM=function(h){const o=[0,0,0],l=W(new Float64Array(16));return _e(l,h.pixelMatrix,h.globeMatrix),jn(o,o,l),new ue(o[0],o[1])},r.eN=function(h,o,l=!1){if(vo===$g||vo===jg||vo===Hg)throw new Error("setRTLTextPlugin cannot be called multiple times.");cc=da.resolveURL(h),vo=$g,Wg=o,xp(),l||_b()},r.eO=Qh,r.eP=function(){Av().acquire(fT)},r.eQ=function(){const h=O_;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(fT),O_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.eR=$d,r.eS=function(h){const o=rg();if(!o)return;const l=o.delete(fa);h&&l.then(()=>h()).catch(h)},r.eT=B_,r.eU=RR,r.eV=function(h){AT=da.resolveURL(h),Kp||(Kp=new Xp(Av(),new jc)),Kp.broadcast("setDracoUrl",AT)},r.eW=kR,r.eX=function(h){Zp=da.resolveURL(h),Kp||(Kp=new Xp(Av(),new jc)),Kp.broadcast("setMeshoptUrl",Zp)},r.eY=Ut,r.eZ=du,r.e_=Cl,r.ea=ab,r.eb=Is,r.ec=it,r.ed=class{constructor(h,o,l,d){this.context=h,this.format=d,this.size=l,this.texture=h.gl.createTexture();const[p,_,y]=this.size,{gl:A}=h;A.bindTexture(A.TEXTURE_3D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(!1),A.texImage3D(A.TEXTURE_3D,0,this.format,p,_,y,0,iT(this.format),nT(this.format),o.data)}bind(h,o){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_3D,this.texture),h!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,h),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,h),this.minFilter=h),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,o),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:h}=this.context;h.deleteTexture(this.texture),this.texture=null}},r.ee=function(h,o){if(h===o){var l=o[1],d=o[2],p=o[3],_=o[6],y=o[7],A=o[11];h[1]=o[4],h[2]=o[8],h[3]=o[12],h[4]=l,h[6]=o[9],h[7]=o[13],h[8]=d,h[9]=_,h[11]=o[14],h[12]=p,h[13]=y,h[14]=A}else h[0]=o[0],h[1]=o[4],h[2]=o[8],h[3]=o[12],h[4]=o[1],h[5]=o[5],h[6]=o[9],h[7]=o[13],h[8]=o[2],h[9]=o[6],h[10]=o[10],h[11]=o[14],h[12]=o[3],h[13]=o[7],h[14]=o[11],h[15]=o[15];return h},r.ef=aT,r.eg=Lt,r.eh=[1,1,1],r.ei=function(h,o,l,d){var p=new w(4);return p[0]=h,p[1]=o,p[2]=l,p[3]=d,p},r.ej=ps,r.ek=function(h,o,l,d){var p=o[0],_=o[1],y=o[2],A=o[3];return h[0]=p+d*(l[0]-p),h[1]=_+d*(l[1]-_),h[2]=y+d*(l[2]-y),h[3]=A+d*(l[3]-A),h},r.el=Gp,r.em=Wp,r.en=dc,r.eo=ch,r.ep=function(h,o,l,d,p,_,y,A,S,I,R,P,B,N,U,j){var K=new w(16);return K[0]=h,K[1]=o,K[2]=l,K[3]=d,K[4]=p,K[5]=_,K[6]=y,K[7]=A,K[8]=S,K[9]=I,K[10]=R,K[11]=P,K[12]=B,K[13]=N,K[14]=U,K[15]=j,K},r.eq=q,r.er=kp,r.es=r_,r.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ue(1/0,1/0),max:new ue(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(h,o=!1){const l=KI(new ue(0,0),new ue(Dt,Dt),h),d=[];if(o&&!kA(l,this._globalClipBounds))return d;for(const p of this._activeRegions){if(p.hiddenByOverlap||!kA(l,p))continue;const _=t5(p.min,p.max,h);d.push({min:_.min,max:_.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return d}setSources(h){this._setSources(h.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const l=[];for(const d of o.cache.getVisibleCoordinates()){const p=o.cache.getTile(d).buckets[o.layer];p&&p.updateFootprints(d.toUnwrapped(),l)}return l},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(h){const o=h.getFootprints();if(o.length===0)return;const l=h.getOrder(),d=h.getClipMask(),p=h.getClipScope();for(const _ of o){if(!_.footprint)continue;const y=KI(_.footprint.min,_.footprint.max,_.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:_.id,footprint:_.footprint,order:l,clipMask:d,clipScope:p})}this._sourceIds.push(h.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,l)=>o.priority-l.priority||Yb(o.min,l.min)||Yb(o.max,l.max)||o.order-l.order||o.clipMask-l.clipMask||function(d,p){const _=(y,A)=>y+A;return d.length-p.length||d.reduce(_,"").localeCompare(p.reduce(_,""))}(o.clipScope,l.clipScope));let h=this._activeRegions.length!==this._prevRegions.length;if(!h){let o=0;for(;!h&&o!==this._activeRegions.length;){const l=this._activeRegions[o],d=this._prevRegions[o];h=l.priority!==d.priority||!ZI(l,d)||l.order!==d.order||l.clipMask!==d.clipMask||!st(l.clipScope,d.clipScope),++o}}if(h){++this._updateTime;for(const l of this._activeRegions)l.order!==qb&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const o=l=>{const d=this._activeRegions;if(l>=d.length)return l;const p=d[l].priority;for(;l<d.length&&d[l].priority===p;)++l;return l};if(this._sourceIds.length>1){let l=0,d=o(l);for(;l!==d;){let p=l;const _=l;for(;p!==d;){const y=this._activeRegions[p];y.hiddenByOverlap=!1;for(let A=0;A<_;A++){const S=this._activeRegions[A];if(!S.hiddenByOverlap&&y.order===qb&&kA(y,S)&&(y.hiddenByOverlap=QI(y.footprint,y.tileId,S.footprint,S.tileId),y.hiddenByOverlap))break}++p}l=d,d=o(l)}}}}_setSources(h){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=h.length-1;o>=0;o--)this._addSource(h[o]);this._computeReplacement()}},r.eu=class{constructor(h){this._createGrid(h),this._createPoles(h)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const h of this._poleSegments)h.destroy();for(const h of this._gridSegments)h.withSkirts.destroy(),h.withoutSkirts.destroy()}_fillGridMeshWithLods(h,o){const l=new Al,d=new qr,p=[],_=h+1+2,y=o[0]+1,A=o[0]+1+(1+o.length),S=(I,R,P)=>{let B=I===_-1?I-2:I===0?I:I-1;return B+=P?24575:0,[B,R]};for(let I=0;I<_;++I)l.emplaceBack(...S(I,0,!0));for(let I=0;I<y;++I)for(let R=0;R<_;++R)l.emplaceBack(...S(R,I,(R===0||R===_-1)&&!0));for(let I=0;I<o.length;++I){const R=o[I];for(let P=0;P<_;++P)l.emplaceBack(...S(P,R,!0))}for(let I=0;I<o.length;++I){const R=d.length,P=o[I]+1+2,B=new qr;for(let j=0;j<P-1;j++){const K=j===P-2,ee=K?_*(A-o.length+I-j):_;for(let le=0;le<_-1;le++){const re=j*_+le;j===0||K||le===0||le===_-2?(B.emplaceBack(re+1,re,re+ee),B.emplaceBack(re+ee,re+ee+1,re+1)):(d.emplaceBack(re+1,re,re+ee),d.emplaceBack(re+ee,re+ee+1,re+1))}}const N=Gn.simpleSegment(0,R,l.length,d.length-R);for(let j=0;j<B.uint16.length;j+=3)d.emplaceBack(B.uint16[j],B.uint16[j+1],B.uint16[j+2]);const U=Gn.simpleSegment(0,R,l.length,d.length-R);p.push({withoutSkirts:N,withSkirts:U})}return{vertices:l,indices:d,segments:p}}_createGrid(h){const o=this._fillGridMeshWithLods(D,O);this._gridSegments=o.segments,this._gridBuffer=h.createVertexBuffer(o.vertices,Qa.members),this._gridIndexBuffer=h.createIndexBuffer(o.indices,!0)}_createPoles(h){const o=new qr;for(let y=0;y<=D;y++)o.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=h.createIndexBuffer(o,!0);const l=new fc,d=new fc,p=new fc,_=new fc;this._poleSegments=[];for(let y=0,A=0;y<T;y++){const S=360/(1<<y);l.emplaceBack(0,-x,0,.5,0),d.emplaceBack(0,-x,0,.5,1),p.emplaceBack(0,-x,0,.5,.5),_.emplaceBack(0,-x,0,.5,.5);for(let I=0;I<=D;I++){let R=I/D,P=0;const B=ri(0,S,R),[N,U,j]=V(wN,AN,B,x);l.emplaceBack(N,U,j,R,P),d.emplaceBack(N,U,j,R,1-P);const K=H(B);R=.5+.5*Math.sin(K),P=.5+.5*Math.cos(K),p.emplaceBack(N,U,j,R,P),_.emplaceBack(N,U,j,R,1-P)}this._poleSegments.push(Gn.simpleSegment(A,0,66,64)),A+=66}this._poleNorthVertexBuffer=h.createVertexBuffer(l,xo,!1),this._poleSouthVertexBuffer=h.createVertexBuffer(d,xo,!1),this._texturedPoleNorthVertexBuffer=h.createVertexBuffer(p,xo,!1),this._texturedPoleSouthVertexBuffer=h.createVertexBuffer(_,xo,!1)}getGridBuffers(h,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[h].withSkirts:this._gridSegments[h].withoutSkirts]}getPoleBuffers(h,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[h]]}},r.ev=qb,r.ew=ye,r.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.ey=Me,r.ez=Ct,r.f=function(h){return h.indexOf("mapbox:")===0},r.f0=VR,r.f1=T3,r.f2=Bd,r.f3="hd_road_elevation",r.f4=EA,r.f5=xi,r.f6=Fd,r.f7=WA,r.f8=zd,r.f9=function(h,o,l,d,p,_,y,A=1,S,I){h.createArrays(),h.tilePixelRatio=Dt/(512*h.overscaling),h.compareText={},h.iconsNeedLinear=!1;const R=h.layers[0].layout,P=h.layers[0]._unevaluatedLayout._values,B={};B.scaleFactor=A,B.textSizeScaleRange=R.get("text-size-scale-range"),B.iconSizeScaleRange=R.get("icon-size-scale-range");const[N,U]=B.textSizeScaleRange,[j,K]=B.iconSizeScaleRange;B.textScaleFactor=De(B.scaleFactor,N,U),B.iconScaleFactor=De(B.scaleFactor,j,K);const ee=P["text-size"],le=P["icon-size"];if(h.textSizeData.kind==="composite"){const{minZoom:Ce,maxZoom:Be}=h.textSizeData;B.compositeTextSizes=[ee.possiblyEvaluate(new pn(Ce),_),ee.possiblyEvaluate(new pn(Be),_)]}if(h.iconSizeData.kind==="composite"){const{minZoom:Ce,maxZoom:Be}=h.iconSizeData;B.compositeIconSizes=[le.possiblyEvaluate(new pn(Ce),_),le.possiblyEvaluate(new pn(Be),_)]}B.layoutTextSize=ee.possiblyEvaluate(new pn(y+1),_),B.layoutIconSize=le.possiblyEvaluate(new pn(y+1),_),B.textMaxSize=ee.possiblyEvaluate(new pn(18),_);const re=R.get("symbol-placement"),G=R.get("text-rotation-alignment")==="map"&&re!=="point",ie=R.get("text-size");let ae=!1;const fe=[];for(const Ce of h.features){const Be=R.get("text-font").evaluate(Ce,{},_).join(","),Fe=ie.evaluate(Ce,{},_)*B.textScaleFactor,Ve=B.layoutTextSize.evaluate(Ce,{},_)*B.textScaleFactor,et=B.layoutIconSize.evaluate(Ce,{},_)*B.iconScaleFactor,mt={horizontal:{},vertical:void 0},ht=Ce.text;let pt,xt=[0,0];if(ht){const qt=ht.toString(),ui=R.get("text-letter-spacing").evaluate(Ce,{},_)*es,Ai=R.get("text-line-height").evaluate(Ce,{},_)*es,Ti=Qw(qt)?ui:0,Di=R.get("text-anchor").evaluate(Ce,{},_),Mi=R.get("text-variable-anchor");if(!Mi){const pe=R.get("text-radial-offset").evaluate(Ce,{},_);if(pe)xt=lM(Di,[pe*es,XA]);else{const tt=R.get("text-offset").evaluate(Ce,{},_);xt=[tt[0]*es,tt[1]*es]}}let Ci=G?"center":R.get("text-justify").evaluate(Ce,{},_);const vn=re==="point",Rn=vn?R.get("text-max-width").evaluate(Ce,{},_)*es:1/0,he=pe=>{h.allowVerticalPlacement&&Vg(qt)&&(mt.vertical=$A(ht,o,l,p,Be,Rn,Ai,Di,pe,Ti,xt,Oo.vertical,!0,Ve,Fe,S))};if(!G&&Mi){const pe=Ci==="auto"?Mi.map(Mt=>qA(Mt)):[Ci];let tt=!1;for(let Mt=0;Mt<pe.length;Mt++){const Ft=pe[Mt];if(!mt.horizontal[Ft])if(tt)mt.horizontal[Ft]=mt.horizontal[0];else{const Ot=$A(ht,o,l,p,Be,Rn,Ai,"center",Ft,Ti,xt,Oo.horizontal,!1,Ve,Fe,S);Ot&&(mt.horizontal[Ft]=Ot,tt=Ot.positionedLines.length===1)}}he("left")}else{if(Ci==="auto"&&(Ci=qA(Di)),vn||R.get("text-writing-mode").indexOf("horizontal")>=0||!Vg(qt)){const pe=$A(ht,o,l,p,Be,Rn,Ai,Di,Ci,Ti,xt,Oo.horizontal,!1,Ve,Fe,S);pe&&(mt.horizontal[Ci]=pe)}he(vn?"left":Ci)}}let Ke,ft,Ye,Qe,At,Et,Kt,$t=!1;if(Ce.icon&&Ce.icon.hasPrimary()){const qt=hM(Ce.icon,h.iconSizeData,P["icon-size"],_,h.zoom,Ce,S,B.iconScaleFactor);Ke=qt.iconPrimary,Ye=qt.iconSecondary;const ui=Ke.toString();if(ft=d.get(ui),ft&&(At=R.get("icon-offset").evaluate(Ce,{},_),Et=R.get("icon-anchor").evaluate(Ce,{},_),Kt=R.get("icon-text-fit").evaluate(Ce,{},_),pt=U5(p.get(ui),Ye?p.get(Ye.toString()):void 0,At,Et),$t=ft.sdf,h.sdfIcons===void 0?h.sdfIcons=ft.sdf:h.sdfIcons!==ft.sdf&&Bi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ft.pixelRatio!==h.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(h.iconsNeedLinear=!0)),Ye){const Ai=Ye.toString();Qe=d.get(Ai)}}ae=ae||!(!Ce.icon||!Ce.icon.hasSecondary());const Bt=YA(mt.horizontal)||mt.vertical;h.iconsInText||(h.iconsInText=!!Bt&&Bt.iconsInText);const wt=Ve*B.textScaleFactor/es,{defaultShapedIcon:pi,verticallyShapedIcon:Xt}=Y5(h,pt,R,Ce,_,mt,wt,At,Kt);Kt!=="none"&&pt&&(G3(pt)||X3(pt))&&(sv(0,ft,Ke,pt,pi,Kt,I,d,p),sv(0,Qe,Ye,pt,pi,Kt,I,d,p),Xt&&(sv(0,ft,Ke,pt,Xt,Kt,I,d,p),sv(0,Qe,Ye,pt,Xt,Kt,I,d,p))),pt=pi,fe.push({feature:Ce,shapedTextOrientations:mt,shapedText:Bt,shapedIcon:pt,iconPrimary:Ke,iconSecondary:Ye,iconOffset:At,iconAnchor:Et,verticallyShapedIcon:Xt,layoutTextSize:Ve,layoutIconSize:et,textOffset:xt,isSDFIcon:$t,iconTextFit:Kt})}return{featureData:fe,sizes:B,hasAnySecondaryIcon:ae,textAlongLine:G,symbolPlacement:re}},r.fa=iM,r.fb=function(h,o,l,d,p,_,y,A,S,I){const{featureData:R,hasAnySecondaryIcon:P,sizes:B,textAlongLine:N,symbolPlacement:U}=o;for(const j of R){const{shapedIcon:K,verticallyShapedIcon:ee,feature:le,shapedTextOrientations:re,shapedText:G,layoutTextSize:ie,textOffset:ae,isSDFIcon:fe,iconPrimary:Ce,iconSecondary:Be,iconTextFit:Fe,iconOffset:Ve}=j;uM(K,I.iconPositions,Ce,Be),uM(ee,I.iconPositions,Ce,Be),q5(re,I.iconPositions),(G||K)&&Z5(h,le,re,K,ee,S,B,ie,0,ae,fe,d,p,y,A,P,Fe,Ve,N,U)}l&&h.generateCollisionDebugBuffers(_,h.collisionBoxArray,B.textScaleFactor)},r.fc=fu,r.fd=Rv,r.fe=ke,r.ff=BI,r.fg=z3,r.fh=Qs,r.fi=function(h){let o=0;if(new Uint32Array(h,0,1)[0]!==DR){const l=new Uint32Array(h,0,7),[,,d,p,_,y]=l;o=l.byteLength+p+_+y+_,(d!==h.byteLength||o>=h.byteLength)&&Bi("Invalid b3dm header information.")}return LR(h,o)},r.fj=function(h,o){const l=NR(h);for(const d of l){for(const p of d.meshes)SU(p);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(EU(d.lights,o)))}return l},r.fk=wv,r.fl=In,r.fm=QM,r.fn=qo,r.fo=function(h){bl(),Ho!=null&&Ho.then(o=>{o.keys().then(l=>{for(let d=0;d<l.length-h;d++)o.delete(l[d]).catch(p=>Bi(p.message))}).catch(l=>Bi(l.message))}).catch(o=>Bi(o.message))},r.g=function(h,o){return Ph(Ge(h,{method:"GET"}),o)},r.h=qa,r.i=function(h){return _s.API_STYLE_REGEX.test(h)&&!Nc(h)},r.j=function(h){return decodeURIComponent(atob(h).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(h){return btoa(encodeURIComponent(h).replace(/%([0-9A-F]{2})/g,(o,l)=>String.fromCharCode(+("0x"+l))))},r.l=Ge,r.m=sg,r.n=function(h,o){return Ph(Ge(h,{type:"json"}),o)},r.o=Bh,r.p=function(h,o){return Ph(Ge(h,{method:"POST"}),o)},r.q=da,r.r=ys,r.s=function(h){try{const o=self[h];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=ig,r.u=function(){return function h(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,h)}()},r.v=function(h){return!!h&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(h)},r.w=Bi,r.x=function(){return pT||(pT=new $d),pT},r.y=bT,r.z=lg}),c(["./shared"],function(r){function b(Oe){const H=Oe?Oe.url.toString():void 0;return H?performance.getEntriesByName(H):[]}function w(Oe){if(typeof Oe=="number"||typeof Oe=="boolean"||typeof Oe=="string"||Oe==null)return JSON.stringify(Oe);if(Array.isArray(Oe)){let te="[";for(const oe of Oe)te+=`${w(oe)},`;return`${te}]`}let H="{";for(const te of Object.keys(Oe).sort())H+=`${te}:${w(Oe[te])},`;return`${H}}`}function E(Oe){let H="";for(const te of r.bu)(Oe.type!=="model"||te!=="minzoom"&&te!=="maxzoom")&&(H+=`/${w(Oe[te])}`);return H}class k{constructor(H){this.keyCache={},this._layers={},this._layerConfigs={},H&&this.replace(H)}replace(H,te){this._layerConfigs={},this._layers={},this.update(H,[],te)}update(H,te,oe){this._options=oe;for(const ye of H)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=r.dc(ye,this.scope,null,this._options)).compileFilter(oe),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of te)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const Ae=function(ye,Me){const De={};for(let We=0;We<ye.length;We++){const nt=ye[We];let Ge=Me&&Me[nt.id];Ge||(nt.type==="symbol"?Ge=nt.id:(Ge=E(nt),nt.type==="line"&&nt.paint&&function zt(Yt){return typeof Yt=="string"&&Yt==="line-progress"||(Array.isArray(Yt)?Yt.some(zt):!(!Yt||typeof Yt!="object")&&Object.values(Yt).some(zt))}(nt.paint["line-width"])&&(Ge+=`/${w(nt.paint["line-width"])}`))),Me&&(Me[nt.id]=Ge);let Rt=De[Ge];Rt||(Rt=De[Ge]=[]),Rt.push(nt)}const ze=[];for(const We in De)ze.push(De[We]);return ze}(Object.values(this._layerConfigs),this.keyCache);for(const ye of Ae){const Me=ye.map(Rt=>this._layers[Rt.id]),De=Me[0];if(De.visibility==="none")continue;const ze=De.source||"";let We=this.familiesBySource[ze];We||(We=this.familiesBySource[ze]={});const nt=De.sourceLayer||"_geojsonTileLayer";let Ge=We[nt];Ge||(Ge=We[nt]=[]),Ge.push(Me)}}}const F=1*r.e_;class ${constructor(H){const te={},oe=[];for(const De in H){const ze=H[De],We=te[De]={};for(const nt in ze.glyphs){const Ge=ze.glyphs[+nt];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const Rt=Ge.metrics.localGlyph?F:1,zt={x:0,y:0,w:Ge.bitmap.width+2*Rt,h:Ge.bitmap.height+2*Rt};oe.push(zt),We[nt]=zt}}const{w:Ae,h:ye}=r.H(oe),Me=new r.eZ({width:Ae||1,height:ye||1});for(const De in H){const ze=H[De];for(const We in ze.glyphs){const nt=ze.glyphs[+We];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const Ge=te[De][We],Rt=nt.metrics.localGlyph?F:1;r.eZ.copy(nt.bitmap,Me,{x:0,y:0},{x:Ge.x+Rt,y:Ge.y+Rt},nt.bitmap)}}this.image=Me,this.positions=te}}r.eY($,"GlyphAtlas");class X{constructor(H){this.tileID=new r.aM(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.tileZoom=H.tileZoom,this.uid=H.uid,this.zoom=H.zoom,this.lut=H.lut,this.canonical=H.tileID.canonical,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.scope=H.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.request&&H.request.collectResourceTiming,this.promoteId=H.promoteId,this.isSymbolTile=H.isSymbolTile,this.tileTransform=r.aW(H.tileID.canonical,H.projection),this.projection=H.projection,this.worldview=H.worldview,this.localizableLayerIds=H.localizableLayerIds,this.brightness=H.brightness,this.extraShadowCaster=!!H.extraShadowCaster,this.tessellationStep=H.tessellationStep,this.scaleFactor=H.scaleFactor}parse(H,te,oe,Ae,ye,Me){this.status="parsing",this.data=H,this.collisionBoxArray=new r.b0;const De=new r.e$(Object.keys(H.layers).sort()),ze=new r.f0(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const We={},nt=new r.f1(256,256),Ge={featureIndex:ze,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:nt,availableImages:oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Rt=te.familiesBySource[this.source];for(const en in Rt){const An=H.layers[en];if(!An)continue;let In=!1,pr=!1,Pr=!1;for(const Rs of Rt[en])Rs[0].type==="symbol"?In=!0:pr=!0,Rs[0].is3D()&&Rs[0].type!=="model"&&(Pr=!0);if(this.extraShadowCaster&&!Pr||this.isSymbolTile===!0&&!In||this.isSymbolTile===!1&&!pr)continue;An.version===1&&r.w(`Vector tile source "${this.source}" layer "${en}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xr=De.encode(en),cs=[];let gl=!1;for(let Rs=0,ks=0;Rs<An.length;Rs++){const Jr=An.feature(Rs),_s=ze.getId(Jr,en);if(this.localizableLayerIds&&this.localizableLayerIds.has(en)){const qa=Jr.properties?Jr.properties.worldview:null;if(this.worldview&&typeof qa=="string")if(qa==="all")Jr.properties.$localized=!0;else{if(!qa.split(",").includes(this.worldview))continue;Jr.properties.$localized=!0,Jr.properties.worldview=this.worldview}}!gl&&Jr.properties&&Jr.properties.hasOwnProperty(r.f2)&&(gl=!0),cs.push({feature:Jr,id:_s,index:ks,sourceLayerIndex:Xr}),ks++}gl&&!Ge.elevationFeatures&&H.layers.hasOwnProperty(r.f3)&&(Ge.elevationFeatures=r.f4.parseFrom(H.layers[r.f3],this.canonical));for(const Rs of Rt[en]){const ks=Rs[0];(!this.extraShadowCaster||ks.is3D()&&ks.type!=="model")&&(this.isSymbolTile!==void 0&&ks.type==="symbol"!==this.isSymbolTile||ks.minzoom&&this.zoom<Math.floor(ks.minzoom)||ks.maxzoom&&this.zoom>=ks.maxzoom||ks.visibility!=="none"&&(W(Rs,this.zoom,Ge.brightness,oe),(We[ks.id]=ks.createBucket({index:ze.bucketLayerIDs.length,layers:Rs,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ae})).populate(cs,Ge,this.tileID.canonical,this.tileTransform),ze.bucketLayerIDs.push(Rs.map(Jr=>r.C(Jr.id,Jr.scope)))))}}let zt,Yt,gi,xi,Si,Pi;nt.trim();const Hn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Bi=()=>{if(zt)return this.status="done",Me(zt);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:Object.values(We).filter(en=>!en.isEmpty()),featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ge.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yt&&gi&&xi){const en=new $(Yt),An=new Map;for(const[Pr,Xr]of gi.entries()){const{imagePosition:cs}=r.f7(Pr,Xr,r.f8);An.set(Pr,cs)}const In={};for(const Pr in We){const Xr=We[Pr];Xr instanceof r.b1&&(W(Xr.layers,this.zoom,Ge.brightness,oe),In[Pr]=r.f9(Xr,Yt,en.positions,gi,An,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Si))}const pr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ye,gi,Si,()=>{pr.iconsPending=!1,yn(In,en,pr)}),this.rasterizeIfNeeded(ye,xi,Pi,()=>{pr.patternsPending=!1,yn(In,en,pr)})}},yn=(en,An,In,pr)=>{if(In.iconsPending||In.patternsPending)return;const Pr=new r.fa(gi,xi,this.lut);for(const Xr in We){const cs=We[Xr];if(Xr in en)r.fb(cs,en[Xr],this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,gi,Pr);else if(cs.hasPattern&&(cs instanceof r.b7||cs instanceof r.b8||cs instanceof r.dV)){W(cs.layers,this.zoom,Ge.brightness,oe);const gl=Object.fromEntries(Pr.patternPositions);cs.addFeatures(Ge,this.tileID.canonical,gl,oe,this.tileTransform,this.brightness)}}this.status="done",Me(null,{buckets:Object.values(We).filter(Xr=>!Xr.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:An.image,lineAtlas:nt,imageAtlas:Pr,brightness:Ge.brightness})};if(!this.extraShadowCaster){const en=r.f5(Ge.glyphDependencies,pr=>Object.keys(pr).map(Number));Object.keys(en).length?ye.send("getGlyphs",{uid:this.uid,stacks:en,scope:this.scope},(pr,Pr)=>{zt||(zt=pr,Yt=Pr,Bi())},void 0,!1,Hn):Yt={};const An=Array.from(Ge.iconDependencies.keys()).map(pr=>r.I.parse(pr));An.length?ye.send("getImages",{images:An,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(pr,Pr)=>{zt||(zt=pr,gi=new Map,Si=this.updateImageMapAndGetImageTaskQueue(gi,Pr,Ge.iconDependencies),Bi())},void 0,!1,Hn):(gi=new Map,Si=new Map);const In=Array.from(Ge.patternDependencies.keys()).map(pr=>r.I.parse(pr));In.length?ye.send("getImages",{images:In,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(pr,Pr)=>{zt||(zt=pr,xi=new Map,Pi=this.updateImageMapAndGetImageTaskQueue(xi,Pr,Ge.patternDependencies),Bi())},void 0,!1,Hn):(xi=new Map,Pi=new Map)}if(Ge.elevationFeatures&&Ge.elevationFeatures.length>0){const en=[];for(const In of Object.values(We))if(In instanceof r.b8){const pr=In.getUnevaluatedPortalGraph();pr&&en.push(pr)}const An=r.f6.evaluate(en);for(const In of Object.values(We))In instanceof r.b8&&In.setEvaluatedPortalGraph(An)}Bi()}rasterizeIfNeeded(H,te,oe,Ae){Array.from(te.values()).some(ye=>ye.usvg)?this.rasterize(H,te,oe,Ae):Ae()}updateImageMapAndGetImageTaskQueue(H,te,oe){const Ae=new Map;for(const ye of te.keys()){const Me=oe.get(ye)||[];for(const De of Me){const ze=De.toString(),We=te.get(De.id.toString());We.usvg?Ae.has(ze)||(Ae.set(ze,De),H.set(ze,Object.assign({},We))):H.set(ze,We)}}return Ae}rasterize(H,te,oe,Ae){this.rasterizeTask=H.send("rasterizeImages",{scope:this.scope,tasks:oe},(ye,Me)=>{if(!ye)for(const[De,ze]of Me.entries()){const We=Object.assign(te.get(De),{data:ze});te.set(De,We)}Ae()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function W(Oe,H,te,oe){const Ae=new r.aa(H,{brightness:te});for(const ye of Oe)ye.recalculate(Ae,oe)}class ne extends r.E{constructor(H,te,oe,Ae,ye,Me,De){super(),this.actor=H,this.layerIndex=te,this.availableImages=oe,this.availableModels=Ae,this.loadVectorData=Me||r.aJ,this.loading={},this.loaded={},this.deduped=new r.aI(H.scheduler),this.isSpriteLoaded=ye,this.scheduler=H.scheduler,this.brightness=De}loadTile(H,te){const oe=H.uid,Ae=H&&H.request,ye=Ae&&Ae.collectResourceTiming,Me=this.loading[oe]=new X(H);Me.abort=this.loadVectorData(H,(De,ze)=>{const We=!this.loading[oe];if(delete this.loading[oe],Me.cancelRasterize(),We||De||!ze)return Me.status="done",We||(this.loaded[oe]=Me),te(De);const nt=ze.rawData,Ge={};ze.expires&&(Ge.expires=ze.expires),ze.cacheControl&&(Ge.cacheControl=ze.cacheControl),Me.vectorTile=ze.vectorTile||new r.fc.VectorTile(new r.bq(nt));const Rt=()=>{Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(zt,Yt)=>{if(zt||!Yt)return te(zt);const gi={};if(ye){const xi=b(Ae);xi.length>0&&(gi.resourceTiming=JSON.parse(JSON.stringify(xi)))}te(null,r.l({rawTileData:nt.slice(0)},Yt,Ge,gi))})};this.isSpriteLoaded?Rt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Rt,{type:"parseTile",isSymbolTile:H.isSymbolTile,zoom:H.tileZoom}):Rt()}),this.loaded=this.loaded||{},this.loaded[oe]=Me})}reloadTile(H,te){const oe=this.loaded,Ae=H.uid;if(oe&&oe[Ae]){const ye=oe[Ae];ye.scaleFactor=H.scaleFactor,ye.showCollisionBoxes=H.showCollisionBoxes,ye.projection=H.projection,ye.brightness=H.brightness,ye.tileTransform=r.aW(H.tileID.canonical,H.projection),ye.extraShadowCaster=H.extraShadowCaster,ye.lut=H.lut;const Me=(De,ze)=>{const We=ye.reloadCallback;We&&(delete ye.reloadCallback,ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,We)),te(De,ze)};ye.status==="parsing"?ye.reloadCallback=Me:ye.status==="done"&&(ye.vectorTile?ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Me):Me())}else te(null,void 0)}abortTile(H,te){const oe=H.uid,Ae=this.loading[oe];Ae&&(Ae.abort&&Ae.abort(),delete this.loading[oe]),te()}removeTile(H,te){const oe=this.loaded,Ae=H.uid;oe&&oe[Ae]&&delete oe[Ae],te()}}class _e{loadTile(H,te){const{uid:oe,encoding:Ae,rawImageData:ye,padding:Me}=H,De=ImageBitmap&&ye instanceof ImageBitmap?this.getImageData(ye,Me):ye;te(null,new r.fd(oe,De,Ae,Me<1))}reloadTile(H,te){te(null,null)}abortTile(H,te){te()}removeTile(H,te){te()}getImageData(H,te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const oe=this.offscreenCanvasContext.getImageData(-te,-te,H.width+2*te,H.height+2*te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}r.bp.setPbf(r.bq);class Te{constructor(H){this._mrt=new r.bp(H.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=H.uid,this.tileID=H.tileID,this.source=H.source}parse(H,te){const oe=this._mrt;this.status="parsing",this._entireBuffer=H;try{oe.parseHeader(H),this._isHeaderLoaded=!0;const Ae=[];for(const ye in oe.layers){const Me=oe.getLayer(ye),De=Me.getDataRange(Me.getBandList()),ze=oe.createDecodingTask(De),We=H.slice(De.firstByte,De.lastByte+1),nt=r.bp.performDecoding(We,ze).then(Ge=>ze.complete(null,Ge)).catch(Ge=>ze.complete(Ge,null));Ae.push(nt)}Promise.allSettled(Ae).then(()=>te(null,oe)).catch(ye=>te(ye))}catch(Ae){te(Ae)}}}class we{constructor(H){this.actor=H,this.loading={},this.loaded={}}loadTile(H,te){const oe=H.uid,Ae=H.request,ye=this.loading[oe]=new Te(H),{cancel:Me}=r.br(Ae,(De,ze,We,nt)=>{const Ge=!this.loading[oe];if(delete this.loading[oe],Ge||De||!ze)return ye.status="done",Ge||(this.loaded[oe]=ye),te(De);ye.parse(ze,(Rt,zt)=>{if(Rt||!zt)return te(Rt);te(null,zt,We,nt)}),this.loaded[oe]=ye});ye.abort=Me}reloadTile(H,te){te(null,void 0)}abortTile(H,te){const oe=H.uid,Ae=this.loading[oe];Ae&&(Ae.abort&&Ae.abort(),delete this.loading[oe]),te()}removeTile(H,te){const oe=H.uid;this.loaded[oe]&&delete this.loaded[oe],te()}decodeRasterArray(H,te){r.bp.performDecoding(H.buffer,H.task).then(oe=>te(null,oe)).catch(oe=>te(oe))}}const Ee=r.fc.VectorTileFeature.prototype.toGeoJSON;class Le{constructor(H){this._feature=H,this.extent=r.aj,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(this._feature.type===1){const H=[];for(const te of this._feature.geometry)H.push([new r.P(te[0],te[1])]);return H}{const H=[];for(const te of this._feature.geometry){const oe=[];for(const Ae of te)oe.push(new r.P(Ae[0],Ae[1]));H.push(oe)}return H}}toGeoJSON(H,te,oe){return Ee.call(this,H,te,oe)}}class Je{constructor(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.aj,this.length=H.length,this._features=H}feature(H){return new Le(this._features[H])}}const Tt=64/4096,_t=128;class St{constructor(){this.features=new Map}clear(){this.features.clear()}load(H=[],te){for(const oe of H){const Ae=oe.id;if(Ae==null)continue;let ye=this.features.get(Ae);ye&&this.updateCache(ye,te),oe.geometry?(ye=Lt(oe),this.updateCache(ye,te),this.features.set(Ae,ye)):this.features.delete(Ae),this.updateCache(ye,te)}}updateCache(H,te){for(const{canonical:oe,uid:Ae}of Object.values(te)){const{z:ye,x:Me,y:De}=oe;kt(H,Math.pow(2,ye),Me,De)&&delete te[Ae]}}getTile(H,te,oe){const Ae=Math.pow(2,H),ye=[];for(const Me of this.features.values())kt(Me,Ae,te,oe)&&ye.push(vi(Me,Ae,te,oe));return{features:ye}}getFeatures(){return[...this.features.values()]}}function kt({minX:Oe,minY:H,maxX:te,maxY:oe},Ae,ye,Me){return Oe<(ye+1+Tt)/Ae&&H<(Me+1+Tt)/Ae&&te>(ye-Tt)/Ae&&oe>(Me-Tt)/Ae}function Lt(Oe){const{id:H,geometry:te,properties:oe}=Oe;if(!te)return;if(te.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ae,coordinates:ye}=te,Me={id:H,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},De=Me.geometry;if(Ae==="Point")si(ye,De,Me);else if(Ae==="MultiPoint")for(const ze of ye)si(ze,De,Me);else if(Ae==="LineString")Me.type=2,bi(ye,De,Me);else if(Ae==="MultiLineString")Me.type=2,ii(ye,De,Me);else if(Ae==="Polygon")Me.type=3,ii(ye,De,Me,!0);else{if(Ae!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Me.type=3;for(const ze of ye)ii(ze,De,Me,!0)}return Me}function si([Oe,H],te,oe){const Ae=r.ay(Oe);let ye=r.aH(H);ye=ye<0?0:ye>1?1:ye,te.push(Ae,ye),oe.minX=Math.min(oe.minX,Ae),oe.minY=Math.min(oe.minY,ye),oe.maxX=Math.max(oe.maxX,Ae),oe.maxY=Math.max(oe.maxY,ye)}function bi(Oe,H,te,oe=!1,Ae=!1){const ye=[];for(const Me of Oe)si(Me,ye,te);H.push(ye),oe&&function(Me,De){let ze=0;for(let We=0,nt=Me.length,Ge=nt-2;We<nt;Ge=We,We+=2)ze+=(Me[We]-Me[Ge])*(Me[We+1]+Me[Ge+1]);if(ze>0===De)for(let We=0,nt=Me.length;We<nt/2;We+=2){const Ge=Me[We],Rt=Me[We+1];Me[We]=Me[nt-2-We],Me[We+1]=Me[nt-1-We],Me[nt-2-We]=Ge,Me[nt-1-We]=Rt}}(ye,Ae)}function ii(Oe,H,te,oe=!1){for(let Ae=0;Ae<Oe.length;Ae++)bi(Oe[Ae],H,te,oe,Ae===0)}function vi(Oe,H,te,oe){const{id:Ae,type:ye,geometry:Me,tags:De}=Oe,ze=[];if(ye===1)(function(We,nt,Ge,Rt,zt){for(let Yt=0;Yt<We.length;Yt+=2){const gi=Math.round(r.aj*(We[Yt+0]*nt-Ge)),xi=Math.round(r.aj*(We[Yt+1]*nt-Rt));zt.push([gi,xi])}})(Me,H,te,oe,ze);else for(const We of Me)Zi(We,H,te,oe,ze);return{id:Ae,type:ye,geometry:ze,tags:De}}function Zi(Oe,H,te,oe,Ae){const Me=r.aj+_t;let De;for(let ze=0;ze<Oe.length-2;ze+=2){let We=Math.round(r.aj*(Oe[ze+0]*H-te)),nt=Math.round(r.aj*(Oe[ze+1]*H-oe)),Ge=Math.round(r.aj*(Oe[ze+2]*H-te)),Rt=Math.round(r.aj*(Oe[ze+3]*H-oe));const zt=Ge-We,Yt=Rt-nt;We<-128&&Ge<-128||(We<-128?(nt+=Math.round(Yt*((-128-We)/zt)),We=-128):Ge<-128&&(Rt=nt+Math.round(Yt*((-128-We)/zt)),Ge=-128),nt<-128&&Rt<-128||(nt<-128?(We+=Math.round(zt*((-128-nt)/Yt)),nt=-128):Rt<-128&&(Ge=We+Math.round(zt*((-128-nt)/Yt)),Rt=-128),We>=Me&&Ge>=Me||(We>=Me?(nt+=Math.round(Yt*((Me-We)/zt)),We=Me):Ge>=Me&&(Rt=nt+Math.round(Yt*((Me-We)/zt)),Ge=Me),nt>=Me&&Rt>=Me||(nt>=Me?(We+=Math.round(zt*((Me-nt)/Yt)),nt=Me):Rt>=Me&&(Ge=We+Math.round(zt*((Me-nt)/Yt)),Rt=Me),De&&We===De[De.length-1][0]&&nt===De[De.length-1][1]||(De=[[We,nt]],Ae.push(De)),De.push([Ge,Rt])))))}}var Cn,nr,vr,Qi={exports:{}},Gr=function(){if(vr)return Qi.exports;vr=1;var Oe=r.fg(),H=function(){if(nr)return Cn;nr=1;var nt=r.fe(),Ge=r.ff().VectorTileFeature;function Rt(Yt,gi){this.options=gi||{},this.features=Yt,this.length=Yt.length}function zt(Yt,gi){this.id=typeof Yt.id=="number"?Yt.id:void 0,this.type=Yt.type,this.rawGeometry=Yt.type===1?[Yt.geometry]:Yt.geometry,this.properties=Yt.tags,this.extent=gi||4096}return Cn=Rt,Rt.prototype.feature=function(Yt){return new zt(this.features[Yt],this.options.extent)},zt.prototype.loadGeometry=function(){var Yt=this.rawGeometry;this.geometry=[];for(var gi=0;gi<Yt.length;gi++){for(var xi=Yt[gi],Si=[],Pi=0;Pi<xi.length;Pi++)Si.push(new nt(xi[Pi][0],xi[Pi][1]));this.geometry.push(Si)}return this.geometry},zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Yt=this.geometry,gi=1/0,xi=-1/0,Si=1/0,Pi=-1/0,Hn=0;Hn<Yt.length;Hn++)for(var Bi=Yt[Hn],yn=0;yn<Bi.length;yn++){var en=Bi[yn];gi=Math.min(gi,en.x),xi=Math.max(xi,en.x),Si=Math.min(Si,en.y),Pi=Math.max(Pi,en.y)}return[gi,Si,xi,Pi]},zt.prototype.toGeoJSON=Ge.prototype.toGeoJSON,Cn}();function te(nt){var Ge=new Oe;return function(Rt,zt){for(var Yt in Rt.layers)zt.writeMessage(3,oe,Rt.layers[Yt])}(nt,Ge),Ge.finish()}function oe(nt,Ge){var Rt;Ge.writeVarintField(15,nt.version||1),Ge.writeStringField(1,nt.name||""),Ge.writeVarintField(5,nt.extent||4096);var zt={keys:[],values:[],keycache:{},valuecache:{}};for(Rt=0;Rt<nt.length;Rt++)zt.feature=nt.feature(Rt),Ge.writeMessage(2,Ae,zt);var Yt=zt.keys;for(Rt=0;Rt<Yt.length;Rt++)Ge.writeStringField(3,Yt[Rt]);var gi=zt.values;for(Rt=0;Rt<gi.length;Rt++)Ge.writeMessage(4,We,gi[Rt])}function Ae(nt,Ge){var Rt=nt.feature;Rt.id!==void 0&&Ge.writeVarintField(1,Rt.id),Ge.writeMessage(2,ye,nt),Ge.writeVarintField(3,Rt.type),Ge.writeMessage(4,ze,Rt)}function ye(nt,Ge){var Rt=nt.feature,zt=nt.keys,Yt=nt.values,gi=nt.keycache,xi=nt.valuecache;for(var Si in Rt.properties){var Pi=Rt.properties[Si],Hn=gi[Si];if(Pi!==null){Hn===void 0&&(zt.push(Si),gi[Si]=Hn=zt.length-1),Ge.writeVarint(Hn);var Bi=typeof Pi;Bi!=="string"&&Bi!=="boolean"&&Bi!=="number"&&(Pi=JSON.stringify(Pi));var yn=Bi+":"+Pi,en=xi[yn];en===void 0&&(Yt.push(Pi),xi[yn]=en=Yt.length-1),Ge.writeVarint(en)}}}function Me(nt,Ge){return(Ge<<3)+(7&nt)}function De(nt){return nt<<1^nt>>31}function ze(nt,Ge){for(var Rt=nt.loadGeometry(),zt=nt.type,Yt=0,gi=0,xi=Rt.length,Si=0;Si<xi;Si++){var Pi=Rt[Si],Hn=1;zt===1&&(Hn=Pi.length),Ge.writeVarint(Me(1,Hn));for(var Bi=zt===3?Pi.length-1:Pi.length,yn=0;yn<Bi;yn++){yn===1&&zt!==1&&Ge.writeVarint(Me(2,Bi-1));var en=Pi[yn].x-Yt,An=Pi[yn].y-gi;Ge.writeVarint(De(en)),Ge.writeVarint(De(An)),Yt+=en,gi+=An}zt===3&&Ge.writeVarint(Me(7,1))}}function We(nt,Ge){var Rt=typeof nt;Rt==="string"?Ge.writeStringField(1,nt):Rt==="boolean"?Ge.writeBooleanField(7,nt):Rt==="number"&&(nt%1!=0?Ge.writeDoubleField(3,nt):nt<0?Ge.writeSVarintField(6,nt):Ge.writeVarintField(5,nt))}return Qi.exports=te,Qi.exports.fromVectorTileJs=te,Qi.exports.fromGeojsonVt=function(nt,Ge){Ge=Ge||{};var Rt={};for(var zt in nt)Rt[zt]=new H(nt[zt].features,Ge),Rt[zt].name=zt,Rt[zt].version=Ge.version,Rt[zt].extent=Ge.extent;return te({layers:Rt})},Qi.exports.GeoJSONWrapper=H,Qi.exports}(),Js=r.fh(Gr);const mo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Oe=>Oe},Is=Math.fround||(on=new Float32Array(1),Oe=>(on[0]=+Oe,on[0]));var on;const cn=3,rr=5,go=6;class jn{constructor(H){this.options=Object.assign(Object.create(mo),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:te,minZoom:oe,maxZoom:Ae}=this.options;te&&console.time("total time");const ye=`prepare ${H.length} points`;te&&console.time(ye),this.points=H;const Me=[];for(let ze=0;ze<H.length;ze++){const We=H[ze];if(!We.geometry)continue;const[nt,Ge]=We.geometry.coordinates,Rt=Is(fs(nt)),zt=Is(sr(Ge));Me.push(Rt,zt,1/0,ze,-1,1),this.options.reduce&&Me.push(0)}let De=this.trees[Ae+1]=this._createTree(Me);te&&console.timeEnd(ye);for(let ze=Ae;ze>=oe;ze--){const We=+Date.now();De=this.trees[ze]=this._createTree(this._cluster(De,ze)),te&&console.log("z%d: %d clusters in %dms",ze,De.numItems,+Date.now()-We)}return te&&console.timeEnd("total time"),this}getClusters(H,te){let oe=((H[0]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,H[1]));let ye=H[2]===180?180:((H[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)oe=-180,ye=180;else if(oe>ye){const Ge=this.getClusters([oe,Ae,180,Me],te),Rt=this.getClusters([-180,Ae,ye,Me],te);return Ge.concat(Rt)}const De=this.trees[this._limitZoom(te)],ze=De.range(fs(oe),sr(Me),fs(ye),sr(Ae)),We=De.data,nt=[];for(const Ge of ze){const Rt=this.stride*Ge;nt.push(We[Rt+rr]>1?Yl(We,Rt,this.clusterProps):this.points[We[Rt+cn]])}return nt}getChildren(H){const te=this._getOriginId(H),oe=this._getOriginZoom(H),Ae="No cluster with the specified id.",ye=this.trees[oe];if(!ye)throw new Error(Ae);const Me=ye.data;if(te*this.stride>=Me.length)throw new Error(Ae);const De=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ze=ye.within(Me[te*this.stride],Me[te*this.stride+1],De),We=[];for(const nt of ze){const Ge=nt*this.stride;Me[Ge+4]===H&&We.push(Me[Ge+rr]>1?Yl(Me,Ge,this.clusterProps):this.points[Me[Ge+cn]])}if(We.length===0)throw new Error(Ae);return We}getLeaves(H,te,oe){const Ae=[];return this._appendLeaves(Ae,H,te=te||10,oe=oe||0,0),Ae}getTile(H,te,oe){const Ae=this.trees[this._limitZoom(H)],ye=Math.pow(2,H),{extent:Me,radius:De}=this.options,ze=De/Me,We=(oe-ze)/ye,nt=(oe+1+ze)/ye,Ge={features:[]};return this._addTileFeatures(Ae.range((te-ze)/ye,We,(te+1+ze)/ye,nt),Ae.data,te,oe,ye,Ge),te===0&&this._addTileFeatures(Ae.range(1-ze/ye,We,1,nt),Ae.data,ye,oe,ye,Ge),te===ye-1&&this._addTileFeatures(Ae.range(0,We,ze/ye,nt),Ae.data,-1,oe,ye,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(H){let te=this._getOriginZoom(H)-1;for(;te<=this.options.maxZoom;){const oe=this.getChildren(H);if(te++,oe.length!==1)break;H=oe[0].properties.cluster_id}return te}_appendLeaves(H,te,oe,Ae,ye){const Me=this.getChildren(te);for(const De of Me){const ze=De.properties;if(ze&&ze.cluster?ye+ze.point_count<=Ae?ye+=ze.point_count:ye=this._appendLeaves(H,ze.cluster_id,oe,Ae,ye):ye<Ae?ye++:H.push(De),H.length===oe)break}return ye}_createTree(H){const te=new r.bW(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<H.length;oe+=this.stride)te.add(H[oe],H[oe+1]);return te.finish(),te.data=H,te}_addTileFeatures(H,te,oe,Ae,ye,Me){for(const De of H){const ze=De*this.stride,We=te[ze+rr]>1;let nt,Ge,Rt;if(We)nt=aa(te,ze,this.clusterProps),Ge=te[ze],Rt=te[ze+1];else{const gi=this.points[te[ze+cn]];nt=gi.properties;const[xi,Si]=gi.geometry.coordinates;Ge=fs(xi),Rt=sr(Si)}const zt={type:1,geometry:[[Math.round(this.options.extent*(Ge*ye-oe)),Math.round(this.options.extent*(Rt*ye-Ae))]],tags:nt};let Yt;Yt=We||this.options.generateId?te[ze+cn]:this.points[te[ze+cn]].id,Yt!==void 0&&(zt.id=Yt),Me.features.push(zt)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,te){const{radius:oe,extent:Ae,reduce:ye,minPoints:Me}=this.options,De=oe/(Ae*Math.pow(2,te)),ze=H.data,We=[],nt=this.stride;for(let Ge=0;Ge<ze.length;Ge+=nt){if(ze[Ge+2]<=te)continue;ze[Ge+2]=te;const Rt=ze[Ge],zt=ze[Ge+1],Yt=H.within(ze[Ge],ze[Ge+1],De),gi=ze[Ge+rr];let xi=gi;for(const Si of Yt){const Pi=Si*nt;ze[Pi+2]>te&&(xi+=ze[Pi+rr])}if(xi>gi&&xi>=Me){let Si,Pi=Rt*gi,Hn=zt*gi,Bi=-1;const yn=(Ge/nt<<5)+(te+1)+this.points.length;for(const en of Yt){const An=en*nt;if(ze[An+2]<=te)continue;ze[An+2]=te;const In=ze[An+rr];Pi+=ze[An]*In,Hn+=ze[An+1]*In,ze[An+4]=yn,ye&&(Si||(Si=this._map(ze,Ge,!0),Bi=this.clusterProps.length,this.clusterProps.push(Si)),ye(Si,this._map(ze,An)))}ze[Ge+4]=yn,We.push(Pi/xi,Hn/xi,1/0,yn,-1,xi),ye&&We.push(Bi)}else{for(let Si=0;Si<nt;Si++)We.push(ze[Ge+Si]);if(xi>1)for(const Si of Yt){const Pi=Si*nt;if(!(ze[Pi+2]<=te)){ze[Pi+2]=te;for(let Hn=0;Hn<nt;Hn++)We.push(ze[Pi+Hn])}}}}return We}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,te,oe){if(H[te+rr]>1){const Me=this.clusterProps[H[te+go]];return oe?Object.assign({},Me):Me}const Ae=this.points[H[te+cn]].properties,ye=this.options.map(Ae);return oe&&ye===Ae?Object.assign({},ye):ye}}function Yl(Oe,H,te){return{type:"Feature",id:Oe[H+cn],properties:aa(Oe,H,te),geometry:{type:"Point",coordinates:[(oe=Oe[H],360*(oe-.5)),Wu(Oe[H+1])]}};var oe}function aa(Oe,H,te){const oe=Oe[H+rr],Ae=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,ye=Oe[H+go],Me=ye===-1?{}:Object.assign({},te[ye]);return Object.assign(Me,{cluster:!0,cluster_id:Oe[H+cn],point_count:oe,point_count_abbreviated:Ae})}function fs(Oe){return Oe/360+.5}function sr(Oe){const H=Math.sin(Oe*Math.PI/180),te=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return te<0?0:te>1?1:te}function Wu(Oe){const H=(180-360*Oe)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function $a(Oe,H,te,oe){let Ae=oe;const ye=H+(te-H>>1);let Me,De=te-H;const ze=Oe[H],We=Oe[H+1],nt=Oe[te],Ge=Oe[te+1];for(let Rt=H+3;Rt<te;Rt+=3){const zt=ps(Oe[Rt],Oe[Rt+1],ze,We,nt,Ge);if(zt>Ae)Me=Rt,Ae=zt;else if(zt===Ae){const Yt=Math.abs(Rt-ye);Yt<De&&(Me=Rt,De=Yt)}}Ae>oe&&(Me-H>3&&$a(Oe,H,Me,oe),Oe[Me+2]=Ae,te-Me>3&&$a(Oe,Me,te,oe))}function ps(Oe,H,te,oe,Ae,ye){let Me=Ae-te,De=ye-oe;if(Me!==0||De!==0){const ze=((Oe-te)*Me+(H-oe)*De)/(Me*Me+De*De);ze>1?(te=Ae,oe=ye):ze>0&&(te+=Me*ze,oe+=De*ze)}return Me=Oe-te,De=H-oe,Me*Me+De*De}function Vo(Oe,H,te,oe){const Ae={id:Oe??null,type:H,geometry:te,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")la(Ae,te);else if(H==="Polygon")la(Ae,te[0]);else if(H==="MultiLineString")for(const ye of te)la(Ae,ye);else if(H==="MultiPolygon")for(const ye of te)la(Ae,ye[0]);return Ae}function la(Oe,H){for(let te=0;te<H.length;te+=3)Oe.minX=Math.min(Oe.minX,H[te]),Oe.minY=Math.min(Oe.minY,H[te+1]),Oe.maxX=Math.max(Oe.maxX,H[te]),Oe.maxY=Math.max(Oe.maxY,H[te+1])}function ls(Oe,H,te,oe){if(!H.geometry)return;const Ae=H.geometry.coordinates;if(Ae&&Ae.length===0)return;const ye=H.geometry.type,Me=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2);let De=[],ze=H.id;if(te.promoteId?ze=H.properties[te.promoteId]:te.generateId&&(ze=oe||0),ye==="Point")ko(Ae,De);else if(ye==="MultiPoint")for(const We of Ae)ko(We,De);else if(ye==="LineString")ja(Ae,De,Me,!1);else if(ye==="MultiLineString"){if(te.lineMetrics){for(const We of Ae)De=[],ja(We,De,Me,!1),Oe.push(Vo(ze,"LineString",De,H.properties));return}$o(Ae,De,Me,!1)}else if(ye==="Polygon")$o(Ae,De,Me,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const We of H.geometry.geometries)ls(Oe,{id:ze,geometry:We,properties:H.properties},te,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const We of Ae){const nt=[];$o(We,nt,Me,!0),De.push(nt)}}Oe.push(Vo(ze,ye,De,H.properties))}function ko(Oe,H){H.push(ca(Oe[0]),ms(Oe[1]),0)}function ja(Oe,H,te,oe){let Ae,ye,Me=0;for(let ze=0;ze<Oe.length;ze++){const We=ca(Oe[ze][0]),nt=ms(Oe[ze][1]);H.push(We,nt,0),ze>0&&(Me+=oe?(Ae*nt-We*ye)/2:Math.sqrt(Math.pow(We-Ae,2)+Math.pow(nt-ye,2))),Ae=We,ye=nt}const De=H.length-3;H[2]=1,$a(H,0,De,te),H[De+2]=1,H.size=Math.abs(Me),H.start=0,H.end=H.size}function $o(Oe,H,te,oe){for(let Ae=0;Ae<Oe.length;Ae++){const ye=[];ja(Oe[Ae],ye,te,oe),H.push(ye)}}function ca(Oe){return Oe/360+.5}function ms(Oe){const H=Math.sin(Oe*Math.PI/180),te=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return te<0?0:te>1?1:te}function gs(Oe,H,te,oe,Ae,ye,Me,De){if(oe/=H,ye>=(te/=H)&&Me<oe)return Oe;if(Me<te||ye>=oe)return null;const ze=[];for(const We of Oe){const nt=We.geometry;let Ge=We.type;const Rt=Ae===0?We.minX:We.minY,zt=Ae===0?We.maxX:We.maxY;if(Rt>=te&&zt<oe){ze.push(We);continue}if(zt<te||Rt>=oe)continue;let Yt=[];if(Ge==="Point"||Ge==="MultiPoint")Lc(nt,Yt,te,oe,Ae);else if(Ge==="LineString")Ha(nt,Yt,te,oe,Ae,!1,De.lineMetrics);else if(Ge==="MultiLineString")Po(nt,Yt,te,oe,Ae,!1);else if(Ge==="Polygon")Po(nt,Yt,te,oe,Ae,!0);else if(Ge==="MultiPolygon")for(const gi of nt){const xi=[];Po(gi,xi,te,oe,Ae,!0),xi.length&&Yt.push(xi)}if(Yt.length){if(De.lineMetrics&&Ge==="LineString"){for(const gi of Yt)ze.push(Vo(We.id,Ge,gi,We.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(Yt.length===1?(Ge="LineString",Yt=Yt[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=Yt.length===3?"Point":"MultiPoint"),ze.push(Vo(We.id,Ge,Yt,We.tags))}}return ze.length?ze:null}function Lc(Oe,H,te,oe,Ae){for(let ye=0;ye<Oe.length;ye+=3){const Me=Oe[ye+Ae];Me>=te&&Me<=oe&&ha(H,Oe[ye],Oe[ye+1],Oe[ye+2])}}function Ha(Oe,H,te,oe,Ae,ye,Me){let De=Zl(Oe);const ze=Ae===0?Ms:Wa;let We,nt,Ge=Oe.start;for(let xi=0;xi<Oe.length-3;xi+=3){const Si=Oe[xi],Pi=Oe[xi+1],Hn=Oe[xi+2],Bi=Oe[xi+3],yn=Oe[xi+4],en=Ae===0?Si:Pi,An=Ae===0?Bi:yn;let In=!1;Me&&(We=Math.sqrt(Math.pow(Si-Bi,2)+Math.pow(Pi-yn,2))),en<te?An>te&&(nt=ze(De,Si,Pi,Bi,yn,te),Me&&(De.start=Ge+We*nt)):en>oe?An<oe&&(nt=ze(De,Si,Pi,Bi,yn,oe),Me&&(De.start=Ge+We*nt)):ha(De,Si,Pi,Hn),An<te&&en>=te&&(nt=ze(De,Si,Pi,Bi,yn,te),In=!0),An>oe&&en<=oe&&(nt=ze(De,Si,Pi,Bi,yn,oe),In=!0),!ye&&In&&(Me&&(De.end=Ge+We*nt),H.push(De),De=Zl(Oe)),Me&&(Ge+=We)}let Rt=Oe.length-3;const zt=Oe[Rt],Yt=Oe[Rt+1],gi=Ae===0?zt:Yt;gi>=te&&gi<=oe&&ha(De,zt,Yt,Oe[Rt+2]),Rt=De.length-3,ye&&Rt>=3&&(De[Rt]!==De[0]||De[Rt+1]!==De[1])&&ha(De,De[0],De[1],De[2]),De.length&&H.push(De)}function Zl(Oe){const H=[];return H.size=Oe.size,H.start=Oe.start,H.end=Oe.end,H}function Po(Oe,H,te,oe,Ae,ye){for(const Me of Oe)Ha(Me,H,te,oe,Ae,ye,!1)}function ha(Oe,H,te,oe){Oe.push(H,te,oe)}function Ms(Oe,H,te,oe,Ae,ye){const Me=(ye-H)/(oe-H);return ha(Oe,ye,te+(Ae-te)*Me,1),Me}function Wa(Oe,H,te,oe,Ae,ye){const Me=(ye-te)/(Ae-te);return ha(Oe,H+(oe-H)*Me,ye,1),Me}function Ga(Oe,H){const te=[];for(let oe=0;oe<Oe.length;oe++){const Ae=Oe[oe],ye=Ae.type;let Me;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Me=jo(Ae.geometry,H);else if(ye==="MultiLineString"||ye==="Polygon"){Me=[];for(const De of Ae.geometry)Me.push(jo(De,H))}else if(ye==="MultiPolygon"){Me=[];for(const De of Ae.geometry){const ze=[];for(const We of De)ze.push(jo(We,H));Me.push(ze)}}te.push(Vo(Ae.id,ye,Me,Ae.tags))}return te}function jo(Oe,H){const te=[];te.size=Oe.size,Oe.start!==void 0&&(te.start=Oe.start,te.end=Oe.end);for(let oe=0;oe<Oe.length;oe+=3)te.push(Oe[oe]+H,Oe[oe+1],Oe[oe+2]);return te}function er(Oe,H){if(Oe.transformed)return Oe;const te=1<<Oe.z,oe=Oe.x,Ae=Oe.y;for(const ye of Oe.features){const Me=ye.geometry,De=ye.type;if(ye.geometry=[],De===1)for(let ze=0;ze<Me.length;ze+=2)ye.geometry.push(ua(Me[ze],Me[ze+1],H,te,oe,Ae));else for(let ze=0;ze<Me.length;ze++){const We=[];for(let nt=0;nt<Me[ze].length;nt+=2)We.push(ua(Me[ze][nt],Me[ze][nt+1],H,te,oe,Ae));ye.geometry.push(We)}}return Oe.transformed=!0,Oe}function ua(Oe,H,te,oe,Ae,ye){return[Math.round(te*(Oe*oe-Ae)),Math.round(te*(H*oe-ye))]}function ml(Oe,H,te,oe,Ae){const ye=H===Ae.maxZoom?0:Ae.tolerance/((1<<H)*Ae.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:Oe.length,source:null,x:te,y:oe,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const De of Oe)On(Me,De,ye,Ae);return Me}function On(Oe,H,te,oe){const Ae=H.geometry,ye=H.type,Me=[];if(Oe.minX=Math.min(Oe.minX,H.minX),Oe.minY=Math.min(Oe.minY,H.minY),Oe.maxX=Math.max(Oe.maxX,H.maxX),Oe.maxY=Math.max(Oe.maxY,H.maxY),ye==="Point"||ye==="MultiPoint")for(let De=0;De<Ae.length;De+=3)Me.push(Ae[De],Ae[De+1]),Oe.numPoints++,Oe.numSimplified++;else if(ye==="LineString")Qs(Me,Ae,Oe,te,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let De=0;De<Ae.length;De++)Qs(Me,Ae[De],Oe,te,ye==="Polygon",De===0);else if(ye==="MultiPolygon")for(let De=0;De<Ae.length;De++){const ze=Ae[De];for(let We=0;We<ze.length;We++)Qs(Me,ze[We],Oe,te,!0,We===0)}if(Me.length){let De=H.tags||null;if(ye==="LineString"&&oe.lineMetrics){De={};for(const We in H.tags)De[We]=H.tags[We];De.mapbox_clip_start=Ae.start/Ae.size,De.mapbox_clip_end=Ae.end/Ae.size}const ze={geometry:Me,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:De};H.id!==null&&(ze.id=H.id),Oe.features.push(ze)}}function Qs(Oe,H,te,oe,Ae,ye){const Me=oe*oe;if(oe>0&&H.size<(Ae?Me:oe))return void(te.numPoints+=H.length/3);const De=[];for(let ze=0;ze<H.length;ze+=3)(oe===0||H[ze+2]>Me)&&(te.numSimplified++,De.push(H[ze],H[ze+1])),te.numPoints++;Ae&&function(ze,We){let nt=0;for(let Ge=0,Rt=ze.length,zt=Rt-2;Ge<Rt;zt=Ge,Ge+=2)nt+=(ze[Ge]-ze[zt])*(ze[Ge+1]+ze[zt+1]);if(nt>0===We)for(let Ge=0,Rt=ze.length;Ge<Rt/2;Ge+=2){const zt=ze[Ge],Yt=ze[Ge+1];ze[Ge]=ze[Rt-2-Ge],ze[Ge+1]=ze[Rt-1-Ge],ze[Rt-2-Ge]=zt,ze[Rt-1-Ge]=Yt}}(De,ye),Oe.push(De)}const Xa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Nr{constructor(H,te){const oe=(te=this.options=function(ye,Me){for(const De in Me)ye[De]=Me[De];return ye}(Object.create(Xa),te)).debug;if(oe&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ae=function(ye,Me){const De=[];if(ye.type==="FeatureCollection")for(let ze=0;ze<ye.features.length;ze++)ls(De,ye.features[ze],Me,ze);else ls(De,ye.type==="Feature"?ye:{geometry:ye},Me);return De}(H,te);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ae=function(ye,Me){const De=Me.buffer/Me.extent;let ze=ye;const We=gs(ye,1,-1-De,De,0,-1,2,Me),nt=gs(ye,1,1-De,2+De,0,-1,2,Me);return(We||nt)&&(ze=gs(ye,1,-De,1+De,0,-1,2,Me)||[],We&&(ze=Ga(We,1).concat(ze)),nt&&(ze=ze.concat(Ga(nt,-1)))),ze}(Ae,te),Ae.length&&this.splitTile(Ae,0,0,0),oe&&(Ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,te,oe,Ae,ye,Me,De){const ze=[H,te,oe,Ae],We=this.options,nt=We.debug;for(;ze.length;){Ae=ze.pop(),oe=ze.pop(),te=ze.pop(),H=ze.pop();const Ge=1<<te,Rt=zc(te,oe,Ae);let zt=this.tiles[Rt];if(!zt&&(nt>1&&console.time("creation"),zt=this.tiles[Rt]=ml(H,te,oe,Ae,We),this.tileCoords.push({z:te,x:oe,y:Ae}),nt)){nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,oe,Ae,zt.numFeatures,zt.numPoints,zt.numSimplified),console.timeEnd("creation"));const In=`z${te}`;this.stats[In]=(this.stats[In]||0)+1,this.total++}if(zt.source=H,ye==null){if(te===We.indexMaxZoom||zt.numPoints<=We.indexMaxPoints)continue}else{if(te===We.maxZoom||te===ye)continue;if(ye!=null){const In=ye-te;if(oe!==Me>>In||Ae!==De>>In)continue}}if(zt.source=null,H.length===0)continue;nt>1&&console.time("clipping");const Yt=.5*We.buffer/We.extent,gi=.5-Yt,xi=.5+Yt,Si=1+Yt;let Pi=null,Hn=null,Bi=null,yn=null,en=gs(H,Ge,oe-Yt,oe+xi,0,zt.minX,zt.maxX,We),An=gs(H,Ge,oe+gi,oe+Si,0,zt.minX,zt.maxX,We);H=null,en&&(Pi=gs(en,Ge,Ae-Yt,Ae+xi,1,zt.minY,zt.maxY,We),Hn=gs(en,Ge,Ae+gi,Ae+Si,1,zt.minY,zt.maxY,We),en=null),An&&(Bi=gs(An,Ge,Ae-Yt,Ae+xi,1,zt.minY,zt.maxY,We),yn=gs(An,Ge,Ae+gi,Ae+Si,1,zt.minY,zt.maxY,We),An=null),nt>1&&console.timeEnd("clipping"),ze.push(Pi||[],te+1,2*oe,2*Ae),ze.push(Hn||[],te+1,2*oe,2*Ae+1),ze.push(Bi||[],te+1,2*oe+1,2*Ae),ze.push(yn||[],te+1,2*oe+1,2*Ae+1)}}getTile(H,te,oe){H=+H,te=+te,oe=+oe;const Ae=this.options,{extent:ye,debug:Me}=Ae;if(H<0||H>24)return null;const De=1<<H,ze=zc(H,te=te+De&De-1,oe);if(this.tiles[ze])return er(this.tiles[ze],ye);Me>1&&console.log("drilling down to z%d-%d-%d",H,te,oe);let We,nt=H,Ge=te,Rt=oe;for(;!We&&nt>0;)nt--,Ge>>=1,Rt>>=1,We=this.tiles[zc(nt,Ge,Rt)];return We&&We.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",nt,Ge,Rt),console.time("drilling down")),this.splitTile(We.source,nt,Ge,Rt,H,te,oe),Me>1&&console.timeEnd("drilling down"),this.tiles[ze]?er(this.tiles[ze],ye):null):null}}function zc(Oe,H,te){return 32*((1<<Oe)*te+H)+Oe}function Mh(Oe,H){const te=Oe.tileID.canonical;if(!this._geoJSONIndex)return void H(null,null);const oe=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!oe)return void H(null,null);const Ae=new Je(oe.features);let ye=Js(Ae);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),H(null,{vectorTile:Ae,rawData:ye.buffer})}class ke extends ne{constructor(H,te,oe,Ae,ye,Me,De){super(H,te,oe,Ae,ye,Mh,De),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new St}loadData(H,te){const oe=H&&H.request,Ae=oe&&oe.collectResourceTiming;this.loadGeoJSON(H,(ye,Me)=>{if(ye||!Me)return te(ye);if(typeof Me!="object")return te(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{try{if(H.filter){const ze=r.X(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(We=>`${We.key}: ${We.message}`).join(", "));Me.features=Me.features.filter(We=>ze.value.evaluate({zoom:0},We))}H.dynamic?(Me.type==="Feature"&&(Me={type:"FeatureCollection",features:[Me]}),H.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Me.features,this.loaded),H.cluster&&(Me.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=H.cluster?new jn(function({superclusterOptions:ze,clusterProperties:We}){if(!We||!ze)return ze;const nt={},Ge={},Rt={accumulated:null,zoom:0},zt={properties:null},Yt=Object.keys(We);for(const gi of Yt){const[xi,Si]=We[gi],Pi=r.X(Si),Hn=r.X(typeof xi=="string"?[xi,["accumulated"],["get",gi]]:xi);nt[gi]=Pi.value,Ge[gi]=Hn.value}return ze.map=gi=>{zt.properties=gi;const xi={};for(const Si of Yt)xi[Si]=nt[Si].evaluate(Rt,zt);return xi},ze.reduce=(gi,xi)=>{zt.properties=xi;for(const Si of Yt)Rt.accumulated=gi[Si],gi[Si]=Ge[Si].evaluate(Rt,zt)},ze}(H)).load(Me.features):H.dynamic?this._dynamicIndex:function(ze,We){return new Nr(ze,We)}(Me,H.geojsonVtOptions)}catch(ze){return te(ze)}const De={};if(Ae){const ze=b(oe);ze&&(De.resourceTiming={},De.resourceTiming[H.source]=JSON.parse(JSON.stringify(ze)))}te(null,De)}})}reloadTile(H,te){const oe=this.loaded;return oe&&oe[H.uid]?H.partial?te(null,void 0):super.reloadTile(H,te):this.loadTile(H,te)}loadGeoJSON(H,te){if(H.request)r.n(H.request,te);else{if(typeof H.data!="string")return te(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));try{return te(null,JSON.parse(H.data))}catch{return te(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(H,te){try{te(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(oe){te(oe)}}getClusterChildren(H,te){try{te(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(oe){te(oe)}}getClusterLeaves(H,te){try{te(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(oe){te(oe)}}}class ue{constructor(H,te){this.tileID=new r.aM(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.tileZoom=H.tileZoom,this.uid=H.uid,this.zoom=H.zoom,this.canonical=H.tileID.canonical,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=H.projection,this.brightness=te}parse(H,te,oe,Ae){this.status="parsing";const ye=new r.aM(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),Me=[],De=te.familiesBySource[oe.source],ze=new r.f0(ye,oe.promoteId);ze.bucketLayerIDs=[],ze.is3DTile=!0,r.fi(H).then(We=>{if(!We)return Ae(new Error("Could not parse tile"));const nt=r.fj(We,1/r.cT(oe.tileID.canonical)),Ge=We.json.extensionsUsed&&We.json.extensionsUsed.includes("MAPBOX_mesh_features")||We.json.asset.extras&&We.json.asset.extras.MAPBOX_mesh_features,Rt=We.json.extensionsUsed&&We.json.extensionsUsed.includes("EXT_meshopt_compression"),zt=new r.aa(this.zoom,{brightness:this.brightness});for(const Yt in De)for(const gi of De[Yt]){const xi=gi[0];ze.bucketLayerIDs.push(gi.map(Pi=>r.C(Pi.id,Pi.scope))),xi.recalculate(zt,[]);const Si=new r.fk(gi,nt,ye,Ge,Rt,this.brightness,ze);Ge||(Si.needsUpload=!0),Me.push(Si),Si.evaluate(xi)}this.status="done",Ae(null,{buckets:Me,featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(We=>Ae(new Error(We.message)))}}class st{constructor(H,te,oe,Ae,ye,Me,De){this.actor=H,this.layerIndex=te,this.availableImages=oe,this.availableModels=Ae,this.brightness=De,this.loading={},this.loaded={}}loadTile(H,te){const oe=H.uid,Ae=this.loading[oe]=new ue(H,this.brightness);r.br(H.request,(ye,Me)=>{const De=!this.loading[oe];return delete this.loading[oe],De||ye?(Ae.status="done",De||(this.loaded[oe]=Ae),te(ye)):Me&&Me.byteLength!==0?void Ae.parse(Me,this.layerIndex,H,(ze,We)=>{Ae.status="done",this.loaded=this.loaded||{},this.loaded[oe]=Ae,ze||!We?te(ze):te(null,We)}):(Ae.status="done",this.loaded[oe]=Ae,te())})}reloadTile(H,te){const oe=this.loaded,Ae=H.uid;if(oe&&oe[Ae]){const ye=oe[Ae];ye.projection=H.projection,ye.brightness=H.brightness;const Me=(De,ze)=>{ye.reloadCallback&&(delete ye.reloadCallback,this.loadTile(H,te)),te(De,ze)};ye.status==="parsing"?ye.reloadCallback=Me:ye.status==="done"&&this.loadTile(H,te)}}abortTile(H,te){const oe=H.uid;this.loading[oe]&&delete this.loading[oe],te()}removeTile(H,te){const oe=this.loaded,Ae=H.uid;oe&&oe[Ae]&&delete oe[Ae],te()}}class Pt{constructor(H){this.self=H,this.actor=new r.fm(H,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.y,this.projections={},this.defaultProjection=r.ce({name:"mercator"}),this.workerSourceTypes={vector:ne,geojson:ke,"raster-dem":_e,"raster-array":we,"batched-model":st},this.workerSources={},this.self.registerWorkerSource=(te,oe)=>{if(this.workerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.workerSourceTypes[te]=oe},this.self.registerRTLTextPlugin=te=>{if(r.fn.isParsed())throw new Error("RTL text plugin already registered.");r.fn.applyArabicShaping=te.applyArabicShaping,r.fn.processBidirectionalText=te.processBidirectionalText,r.fn.processStyledBidirectionalText=te.processStyledBidirectionalText}}clearCaches(H,te,oe){delete this.layerIndexes[H],delete this.availableImages[H],delete this.availableModels[H],delete this.workerSources[H],oe()}checkIfReady(H,te,oe){oe()}setReferrer(H,te){this.referrer=te}spriteLoaded(H,te){this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={});const{scope:oe,isLoaded:Ae}=te;if(this.isSpriteLoaded[H][oe]=Ae,this.workerSources[H]&&this.workerSources[H][oe])for(const ye in this.workerSources[H][oe]){const Me=this.workerSources[H][oe][ye];for(const De in Me){const ze=Me[De];ze instanceof ne&&(ze.isSpriteLoaded=Ae,ze.fire(new r.A("isSpriteLoaded")))}}}setImages(H,te,oe){this.availableImages[H]||(this.availableImages[H]={});const{scope:Ae,images:ye}=te;if(this.availableImages[H][Ae]=ye,this.workerSources[H]&&this.workerSources[H][Ae]){for(const Me in this.workerSources[H][Ae]){const De=this.workerSources[H][Ae][Me];for(const ze in De)De[ze].availableImages=ye}oe()}else oe()}setModels(H,{scope:te,models:oe},Ae){if(this.availableModels[H]||(this.availableModels[H]={}),this.availableModels[H][te]=oe,this.workerSources[H]&&this.workerSources[H][te]){for(const ye in this.workerSources[H][te]){const Me=this.workerSources[H][te][ye];for(const De in Me)Me[De].availableModels=oe}Ae()}else Ae()}setProjection(H,te){this.projections[H]=r.ce(te)}setBrightness(H,te,oe){this.brightness=te,oe()}setLayers(H,te,oe){this.getLayerIndex(H,te.scope).replace(te.layers,te.options),oe()}updateLayers(H,te,oe){this.getLayerIndex(H,te.scope).update(te.layers,te.removedIds,te.options),oe()}loadTile(H,te,oe){te.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,te.type,te.source,te.scope).loadTile(te,oe)}decodeRasterArray(H,te,oe){this.getWorkerSource(H,te.type,te.source,te.scope).decodeRasterArray(te,oe)}reloadTile(H,te,oe){te.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,te.type,te.source,te.scope).reloadTile(te,oe)}abortTile(H,te,oe){this.getWorkerSource(H,te.type,te.source,te.scope).abortTile(te,oe)}removeTile(H,te,oe){this.getWorkerSource(H,te.type,te.source,te.scope).removeTile(te,oe)}removeSource(H,te,oe){if(!(this.workerSources[H]&&this.workerSources[H][te.scope]&&this.workerSources[H][te.scope][te.type]&&this.workerSources[H][te.scope][te.type][te.source]))return;const Ae=this.workerSources[H][te.scope][te.type][te.source];delete this.workerSources[H][te.scope][te.type][te.source],Ae.removeSource!==void 0?Ae.removeSource(te,oe):oe()}loadWorkerSource(H,te,oe){try{this.self.importScripts(te.url),oe()}catch(Ae){oe(Ae.toString())}}syncRTLPluginState(H,te,oe){try{r.fn.setState(te);const Ae=r.fn.getPluginURL();if(r.fn.isLoaded()&&!r.fn.isParsed()&&Ae!=null){this.self.importScripts(Ae);const ye=r.fn.isParsed();oe(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ae}`),ye)}}catch(Ae){oe(Ae.toString())}}setDracoUrl(H,te){this.dracoUrl=te}getAvailableImages(H,te){this.availableImages[H]||(this.availableImages[H]={});let oe=this.availableImages[H][te];return oe||(oe=[]),oe}getAvailableModels(H,te){this.availableModels[H]||(this.availableModels[H]={});let oe=this.availableModels[H][te];return oe||(oe={}),oe}getLayerIndex(H,te){this.layerIndexes[H]||(this.layerIndexes[H]={});let oe=this.layerIndexes[H][te];return oe||(oe=this.layerIndexes[H][te]=new k,oe.scope=te),oe}getWorkerSource(H,te,oe,Ae){const ye=this.workerSources;return ye[H]||(ye[H]={}),ye[H][Ae]||(ye[H][Ae]={}),ye[H][Ae][te]||(ye[H][Ae][te]={}),this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={}),ye[H][Ae][te][oe]||(ye[H][Ae][te][oe]=new this.workerSourceTypes[te]({send:(Me,De,ze,We,nt,Ge)=>this.actor.send(Me,De,ze,H,nt,Ge),scheduler:this.actor.scheduler},this.getLayerIndex(H,Ae),this.getAvailableImages(H,Ae),this.getAvailableModels(H,Ae),this.isSpriteLoaded[H][Ae],void 0,this.brightness)),ye[H][Ae][te][oe]}rasterizeImagesWorker(H,te,oe){const Ae=new Map;for(const[ye,{image:Me,imageVariant:De}]of te.tasks.entries()){const ze=this.imageRasterizer.rasterize(De,Me,te.scope,H);Ae.set(ye,ze)}oe(void 0,Ae)}removeRasterizedImages(H,te,oe){this.imageRasterizer.removeImagesFromCacheByIds(te.imageIds,te.scope,H),oe()}enforceCacheSizeLimit(H,te){r.fo(te)}getWorkerPerformanceMetrics(H,te,oe){oe(void 0,void 0)}}return r.fl(self)&&(self.worker=new Pt(self)),Pt}),c(["./shared"],function(r){var b="3.12.0";const w={create:"create",load:"load",fullLoad:"fullLoad"},E={mark(m){performance.mark(m)},measure(m,a,u){performance.measure(m,a,u)}};function k(m){const a=m.name.split("?")[0];return r.a(a)&&a.includes("mapbox-gl.js")?"javascript":r.a(a)&&a.includes("mapbox-gl.css")?"css":r.b(a)?"fontRange":r.c(a)?"sprite":r.i(a)?"style":r.d(a)?"tilejson":"other"}var F,$={},X=function(){if(F)return $;function m(g){return!a(g)}function a(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,T,C=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(C);try{T=new Worker(M),x=!0}catch{x=!1}return T&&T.terminate(),URL.revokeObjectURL(M),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var T=x.getContext("2d");if(!T)return!1;var C=T.getImageData(0,0,1,1);return C&&C.width===x.width}()?(u[v=g&&g.failIfMajorPerformanceCaveat]===void 0&&(u[v]=function(x){var T,C=function(M){var D=document.createElement("canvas"),O=Object.create(m.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=M,D.getContext("webgl2",O)}(x);if(!C)return!1;try{T=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!T||C.isContextLost())&&(C.shaderSource(T,"void main() {}"),C.compileShader(T),C.getShaderParameter(T,C.COMPILE_STATUS)===!0)}(v)),u[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}F=1,$.supported=m,$.notSupportedReason=a;var u={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},$}();function W(m,a,u){const g=document.createElement(m);return a!=null&&(g.className=a),u&&u.appendChild(g),g}function ne(m,a,u){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(a))g.setAttributeNS(null,v,String(a[v]));return u&&u.appendChild(g),g}const _e=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Te=_e&&_e.userSelect!==void 0?"userSelect":"WebkitUserSelect";let we;function Ee(){_e&&Te&&(we=_e[Te],_e[Te]="none")}function Le(){_e&&Te&&(_e[Te]=we)}function Je(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Je,!0)}function Tt(){window.addEventListener("click",Je,!0),window.setTimeout(()=>{window.removeEventListener("click",Je,!0)},0)}function _t(m,a){const u=m.getBoundingClientRect();return Lt(m,u,a)}function St(m,a){const u=m.getBoundingClientRect(),g=[];for(let v=0;v<a.length;v++)g.push(Lt(m,u,a[v]));return g}function kt(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function Lt(m,a,u){const g=m.offsetWidth===a.width?1:m.offsetWidth/a.width;return new r.P((u.clientX-a.left)*g,(u.clientY-a.top)*g)}const si="01",bi="NO_ACCESS_TOKEN";class ii{constructor(a,u,g){this._transformRequestFn=a,this._customAccessToken=u,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const a=function(){let u="";for(let g=0;g<10;g++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",si,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}}normalizeStyleURL(a,u){if(!r.f(a))return a;const g=Zi(a);return g.params.push(`sdk=js-${b}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeGlyphsURL(a,u){if(!r.f(a))return a;const g=Zi(a);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeModelURL(a,u){if(!r.f(a))return a;const g=Zi(a);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||u)}normalizeSourceURL(a,u,g,v){if(!r.f(a))return a;const x=Zi(a);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),g&&x.params.push(`language=${g}`),v&&x.params.push(`worldview=${v}`),this._makeAPIURL(x,this._customAccessToken||u)}normalizeIconsetURL(a,u){const g=Zi(a);return r.f(a)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||u)):Cn(g)}normalizeSpriteURL(a,u,g,v){const x=Zi(a);return r.f(a)?(x.path=`/styles/v1${x.path}/sprite${u}${g}`,this._makeAPIURL(x,this._customAccessToken||v)):(x.path+=`${u}${g}`,Cn(x))}normalizeTileURL(a,u,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!r.f(a))return a;const v=Zi(a);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||g&&v.authority!=="raster"&&g===512?"@2x":""}${r.m.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${r.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${r.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${r.e.TILE_URL_VERSION}${v.path}`);const x=this._customAccessToken||function(T){for(const C of T){const M=C.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(v.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,x)}canonicalizeTileURL(a,u){const g=Zi(a);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return a;let v="mapbox://";g.path.match(/^\/raster\/v1\//)?v+=`raster/${g.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${g.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${g.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let x=g.params;return u&&(x=x.filter(T=>!T.match(/^access_token=/))),x.length&&(v+=`?${x.join("&")}`),v}canonicalizeTileset(a,u){const g=!!u&&r.f(u),v=[];for(const x of a.tiles||[])r.h(x)?v.push(this.canonicalizeTileURL(x,g)):v.push(x);return v}_makeAPIURL(a,u){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=Zi(r.e.API_URL);if(a.protocol=v.protocol,a.authority=v.authority,a.protocol==="http"){const x=a.params.indexOf("secure");x>=0&&a.params.splice(x,1)}if(v.path!=="/"&&(a.path=`${v.path}${a.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return Cn(a);if(u=u||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return a.params=a.params.filter(x=>x.indexOf("access_token")===-1),a.params.push(`access_token=${u||""}`),Cn(a)}}const vi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Zi(m){const a=m.match(vi);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Cn(m){const a=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${a}`}const nr="mapbox.eventData";function vr(m){if(!m)return null;const a=m.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(r.j(a[1]))}catch{return null}}class Qi{constructor(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(a){const u=vr(r.e.ACCESS_TOKEN);let g="";return g=u&&u.u?r.k(u.u):r.e.ACCESS_TOKEN||"",a?`${nr}.${a}:${g}`:`${nr}:${g}`}fetchEventData(){const a=r.s("localStorage"),u=this.getStorageKey(),g=this.getStorageKey("uuid");if(a)try{const v=localStorage.getItem(u);v&&(this.eventData=JSON.parse(v));const x=localStorage.getItem(g);x&&(this.anonId=x)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const a=r.s("localStorage"),u=this.getStorageKey(),g=this.getStorageKey("uuid"),v=this.anonId;if(a&&v)try{localStorage.setItem(g,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(u,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(a){}postEvent(a,u,g,v){if(!r.e.EVENTS_URL)return;const x=Zi(r.e.EVENTS_URL);x.params.push(`access_token=${v||r.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(a).toISOString()},C=u?r.l(T,u):T,M={url:Cn(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=r.p(M,D=>{this.pendingRequest=null,g(D),this.saveEventData(),this.processRequests(v)})}queueRequest(a,u){this.queue.push(a),this.processRequests(u)}}const Gr=new class extends Qi{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,a){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(u=>r.f(u)||r.h(u))&&this.queueRequest(Date.now(),a)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const a=vr(r.e.ACCESS_TOKEN),u=a?a.u:r.e.ACCESS_TOKEN;let g=u!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),g=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),T=new Date(v),C=(v-this.eventData.lastSuccess)/864e5;g=g||C>=1||C<-1||x.getDate()!==T.getDate()}else g=!0;g?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:b,skuId:si,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=v,this.eventData.tokenU=u)},m):this.processRequests()}},Js=Gr.postTurnstileEvent.bind(Gr),mo=new class extends Qi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,a,u,g){this.skuToken=a,this.errorCb=g,r.e.EVENTS_URL&&(u||r.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(bi)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:u}=this.queue.shift();a&&this.success[a]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:b,skuId:si,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):a&&(this.success[a]=!0)},m))}remove(){this.errorCb=null}},Is=mo.postMapLoadEvent.bind(mo),on=new class extends Qi{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let a=this.mapInstanceIdMap.get(m);return a||(a=r.u(),this.mapInstanceIdMap.set(m,a)),a}getEventId(m){const a=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,a+1),a}postStyleLoadEvent(m,a){const{map:u,style:g,importedStyles:v}=a;if(!r.e.EVENTS_URL||!m&&!r.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(u),T={mapInstanceId:x,eventId:this.getEventId(x),style:g};v.length&&(T.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:T},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,payload:u}=this.queue.shift();this.postEvent(a,u,()=>{},m)}},cn=on.postStyleLoadEvent.bind(on),rr=new class extends Qi{constructor(){super("gljs.performance")}postPerformanceEvent(m,a){r.e.EVENTS_URL&&(m||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:a},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,performanceData:u}=this.queue.shift(),g=function(v){const x=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),C=function(V){const Y={};if(V){for(const q in V)if(q!=="other")for(const Q of V[q]){const Z=`${q}ResolveRangeMin`,se=`${q}ResolveRangeMax`,de=`${q}RequestCount`,me=`${q}RequestCachedCount`;Y[Z]=Math.min(Y[Z]||1/0,Q.startTime),Y[se]=Math.max(Y[se]||-1/0,Q.responseEnd);const Se=ve=>{Y[ve]===void 0&&(Y[ve]=0),++Y[ve]};Q.transferSize!==void 0&&Q.transferSize===0&&Se(me),Se(de)}}return Y}(function(V,Y){const q={};if(V)for(const Q of V){const Z=Y(Q);q[Z]===void 0&&(q[Z]=[]),q[Z].push(Q)}return q}(x,k)),M=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,O=D?D.effectiveType:void 0,z={counters:[],metadata:[],attributes:[]},L=(V,Y,q)=>{q!=null&&V.push({name:Y,value:q.toString()})};for(const V in C)L(z.counters,V,C[V]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(L(z.counters,"interactionRangeMin",v.interactionRange[0]),L(z.counters,"interactionRangeMax",v.interactionRange[1])),T)for(const V of Object.keys(w)){const Y=w[V],q=T.find(Q=>Q.name===Y);q&&L(z.counters,Y,q.startTime)}return L(z.counters,"visibilityHidden",v.visibilityHidden),L(z.attributes,"style",function(V){if(V)for(const Y of V){const q=Y.name.split("?")[0];if(r.i(q)){const Q=q.split("/").slice(-2);if(Q.length===2)return`mapbox://styles/${Q[0]}/${Q[1]}`}}}(x)),L(z.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),L(z.attributes,"fogEnabled",v.fogEnabled?"true":"false"),L(z.attributes,"projection",v.projection),L(z.attributes,"zoom",v.zoom),L(z.metadata,"devicePixelRatio",M),L(z.metadata,"connectionEffectiveType",O),L(z.metadata,"navigatorUserAgent",navigator.userAgent),L(z.metadata,"screenWidth",window.screen.width),L(z.metadata,"screenHeight",window.screen.height),L(z.metadata,"windowWidth",window.innerWidth),L(z.metadata,"windowHeight",window.innerHeight),L(z.metadata,"mapWidth",v.width/M),L(z.metadata,"mapHeight",v.height/M),L(z.metadata,"webglRenderer",v.renderer),L(z.metadata,"webglVendor",v.vendor),L(z.metadata,"sdkVersion",b),L(z.metadata,"sdkIdentifier","mapbox-gl-js"),z}(u);for(const v of g.metadata);for(const v of g.counters);for(const v of g.attributes);this.postEvent(a,g,()=>{},m)}},go=rr.postPerformanceEvent.bind(rr),jn=new class extends Qi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,a,u,g){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const v=Zi(r.e.API_URL+r.e.SESSION_PATH);v.params.push(`sku=${a||""}`),v.params.push(`access_token=${g||r.e.ACCESS_TOKEN||""}`);const x={url:Cn(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(x,T=>{this.pendingRequest=null,u(T),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,a,u,g){this.skuToken=a,this.errorCb=g,r.e.SESSION_PATH&&r.e.API_URL&&(u||r.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(bi)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:u}=this.queue.shift();a&&this.success[a]||this.getSession(u,this.skuToken,g=>{g?this.errorCb(g):a&&(this.success[a]=!0)},m)}remove(){this.errorCb=null}},Yl=jn.getSessionAPI.bind(jn),aa=new Set;function fs(m,a){a?aa.add(m):aa.delete(m)}class sr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,u){this._updatedSourceCaches[a]=u,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){const u=a.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(a.id),this.setDirty()}removeLayer(a){const u=a.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][a.id]=a,this._updatedLayers[u].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){const a={};for(const u in this._updatedLayers)a[u]=a[u]||{},a[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)a[u]=a[u]||{},a[u].removedIds=Object.keys(this._removedLayers[u]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(a){return this._updatedImages[a]?Array.from(this._updatedImages[a].values()):[]}updateImage(a,u){this._updatedImages[u]=this._updatedImages[u]||new Set,this._updatedImages[u].add(r.I.toString(a)),this.setDirty()}resetUpdatedImages(a){this._updatedImages[a]&&this._updatedImages[a].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Wu(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class $a extends r.E{constructor(a){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=a,a!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}addScope(a){this.loaded.set(a,!1),this.imageProviders.set(a,new Map),this.images.set(a,new Map),this.updatedImages.set(a,new Set),this.callbackDispatchedThisFrame.set(a,new Set),this.patterns.set(a,new Map),this.atlasImage.set(a,new r.r({width:1,height:1}))}removeScope(a){this.loaded.delete(a),this.imageProviders.delete(a),this.images.delete(a),this.updatedImages.delete(a),this.callbackDispatchedThisFrame.delete(a),this.patterns.delete(a),this.atlasImage.delete(a);const u=this.atlasTexture.get(a);u&&(u.destroy(),this.atlasTexture.delete(a))}addImageProvider(a,u){this.imageProviders.has(u)||this.imageProviders.set(u,new Map),this.imageProviders.get(u).set(a.id,a)}removeImageProvider(a,u){this.imageProviders.has(u)&&this.imageProviders.get(u).delete(a)}getPendingImageProviders(){const a=[];for(const u of this.imageProviders.values())for(const g of u.values())g.hasPendingRequests()&&a.push(g);return a}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.y),this._imageRasterizer}isLoaded(){for(const a of this.loaded.keys())if(!this.loaded.get(a))return!1;return!0}setLoaded(a,u){if(this.loaded.get(u)!==a&&(this.loaded.set(u,a),a)){for(const{ids:g,callback:v}of this.requestors)this._notify(g,u,v);this.requestors=[]}}hasImage(a,u){return!!this.getImage(a,u)}getImage(a,u){return this.images.get(u).get(a.toString())}addImage(a,u,g){this._validate(a,g)&&this.images.get(u).set(a.toString(),g)}_validate(a,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new r.z(new Error(`Image "${a.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new r.z(new Error(`Image "${a.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new r.z(new Error(`Image "${a.name}" has invalid "content" value`))),g=!1),g}_validateStretch(a,u){if(!a)return!0;let g=0;for(const v of a){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(a,u){return a?a.length!==4||!u.usvg&&(a[0]<0||u.data.width<a[0]||a[1]<0||u.data.height<a[1]||a[2]<0||u.data.width<a[2]||a[3]<0||u.data.height<a[3])?!1:!(a[2]<a[0]||a[3]<a[1]):!0}updateImage(a,u,g){const v=this.images.get(u).get(a.toString());g.version=v.version+1,this.images.get(u).set(a.toString(),g),this.updatedImages.get(u).add(a),this.removeFromImageRasterizerCache(a,u)}clearUpdatedImages(a){this.updatedImages.get(a).clear()}removeFromImageRasterizerCache(a,u){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[a],scope:u}):this.imageRasterizer.removeImagesFromCacheByIds([a],u))}removeImage(a,u){const g=this.images.get(u),v=g.get(a.toString());g.delete(a.toString()),this.patterns.get(u).delete(a.toString()),this.removeFromImageRasterizerCache(a,u),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(a){return Array.from(this.images.get(a).keys()).map(u=>r.I.from(u))}getImages(a,u,g){const v=[],x=[],T=this.imageProviders.get(u);for(const O of a){if(!O.iconsetId){v.push(O);continue}const z=T.get(O.iconsetId);z&&(this.getImage(O,u)?x.push(O):z.addPendingRequest(O))}if(v.length===0)return void this._notify(x,u,g);let C=!0;const M=!!this.loaded.get(u),D=this.images.get(u);if(!M)for(const O of v)D.has(O.toString())||(C=!1);M||C?this._notify(v,u,g):this.requestors.push({ids:v,scope:u,callback:g})}rasterizeImages(a,u){const g=new Map,{tasks:v,scope:x}=a;for(const[T,C]of v.entries()){const M=this.getImage(C.id,x);M&&g.set(T,{image:M,imageVariant:C})}this._rasterizeImages(x,g,u)}_rasterizeImages(a,u,g){if(r.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:u,scope:a},g);else{const v=new Map;for(const[x,{image:T,imageVariant:C}]of u.entries())v.set(x,this.imageRasterizer.rasterize(C,T,a,0));g(void 0,v)}}getUpdatedImages(a){return this.updatedImages.get(a)||new Set}_notify(a,u,g){const v=this.images.get(u),x=new Map;for(const T of a){if(!v.get(T.toString())){if(T.iconsetId)continue;this.fire(new r.A("styleimagemissing",{id:T.name}))}const C=v.get(T.toString());if(!C){r.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const M={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)};C.usvg&&Object.assign(M,{width:C.icon.usvg_tree.width,height:C.icon.usvg_tree.height}),x.set(r.I.toString(T),M)}g(null,x)}getPixelSize(a){const{width:u,height:g}=this.atlasImage.get(a);return{width:u,height:g}}getPattern(a,u,g){const v=a.toString(),x=this.patterns.get(u),T=x.get(v),C=this.getImage(a,u);if(!C)return null;if(T){if(T.position.version===C.version)return T.position;T.position.version=C.version}else{if(C.usvg&&!C.data){const M=this.getPatternInFlightId(v,u);if(this.patternsInFlight.has(M))return null;this.patternsInFlight.add(M);const D=new r.B(a).scaleSelf(r.q.devicePixelRatio),O=new Map([[D.toString(),{image:C,imageVariant:D}]]);return this._rasterizeImages(u,O,(z,L)=>this.storePatternImage(D,u,C,g,L)),null}this.storePattern(a,u,C)}return this._updatePatternAtlas(u,g),x.get(v).position}getPatternInFlightId(a,u){return r.C(a,u)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(a,u,g,v,x){const T=a.toString(),C=x?x.get(T):void 0;C&&(g.data=C,this.storePattern(a.id,u,g),this._updatePatternAtlas(u,v),this.patternsInFlight.delete(this.getPatternInFlightId(a.id.toString(),u)))}storePattern(a,u,g){const v={w:g.data.width+2*r.F,h:g.data.height+2*r.F,x:0,y:0},x=new r.G(v,g,r.F);this.patterns.get(u).set(a.toString(),{bin:v,position:x})}bind(a,u){const g=a.gl;let v=this.atlasTexture.get(u);v?this.dirty&&(v.update(this.atlasImage.get(u)),this.dirty=!1):(v=new r.T(a,this.atlasImage.get(u),g.RGBA8),this.atlasTexture.set(u,v)),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(a,u){const g=this.patterns.get(a),v=Array.from(g.values()).map(({bin:D})=>D),{w:x,h:T}=r.H(v),C=this.atlasImage.get(a);C.resize({width:x||1,height:T||1});const M=this.images.get(a);for(const[D,{bin:O,position:z}]of g.entries()){let L=z.padding;const V=O.x+L,Y=O.y+L,q=M.get(D).data,Q=q.width,Z=q.height;L=L>1?L-1:L,r.r.copy(q,C,{x:0,y:0},{x:V,y:Y},{width:Q,height:Z},u),r.r.copy(q,C,{x:0,y:Z-L},{x:V,y:Y-L},{width:Q,height:L},u),r.r.copy(q,C,{x:0,y:0},{x:V,y:Y+Z},{width:Q,height:L},u),r.r.copy(q,C,{x:Q-L,y:0},{x:V-L,y:Y},{width:L,height:Z},u),r.r.copy(q,C,{x:0,y:0},{x:V+Q,y:Y},{width:L,height:Z},u),r.r.copy(q,C,{x:Q-L,y:Z-L},{x:V-L,y:Y-L},{width:L,height:L},u),r.r.copy(q,C,{x:0,y:Z-L},{x:V+Q,y:Y-L},{width:L,height:L},u),r.r.copy(q,C,{x:0,y:0},{x:V+Q,y:Y+Z},{width:L,height:L},u),r.r.copy(q,C,{x:Q-L,y:0},{x:V-L,y:Y+Z},{width:L,height:L},u)}this.dirty=!0}beginFrame(){for(const a of this.images.keys())this.callbackDispatchedThisFrame.set(a,new Set)}dispatchRenderCallbacks(a,u){const g=this.images.get(u);for(const v of a){if(this.callbackDispatchedThisFrame.get(u).has(v.toString()))continue;this.callbackDispatchedThisFrame.get(u).add(v.toString());const x=g.get(v.toString());Wu(x)&&this.updateImage(v,u,x)}}}function ps(m){const a=m.key,u=m.value,g=m.valueSpec||{},v=m.objectElementValidators||{},x=m.style,T=m.styleSpec;let C=[];const M=r.K(u);if(M!=="object")return[new r.V(a,u,`object expected, ${M} found`)];for(const D in u){const O=D.split(".")[0];let z;v[O]?z=v[O]:g[O]?z=On:v["*"]?z=v["*"]:g["*"]&&(z=On),z?C=C.concat(z({key:(a&&`${a}.`)+D,value:u[D],valueSpec:g[O]||g["*"],style:x,styleSpec:T,object:u,objectKey:D},u)):C.push(new r.J(a,u[D],`unknown property "${D}"`))}for(const D in g)v[D]||g[D].required&&g[D].default===void 0&&u[D]===void 0&&C.push(new r.V(a,u,`missing required property "${D}"`));return C}function Vo(m){const a=m.value,u=m.valueSpec,g=m.style,v=m.styleSpec,x=m.key,T=m.arrayElementValidator||On;if(r.K(a)!=="array")return[new r.V(x,a,`array expected, ${r.K(a)} found`)];if(u.length&&a.length!==u.length)return[new r.V(x,a,`array length ${u.length} expected, length ${a.length} found`)];if(u["min-length"]&&a.length<u["min-length"])return[new r.V(x,a,`array length at least ${u["min-length"]} expected, length ${a.length} found`)];let C={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};v.$version<7&&(C.function=u.function),r.K(u.value)==="object"&&(C=u.value);let M=[];for(let D=0;D<a.length;D++)M=M.concat(T({array:a,arrayIndex:D,value:a[D],valueSpec:C,style:g,styleSpec:v,key:`${x}[${D}]`},!0));return M}function la(m){const a=m.key,u=m.value,g=m.valueSpec;let v=r.K(u);if(v==="number"&&u!=u&&(v="NaN"),v!=="number")return[new r.V(a,u,`number expected, ${v} found`)];if("minimum"in g){let x=g.minimum;if(r.K(g.minimum)==="array"&&(x=g.minimum[m.arrayIndex]),u<x)return[new r.V(a,u,`${u} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(r.K(g.maximum)==="array"&&(x=g.maximum[m.arrayIndex]),u>x)return[new r.V(a,u,`${u} is greater than the maximum value ${x}`)]}return[]}function ls(m){const a=m.valueSpec,u=r.M(m.value.type);let g,v,x,T={};const C=u!=="categorical"&&m.value.property===void 0,M=!C,D=r.K(m.value.stops)==="array"&&r.K(m.value.stops[0])==="array"&&r.K(m.value.stops[0][0])==="object",O=ps({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(V){if(u==="identity")return[new r.V(V.key,V.value,'identity function may not have a "stops" property')];let Y=[];const q=V.value;return Y=Y.concat(Vo({key:V.key,value:q,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:z})),r.K(q)==="array"&&q.length===0&&Y.push(new r.V(V.key,q,"array must have at least one stop")),Y},default:function(V){return On({key:V.key,value:V.value,valueSpec:a,style:V.style,styleSpec:V.styleSpec})}}});return u==="identity"&&C&&O.push(new r.V(m.key,m.value,'missing required property "property"')),u==="identity"||m.value.stops||O.push(new r.V(m.key,m.value,'missing required property "stops"')),u==="exponential"&&m.valueSpec.expression&&!r.N(m.valueSpec)&&O.push(new r.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(M&&!r.O(m.valueSpec)?O.push(new r.V(m.key,m.value,"property functions not supported")):C&&!r.Q(m.valueSpec)&&O.push(new r.V(m.key,m.value,"zoom functions not supported"))),u!=="categorical"&&!D||m.value.property!==void 0||O.push(new r.V(m.key,m.value,'"property" property is required')),O;function z(V){let Y=[];const q=V.value,Q=V.key;if(r.K(q)!=="array")return[new r.V(Q,q,`array expected, ${r.K(q)} found`)];if(q.length!==2)return[new r.V(Q,q,`array length 2 expected, length ${q.length} found`)];if(D){if(r.K(q[0])!=="object")return[new r.V(Q,q,`object expected, ${r.K(q[0])} found`)];if(q[0].zoom===void 0)return[new r.V(Q,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new r.V(Q,q,"object stop key must have value")];const Z=r.M(q[0].zoom);if(typeof Z!="number")return[new r.V(Q,q[0].zoom,"stop zoom values must be numbers")];if(x&&x>Z)return[new r.V(Q,q[0].zoom,"stop zoom values must appear in ascending order")];Z!==x&&(x=Z,v=void 0,T={}),Y=Y.concat(ps({key:`${Q}[0]`,value:q[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:la,value:L}}))}else Y=Y.concat(L({key:`${Q}[0]`,value:q[0],style:V.style,styleSpec:V.styleSpec},q));return r.S(r.U(q[1]))?Y.concat([new r.V(`${Q}[1]`,q[1],"expressions are not allowed in function stops.")]):Y.concat(On({key:`${Q}[1]`,value:q[1],valueSpec:a,style:V.style,styleSpec:V.styleSpec}))}function L(V,Y){const q=r.K(V.value),Q=r.M(V.value),Z=V.value!==null?V.value:Y;if(g){if(q!==g)return[new r.V(V.key,Z,`${q} stop domain type must match previous stop domain type ${g}`)]}else g=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof Q!="number"&&typeof Q!="string"&&typeof Q!="boolean")return[new r.V(V.key,Z,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&u!=="categorical"){let se=`number expected, ${q} found`;return r.O(a)&&u===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(V.key,Z,se)]}return u!=="categorical"||q!=="number"||typeof Q=="number"&&isFinite(Q)&&Math.floor(Q)===Q?u!=="categorical"&&q==="number"&&typeof Q=="number"&&typeof v=="number"&&v!==void 0&&Q<v?[new r.V(V.key,Z,"stop domain values must appear in ascending order")]:(v=Q,u==="categorical"&&Q in T?[new r.V(V.key,Z,"stop domain values must be unique")]:(T[Q]=!0,[])):[new r.V(V.key,Z,`integer expected, found ${String(Q)}`)]}}function ko(m){const a=(m.expressionContext==="property"?r.W:r.X)(r.U(m.value),m.valueSpec);if(a.result==="error")return a.value.map(g=>new r.V(`${m.key}${g.key}`,m.value,g.message));const u=a.value.expression||a.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!u.outputDefined())return[new r.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!r.Y(u))return[new r.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return ja(u,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!r.Z(u,["zoom","feature-state"]))return[new r.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!r._(u))return[new r.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ja(m,a){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(const v of a.valueSpec.expression.parameters)u.delete(v);if(u.size===0)return[];const g=[];return m instanceof r.$&&u.has(m.name)?[new r.V(a.key,a.value,`["${m.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(m.eachChild(v=>{g.push(...ja(v,a))}),g)}function $o(m){const a=m.key,u=m.value,g=m.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(r.M(u))===-1&&v.push(new r.V(a,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(r.M(u))===-1&&v.push(new r.V(a,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function ca(m){return r.a1(r.U(m.value))?ko(r.L({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):ms(m)}function ms(m){const a=m.value,u=m.key;if(r.K(a)!=="array")return[new r.V(u,a,`array expected, ${r.K(a)} found`)];const g=m.styleSpec;let v,x=[];if(a.length<1)return[new r.V(u,a,"filter array must have at least 1 element")];switch(x=x.concat($o({key:`${u}[0]`,value:a[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),r.M(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&r.M(a[1])==="$type"&&x.push(new r.V(u,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&x.push(new r.V(u,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(v=r.K(a[1]),v!=="string"&&x.push(new r.V(`${u}[1]`,a[1],`string expected, ${v} found`)));for(let T=2;T<a.length;T++)v=r.K(a[T]),r.M(a[1])==="$type"?x=x.concat($o({key:`${u}[${T}]`,value:a[T],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new r.V(`${u}[${T}]`,a[T],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let T=1;T<a.length;T++)x=x.concat(ms({key:`${u}[${T}]`,value:a[T],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=r.K(a[1]),a.length!==2?x.push(new r.V(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new r.V(`${u}[1]`,a[1],`string expected, ${v} found`))}return x}function gs(m,a){const u=m.key,g=m.style,v=m.layer,x=m.styleSpec,T=m.value,C=m.objectKey,M=x[`${a}_${m.layerType}`];if(!M)return[];const D=C.match(/^(.*)-use-theme$/);if(a==="paint"&&D&&M[D[1]])return r.S(T)?[].concat(On({key:m.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:x,expressionContext:"property",propertyType:a,propertyKey:C})):On({key:u,value:T,valueSpec:{type:"string"},style:g,styleSpec:x});const O=C.match(/^(.*)-transition$/);if(a==="paint"&&O&&M[O[1]]&&M[O[1]].transition)return On({key:u,value:T,valueSpec:x.transition,style:g,styleSpec:x});const z=m.valueSpec||M[C];if(!z)return[new r.J(u,T,`unknown property "${C}"`)];let L;if(r.K(T)==="string"&&r.O(z)&&!z.tokens&&(L=/^{([^}]+)}$/.exec(T))){const Y=`\`{ "type": "identity", "property": ${L?JSON.stringify(L[1]):'"_"'} }\``;return[new r.V(u,T,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${Y}.`)]}const V=[];if(m.layerType==="symbol")C!=="text-field"||!g||g.glyphs||g.imports||V.push(new r.V(u,T,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&r.a2(r.U(T))&&r.M(T.type)==="identity"&&V.push(new r.V(u,T,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&a==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&r.O(z)&&(r.a3(z)||r.Q(z))){const Y=r.W(r.U(T),z),q=Y.value.expression||Y.value._styleExpression.expression;q&&!r.Z(q,["measure-light"])&&(C==="model-emissive-strength"&&r._(q)&&r.Y(q)||V.push(new r.V(u,T,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return V.concat(On({key:m.key,value:T,valueSpec:z,style:g,styleSpec:x,expressionContext:"property",propertyType:a,propertyKey:C}))}function Lc(m){return gs(m,"paint")}function Ha(m){return gs(m,"layout")}function Zl(m){let a=[];const u=m.value,g=m.key,v=m.style,x=m.styleSpec;u.type||u.ref||a.push(new r.V(g,u,'either "type" or "ref" is required'));let T=r.M(u.type);const C=r.M(u.ref);if(u.id){const M=r.M(u.id);for(let D=0;D<m.arrayIndex;D++){const O=v.layers[D];r.M(O.id)===M&&a.push(new r.V(g,u.id,`duplicate layer id "${u.id}", previously used at line ${O.id.__line__}`))}}if("ref"in u){let M;["type","source","source-layer","filter","layout"].forEach(D=>{D in u&&a.push(new r.V(g,u[D],`"${D}" is prohibited for ref layers`))}),v.layers.forEach(D=>{r.M(D.id)===C&&(M=D)}),M?M.ref?a.push(new r.V(g,u.ref,"ref cannot reference another ref layer")):T=r.M(M.type):typeof C=="string"&&a.push(new r.V(g,u.ref,`ref layer "${C}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(u.source){const M=v.sources&&v.sources[u.source],D=M&&r.M(M.type);M?D==="vector"&&T==="raster"?a.push(new r.V(g,u.source,`layer "${u.id}" requires a raster source`)):D==="raster"&&T!=="raster"?a.push(new r.V(g,u.source,`layer "${u.id}" requires a vector source`)):D!=="vector"||u["source-layer"]?D==="raster-dem"&&T!=="hillshade"?a.push(new r.V(g,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&u.paint&&(u.paint["line-gradient"]||u.paint["line-trim-offset"])&&D==="geojson"&&!M.lineMetrics?a.push(new r.V(g,u,`layer "${u.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&D!=="raster-array"&&a.push(new r.V(g,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):a.push(new r.V(g,u.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new r.V(g,u,`layer "${u.id}" must specify a "source-layer"`)):a.push(new r.V(g,u.source,`source "${u.source}" not found`))}else a.push(new r.V(g,u,'missing required property "source"'));return a=a.concat(ps({key:g,value:u,valueSpec:x.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>On({key:`${g}.type`,value:u.type,valueSpec:x.layer.type,style:m.style,styleSpec:m.styleSpec,object:u,objectKey:"type"}),filter:M=>ca(r.L({layerType:T},M)),layout:M=>ps({layer:u,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":D=>Ha(r.L({layerType:T},D))}}),paint:M=>ps({layer:u,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":D=>Lc(r.L({layerType:T,layer:u},D))}})}})),a}function Po(m){const a=m.value,u=m.key,g=r.K(a);return g!=="string"?[new r.V(u,a,`string expected, ${g} found`)]:[]}const ha={promoteId:function m({key:a,value:u}){if(r.K(u)==="string")return Po({key:a,value:u});if(Array.isArray(u)){const g=[],v=r.U(u),x=r.X(v);return x.result==="error"&&x.value.forEach(T=>{g.push(new r.V(`${a}${T.key}`,null,`${T.message}`))}),r.Z(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new r.V(`${a}`,null,"promoteId expression should be only feature dependent")),g}{const g=[];for(const v in u)g.push(...m({key:`${a}.${v}`,value:u[v]}));return g}}};function Ms(m){const a=m.value,u=m.key,g=m.styleSpec,v=m.style;if(!a.type)return[new r.V(u,a,'"type" is required')];const x=r.M(a.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(a.url||a.tiles||T.push(new r.J(u,a,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(ps({key:u,value:a,valueSpec:g[`source_${x.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:ha})),T;case"geojson":if(T=ps({key:u,value:a,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:ha}),a.cluster)for(const C in a.clusterProperties){const[M,D]=a.clusterProperties[C],O=typeof M=="string"?[M,["accumulated"],["get",C]]:M;T.push(...ko({key:`${u}.${C}.map`,value:D,expressionContext:"cluster-map"})),T.push(...ko({key:`${u}.${C}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return T;case"video":return ps({key:u,value:a,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return ps({key:u,value:a,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new r.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $o({key:`${u}.type`,value:a.type,valueSpec:{values:Wa(g)}})}}function Wa(m){return m.source.reduce((a,u)=>{const g=m[u];return g.type.type==="enum"&&(a=a.concat(Object.keys(g.type.values))),a},[])}function Ga(m){const a=m.value,u=m.styleSpec,g=u.light,v=m.style;let x=[];const T=r.K(a);if(a===void 0)return x;if(T!=="object")return x=x.concat([new r.V("light",a,`object expected, ${T} found`)]),x;for(const C in a){const M=C.match(/^(.*)-transition$/),D=C.match(/^(.*)-use-theme$/);x=x.concat(D&&g[D[1]]?On({key:C,value:a[C],valueSpec:{type:"string"},style:v,styleSpec:u}):M&&g[M[1]]&&g[M[1]].transition?On({key:C,value:a[C],valueSpec:u.transition,style:v,styleSpec:u}):g[C]?On({key:C,value:a[C],valueSpec:g[C],style:v,styleSpec:u}):[new r.V(C,a[C],`unknown property "${C}"`)])}return x}function jo(m){const a=m.value;let u=[];if(!a)return u;const g=r.K(a);if(g!=="object")return u=u.concat([new r.V("light-3d",a,`object expected, ${g} found`)]),u;const v=m.styleSpec,x=v["light-3d"],T=m.key,C=m.style,M=m.style.lights;for(const z of["type","id"])if(!(z in a))return u=u.concat([new r.V("light-3d",a,`missing property ${z} on light`)]),u;if(a.type&&M)for(let z=0;z<m.arrayIndex;z++){const L=r.M(a.type),V=M[z];r.M(V.type)===L&&u.push(new r.V(T,a.id,`duplicate light type "${a.type}", previously defined at line ${V.id.__line__}`))}const D=`properties_light_${a.type}`;if(!(D in v))return u=u.concat([new r.V("light-3d",a,`Invalid light type ${a.type}`)]),u;const O=v[D];for(const z in a)if(z==="properties"){const L=a[z],V=r.K(L);if(V!=="object")return u=u.concat([new r.V("properties",L,`object expected, ${V} found`)]),u;for(const Y in L)u=u.concat(O[Y]?On({key:Y,value:L[Y],valueSpec:O[Y],style:C,styleSpec:v}):[new r.J(m.key,L[Y],`unknown property "${Y}"`)])}else{const L=z.match(/^(.*)-transition$/),V=z.match(/^(.*)-use-theme$/);u=u.concat(V&&x[V[1]]?On({key:z,value:a[z],valueSpec:{type:"string"},style:C,styleSpec:v}):L&&x[L[1]]&&x[L[1]].transition?On({key:z,value:a[z],valueSpec:v.transition,style:C,styleSpec:v}):x[z]?On({key:z,value:a[z],valueSpec:x[z],style:C,styleSpec:v}):[new r.J(z,a[z],`unknown property "${z}"`)])}return u}function er(m){const a=m.value,u=m.key,g=m.style,v=m.styleSpec,x=v.terrain;let T=[];const C=r.K(a);if(a===void 0||C==="null")return T;if(C!=="object")return T=T.concat([new r.V("terrain",a,`object expected, ${C} found`)]),T;for(const M in a){const D=M.match(/^(.*)-transition$/),O=M.match(/^(.*)-use-theme$/);T=T.concat(O&&x[O[1]]?On({key:M,value:a[M],valueSpec:{type:"string"},style:g,styleSpec:v}):D&&x[D[1]]&&x[D[1]].transition?On({key:M,value:a[M],valueSpec:v.transition,style:g,styleSpec:v}):x[M]?On({key:M,value:a[M],valueSpec:x[M],style:g,styleSpec:v}):[new r.J(M,a[M],`unknown property "${M}"`)])}if(a.source){const M=g.sources&&g.sources[a.source],D=M&&r.M(M.type);M?D!=="raster-dem"&&T.push(new r.V(u,a.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):T.push(new r.V(u,a.source,`source "${a.source}" not found`))}else T.push(new r.V(u,a,'terrain is missing required property "source"'));return T}function ua(m){const a=m.value,u=m.style,g=m.styleSpec,v=g.fog;let x=[];const T=r.K(a);if(a===void 0)return x;if(T!=="object")return x=x.concat([new r.V("fog",a,`object expected, ${T} found`)]),x;for(const C in a){const M=C.match(/^(.*)-transition$/),D=C.match(/^(.*)-use-theme$/);x=x.concat(D&&v[D[1]]?On({key:C,value:a[C],valueSpec:{type:"string"},style:u,styleSpec:g}):M&&v[M[1]]&&v[M[1]].transition?On({key:C,value:a[C],valueSpec:g.transition,style:u,styleSpec:g}):v[C]?On({key:C,value:a[C],valueSpec:v[C],style:u,styleSpec:g}):[new r.J(C,a[C],`unknown property "${C}"`)])}return x}const ml={"*":()=>[],array:Vo,boolean:function(m){const a=m.value,u=m.key,g=r.K(a);return g!=="boolean"?[new r.V(u,a,`boolean expected, ${g} found`)]:[]},number:la,color:function(m){const a=m.key,u=m.value,g=r.K(u);return g!=="string"?[new r.V(a,u,`color expected, ${g} found`)]:r.a0.parseCSSColor(u)===null?[new r.V(a,u,`color expected, "${u}" found`)]:[]},enum:$o,filter:ca,function:ls,layer:Zl,object:ps,source:Ms,model:r.a4,light:Ga,"light-3d":jo,terrain:er,fog:ua,string:Po,formatted:function(m){return Po(m).length===0?[]:ko(m)},resolvedImage:function(m){return Po(m).length===0?[]:ko(m)},projection:function(m){const a=m.value,u=m.styleSpec,g=u.projection,v=m.style;let x=[];const T=r.K(a);if(T==="object")for(const C in a)x=x.concat(On({key:C,value:a[C],valueSpec:g[C],style:v,styleSpec:u}));else T!=="string"&&(x=x.concat([new r.V("projection",a,`object or string expected, ${T} found`)]));return x},import:function(m){const{value:a,styleSpec:u}=m,{data:g,...v}=a;Object.defineProperty(v,"__line__",{value:a.__line__,enumerable:!1});let x=ps(r.L({},m,{value:v,valueSpec:u.import}));return r.M(v.id)===""&&x.push(new r.V(`${m.key}.id`,v,"import id can't be an empty string")),g&&(x=x.concat(Xa(g,u,{key:`${m.key}.data`}))),x},iconset:function(m){const a=m.value,u=m.key,g=m.styleSpec,v=m.style;if(!a.type)return[new r.V(u,a,'"type" is required')];const x=r.M(a.type);let T=[];if(T=T.concat(ps({key:u,value:a,valueSpec:g[`iconset_${x}`],style:v,styleSpec:g})),x==="source"&&a.source){const C=v.sources&&v.sources[a.source],M=C&&r.M(C.type);C?M!=="raster-array"&&T.push(new r.V(u,a.source,`iconset cannot be used with a source of type ${String(M)}, it only be used with a "raster-array" source type`)):T.push(new r.V(u,a.source,`source "${a.source}" not found`))}return T}};function On(m,a=!1){const u=m.value,g=m.valueSpec,v=m.styleSpec;if(g.expression&&r.a2(r.M(u)))return ls(m);if(g.expression&&r.S(r.U(u)))return ko(m);if(g.type&&ml[g.type]){const x=ml[g.type](m);return a===!0&&x.length>0&&r.K(m.value)==="array"?ko(m):x}return ps(r.L({},m,{valueSpec:g.type?v[g.type]:g}))}function Qs(m){const a=m.value,u=m.key,g=Po(m);return g.length||(a.indexOf("{fontstack}")===-1&&g.push(new r.V(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&g.push(new r.V(u,a,'"glyphs" url must include a "{range}" token'))),g}function Xa(m,a=r.a5,u={}){return On({key:u.key||"",value:m,valueSpec:a.$root,styleSpec:a,style:m,objectElementValidators:{glyphs:Qs,"*":()=>[]}})}function Nr(m,a=r.a5){return Me(Xa(m,a))}const zc=m=>Me(Ms(m)),Mh=m=>Me(Ga(m)),ke=m=>Me(jo(m)),ue=m=>Me(er(m)),st=m=>Me(ua(m)),Pt=m=>Me(function(a){const u=a.value,g=a.style,v=a.styleSpec,x=v.snow;let T=[];const C=r.K(u);if(u===void 0)return T;if(C!=="object")return T=T.concat([new r.V("snow",u,`object expected, ${C} found`)]),T;for(const M in u){const D=M.match(/^(.*)-transition$/);T=T.concat(D&&x[D[1]]&&x[D[1]].transition?On({key:M,value:u[M],valueSpec:v.transition,style:g,styleSpec:v}):x[M]?On({key:M,value:u[M],valueSpec:x[M],style:g,styleSpec:v}):[new r.J(M,u[M],`unknown property "${M}"`)])}return T}(m)),Oe=m=>Me(function(a){const u=a.value,g=a.style,v=a.styleSpec,x=v.rain;let T=[];const C=r.K(u);if(u===void 0)return T;if(C!=="object")return T=T.concat([new r.V("rain",u,`object expected, ${C} found`)]),T;for(const M in u){const D=M.match(/^(.*)-transition$/);T=T.concat(D&&x[D[1]]&&x[D[1]].transition?On({key:M,value:u[M],valueSpec:v.transition,style:g,styleSpec:v}):x[M]?On({key:M,value:u[M],valueSpec:x[M],style:g,styleSpec:v}):[new r.J(M,u[M],`unknown property "${M}"`)])}return T}(m)),H=m=>Me(Zl(m)),te=m=>Me(ca(m)),oe=m=>Me(Lc(m)),Ae=m=>Me(Ha(m)),ye=m=>Me(r.a4(m));function Me(m){return m.slice().sort((a,u)=>a.line&&u.line?a.line-u.line:0)}function De(m,a){let u=!1;if(a&&a.length)for(const g of a)g instanceof r.J?r.w(g.message):(m.fire(new r.z(new Error(g.message))),u=!0);return u}let ze;class We extends r.E{constructor(a,u="flat"){super(),this._transitionable=new r.a6(ze||(ze=new r.a7({anchor:new r.a8(r.a5.light.anchor),position:new r.a9(r.a5.light.position),color:new r.a8(r.a5.light.color),intensity:new r.a8(r.a5.light.intensity)}))),this.setLight(a,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,u,g={}){this._validate(Mh,a,g)||(this._transitionable.setTransitionOrValue(a),this.id=u)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,g){return(!g||g.validate!==!1)&&De(this,a.call(Nr,r.l({value:u,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let nt=class extends r.E{constructor(m,a,u,g){super(),this.scope=u,this._transitionable=new r.a6(new r.a7({source:new r.a8(r.a5.terrain.source),exaggeration:new r.a8(r.a5.terrain.exaggeration)}),u,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(m,a){this._transitionable.setTransitionOrValue(m,a)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new r.aa(m)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const a=m.value.expression;if(!a)return null;let u=-1,g=-1,v=1;for(const x of a.zoomStops)v=a.evaluate(new r.aa(x)),v>.01?(u=x,g=-1):g=x;return v<.01&&u>0&&g>u?[u,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof r.ab}};const Ge=45,Rt=65,zt=.05;function Yt(m,a,u,g){const v=r.af(Ge,Rt,u),[x,T]=gi(m,g);let C=1-Math.min(1,Math.exp((a-x)/(T-x)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*v*m.alpha}function gi(m,a){const u=.5/Math.tan(.5*a);return[m.range[0]+u,m.range[1]+u]}function xi(m,a,u,g,v){const x=r.ad([],[a,u,g],v.mercatorFogMatrix);return Yt(m,r.ae(x),v.pitch,v._fov)}function Si(m,a,u,g,v,x,T){const C=[[u,g,0],[v,g,0],[v,x,0],[u,x,0]];let M=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const O of C){const z=r.ad([],O,a),L=r.ae(z);M=Math.min(M,L),D=Math.max(D,L)}return[Yt(m,M,T.pitch,T._fov),Yt(m,D,T.pitch,T._fov)]}class Pi extends r.E{constructor(a,u,g,v){super();const x=new r.a7({range:new r.a8(r.a5.fog.range),color:new r.a8(r.a5.fog.color),"color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a8(r.a5.fog["high-color"]),"high-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a8(r.a5.fog["space-color"]),"space-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a8(r.a5.fog["horizon-blend"]),"star-intensity":new r.a8(r.a5.fog["star-intensity"]),"vertical-range":new r.a8(r.a5.fog["vertical-range"])});this._transitionable=new r.a6(x,g,new Map(v)),this.set(a,v),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new r.ag(x),this.scope=g}get state(){const a=this._transform,u=a.projection.name==="globe",g=r.ah(a.zoom),v=this.properties.get("range"),x=[.5,3];return{range:u?[r.ai(x[0],v[0],g),r.ai(x[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,u,g={}){if(this._validate(st,a,g))return;const v=r.l({},a);for(const x of Object.keys(r.a5.fog))v[x]===void 0&&(v[x]=r.a5.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.af(Ge,Rt,a))*u.a}getOpacityAtLatLng(a,u){return this._transform.projection.supportsFog?function(g,v,x){const T=r.ac.fromLngLat(v),C=x.elevation?x.elevation.getAtPointOrZero(T):0;return xi(g,T.x,T.y,C,x)}(this.state,a,u):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(a.toUnwrapped());return Si(this.state,u,0,0,r.aj,r.aj,this._transform)}getOpacityForBounds(a,u,g,v,x){return this._transform.projection.supportsFog?Si(this.state,a,u,g,v,x,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?gi(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const g of u){const v=a.points[g];let x;if(v[2]>=0)x=v;else{const T=a.points[g-4];x=r.ak(T,v,T[2]/(T[2]-v[2]))}if(xi(this.state,x[0],x[1],0,this._transform)>=zt)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,g){return(!g||g.validate!==!1)&&De(this,a.call(Nr,r.l({value:u,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let Hn,Bi,yn,en,An=class extends r.E{constructor(m,a,u,g){super();const v=Hn||(Hn=new r.a7({density:new r.a8(r.a5.snow.density),intensity:new r.a8(r.a5.snow.intensity),color:new r.a8(r.a5.snow.color),opacity:new r.a8(r.a5.snow.opacity),vignette:new r.a8(r.a5.snow.vignette),"vignette-color":new r.a8(r.a5.snow["vignette-color"]),"center-thinning":new r.a8(r.a5.snow["center-thinning"]),direction:new r.a8(r.a5.snow.direction),"flake-size":new r.a8(r.a5.snow["flake-size"])}));this._transitionable=new r.a6(v,u,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ag(v),this.scope=u}get state(){const m=this.properties.get("opacity"),a=this.properties.get("color"),u=this.properties.get("direction"),g=r.al(u[0]),v=-Math.max(r.al(u[1]),.01),x=[Math.cos(g)*Math.cos(v),Math.sin(g)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.am(a.r,a.g,a.b,a.a*m),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(m,a,u={}){if(this._validate(Pt,m,u))return;const g=r.l({},m);for(const v of Object.keys(r.a5.snow))g[v]===void 0&&(g[v]=r.a5.snow[v].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,a,u){return(!u||u.validate!==!1)&&De(this,m.call(Nr,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}},In=class extends r.E{constructor(m,a,u,g){super();const v=Bi||(Bi=new r.a7({density:new r.a8(r.a5.rain.density),intensity:new r.a8(r.a5.rain.intensity),color:new r.a8(r.a5.rain.color),opacity:new r.a8(r.a5.rain.opacity),vignette:new r.a8(r.a5.rain.vignette),"vignette-color":new r.a8(r.a5.rain["vignette-color"]),"center-thinning":new r.a8(r.a5.rain["center-thinning"]),direction:new r.a8(r.a5.rain.direction),"droplet-size":new r.a8(r.a5.rain["droplet-size"]),"distortion-strength":new r.a8(r.a5.rain["distortion-strength"])}));this._transitionable=new r.a6(v,u,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ag(v),this.scope=u}get state(){const m=this.properties.get("opacity"),a=this.properties.get("color"),u=this.properties.get("direction"),g=r.al(u[0]),v=-Math.max(r.al(u[1]),.01),x=[Math.cos(g)*Math.cos(v),Math.sin(g)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.am(a.r,a.g,a.b,a.a*m),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(m,a,u={}){if(this._validate(Oe,m,u))return;const g=r.l({},m);for(const v of Object.keys(r.a5.rain))g[v]===void 0&&(g[v]=r.a5.rain[v].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,a,u){return(!u||u.validate!==!1)&&De(this,m.call(Nr,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}};class pr extends r.E{constructor(a,u,g,v){super(),this.scope=g,this._options=a,this.properties=new r.ag(u),this._transitionable=new r.a6(u,g,new Map(v)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,u){this._options=a,this._transitionable.setTransitionOrValue(a.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Pr{constructor(a,u,g,v){this.screenBounds=a,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(a,u){let g,v;if(a instanceof r.P||typeof a[0]=="number"){const x=r.P.convert(a);g=[x],v=u.isPointAboveHorizon(x)}else{const x=r.P.convert(a[0]),T=r.P.convert(a[1]),C=x.add(T)._div(2);g=[x,T],v=r.ao(x,T).every(M=>u.isPointAboveHorizon(M))&&u.isPointAboveHorizon(C)}return new Pr(g,u.getCameraPoint(),v,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return r.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.ao(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),r.ap(v,a)}bufferedCameraGeometryGlobe(a){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.ao(u,g,a),x=this.cameraPoint.clone();switch(3*((x.y>u.y)+(x.y>g.y))+((x.x>u.x)+(x.x>g.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(a,u,g,v=0){const x=a.queryPadding/u._pixelsPerMercatorPixel+1,T=g?this._bufferedCameraMercator(x,u):this._bufferedScreenMercator(x,u);let C=a.tileID.wrap+(T.unwrapped?v:0);const M=T.polygon.map(Q=>r.aq(a.tileTransform,Q,C));if(!r.ar(M,0,0,r.aj,r.aj))return;C=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const D=this.screenGeometryMercator.polygon.map(Q=>r.as(a.tileTransform,Q,C)),O=D.map(Q=>new r.P(Q[0],Q[1])),z=u.getFreeCameraOptions().position||new r.ac(0,0,0),L=r.as(a.tileTransform,z,C),V=D.map(Q=>{const Z=r.at(Q,Q,L);return r.au(Z,Z),new r.av(L,Z)}),Y=r.aw(a,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:V,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(q=r.ax(M),q.min.x=r.aD(q.min.x,0,r.aj),q.min.y=r.aD(q.min.y,0,r.aj),q.max.x=r.aD(q.max.x,0,r.aj),q.max.y=r.aD(q.max.y,0,r.aj),q),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:Y};var q}_bufferedScreenMercator(a,u){const g=gl(a);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),u):{polygon:this.bufferedScreenGeometry(a).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(a,u){const g=gl(a);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),u):{polygon:this.bufferedCameraGeometry(a).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(a,u){const g=function(x,T){const C=r.az([],T.pixelMatrix,T.globeMatrix),M=[0,-r.aE,0,1],D=[0,r.aE,0,1],O=[0,0,0,1];r.aA(M,M,C),r.aA(D,D,C),r.aA(O,O,C);const z=new r.P(M[0]/M[3],M[1]/M[3]),L=new r.P(D[0]/D[3],D[1]/D[3]),V=r.aB(x,z)&&M[3]<O[3],Y=r.aB(x,L)&&D[3]<O[3];if(!V&&!Y)return null;const q=function(xe,ge,Ie){for(let Re=1;Re<xe.length;Re++){const Xe=cs(ge.pointCoordinate3D(xe[Re-1]).x),je=cs(ge.pointCoordinate3D(xe[Re]).x);if(Ie<0){if(Xe<je)return{idx:Re,t:-Xe/(je-1-Xe)}}else if(je<Xe)return{idx:Re,t:(1-Xe)/(je+1-Xe)}}return null}(x,T,V?-1:1);if(!q)return null;const{idx:Q,t:Z}=q;let se=Q>1?Xr(x.slice(0,Q),T):[],de=Q<x.length?Xr(x.slice(Q),T):[];se=se.map(xe=>new r.P(cs(xe.x),xe.y)),de=de.map(xe=>new r.P(cs(xe.x),xe.y));const me=[...se];me.length===0&&me.push(de[de.length-1]);const Se=r.ai(me[me.length-1].y,(de.length===0?se[0]:de[0]).y,Z);let ve;return ve=V?[new r.P(0,Se),new r.P(0,0),new r.P(1,0),new r.P(1,Se)]:[new r.P(1,Se),new r.P(1,1),new r.P(0,1),new r.P(0,Se)],me.push(...ve),de.length===0?me.push(se[0]):me.push(...de),{polygon:me.map(xe=>new r.ac(xe.x,xe.y)),unwrapped:!1}}(a,u);if(g)return g;const v=function(x,T){let C=!1,M=-1/0,D=0;for(let z=0;z<x.length-1;z++)x[z].x>M&&(M=x[z].x,D=z);for(let z=0;z<x.length-1;z++){const L=(D+z)%(x.length-1),V=x[L],Y=x[L+1];Math.abs(V.x-Y.x)>.5&&(V.x<Y.x?(V.x+=1,L===0&&(x[x.length-1].x+=1)):(Y.x+=1,L+1===x.length-1&&(x[0].x+=1)),C=!0)}const O=r.ay(T.center.lng);return C&&O<Math.abs(O-1)&&x.forEach(z=>{z.x-=1}),{polygon:x,unwrapped:C}}(Xr(a,u).map(x=>new r.P(cs(x.x),x.y)),u);return{polygon:v.polygon.map(x=>new r.ac(x.x,x.y)),unwrapped:v.unwrapped}}}function Xr(m,a){return r.aC(m,u=>{const g=a.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function cs(m){return m<0?1+m%1:m%1}function gl(m){return 100*m|0}function Rs(m,a,u,g,v){const x=function(C,M){if(C)return v(C);if(M){if(m.url&&M.tiles&&m.tiles&&delete m.tiles,M.variants){if(!Array.isArray(M.variants))return v(new Error("variants must be an array"));for(const O of M.variants){if(O==null||typeof O!="object"||O.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(O.capabilities))return v(new Error("capabilities must be an array"));if(O.capabilities.length===1&&O.capabilities[0]==="meshopt"){M=r.l(M,O);break}}}const D=r.aF(r.l({},M,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=a.canonicalizeTileset(D,m.url),v(null,D)}},T=function(C,M,D){if(!C)return null;if(!M&&!D)return C;D=D||C.worldview_default;const O=Object.values(C.language||{});if(O.length===0)return null;const z=Object.values(C.worldview||{});if(z.length===0)return null;const L=O.every(Y=>Y===M),V=z.every(Y=>Y===D);return L&&V?C:M in(C.language_options||{})||D in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(m.data,u,g);return T?r.q.frame(()=>x(null,T)):m.url?r.n(a.transformRequest(a.normalizeSourceURL(m.url,null,u,g),r.R.Source),x):r.q.frame(()=>{const{data:C,...M}=m;x(null,M)})}function ks(m,a){const u=Math.pow(2,a.z),g=Math.floor(r.ay(m.getWest())*u),v=Math.floor(r.aH(m.getNorth())*u),x=Math.ceil(r.ay(m.getEast())*u),T=Math.ceil(r.aH(m.getSouth())*u);return a.x>=g&&a.x<x&&a.y>=v&&a.y<T}class Jr{constructor(a,u,g){this.bounds=a?r.aG.convert(this.validateBounds(a)):null,this.minzoom=u||0,this.maxzoom=g||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}addExtraBounds(a){if(a){this.extraBounds||(this.extraBounds=[]);for(const u of a)this.extraBounds.push(r.aG.convert(this.validateBounds(u)))}}contains(a){if(a.z>this.maxzoom||a.z<this.minzoom||this.bounds&&!ks(this.bounds,a))return!1;if(!this.extraBounds)return!0;for(const u of this.extraBounds)if(ks(u,a))return!0;return!1}static fromTileJSON(a){if(!a.bounds&&!a.extra_bounds)return null;const u=new Jr(a.bounds,a.minzoom,a.maxzoom);return u.addExtraBounds(a.extra_bounds),u}}class _s extends r.E{constructor(a,u,g,v){if(super(),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.aF(u,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new r.aI}load(a){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=Rs(this._options,this.map._requestManager,u,g,(v,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new r.z(v));else if(x){if(r.l(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of x.vector_layers)this.vectorLayerIds.push(T.id),x.worldview&&x.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=Jr.fromTileJSON(x),Js(x.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}a&&a(v)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(a,u){const g=a.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(g),x=this.map._requestManager.transformRequest(v,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,C=T?{image:T.image.clone()}:null,M={request:x,data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(g)&&(M.worldview=this.map.getWorldview()||this.worldviewDefault,M.localizableLayerIds=this.localizableLayerIds),M.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=u:a.request=a.actor.send("reloadTile",M,D.bind(this));else if(a.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",M,D.bind(this),void 0,!0);else{const O=r.aJ.call({deduped:this._deduped},M,(z,L)=>{z||!L?D.call(this,z):(M.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},a.actor&&a.actor.send("loadTile",M,D.bind(this),void 0,!0))},!0);a.request={cancel:O}}function D(O,z){return delete a.request,a.aborted?u(null):O&&O.status!==404?u(O):(z&&z.resourceTiming&&(a.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&a.setExpiryData(z),a.loadVectorData(z,this.map.painter),r.aK(this.dispatcher),u(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,u){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class qa extends r.E{constructor(a,u,g,v){super(),this.id=a,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},u),r.l(this,r.aF(u,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Rs(this._options,this.map._requestManager,null,null,(u,g)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new r.z(u)):g&&(r.l(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(v=>v.id)),this.tileBounds=Jr.fromTileJSON(g),Js(g.tiles),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),a&&a(u)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,u){const g=r.q.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);a.request=r.o(this.map._requestManager.transformRequest(v,r.R.Tile),(x,T,C,M)=>(delete a.request,a.aborted?(a.state="unloaded",u(null)):x?(a.state="errored",u(x)):T?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:C,expires:M}),a.setTexture(T,this.map.painter),a.state="loaded",r.aK(this.dispatcher),void u(null)):u(null)))}abortTile(a,u){a.request&&(a.request.cancel(),delete a.request),u&&u()}unloadTile(a,u){a.texture&&a.texture instanceof r.T?(a.destroy(!0),a.texture&&a.texture instanceof r.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Nc extends qa{constructor(a,u,g,v){super(a,u,g,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=r.l({type:"raster-array"},u)}triggerRepaint(a){const u=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);u&&u.enabled&&g&&u._clearRenderCacheForTile(g.id,a.tileID),this.map.triggerRepaint()}loadTile(a,u){const g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,r.R.Tile),x={request:v,uid:a.uid,tileID:a.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};a.source=this.id,a.scope=this.scope,a.requestParams=v,a.actor||(a.actor=this.dispatcher.getActor());const T=(C,M,D,O)=>{if(delete a.request,a.aborted)return a.state="unloaded",u(null);if(C)return C.name==="AbortError"?void 0:(a.state="errored",u(C));if(this.map._refreshExpiredTiles&&M&&a.setExpiryData({cacheControl:D,expires:O}),this.partial)a.state="empty";else{if(!M)return u(null);a.state="loaded",a._isHeaderLoaded=!0,a._mrt=M}u(null)};a.request=this.partial?a.fetchHeader(void 0,T.bind(this)):a.actor.send("loadTile",x,T.bind(this),void 0,!0)}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,u){const g=a.texture;g&&g instanceof r.T?(a.destroy(!0),this.map.painter.saveTileTexture(g)):(a.destroy(),a.flushQueues(),a._isHeaderLoaded=!1,delete a._mrt,delete a.textureDescriptor),a.fbo&&(a.fbo.destroy(),delete a.fbo),delete a.request,delete a.requestParams,delete a.neighboringTiles,a.state="unloaded"}prepareTile(a,u,g){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBand(u,g,(v,x)=>{if(v)return a.state="errored",this.fire(new r.z(v)),void this.triggerRepaint(a);x&&(a._isHeaderLoaded=!0,a.setTexture(x,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:x})=>x===a),g=u&&u.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(a,u,g){if(!a)return;const v=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;u instanceof r.aN?x=u.paint.get("raster-array-band"):u instanceof r.aO&&(x=u.paint.get("raster-particle-array-band"));const T=x||this.getInitialBand(v);if(T!=null)if(a.textureDescriptor){if(!a.updateNeeded(v,T)||g)return Object.assign({},a.textureDescriptor,{texture:a.texture})}else this.prepareTile(a,v,T)}getImages(a,u){const g=new Map;for(const v of a)for(const x of u){const[T,C]=x.split("/"),M=v.getLayer(T);if(!M||!M.hasBand(C)||!M.hasDataForBand(C))continue;const{bytes:D,tileSize:O,buffer:z}=M.getBandView(C),L=O+2*z,V={data:new r.r({width:L,height:L},D),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(x,V)}return g}}const Gu={vector:_s,raster:qa,"raster-dem":class extends qa{constructor(m,a,u,g){super(m,a,u,g),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(m,a){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(m.state="errored",a(v)),x&&(m.dem=x,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",a(null))}m.request=r.o(this.map._requestManager.transformRequest(u,r.R.Tile),(function(v,x,T,C){if(delete m.request,m.aborted)m.state="unloaded",a(null);else if(v)m.state="errored",a(v);else if(x){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:T,expires:C});const M=ImageBitmap&&x instanceof ImageBitmap&&r.t(),D=1-(x.width-r.aL(x.width))/2;D<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const O=M?x:r.q.getImageData(x,D),z={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:D};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",z,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const a=m.canonical,u=Math.pow(2,a.z),g=(a.x-1+u)%u,v=a.x===0?m.wrap-1:m.wrap,x=(a.x+1+u)%u,T=a.x+1===u?m.wrap+1:m.wrap,C={};return C[new r.aM(m.overscaledZ,v,a.z,g,a.y).key]={backfilled:!1},C[new r.aM(m.overscaledZ,T,a.z,x,a.y).key]={backfilled:!1},a.y>0&&(C[new r.aM(m.overscaledZ,v,a.z,g,a.y-1).key]={backfilled:!1},C[new r.aM(m.overscaledZ,m.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},C[new r.aM(m.overscaledZ,T,a.z,x,a.y-1).key]={backfilled:!1}),a.y+1<u&&(C[new r.aM(m.overscaledZ,v,a.z,g,a.y+1).key]={backfilled:!1},C[new r.aM(m.overscaledZ,m.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},C[new r.aM(m.overscaledZ,T,a.z,x,a.y+1).key]={backfilled:!1}),C}},"raster-array":Nc,geojson:class extends r.E{constructor(m,a,u,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=a.data,this._options=r.l({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.minzoom!==void 0&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const v=r.aj/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*v,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*v,extent:r.aj,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:r.aj,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*v,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new r.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new r.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const a=new Map;for(const u of this._data.features)a.set(u.id,u);for(const u of m.features)a.set(u.id,u);this._data.features=[...a.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},a),this}getClusterChildren(m,a){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},a),this}getClusterLeaves(m,a,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:a,offset:u},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.A("dataloading",{dataType:"source"})),this._loaded=!1;const a=r.l({append:m},this.workerOptions);a.scope=this.scope;const u=this._data;typeof u=="string"?(a.request=this.map._requestManager.transformRequest(r.q.resolveURL(u),r.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new r.z(g));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new r.A("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=r.C(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,a){const u=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,v=g?{image:g.image.clone()}:null,x=this._partialReload,T={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:x};m.request=this.actor.send(u,T,(C,M)=>x&&!M?(m.state="loaded",a(null)):(delete m.request,m.destroy(),m.aborted?a(null):C?a(C):(m.loadVectorData(M,this.map.painter,u==="reloadTile"),a(null))),void 0,u==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,a){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aP{constructor(m,a,u,g){super(m,a,u,g),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const a of m.urls)this.urls.push(this.map._requestManager.transformRequest(a,r.R.Source).url);r.aQ(this.urls,(a,u)=>{this._loaded=!0,a?this.fire(new r.z(a)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const a=this.video.seekable;m<a.start(0)||m>a.end(0)?this.fire(new r.z(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,a=m.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(m,this.video,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aP,model:class extends r.E{constructor(m,a,u,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=a}load(){const m=[];for(const a in this._options.models){const u=this._options.models[a],g=r.aS(this.map._requestManager.transformRequest(u.uri,r.R.Model).url).then(v=>{if(!v)return;const x=r.aT(v),T=new r.aU(a,u.position,u.orientation,x);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(v=>{this.fire(new r.z(new Error(`Could not load model ${a} from ${u.uri}: ${v.message}`)))});m.push(g)}Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this._loaded=!0,this.fire(new r.z(new Error(`Could not load models: ${a.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,a){}serialize(){return this._options}},"batched-model":class extends r.E{constructor(m,a,u,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Rs(this._options,this.map._requestManager,a,u,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new r.z(g))):v&&(r.l(this,v),v.bounds&&(this.tileBounds=new Jr(v.bounds,this.minzoom,this.maxzoom)),Js(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,a){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,r.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.q.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=a;else{if(m.buckets){const x=Object.values(m.buckets);for(const T of x)T.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(x,T){return m.aborted?a(null):x&&x.status!==404?a(x):(this.map._refreshExpiredTiles&&T&&m.setExpiryData(T),m.loadModelData(T,this.map.painter),m.state="loaded",void a(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aP{constructor(m,a,u,g){super(m,a,u,g),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new r.z(new r.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.z(new r.V(`sources.${m}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new r.z(new r.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new r.z(new r.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.z(new r.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof r.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(a,this.canvas,a.gl.RGBA8,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends r.E{constructor(m,a,u,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=a,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jr(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.aF(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:a,y:u,z:g}=m.canonical;return this._implementation.hasTile({x:a,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,a){const{x:u,y:g,z:v}=m.tileID.canonical,x=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:u,y:g,z:v},{signal:x.signal})).then((function(T){return delete m.request,m.aborted?(m.state="unloaded",a(null)):T===void 0?(m.state="errored",a(null)):T===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(T)?(this.loadTileData(m,T),m.state="loaded",void a(null)):(m.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.name!=="AbortError"&&(m.state="errored",a(T))}),m.request.cancel=()=>x.abort()}loadTileData(m,a){m.setTexture(a,this.map.painter)}unloadTile(m,a){if(m.texture&&m.texture instanceof r.T?(m.destroy(!0),m.texture&&m.texture instanceof r.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:u,y:g,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:v})}a&&a()}abortTile(m,a){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),a&&a()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=r.C(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}}},Rh=function(m,a,u,g){const v=new Gu[a.type](m,a,u,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return r.aV(["load","abort","unload","serialize","prepare"],v),v};function Lf(m,a,u=""){return`${u}:${a.id||""}:${a.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:v,importId:x}=g;return`featureset:${v}${x?`:import:${x}`:""}`}}(m.target)}`}function Xu(m,a,u,g=""){if(m.uniqueFeatureID){const v=Lf(m,a,g);if(u.has(v))return!0;u.add(v)}return!1}function Uc(m,a,u,g,v=!1){const x=a.sourceCache.transform,T=a.sourceCache.tilesIn(m,a.has3DLayers,v);T.sort(da);const C=[];for(const M of T){const D=M.tile.queryRenderedFeatures(a,M,u,g,x,v);Object.keys(D).length&&C.push({wrappedTileID:M.tile.tileID.wrapped().key,queryResults:D})}return C.length===0?{}:function(M){const D={},O={};for(const z of M){const L=z.queryResults,V=z.wrappedTileID,Y=O[V]=O[V]||{};for(const q in L){const Q=L[q],Z=Y[q]=Y[q]||{},se=D[q]=D[q]||[];for(const de of Q)Z[de.featureIndex]||(Z[de.featureIndex]=!0,se.push(de))}}return D}(C)}function qu(m,a,u,g,v){const x={},T=g.queryRenderedSymbols(m),C=[];for(const M of Object.keys(T).map(Number))C.push(v[M]);C.sort(da);for(const M of C){const D=M.featureIndex.lookupSymbolFeatures(T[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,a,u);for(const O in D){const z=x[O]=x[O]||[],L=D[O];L.sort((V,Y)=>{const q=M.featureSortOrder;if(q){const Q=q.indexOf(V.featureIndex);return q.indexOf(Y.featureIndex)-Q}return Y.featureIndex-V.featureIndex});for(const V of L)z.push(V)}}return x}function ig(m,a){const u=m.getRenderableIds().map(x=>m.getTileByID(x)),g=[],v={};for(let x=0;x<u.length;x++){const T=u[x],C=T.tileID.canonical.key;v[C]||(v[C]=!0,T.querySourceFeatures(g,a))}return g}function da(m,a){const u=m.tileID,g=a.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function ng(m,a){const u={};if(!a)return u;for(const g of m){const v=g.layerIds.map(x=>a.getLayer(x)).filter(Boolean);if(v.length!==0){g.layers=v,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(x=>v.filter(T=>T.id===x)[0]));for(const x of v)u[x.fqid]=g}}return u}const _o=32,fa=33,_l=new Uint16Array(8184);for(let m=0;m<2046;m++){let a=m+2,u=0,g=0,v=0,x=0,T=0,C=0;for(1&a?v=x=T=_o:u=g=C=_o;(a>>=1)>1;){const D=u+v>>1,O=g+x>>1;1&a?(v=u,x=g,u=T,g=C):(u=v,g=x,v=T,x=C),T=D,C=O}const M=4*m;_l[M+0]=u,_l[M+1]=g,_l[M+2]=v,_l[M+3]=x}const pa=new Uint16Array(2178),yl=new Uint8Array(1089),Ho=new Uint16Array(1089);function Yu(m){return m===0?-.03125:m===32?.03125:0}const rg={type:2,extent:r.aj,loadGeometry:()=>[[new r.P(0,0),new r.P(r.aj+1,0),new r.P(r.aj+1,r.aj+1),new r.P(0,r.aj+1),new r.P(0,0)]]};class bl{constructor(a,u,g,v,x){this.tileID=a,this.uid=r.a$(),this.uses=0,this.tileSize=u,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection)}registerFadeDuration(a){const u=a+this.timeAdded;u<r.q.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,u,g){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=ng(a.buckets,u.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const x=this.buckets[v];if(x instanceof r.b1){if(this.hasSymbolBuckets=!0,!g)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const x=this.buckets[v];if(x instanceof r.b1&&x.hasRTLText){this.hasRTLText=!0,r.b2();break}}this.queryPadding=0;for(const v in this.buckets){const x=this.buckets[v],T=u.style.getOwnLayer(v);if(!T)continue;const C=T.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,C)}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas),this._lastUpdatedBrightness=a.brightness}else this.collisionBoxArray=new r.b0}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(a,u,g){a&&(a.resourceTiming&&(this.resourceTiming=a.resourceTiming),this.buckets=Object.assign({},this.buckets,ng(a.buckets,u.style)),a.featureIndex&&(this.latestFeatureIndex=a.featureIndex))}getBucket(a){return this.buckets[a.fqid]}upload(a){for(const v in this.buckets){const x=this.buckets[v];x.uploadPending()&&x.upload(a)}const u=a.gl,g=this.imageAtlas;g&&!g.uploaded&&(this.imageAtlasTexture=new r.T(a,g.image,u.RGBA8,{useMipmap:!!g.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(a,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(a,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(a,u,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture,g),!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=u.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(u,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}queryRenderedFeatures(a,u,g,v,x,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=function(M,D){const O=r.bn([],[.5*M.width,.5*-M.height,1]);return r.bo(O,O,[1,-1,0]),r.az(O,O,M.calculateProjMatrix(D.toUnwrapped())),Float32Array.from(O)}(x,this.tileID);return this.latestFeatureIndex.query(a,{tilespaceGeometry:u,pixelPosMatrix:C,transform:v,availableImages:g,tileTransform:this.tileTransform})}querySourceFeatures(a,u){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const v=g.loadVTLayers(),x=u?u.sourceLayer:"",T=v._geojsonTileLayer||v[x];if(!T)return;const C=r.b3(u&&u.filter),{z:M,x:D,y:O}=this.tileID.canonical,z={z:M,x:D,y:O};for(let L=0;L<T.length;L++){const V=T.feature(L);if(C.needGeometry){const Q=r.b4(V,!0);if(!C.filter(new r.aa(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!C.filter(new r.aa(this.tileID.overscaledZ),V))continue;const Y=g.getId(V,x),q=new r.b5(V,M,D,O,Y);q.tile=z,a.push(q)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(a){const u=this.expirationTime;if(a.cacheControl){const g=r.b6(a.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const g=Date.now();let v=!1;if(this.expirationTime>g)v=!1;else if(u)if(this.expirationTime<u)v=!0;else{const x=this.expirationTime-u;x?this.expirationTime=g+Math.max(x,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(a){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&a&&this.updateBuckets(a)}updateBuckets(a,u){if(!this.latestFeatureIndex||!a.style)return;const g=this.latestFeatureIndex.loadVTLayers(),v=a.style.listImages(),x=a.style.getBrightness();for(const T in this.buckets){if(!a.style.hasLayer(T))continue;const C=this.buckets[T],M=C.layers[0],D=M.sourceLayer||"_geojsonTileLayer",O=g[D],z=a.style.getLayerSourceCache(M);let L={};z&&(L=z._state.getState(D,void 0));const V=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Y=Object.keys(L).length>0&&!u;Y&&!C.stateDependentLayers.length&&!u||C.update(L,O,v,V,Y?C.stateDependentLayers:C.layers,u,x),(C instanceof r.b7||C instanceof r.b8)&&a._terrain&&a._terrain.enabled&&z&&C.uploadPending()&&a._terrain._clearRenderCacheForTile(z.id,this.tileID);const q=a&&a.style&&a.style.getOwnLayer(T);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=r.q.now()+a}setTexture(a,u){const g=u.context,v=g.gl;this.texture=this.texture||u.getTileTexture(a.width),this.texture&&this.texture instanceof r.T?this.texture.update(a):(this.texture=new r.T(g,a,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(a,u){const g={};for(const v of u)g[v]=!0;this.dependencies[a]=g}hasDependency(a,u){for(const g of a){const v=this.dependencies[g];if(v){for(const x of u)if(v[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const g=r.b9(rg,this.tileID.canonical,this.tileTransform)[0],v=new r.ba,x=new r.bb;for(let T=0;T<g.length;T++){const{x:C,y:M}=g[T];v.emplaceBack(C,M),x.emplaceBack(T)}x.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(x),this._tileDebugBuffer=a.createVertexBuffer(v,r.bc.members),this._tileDebugSegments=r.bd.simpleSegment(0,0,v.length,x.length)}_makeTileBoundsBuffers(a,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const g=r.b9(rg,this.tileID.canonical,this.tileTransform)[0];let v,x;if(this.isRaster){const T=function(C,M){const D=r.aW(C,M),O=Math.pow(2,C.z);for(let Q=0;Q<fa;Q++)for(let Z=0;Z<fa;Z++){const se=r.aX((C.x+(Z+Yu(Z))/_o)/O),de=r.aY((C.y+(Q+Yu(Q))/_o)/O),me=M.project(se,de),Se=Q*fa+Z;pa[2*Se+0]=Math.round((me.x*D.scale-D.x)*r.aj),pa[2*Se+1]=Math.round((me.y*D.scale-D.y)*r.aj)}yl.fill(0),Ho.fill(0);for(let Q=2045;Q>=0;Q--){const Z=4*Q,se=_l[Z+0],de=_l[Z+1],me=_l[Z+2],Se=_l[Z+3],ve=se+me>>1,xe=de+Se>>1,ge=ve+xe-de,Ie=xe+se-ve,Re=de*fa+se,Xe=Se*fa+me,je=xe*fa+ve,lt=Math.hypot((pa[2*Re+0]+pa[2*Xe+0])/2-pa[2*je+0],(pa[2*Re+1]+pa[2*Xe+1])/2-pa[2*je+1])>=16;yl[je]=yl[je]||(lt?1:0),Q<1022&&(yl[je]=yl[je]||yl[(de+Ie>>1)*fa+(se+ge>>1)]||yl[(Se+Ie>>1)*fa+(me+ge>>1)])}const z=new r.aZ,L=new r.a_;let V=0;function Y(Q,Z){const se=Z*fa+Q;return Ho[se]===0&&(z.emplaceBack(pa[2*se+0],pa[2*se+1],Q*r.aj/_o,Z*r.aj/_o),Ho[se]=++V),Ho[se]-1}function q(Q,Z,se,de,me,Se){const ve=Q+se>>1,xe=Z+de>>1;if(Math.abs(Q-me)+Math.abs(Z-Se)>1&&yl[xe*fa+ve])q(me,Se,Q,Z,ve,xe),q(se,de,me,Se,ve,xe);else{const ge=Y(Q,Z),Ie=Y(se,de),Re=Y(me,Se);L.emplaceBack(ge,Ie,Re)}}return q(0,0,_o,_o,_o,0),q(_o,_o,0,0,0,_o),{vertices:z,indices:L}}(this.tileID.canonical,u);v=T.vertices,x=T.indices}else{v=new r.aZ,x=new r.a_;for(const{x:C,y:M}of g)v.emplaceBack(C,M,0,0);const T=r.be(v.int16.subarray(0,4*v.length),void 0,4);for(let C=0;C<T.length;C+=3)x.emplaceBack(T[C],T[C+1],T[C+2])}this._tileBoundsBuffer=a.createVertexBuffer(v,r.bf.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(x),this._tileBoundsSegments=r.bd.simpleSegment(0,0,v.length,x.length)}_makeGlobeTileDebugBuffers(a,u){const g=u.projection;if(!g||g.name!=="globe"||u.freezeTileCoverage)return;const v=this.tileID.canonical,x=r.bg(v,u),T=r.bh(x),C=r.ah(u.zoom);let M;C>0&&(M=r.bi(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,v,u,T,M,C),this._makeGlobeTileDebugTextBuffer(a,v,u,T,M,C)}_globePoint(a,u,g,v,x,T,C){let M=r.bj(a,u,g);if(T){const D=1<<g.z,O=r.ay(v.center.lng),z=r.aH(v.center.lat),L=(g.x+.5)/D-O;let V=0;L>.5?V=-1:L<-.5&&(V=1);let Y=(a/r.aj+g.x)/D+V,q=(u/r.aj+g.y)/D;Y=(Y-O)*v._pixelsPerMercatorPixel+O,q=(q-z)*v._pixelsPerMercatorPixel+z;const Q=[Y*v.worldSize,q*v.worldSize,0];r.ad(Q,Q,T),M=r.bk(M,Q,C)}return r.ad(M,M,x)}_makeGlobeTileDebugBorderBuffer(a,u,g,v,x,T){const C=new r.ba,M=new r.bb,D=new r.bl,O=(L,V,Y,q,Q)=>{const Z=(Y-L)/(Q-1),se=(q-V)/(Q-1),de=C.length;for(let me=0;me<Q;me++){const Se=L+me*Z,ve=V+me*se;C.emplaceBack(Se,ve);const xe=this._globePoint(Se,ve,u,g,v,x,T);D.emplaceBack(xe[0],xe[1],xe[2]),M.emplaceBack(de+me)}},z=r.aj;O(0,0,z,0,16),O(z,0,z,z,16),O(z,z,0,z,16),O(0,z,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(M),this._tileDebugBuffer=a.createVertexBuffer(C,r.bc.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(D,r.bm.members),this._tileDebugSegments=r.bd.simpleSegment(0,0,C.length,M.length)}_makeGlobeTileDebugTextBuffer(a,u,g,v,x,T){const C=r.aj/4,M=new r.ba,D=new r.a_,O=new r.bl,z=25;D.reserve(32),M.reserve(z),O.reserve(z);const L=(V,Y)=>z*V+Y;for(let V=0;V<z;V++){const Y=V*C;for(let q=0;q<z;q++){const Q=q*C;M.emplaceBack(Q,Y);const Z=this._globePoint(Q,Y,u,g,v,x,T);O.emplaceBack(Z[0],Z[1],Z[2])}}for(let V=0;V<4;V++)for(let Y=0;Y<4;Y++){const q=L(V,Y),Q=L(V,Y+1),Z=L(V+1,Y),se=L(V+1,Y+1);D.emplaceBack(q,Q,Z),D.emplaceBack(Z,Q,se)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(D),this._tileDebugTextBuffer=a.createVertexBuffer(M,r.bc.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(O,r.bm.members),this._tileDebugTextSegments=r.bd.simpleSegment(0,0,z,32)}destroy(a=!1){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!a&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bp.setPbf(r.bq);class Zu extends bl{constructor(a,u,g,v,x){super(a,u,g,v,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(a){return this._mrt&&this._mrt.getLayer(a)}setTexture(a,u){const g=u.context,v=g.gl;this.texture=this.texture||u.getTileTexture(a.width),this.texture&&this.texture instanceof r.T?this.texture.update(a,{premultiply:!1}):this.texture=new r.T(g,a,v.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(a=16384,u){const g=this._mrt=new r.bp(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(a-1)}});return this.entireBuffer=null,this.request=r.br(v,(x,T,C,M)=>{if(x)u(x);else try{const D=g.getHeaderLength(T);if(D>a)return void(this.request=this.fetchHeader(D,u));g.parseHeader(T),this._isHeaderLoaded=!0;let O=0;for(const z of Object.values(g.layers))O=Math.max(O,z.dataIndex[z.dataIndex.length-1].lastByte);T.byteLength>=O&&(this.entireBuffer=T),u(null,this.entireBuffer||T,C,M)}catch(D){u(D)}}),this.request}fetchBand(a,u,g){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void g(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void g(new Error("Can't fetch tile band without an actor"));let T;const C=(z,L)=>{T.complete(z,L),z?g(z):(this.updateTextureDescriptor(a,u),g(null,this.textureDescriptor&&this.textureDescriptor.img))},M=(z,L)=>{if(z)return g(z);const V=x.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:L,task:T},C,void 0,!0);this._workQueue.push(()=>{V&&V.cancel(),T.cancel()})},D=v.getLayer(a);if(!D)return void g(new Error(`Unknown sourceLayer "${a}"`));if(D.hasDataForBand(u))return this.updateTextureDescriptor(a,u),void g(null,this.textureDescriptor?this.textureDescriptor.img:null);const O=D.getDataRange([u]);if(T=v.createDecodingTask(O),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)M(null,this.entireBuffer.slice(O.firstByte,O.lastByte+1));else{const z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${O.firstByte}-${O.lastByte}`}}),L=r.br(z,M);this._fetchQueue.push(()=>{L.cancel(),T.cancel()})}else g(null)}updateNeeded(a,u){return(!this.textureDescriptor||this.textureDescriptor.band!==u||this.textureDescriptor.layer!==a)&&this.state!=="errored"}updateTextureDescriptor(a,u){if(!this._mrt)return;const g=this._mrt.getLayer(a);if(!g||!g.hasBand(u)||!g.hasDataForBand(u))return;const{bytes:v,tileSize:x,buffer:T,offset:C,scale:M}=g.getBandView(u),D=x+2*T,O=new r.r({width:D,height:D},v),z=this.texture;z&&z instanceof r.T&&z.update(O,{premultiply:!1}),this.textureDescriptor={layer:a,band:u,img:O,buffer:T,offset:C,tileSize:x,format:g.pixelFormat,mix:[M,256*M,65536*M,16777216*M]}}}class sg{constructor(a,u){this.max=a,this.onRemove=u,this.reset()}reset(){for(const a in this.data)for(const u of this.data[a])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(a,u,g){const v=a.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const x={value:u,timeout:void 0};if(g!==void 0&&(x.timeout=setTimeout(()=>{this.remove(a,x)},g)),this.data[v].push(x),this.order.push(v),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const u=this.data[a].shift();return u.timeout&&clearTimeout(u.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),u.value}getByKey(a){const u=this.data[a];return u?u[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,u){if(!this.has(a))return this;const g=a.wrapped().key,v=u===void 0?0:this.data[g].indexOf(u),x=this.data[g][v];return this.data[g].splice(v,1),x.timeout&&clearTimeout(x.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(x.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(a){const u=[];for(const g in this.data)for(const v of this.data[g])a(v.value)||u.push(v);for(const g of u)this.remove(g.value.tileID,g)}}class Ku{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,u,g){const v=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][v]=this.stateChanges[a][v]||{},r.l(this.stateChanges[a][v],g),this.deletedStates[a]===null){this.deletedStates[a]={};for(const x in this.state[a])x!==v&&(this.deletedStates[a][x]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][v]===null){this.deletedStates[a][v]={};for(const x in this.state[a][v])g[x]||(this.deletedStates[a][v][x]=null)}else for(const x in g)this.deletedStates[a]&&this.deletedStates[a][v]&&this.deletedStates[a][v][x]===null&&delete this.deletedStates[a][v][x]}removeFeatureState(a,u,g){if(this.deletedStates[a]===null)return;const v=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},g&&u!==void 0)this.deletedStates[a][v]!==null&&(this.deletedStates[a][v]=this.deletedStates[a][v]||{},this.deletedStates[a][v][g]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][v])for(g in this.deletedStates[a][v]={},this.stateChanges[a][v])this.deletedStates[a][v][g]=null;else this.deletedStates[a][v]=null;else this.deletedStates[a]=null}getState(a,u){const g=this.state[a]||{},v=this.stateChanges[a]||{},x=this.deletedStates[a];if(x===null)return{};if(u!==void 0){const C=String(u),M=r.l({},g[C],v[C]);if(x){const D=x[u];if(D===null)return{};for(const O in D)delete M[O]}return M}const T=r.l({},g,v);if(x)for(const C in x)delete T[C];return T}initializeTileState(a,u){a.refreshFeatureState(u)}coalesceChanges(a,u){const g={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const x={};for(const T in this.stateChanges[v])this.state[v][T]||(this.state[v][T]={}),r.l(this.state[v][T],this.stateChanges[v][T]),x[T]=this.state[v][T];g[v]=x}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const x={};if(this.deletedStates[v]===null)for(const T in this.state[v])x[T]={},this.state[v][T]={};else for(const T in this.deletedStates[v]){if(this.deletedStates[v][T]===null)this.state[v][T]={};else if(this.state[v][T])for(const C of Object.keys(this.deletedStates[v][T]))delete this.state[v][T][C];x[T]=this.state[v][T]}g[v]=g[v]||{},r.l(g[v],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const v in a)a[v].refreshFeatureState(u)}}class Ns extends r.E{constructor(a,u,g){super(),this.id=a,this._onlySymbols=g,u.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new sg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ku,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(a){this.map=a,this._minTileCacheSize=this._minTileCacheSize===void 0&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles)if(!this._tiles[a].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,u){return a.isSymbolTile=this._onlySymbols,a.isExtraShadowCaster=this._shadowCasterTiles[a.tileID.key],this._source.loadTile(a,u)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a)}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a)}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const g=this._tiles[u];g.upload(a),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(zf).map(a=>a.key)}getRenderableIds(a,u){const g=[];for(const v in this._tiles)this._isIdRenderable(+v,a,u)&&g.push(this._tiles[v]);return a?g.sort((v,x)=>{const T=v.tileID,C=x.tileID,M=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),D=new r.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-C.overscaledZ||D.y-M.y||D.x-M.x}).map(v=>v.tileID.key):g.map(v=>v.tileID).sort(zf).map(v=>v.key)}hasRenderableParent(a){const u=this.findLoadedParent(a,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(a,u,g){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(u||!this._tiles[a].holdingForFade())&&(g||!this._shadowCasterTiles[a])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(+a,"reloading")}}_reloadTile(a,u){const g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=u),this._loadTile(g,this._tileLoaded.bind(this,g,a,u)))}_tileLoaded(a,u,g,v){if(v)if(a.state="errored",v.status!==404)this._source.fire(new r.z(v,{tile:a}));else{if(this._source.fire(new r.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:a})),!(a.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else a.timeAdded=r.q.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(u,a),this._source.type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new r.A("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id}))}_backfillDEM(a){const u=this.getRenderableIds();for(let v=0;v<u.length;v++){const x=u[v];if(a.neighboringTiles&&a.neighboringTiles[x]){const T=this.getTileByID(x);g(a,T),g(T,a)}}function g(v,x){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let T=x.tileID.canonical.x-v.tileID.canonical.x;const C=x.tileID.canonical.y-v.tileID.canonical.y,M=Math.pow(2,v.tileID.canonical.z),D=x.tileID.key;T===0&&C===0||Math.abs(C)>1||(Math.abs(T)>1&&(Math.abs(T+M)===1?T+=M:Math.abs(T-M)===1&&(T-=M)),x.dem&&v.dem&&(v.dem.backfillBorder(x.dem,T,C),v.neighboringTiles&&v.neighboringTiles[D]&&(v.neighboringTiles[D].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,u,g,v){for(const x in this._tiles){let T=this._tiles[x];if(v[x]||!T.hasData()||T.tileID.overscaledZ<=u||T.tileID.overscaledZ>g)continue;let C=T.tileID;for(;T&&T.tileID.overscaledZ>u+1;){const D=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[D.key],T&&T.hasData()&&(C=D)}let M=C;for(;M.overscaledZ>u;)if(M=M.scaledTo(M.overscaledZ-1),a[M.key]){v[C.key]=C;break}}}findLoadedParent(a,u){if(a.key in this._loadedParentTiles){const g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=u?g:null}for(let g=a.overscaledZ-1;g>=u;g--){const v=a.scaledTo(g),x=this._getLoadedTile(v);if(x)return x}}_getLoadedTile(a){const u=this._tiles[a.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,u){u=u||this._source.tileSize;const g=Math.ceil(a.width/u)+1,v=Math.ceil(a.height/u)+1,x=Math.floor(g*v*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(C)}handleWrapJump(a){const u=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,u){const g={};for(const v in this._tiles){const x=this._tiles[v];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+u),g[x.tileID.key]=x}this._tiles=g;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(a,u,g,v,x){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(a,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let C,M=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const L=D.attenuationRange()[0],V=Math.floor(L)-Math.log2(D.getDemUpscale());M>V&&(M=V)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new r.aM(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y));else if(this.tileCoverLift!==0){const L=a.clone();L.tileCoverLift=this.tileCoverLift,C=L.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&a.projection.name==="globe"&&(C.push(new r.aM(1,0,1,0,0)),C.push(new r.aM(1,0,1,1,0)),C.push(new r.aM(1,0,1,0,1)),C.push(new r.aM(1,0,1,1,1)))}else if(C=a.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const L=this._source.hasTile.bind(this._source);C=C.filter(V=>L(V))}}else C=[];if(C.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Nf(this._source.type)){const L=a.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),V=Math.min(L,this._source.maxzoom);if(T){const Y=a.extendTileCover(C,V);for(const q of Y)C.push(q)}else if(x){const Y=a.extendTileCover(C,V,this.transform._camera.forward());for(const q of Y)C.push(q)}else if(this.castsShadows&&v){const Y=a.extendTileCover(C,V,v);for(const q of Y)this._shadowCasterTiles[q.key]=!0,C.push(q)}}const O=this._updateRetainedTiles(C);if(Nf(this._source.type)&&C.length!==0){const L={},V={},Y=Object.keys(O);for(const Q of Y){const Z=O[Q],se=this._tiles[Q];if(!se||se.fadeEndTime&&se.fadeEndTime<=r.q.now())continue;const de=this.findLoadedParent(Z,Math.max(Z.overscaledZ-Ns.maxOverzooming,this._source.minzoom));de&&(this._addTile(de.tileID),L[de.tileID.key]=de.tileID),V[Q]=Z}const q=C[C.length-1].overscaledZ;for(const Q in this._tiles){const Z=this._tiles[Q];if(O[Q]||!Z.hasData())continue;let se=Z.tileID;for(;se.overscaledZ>q;){se=se.scaledTo(se.overscaledZ-1);const de=this._tiles[se.key];if(de&&de.hasData()&&V[se.key]){O[Q]=Z.tileID;break}}}for(const Q in L)O[Q]||(this._coveredTiles[Q]=!0,O[Q]=L[Q])}for(const L in O)this._tiles[L].clearFadeHold();const z=r.bs(this._tiles,O);for(const L of z){const V=this._tiles[L];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(+L)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const u={};if(a.length===0)return u;const g={},v=a.reduce((D,O)=>Math.min(D,O.overscaledZ),1/0),x=a[0].overscaledZ,T=Math.max(x-Ns.maxOverzooming,this._source.minzoom),C=Math.max(x+Ns.maxUnderzooming,this._source.minzoom),M={};for(const D of a){const O=this._addTile(D);u[D.key]=D,O.hasData()||v<this._source.maxzoom&&(M[D.key]=D)}this._retainLoadedChildren(M,v,C,u);for(const D of a){let O=this._tiles[D.key];if(O.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const L=D.children(this._source.maxzoom)[0],V=this.getTile(L);if(V&&V.hasData()){u[L.key]=L;continue}}else{const L=D.children(this._source.maxzoom);if(u[L[0].key]&&u[L[1].key]&&u[L[2].key]&&u[L[3].key])continue}let z=O.wasRequested();for(let L=D.overscaledZ-1;L>=T;--L){const V=D.scaledTo(L);if(g[V.key]||(g[V.key]=!0,O=this.getTile(V),!O&&z&&(O=this._addTile(V)),O&&(u[V.key]=V,z=O.wasRequested(),O.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const u=[];let g,v=this._tiles[a].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){g=this._loadedParentTiles[v.key];break}u.push(v.key);const x=v.scaledTo(v.overscaledZ-1);if(g=this._getLoadedTile(x),g)break;v=x}for(const x of u)this._loadedParentTiles[x]=g}}_addTile(a){let u=this._tiles[a.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[a.key]||this._reloadTile(a.key,"reloading"),u;u=this._cache.getAndRemove(a),u&&(this._setTileReloadTimer(a.key,u),u.tileID=a,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,u)));const g=!!u;if(!g){const v=this.map?this.map.painter:null,x=this._source.tileSize*a.overscaleFactor();u=this._source.type==="raster-array"?new Zu(a,x,this.transform.tileZoom,v,this._isRaster):new bl(a,x,this.transform.tileZoom,v,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,a.key,u.state))}return u.uses++,this._tiles[a.key]=u,g||this._source.fire(new r.A("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(a,u){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const g=u.getExpiryTimeout();g&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},g))}_removeTile(a){const u=this._tiles[a];u&&(u.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,u,g){const v=[],x=this.transform;if(!x)return v;const T=x.projection.name==="globe",C=r.ay(x.center.lng);for(const M in this._tiles){const D=this._tiles[M];if(g&&D.clearQueryDebugViz(),D.holdingForFade())continue;let O;if(T){const z=D.tileID.canonical;if(z.z===0){const L=[Math.abs(r.aD(C,...kh(z,-1))-C),Math.abs(r.aD(C,...kh(z,1))-C)];O=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(r.aD(C,...kh(z,-1))-C),Math.abs(r.aD(C,...kh(z,0))-C),Math.abs(r.aD(C,...kh(z,1))-C)];O=[L.indexOf(Math.min(...L))-1]}}else O=[0];for(const z of O){const L=a.containsTile(D,x,u,z);L&&v.push(L)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(a){return this._getRenderableCoordinates(a)}_getRenderableCoordinates(a,u){const g=this.getRenderableIds(a,u).map(x=>this._tiles[x].tileID),v=this.transform.projection.name==="globe";for(const x of g)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=v?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return g}sortCoordinatesByDistance(a){const u=a.slice(),g=this.transform._camera.position,v=this.transform._camera.forward(),x={};for(const T of u){const C=1/(1<<T.canonical.z);x[T.key]=((T.canonical.x+.5)*C+T.wrap-g[0])*v[0]+((T.canonical.y+.5)*C-g[1])*v[1]-g[2]*v[2]}return u.sort((T,C)=>x[T.key]-x[C.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(Nf(this._source.type))for(const a in this._tiles){const u=this._tiles[a];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(a,u,g){this._state.updateState(a=a||"_geojsonTileLayer",u,g)}removeFeatureState(a,u,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",u,g)}getFeatureState(a,u){return this._state.getState(a=a||"_geojsonTileLayer",u)}setDependencies(a,u,g){const v=this._tiles[a];v&&v.setDependencies(u,g)}reloadTilesForDependencies(a,u){for(const g in this._tiles)this._tiles[g].hasDependency(a,u)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(a,u))}_preloadTiles(a,u){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(a,u))};return void this._source.on("data",M)}const g=new Map,v=Array.isArray(a)?a:[a],x=this.map.painter.terrain,T=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const M of v){const D=M.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const O of D)g.set(O.key,O);this.usedForTerrain&&M.updateElevation(!1)}const C=Array.from(g.values());r.bt(C,(M,D)=>{const O=new bl(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(O,z=>{this._source.type==="raster-dem"&&O.dem&&this._backfillDEM(O),D(z,O)})},u)}}function zf(m,a){const u=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*a.wrap)-+(a.wrap<0);return m.overscaledZ-a.overscaledZ||g-u||a.canonical.y-m.canonical.y||a.canonical.x-m.canonical.x}function Nf(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function kh(m,a){const u=1<<m.z;return[m.x/u+a,(m.x+1)/u+a]}Ns.maxOverzooming=10,Ns.maxUnderzooming=3;class O0{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const a=!1,u=!1;for(const g in this.style._mergedLayers){const v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:a,visibilityChanged:u});else if(v.type==="model"){const x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:a,visibilityChanged:u})}}}onNewFrame(a){this.layersGotHidden=!1;for(const u of this.layers){const g=u.layer;let v=!1;g.type==="fill-extrusion"?v=!g.isHidden(a)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(a)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&u.visible,u.visible=v}}updateZOffset(a,u){this.currentBuildingBuckets=[];for(const v of this.layers){const x=v.layer,T=this.style.getLayerSourceCache(x);let C=1;x.type==="fill-extrusion"&&(C=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let M=T?T.getTile(u):null;if(!M&&T&&u.canonical.z>T.getSource().minzoom){let D=u.scaledTo(Math.min(T.getSource().maxzoom,u.overscaledZ-1));for(;D.overscaledZ>=T.getSource().minzoom&&(M=T.getTile(D),!M&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(x):null,tileID:M?M.tileID:u,verticalScale:C})}a.hasAnyZOffset=!1;let g=!1;for(let v=0;v<a.symbolInstances.length;v++){const x=a.symbolInstances.get(v),T=x.zOffset,C=this._getHeightAtTileOffset(u,x.tileAnchorX,x.tileAnchorY);x.zOffset=C!==Number.NEGATIVE_INFINITY?C:T,g||T===x.zOffset||(g=!0),a.hasAnyZOffset||x.zOffset===0||(a.hasAnyZOffset=!0)}g&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,u,g,v){let x=u,T=g;if(a.canonical.z!==v.canonical.z){const C=v.canonical,M=1/(1<<a.canonical.z-C.z);x=(u+a.canonical.x*r.aj)*M-C.x*r.aj|0,T=(g+a.canonical.y*r.aj)*M-C.y*r.aj|0}return{tileX:x,tileY:T}}_getHeightAtTileOffset(a,u,g){let v,x;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:M,verticalScale:D}=this.currentBuildingBuckets[T];if(!C)continue;const{tileX:O,tileY:z}=this._mapCoordToOverlappingTile(a,u,g,M),L=C.getHeightAtTileCoord(O,z);L&&L.height!==void 0&&(L.hidden?v=L.height:x=Math.max(L.height*D,x||0))}if(x!==void 0)return x;for(let T=0;T<this.layers.length;++T){const C=this.layers[T];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:M,tileID:D}=this.currentBuildingBuckets[T];if(!M)continue;const{tileX:O,tileY:z}=this._mapCoordToOverlappingTile(a,u,g,D),L=M.getHeightAtTileCoord(O,z);if(L&&!L.hidden)return L.height===void 0&&v!==void 0?Math.min(L.maxHeight,v)*L.verticalScale:L.height?L.height*L.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Uf(m,a){const u={};for(const g in m)g!=="ref"&&(u[g]=m[g]);return r.bu.forEach(g=>{g in a&&(u[g]=a[g])}),u}function Vf(m){m=m.slice();const a=Object.create(null);for(let u=0;u<m.length;u++)a[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=Uf(m[u],a[m[u].ref]));return m}const Ki={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ph(m,a,u){u.push({command:Ki.addSource,args:[m,a[m]]})}function Dh(m,a,u){a.push({command:Ki.removeSource,args:[m]}),u[m]=!0}function Dw(m,a,u,g){Dh(m,u,g),Ph(m,a,u)}function F0(m,a,u){let g;for(g in m[u])if(m[u].hasOwnProperty(g)&&g!=="data"&&!r.bv(m[u][g],a[u][g]))return!1;for(g in a[u])if(a[u].hasOwnProperty(g)&&g!=="data"&&!r.bv(m[u][g],a[u][g]))return!1;return!0}function Vc(m,a,u,g,v,x){let T;for(T in a=a||{},m=m||{})m.hasOwnProperty(T)&&(r.bv(m[T],a[T])||u.push({command:x,args:[g,T,a[T],v]}));for(T in a)a.hasOwnProperty(T)&&!m.hasOwnProperty(T)&&(r.bv(m[T],a[T])||u.push({command:x,args:[g,T,a[T],v]}))}function Kl(m){return m.id}function Bh(m,a){return m[a.id]=a,m}class L0{constructor(a,u){this.reset(a,u)}reset(a,u){this.points=a||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=r.aD(a,0,1);let u=1,g=this._distances[u];const v=a*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];const x=u-1,T=this._distances[x],C=g-T,M=C>0?(v-T)/C:0;return this.points[x].mult(1-M).add(this.points[u].mult(M))}}class og{constructor(a,u,g){const v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(a/g),this.yCellCount=Math.ceil(u/g);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=u,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,u,g,v,x){this._forEachCell(u,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(a,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(a,u,g,v,x,T){this.boxCells[x].push(T)}_insertCircleCell(a,u,g,v,x,T){this.circleCells[x].push(T)}_query(a,u,g,v,x,T){if(g<0||a>this.width||v<0||u>this.height)return!x&&[];const C=[];if(a<=0&&u<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const D=this.circles[3*M],O=this.circles[3*M+1],z=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:D-z,y1:O-z,x2:D+z,y2:O+z})}return T?C.filter(T):C}return this._forEachCell(a,u,g,v,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?C.length>0:C}_queryCircle(a,u,g,v,x){const T=a-g,C=a+g,M=u-g,D=u+g;if(C<0||T>this.width||D<0||M>this.height)return!v&&[];const O=[];return this._forEachCell(T,M,C,D,this._queryCellCircle,O,{hitTest:v,circle:{x:a,y:u,radius:g},seenUids:{box:{},circle:{}}},x),v?O.length>0:O}query(a,u,g,v,x){return this._query(a,u,g,v,!1,x)}hitTest(a,u,g,v,x){return this._query(a,u,g,v,!0,x)}hitTestCircle(a,u,g,v){return this._queryCircle(a,u,g,!0,v)}_queryCell(a,u,g,v,x,T,C,M){const D=C.seenUids,O=this.boxCells[x];if(O!==null){const L=this.bboxes;for(const V of O)if(!D.box[V]){D.box[V]=!0;const Y=4*V;if(a<=L[Y+2]&&u<=L[Y+3]&&g>=L[Y+0]&&v>=L[Y+1]&&(!M||M(this.boxKeys[V]))){if(C.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[V],x1:L[Y],y1:L[Y+1],x2:L[Y+2],y2:L[Y+3]})}}}const z=this.circleCells[x];if(z!==null){const L=this.circles;for(const V of z)if(!D.circle[V]){D.circle[V]=!0;const Y=3*V;if(this._circleAndRectCollide(L[Y],L[Y+1],L[Y+2],a,u,g,v)&&(!M||M(this.circleKeys[V]))){if(C.hitTest)return T.push(!0),!0;{const q=L[Y],Q=L[Y+1],Z=L[Y+2];T.push({key:this.circleKeys[V],x1:q-Z,y1:Q-Z,x2:q+Z,y2:Q+Z})}}}}}_queryCellCircle(a,u,g,v,x,T,C,M){const D=C.circle,O=C.seenUids,z=this.boxCells[x];if(z!==null){const V=this.bboxes;for(const Y of z)if(!O.box[Y]){O.box[Y]=!0;const q=4*Y;if(this._circleAndRectCollide(D.x,D.y,D.radius,V[q+0],V[q+1],V[q+2],V[q+3])&&(!M||M(this.boxKeys[Y])))return T.push(!0),!0}}const L=this.circleCells[x];if(L!==null){const V=this.circles;for(const Y of L)if(!O.circle[Y]){O.circle[Y]=!0;const q=3*Y;if(this._circlesCollide(V[q],V[q+1],V[q+2],D.x,D.y,D.radius)&&(!M||M(this.circleKeys[Y])))return T.push(!0),!0}}}_forEachCell(a,u,g,v,x,T,C,M){const D=this._convertToXCellCoord(a),O=this._convertToYCellCoord(u),z=this._convertToXCellCoord(g),L=this._convertToYCellCoord(v);for(let V=D;V<=z;V++)for(let Y=O;Y<=L;Y++)if(x.call(this,a,u,g,v,this.xCellCount*Y+V,T,C,M))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,u,g,v,x,T){const C=v-a,M=x-u,D=g+T;return D*D>C*C+M*M}_circleAndRectCollide(a,u,g,v,x,T,C){const M=(T-v)/2,D=Math.abs(a-(v+M));if(D>M+g)return!1;const O=(C-x)/2,z=Math.abs(u-(x+O));if(z>O+g)return!1;if(D<=M||z<=O)return!0;const L=D-M,V=z-O;return L*L+V*V<=g*g}}const $c={unknown:0,flipRequired:1,flipNotRequired:2},Ju=Math.tan(85*Math.PI/180);function Oh(m,a,u,g,v,x,T){const C=r.bz();if(u)if(x.name==="globe"){const M=r.bA(v,a);r.az(C,C,M)}else{const M=r.bB([],T);C[0]=M[0],C[1]=M[1],C[4]=M[2],C[5]=M[3],g||r.by(C,C,v.angle)}else r.az(C,v.labelPlaneMatrix,m);return C}function $f(m,a,u,g,v,x,T){const C=Oh(m,a,u,g,v,x,T);return x.name==="globe"&&u||(C[2]=C[6]=C[10]=C[14]=0),C}function ag(m,a,u,g,v,x,T){if(u){if(x.name==="globe"){const C=Oh(m,a,u,g,v,x,T);return r.bi(C,C),r.az(C,m,C),C}{const C=r.bw(m),M=r.bx([]);return M[0]=T[0],M[1]=T[1],M[4]=T[2],M[5]=T[3],r.az(C,C,M),g||r.by(C,C,-v.angle),C}}return v.glCoordMatrix}function yo(m,a,u,g){const v=[m,a,u,1];u?r.aA(v,v,g):z0(v,v,g);const x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function Jl(m,a){return Math.min(.5+m/a*.5,1.5)}function lg(m,a){const u=m[0]/m[3],g=m[1]/m[3];return u>=-a[0]&&u<=a[0]&&g>=-a[1]&&g<=a[1]}function cg(m,a,u,g,v,x,T,C,M,D){const O=u.transform,z=g?m.textSizeData:m.iconSizeData,L=r.bH(z,u.transform.zoom),V=O.projection.name==="globe",Y=[256/u.width*2+1,256/u.height*2+1],q=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;q.clear();let Q=null;V&&(Q=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const Z=m.lineVertexArray,se=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,de=u.transform.width/u.transform.height;let me,Se=!1;for(let ve=0;ve<se.length;ve++){const xe=se.get(ve),{numGlyphs:ge,writingMode:Ie}=xe;if(Ie!==r.bI.vertical||Se||me===r.bI.horizontal||(Se=!0),me=Ie,(xe.hidden||Ie===r.bI.vertical)&&!Se){rn(ge,q);continue}Se=!1;const Re=new r.P(xe.tileAnchorX,xe.tileAnchorY);let{x:Xe,y:je,z:lt}=O.projection.projectTilePoint(Re.x,Re.y,D.canonical);if(M){const[jt,Jt,Vt]=M(Re);Xe+=jt,je+=Jt,lt+=Vt}const it=[Xe,je,lt,1];if(r.aA(it,it,a),!lg(it,Y)){rn(ge,q);continue}const Ct=it[3],$e=Jl(u.transform.getCameraToCenterDistance(O.projection),Ct),qe=r.bJ(z,L,xe),Ue=T?qe/$e:qe*$e,ut=yo(Xe,je,lt,v);if(ut[3]<=0){rn(ge,q);continue}let Ze={};const gt=r.al(m.layers[0].layout.get("text-max-angle")),ct=Math.cos(gt),yt=T?null:M,vt=bo(xe,Ue,!1,C,a,v,x,m.glyphOffsetArray,Z,q,Q,ut,Re,Ze,de,yt,O.projection,D,T,ct);Se=vt.useVertical,yt&&vt.needsFlipping&&(Ze={}),(vt.notEnoughRoom||Se||vt.needsFlipping&&bo(xe,Ue,!0,C,a,v,x,m.glyphOffsetArray,Z,q,Q,ut,Re,Ze,de,yt,O.projection,D,T,ct).notEnoughRoom)&&rn(ge,q)}g?(m.text.dynamicLayoutVertexBuffer.updateData(q),Q&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(Q)):(m.icon.dynamicLayoutVertexBuffer.updateData(q),Q&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(Q))}function jf(m,a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q){const{lineStartIndex:Z,glyphStartIndex:se,segment:de}=C,me=se+C.numGlyphs,Se=Z+C.lineLength,ve=a.getoffsetX(se),xe=a.getoffsetX(me-1),ge=Qu(m*ve,u,g,v,x,T,de,Z,Se,M,D,O,z,L,!0,V,Y,q,Q);if(!ge)return null;const Ie=Qu(m*xe,u,g,v,x,T,de,Z,Se,M,D,O,z,L,!0,V,Y,q,Q);return Ie?{first:ge,last:Ie}:null}function jc(m,a,u,g){return m===r.bI.horizontal&&Math.abs(g)>Math.abs(u)?{useVertical:!0}:m===r.bI.vertical?g>0?{needsFlipping:!0}:null:a!==$c.unknown&&function(v,x){return v===0||Math.abs(x/v)>Ju}(u,g)?a===$c.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function bo(m,a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q,Z,se,de){const me=a/24,Se=m.lineOffsetX*me,ve=m.lineOffsetY*me,{lineStartIndex:xe,glyphStartIndex:ge,numGlyphs:Ie,segment:Re,writingMode:Xe,flipState:je}=m,lt=xe+m.lineLength,it=Ct=>{if(O){const[ut,Ze,gt]=Ct.up,ct=D.length;r.bK(O,ct+0,ut,Ze,gt),r.bK(O,ct+1,ut,Ze,gt),r.bK(O,ct+2,ut,Ze,gt),r.bK(O,ct+3,ut,Ze,gt)}const[$e,qe,Ue]=Ct.point;r.bL(D,$e,qe,Ue,Ct.angle)};if(Ie>1){const Ct=jf(me,C,Se,ve,u,z,L,m,M,x,V,q,!1,Q,Z,se,de);if(!Ct)return{notEnoughRoom:!0};if(g&&!u){let[$e,qe,Ue]=Ct.first.point,[ut,Ze,gt]=Ct.last.point;[$e,qe]=yo($e,qe,Ue,T),[ut,Ze]=yo(ut,Ze,gt,T);const ct=jc(Xe,je,(ut-$e)*Y,Ze-qe);if(m.flipState=ct&&ct.needsFlipping?$c.flipRequired:$c.flipNotRequired,ct)return ct}it(Ct.first);for(let $e=ge+1;$e<ge+Ie-1;$e++){const qe=Qu(me*C.getoffsetX($e),Se,ve,u,z,L,Re,xe,lt,M,x,V,q,!1,!1,Q,Z,se,de);if(!qe)return D.length-=4*($e-ge),{notEnoughRoom:!0};it(qe)}it(Ct.last)}else{if(g&&!u){const $e=yo(L.x,L.y,0,v),qe=xe+Re+1,Ue=new r.P(M.getx(qe),M.gety(qe)),ut=yo(Ue.x,Ue.y,0,v),Ze=ut[3]>0?ut:Hf(L,Ue,$e,1,v,void 0,Q,Z.canonical),gt=jc(Xe,je,(Ze[0]-$e[0])*Y,Ze[1]-$e[1]);if(m.flipState=gt&&gt.needsFlipping?$c.flipRequired:$c.flipNotRequired,gt)return gt}const Ct=Qu(me*C.getoffsetX(ge),Se,ve,u,z,L,Re,xe,lt,M,x,V,q,!1,!1,Q,Z,se,de);if(!Ct)return{notEnoughRoom:!0};it(Ct)}return{}}function hg(m,a,u,g,v){const{x,y:T,z:C}=g.projectTilePoint(m.x,m.y,a);if(!v)return yo(x,T,C,u);const[M,D,O]=v(m);return yo(x+M,T+D,C+O,u)}function Hf(m,a,u,g,v,x,T,C){const M=hg(m.sub(a)._unit()._add(m),C,v,T,x);return r.at(M,u,M),r.au(M,M),r.bF(M,u,M,g)}function Qu(m,a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q,Z,se){const de=g?m-a:m+a;let me=de>0?1:-1,Se=0;g&&(me*=-1,Se=Math.PI),me<0&&(Se+=Math.PI);let ve=C+T+(me>0?0:1)|0,xe=v,ge=v,Ie=0,Re=0;const Xe=Math.abs(de),je=[],lt=[];let it=x,Ct=it,$e=r.bC([]);const qe=()=>Hf(Ct,it,ge,Xe-Ie+1,O,L,q,Q.canonical);for(;Ie+Re<=Xe;){if(ve+=me,ve<C||ve>=M)return null;if(ge=xe,Ct=it,je.push(ge),V&&lt.push(Ct),it=new r.P(D.getx(ve),D.gety(ve)),xe=z[ve],!xe){const Vt=hg(it,Q.canonical,O,q,L);xe=Vt[3]>0?z[ve]=Vt:qe()}Ie+=Re;const jt=r.at([],xe,ge),Jt=r.bD(ge,xe);if(u&&Jt>0&&Re>0&&r.bE($e,jt)/(Re*Jt)<se)return null;Re=Jt,$e=jt}Y&&L&&(z[ve]&&(xe=qe(),Re=r.bD(ge,xe),$e=r.at([],xe,ge)),z[ve]=xe);const Ue=(Xe-Ie)/Re,ut=it.sub(Ct)._mult(Ue)._add(Ct),Ze=r.bF([],ge,$e,Ue);let gt=[0,0,1],ct=$e[0],yt=$e[1];if(Z&&(gt=q.upVector(Q.canonical,ut.x,ut.y),gt[0]!==0||gt[1]!==0||gt[2]!==1)){const jt=[gt[2],0,-gt[0]],Jt=r.bG([],gt,jt);r.au(jt,jt),r.au(Jt,Jt),ct=r.bE($e,jt),yt=r.bE($e,Jt)}if(u){const jt=r.bG([],gt,$e);r.au(jt,jt),r.bF(Ze,Ze,jt,u*me)}const vt=Se+Math.atan2(yt,ct);return je.push(Ze),V&&lt.push(ut),{point:Ze,angle:vt,path:je,tilePath:lt,up:gt}}function rn(m,a){const u=a.length,g=u+4*m;a.resize(g),a.float32.fill(-1/0,4*u,4*g)}function z0(m,a,u){const g=a[0],v=a[1];return m[0]=u[0]*g+u[4]*v+u[12],m[1]=u[1]*g+u[5]*v+u[13],m[3]=u[3]*g+u[7]*v+u[15],m}const ri=100;class N0{constructor(a,u,g=new og(a.width+200,a.height+200,25),v=new og(a.width+200,a.height+200,25)){this.transform=a,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+ri,this.screenBottomBoundary=a.height+ri,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=u}placeCollisionBox(a,u,g,v,x,T,C,M){let D=g.projectedAnchorX,O=g.projectedAnchorY,z=g.projectedAnchorZ;const L=g.elevation,V=g.tileID,Y=a.getProjection();if(L&&V){const[ve,xe,ge]=Y.upVector(V.canonical,g.tileAnchorX,g.tileAnchorY),Ie=Y.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=ve*L*Ie,O+=xe*L*Ie,z+=ge*L*Ie}const q=this.projectAndGetPerspectiveRatio(C,D,O,z,g.tileID,Y.name==="globe"||!!L||this.transform.pitch>0,Y),Q=T*q.perspectiveRatio,Z=(g.x1*u+v.x-g.padding)*Q+q.point.x,se=(g.y1*u+v.y-g.padding)*Q+q.point.y,de=(g.x2*u+v.x+g.padding)*Q+q.point.x,me=(g.y2*u+v.y+g.padding)*Q+q.point.y,Se=q.perspectiveRatio<=.55||q.occluded;return!this.isInsideGrid(Z,se,de,me)||!x&&this.grid.hitTest(Z,se,de,me,M)||Se?{box:[],offscreen:!1,occluded:q.occluded}:{box:[Z,se,de,me],offscreen:this.isOffscreen(Z,se,de,me),occluded:!1}}placeCollisionCircles(a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q){const Q=[],Z=this.transform.elevation,se=a.getProjection(),de=Z?Z.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,se):null,me=new r.P(g.tileAnchorX,g.tileAnchorY);let{x:Se,y:ve,z:xe}=se.projectTilePoint(me.x,me.y,q.canonical);if(de){const[gt,ct,yt]=de(me);Se+=gt,ve+=ct,xe+=yt}const ge=se.name==="globe",Ie=this.projectAndGetPerspectiveRatio(C,Se,ve,xe,q,ge||!!Z||this.transform.pitch>0,se),{perspectiveRatio:Re}=Ie,Xe=(z?T/Re:T*Re)/r.bO,je=yo(Se,ve,xe,M),lt=g.lineOffsetX*Xe,it=g.lineOffsetY*Xe,Ct=r.al(a.layers[0].layout.get("text-max-angle")),$e=Math.cos(Ct),qe=Ie.signedDistanceFromCamera>0?jf(Xe,x,lt,it,!1,je,me,g,v,M,{},Z&&!z?de:null,z&&!!Z,se,q,z,$e):null;let Ue=!1,ut=!1,Ze=!0;if(qe&&!Ie.occluded){const gt=.5*V*Re+Y,ct=new r.P(-100,-100),yt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),vt=new L0,{first:jt,last:Jt}=qe,Vt=jt.path.length;let Qt=[];for(let mi=Vt-1;mi>=1;mi--)Qt.push(jt.path[mi]);for(let mi=1;mi<Jt.path.length;mi++)Qt.push(Jt.path[mi]);const Gt=2.5*gt;D&&(Qt=Qt.map(([mi,Oi,mn],un)=>(de&&!ge&&(mn=de(un<Vt-1?jt.tilePath[Vt-1-un]:Jt.tilePath[un-Vt+2])[2]),yo(mi,Oi,mn,D))),Qt.some(mi=>mi[3]<=0)&&(Qt=[]));let ai=[];if(Qt.length>0){let mi=1/0,Oi=-1/0,mn=1/0,un=-1/0;for(const zi of Qt)mi=Math.min(mi,zi[0]),mn=Math.min(mn,zi[1]),Oi=Math.max(Oi,zi[0]),un=Math.max(un,zi[1]);Oi>=ct.x&&mi<=yt.x&&un>=ct.y&&mn<=yt.y&&(ai=[Qt.map(zi=>new r.P(zi[0],zi[1]))],(mi<ct.x||Oi>yt.x||mn<ct.y||un>yt.y)&&(ai=r.bM(ai,ct.x,ct.y,yt.x,yt.y)))}for(const mi of ai){vt.reset(mi,.25*gt);let Oi=0;Oi=vt.length<=.5*gt?1:Math.ceil(vt.paddedLength/Gt)+1;for(let mn=0;mn<Oi;mn++){const un=mn/Math.max(Oi-1,1),zi=vt.lerp(un),tr=zi.x+ri,Wn=zi.y+ri;Q.push(tr,Wn,gt,0);const wi=tr-gt,$i=Wn-gt,Ji=tr+gt,gn=Wn+gt;if(Ze=Ze&&this.isOffscreen(wi,$i,Ji,gn),ut=ut||this.isInsideGrid(wi,$i,Ji,gn),!u&&this.grid.hitTestCircle(tr,Wn,gt,L)&&(Ue=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Ue,occluded:!1}}}}return{circles:!O&&Ue||!ut?[]:Q,offscreen:Ze,collisionDetected:Ue,occluded:Ie.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let g=1/0,v=1/0,x=-1/0,T=-1/0;for(const O of a){const z=new r.P(O.x+ri,O.y+ri);g=Math.min(g,z.x),v=Math.min(v,z.y),x=Math.max(x,z.x),T=Math.max(T,z.y),u.push(z)}const C=this.grid.query(g,v,x,T).concat(this.ignoredGrid.query(g,v,x,T)),M={},D={};for(const O of C){const z=O.key;if(M[z.bucketInstanceId]===void 0&&(M[z.bucketInstanceId]={}),M[z.bucketInstanceId][z.featureIndex])continue;const L=[new r.P(O.x1,O.y1),new r.P(O.x2,O.y1),new r.P(O.x2,O.y2),new r.P(O.x1,O.y2)];r.bN(u,L)&&(M[z.bucketInstanceId][z.featureIndex]=!0,D[z.bucketInstanceId]===void 0&&(D[z.bucketInstanceId]=[]),D[z.bucketInstanceId].push(z.featureIndex))}return D}insertCollisionBox(a,u,g,v,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,u,g,v,x){const T=u?this.ignoredGrid:this.grid,C={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let M=0;M<a.length;M+=4)T.insertCircle(C,a[M],a[M+1],a[M+2])}projectAndGetPerspectiveRatio(a,u,g,v,x,T,C){const M=[u,g,v,1];let D=!1;v||this.transform.pitch>0?(r.aA(M,M,a),this.fogState&&x&&C.name!=="globe"&&(D=function(L,V,Y,q,Q,Z){const se=Z.calculateFogTileMatrix(Q),de=[V,Y,q];return r.ad(de,de,se),Yt(L,r.ae(de),Z.pitch,Z._fov)}(this.fogState,u,g,v,x.toUnwrapped(),this.transform)>.9)):z0(M,M,a);const O=M[3];return{point:new r.P((M[0]/O+1)/2*this.transform.width+ri,(-M[1]/O+1)/2*this.transform.height+ri),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/O*.5,1.5),signedDistanceFromCamera:O,occluded:T&&M[2]>O||D}}isOffscreen(a,u,g,v){return g<ri||a>=this.screenRightBoundary||v<ri||u>this.screenBottomBoundary}isInsideGrid(a,u,g,v){return g>=0&&a<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const a=r.bx([]);return r.bo(a,a,[-100,-100,0]),a}}function Wf(m,a,u){const g=a.createTileMatrix(m,m.worldSize,u.toUnwrapped());return r.az(new Float32Array(16),m.projMatrix,g)}function Gf(m,a,u){if(a.projection.name===u.projection.name)return m.projMatrix;const g=u.clone();return g.setProjection(a.projection),Wf(g,a.getProjection(),m)}function ed(m,a,u){return a.name===u.projection.name?m.projMatrix:Wf(u,a,m)}class Wo{constructor(a,u,g,v){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Hc{constructor(a,u,g,v,x,T=!1){this.text=new Wo(a?a.text:null,u,g,x),this.icon=new Wo(a?a.icon:null,u,v,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ql{constructor(a,u,g,v=!1){this.text=a,this.icon=u,this.skipFade=g,this.clipped=v}}class ti{constructor(){this.invProjMatrix=r.bz(),this.viewportMatrix=r.bz(),this.circles=[]}}class bn{constructor(a,u,g,v,x){this.bucketInstanceId=a,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class hn{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const u=++this.maxGroupID;this.collisionGroups[a]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[a]}}function eo(m,a,u,g,v){const{horizontalAlign:x,verticalAlign:T}=r.bV(m),C=-(x-.5)*a,M=-(T-.5)*u,D=r.bU(m,g);return new r.P(C+D[0]*v,M+D[1]*v)}function ec(m,a,u,g,v){const x=new r.P(m,a);return u&&x._rotate(g?v:-v),x}class an{constructor(a,u,g,v,x,T){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new N0(this.transform,x),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new hn(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,u,g,v,x=1){const T=g.getBucket(u),C=g.latestFeatureIndex;if(!T||!C||u.fqid!==T.layerIds[0])return;const M=T.layers[0].layout,D=T.layers[0].paint,O=g.collisionBoxArray,z=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/r.aj,V=g.tileID.toUnwrapped();this.transform.setProjection(T.projection);const Y=(q=g.tileID,Q=T.getProjection(),Z=this.transform,Q.name===this.projection?Z.calculateProjMatrix(q.toUnwrapped()):Wf(Z,Q,q));var q,Q,Z;const se=M.get("text-pitch-alignment")==="map",de=M.get("text-rotation-alignment")==="map";u.compileFilter(u.options);const me=u.dynamicFilter(),Se=u.dynamicFilterNeedsFeature(),ve=this.transform.calculatePixelsToTileUnitsMatrix(g),xe=$f(Y,g.tileID.canonical,se,de,this.transform,T.getProjection(),ve);let ge=null;if(se){const qe=ag(Y,g.tileID.canonical,se,de,this.transform,T.getProjection(),ve);ge=r.az([],this.transform.labelPlaneMatrix,qe)}let Ie=null;me&&g.latestFeatureIndex&&(Ie={unwrappedTileID:V,dynamicFilter:me,dynamicFilterNeedsFeature:Se}),this.retainedQueryData[T.bucketInstanceId]=new bn(T.bucketInstanceId,C,T.sourceLayerIndex,T.index,g.tileID);const[Re,Xe]=T.layers[0].layout.get("text-size-scale-range"),je=r.aD(x,Re,Xe),[lt,it]=M.get("icon-size-scale-range"),Ct=r.aD(x,lt,it),$e={bucket:T,layout:M,paint:D,posMatrix:Y,textLabelPlaneMatrix:xe,labelToScreenMatrix:ge,clippingData:Ie,scale:z,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:r.bH(T.textSizeData,this.transform.zoom,je),partiallyEvaluatedIconSize:r.bH(T.iconSizeData,this.transform.zoom,Ct),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(v)for(const qe of T.sortKeyRanges){const{sortKey:Ue,symbolInstanceStart:ut,symbolInstanceEnd:Ze}=qe;a.push({sortKey:Ue,symbolInstanceStart:ut,symbolInstanceEnd:Ze,parameters:$e})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:$e})}attemptAnchorPlacement(a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q,Z,se){const{textOffset0:de,textOffset1:me,crossTileID:Se}=L,ve=[de,me],xe=eo(a,g,v,ve,x),ge=this.collisionIndex.placeCollisionBox(Y,x,u,ec(xe.x,xe.y,T,C,this.transform.angle),z,M,D,O.predicate);if(Q){const Ie=Y.getSymbolInstanceIconSize(se,this.transform.zoom,L.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,Ie,Q,ec(xe.x,xe.y,T,C,this.transform.angle),z,M,D,O.predicate).box.length===0)return}if(ge.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[Se]&&this.prevPlacement.placements[Se]&&this.prevPlacement.placements[Se].text&&(Ie=this.prevPlacement.variableOffsets[Se].anchor),this.variableOffsets[Se]={textOffset:ve,width:g,height:v,anchor:a,textScale:x,prevAnchor:Ie},this.markUsedJustification(Y,a,L,q),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,q,L),this.placedOrientations[Se]=q),{shift:xe,placedGlyphBoxes:ge}}}placeLayerBucketPart(a,u,g,v,x=1){const{bucket:T,layout:C,paint:M,posMatrix:D,textLabelPlaneMatrix:O,labelToScreenMatrix:z,clippingData:L,textPixelRatio:V,holdingForFade:Y,collisionBoxArray:q,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:Z,collisionGroup:se,latestFeatureIndex:de}=a.parameters,me=C.get("text-optional"),Se=C.get("icon-optional"),ve=C.get("text-allow-overlap"),xe=C.get("icon-allow-overlap"),ge=C.get("text-rotation-alignment")==="map",Ie=C.get("text-pitch-alignment")==="map",Re=M.get("symbol-z-offset"),Xe=C.get("symbol-elevation-reference")==="sea",[je,lt]=C.get("text-size-scale-range"),[it,Ct]=C.get("icon-size-scale-range"),$e=r.aD(x,je,lt),qe=r.aD(x,it,Ct);this.transform.setProjection(T.projection);let Ue=ve&&(xe||!T.hasIconData()||Se),ut=xe&&(ve||!T.hasTextData()||me);const Ze=!Re.isConstant();!T.collisionArrays&&q&&T.deserializeCollisionBoxes(q),g&&v&&T.updateCollisionDebugBuffers(this.transform.zoom,q,$e,qe);const gt=(ct,yt,vt)=>{const{crossTileID:jt,numVerticalGlyphVertices:Jt}=ct;let Vt=null;if(L&&L.dynamicFilterNeedsFeature||Ze){const Yi=this.retainedQueryData[T.bucketInstanceId];Vt=de.loadFeature({featureIndex:ct.featureIndex,bucketIndex:Yi.bucketIndex,sourceLayerIndex:Yi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(L&&!(0,L.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Vt,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(ct.tileAnchorX,ct.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[jt]=new Ql(!1,!1,!1,!0),void u.add(jt);const Qt=Re.evaluate(Vt,{});if(u.has(jt))return;if(Y)return void(this.placements[jt]=new Ql(!1,!1,!1));let Gt=!1,ai=!1,mi=!0,Oi=!1,mn=!1,un=null,zi={box:null,offscreen:null,occluded:null},tr={box:null},Wn=null,wi=null,$i=null,Ji=0,gn=0,Cr=0;vt.textFeatureIndex?Ji=vt.textFeatureIndex:ct.useRuntimeCollisionCircles&&(Ji=ct.featureIndex),vt.verticalTextFeatureIndex&&(gn=vt.verticalTextFeatureIndex);const ar=Yi=>{Yi.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Ln=this.transform.elevation;Yi.elevation=Xe?Qt:Qt+(Ln?Ln.getAtTileOffset(Yi.tileID,Yi.tileAnchorX,Yi.tileAnchorY):0),Yi.elevation+=ct.zOffset},Tr=vt.textBox;if(Tr){ar(Tr);const Yi=sn=>{let $n=r.bI.horizontal;if(T.allowVerticalPlacement&&!sn&&this.prevPlacement){const Yr=this.prevPlacement.placedOrientations[jt];Yr&&(this.placedOrientations[jt]=Yr,$n=Yr,this.markUsedOrientation(T,$n,ct))}return $n},Ln=(sn,$n)=>{if(T.allowVerticalPlacement&&Jt>0&&vt.verticalTextBox){for(const Yr of T.writingModes)if(Yr===r.bI.vertical?(zi=$n(),tr=zi):zi=sn(),zi&&zi.box&&zi.box.length)break}else zi=sn()};if(C.get("text-variable-anchor")){let sn=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[jt]){const Mn=this.prevPlacement.variableOffsets[jt];sn.indexOf(Mn.anchor)>0&&(sn=sn.filter(Qr=>Qr!==Mn.anchor),sn.unshift(Mn.anchor))}const $n=(Mn,Qr,xr)=>{const hs=T.getSymbolInstanceTextSize(Q,ct,this.transform.zoom,yt),xa=(Mn.x2-Mn.x1)*hs+2*Mn.padding,El=(Mn.y2-Mn.y1)*hs+2*Mn.padding,xo=ct.hasIconTextFit&&!xe?Qr:null;xo&&ar(xo);let Zo={box:[],offscreen:!1,occluded:!1};const Qa=ve?2*sn.length:sn.length;for(let el=0;el<Qa;++el){const wa=this.attemptAnchorPlacement(sn[el%sn.length],Mn,xa,El,hs,ge,Ie,V,D,se,el>=sn.length,ct,yt,T,xr,xo,Q,Z);if(wa&&(Zo=wa.placedGlyphBoxes,Zo&&Zo.box&&Zo.box.length)){Gt=!0,un=wa.shift;break}}return Zo};Ln(()=>$n(Tr,vt.iconBox,r.bI.horizontal),()=>{const Mn=vt.verticalTextBox;return Mn&&ar(Mn),T.allowVerticalPlacement&&!(zi&&zi.box&&zi.box.length)&&Jt>0&&Mn?$n(Mn,vt.verticalIconBox,r.bI.vertical):{box:null,offscreen:null,occluded:null}}),zi&&(Gt=zi.box,mi=zi.offscreen,Oi=zi.occluded);const Yr=Yi(!(!zi||!zi.box));if(!Gt&&this.prevPlacement){const Mn=this.prevPlacement.variableOffsets[jt];Mn&&(this.variableOffsets[jt]=Mn,this.markUsedJustification(T,Mn.anchor,ct,Yr))}}else{const sn=($n,Yr)=>{const Mn=T.getSymbolInstanceTextSize(Q,ct,this.transform.zoom,yt,x),Qr=this.collisionIndex.placeCollisionBox(T,Mn,$n,new r.P(0,0),ve,V,D,se.predicate);return Qr&&Qr.box&&Qr.box.length&&(this.markUsedOrientation(T,Yr,ct),this.placedOrientations[jt]=Yr),Qr};Ln(()=>sn(Tr,r.bI.horizontal),()=>{const $n=vt.verticalTextBox;return T.allowVerticalPlacement&&Jt>0&&$n?(ar($n),sn($n,r.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Yi(!!(zi&&zi.box&&zi.box.length))}}if(Wn=zi,Gt=Wn&&Wn.box&&Wn.box.length>0,mi=Wn&&Wn.offscreen,Oi=Wn&&Wn.occluded,ct.useRuntimeCollisionCircles){const Yi=T.text.placedSymbolArray.get(ct.centerJustifiedTextSymbolIndex>=0?ct.centerJustifiedTextSymbolIndex:ct.verticalPlacedTextSymbolIndex),Ln=r.bJ(T.textSizeData,Q,Yi),sn=C.get("text-padding");wi=this.collisionIndex.placeCollisionCircles(T,ve,Yi,T.lineVertexArray,T.glyphOffsetArray,Ln,D,O,z,g,Ie,se.predicate,ct.collisionCircleDiameter*Ln/r.bO,sn,this.retainedQueryData[T.bucketInstanceId].tileID),Gt=ve||wi.circles.length>0&&!wi.collisionDetected,mi=mi&&wi.offscreen,Oi=wi.occluded}if(vt.iconFeatureIndex&&(Cr=vt.iconFeatureIndex),vt.iconBox){const Yi=Ln=>{ar(Ln);const sn=ct.hasIconTextFit&&un?ec(un.x,un.y,ge,Ie,this.transform.angle):new r.P(0,0),$n=T.getSymbolInstanceIconSize(Z,this.transform.zoom,ct.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,$n,Ln,sn,xe,V,D,se.predicate)};tr&&tr.box&&tr.box.length&&vt.verticalIconBox?($i=Yi(vt.verticalIconBox),ai=$i.box.length>0):($i=Yi(vt.iconBox),ai=$i.box.length>0),mi=mi&&$i.offscreen,mn=$i.occluded}const Vn=me||ct.numHorizontalGlyphVertices===0&&Jt===0,Ei=Se||ct.numIconVertices===0;if(Vn||Ei?Ei?Vn||(ai=ai&&Gt):Gt=ai&&Gt:ai=Gt=ai&&Gt,Gt&&Wn&&Wn.box&&this.collisionIndex.insertCollisionBox(Wn.box,C.get("text-ignore-placement"),T.bucketInstanceId,tr&&tr.box&&gn?gn:Ji,se.ID),ai&&$i&&this.collisionIndex.insertCollisionBox($i.box,C.get("icon-ignore-placement"),T.bucketInstanceId,Cr,se.ID),wi&&(Gt&&this.collisionIndex.insertCollisionCircles(wi.circles,C.get("text-ignore-placement"),T.bucketInstanceId,Ji,se.ID),g)){const Yi=T.bucketInstanceId;let Ln=this.collisionCircleArrays[Yi];Ln===void 0&&(Ln=this.collisionCircleArrays[Yi]=new ti);for(let sn=0;sn<wi.circles.length;sn+=4)Ln.circles.push(wi.circles[sn+0]),Ln.circles.push(wi.circles[sn+1]),Ln.circles.push(wi.circles[sn+2]),Ln.circles.push(wi.collisionDetected?1:0)}const Fn=T.projection.name!=="globe";Ue=Ue&&(Fn||!Oi),ut=ut&&(Fn||!mn),this.placements[jt]=new Ql(Gt||Ue,ai||ut,mi||T.justReloaded),u.add(jt)};if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.elevationType==="road"&&T.updateRoadElevation(),T.updateZOffset(),T.sortFeaturesByY){const ct=T.getSortedSymbolIndexes(this.transform.angle);for(let yt=ct.length-1;yt>=0;--yt){const vt=ct[yt];gt(T.symbolInstances.get(vt),vt,T.collisionArrays[vt])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const ct=T.getSortedIndexesByZOffset();for(let yt=0;yt<ct.length;++yt){const vt=ct[yt];gt(T.symbolInstances.get(vt),vt,T.collisionArrays[vt])}}else for(let ct=a.symbolInstanceStart;ct<a.symbolInstanceEnd;ct++)gt(T.symbolInstances.get(ct),ct,T.collisionArrays[ct]);if(g&&T.bucketInstanceId in this.collisionCircleArrays){const ct=this.collisionCircleArrays[T.bucketInstanceId];r.bi(ct.invProjMatrix,D),ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(a,u,g,v){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:M,crossTileID:D}=g,O=r.bT(u),z=v===r.bI.vertical?M:O==="left"?x:O==="center"?T:O==="right"?C:-1;x>=0&&(a.text.placedSymbolArray.get(x).crossTileID=z>=0&&x!==z?0:D),T>=0&&(a.text.placedSymbolArray.get(T).crossTileID=z>=0&&T!==z?0:D),C>=0&&(a.text.placedSymbolArray.get(C).crossTileID=z>=0&&C!==z?0:D),M>=0&&(a.text.placedSymbolArray.get(M).crossTileID=z>=0&&M!==z?0:D)}markUsedOrientation(a,u,g){const v=u===r.bI.horizontal||u===r.bI.horizontalOnly?u:0,x=u===r.bI.vertical?u:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:D}=g,O=a.text.placedSymbolArray;T>=0&&(O.get(T).placedOrientation=v),C>=0&&(O.get(C).placedOrientation=v),M>=0&&(O.get(M).placedOrientation=v),D>=0&&(O.get(D).placedOrientation=x)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(a):1,x=u?u.opacities:{},T=u?u.variableOffsets:{},C=u?u.placedOrientations:{};for(const M in this.placements){const D=this.placements[M],O=x[M];O?(this.opacities[M]=new Hc(O,v,D.text,D.icon,null,D.clipped),g=g||D.text!==O.text.placed||D.icon!==O.icon.placed):(this.opacities[M]=new Hc(null,v,D.text,D.icon,D.skipFade,D.clipped),g=g||D.text||D.icon)}for(const M in x){const D=x[M];if(!this.opacities[M]){const O=new Hc(D,v,!1,!1);O.isHidden()||(this.opacities[M]=O,g=g||D.text.placed||D.icon.placed)}}for(const M in T)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=T[M]);for(const M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);g?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:a)}updateLayerOpacities(a,u,g,v){const x=new Set;for(const T of u){const C=T.getBucket(a);C&&T.latestFeatureIndex&&a.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,x,T,T.collisionBoxArray,g,v,T.tileID,a.scope),C.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,T.tileID),C.elevationType==="road"&&C.updateRoadElevation(),C.updateZOffset())}}updateBucketOpacities(a,u,g,v,x,T,C,M){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const D=a.layers[0].layout,O=a.layers[0].paint,z=!!a.layers[0].dynamicFilter(),L=new Hc(null,0,!1,!1,!0),V=D.get("text-allow-overlap"),Y=D.get("icon-allow-overlap"),q=D.get("text-variable-anchor"),Q=D.get("text-rotation-alignment")==="map",Z=D.get("text-pitch-alignment")==="map",se=O.get("symbol-z-offset"),de=D.get("symbol-elevation-reference")==="sea",me=!se.isConstant(),Se=new Hc(null,0,V&&(Y||!a.hasIconData()||D.get("icon-optional")),Y&&(V||!a.hasTextData()||D.get("text-optional")),!0);!a.collisionArrays&&v&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(v);const ve=(ge,Ie,Re)=>{for(let Xe=0;Xe<Ie/4;Xe++)ge.opacityVertexArray.emplaceBack(Re)};let xe=0;T&&a.updateReplacement(C,T);for(let ge=0;ge<a.symbolInstances.length;ge++){const Ie=a.symbolInstances.get(ge),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:Xe,crossTileID:je,numIconVertices:lt,tileAnchorX:it,tileAnchorY:Ct}=Ie;let $e=null;const qe=this.retainedQueryData[a.bucketInstanceId];me&&Ie&&qe&&($e=g.latestFeatureIndex.loadFeature({featureIndex:Ie.featureIndex,bucketIndex:qe.bucketIndex,sourceLayerIndex:qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ue=se.evaluate($e,{}),ut=u.has(je);let Ze=this.opacities[je];ut?Ze=L:Ze||(Ze=Se,this.opacities[je]=Ze),u.add(je);const gt=Re>0||Xe>0,ct=lt>0,yt=this.placedOrientations[je],vt=yt===r.bI.vertical,jt=yt===r.bI.horizontal||yt===r.bI.horizontalOnly;!gt&&!ct||Ze.isHidden()||xe++;let Jt=!1;if((gt||ct)&&T)for(const Vt of a.activeReplacements){if(r.bP(Vt,x,r.bQ.Symbol,M)||Vt.min.x>it||it>Vt.max.x||Vt.min.y>Ct||Ct>Vt.max.y)continue;const Qt=r.bR(it,Ct,C.canonical,Vt.footprintTileId.canonical);if(Jt=r.bS(Qt,Vt.footprint),Jt)break}if(gt){const Vt=Jt?tc:Fh(Ze.text);ve(a.text,Re,vt?tc:Vt),ve(a.text,Xe,jt?tc:Vt);const Qt=Ze.text.isHidden(),{leftJustifiedTextSymbolIndex:Gt,centerJustifiedTextSymbolIndex:ai,rightJustifiedTextSymbolIndex:mi,verticalPlacedTextSymbolIndex:Oi}=Ie,mn=a.text.placedSymbolArray,un=Qt||vt?1:0;Gt>=0&&(mn.get(Gt).hidden=un),ai>=0&&(mn.get(ai).hidden=un),mi>=0&&(mn.get(mi).hidden=un),Oi>=0&&(mn.get(Oi).hidden=Qt||jt?1:0);const zi=this.variableOffsets[je];zi&&this.markUsedJustification(a,zi.anchor,Ie,yt);const tr=this.placedOrientations[je];tr&&(this.markUsedJustification(a,"left",Ie,tr),this.markUsedOrientation(a,tr,Ie))}if(ct){const Vt=Jt?tc:Fh(Ze.icon),{placedIconSymbolIndex:Qt,verticalPlacedIconSymbolIndex:Gt}=Ie,ai=a.icon.placedSymbolArray,mi=Ze.icon.isHidden()?1:0;Qt>=0&&(ve(a.icon,lt,vt?tc:Vt),ai.get(Qt).hidden=mi),Gt>=0&&(ve(a.icon,Ie.numVerticalIconVertices,jt?tc:Vt),ai.get(Gt).hidden=mi)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Vt=a.collisionArrays[ge];if(Vt){let Qt=new r.P(0,0),Gt=!0;if(Vt.textBox||Vt.verticalTextBox){if(q){const mi=this.variableOffsets[je];mi?(Qt=eo(mi.anchor,mi.width,mi.height,mi.textOffset,mi.textScale),Q&&Qt._rotate(Z?this.transform.angle:-this.transform.angle)):Gt=!1}z&&(Gt=!Ze.clipped),Vt.textBox&&Wc(a.textCollisionBox.collisionVertexArray,Ze.text.placed,!Gt||vt,Ue,de,Qt.x,Qt.y),Vt.verticalTextBox&&Wc(a.textCollisionBox.collisionVertexArray,Ze.text.placed,!Gt||jt,Ue,de,Qt.x,Qt.y)}const ai=Gt&&!!(!jt&&Vt.verticalIconBox);Vt.iconBox&&Wc(a.iconCollisionBox.collisionVertexArray,Ze.icon.placed,ai,Ue,de,Ie.hasIconTextFit?Qt.x:0,Ie.hasIconTextFit?Qt.y:0),Vt.verticalIconBox&&Wc(a.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!ai,Ue,de,Ie.hasIconTextFit?Qt.x:0,Ie.hasIconTextFit?Qt.y:0)}}}if(a.fullyClipped=xe===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ge.invProjMatrix,a.placementViewportMatrix=ge.viewportMatrix,a.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>a}setStale(){this.stale=!0}}function Wc(m,a,u,g,v,x,T){m.emplaceBack(a?1:0,u?1:0,x||0,T||0,g,v?1:0),m.emplaceBack(a?1:0,u?1:0,x||0,T||0,g,v?1:0),m.emplaceBack(a?1:0,u?1:0,x||0,T||0,g,v?1:0),m.emplaceBack(a?1:0,u?1:0,x||0,T||0,g,v?1:0)}const td=Math.pow(2,25),id=Math.pow(2,24),Us=Math.pow(2,17),Dr=Math.pow(2,16),Bw=Math.pow(2,9),nd=Math.pow(2,8),ug=Math.pow(2,1);function Fh(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const a=m.placed?1:0,u=Math.floor(127*m.opacity);return u*td+a*id+u*Us+a*Dr+u*Bw+a*nd+u*ug+a}const tc=0;class Xf{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,u,g,v,x,T){const C=this._bucketParts;for(;this._currentTileIndex<a.length;)if(u.getBucketParts(C,v,a[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((M,D)=>M.sortKey-D.sortKey));this._currentPartIndex<C.length;){const M=C[this._currentPartIndex];if(u.placeLayerBucketPart(M,this._seenCrossTileIDs,g,M.symbolInstanceStart===0,T),this._currentPartIndex++,x())return!0}return!1}}class Vs{constructor(a,u,g,v,x,T,C,M,D){this.placement=new an(a,x,T,C,M,D),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(a,u,g,v,x){const T=r.q.now(),C=()=>{const M=r.q.now()-T;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=u[a[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=D)&&(!M.maxzoom||M.maxzoom>D)){const O=M,z=O.layout.get("symbol-z-elevate"),L=O.layout.get("symbol-sort-key").constantOr(1)!==void 0,V=O.layout.get("symbol-z-order"),Y=V==="viewport-y"||V==="auto"&&!(V!=="viewport-y"&&L),q=O.layout.get("text-allow-overlap")||O.layout.get("icon-allow-overlap")||O.layout.get("text-ignore-placement")||O.layout.get("icon-ignore-placement"),Q=Y&&q,Z=this._inProgressLayer=this._inProgressLayer||new Xf(O),se=r.C(M.source,M.scope);if(Z.continuePlacement(z||Q?v[se]:g[se],this.placement,this._showCollisionBoxes,M,C,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const ma=512/r.aj/2;class to{constructor(a,u,g){this.tileID=a,this.bucketInstanceId=g,this.index=new r.bW(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=a.canonical.x*r.aj,x=a.canonical.y*r.aj;for(let T=0;T<u.length;T++){const{key:C,crossTileID:M,tileAnchorX:D,tileAnchorY:O}=u.get(T),z=Math.floor((v+D)*ma),L=Math.floor((x+O)*ma);this.index.add(z,L),this.keys.push(C),this.crossTileIDs.push(M)}this.index.finish()}findMatches(a,u,g){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),x=ma/Math.pow(2,u.canonical.z-this.tileID.canonical.z),T=u.canonical.x*r.aj,C=u.canonical.y*r.aj;for(let M=0;M<a.length;M++){const D=a.get(M);if(D.crossTileID)continue;const{key:O,tileAnchorX:z,tileAnchorY:L}=D,V=Math.floor((T+z)*x),Y=Math.floor((C+L)*x),q=this.index.range(V-v,Y-v,V+v,Y+v).sort((Q,Z)=>Q-Z);for(const Q of q){const Z=this.crossTileIDs[Q];if(this.keys[Q]===O&&!g.has(Z)){g.add(Z),D.crossTileID=Z;break}}}}}class U0{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Lh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const u=Math.round((a-this.lng)/360);if(u!==0)for(const g in this.indexes){const v=this.indexes[g],x={};for(const T in v){const C=v[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+u),x[C.tileID.key]=C}this.indexes[g]=x}this.lng=a}addBucket(a,u,g){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const v=this.usedCrossTileIDs[a.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>a.overscaledZ)for(const C in T){const M=T[C];M.tileID.isChildOf(a)&&M.findMatches(u.symbolInstances,a,v)}else{const C=T[a.scaledTo(Number(x)).key];C&&C.findMatches(u.symbolInstances,a,v)}}for(let x=0;x<u.symbolInstances.length;x++){const T=u.symbolInstances.get(x);T.crossTileID||(T.crossTileID=g.generate(),v.add(T.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new to(a,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(a,u){for(const g of u.crossTileIDs)this.usedCrossTileIDs[a].delete(g)}removeStaleBuckets(a){let u=!1;for(const g in this.indexes){const v=this.indexes[g];for(const x in v)a[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],u=!0)}return u}}class Ur{constructor(){this.layerIndexes={},this.crossTileIDs=new U0,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,u,g,v){let x=this.layerIndexes[a.fqid];x===void 0&&(x=this.layerIndexes[a.fqid]=new Lh);let T=!1;const C={};v.name!=="globe"&&x.handleWrapJump(g);for(const M of u){const D=M.getBucket(a);D&&a.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(M.tileID,D,this.crossTileIDs)&&(T=!0),C[D.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(T=!0),T}pruneUnusedLayers(a){const u={};a.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const $s=771;class Ri{constructor(a,u,g,v){this.blendFunction=a,this.blendColor=u,this.mask=g,this.blendEquation=v}}Ri.Replace=[1,0,1,0],Ri.disabled=new Ri(Ri.Replace,r.am.transparent,[!1,!1,!1,!1]),Ri.unblended=new Ri(Ri.Replace,r.am.transparent,[!0,!0,!0,!0]),Ri.alphaBlended=new Ri([1,$s,1,$s],r.am.transparent,[!0,!0,!0,!0]),Ri.alphaBlendedNonPremultiplied=new Ri([770,$s,770,$s],r.am.transparent,[!0,!0,!0,!0]),Ri.multiply=new Ri([774,0,774,0],r.am.transparent,[!0,!0,!0,!0]);class Wt{constructor(a,u,g){this.func=a,this.mask=u,this.range=g}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const rd=7680;class di{constructor(a,u,g,v,x,T){this.test=a,this.ref=u,this.mask=g,this.fail=v,this.depthFail=x,this.pass=T}}di.disabled=new di({func:519,mask:0},0,0,rd,rd,rd);const Gc=1029,zh=2305;class fi{constructor(a,u,g){this.enable=a,this.mode=u,this.frontFace=g}}function V0(m,a){const u=r.c1(m,3);r.c3(m,a),r.c7(m,3,u)}function ga(m,a){const u=r.bY([]);return r.bZ(u,u,-a),r.b_(u,u,-m),u}function $0(m,a){const u=[m[0],m[1],0],g=[a[0],a[1],0];if(r.ae(u)>=1e-15){const T=r.au([],u);r.b$(g,T,r.bE(g,T)),a[0]=g[0],a[1]=g[1]}const v=r.bG([],a,m);if(r.c0(v)<1e-15)return null;const x=Math.atan2(-v[1],v[0]);return ga(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),x)}fi.disabled=new fi(!1,Gc,zh),fi.backCCW=new fi(!0,Gc,zh),fi.backCW=new fi(!0,Gc,2304),fi.frontCW=new fi(!0,1028,2304),fi.frontCCW=new fi(!0,1028,zh);class qf{constructor(a,u){this.position=a,this.orientation=u}get position(){return this._position}set position(a){if(a){const u=a instanceof r.ac?a:new r.ac(a[0],a[1],a[2]);this._renderWorldCopies&&(u.x=r.bX(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(a,u){if(this.orientation=null,!this.position)return;const g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(r.ac.fromLngLat(a)):0,x=r.ac.fromLngLat(a,v),T=[x.x-g.x,x.y-g.y,x.z-g.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=$0(T,u)}setPitchBearing(a,u){this.orientation=ga(r.al(a),r.al(-u))}}class Ps{constructor(a,u){this._transform=r.bx([]),this.orientation=u,this.position=a}get mercatorPosition(){const a=this.position;return new r.ac(a[0],a[1],a[2])}get position(){const a=r.c1(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var u;a&&r.c7(this._transform,3,[(u=a)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||r.bY([]),a&&V0(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,u){this._orientation=ga(a,u),V0(this._transform,this._orientation)}forward(){const a=r.c1(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=r.c1(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=r.c1(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,u){const g=new Float64Array(16);return r.bi(g,this.getWorldToCamera(a,u)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,u,g){const v=this.position;r.b$(v,v,-a);const x=new Float64Array(16);return r.bn(x,[g,g,g]),r.bo(x,x,v),x[10]*=u,x}getWorldToCamera(a,u){const g=new Float64Array(16),v=new Float64Array(4),x=this.position;return r.c2(v,this._orientation),r.b$(x,x,-a),r.c3(g,v),r.bo(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(a,u,g,v){const x=new Float64Array(16);return r.c4(x,a,u,g,v),x}getCameraToClipOrthographic(a,u,g,v,x,T){const C=new Float64Array(16);return r.c5(C,a,u,g,v,x,T),C}getDistanceToElevation(a,u=!1){const g=a===0?0:r.c6(a,u?r.aY(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new Ps([...this.position],[...this.orientation])}}const js={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Nh{constructor(a=0,u=0,g=0,v=0){if(isNaN(a)||a<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=u,this.left=g,this.right=v}interpolate(a,u,g){return u.top!=null&&a.top!=null&&(this.top=r.ai(a.top,u.top,g)),u.bottom!=null&&a.bottom!=null&&(this.bottom=r.ai(a.bottom,u.bottom,g)),u.left!=null&&a.left!=null&&(this.left=r.ai(a.left,u.left,g)),u.right!=null&&a.right!=null&&(this.right=r.ai(a.right,u.right,g)),this}getCenter(a,u){const g=r.aD((this.left+a-this.right)/2,0,a),v=r.aD((this.top+u-this.bottom)/2,0,u);return new r.P(g,v)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Nh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ic=15;class Xc{constructor(a,u,g,v,x,T,C){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=a||0,this._maxZoom=u||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(T),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new r.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Nh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ps,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const a=new Xc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a._allowWorldUnderZoom=this._allowWorldUnderZoom,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ic}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,u=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(a||g)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return r.aF(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=r.ce(this.projectionOptions);const g=this.getProjection(),v=!r.bv(u,g);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.ce({name:"mercator"});const u=a!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bX(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const u=-a*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=r.cf(),r.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const u=r.aD(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=r.al(a),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const u=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){const a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,x=0;for(let T=0;T<u.length;T++){const C=new r.P(u[T][0]*this.width,g+u[T][1]*(this.height-g)),M=a.pointCoordinate(C);if(!M)continue;const D=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);v+=M[3]*D,x+=D}return x===0?NaN:v/x}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(a),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let g;g=a.z<this._camera.position[2]?[u.x,u.y,u.z]:[a.x,a.y,a.z];const v=r.ae(r.at([],this._camera.position,g));return r.aD(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let u=!1;if(a.orientation&&!r.ch(a.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(a.orientation)),a.position){const g=[a.position.x,a.position.y,a.position.z];r.ci(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,u=new qf;return u.position=new r.ac(a[0],a[1],a[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(a){if(!r.cj(a))return!1;r.ck(a,a);const u=r.cl([],[0,0,-1],a),g=r.cl([],[0,-1,0],a);if(g[2]<0)return!1;const v=$0(u,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(a){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;a[2]=r.aD(a[2],v/g,v/u),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,u,g){this._unmodified=!1,this._edgeInsets.interpolate(a,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const u=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(a){const u=[new r.cm(0,a)];if(this.renderWorldCopies){const g=this.pointCoordinate(new r.P(0,0)),v=this.pointCoordinate(new r.P(this.width,0)),x=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),C=Math.floor(Math.min(g.x,v.x,x.x,T.x)),M=Math.floor(Math.max(g.x,v.x,x.x,T.x)),D=1;for(let O=C-D;O<=M+D;O++)O!==0&&u.push(new r.cm(O,a))}return u}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(a,u,g){let v=[];const x=g!=null,T=!x;if(T&&this.zoom<u||x&&g[0]===0&&g[1]===0)return v;const C=new Set,M=(O,z,L,V,Y)=>{const q=r.cK(z,O,L,V,Y);C.has(q)||(v.push(new r.aM(O,z,L,V,Y)),C.add(q))};for(let O=0;O<a.length;O++){const z=a[O];if(T&&z.canonical.z!==u)continue;const L=z.canonical,V=z.overscaledZ,Y=z.wrap,q=1<<L.z,Q=L.x+1<q,Z=L.x>0,se=L.y+1<q,de=L.y>0,me=z.wrap-(Z?0:1),Se=z.wrap+(Q?0:1),ve=Z?L.x-1:q-1,xe=Q?L.x+1:0;if(x)g[0]<0?(M(V,Se,L.z,xe,L.y),g[1]<0&&se&&(M(V,Y,L.z,L.x,L.y+1),M(V,Se,L.z,xe,L.y+1)),g[1]>0&&de&&(M(V,Y,L.z,L.x,L.y-1),M(V,Se,L.z,xe,L.y-1))):g[0]>0?(M(V,me,L.z,ve,L.y),g[1]<0&&se&&(M(V,Y,L.z,L.x,L.y+1),M(V,me,L.z,ve,L.y+1)),g[1]>0&&de&&(M(V,Y,L.z,L.x,L.y-1),M(V,me,L.z,ve,L.y-1))):g[1]<0&&se?M(V,Y,L.z,L.x,L.y+1):de&&M(V,Y,L.z,L.x,L.y-1);else{const ge=z.visibleQuadrants;1&ge&&(M(V,me,L.z,ve,L.y),de&&(M(V,Y,L.z,L.x,L.y-1),M(V,me,L.z,ve,L.y-1))),2&ge&&(M(V,Se,L.z,xe,L.y),de&&(M(V,Y,L.z,L.x,L.y-1),M(V,Se,L.z,xe,L.y-1))),4&ge&&(M(V,me,L.z,ve,L.y),se&&(M(V,Y,L.z,L.x,L.y+1),M(V,me,L.z,ve,L.y+1))),8&ge&&(M(V,Se,L.z,xe,L.y),se&&(M(V,Y,L.z,L.x,L.y+1),M(V,Se,L.z,xe,L.y+1)))}}const D=[];for(const O of v)v.some(z=>O.isChildOf(z))||D.push(O);if(v=D.filter(O=>!a.some(z=>!!(O.overscaledZ<u&&z.isChildOf(O))||O.equals(z)||O.isChildOf(z))),T){const O=1<<u,z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),L=[O*z.x,O*z.y],V=4,Y=V*V;v=v.filter(q=>{const Q=q.canonical.x+.5-L[0],Z=q.canonical.y+.5-L[1];return Q*Q+Z*Z<Y})}return v}coveringTiles(a){let u=this.coveringZoomLevel(a);const g=u,v=this.elevation&&this.elevation.exaggeration(),x=v&&!a.isTerrainDEM,T=this.projection.name==="mercator";if(a.minzoom!==void 0&&u<a.minzoom)return[];a.maxzoom!==void 0&&u>a.maxzoom&&(u=a.maxzoom);const C=this.locationCoordinate(this.center),M=this.center.lat,D=1<<u,O=[D*C.x,D*C.y,0],z=this.projection.name==="globe",L=!z,V=r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,L),Y=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=D*r.c6(1,this.center.lat),Q=this._camera.position[2]/r.c6(1,this.center.lat),Z=[D*Y.x,D*Y.y,Q*(L?1:q)],se=z||v,de=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),me=this.isLODDisabled(!0)?u:0;let Se;if(this._elevation&&a.isTerrainDEM)Se=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();Se=Ue?Ue.max:this._centerAltitude}else Se=this._centerAltitude;const ve=a.isTerrainDEM?-Se:this._elevation?this._elevation.getMinElevationBelowMSL():0,xe=this.projection.isReprojectedInTileSpace?r.co(this):1,ge=Ue=>{const Ze=new r.ac(Ue.x+25e-6,Ue.y,Ue.z),gt=new r.ac(Ue.x,Ue.y+25e-6,Ue.z),ct=Ue.toLngLat(),yt=Ze.toLngLat(),vt=gt.toLngLat(),jt=this.locationCoordinate(ct),Jt=this.locationCoordinate(yt),Vt=this.locationCoordinate(vt),Qt=Math.hypot(Jt.x-jt.x,Jt.y-jt.y),Gt=Math.hypot(Vt.x-jt.x,Vt.y-jt.y);return Math.sqrt(Qt*Gt)*xe/25e-6},Ie=Ue=>{const ut=Se,Ze=ve;return{aabb:r.cr(this,D,0,0,0,Ue,Ze,ut,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:ut,wrap:Ue,fullyVisible:!1}},Re=[];let Xe=[];const je=u,lt=a.reparseOverscaled?g:u,it=(Q-this._centerAltitude)*q,Ct=Ue=>{if(!this._elevation||!Ue.tileID||!T)return;const ut=this._elevation.getMinMaxForTile(Ue.tileID),Ze=Ue.aabb;ut?(Ze.min[2]=ut.min,Ze.max[2]=ut.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(Ue.shouldSplit=qe(Ue),Ue.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},$e=(Ue,ut)=>{if(.707*ut<Ue)return 1;const Ze=ut/Ue;return Ze/(1.4144271570014144+(Math.pow(1.1,Ze-1.4144271570014144+1)-1)/(1.1-1)-1)},qe=Ue=>{if(Ue.zoom<me)return!0;if(Ue.zoom===je)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const ut=Ue.aabb.distanceX(Z),Ze=Ue.aabb.distanceY(Z);let gt=it,ct=1;if(z){gt=Ue.aabb.distanceZ(Z);const Gt=Math.pow(2,Ue.zoom),ai=r.aY((Ue.y+1)/Gt),mi=r.aY(Ue.y/Gt),Oi=Math.min(Math.max(M,ai),mi),mn=r.cP(Oi)/r.cP(M);if(ct=Oi===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,mn/this._mercatorScaleRatio),this.zoom<=r.cL&&Ue.zoom===je-1&&mn>=.9)return!0}else if(x&&(gt=Ue.aabb.distanceZ(Z)*q),this.projection.isReprojectedInTileSpace&&g<=5){const Gt=Math.pow(2,Ue.zoom),ai=ge(new r.ac((Ue.x+.5)/Gt,(Ue.y+.5)/Gt));ct=ai>.85?1:ai}if(!T){const Gt=Math.sqrt(ut*ut+Ze*Ze+gt*gt);let ai=(1<<je-Ue.zoom)*de*ct;return ai*=$e(Math.max(gt,it),Gt),Gt<ai}let yt=Number.MAX_VALUE,vt=0;const jt=Ue.aabb.getCorners(),Jt=[];for(const Gt of jt){r.at(Jt,Gt,Z),z||(x?Jt[2]*=q:Jt[2]=it);const ai=r.bE(Jt,this._camera.forward());ai<yt&&(yt=ai,vt=Math.abs(Jt[2]))}let Vt=(1<<je-Ue.zoom)*de*ct;if(Vt*=$e(Math.max(vt,it),yt),yt<Vt)return!0;const Qt=Ue.aabb.closestPoint(O);return Qt[0]===O[0]&&Qt[1]===O[1]};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)Re.push(Ie(-Ue)),Re.push(Ie(Ue));for(Re.push(Ie(0));Re.length>0;){const Ue=Re.pop(),ut=Ue.x,Ze=Ue.y;let gt=Ue.fullyVisible;const ct=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!gt){let yt=se?Ue.aabb.intersects(V):Ue.aabb.intersectsFlat(V);if(yt===0&&ct()){const vt=new r.cp(Ue.zoom,ut,Ze);yt=r.cq(this,D,vt,!0).intersects(V)}if(yt===0)continue;gt=yt===2}if(Ue.zoom!==je&&qe(Ue))for(let yt=0;yt<4;yt++){const vt=(ut<<1)+yt%2,jt=(Ze<<1)+(yt>>1),Jt={aabb:T?Ue.aabb.quadrant(yt):r.cr(this,D,Ue.zoom+1,vt,jt,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:vt,y:jt,wrap:Ue.wrap,fullyVisible:gt,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};x&&!z&&(Jt.tileID=new r.aM(Ue.zoom+1===je?lt:Ue.zoom+1,Ue.wrap,Ue.zoom+1,vt,jt),Ct(Jt)),Re.push(Jt)}else{const yt=Ue.zoom===je?lt:Ue.zoom;if(a.minzoom&&a.minzoom>yt)continue;let vt=0;if(!gt){let Qt=se?Ue.aabb.intersectsPrecise(V):Ue.aabb.intersectsPreciseFlat(V);if(Qt===0&&ct()){const Gt=new r.cp(Ue.zoom,ut,Ze);Qt=r.cq(this,D,Gt,!0).intersectsPrecise(V)}if(Qt===0)continue;if(a.calculateQuadrantVisibility)if(V.containsPoint(Ue.aabb.center))vt=15;else for(let Gt=0;Gt<4;Gt++)Ue.aabb.quadrant(Gt).intersects(V)!==0&&(vt|=1<<Gt)}const jt=O[0]-(.5+ut+(Ue.wrap<<Ue.zoom))*(1<<u-Ue.zoom),Jt=O[1]-.5-Ze,Vt=Ue.tileID?Ue.tileID:new r.aM(yt,Ue.wrap,Ue.zoom,ut,Ze);a.calculateQuadrantVisibility&&(Vt.visibleQuadrants=vt),Xe.push({tileID:Vt,distanceSq:jt*jt+Jt*Jt})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,ut=this.horizonLineFromTop();Xe=Xe.filter(Ze=>{const gt=[0,0,0,1],ct=[r.aj,r.aj,0,1],yt=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());r.aA(gt,gt,yt),r.aA(ct,ct,yt);const vt=r.cs([],gt,ct),jt=r.ct([],gt,ct),Jt=r.cM(vt,jt);if(Jt===0)return!0;let Vt=!1;const Qt=this._elevation;if(Qt&&Jt>Ue&&ut!==0){const Gt=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let ai;a.isTerrainDEM||(ai=Qt.getMinMaxForTile(Ze.tileID)),ai||(ai={min:ve,max:Se});const mi=r.cu(this.rotation),Oi=[mi[0]*r.aj,mi[1]*r.aj,ai.max];r.ad(Oi,Oi,Gt),Vt=(1-Oi[1])*this.height*.5<ut}return Jt<Ue||Vt})}return Xe.sort((Ue,ut)=>Ue.distanceSq-ut.distanceSq).map(Ue=>Ue.tileID)}resize(a,u){this.width=a,this.height=u,this.pixelsToGLUnits=[2/a,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const u=r.aD(a.lat,-r.cv,r.cv),g=this.projection.project(a.lng,u);return new r.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,u){let g,v;const x=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;g=(u.x-x.x)/C,v=(u.y-x.y)/C}else{const C=this.pointCoordinate(u),M=this.pointCoordinate(x);g=C.x-M.x,v=C.y-M.y}const T=this.locationCoordinate(a);this.setLocation(new r.ac(T.x-g,T.y-v))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a,u){return this.projection.locationPoint(this,a,u)}locationPoint3D(a,u){return this.projection.locationPoint(this,a,u,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a,u){return this.coordinateLocation(this.pointCoordinate3D(a,u))}locationCoordinate(a,u){const g=u?r.c6(u,a.lat):void 0,v=this.projection.project(a.lng,a.lat);return new r.ac(v.x,v.y,g)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,u){const g=u??this._centerAltitude,v=[a.x,a.y,0,1],x=[a.x,a.y,1,1];r.aA(v,v,this.pixelMatrixInverse),r.aA(x,x,this.pixelMatrixInverse);const T=x[3];r.cw(v,v,1/v[3]),r.cw(x,x,1/T);const C=v[2],M=x[2];return{p0:v,p1:x,t:C===M?0:(g-C)/(M-C)}}screenPointToMercatorRay(a){const u=[a.x,a.y,0,1],g=[a.x,a.y,1,1];return r.aA(u,u,this.pixelMatrixInverse),r.aA(g,g,this.pixelMatrixInverse),r.cw(u,u,1/u[3]),r.cw(g,g,1/g[3]),u[2]=r.c6(u[2],this._center.lat)*this.worldSize,g[2]=r.c6(g[2],this._center.lat)*this.worldSize,r.cw(u,u,1/this.worldSize),r.cw(g,g,1/this.worldSize),new r.av([u[0],u[1],u[2]],r.au([],r.at([],g,u)))}rayIntersectionCoordinate(a){const{p0:u,p1:g,t:v}=a,x=r.c6(u[2],this._center.lat),T=r.c6(g[2],this._center.lat);return new r.ac(r.ai(u[0],g[0],v)/this.worldSize,r.ai(u[1],g[1],v)/this.worldSize,r.ai(x,T,v))}pointCoordinate(a,u=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,u)}pointCoordinate3D(a,u){if(!this.elevation)return this.pointCoordinate(a,u);let g=this.projection.pointCoordinate3D(this,a.x,a.y);if(g)return new r.ac(g[0],g[1],g[2]);let v=0,x=this.horizonLineFromTop();if(a.y>x)return this.pointCoordinate(a,u);const T=.02*x,C=a.clone();for(let M=0;M<10&&x-v>T;M++){C.y=r.ai(v,x,.66);const D=this.projection.pointCoordinate3D(this,C.x,C.y);D?(x=C.y,g=D):v=C.y}return g?new r.ac(g[0],g[1],g[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=r.cx)return!this.isPointAboveHorizon(a);const u=this.pointCoordinate(a);return u.y>=0&&u.y<=1}_coordinatePoint(a,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,v=[a.x*this.worldSize,a.y*this.worldSize,g+a.toAltitude(),1];return r.aA(v,v,this.pixelMatrix),v[3]>0?new r.P(v[0]/v[3],v[1]/v[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:u}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new r.P(u,a)),T=this.pointLocation3D(new r.P(v,a)),C=this.pointLocation3D(new r.P(v,g)),M=this.pointLocation3D(new r.P(u,g));let D=Math.min(x.lng,T.lng,C.lng,M.lng),O=Math.max(x.lng,T.lng,C.lng,M.lng),z=Math.min(x.lat,T.lat,C.lat,M.lat),L=Math.max(x.lat,T.lat,C.lat,M.lat);const V=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,q=(Q,Z,se,de,me)=>{const Se=(Q+se)/2,ve=(Z+de)/2,xe=new r.P(Se,ve),{lng:ge,lat:Ie}=this.pointLocation3D(xe),Re=Math.max(0,D-ge,z-Ie,ge-O,Ie-L);D=Math.min(D,ge),O=Math.max(O,ge),z=Math.min(z,Ie),L=Math.max(L,Ie),(me<Y||Re>V)&&(q(Q,Z,Se,ve,me+1),q(Se,ve,se,de,me+1))};if(q(u,a,v,a,1),q(v,a,v,g,1),q(v,g,u,g,1),q(u,g,u,a,1),this.projection.name==="globe"){const[Q,Z]=r.cy(this);Q?(L=90,O=180,D=-180):Z&&(z=-90,O=180,D=-180)}return new r.aG(new r.cd(D,z),new r.cd(O,L))}_getBoundsRectangular(a,u){const{top:g,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,C=new r.P(v,g),M=new r.P(T,g),D=new r.P(T,x),O=new r.P(v,x);let z=this.pointCoordinate(C,a),L=this.pointCoordinate(M,a);const V=this.pointCoordinate(D,u),Y=this.pointCoordinate(O,u),q=(Q,Z)=>(Z.y-Q.y)/(Z.x-Q.x);return z.y>1&&L.y>=0?z=new r.ac((1-Y.y)/q(Y,z)+Y.x,1):z.y<0&&L.y<=1&&(z=new r.ac(-Y.y/q(Y,z)+Y.x,0)),L.y>1&&z.y>=0?L=new r.ac((1-V.y)/q(V,L)+V.x,1):L.y<0&&z.y<=1&&(L=new r.ac(-V.y/q(V,L)+V.x,0)),new r.aG().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=a.visibleDemTiles.reduce((g,v)=>{if(v.dem){const x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*a.exaggeration(),u.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return a?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-r.cv,this.maxLat=r.cv,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.ay(this.minLng)*this.tileSize,this.worldMaxX=r.ay(this.maxLng)*this.tileSize,this.worldMinY=r.aH(this.maxLat)*this.tileSize,this.worldMaxY=r.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,u){return this.projection.createTileMatrix(this,u,a)}calculateDistanceTileData(a){const u=a.key,g=this._distanceTileDataCache;if(g[u])return g[u];const v=a.canonical,x=1/this.height,T=this.cameraWorldSize,C=T/this.zoomScale(v.z),M=(v.x+Math.pow(2,v.z)*a.wrap)*C,D=v.y*C,O=this.point;O.x*=T/this.worldSize,O.y*=T/this.worldSize;const z=this.angle,L=Math.sin(-z),V=-Math.cos(-z);return g[u]={bearing:[L,V],center:[(O.x-M)*x,(O.y-D)*x],scale:C/r.aj*x},g[u]}calculateFogTileMatrix(a){const u=a.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return r.az(v,this.worldToFogMatrix,v),g[u]=new Float32Array(v),g[u]}calculateProjMatrix(a,u=!1,g=!1){const v=a.key;let x;if(x=g?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];const T=this.calculatePosMatrix(a,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,r.az(T,C,T),x[v]=new Float32Array(T),x[v]}calculatePixelsToTileUnitsMatrix(a){const u=a.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const v=r.cz(a,this);return g[u]=v,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,u=r.bn([],[a,a,a]);return r.az(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const u=r.c6(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=this._camera.forward(),x=r.c6(1,this._center.lat);g[2]/=x,v[2]/=x,r.au(v,v);const T=a.raycast(g,v,a.exaggeration());if(T){const C=r.bF([],g,v,T),M=new r.ac(C[0],C[1],r.c6(C[2],r.aY(C[1]))),D=(M.z+r.ae([M.x-g[0],M.y-g[1],M.z-g[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const u=this._elevation,g=r.c6(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),x=u.getAtPointOrZero(new r.ac(...v)),T=this.pixelsPerMeter/this.worldSize*x,C=this._minimumHeightOverTerrain(),M=v[2]-T;if(M<=C)if(M<0||a){const D=this.locationCoordinate(this._center,this._centerAltitude),O=[v[0],v[1],D.z-v[2]],z=r.ae(O);O[2]-=(C-M)/this._pixelsPerMercatorPixel;const L=r.ae(O);if(L===0)return;r.b$(O,O,z/L*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],D.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const L=this.center;return L.lat=r.aD(L.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(L.lng=r.aD(L.lng,this.minLng,this.maxLng)),this.center=L,void(this._constraining=!1)}const u=this._unmodified,{x:g,y:v}=this.point;let x=0,T=g,C=v;const M=this.width/2,D=this.height/2,O=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(v-D<O&&(C=O+D),v+D>z&&(C=z-D),z-O<this.height&&(x=Math.max(x,this.height/(z-O)),C=(z+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const L=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,Y=this.worldSize/2-(L+V)/2;T=(g+Y+this.worldSize)%this.worldSize-Y,T-M<L&&(T=L+M),T+M>V&&(T=V-M),V-L<this.width&&(x=Math.max(x,this.width/(V-L)),T=(V+L)/2)}T===g&&C===v||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(T,C))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,u=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.c6(1,this.center.lat)/r.c6(1,r.cN));const v=r.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?g:1,T=this._camera.getWorldToCamera(this.worldSize,x);let C;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-a.x/this.width,M[9]=2*a.y/this.height,this.isOrthographic){let Ie=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Re=Ie*this.aspect,Xe=-Re,je=-Ie;Re-=a.x,Xe-=a.x,Ie+=a.y,je+=a.y,C=this._camera.getCameraToClipOrthographic(Xe,Re,je,Ie,this._nearZ,this._farZ),((lt,it,Ct,$e)=>{for(let qe=0;qe<16;qe++)lt[qe]=r.ai(it[qe],Ct[qe],$e)})(C,C,M,r.cO(this.pitch>=ic?1:this.pitch/ic))}else C=M;const D=r.cB([],M,T);let O=r.cB([],C,T);if(this.projection.isReprojectedInTileSpace){const Ie=this.locationCoordinate(this.center),Re=r.bx([]);r.bo(Re,Re,[Ie.x*this.worldSize,Ie.y*this.worldSize,0]),r.az(Re,Re,r.cC(this)),r.bo(Re,Re,[-Ie.x*this.worldSize,-Ie.y*this.worldSize,0]),r.az(O,O,Re),r.az(D,D,Re),this.inverseAdjustmentMatrix=r.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cE([],O,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=O,this.invProjMatrix=r.bi(new Float64Array(16),this.projMatrix),u){const Ie=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ie[8]=2*-a.x/this.width,Ie[9]=2*a.y/this.height,this.expandedFarZProjMatrix=r.cB([],Ie,T)}else this.expandedFarZProjMatrix=this.projMatrix;const z=r.bi([],C);this.frustumCorners=r.cF.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const L=new Float32Array(16);r.bx(L),r.cE(L,L,[1,-1,1]),r.cG(L,L,this._pitch),r.by(L,L,this.angle);const V=r.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bw(V);const Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-a.x/this.width,V[9]=2*(a.y+Y)/this.height,this.skyboxMatrix=r.az(L,V,L);const q=this.point,Q=q.x,Z=q.y,se=this.width%2/2,de=this.height%2/2,me=Math.cos(this.angle),Se=Math.sin(this.angle),ve=Q-Math.round(Q)+me*se+Se*de,xe=Z-Math.round(Z)+me*de+Se*se,ge=new Float64Array(O);if(r.bo(ge,ge,[ve>.5?ve-1:ve,xe>.5?xe-1:xe,0]),this.alignedProjMatrix=ge,O=r.bz(),r.cE(O,O,[this.width/2,-this.height/2,1]),r.bo(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=r.bz(),r.cE(O,O,[1,-1,1]),r.bo(O,O,[-1,-1,0]),r.cE(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=r.az(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},O=r.bi(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cH(this);const Ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ad(Ie,Ie,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[a,a,u];r.b$(x,x,v),r.b$(g,g,-1),r.cI(g,g,x);const T=r.bz();r.bo(T,T,g),r.cE(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,u,v)}_computeCameraPosition(a){const u=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-a/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*x,v.y/this.worldSize-g[1]*x,a/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=a[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((u-g)/v,1)),this._camera.position=r.bF([],this._camera.position,a,x),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=r.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.al(this._maxPitch)),C=Math.max((a[2]-x)/Math.cos(g),T),M=this._zoomFromMercatorZ(C);r.bF(a,a,u,C),this._pitch=r.aD(g,r.al(this.minPitch),r.al(this.maxPitch)),this.angle=r.bX(v,-Math.PI,Math.PI),this._setZoom(r.aD(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ac(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let u=0,g=r.cx,v=0,x=1/0;for(;g-u>1e-6&&g>u;){const T=u+.5*(g-u),C=this.tileSize*Math.pow(2,T),M=this.getCameraToCenterDistance(this.projection,T,C),D=this.scaleZoom(M/(a*this.tileSize)),O=Math.abs(T-D);O<x&&(x=O,v=T),T<D?u=T:g=T}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,u){const g=Math.min(a.x,u.x),v=Math.max(a.x,u.x),x=Math.min(a.y,u.y),T=Math.max(a.y,u.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new r.P(g,x),new r.P(v,T),new r.P(g,T),new r.P(v,x)],M=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const O of C){const z=this.pointRayIntersection(O);if(z.t<0)return!0;const L=this.rayIntersectionCoordinate(z);if(L.x<M||L.y<0||L.x>D||L.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(a,u){const g=r.ae(r.at([],this._camera.position,a)),v=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const a=function([u,g,v],x){const T=[u,g,v,1];r.aA(T,T,x);const C=T[3]=Math.max(T[3],1e-6);return T[0]/=C,T[1]/=C,T[2]/=C,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,a))}}getCameraToCenterDistance(a,u=this.zoom,g=this.worldSize){const v=r.cA(a,u,this.width,this.height,1024),x=a.pixelSpaceConversion(this.center.lat,g,v);let T=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(T=r.ai(1,T,r.cO(this.pitch>=ic?1:this.pitch/ic))),T}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.az(a,a,this.globeMatrix),a}getFrustum(a){return r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}const qc=(m,a)=>{if(a>0&&m.terrain&&r.w("Cutoff is currently disabled on terrain"),a<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=m.transform,g=Math.max(Math.abs(u._zoom-(m.minCutoffZoom-1)),1),v=u.isLODDisabled(!1)?r.af(60,45,u.pitch):r.af(30,15,u.pitch),x=u._farZ-u._nearZ,T=a*u.height,C=((1-(M=v))*u.cameraToCenterDistance+M*(u._farZ+T))*g;var M;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(C-u._nearZ)/x,(C-T-u._nearZ)/x]}}},Hs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class sd{constructor(a,u){this.aabb=a,this.lastCascade=u}}class od{add(a,u){const g=this.receivers[a.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],u.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],u.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],u.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],u.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],u.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],u.max[2])):this.receivers[a.key]=new sd(u,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,u,g){const v=r.cV.fromPoints(a.points);let x=0;for(const T in this.receivers){const C=this.receivers[T];if(!C||!v.intersectsAabb(C.aabb))continue;C.aabb.min=v.closestPoint(C.aabb.min),C.aabb.max=v.closestPoint(C.aabb.max);const M=C.aabb.getCorners();for(let D=0;D<g.length;D++){let O=!0;for(const z of M){const L=[z[0]*u,z[1]*u,z[2]];if(r.ad(L,L,g[D].matrix),L[0]<-1||L[0]>1||L[1]<-1||L[1]>1){O=!1;break}}if(C.lastCascade=D,x=Math.max(x,D),O)break}}return x+1}}class Ow{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new od,this._depthMode=new Wt(a.context.gl.LEQUAL,Wt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,a.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),a.tp.registerParameter(Hs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(Hs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),a.tp.registerParameter(Hs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),a.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,u){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;const v=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((Y,q)=>{const Q=g.style._mergedLayers[q];return Y+(Q.hasShadowPass()&&!Q.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=g.context,T=Hs.shadowMapResolution,C=Hs.shadowMapResolution;if(this._cascades.length===0||Hs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<Hs.cascadeCount;++Y){const q=g._shadowMapDebug,Q=x.gl,Z=x.createFramebuffer(T,C,q,"texture"),se=new r.T(x,{width:T,height:C,data:null},Q.DEPTH_COMPONENT16);if(Z.depthAttachment.set(se.texture),q){const de=new r.T(x,{width:T,height:C,data:null},Q.RGBA8);Z.colorAttachment.set(de.texture)}this._cascades.push({framebuffer:Z,texture:se,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cn,scale:0})}}this.shadowDirection=dg(u);let M=0;if(a.elevation){const Y=a.elevation,q=[1e4,-1e4];Y.visibleDemTiles.filter(Q=>Q.dem).forEach(Q=>{const Z=Q.dem.tree;q[0]=Math.min(q[0],Z.minimums[0]),q[1]=Math.max(q[1],Z.maximums[0])}),q[0]!==1e4&&(M=(q[1]-q[0])*Y.exaggeration())}const D=1.5*a.cameraToCenterDistance,O=3*D,z=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){const q=this._cascades[Y];let Q=a.height/50,Z=1;Hs.cascadeCount===1?Z=O:Y===0?Z=D:(Q=D,Z=O);const[se,de]=fg(a,this.shadowDirection,Q,Z,Hs.shadowMapResolution,M);q.scale=a.scale,q.matrix=se,q.boundingSphereRadius=de,r.bi(z,q.matrix),q.frustum=r.cn.fromInvProjectionMatrix(z,1,0,!0),q.far=Z}const L=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[L].far,this._cascades[L].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Hs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Hs.shadowMapResolution,this._uniformValues.u_shadowmap_0=js.ShadowMap0,this._uniformValues.u_shadowmap_1=js.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const V=g.transform.elevation;for(const Y of this._groundShadowTiles){let q={min:0,max:0};if(V){const Q=V.getMinMaxForTile(Y);Q&&(q=Q)}this.addShadowReceiver(Y.toUnwrapped(),q.min,q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,u){if(!this.enabled)return;const g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,Hs.shadowMapResolution,Hs.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){g.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:r.am.white,depth:1});for(const T of a.order){const C=a._mergedLayers[T];if(!C.hasShadowPass()||C.isHidden(g.transform.zoom))continue;const M=a.getLayerSourceCache(C),D=M?u[M.id]:void 0;(C.type==="model"||D&&D.length)&&g.renderLayer(g,M,C,D)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const a=this.painter,u=a.style,g=a.context,v=u.directionalLight,x=u.ambientLight;if(!v||!x)return;const T=[],C=qc(a,a.longestCutoffRange);C.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const M=Ya(u,v,x),D=new Wt(g.gl.LEQUAL,Wt.ReadOnly,a.depthRangeFor3D);for(const O of this._groundShadowTiles){const z=O.toUnwrapped(),L=a.isTileAffectedByFog(O),V=a.getOrCreateProgram("groundShadow",{defines:T,overrideFog:L});this.setupShadows(z,V),a.uploadCommonUniforms(g,V,z,null,C);const Y={u_matrix:a.transform.calculateProjMatrix(z),u_ground_shadow_factor:M};V.draw(a,g.gl.TRIANGLES,D,di.disabled,Ri.multiply,fi.disabled,Y,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,null,a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ri.unblended:Ri.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){const u=this.painter.transform,g=u.calculatePosMatrix(a,u.worldSize);return r.az(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(a){return r.az(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}setupShadows(a,u,g,v=0){if(!this.enabled)return;const x=this.painter.transform,T=this.painter.context,C=T.gl,M=this._uniformValues,D=new Float64Array(16),O=x.calculatePosMatrix(a,x.worldSize);for(let z=0;z<this._cascades.length;z++)r.az(D,this._cascades[z].matrix,O),M[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),T.activeTexture.set(C.TEXTURE0+js.ShadowMap0+z),this._cascades[z].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){const z=r.cT(a.canonical),L=2/x.tileSize*r.aj/Hs.shadowMapResolution,V=L*this._cascades[0].boundingSphereRadius,Y=L*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(g==="vector-tile"?1:3)/Math.pow(2,v-a.canonical.z-(1-x.zoom+Math.floor(x.zoom)));M.u_shadow_normal_offset=[z,V*q,Y*q],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(T,M)}setupShadowsFromMatrix(a,u,g=!1){if(!this.enabled)return;const v=this.painter.context,x=v.gl,T=this._uniformValues,C=new Float64Array(16);for(let M=0;M<Hs.cascadeCount;M++)r.az(C,this._cascades[M].matrix,a),T[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(x.TEXTURE0+js.ShadowMap0+M),this._cascades[M].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);if(this.useNormalOffset=g,g){const M=Hs.normalOffset;T.u_shadow_normal_offset=[1,M,M],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(v,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,u,g,v){if(v[2]>=0)return{};const x=function(M,D,O){const z=O/(1<<M.canonical.z);return new r.cV([M.canonical.x*z+M.wrap*O,M.canonical.y*z+M.wrap*O,0],[(M.canonical.x+1)*z+M.wrap*O,(M.canonical.y+1)*z+M.wrap*O,D])}(a,u,g).getCorners(),T=u/-v[2];v[0]<0?(r.cU(x[0],x[0],[v[0]*T,0,0]),r.cU(x[3],x[3],[v[0]*T,0,0])):v[0]>0&&(r.cU(x[1],x[1],[v[0]*T,0,0]),r.cU(x[2],x[2],[v[0]*T,0,0])),v[1]<0?(r.cU(x[0],x[0],[0,v[1]*T,0]),r.cU(x[1],x[1],[0,v[1]*T,0])):v[1]>0&&(r.cU(x[2],x[2],[0,v[1]*T,0]),r.cU(x[3],x[3],[0,v[1]*T,0]));const C={};return C.vertices=x,C.planes=[vl(x[1],x[0],x[4]),vl(x[2],x[1],x[5]),vl(x[3],x[2],x[6]),vl(x[0],x[3],x[7])],C}addShadowReceiver(a,u,g){this._receivers.add(a,r.cV.fromTileIdAndHeight(a,u,g))}getMaxCascadeForTile(a){const u=this._receivers.get(a);return u&&u.lastCascade?u.lastCascade:0}}function vl(m,a,u){const g=r.at([],u,a),v=r.at([],m,a),x=r.bG([],g,v),T=r.ae(x);return T===0?[0,0,1,0]:(r.b$(x,x,1/T),[x[0],x[1],x[2],-r.bE(x,a)])}function dg(m){const a=m.properties.get("direction"),u=r.cR(a.x,a.y,a.z);u[2]=r.aD(u[2],0,75);const g=r.cW([u[0],u[1],u[2]]);return r.cS(g.x,g.y,g.z)}function Ya(m,a,u){const g=a.properties.get("color-use-theme")==="none",v=a.properties.get("color"),x=a.properties.get("intensity"),T=a.properties.get("direction"),C=[T.x,T.y,T.z],M=u.properties.get("color-use-theme")==="none",D=u.properties.get("color"),O=u.properties.get("intensity"),z=Math.max(r.bE([0,0,1],C),0),L=[0,0,0];r.b$(L,D.toRenderColor(M?null:m.getLut(a.scope)).toArray01Linear().slice(0,3),O);const V=[0,0,0];return r.b$(V,v.toRenderColor(g?null:m.getLut(u.scope)).toArray01Linear().slice(0,3),z*x),r.cX([L[0]>0?L[0]/(L[0]+V[0]):0,L[1]>0?L[1]/(L[1]+V[1]):0,L[2]>0?L[2]/(L[2]+V[2]):0])}function fg(m,a,u,g,v,x){const T=m.zoom,C=m.scale,M=m.worldSize,D=1/M,O=m.aspect,z=Math.sqrt(1+O*O)*Math.tan(.5*m.fovX),L=z*z,V=g-u,Y=g+u;let q,Q;L>V/Y?(q=g,Q=g*z):(q=.5*Y*(1+L),Q=.5*Math.sqrt(V*V+2*(g*g+u*u)*L+Y*Y*L*L));const Z=m.projection.pixelsPerMeter(m.center.lat,M),se=m._camera.getCameraToWorldMercator(),de=[0,0,-q*D];r.ad(de,de,se);let me=Q*D;const Se=m._edgeInsets;if(!(Se.left===0&&Se.top===0&&Se.right===0&&Se.bottom===0||Se.left===Se.right&&Se.top===Se.bottom)){const gt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?Z:1),ct=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,u,g);ct[8]=2*-m.centerOffset.x/m.width,ct[9]=2*m.centerOffset.y/m.height;const yt=new Float64Array(16);r.cB(yt,ct,gt);const vt=new Float64Array(16);r.bi(vt,yt);const jt=r.cn.fromInvProjectionMatrix(vt,M,T,!0);for(const Jt of jt.points){const Vt=((ve=Jt)[0]/=C,ve[1]/=C,ve[2]=r.c6(ve[2],m._center.lat),ve);me=Math.max(me,r.c0(r.cY([],de,Vt)))}}var ve;me*=v/(v-1);const xe=Math.acos(a[2]),ge=Math.atan2(-a[0],-a[1]),Ie=new Ps;Ie.position=de,Ie.setPitchBearing(xe,ge);const Re=Ie.getWorldToCamera(M,Z),Xe=me*M,je=Math.min(m._mercatorZfromZoom(17)*M*-2,-2*Xe),lt=Ie.getCameraToClipOrthographic(-Xe,Xe,-Xe,Xe,je,(Xe+x*Z)/a[2]),it=new Float64Array(16);r.az(it,lt,Re);const Ct=r.cS(Math.floor(1e6*de[0])/1e6*M,Math.floor(1e6*de[1])/1e6*M,0),$e=.5*v,qe=[0,0,0];r.ad(qe,Ct,it),r.b$(qe,qe,$e);const Ue=[Math.floor(qe[0]),Math.floor(qe[1]),Math.floor(qe[2])],ut=[0,0,0];r.at(ut,qe,Ue),r.b$(ut,ut,-1/$e);const Ze=new Float64Array(16);return r.bx(Ze),r.bo(Ze,Ze,ut),r.az(it,Ze,it),[it,Xe]}class nc extends r.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(a,u){return r.aS(this.requestManager.transformRequest(u,r.R.Model).url).then(g=>{if(!g)return;const v=r.aT(g),x=new r.aU(a,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(g=>{if(g&&g.status===404)return null;this.fire(new r.z(new Error(`Could not load model ${a} from ${u}: ${g.message}`)))})}load(a,u,g={forceReload:!1}){this.models[u]||(this.models[u]={});const v=Object.keys(a),x=[],T=[];for(const C of v){const M=a[C];this.hasURLBeenRequested(M)&&!g.forceReload||(this.modelByURL[M]={modelId:C,scope:u},x.push(this.loadModel(C,M)),T.push(C)),this.models[u][C]||(this.models[u][C]={model:null,numReferences:1})}this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+T.length,Promise.allSettled(x).then(C=>{for(let M=0;M<C.length;M++){const{status:D}=C[M];if(D==="rejected")continue;const{value:O}=C[M];this.models[u][T[M]]||(this.models[u][T[M]]={model:null,numReferences:1}),this.models[u][T[M]].model=O}this.numModelsLoading[u]-=T.length,this.fire(new r.A("data",{dataType:"style"}))}).catch(C=>{this.fire(new r.z(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(const a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,u,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(a,u):this.getModelByURL(this.modelUris[u][a]))}getModel(a,u){return this.models[u]||(this.models[u]={}),this.models[u][a]?this.models[u][a].model:void 0}getModelByURL(a){if(!a)return null;const u=this.modelByURL[a];return u?this.models[u.scope][u.modelId].model:null}hasModelBeenAdded(a,u){return this.models[u]&&this.models[u][a]!==void 0}getModelURIs(a){return this.modelUris[a]||{}}addModel(a,u,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const v=this.requestManager.normalizeModelURL(u);if((this.hasModel(a,g,{exactIdMatch:!0})||this.hasModelBeenAdded(a,g))&&this.modelUris[g][a]===v)this.models[g][a].numReferences++;else if(this.hasURLBeenRequested(v)){const{scope:x,modelId:T}=this.modelByURL[v];this.models[x][T].numReferences++}else this.modelUris[g][a]=v,this.load({[a]:this.modelUris[g][a]},g)}addModelURLs(a,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const g=this.modelUris[u];for(const v in a)g[v]=this.requestManager.normalizeModelURL(a[v])}reloadModels(a){this.load(this.modelUris[a],a,{forceReload:!0})}addModelsFromBucket(a,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const g={};for(const v of a)this.hasModel(v,u,{exactIdMatch:!0})||this.hasURLBeenRequested(v)?this.models[u][v].numReferences++:this.modelUris[u][v]&&!this.hasURLBeenRequested(v)?g[v]=this.modelUris[u][v]:!this.hasURLBeenRequested(v)&&r.cZ(v,!1)&&(this.modelUris[u][v]=this.requestManager.normalizeModelURL(v),g[v]=this.modelUris[u][v]);this.load(g,u)}hasURLBeenRequested(a){return this.modelByURL[a]!==void 0}removeModel(a,u,g=!1){if(this.models[u]&&this.models[u][a]&&(this.models[u][a].numReferences--,this.models[u][a].numReferences===0)){const v=this.modelUris[u][a];g||delete this.modelUris[u][a],delete this.modelByURL[v];const x=this.models[u][a].model;if(!x)return;delete this.models[u][a],x.destroy()}}destroy(){for(const a of Object.keys(this.models))for(const u of Object.keys(this.models[a])){const g=this.models[a][u].model;delete this.models[a][u],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,u){this.models[u]||(this.models[u]={});for(const g in this.models[u])this.models[u][g].model&&this.models[u][g].model.upload(a.context)}}const Fw=new r.a7({data:new r.a8(r.a5.colorTheme.data)}),Lw={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function j0(m){return m=m||{},Object.assign(m,Lw)}class H0 extends r.E{constructor(a){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=a,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(a=>{a.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=a.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=a.stylesheet.indoor.buildingFeaturesetId,this._scope=a.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:a=>(a.feature&&a.feature.properties.floorplan&&this.selectFloorplan(a.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(a){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(T,C){const[M,D]=T,{center:O,radius:z}=C,[L,V]=O,Y=Math.abs(M-L);return Math.sqrt((Y>180?360-Y:Y)**2+(D-V)**2)<=z}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.A("floorplangone")));const u={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},g=new r.P(this._map.transform.width/2,this._map.transform.height/2),v=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(a?v:g,u);x.length>0&&(this._selectedFloorplan&&x[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=x[0],this._floorplanSelected(!1)))}_floorplanSelected(a){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(x){const[[T,C],[M,D]]=x,O=(M-T+360)%360,z=O>180?360-O:O;return{center:[(T+z/2+360)%360,(C+D)/2],radius:Math.sqrt(z**2+(D-C)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const u=this._floorplanStates[this._indoorData.id].selectedBuilding,g=this._floorplanStates[this._indoorData.id].selectedLevel;let v;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const x of this._indoorData.levels)x.id===this._selectedLevel.id&&(v=x.id);if(this.fire(new r.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:v})),u){const x=this._indoorData.buildings.find(T=>T.id===u);this._buildingSelected(x,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(g){const x=this._indoorData.levels.find(T=>T.id===g);this._updateLevels(x,a)}else a&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(a,u){u&&a&&a.extent&&this._map.fitBounds(a.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=a?a.id:void 0;const g=this._indoorData.levels.filter(v=>a.levels.includes(v.id));this.fire(new r.A("buildingselected",{buildingId:a.id,levels:g}))}_levelSelected(a){if(a==="overview")this._updateLevels(void 0,!0);else{const u=this._indoorData.levels.find(g=>g.id===a);this._updateLevels(u,!0)}this.fire(new r.A("levelselected",{levelId:a==="overview"?void 0:a}))}_updateLevels(a,u){if(!a)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(u&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function g(D){const O=D.indexOf("/floor/");if(O===-1)return D;const z=O+7,L=D.indexOf("/",z);return L===-1?D.slice(z):D.slice(z,L)}this._selectedLevel=a,this._floorplanStates[this._indoorData.id].selectedLevel=a?a.id:void 0;const v=[],x={},T={},C={},M={};for(const D of this._indoorData.levels)if(v.push(D.id),x[D.id]=D.height,T[D.id]=D.base,a){if(this.mergeFloors){const O=g(a.id),z=g(D.id);C[D.id]=z===O?"true":"false"}else C[D.id]=D.id===a.id?"true":"false";M[D.id]=D.base<a.base?"true":"false"}else M[D.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",M]),a&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!a.isUnderground),u&&a.extent)){const D=this._map.cameraForBounds(a.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),O=this._map.getZoom(),z=D.zoom?Math.abs(O-D.zoom):0;this._map.fitBounds(a.extent,z>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:O})}}selectFloorplan(a){const u={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},g=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(g,u);if(v.length>0){for(const x of v)if(JSON.parse(x.properties["indoor-data"]).floorplanIDs.includes(a)){this._selectedFloorplan=x,this._floorplanSelected(!0);break}}}selectBuilding(a){const u=this._indoorData.buildings.find(g=>g.id===a);this._buildingSelected(u,!0)}selectLevel(a){this._levelSelected(a)}}function zw(m){if(!m.metadata||!m.metadata.content_area)return;const a=r.q.devicePixelRatio,{left:u,top:g,width:v,height:x}=m.metadata.content_area,T=u*a,C=g*a;return[T,C,T+v*a,C+x*a]}function Yf(m){if(m)return m.map(([a,u])=>[a*r.q.devicePixelRatio,u*r.q.devicePixelRatio])}class W0{constructor(a,u,g){this.id=a,this.scope=u,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(a){this.missingRequests.has(a.name)||this.pendingRequests.has(a.name)||this.pendingRequests.add(a.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const a=new Map;if(!this.sourceCache.loaded())return a;const u=this.sourceCache.getVisibleCoordinates();if(u.length===0)return a;const g=this.sourceCache.getSource();if(!(g instanceof Nc))return a;const v=u.map(T=>this.sourceCache.getTile(T)),x=g.getImages(v,Array.from(this.pendingRequests));for(const[T,C]of x)a.set(r.I.from({name:T,iconsetId:this.id}),C),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),a}}const rc=(m,a)=>De(m,a&&a.filter(u=>u.identifier!=="source.canvas")),G0=r.aF(Ki,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),X0=r.aF(Ki,["setCenter","setZoom","setBearing","setPitch"]),xl=new Set(["background","sky","slot","custom"]),ad={version:8,layers:[],sources:{}},pg={duration:300,delay:0};class Go extends r.E{constructor(a,u={}){super(),this.map=a,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=r.l({},pg),this._buildingIndex=new O0(this),this.crossTileSymbolIndex=new Ur,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new sr,this.dispatcher=u.dispatcher?u.dispatcher:new r.D(r.d0(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new $a(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new r.d1(a._requestManager,u.localFontFamily?r.d2.all:u.localIdeographFontFamily?r.d2.ideographs:r.d2.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new nc(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:u.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",r.d3());const g=this;this._rtlTextPluginCallback=Go.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,T)=>{if(r.d4(x),T&&T.every(C=>C))for(const C in g._sourceCaches){const M=g._sourceCaches[C],D=M.getSource().type;D!=="vector"&&D!=="geojson"||M.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const C=this._layers[T];C.source===x.id&&this._validateLayer(C)}})}load(a){return a?(typeof a=="string"?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if(typeof a=="string"){if(r.f(a))return a;const u=r.d5(a);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${r.d6(JSON.stringify(a))}`}_diffStyle(a,u,g){this.globalId=this._getGlobalId(a);const v=(x,T)=>{try{T(null,this.setState(x,g))}catch(C){T(C,!1)}};if(typeof a=="string"){const x=this.map._requestManager.normalizeStyleURL(a),T=this.map._requestManager.transformRequest(x,r.R.Style);r.n(T,(C,M)=>{C?this.fire(new r.z(C)):M&&v(M,u)})}else typeof a=="object"&&v(a,u)}loadURL(a,u={}){this.fire(new r.A("dataloading",{dataType:"style"}));const g=typeof u.validate=="boolean"?u.validate:!r.f(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,u.accessToken),this.resolvedImports.add(a);const v=this.importsCache.get(a);if(v)return this._load(v,g);const x=this.map._requestManager.transformRequest(a,r.R.Style);this._request=r.n(x,(T,C)=>{if(this._request=null,T)this.fire(new r.z(T));else if(C)return this.importsCache.set(a,C),this._load(C,g)})}loadJSON(a,u={}){this.fire(new r.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=r.q.frame(()=>{this._request=null,this._load(a,u.validate!==!1)})}loadEmpty(){this.fire(new r.A("dataloading",{dataType:"style"})),this._load(ad,!1)}_loadImports(a,u,g){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const x of a){const T=this._createFragmentStyle(x),C=new Promise(O=>{T.once("style.import.load",O),T.once("error",O)}).then(()=>this.mergeAll());if(v.push(C),this.resolvedImports.has(x.url)){T.loadEmpty();continue}const M=x.data||this.importsCache.get(x.url);M?(T.loadJSON(M,{validate:u}),this._isInternalStyle(M)&&(T.globalId=null)):x.url?T.loadURL(x.url,{validate:u}):T.loadEmpty();const D={style:T,id:x.id,config:x.config};if(g){const O=this.fragments.findIndex(({id:z})=>z===g);this.fragments=this.fragments.slice(0,O).concat(D).concat(this.fragments.slice(O))}else this.fragments.push(D)}return Promise.allSettled(v)}getImportGlobalIds(a=this,u=new Set){for(const g of a.fragments)g.style.globalId&&u.add(g.style.globalId),this.getImportGlobalIds(g.style,u);return[...u.values()]}_createFragmentStyle(a){const u=this.scope?r.C(a.id,this.scope):a.id;let g;const v=this._initialConfig&&this._initialConfig[u];(a.config||v)&&(g=r.l({},a.config,v));const x=new Go(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:a["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&a.fragment!==!1)}_load(a,u){const g=a.indoor?j0(a.schema):a.schema;if(this._isInternalStyle(a)){const T=r.l({},ad,{imports:[{id:"basemap",data:a,url:""}]});return void this._load(T,u)}if(this.updateConfig(this._config,g),u&&rc(this,Nr(a)))return;this._loaded=!0,this.stylesheet=r.d7(a);const v=()=>{for(const D in a.sources)this.addSource(D,a.sources[D],{validate:!1,isInitialLoad:!0});if(a.iconsets)for(const D in a.iconsets)this.addIconset(D,a.iconsets[D]);a.sprite?this._loadIconset(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(a.glyphs);const T=Vf(this.stylesheet.layers);if(this._order=T.map(D=>D.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new We(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new We(this.stylesheet.light)),this._layers={};for(const D of T){const O=r.dc(D,this.scope,this._styleColorTheme.lut,this.options);O.configDependencies.size!==0&&this._configDependentLayers.add(O.fqid),O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O;const z=this.getOwnLayerSourceCache(O),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&O.canCastShadows()&&L&&(z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.A("data",{dataType:"style"}));const M=this.isRootStyle();a.imports?this._loadImports(a.imports,u).then(()=>{this._reloadImports(),this.fire(new r.A(M?"style.load":"style.import.load"))}).catch(D=>{this.fire(new r.z(new Error("Failed to load imports",D))),this.fire(new r.A(M?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.A(M?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const T=this._evaluateColorThemeData(x);this._loadColorTheme(T).then(()=>{v()}).catch(C=>{r.w(`Couldn't load color theme from the stylesheet: ${C}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let a,u,g,v,x,T,C,M,D,O;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(L=>{if(L.stylesheet){if(L.light!=null&&(a=L.light),L.stylesheet.lights)for(const V of L.stylesheet.lights)V.type==="ambient"&&L.ambientLight!=null&&(u=L.ambientLight),V.type==="directional"&&L.directionalLight!=null&&(g=L.directionalLight);v=this._prioritizeTerrain(v,L.terrain,L.stylesheet.terrain),L.stylesheet.fog&&L.fog!=null&&(x=L.fog),L.stylesheet.snow&&L.snow!=null&&(T=L.snow),L.stylesheet.rain&&L.rain!=null&&(C=L.rain),L.stylesheet.camera!=null&&(O=L.stylesheet.camera),L.stylesheet.projection!=null&&(M=L.stylesheet.projection),L.stylesheet.transition!=null&&(D=L.stylesheet.transition),z[L.scope]=L._styleColorTheme}}),this.light=a,this.ambientLight=u,this.directionalLight=g,this.fog=x,this.snow=T,this.rain=C,this._styleColorThemeForScope=z,v===null?delete this.terrain:this.terrain=v,this.camera=O||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=r.l({},pg,D),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(a){const u=g=>{for(const v of g.fragments)u(v.style);a(g)};u(this)}_prioritizeTerrain(a,u,g){const v=a&&a.drapeRenderMode===0;return g===null?u&&u.drapeRenderMode===0?u:v?a:null:u!=null&&(!a||v||u&&u.drapeRenderMode===1)?u:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{a=this._prioritizeTerrain(a,u.terrain,u.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(a=u.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){const a={},u={},g={};this.forEachFragmentStyle(v=>{for(const x in v._sourceCaches){const T=r.C(x,v.scope);a[T]=v._sourceCaches[x]}for(const x in v._otherSourceCaches){const T=r.C(x,v.scope);u[T]=v._otherSourceCaches[x]}for(const x in v._symbolSourceCaches){const T=r.C(x,v.scope);g[T]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=g}mergeLayers(){const a={},u=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const T of x._order){const C=x._layers[T];if(C.type==="slot"){const M=r.d8(T);if(a[M])continue;a[M]=[]}C.slot&&a[C.slot]?a[C.slot].push(C):u.push(C)}}),this._mergedOrder=[];const v=(x=[])=>{for(const T of x)if(T.type==="slot"){const C=r.d8(T.id);a[C]&&v(a[C]),this._mergedSlots.push(C)}else{const C=r.C(T.id,T.scope);this._mergedOrder.push(C),g[C]=T,T.is3D(!!this.terrain)&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};v(u),this._mergedOrder.sort((x,T)=>{const C=g[x],M=g[T];return C.hasInitialOcclusionOpacityProperties?M.is3D(!!this.terrain)?1:0:C.is3D(!!this.terrain)&&M.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=r.l({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(a){return a.data?function(u,g,v){const x=r.l({},g);for(const C of Object.keys(r.a5.colorTheme))x[C]===void 0&&(x[C]=r.a5.colorTheme[C].default);const T=new r.a6(Fw,u,new Map(v));return T.setTransitionOrValue(x,v),T.untransitioned().possiblyEvaluate(new r.aa(0))}(this.scope,a,this.options).get("data"):null}_loadColorTheme(a){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,v)=>{const x="data:image/png;base64,";if(!a||a.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let T=a;T.startsWith(x)||(T=x+T);const C=r.I.from("mapbox-reserved-lut"),M=new Image;M.src=T,M.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},M.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void g();this._styleColorTheme.lutLoading=!1;const{width:D,height:O,data:z}=r.q.getImageData(M);if(O>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==O*O)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new r.r({width:D,height:O},z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const L=this.imageManager.getImage(C,this.scope);L?(this._styleColorTheme.lut={image:L.data,data:a},g()):v(new Error("Missing LUT image."))}})}getLut(a){const u=this._styleColorThemeForScope[a];return u?u.lut:null}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(u,g,v){let x,T,C;const M=r.q.devicePixelRatio>1?"@2x":"";let D=r.n(g.transformRequest(g.normalizeSpriteURL(u,M,".json"),r.R.SpriteJSON),(L,V)=>{D=null,C||(C=L,x=V,z())}),O=r.o(g.transformRequest(g.normalizeSpriteURL(u,M,".png"),r.R.SpriteImage),(L,V)=>{O=null,C||(C=L,T=V,z())});function z(){if(C)v(C);else if(x&&T){const L=r.q.getImageData(T),V={};for(const Y in x){const{width:q,height:Q,x:Z,y:se,sdf:de,pixelRatio:me,stretchX:Se,stretchY:ve,content:xe}=x[Y],ge=new r.r({width:q,height:Q});r.r.copy(L,ge,{x:Z,y:se},{x:0,y:0},{width:q,height:Q},null),V[Y]={data:ge,pixelRatio:me,sdf:de,stretchX:Se,stretchY:ve,content:xe,usvg:!1}}v(null,V)}}return{cancel(){D&&(D.cancel(),D=null),O&&(O.cancel(),O=null)}}}(a,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new r.z(u));else if(g){const v=new Map;for(const x in g)v.set(r.I.from(x),g[x]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))})}addIconset(a,u){if(u.type==="sprite")return void this._loadSprite(u.url);const g=this.getOwnSourceCache(u.source);if(!g)return void this.fire(new r.z(new Error(`Source "${u.source}" as specified by iconset "${a}" does not exist and cannot be used as an iconset source`)));const v=g.getSource();if(v.type!=="raster-array")return void this.fire(new r.z(new Error(`Source "${u.source}" as specified by iconset "${a}" is not a "raster-array" source and cannot be used as an iconset source`)));v.partial=!1;const x=new W0(a,this.scope,g);this.imageManager.addImageProvider(x,this.scope)}removeIconset(a){this.imageManager.removeImageProvider(a,this.scope)}_loadIconset(a){if(!r.f(a)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(a);const u=this.map._spriteFormat==="auto";var g,v;this._spriteRequest=(v=(x,T)=>{if(this._spriteRequest=null,x)u?this._loadSprite(a):this.fire(new r.z(x));else if(T){const C=new Map;for(const M in T)C.set(r.I.from(M),T[M]);this.addImages(C)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))},r.br((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(a),r.R.Iconset),(x,T)=>{if(x)return void v(x);const C={},M=r.c_(new r.bq(T));for(const D of M.icons){const O={version:1,pixelRatio:r.q.devicePixelRatio,content:zw(D),stretchX:D.metadata?Yf(D.metadata.stretch_x_areas):void 0,stretchY:D.metadata?Yf(D.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:D};C[D.name]=O}v(null,C)}))}_validateLayer(a){const u=this.getOwnSource(a.source);if(!u)return;const g=a.sourceLayer;g&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(g)===-1)&&this.fire(new r.z(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,u)=>{const g=this.fragments[u];return g&&g.style&&(a.data=g.style.serialize()),a})}_serializeSources(){const a={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();a[g.id]||(a[g.id]=g.serialize())}return a}_serializeLayers(a){const u=[];for(const g of a){const v=this._layers[g];v&&v.type!=="custom"&&u.push(v.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(a){return a?this.order:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){const u=this.getOwnLayer(a);if(u)return u;this.fire(new r.z(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){const u=this.getOwnSource(a);if(u)return u;this.fire(new r.z(new Error(`The source '${a}' does not exist in the map's style.`)))}precompilePrograms(a,u){const g=this.map.painter;if(g)for(let v=a.minzoom||0;v<(a.maxzoom||25.5);v++){const x=a.getProgramIds();if(x)for(const T of x){const C=a.getDefaultProgramParams(T,u.zoom,this._styleColorTheme.lut);C&&(g.style=this,this.fog&&(g._fogVisible=!0,C.overrideFog=!0,g.getOrCreateProgram(T,C)),g._fogVisible=!1,C.overrideFog=!1,g.getOrCreateProgram(T,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,g.getOrCreateProgram(T,C)))}}}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);const u=this.calculateLightsBrightness();a.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u));const g=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const M in C){const{updatedIds:D,removedIds:O}=C[M];(D||O)&&(this._updateWorkerLayers(M,D,O),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this.snow&&this.snow.updateTransitions(a),this.rain&&this.rain.updateTransitions(a),this._changes.reset()}const x={};for(const C in this._mergedSourceCaches){const M=this._mergedSourceCaches[C];x[C]=M.used,M.used=!1,M.tileCoverLift=0}for(const C of this._mergedOrder){const M=this._mergedLayers[C];if(M.recalculate(a,this._availableImages),!M.isHidden(a.zoom)){const D=this.getLayerSourceCache(M);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,a)}):this.precompilePrograms(M,a))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const C of T)C.sourceCache.used=!0;for(const C in x){const M=this._mergedSourceCaches[C];x[C]!==M.used&&M.getSource().fire(new r.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.snow&&this.snow.recalculate(a),this.rain&&this.rain.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new r.A("data",{dataType:"style"}))}updateImageProviders(){const a=this.imageManager.getPendingImageProviders();for(const u of a){const g=u.resolvePendingRequests(),v=this.getFragmentStyle(u.scope);v&&v.addImages(g)}}_updateTilesForChangedImages(){const a={};for(const u in this._mergedSourceCaches){const g=this._mergedSourceCaches[u].getSource().scope;a[g]=a[g]||this._changes.getUpdatedImages(g),a[g].length!==0&&this._mergedSourceCaches[u].reloadTilesForDependencies(["icons","patterns"],a[g])}for(const u in a)this._changes.resetUpdatedImages(u)}_updateWorkerLayers(a,u,g){const v=this.getFragmentStyle(a);v&&this.dispatcher.broadcast("updateLayers",{layers:u?v._serializeLayers(u):[],scope:a,removedIds:g||[],options:v.options})}setState(a,u){if(this._checkLoaded(),rc(this,Nr(a)))return!1;(a=r.d7(a)).layers=Vf(a.layers);const g=function(T,C){if(!T)return[{command:Ki.setStyle,args:[C]}];let M=[];try{if(!r.bv(T.version,C.version))return[{command:Ki.setStyle,args:[C]}];if(r.bv(T.center,C.center)||M.push({command:Ki.setCenter,args:[C.center]}),r.bv(T.zoom,C.zoom)||M.push({command:Ki.setZoom,args:[C.zoom]}),r.bv(T.bearing,C.bearing)||M.push({command:Ki.setBearing,args:[C.bearing]}),r.bv(T.pitch,C.pitch)||M.push({command:Ki.setPitch,args:[C.pitch]}),r.bv(T.sprite,C.sprite)||M.push({command:Ki.setSprite,args:[C.sprite]}),r.bv(T.glyphs,C.glyphs)||M.push({command:Ki.setGlyphs,args:[C.glyphs]}),r.bv(T.imports,C.imports)||function(V=[],Y=[],q){Y=Y||[];const Q=(V=V||[]).map(Kl),Z=Y.map(Kl),se=V.reduce(Bh,{}),de=Y.reduce(Bh,{}),me=Q.slice();let Se,ve,xe,ge;for(Se=0,ve=0;Se<Q.length;Se++)xe=Q[Se],de.hasOwnProperty(xe)?ve++:(q.push({command:Ki.removeImport,args:[xe]}),me.splice(me.indexOf(xe,ve),1));for(Se=0,ve=0;Se<Z.length;Se++)xe=Z[Z.length-1-Se],me[me.length-1-Se]!==xe&&(se.hasOwnProperty(xe)?(q.push({command:Ki.removeImport,args:[xe]}),me.splice(me.lastIndexOf(xe,me.length-ve),1)):ve++,ge=me[me.length-Se],q.push({command:Ki.addImport,args:[de[xe],ge]}),me.splice(me.length-Se,0,xe));for(const Ie of Y){const Re=se[Ie.id];Re&&!r.bv(Re,Ie)&&q.push({command:Ki.updateImport,args:[Ie.id,Ie]})}}(T.imports,C.imports,M),r.bv(T.transition,C.transition)||M.push({command:Ki.setTransition,args:[C.transition]}),r.bv(T.light,C.light)||M.push({command:Ki.setLight,args:[C.light]}),r.bv(T.fog,C.fog)||M.push({command:Ki.setFog,args:[C.fog]}),r.bv(T.snow,C.snow)||M.push({command:Ki.setSnow,args:[C.snow]}),r.bv(T.rain,C.rain)||M.push({command:Ki.setRain,args:[C.rain]}),r.bv(T.projection,C.projection)||M.push({command:Ki.setProjection,args:[C.projection]}),r.bv(T.lights,C.lights)||M.push({command:Ki.setLights,args:[C.lights]}),r.bv(T.camera,C.camera)||M.push({command:Ki.setCamera,args:[C.camera]}),r.bv(T.iconsets,C.iconsets)||function(V,Y,q){let Q;for(Q in Y=Y||{},V=V||{})V.hasOwnProperty(Q)&&(Y.hasOwnProperty(Q)||q.push({command:Ki.removeIconset,args:[Q]}));for(Q in Y){if(!Y.hasOwnProperty(Q))continue;const Z=Y[Q];V.hasOwnProperty(Q)?r.bv(V[Q],Z)||(q.push({command:Ki.removeIconset,args:[Q]}),q.push({command:Ki.addIconset,args:[Q,Z]})):q.push({command:Ki.addIconset,args:[Q,Z]})}}(T.iconsets,C.iconsets,M),!r.bv(T["color-theme"],C["color-theme"]))return[{command:Ki.setStyle,args:[C]}];const D={},O=[];(function(V,Y,q,Q){let Z;for(Z in Y=Y||{},V=V||{})V.hasOwnProperty(Z)&&(Y.hasOwnProperty(Z)||Dh(Z,q,Q));for(Z in Y){if(!Y.hasOwnProperty(Z))continue;const se=Y[Z];V.hasOwnProperty(Z)?r.bv(V[Z],se)||(V[Z].type==="geojson"&&se.type==="geojson"&&F0(V,Y,Z)?q.push({command:Ki.setGeoJSONSourceData,args:[Z,se.data]}):Dw(Z,Y,q,Q)):Ph(Z,Y,q)}})(T.sources,C.sources,O,D);const z=[];T.layers&&T.layers.forEach(V=>{V.source&&D[V.source]?M.push({command:Ki.removeLayer,args:[V.id]}):z.push(V)});let L=T.terrain;L&&D[L.source]&&(M.push({command:Ki.setTerrain,args:[void 0]}),L=void 0),M=M.concat(O),r.bv(L,C.terrain)||M.push({command:Ki.setTerrain,args:[C.terrain]}),function(V,Y,q){Y=Y||[];const Q=(V=V||[]).map(Kl),Z=Y.map(Kl),se=V.reduce(Bh,{}),de=Y.reduce(Bh,{}),me=Q.slice(),Se=Object.create(null);let ve,xe,ge,Ie,Re,Xe,je;for(ve=0,xe=0;ve<Q.length;ve++)ge=Q[ve],de.hasOwnProperty(ge)?xe++:(q.push({command:Ki.removeLayer,args:[ge]}),me.splice(me.indexOf(ge,xe),1));for(ve=0,xe=0;ve<Z.length;ve++)ge=Z[Z.length-1-ve],me[me.length-1-ve]!==ge&&(se.hasOwnProperty(ge)?(q.push({command:Ki.removeLayer,args:[ge]}),me.splice(me.lastIndexOf(ge,me.length-xe),1)):xe++,Xe=me[me.length-ve],q.push({command:Ki.addLayer,args:[de[ge],Xe]}),me.splice(me.length-ve,0,ge),Se[ge]=!0);for(ve=0;ve<Z.length;ve++)if(ge=Z[ve],Ie=se[ge],Re=de[ge],!Se[ge]&&!r.bv(Ie,Re))if(r.bv(Ie.source,Re.source)&&r.bv(Ie["source-layer"],Re["source-layer"])&&r.bv(Ie.type,Re.type)){for(je in Vc(Ie.layout,Re.layout,q,ge,null,Ki.setLayoutProperty),Vc(Ie.paint,Re.paint,q,ge,null,Ki.setPaintProperty),r.bv(Ie.slot,Re.slot)||q.push({command:Ki.setSlot,args:[ge,Re.slot]}),r.bv(Ie.filter,Re.filter)||q.push({command:Ki.setFilter,args:[ge,Re.filter]}),r.bv(Ie.minzoom,Re.minzoom)&&r.bv(Ie.maxzoom,Re.maxzoom)||q.push({command:Ki.setLayerZoomRange,args:[ge,Re.minzoom,Re.maxzoom]}),Ie)Ie.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Vc(Ie[je],Re[je],q,ge,je.slice(6),Ki.setPaintProperty):r.bv(Ie[je],Re[je])||q.push({command:Ki.setLayerProperty,args:[ge,je,Re[je]]}));for(je in Re)Re.hasOwnProperty(je)&&!Ie.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Vc(Ie[je],Re[je],q,ge,je.slice(6),Ki.setPaintProperty):r.bv(Ie[je],Re[je])||q.push({command:Ki.setLayerProperty,args:[ge,je,Re[je]]}))}else q.push({command:Ki.removeLayer,args:[ge]}),Xe=me[me.lastIndexOf(ge)+1],q.push({command:Ki.addLayer,args:[Re,Xe]})}(z,C.layers,M)}catch(D){console.warn("Unable to compute style diff:",D),M=[{command:Ki.setStyle,args:[C]}]}return M}(this.serialize(),a).filter(T=>!(T.command in X0));if(g.length===0)return!1;const v=g.filter(T=>!(T.command in G0));if(v.length>0)throw new Error(`Unimplemented: ${v.map(T=>T.command).join(", ")}.`);const x=[];return g.forEach(T=>{x.push(this[T.command](...T.args))}),u&&Promise.all(x).then(u).catch(u),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(a){for(const[u,g]of a.entries()){if(this.getImage(u))return this.fire(new r.z(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,this.scope,g),this._changes.updateImage(u,this.scope)}return this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this}addImage(a,u){return this.getImage(a)?this.fire(new r.z(new Error(`An image with the name "${a.name}" already exists.`))):(this.imageManager.addImage(a,this.scope,u),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this)}updateImage(a,u,g=!1){this.imageManager.updateImage(a,this.scope,u),g&&(this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})))}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this):this.fire(new r.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(a){return this.modelManager.addModelURLs(a,this.scope),this._updateWorkerModels(),this.fire(new r.A("data",{dataType:"style"})),this}addModel(a,u,g={}){return this._checkLoaded(),this._validate(ye,`models.${a}`,u,null,g)||(this.modelManager.addModel(a,u,this.scope),this.fire(new r.A("data",{dataType:"style"}))),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope),this.fire(new r.A("data",{dataType:"style"})),this):this.fire(new r.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,u,g={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error(`There is already a source with ID "${a}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(zc,`sources.${a}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=Rh(a,u,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const x=T=>{const C=(T?"symbol:":"other:")+v.id,M=r.C(C,this.scope),D=this._sourceCaches[C]=new Ns(M,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=D,D.onAdd(this.map)};x(!1),u.type!=="vector"&&u.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();const u=this.getOwnSource(a);if(!u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===a)return this.fire(new r.z(new Error(`Source "${a}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new r.z(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const v=Object.entries(this.stylesheet.iconsets).find(([x,T])=>T.type==="source"&&T.source===a);if(v)return this.fire(new r.z(new Error(`Source "${a}" cannot be removed while iconset "${v[0]}" is using it.`)))}const g=this.getOwnSourceCaches(a);for(const v of g){const x=r.d8(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new r.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,u){this._checkLoaded(),this.getOwnSource(a).setData(u),this._changes.setDirty()}getOwnSource(a){const u=this.getOwnSourceCache(a);return u&&u.getSource()}getOwnSources(){const a=[];for(const u in this._otherSourceCaches){const g=this.getOwnSourceCache(u);g&&a.push(g.getSource())}return a}areTilesLoaded(){const a=this._mergedSourceCaches;for(const u in a){const g=a[u]._tiles;for(const v in g){const x=g[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const v of a){if(this._validate(ke,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(v),x.updateTransitions(u)}else this.ambientLight=new pr(v,yn||(yn=new r.a7({color:new r.a8(r.a5.properties_light_ambient.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(v),x.updateTransitions(u)}else this.directionalLight=new pr(v,en||(en=new r.a7({direction:new r.an(r.a5.properties_light_directional.direction),color:new r.a8(r.a5.properties_light_directional.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_directional.intensity),"cast-shadows":new r.a8(r.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a8(r.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a8(r.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=new r.aa(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const a=this.directionalLight,u=this.ambientLight;if(!a||!u)return;const g=L=>.2126*(L[0]<=.03928?L[0]/12.92:Math.pow((L[0]+.055)/1.055,2.4))+.7152*(L[1]<=.03928?L[1]/12.92:Math.pow((L[1]+.055)/1.055,2.4))+.0722*(L[2]<=.03928?L[2]/12.92:Math.pow((L[2]+.055)/1.055,2.4)),v=a.properties.get("color").toRenderColor(null).toArray01(),x=a.properties.get("intensity"),T=a.properties.get("direction"),C=1-r.cR(T.x,T.y,T.z)[2]/90,M=g(v)*x*C,D=u.properties.get("color").toRenderColor(null).toArray01(),O=u.properties.get("intensity"),z=g(D)*O;return Number(((M+z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(a==null||a===""&&this.isRootStyle())return this;if(r.d9(a)){const u=r.da(a),g=this.fragments.find(({id:x})=>x===u);if(!g)return;const v=r.d8(a);return g.style.getFragmentStyle(v)}{const u=this.fragments.find(({id:g})=>g===a);return u?u.style:void 0}}setFeaturesetSelectors(a){if(!a)return;const u={},g=(v,x="")=>`${v}::${x}`;this._featuresetSelectors={};for(const v in a){const x=this._featuresetSelectors[v]=[];for(const T of a[v].selectors){if(T.featureNamespace){const M=this.getOwnLayer(T.layer);if(!M){r.w(`Layer is undefined for selector: ${T.layer}`);continue}const D=g(M.source,M.sourceLayer);if(D in u&&u[D]!==T.featureNamespace){r.w(`"featureNamespace ${T.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}u[D]=T.featureNamespace}let C;if(T.properties)for(const M in T.properties){const D=r.X(T.properties[M]);D.result==="success"&&(C=C||{},C[M]=D.value)}x.push({layerId:T.layer,namespace:T.featureNamespace,properties:C,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(a){const u=this.getFragmentStyle(a);if(!u||!u.stylesheet.featuresets)return[];const g=[];for(const v in u.stylesheet.featuresets)g.push({featuresetId:v,importId:u.scope?u.scope:void 0});return g}getFeaturesetLayers(a,u){const g=this.getFragmentStyle(u),v=g.stylesheet.featuresets;if(!v||!v[a])return this.fire(new r.z(new Error(`The featureset '${a}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const T of v[a].selectors){const C=g.getOwnLayer(T.layer);C&&x.push(C)}return x}getConfigProperty(a,u){const g=this.getFragmentStyle(a);if(!g)return null;const v=r.C(u,g.scope),x=g.options.get(v),T=x?x.value||x.default:null;return T?T.serialize():null}setConfigProperty(a,u,g){const v=this.getFragmentStyle(a);if(!v)return;const x=v.stylesheet.indoor?j0(v.stylesheet.schema):v.stylesheet.schema;if(!x||!x[u])return;const T=r.X(g);if(T.result!=="success")return void rc(this,T.value);const C=T.value.expression,M=r.C(u,v.scope),D=v.options.get(M);if(!D)return;let O;const{minValue:z,maxValue:L,stepValue:V,type:Y,values:q}=x[u],Q=r.X(x[u].default);Q.result==="success"&&(O=Q.value.expression),O?(this.options.set(M,Object.assign({},D,{value:C,default:O,minValue:z,maxValue:L,stepValue:V,type:Y,values:q})),this.updateConfigDependencies(u)):this.fire(new r.z(new Error(`No schema defined for the config option "${u}" in the "${a}" fragment.`)))}getConfig(a){const u=this.getFragmentStyle(a);if(!u)return null;const g=u.stylesheet.schema;if(!g)return null;const v={};for(const x in g){const T=r.C(x,u.scope),C=u.options.get(T),M=C?C.value||C.default:null;v[x]=M?M.serialize():null}return v}setConfig(a,u){const g=this.getFragmentStyle(a);g&&(g.updateConfig(u,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){const u=this.getFragmentStyle(a);return u?u.stylesheet.schema:null}setSchema(a,u){const g=this.getFragmentStyle(a);g&&(g.stylesheet.schema=u,g.updateConfig(g._config,u),this.updateConfigDependencies())}updateConfig(a,u){if(this._config=a,a||u)if(u)for(const g in u){let v,x;const T=r.X(u[g].default);if(T.result==="success"&&(v=T.value.expression),a&&a[g]!==void 0){const L=r.X(a[g]);L.result==="success"&&(x=L.value.expression)}const{minValue:C,maxValue:M,stepValue:D,type:O,values:z}=u[g];if(v){const L=r.C(g,this.scope);this.options.set(L,{default:v,value:x,minValue:C,maxValue:M,stepValue:D,type:O,values:z})}else this.fire(new r.z(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new r.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(a){for(const u of this._configDependentLayers){const g=this.getLayer(u);if(g){if(a&&!g.configDependencies.has(a))continue;g.possiblyEvaluateVisibility(),this._updateLayer(g)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(u=>{const g=u._styleColorTheme.colorThemeOverride?u._styleColorTheme.colorThemeOverride:u._styleColorTheme.colorTheme;if(g){const v=u._evaluateColorThemeData(g);(!u._styleColorTheme.lut&&v!==""||u._styleColorTheme.lut&&v!==u._styleColorTheme.lut.data)&&u.setColorTheme(g)}}),this._changes.setDirty()}addLayer(a,u,g={}){this._checkLoaded();const v=a.id;if(this._layers[v])return void this.fire(new r.z(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(a.type==="custom"){if(rc(this,r.db(a)))return;x=r.dc(a,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof a.source=="object"&&(this.addSource(v,a.source),a=r.d7(a),a=r.l(a,{source:v})),this._validate(H,`layers.${v}`,a,{arrayIndex:-1},g))return;x=r.dc(a,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}})}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let T=this._order.length;if(u){const O=this._order.indexOf(u);if(O===-1)return void this.fire(new r.z(new Error(`Layer with id "${u}" does not exist on this map.`)));x.slot===this._layers[u].slot?T=O:r.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,v),this._layerOrderChanged=!0,this._layers[v]=x;const C=this.getOwnLayerSourceCache(x),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&x.canCastShadows()&&M&&(C.castsShadows=!0);const D=this._changes.getRemovedLayer(x);if(D&&x.source&&C&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const O=r.C(x.source,x.scope);D.type!==x.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(a,u){this._checkLoaded();const g=this._checkLayer(a);if(!g||a===u)return;const v=this._order.indexOf(a);this._order.splice(v,1);let x=this._order.length;if(u){const T=this._order.indexOf(u);if(T===-1)return void this.fire(new r.z(new Error(`Layer with id "${u}" does not exist on this map.`)));g.slot===this._layers[u].slot?x=T:r.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();const u=this._checkLayer(a);if(!u)return;u.setEventedParent(null);const g=this._order.indexOf(a);this._order.splice(g,1),delete this._layers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const v=this.getOwnLayerSourceCache(u);if(v&&v.castsShadows){let x=!1;for(const T in this._layers)if(this._layers[T].source===u.source&&this._layers[T].canCastShadows()){x=!0;break}v.castsShadows=x}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(const u in this._layers)if(this._layers[u].type===a)return!0;return!1}setLayerZoomRange(a,u,g){this._checkLoaded();const v=this._checkLayer(a);v&&(v.minzoom===u&&v.maxzoom===g||(u!=null&&(v.minzoom=u),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(a,u){this._checkLoaded();const g=this._checkLayer(a);g&&g.slot!==u&&(g.slot=u,this._updateLayer(g))}setFilter(a,u,g={}){this._checkLoaded();const v=this._checkLayer(a);if(v&&!r.bv(v.filter,u))return u==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(te,`layers.${v.id}.filter`,u,{layerType:v.type},g)||(v.filter=r.d7(u),this._updateLayer(v)))}getFilter(a){const u=this._checkLayer(a);if(u)return r.d7(u.filter)}setLayoutProperty(a,u,g,v={}){this._checkLoaded();const x=this._checkLayer(a);if(x&&!r.bv(x.getLayoutProperty(u),g)){if(g!=null&&(!v||v.validate!==!1)&&rc(x,Ae.call(Nr,{key:`layers.${a}.layout.${u}`,layerType:x.type,objectKey:u,value:g,styleSpec:r.a5,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(u,g),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(a,u){const g=this._checkLayer(a);if(g)return g.getLayoutProperty(u)}setPaintProperty(a,u,g,v={}){this._checkLoaded();const x=this._checkLayer(a);if(!x||r.bv(x.getPaintProperty(u),g)||g!=null&&(!v||v.validate!==!1)&&rc(x,oe.call(Nr,{key:`layers.${a}.paint.${u}`,layerType:x.type,objectKey:u,value:g,styleSpec:r.a5})))return;const T=x.setPaintProperty(u,g);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),T&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(a,u){const g=this._checkLayer(a);if(g)return g.getPaintProperty(u)}setFeatureState(a,u){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:M,importId:D}=a.target,O=this.getFragmentStyle(D),z=O.getFeaturesetLayers(M);for(const{source:L,sourceLayer:V}of z)O.setFeatureState({id:a.id,source:L,sourceLayer:V},u)}else if("layerId"in a.target){const{layerId:M}=a.target,D=this.getLayer(M);this.setFeatureState({id:a.id,source:D.source,sourceLayer:D.sourceLayer},u)}return}const g=a.source,v=a.sourceLayer,x=this._checkSource(g);if(!x)return;const T=x.type;if(T==="geojson"&&v)return void this.fire(new r.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!v)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(g);for(const M of C)M.setFeatureState(v,a.id,u)}removeFeatureState(a,u){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:M,importId:D}=a.target,O=this.getFragmentStyle(D),z=O.getFeaturesetLayers(M);for(const{source:L,sourceLayer:V}of z)O.removeFeatureState({id:a.id,source:L,sourceLayer:V},u)}else if("layerId"in a.target){const{layerId:M}=a.target,D=this.getLayer(M);this.removeFeatureState({id:a.id,source:D.source,sourceLayer:D.sourceLayer},u)}return}const g=a.source,v=this._checkSource(g);if(!v)return;const x=v.type,T=x==="vector"?a.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new r.z(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(g);for(const M of C)M.removeFeatureState(T,a.id,u)}getFeatureState(a){if(this._checkLoaded(),"target"in a){let x;if("featuresetId"in a.target){const{featuresetId:T,importId:C}=a.target,M=this.getFragmentStyle(C),D=M.getFeaturesetLayers(T);for(const{source:O,sourceLayer:z}of D){const L=M.getFeatureState({id:a.id,source:O,sourceLayer:z});if(L&&!x)x=L;else if(!r.bv(x,L))return void this.fire(new r.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in a.target){const{layerId:T}=a.target,C=this.getLayer(T);x=this.getFeatureState({id:a.id,source:C.source,sourceLayer:C.sourceLayer})}return x}const u=a.source,g=a.sourceLayer,v=this._checkSource(u);if(v){if(v.type!=="vector"||g)return a.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(g,a.id);this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=r.l({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const a=this.getTerrain(),u=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return r.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(a){for(const u of Object.values(this._mergedLayers))a(u)&&this._updateLayer(u)}_updateLayer(a){this._changes.updateLayer(a);const u=this.getLayerSourceCache(a),g=r.C(a.source,a.scope),v=this._changes.getUpdatedSourceCaches();a.source&&!v[g]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),u.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const u=C=>this._mergedLayers[C].is3D(!!this.terrain),g=this.order,v={},x=[];for(let C=g.length-1;C>=0;C--){const M=g[C];if(u(M)){v[M]=C;for(const D of a){const O=D[M];if(O)for(const z of O)x.push(z)}}}x.sort((C,M)=>M.intersectionZ-C.intersectionZ);const T=[];for(let C=g.length-1;C>=0;C--){const M=g[C];if(u(M))for(let D=x.length-1;D>=0;D--){const O=x[D].feature;if(O.layer&&v[O.layer.id]<C)break;T.push(O),x.pop()}else for(const D of a){const O=D[M];if(O)for(const z of O)T.push(z.feature)}}return T}queryRenderedFeatures(a,u,g){let v;u&&!Array.isArray(u)&&u.filter&&(this._validate(te,"queryRenderedFeatures.filter",u.filter,null,u),v=r.b3(u.filter));const x={},T=O=>{if(xl.has(O.type))return;const z=this.getOwnLayerSourceCache(O),L=x[z.id]=x[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};O.is3D(!!this.terrain)&&(L.has3DLayers=!0),L.layers[O.fqid]=L.layers[O.fqid]||{styleLayer:O,targets:[]},L.layers[O.fqid].targets.push({filter:v})};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new r.z(new Error("parameters.layers must be an Array."))),[];for(const O of u.layers){const z=this._layers[O];if(!z)return this.fire(new r.z(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];T(z)}}else for(const O in this._layers)T(this._layers[O]);const C=this._queryRenderedFeatures(a,x,g),M=this._flattenAndSortRenderedFeatures(C),D=[];for(const O of M)r.de(O.layer.id)===this.scope&&D.push(O);return D}queryRenderedFeatureset(a,u,g){let v;u&&!Array.isArray(u)&&u.filter&&(this._validate(te,"queryRenderedFeatures.filter",u.filter,null,u),v=r.b3(u.filter));const x="mock",T=[];if(u&&u.target)T.push(Object.assign({},u,{targetId:x,filter:v}));else{const O=this.getFeaturesetDescriptors();for(const z of O)T.push({targetId:x,filter:v,target:z});for(const{style:z}of this.fragments){const L=z.getFeaturesetDescriptors();for(const V of L)T.push({targetId:x,filter:v,target:V})}}const C=this.queryRenderedTargets(a,T,g),M=[],D=new Set;for(const O of C)for(const z of O.variants[x])Xu(z,O,D)||M.push(new r.df(O,z));return M}queryRenderedTargets(a,u,g){const v={},x=(C,M,D,O)=>{const z=v[M.id]=v[M.id]||{sourceCache:M,layers:{},has3DLayers:!1};if(z.layers[C.fqid]=z.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D(!!this.terrain)&&(z.has3DLayers=!0),!O)return D.uniqueFeatureID=!1,void z.layers[C.fqid].targets.push(D);z.layers[C.fqid].targets.push(Object.assign({},D,{namespace:O.namespace,properties:O.properties,uniqueFeatureID:O.uniqueFeatureID}))};for(const C of u)if("featuresetId"in C.target){const{featuresetId:M,importId:D}=C.target,O=this.getFragmentStyle(D);if(!O||!O._featuresetSelectors)continue;const z=O._featuresetSelectors[M];if(!z){this.fire(new r.z(new Error(`The featureset '${M}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const L of z){const V=O.getOwnLayer(L.layerId);V&&!xl.has(V.type)&&x(V,O.getOwnLayerSourceCache(V),C,L)}}else if("layerId"in C.target){const{layerId:M}=C.target,D=this.getLayer(M);if(!D||xl.has(D.type))continue;x(D,this.getLayerSourceCache(D),C)}const T=this._queryRenderedFeatures(a,v,g);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(a,u,g){const v=[],x=!!this.map._showQueryGeometry,T=Pr.createFromScreenPoints(a,g);for(const C in u){const M=Uc(T,u[C],this._availableImages,g,x);Object.keys(M).length&&v.push(M)}if(this.placement)for(const C in u){if(!u[C].sourceCache._onlySymbols)continue;const M=qu(T.screenGeometry,u[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(M).length&&v.push(M)}return v}querySourceFeatures(a,u){const g=u&&u.filter;g&&this._validate(te,"querySourceFeatures.filter",g,null,u);let v=[];const x=this.getOwnSourceCaches(a);for(const T of x)v=v.concat(ig(T,u));return v}addSourceType(a,u,g){return Go.getSourceType(a)?g(new Error(`A source type called "${a}" already exists.`)):(Go.setSourceType(a,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:u.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,u,g={}){this._checkLoaded();const v=this.light.getLight();let x=!1;for(const C in a)if(!r.bv(a[C],v[C])){x=!0;break}if(!x)return;const T=this._getTransitionParameters();this.light.setLight(a,u,g),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(a,u=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),u===0&&delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=a;const v=a.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){const C="terrain-dem-src";this.addSource(C,g.source),g=r.d7(g),g=r.l(g,{source:C})}const x=r.l({},g),T={};if(this.terrain&&v){x.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(T.style=C.serialize())}if(this._validate(ue,"terrain",x,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&u!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,u),this.fire(new r.A("data",{dataType:"style"}))}else{const x=this.terrain,T=x.get();for(const C of Object.keys(r.a5.terrain))!g.hasOwnProperty(C)&&r.a5.terrain[C].default&&(g[C]=r.a5.terrain[C].default);for(const C in a)if(!r.bv(a[C],T[C])){x.set(a,this.options),this.stylesheet.terrain=a;const M=this._getTransitionParameters({duration:0});x.updateTransitions(M),this.fire(new r.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const u=this.fog=new Pi(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_createSnow(a){const u=this.snow=new An(a,this.map.transform,this.scope,this.options);this.stylesheet.snow=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_createRain(a){const u=this.rain=new In(a,this.map.transform,this.scope,this.options);this.stylesheet.rain=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!r.bv(u.get(),a)){u.set(a,this.options),this.stylesheet.fog=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createFog(a);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(a){if(this._checkLoaded(),!a)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const u=this.snow;if(!r.bv(u.get(),a)){u.set(a,this.options),this.stylesheet.snow=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createSnow(a);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(a){if(this._checkLoaded(),!a)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const u=this.rain;if(!r.bv(u.get(),a)){u.set(a,this.options),this.stylesheet.rain=u.get();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createRain(a);this._markersNeedUpdate=!0}_reloadColorTheme(){const a=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},u=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!u)return this._styleColorTheme.lut=null,void a();const g=this._evaluateColorThemeData(u);this._loadColorTheme(g).then(()=>{this.fire(new r.A("colorthemeset")),a()}).catch(v=>{r.w(`Couldn't set color theme: ${v}`)})}setColorTheme(a){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=a,this._reloadColorTheme()}setImportColorTheme(a,u){const g=this.getFragmentStyle(a);g&&(g._styleColorTheme.colorThemeOverride=u,g._reloadColorTheme())}_getTransitionParameters(a){return{now:r.q.now(),transition:r.l(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;const a=[],u=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?a.push(g):u.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...u)}_createTerrain(a,u){const g=this.terrain=new nt(a,u,this.scope,this.options);u===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const a in this._layers){const u=this._layers[a];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const u=this._layers[a];u.type==="symbol"&&this._updateLayer(u)}}_validate(a,u,g,v,x={}){if(x&&x.validate===!1)return!1;const T=r.l({},this.serialize());return rc(this,a.call(Nr,r.l({key:u,style:T,value:g,styleSpec:r.a5},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(a){const u=this.getSourceCaches(a);for(const g of u)g.clearTiles()}clearSources(){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}reloadSource(a){const u=this.getSourceCaches(a);for(const g of u)g.resume(),g.reload()}reloadSources(){for(const a of this.getSources())a.reload&&a.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(a=>{a.modelManager.reloadModels(a.scope)})}updateSources(a){let u;this.directionalLight&&(u=dg(this.directionalLight));const g=new Set;for(const v in this._mergedLayers){const x=this._mergedLayers[v];x.hasElevation()&&!g.has(x.source)&&g.add(x.source)}for(const v in this._mergedSourceCaches){const x=this._mergedSourceCaches[v],T=g.has(x._source.id);x.update(a,void 0,void 0,u,T)}}_generateCollisionBoxes(){for(const a in this._sourceCaches){const u=this._sourceCaches[a];u.resume(),u.reload()}}_updatePlacement(a,u,g,v,x,T,C=!1){let M=!1,D=!1;const O={},z={};for(const L of this._mergedOrder){const V=this._mergedLayers[L];if(V.type!=="symbol")continue;const Y=r.C(V.source,V.scope);let q=O[Y];if(!q){const Z=this.getLayerSourceCache(V);if(!Z)continue;const se=Z.getRenderableIds(!0).map(de=>Z.getTileByID(de));z[Y]=se.slice(),q=O[Y]=se.sort((de,me)=>me.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(me.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(V,q,u.center.lng,u.projection);M=M||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new r.A("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),u.zoom))&&(this.pauseablePlacement=new Vs(u,this._mergedOrder,C,g,v,x,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),D=!0),M&&this.pauseablePlacement.placement.setStale()),D||M){this._buildingIndex.onNewFrame(u.zoom);for(let L=0;L<this._mergedOrder.length;L++){const V=this._mergedLayers[this._mergedOrder[L]];if(V.type!=="symbol")continue;const Y=this.isLayerClipped(V);this.placement.updateLayerOpacities(V,O[r.C(V.source,V.scope)],L,Y?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,u){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:x})=>x===a.id)!==-1)return void this.fire(new r.z(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!u)return g.push(a),this._loadImports([a],!0);const v=g.findIndex(({id:x})=>x===u);return v===-1&&this.fire(new r.z(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(a).concat(g.slice(v)),this._loadImports([a],!0,u)}updateImport(a,u){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(a);return v===-1?this:typeof u=="string"?(this.setImportUrl(a,u),this):(u.url&&u.url!==g[v].url&&this.setImportUrl(a,u.url),r.bv(u.config,g[v].config)||this.setImportConfig(a,u.config,u.data.schema),r.bv(u.data,g[v].data)||this.setImportData(a,u.data),this)}moveImport(a,u){this._checkLoaded();let g=this.stylesheet.imports||[];const v=this.getImportIndex(a);if(v===-1)return this;const x=this.getImportIndex(u);if(x===-1)return this;const T=g[v],C=this.fragments[v];return g=g.filter(({id:M})=>M!==a),this.fragments=this.fragments.filter(({id:M})=>M!==a),this.stylesheet.imports=g.slice(0,x).concat(T).concat(g.slice(x)),this.fragments=this.fragments.slice(0,x).concat(C).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(a,u){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(a);if(v===-1)return this;g[v].url=u;const x=this.fragments[v];return x.style=this._createFragmentStyle(g[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(u),this}setImportData(a,u){this._checkLoaded();const g=this.getImportIndex(a),v=this.stylesheet.imports||[];return g===-1?this:u?(this.fragments[g].style.setState(u),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(a,v[g].url))}setImportConfig(a,u,g){this._checkLoaded();const v=this.getImportIndex(a),x=this.stylesheet.imports||[];if(v===-1)return this;u?x[v].config=u:delete x[v].config;const T=this.fragments[v];g&&T.style.stylesheet&&(T.style.stylesheet.schema=g);const C=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=u,T.style.updateConfig(u,C),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();const u=this.stylesheet.imports||[],g=this.getImportIndex(a);g!==-1&&(u.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(a){const u=(this.stylesheet.imports||[]).findIndex(g=>g.id===a);return u===-1&&this.fire(new r.z(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),u}getLayer(a){return this._mergedLayers[a]}getSources(){const a=[];for(const u in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[u];g&&a.push(g.getSource())}return a}getSource(a,u){const g=this.getSourceCache(a,u);return g&&g.getSource()}getLayerSource(a){const u=this.getLayerSourceCache(a);return u&&u.getSource()}getSourceCache(a,u){const g=r.C(a,u);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(a){const u=r.C(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(a){if(a==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[a]&&u.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&u.push(this._mergedSymbolSourceCaches[a]),u}updateSourceCaches(){const a=this._changes.getUpdatedSourceCaches();for(const u in a){const g=a[u];g==="reload"?this.reloadSource(u):g==="clear"&&this.clearSource(u)}}updateLayers(a){const u=this._changes.getUpdatedPaintProperties();for(const g of u){const v=this.getLayer(g);v&&v.updateTransitions(a)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(a){this.stylesheet.glyphs=a,this.glyphManager.setURL(a,this.scope)}getImages(a,u,g){this.imageManager.getImages(u.images,u.scope,g),this._updateTilesForChangedImages();const v=T=>{if(T){const C=u.images.map(M=>r.I.toString(M));T.setDependencies(u.tileID.key,u.type,C)}},x=r.C(u.source,u.scope);v(this._mergedOtherSourceCaches[x]),v(this._mergedSymbolSourceCaches[x])}rasterizeImages(a,u,g){this.imageManager.rasterizeImages(u,g)}getGlyphs(a,u,g){this.glyphManager.getGlyphs(u.stacks,u.scope,g)}getResource(a,u,g){return r.dh(u,g)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){const u=[];return this._otherSourceCaches[a]&&u.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&u.push(this._symbolSourceCaches[a]),u}_isSourceCacheLoaded(a){const u=this.getOwnSourceCaches(a);return u.length===0?(this.fire(new r.z(new Error(`There is no source with ID '${a}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(a,u){if(!this._clipLayerPresent&&a.type!=="fill-extrusion")return!1;const g=a.type==="fill-extrusion"&&a.sourceLayer==="building";if(a.is3D(!!this.terrain)){if(g||u&&u.type==="batched-model"||a.type==="model")return!0}else if(a.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Go.getSourceType=function(m){return Gu[m]},Go.setSourceType=function(m,a){Gu[m]=a},Go.registerForPluginStateChange=r.c$;var Uh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Vh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,mg=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Zf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Do=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Kf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Dt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,gg=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Jf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Qf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,_g=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Yc=[];jh(Uh,Yc),jh(mg,Yc),jh(Vh,Yc);const Xo={"_prelude_fog.vertex.glsl":Kf,"_prelude_terrain.vertex.glsl":Do,"_prelude_shadow.vertex.glsl":Qf,"_prelude_fog.fragment.glsl":Dt,"_prelude_shadow.fragment.glsl":_g,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":gg,"_prelude_raster_particle.glsl":Jf},$h={};Wi("",Do),Wi(Dt,Kf),Wi(_g,Qf),Wi(gg,""),Wi(Jf,"");const sc=Wi(Vh,mg),ld=Uh;var Zc={background:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=vec4(linearTosRGB(color.rgb),color.a);
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Wi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Wi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Wi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Wi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Wi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Wi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Wi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Wi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Wi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Wi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Wi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Wi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Wi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Wi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Wi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Wi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Wi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Zf),skyboxGradient:Wi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Zf),skyboxCapture:Wi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Wi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Wi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Wi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Wi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Wi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Wi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Wi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function jh(m,a){const u=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of u)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const x of v)a.includes(x)||a.push(x)}}function Wi(m,a){const u=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=a.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(D=>{const O=D.split(" ");return O[O.length-1]}),v=[...new Set(v)]);const x={},T=[],C=[];if(m=m.replace(u,(D,O)=>(C.push(O),"")),(a=a.replace(u,(D,O)=>(T.push(O),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...Yc];jh(m,M),jh(a,M);for(const D of[...T,...C])Xo[D]||console.error(`Undefined include: ${D}`),$h[D]||($h[D]=[],jh(Xo[D],$h[D])),M=[...M,...$h[D]];return{fragmentSource:m=m.replace(g,(D,O,z,L,V)=>(x[V]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${z} ${L} ${V};
#else
uniform ${z} ${L} u_${V};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${z} ${L} ${V} = u_${V};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${z} ${L} ${V};
#endif
`:O==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(g,(D,O,z,L,V)=>{const Y=L==="float"?"vec2":L,q=V.match(/color/)?"color":Y;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${z} ${L} a_${V};
#endif
`:x[V]?O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${z} ${Y} a_${V};
out ${z} ${L} ${V};
#else
uniform ${z} ${L} u_${V};
#endif
`:O==="initialize"?q==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${z} ${L} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${q}(a_${V}, u_${V}_t);
#else
    ${z} ${L} ${V} = u_${V};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${z} ${L} a_${V};
    out ${z} ${L} ${V};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${z} ${Y} a_${V};
#else
uniform ${z} ${L} u_${V};
#endif
`:O==="define-instanced"?q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${z} ${L} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${Y} a_${V};
#else
uniform ${z} ${L} u_${V};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${z} ${L} ${V} = a_${V};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${L} ${V} = a_${V};
#else
    ${z} ${L} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${L} ${V} = unpack_mix_${q}(a_${V}, u_${V}_t);
#else
    ${z} ${L} ${V} = u_${V};
#endif
`}),staticAttributes:v,usedDefines:M,vertexIncludes:T,fragmentIncludes:C}}class yg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,u,g,v,x,T,C,M){this.context=a;let D=this.boundPaintVertexBuffers.length!==v.length;for(let z=0;!D&&z<v.length;z++)this.boundPaintVertexBuffers[z]!==v[z]&&(D=!0);let O=this.boundDynamicVertexBuffers.length!==C.length;for(let z=0;!O&&z<C.length;z++)this.boundDynamicVertexBuffers[z]!==C[z]&&(O=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||D||O||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(u,g,v,x,T,C,M);else{a.bindVertexArrayOES.set(this.vao);for(const z of C)z&&(z.bind(),M&&z.instanceCount&&z.setVertexAttribDivisor(a.gl,u,M));x&&x.dynamicDraw&&x.bind()}}freshBind(a,u,g,v,x,T,C){const M=a.numAttributes,D=this.context,O=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T,u.enableAttributes(O,a),u.bind(),u.setVertexAttribPointers(O,a,x);for(const z of g)z.enableAttributes(O,a),z.bind(),z.setVertexAttribPointers(O,a,x);for(const z of T)z&&(z.enableAttributes(O,a),z.bind(),z.setVertexAttribPointers(O,a,x),C&&z.instanceCount&&z.setVertexAttribDivisor(O,a,C));v&&v.bind(),D.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Nw(m,a){const u=Math.pow(2,a.canonical.z),g=a.canonical.y;return[new r.ac(0,g/u).toLngLat().lat,new r.ac(0,(g+1)/u).toLngLat().lat]}function q0(m,a,u,g,v,x,T){const C=m.context,M=C.gl,D=u.hillshadeFBO;if(!D)return;m.prepareDrawTile();const O=m.isTileAffectedByFog(a),z=m.getOrCreateProgram("hillshade",{overrideFog:O});C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get());const L=((Q,Z,se,de)=>{const me=se.paint.get("hillshade-shadow-color"),Se=se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ve=se.paint.get("hillshade-highlight-color"),xe=se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ge=se.paint.get("hillshade-accent-color"),Ie=se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Re=se.paint.get("hillshade-emissive-strength");let Xe=r.al(se.paint.get("hillshade-illumination-direction"));if(se.paint.get("hillshade-illumination-anchor")==="viewport")Xe-=Q.transform.angle;else if(Q.style&&Q.style.enable3dLights()&&Q.style.directionalLight){const lt=Q.style.directionalLight.properties.get("direction"),it=r.cR(lt.x,lt.y,lt.z);Xe=r.al(it[1])}const je=!Q.options.moving;return{u_matrix:de||Q.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),je),u_image:0,u_latrange:Nw(0,Z.tileID),u_light:[se.paint.get("hillshade-exaggeration"),Xe],u_shadow:me.toRenderColor(Se?null:se.lut),u_highlight:ve.toRenderColor(xe?null:se.lut),u_emissive_strength:Re,u_accent:ge.toRenderColor(Ie?null:se.lut)}})(m,u,g,m.terrain?a.projMatrix:null);m.uploadCommonUniforms(C,z,a.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:Y,tileBoundsSegments:q}=m.getTileBoundsBuffers(u);z.draw(m,M.TRIANGLES,v,x,T,fi.disabled,L,g.id,V,Y,q)}function bg(m,a,u){if(!a.needsDEMTextureUpload)return;const g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(u.stride);const x=u.getPixels();a.demTexture?a.demTexture.update(x,{premultiply:!1}):a.demTexture=new r.T(g,x,v.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function vg(m,a,u){const g=m.context,v=g.gl;if(!a.dem)return;const x=a.dem;if(g.activeTexture.set(v.TEXTURE1),bg(m,a,x),!a.demTexture)return;a.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const T=x.dim;g.activeTexture.set(v.TEXTURE0);let C=a.hillshadeFBO;if(!C){const L=new r.T(g,{width:T,height:T,data:null},v.RGBA8);L.bind(v.LINEAR,v.CLAMP_TO_EDGE),C=a.hillshadeFBO=g.createFramebuffer(T,T,!0,"renderbuffer"),C.colorAttachment.set(L.texture)}g.bindFramebuffer.set(C.framebuffer),g.viewport.set([0,0,T,T]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:D,tileBoundsSegments:O}=m.getMercatorTileBoundsBuffers(),z=[];m.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(m,v.TRIANGLES,Wt.disabled,di.disabled,Ri.unblended,fi.disabled,((L,V)=>{const Y=V.stride,q=r.bz();return r.c5(q,0,r.aj,-r.aj,0,0,1),r.bo(q,q,[0,-r.aj,0]),{u_matrix:q,u_image:1,u_dimension:[Y,Y],u_zoom:L.overscaledZ}})(a.tileID,x),u.id,M,D,O),a.needsHillshadePrepare=!1}class Kn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Uw extends Kn{getDefault(){return r.am.transparent}set(a){const u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Vw extends Kn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class $w extends Kn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Y0 extends Kn{getDefault(){return[!0,!0,!0,!0]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class jw extends Kn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class ep extends Kn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Hw extends Kn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const u=this.current;(a.func!==u.func||a.ref!==u.ref||a.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Z0 extends Kn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class xg extends Kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=a,this.dirty=!1}}class tp extends Kn{getDefault(){return[0,1]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class wg extends Kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=a,this.dirty=!1}}class Kc extends Kn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ag extends Kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.BLEND):u.disable(u.BLEND),this.current=a,this.dirty=!1}}class K0 extends Kn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Hh extends Kn{getDefault(){return r.am.transparent}set(a){const u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class cd extends Kn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class ip extends Kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=a,this.dirty=!1}}class np extends Kn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Wh extends Kn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let rp=class extends Kn{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Tg extends Kn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class J0 extends Kn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Sg extends Kn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class sp extends Kn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class hd extends Kn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Q0 extends Kn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class eb extends Kn{getDefault(){return null}set(a){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class tb extends Kn{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class Gh extends Kn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class ib extends Kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Ww extends Kn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Eg extends Kn{constructor(a,u){super(a),this.context=a,this.parent=u}getDefault(){return null}}class Gw extends Eg{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class op extends Eg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Cg extends Eg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Ig extends op{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Mg=(m,a,u)=>({u_matrix:m,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:u}),Rg=(m,a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:C,u_frustum_br:M,u_frustum_bl:D,u_globe_pos:O,u_globe_radius:z,u_viewport:L,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:Y});function kg(m,a){return m!=null&&a!=null&&!(!m.hasData()||!a.hasData())&&m.demTexture!=null&&a.demTexture!=null&&m.tileID.key!==a.tileID.key}const Xh=new class{constructor(){this.operations={}}newMorphing(m,a,u,g,v){if(m in this.operations){const x=this.operations[m];x.to.tileID.key!==u.tileID.key&&(x.queued=u)}else this.operations[m]={startTime:g,phase:0,duration:v,from:a,to:u,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const a=this.operations[m];return{from:a.from,to:a.to,phase:a.phase}}update(m){for(const a in this.operations){const u=this.operations[a];for(u.phase=(m-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,m)){delete this.operations[a];break}}}_nextOp(m,a){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=a,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},qh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Yh(m,a,u){if(a===0)return 0;const g=a<1&&u===514?.25/a:1;return 6*Math.pow(1.5,22-m)*Math.max(a,1)*g}function nb(m,a){const u=1<<m.z;return!a&&(m.x===0||m.x===u-1)||m.y===0||m.y===u-1}const io=m=>({u_matrix:m});function ud(m,a,u,g,v){if(v>0){const x=r.q.now(),T=(x-m.timeAdded)/v,C=a?(x-a.timeAdded)/v:-1,M=u.getSource(),D=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),O=!a||Math.abs(a.tileID.overscaledZ-D)>Math.abs(m.tileID.overscaledZ-D),z=O&&m.refreshedUponExpiration?1:r.aD(O?T:1-C,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),a?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class ap extends Ns{constructor(a){const u={type:"raster-dem",maxzoom:a.transform.maxZoom},g=new r.D(r.d0(),null),v=Rh("mock-dem",u,g,a.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,u){a.state="loaded",u(null)}}class lp extends Ns{constructor(a){const u=Rh("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new r.D(r.d0(),null),a.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,u,g){if(a.freezeTileCoverage)return;this.transform=a;const v=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const C=new bl(T,this._source.tileSize*T.overscaleFactor(),a.tileZoom);C.state="loaded",this._tiles[T.key]=C}return x},{});for(const x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(a){const u=this.proxyCachedFBO[a];if(u!==void 0){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class cp extends r.aM{constructor(a,u,g){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class hp extends r.dt{constructor(a,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,x]=function(M){const D=new r.ba,O=new r.a_,z=131;D.reserve(17161),O.reserve(33800);const L=r.aj/128,V=r.aj+L/2,Y=V+L;for(let Q=-L;Q<Y;Q+=L)for(let Z=-L;Z<Y;Z+=L){const se=Z<0||Z>V||Q<0||Q>V?24575:0,de=r.aD(Math.round(Z),0,r.aj),me=r.aD(Math.round(Q),0,r.aj);D.emplaceBack(de+se,me)}const q=(Q,Z)=>{const se=Z*z+Q;O.emplaceBack(se+1,se,se+z),O.emplaceBack(se+z,se+z+1,se+1)};for(let Q=1;Q<129;Q++)for(let Z=1;Z<129;Z++)q(Z,Q);return[0,129].forEach(Q=>{for(let Z=0;Z<130;Z++)q(Z,Q),q(Q,Z)}),[D,O,32768]}(),T=a.context;this.gridBuffer=T.createVertexBuffer(g,r.bc.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=r.bd.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=r.bd.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new lp(u.map),this.orthoMatrix=r.bz(),r.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.aj,0,r.aj,0,1);const C=T.gl;this._overlapStencilMode=new di({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ap(u.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,u,g){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);const v=a.terrain.properties,x=a.terrain.drapeRenderMode===0,T=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const C=a.terrain&&a.terrain.scope,M=v.get("source"),D=x?this._mockSourceCache:a.getSourceCache(M,C);if(!D)return void r.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=D,this._attenuationRange=a.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(u):v.get("exaggeration"),!u.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const O=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.getScaledDemTileSize();this.sourceCache.update(u,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),u.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(a){if(this._attenuationRange&&a.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(a.zoom);const u=this._previousCameraAltitude,g=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=g;const v=u!=null?g-u:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const x=a.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(x);let C=x-this._previousZoom;const M=this._previousUpdateTimestamp;let D=x;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(x-D)>.5&&(C=.5*(x-D+C)),C*v<0&&(D+=C)),this._evaluationZoom=D;const O=T.getExaggeration(D),z=O===T.getExaggeration(Math.max(0,D-.1));if(z&&Math.abs(O-this._exaggeration)<.01)return O;let L=Math.min(.1,.00375*(this._updateTimestamp-M));return(z||O<.1||Math.abs(C)<1e-4)&&(L=Math.min(.2,4*L)),r.ai(this._exaggeration,O,L)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(r.ac.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(M=>{const D=u.getTileByID(M).tileID;return D.projMatrix=g.calculateProjMatrix(D.toUnwrapped()),D});(function(M,D){const O=D.transform.pointCoordinate(D.transform.getCameraPoint()),z=new r.P(O.x,O.y);M.sort((L,V)=>{if(V.overscaledZ-L.overscaledZ)return V.overscaledZ-L.overscaledZ;const Y=new r.P(L.canonical.x+(1<<L.canonical.z)*L.wrap,L.canonical.y),q=new r.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Q=z.mult(1<<L.canonical.z);return Q.x-=.5,Q.y-=.5,Q.distSqr(Y)-Q.distSqr(q)})})(v,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},v.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const M in T){const D=T[M];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,a[M],x),D.usedForTerrain))continue;const O=a[M];D.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[u.id]=v.map(M=>new cp(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const D=this.terrainTileForTile[M.key];if(!D)continue;const O=D.tileID.key;O in C||(this._visibleDemTiles.push(D),C[O]=O)}}_assignTerrainTiles(a){this._initializing||a.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const a=this.painter.context,u=a.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(a.activeTexture.set(u.TEXTURE1),bg(this.painter,v,x))}}_prepareDemTileUniforms(a,u,g,v){if(!u||u.demTexture==null)return!1;const x=a.tileID.canonical,T=Math.pow(2,u.tileID.canonical.z-x.z),C=v||"";return g[`u_dem_tl${C}`]=[x.x*T%1,x.y*T%1],g[`u_dem_scale${C}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let a=0;const u=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const x=v.dem.tree.minimums[0];return x>0&&a++,g+x},0);return a?u/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,u=a.gl;a.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new r.du({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(v,{premultiply:!1}):x=this._emptyDEMTexture=new r.T(a,v,u.R32F,{premultiply:!1}),x}setupElevationDraw(a,u,g){const v=this.painter.context,x=v.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let C=null,M=null,D=1;if(g&&g.morphing&&this._useVertexMorphing){const V=g.morphing.srcDemTile,Y=g.morphing.dstDemTile;D=g.morphing.phase,V&&Y&&(this._prepareDemTileUniforms(a,V,T,"_prev")&&(M=V),this._prepareDemTileUniforms(a,Y,T)&&(C=Y))}const O=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let z=null;var L;if(this.enabled?M&&C?(z=C.demTexture,v.activeTexture.set(x.TEXTURE4),M.demTexture.bind(O(M),x.CLAMP_TO_EDGE),T.u_dem_lerp=D):(C=this.terrainTileForTile[a.tileID.key],z=this._prepareDemTileUniforms(a,C,T)?C.demTexture:this.emptyDEMTexture):z=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),z&&(T.u_dem_size=(L=z).size[0]===1?1:L.size[0]-2,z.bind(O(C),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,u,T),g&&g.useMeterToDem&&C){const V=(1<<C.tileID.canonical.z)*r.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=V}if(g&&g.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(v,T),this.painter.transform.projection.name==="globe"){const V=this.globeUniformValues(this.painter.transform,a.tileID.canonical,g&&g.useDenormalizedUpVectorScale);u.setGlobeUniformValues(v,V)}}globeUniformValues(a,u,g){const v=a.projection;return{u_tile_tl_up:v.upVector(u,0,0),u_tile_tr_up:v.upVector(u,r.aj,0),u_tile_br_up:v.upVector(u,r.aj,r.aj),u_tile_bl_up:v.upVector(u,0,r.aj),u_tile_up_scale:g?r.dv(1):v.upVectorScale(u,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const u=this.painter,g=this.painter.context;a.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,T,C,M){if(v.transform.projection.name==="globe")(function(D,O,z,L,V){const Y=D.context,q=Y.gl;let Q,Z;const se=D.transform,de=r.dl(D,Y,se),me=(lt,it)=>{if(Z===it)return;const Ct=[qh[it],"PROJECTION_GLOBE_VIEW"];de&&Ct.push("CUSTOM_ANTIALIASING");const $e=D.isTileAffectedByFog(lt);Q=D.getOrCreateProgram("globeRaster",{defines:Ct,overrideFog:$e}),Z=it},Se=D.colorModeForRenderPass(),ve=new Wt(q.LEQUAL,Wt.ReadWrite,D.depthRangeFor3D);Xh.update(V);const xe=r.dm(se),ge=[r.ay(se.center.lng),r.aH(se.center.lat)],Ie=D.globeSharedBuffers,Re=[se.width*r.q.devicePixelRatio,se.height*r.q.devicePixelRatio],Xe=Float32Array.from(se.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const lt=D.transform,it=Yh(lt.zoom,O.exaggeration(),O.sourceCache._source.tileSize);Z=-1;const Ct=q.TRIANGLES;for(const $e of L){const qe=z.getTile($e),Ue=di.disabled,ut=O.prevTerrainTileForTile[$e.key],Ze=O.terrainTileForTile[$e.key];kg(ut,Ze)&&Xh.newMorphing($e.key,ut,Ze,V,250),Y.activeTexture.set(q.TEXTURE0),qe.texture&&qe.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const gt=Xh.getMorphValuesForProxy($e.key),ct=gt?1:0;gt&&r.L(je,{morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:r.dk(gt.phase)}});const yt=r.dn($e.canonical),vt=r.dp(yt.getCenter().lat),jt=r.dq($e.canonical,yt,vt,lt.worldSize/lt._pixelsPerMercatorPixel),Jt=r.bh(r.dr($e.canonical)),Vt=Rg(lt.expandedFarZProjMatrix,Xe,xe,Jt,r.ah(lt.zoom),ge,lt.frustumCorners.TL,lt.frustumCorners.TR,lt.frustumCorners.BR,lt.frustumCorners.BL,lt.globeCenterInViewSpace,lt.globeRadius,Re,it,lt._farZ,jt);if(me($e,ct),Q&&(O.setupElevationDraw(qe,Q,je),D.uploadCommonUniforms(Y,Q,$e.toUnwrapped()),Ie)){const[Qt,Gt,ai]=Ie.getGridBuffers(vt,it!==0);Q.draw(D,Ct,ve,Ue,Se,fi.backCCW,Vt,"globe_raster",Qt,Gt,ai)}}}if(Ie&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const lt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];de&&lt.push("CUSTOM_ANTIALIASING"),Q=D.getOrCreateProgram("globeRaster",{defines:lt});for(const it of L){const{x:Ct,y:$e,z:qe}=it.canonical,Ue=$e===0,ut=$e===(1<<qe)-1,[Ze,gt,ct,yt]=Ie.getPoleBuffers(qe,!1);if(yt&&(Ue||ut)){const vt=z.getTile(it);Y.activeTexture.set(q.TEXTURE0),vt.texture&&vt.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let jt=r.ds(qe,Ct,se);const Jt=r.bh(r.dr(it.canonical)),Vt=(Qt,Gt)=>Qt.draw(D,q.TRIANGLES,ve,di.disabled,Se,fi.disabled,Rg(se.expandedFarZProjMatrix,jt,jt,Jt,0,ge,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,Re,0,se._farZ),"globe_pole_raster",Gt,ct,yt);O.setupElevationDraw(vt,Q,je),D.uploadCommonUniforms(Y,Q,it.toUnwrapped()),Ue&&D.renderDefaultNorthPole&&Vt(Q,Ze),ut&&D.renderDefaultSouthPole&&(jt=r.cE(r.bz(),jt,[1,-1,1]),Vt(Q,gt))}}}})(v,x,T,C,M);else{const D=v.context,O=D.gl;let z,L;const V=v.shadowRenderer,Y=qc(v,v.longestCutoffRange),q=Se=>{if(L===Se)return;const ve=[];ve.push(qh[Se]),Y.shouldRenderCutoff&&ve.push("RENDER_CUTOFF"),V&&(ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&ve.push("NORMAL_OFFSET")),z=v.getOrCreateProgram("terrainRaster",{defines:ve}),L=Se},Q=v.colorModeForRenderPass(),Z=new Wt(O.LEQUAL,Wt.ReadWrite,v.depthRangeFor3D);Xh.update(M);const se=v.transform,de=Yh(se.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let me=[0,0,0];if(V){const Se=v.style.directionalLight,ve=v.style.ambientLight;Se&&ve&&(me=Ya(v.style,Se,ve))}{L=-1;const Se=O.TRIANGLES,[ve,xe]=[x.gridIndexBuffer,x.gridSegments];for(const ge of C){const Ie=T.getTile(ge),Re=di.disabled,Xe=x.prevTerrainTileForTile[ge.key],je=x.terrainTileForTile[ge.key];kg(Xe,je)&&Xh.newMorphing(ge.key,Xe,je,M,250),D.activeTexture.set(O.TEXTURE0),Ie.texture&&Ie.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const lt=Xh.getMorphValuesForProxy(ge.key),it=lt?1:0;let Ct;lt&&(Ct={morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:r.dk(lt.phase)}});const $e=Mg(ge.projMatrix,nb(ge.canonical,se.renderWorldCopies)?de/10:de,me);if(q(it),!z)continue;x.setupElevationDraw(Ie,z,Ct);const qe=ge.toUnwrapped();V&&V.setupShadows(qe,z),v.uploadCommonUniforms(D,z,qe,null,Y),z.draw(v,Se,Z,Re,Q,fi.backCCW,$e,"terrain_raster",x.gridBuffer,ve,xe)}}}}(u,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),C=u.style.order,M=[];let D=0;for(const O of x){const z=v.getTileByID(O.proxyTileKey),L=v.proxyCachedFBO[O.key]?v.proxyCachedFBO[O.key][a]:void 0,V=L!==void 0?v.renderCache[L]:this.pool[D++],Y=L!==void 0;if(z.texture=V.tex,Y&&!V.dirty){M.push(z.tileID);continue}let q;g.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(g.clear({color:r.am.transparent,stencil:0}),V.dirty=!1);for(let Q=T.start;Q<=T.end;++Q){const Z=u.style._mergedLayers[C[Q]];if(Z.isHidden(u.transform.zoom))continue;const se=u.style.getLayerSourceCache(Z),de=se?this.proxyToSource[O.key][se.id]:[O];if(!de)continue;const me=de;g.viewport.set([0,0,V.fb.width,V.fb.height]),q!==(se?se.id:null)&&(this._setupStencil(V,de,Z,se),q=se?se.id:null),u.renderLayer(u,se,Z,me)}if(this._drapedRenderBatches.length===0)for(const Q of this._pendingGroundEffectLayers){const Z=u.style._mergedLayers[C[Q]];if(Z.isHidden(u.transform.zoom))continue;const se=u.style.getLayerSourceCache(Z),de=se?this.proxyToSource[O.key][se.id]:[O];if(!de)continue;const me=de;g.viewport.set([0,0,V.fb.width,V.fb.height]),q!==(se?se.id:null)&&(this._setupStencil(V,de,Z,se),q=se?se.id:null),u.renderLayer(u,se,Z,me)}this.renderedToTile?(V.dirty=!0,M.push(z.tileID)):Y||--D,D===5&&(D=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),T.end+1}postRender(){}isLayerOrderingCorrect(a){const u=a.order.length;let g=-1,v=u;for(let x=0;x<u;++x)this._style.isLayerDraped(a._mergedLayers[a.order[x]])?g=Math.max(g,x):v=Math.min(v,x);return v>g}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{a=Math.min(a,u.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,u,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const T=x.tileID,C=1<<T.overscaledZ,{x:M,y:D}=T.canonical,O=M/C,z=(M+1)/C,L=D/C,V=(D+1)/C;return{minx:O,miny:L,maxx:z,maxy:V,t:x.dem.tree.raycastRoot(O,L,z,V,a,u,g),tile:x}});v.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const x of v){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,a,u,g);if(T!=null)return T}return null}_createFBO(){const a=this.painter.context,u=a.gl,g=this.drapeBufferSize;a.activeTexture.set(u.TEXTURE0);const v=new r.T(a,{width:g[0],height:g[1],data:null},u.RGBA8);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const x=a.createFramebuffer(g[0],g[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new Ig(a,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const u=this._style._mergedLayers[a],g=u.isHidden(this.painter.transform.zoom);return u.type==="hillshade"||u.type==="custom"?!g&&u.shouldRedrape():!g&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const g of this._style.getSources())if(g instanceof _s){a=!0;break}if(!a)return;const u={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(x&&!u[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof r.ab){u[x.id]=!0;for(const T of this.proxyCoords){const C=this.proxyToSource[T.key][x.id];if(C)for(const M of C)this._clearRenderCacheForTile(x.id,M)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof qa){a=!0;break}if(!a)return;const u={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(!x||u[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const T=v.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const M=this.proxyToSource[C.key][x.id];if(M)for(const D of M){const O=ud(x.getTile(D),x.findLoadedParent(D,0),x,this.painter.transform,T);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(x.id,D)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const a=this._style.order,u=a.length;if(u===0)return;const g=[];this._pendingGroundEffectLayers=[];let v,x=0,T=this._style._mergedLayers[a[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<u;)T=this._style._mergedLayers[a[x]];for(;x<u;++x){const C=this._style._mergedLayers[a[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?v===void 0&&(v=x):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(g.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:x-1}),g.length!==0){const C=g[g.length-1];this._pendingGroundEffectLayers.every(M=>M>C.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(a){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const T=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let C=0;C<T.length;++C){const M=Object.values(T[C]);u.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let T=g.length-1;T>=0;T--){const C=g[T];if(u.getTileByID(C.key),u.proxyCachedFBO[C.key]!==void 0){const M=a[C.key],D=this.proxyToSource[C.key];let O=0;for(const z in D){const L=D[z],V=M[z];if(!V||V.length!==L.length||L.some((Y,q)=>Y!==V[q]||v[z]&&v[z].hasOwnProperty(Y.key))){O=-1;break}++O}for(const z in u.proxyCachedFBO[C.key])u.renderCache[u.proxyCachedFBO[C.key][z]].dirty=O<0||O!==Object.values(M).length}}const x=[...this._drapedRenderBatches];x.sort((T,C)=>C.end-C.start-(T.end-T.start));for(const T of x)for(const C of g){if(u.proxyCachedFBO[C.key])continue;let M=u.renderCachePool.pop();M===void 0&&u.renderCache.length<50&&(M=u.renderCache.length,u.renderCache.push(this._createFBO())),M!==void 0&&(u.proxyCachedFBO[C.key]={},u.proxyCachedFBO[C.key][T.start]=M,u.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(a,u,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let C;if(g.isTileClipped())C=u.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):di.disabled}_renderTileClippingMasks(a,u){const g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(Ri.disabled),v.setDepthMode(Wt.disabled);const T=g.getOrCreateProgram("clippingMask");for(const C of a){const M=g._tileClippingMaskIDs[C.key]=--u;T.draw(g,x.TRIANGLES,Wt.disabled,new di({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),Ri.disabled,fi.disabled,io(C.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(a){const u=this.painter.transform;if(a.x<0||a.x>u.width||a.y<0||a.y>u.height)return null;const g=[a.x,a.y,1,1];r.aA(g,g,u.pixelMatrixInverse),r.cw(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const v=u._camera.position,x=r.c6(1,u.center.lat),T=[v[0],v[1],v[2]/x,0],C=r.cY([],g.slice(0,3),T);r.au(C,C);const M=this.raycast(T,C,this._exaggeration);return M!==null&&M?(r.bF(T,T,C,M),T[3]=T[2],T[2]*=x,T):null}_setupProxiedCoordsForOrtho(a,u,g){if(a.getSource()instanceof r.aP)return this._setupProxiedCoordsForImageSource(a,u,g);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const v=this.proxiedCoords[a.id]=[],x=this.proxyCoords;for(let M=0;M<x.length;M++){const D=x[M],O=this._findTileCoveringTileID(D,a);if(O){const z=this._createProxiedId(D,O,g[D.key]&&g[D.key][a.id]);v.push(z),this.proxyToSource[D.key][a.id]=[z]}}let T=!1;const C=new Set;for(let M=0;M<u.length;M++){const D=a.getTile(u[M]);if(!D||!D.hasData())continue;const O=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==D.tileID.canonical.z){const z=this.proxyToSource[O.tileID.key][a.id],L=this._createProxiedId(O.tileID,D,g[O.tileID.key]&&g[O.tileID.key][a.id]);z?z.splice(z.length-1,0,L):this.proxyToSource[O.tileID.key][a.id]=[L];const V=this.proxyToSource[O.tileID.key][a.id];C.has(V)||C.add(V),v.push(L),T=!0}}if(this._sourceTilesOverlap[a.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const M of C)M.sort((D,O)=>O.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(a,u,g){if(!a.getSource().loaded())return;const v=this.proxiedCoords[a.id]=[],x=this.proxyCoords,T=a.getSource(),C=T.tileID;if(!C)return;const M=new r.P(C.x,C.y)._div(1<<C.z),D=T.coordinates.map(r.ac.fromLngLat).reduce((z,L)=>(z.min.x=Math.min(z.min.x,L.x-M.x),z.min.y=Math.min(z.min.y,L.y-M.y),z.max.x=Math.max(z.max.x,L.x-M.x),z.max.y=Math.max(z.max.y,L.y-M.y),z),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(z,L)=>{const V=z.wrap+z.canonical.x/(1<<z.canonical.z),Y=z.canonical.y/(1<<z.canonical.z),q=r.aj/(1<<z.canonical.z),Q=L.wrap+L.canonical.x/(1<<L.canonical.z),Z=L.canonical.y/(1<<L.canonical.z);return V+q<Q+D.min.x||V>Q+D.max.x||Y+q<Z+D.min.y||Y>Z+D.max.y};for(let z=0;z<x.length;z++){const L=x[z];for(let V=0;V<u.length;V++){const Y=a.getTile(u[V]);if(!Y||!Y.hasData()||O(L,Y.tileID))continue;const q=this._createProxiedId(L,Y,g[L.key]&&g[L.key][a.id]),Q=this.proxyToSource[L.key][a.id];Q?Q.push(q):this.proxyToSource[L.key][a.id]=[q],v.push(q)}}}_createProxiedId(a,u,g){let v=this.orthoMatrix;if(g){const x=g.find(T=>T.key===u.tileID.key);if(x)return x}if(u.tileID.key!==a.key){const x=a.canonical.z-u.tileID.canonical.z;let T,C,M;v=r.bz();const D=u.tileID.wrap-a.wrap<<a.overscaledZ;x>0?(T=r.aj>>x,C=T*((u.tileID.canonical.x<<x)-a.canonical.x+D),M=T*((u.tileID.canonical.y<<x)-a.canonical.y)):(T=r.aj<<-x,C=r.aj*(u.tileID.canonical.x-(a.canonical.x+D<<-x)),M=r.aj*(u.tileID.canonical.y-(a.canonical.y<<-x))),r.c5(v,0,T,0,T,0,1),r.bo(v,v,[C,M,0])}return new cp(u.tileID,a.key,v)}_findTileCoveringTileID(a,u){let g=u.getTile(a);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[u.id],x=v[a.key];if(g=x?u.getTileByID(x):null,g&&g.hasData()||x===null)return g;let T=g?g.tileID:a,C=T.overscaledZ;const M=u.getSource().minzoom,D=[];if(!x){const z=u.getSource().maxzoom;if(a.canonical.z>=z){const L=a.canonical.z-z;u.getSource().reparseOverscaled?(C=Math.max(a.canonical.z+2,u.transform.tileZoom),T=new r.aM(C,a.wrap,z,a.canonical.x>>L,a.canonical.y>>L)):L!==0&&(C=z,T=new r.aM(C,a.wrap,z,a.canonical.x>>L,a.canonical.y>>L))}T.key!==a.key&&(D.push(T.key),g=u.getTile(T))}const O=z=>{D.forEach(L=>{v[L]=z}),D.length=0};for(C-=1;C>=M&&(!g||!g.hasData());C--){g&&O(g.tileID.key);const z=T.calculateScaledKey(C);if(g=u.getTileByID(z),g&&g.hasData())break;const L=v[z];if(L===null)break;L===void 0?D.push(z):g=u.getTileByID(L)}return O(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,u){let g=this._tilesDirty[a];g||(g=this._tilesDirty[a]={}),g[u.key]=!0}}function Pg(m,a,u){const g=function(C,M,D){const O=r.bE(M,C),z=r.bE(D,[.2126,.7152,.0722]),L=(Y,q,Q)=>(1-Q)*Y+Q*q,V=L(1-.3*Math.min(z,1),1,Math.min(O+1,1));return L(.92,1,Math.asin(r.aD(M[2],-1,1))/Math.PI+.5)*V}(m,[0,0,1],a),v=[0,0,0];r.b$(v,u.slice(0,3),g);const x=[0,0,0];r.b$(x,a.slice(0,3),m[2]);const T=[0,0,0];return r.cU(T,v,x),r.cX(T)}const up=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Dg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class dp{static cacheKey(a,u,g,v){let x=`${u}${v?v.cacheKey:""}`;for(const T of g)a.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(a,u,g,v,x,T){const C=a.gl;this.program=C.createProgram(),this.configuration=v,this.name=u,this.fixedDefines=[...T];const M=v?v.getBinderAttributes():[],D=(g.staticAttributes||[]).concat(M);let O=v?v.defines():[];O=O.concat(T.map(Q=>`#define ${Q}`));const z=`#version 300 es
`;let L=z+O.concat("precision mediump float;",ld,sc.fragmentSource).join(`
`);for(const Q of g.fragmentIncludes)L+=`
${Xo[Q]}`;L+=`
${g.fragmentSource}`;let V=z+O.concat("precision highp float;",ld,sc.vertexSource).join(`
`);for(const Q of g.vertexIncludes)V+=`
${Xo[Q]}`;this.forceManualRenderingForInstanceIDShaders=a.forceManualRenderingForInstanceIDShaders&&g.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(V+=`
uniform int u_instanceID;
`),V+=`
${g.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(V=V.replaceAll("gl_InstanceID","u_instanceID"));const Y=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Y,L),C.compileShader(Y),C.attachShader(this.program,Y);const q=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(q,V),C.compileShader(q),C.attachShader(this.program,q),this.attributes={},this.numAttributes=D.length;for(let Q=0;Q<this.numAttributes;Q++)if(D[Q]){const Z=D[Q].startsWith("a_")?D[Q]:`a_${D[Q]}`;C.bindAttribLocation(this.program,Q,Z),this.attributes[Z]=Q}C.linkProgram(this.program),C.deleteShader(q),C.deleteShader(Y),this.fixedUniforms=x(a),this.binderUniforms=v?v.getUniforms(a):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Q=>({u_instanceID:new r.cc(Q)}))(a)),(T.includes("TERRAIN")||u.indexOf("symbol")!==-1||u.indexOf("circle")!==-1)&&(this.terrainUniforms=(Q=>({u_dem:new r.cc(Q),u_dem_prev:new r.cc(Q),u_dem_tl:new r.c9(Q),u_dem_scale:new r.cb(Q),u_dem_tl_prev:new r.c9(Q),u_dem_scale_prev:new r.cb(Q),u_dem_size:new r.cb(Q),u_dem_lerp:new r.cb(Q),u_exaggeration:new r.cb(Q),u_depth:new r.cc(Q),u_depth_size_inv:new r.c9(Q),u_depth_range_unpack:new r.c9(Q),u_occluder_half_size:new r.cb(Q),u_occlusion_depth_offset:new r.cb(Q),u_meter_to_dem:new r.cb(Q),u_label_plane_matrix_inv:new r.c8(Q)}))(a)),T.includes("GLOBE")&&(this.globeUniforms=(Q=>({u_tile_tl_up:new r.ca(Q),u_tile_tr_up:new r.ca(Q),u_tile_br_up:new r.ca(Q),u_tile_bl_up:new r.ca(Q),u_tile_up_scale:new r.cb(Q)}))(a)),T.includes("FOG")&&(this.fogUniforms=(Q=>({u_fog_matrix:new r.c8(Q),u_fog_range:new r.c9(Q),u_fog_color:new r.cQ(Q),u_fog_horizon_blend:new r.cb(Q),u_fog_vertical_limit:new r.c9(Q),u_fog_temporal_offset:new r.cb(Q),u_frustum_tl:new r.ca(Q),u_frustum_tr:new r.ca(Q),u_frustum_br:new r.ca(Q),u_frustum_bl:new r.ca(Q),u_globe_pos:new r.ca(Q),u_globe_radius:new r.cb(Q),u_globe_transition:new r.cb(Q),u_is_globe:new r.cc(Q),u_viewport:new r.c9(Q)}))(a)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Q=>({u_cutoff_params:new r.cQ(Q)}))(a)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Q=>({u_lighting_ambient_color:new r.ca(Q),u_lighting_directional_dir:new r.ca(Q),u_lighting_directional_color:new r.ca(Q),u_ground_radiance:new r.ca(Q)}))(a)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Q=>({u_light_matrix_0:new r.c8(Q),u_light_matrix_1:new r.c8(Q),u_fade_range:new r.c9(Q),u_shadow_normal_offset:new r.ca(Q),u_shadow_intensity:new r.cb(Q),u_shadow_texel_size:new r.cb(Q),u_shadow_map_resolution:new r.cb(Q),u_shadow_direction:new r.ca(Q),u_shadow_bias:new r.ca(Q),u_shadowmap_0:new r.cc(Q),u_shadowmap_1:new r.cc(Q)}))(a))}}setTerrainUniformValues(a,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v]&&g[v].set(this.program,v,u[v])}}setGlobeUniformValues(a,u){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v]&&g[v].set(this.program,v,u[v])}}setFogUniformValues(a,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v].set(this.program,v,u[v])}}setCutoffUniformValues(a,u){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v].set(this.program,v,u[v])}}setLightsUniformValues(a,u){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v].set(this.program,v,u[v])}}setShadowUniformValues(a,u){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;a.program.set(this.program);for(const v in u)g[v].set(this.program,v,u[v])}_drawDebugWireframe(a,u,g,v,x,T,C,M,D,O){const z=a.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;const L=a.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||a._terrain&&a._terrain.renderingToTexture||!up.includes(this.name))||!(!z.layers3D||!Dg.includes(this.name))))return;const V=L.gl,Y=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,x,L);if(!Y)return;const q=[...this.fixedDefines];q.push("DEBUG_WIREFRAME");const Q=a.getOrCreateProgram(this.name,{config:this.configuration,defines:q});L.program.set(Q.program);const Z=(me,Se,ve)=>{if(Se[me]&&ve[me])for(const xe in Se[me])ve[me][xe]&&ve[me][xe].set(ve.program,xe,Se[me][xe].current)};D&&D.setUniforms(Q.program,L,Q.binderUniforms,C,{zoom:M}),Z("fixedUniforms",this,Q),Z("terrainUniforms",this,Q),Z("globeUniforms",this,Q),Z("fogUniforms",this,Q),Z("lightsUniforms",this,Q),Z("shadowUniforms",this,Q),Y.bind(),L.setColorMode(new Ri([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],r.am.transparent,[!0,!0,!0,!1])),L.setDepthMode(new Wt(u.func===V.LESS?V.LEQUAL:u.func,Wt.ReadOnly,u.range)),L.setStencilMode(di.disabled);const se=3*T.primitiveLength*2,de=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const me=O||1;for(let Se=0;Se<me;++Se)Q.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Se),V.drawElements(V.LINES,se,V.UNSIGNED_SHORT,de)}else O&&O>1?V.drawElementsInstanced(V.LINES,se,V.UNSIGNED_SHORT,de,O):V.drawElements(V.LINES,se,V.UNSIGNED_SHORT,de);x.bind(),L.program.set(this.program),L.setDepthMode(u),L.setStencilMode(g),L.setColorMode(v)}checkUniforms(a,u,g){if(this.fixedDefines.includes(u)){for(const v of Object.keys(g))if(!g[v].initialized)throw new Error(`Program '${this.name}', from draw '${a}': uniform ${v} not set but required by ${u} being defined`)}}draw(a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q){const Z=a.context,se=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(g),Z.setStencilMode(v),Z.setColorMode(x),Z.setCullFace(T);for(const Se of Object.keys(this.fixedUniforms))this.fixedUniforms[Se].set(this.program,Se,C[Se]);Y&&Y.setUniforms(this.program,Z,this.binderUniforms,L,{zoom:V});const de={[se.POINTS]:1,[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[u];this.checkUniforms(M,"RENDER_SHADOWS",this.shadowUniforms);const me=Q&&Q>0?1:void 0;for(const Se of z.get()){const ve=Se.vaos||(Se.vaos={});if((ve[M]||(ve[M]=new yg)).bind(Z,this,D,Y?Y.getPaintVertexBuffers():[],O,Se.vertexOffset,q||[],me),this.forceManualRenderingForInstanceIDShaders){const xe=Q||1;for(let ge=0;ge<xe;++ge)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),O?se.drawElements(u,Se.primitiveLength*de,se.UNSIGNED_SHORT,Se.primitiveOffset*de*2):se.drawArrays(u,Se.vertexOffset,Se.vertexLength)}else Q&&Q>1?se.drawElementsInstanced(u,Se.primitiveLength*de,se.UNSIGNED_SHORT,Se.primitiveOffset*de*2,Q):O?se.drawElements(u,Se.primitiveLength*de,se.UNSIGNED_SHORT,Se.primitiveOffset*de*2):se.drawArrays(u,Se.vertexOffset,Se.vertexLength);u===se.TRIANGLES&&O&&this._drawDebugWireframe(a,g,v,x,O,Se,L,V,Y,Q)}}}function dd(m,a,u=0){const g=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,m.transform.tileZoom)/g,x=v*(a.tileID.canonical.x+a.tileID.wrap*g),T=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.aw(a,1,m.transform.tileZoom),u_pixel_coord_upper:[x>>16,T>>16],u_pixel_coord_lower:[65535&x,65535&T],u_pattern_transition:u}}const fd={terrain:0,flat:1},rb=r.bz(),Jc=(m,a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q,Z)=>{const se=a.style.light,de=se.properties.get("position"),me=[de.x,de.y,de.z],Se=r.dx();se.properties.get("anchor")==="viewport"&&(r.dy(Se,-a.transform.angle),r.dz(me,me,Se));const ve=se.properties.get("color"),xe=a.transform,ge={u_matrix:m,u_lightpos:me,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rb,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:fd[D],u_base_type:fd[O],u_ao:v,u_edge_radius:x,u_width_scale:T,u_flood_light_color:Y,u_vertical_scale:q,u_flood_light_intensity:Q,u_ground_shadow_factor:Z};return xe.projection.name==="globe"&&(ge.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],ge.u_zoom_transition=z,ge.u_inv_rot_matrix=V,ge.u_merc_center=L,ge.u_up_dir=xe.projection.upVector(new r.cp(0,0,0),L[0]*r.aj,L[1]*r.aj),ge.u_height_lift=M),ge},Xw=(m,a,u,g,v,x)=>({u_matrix:m,u_edge_radius:a,u_width_scale:u,u_vertical_scale:g,u_height_type:fd[v],u_base_type:fd[x]}),qw=(m,a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q,Z)=>{const se=Jc(m,a,u,g,v,x,T,C,D,O,z,L,V,Y,q,Q,1,[0,0,0]),de={u_height_factor:-Math.pow(2,C.overscaledZ)/M.tileSize/8};return r.l(se,dd(a,M,Z),de)},sb=(m,a,u)=>({u_matrix:m,u_emissive_strength:a,u_ground_shadow_factor:u}),ob=(m,a,u,g,v,x=0)=>r.l(sb(m,a,v),dd(u,g,x)),Yw=(m,a,u,g)=>({u_matrix:m,u_world:u,u_emissive_strength:a,u_ground_shadow_factor:g}),Zw=(m,a,u,g,v,x,T=0)=>r.l(ob(m,a,u,g,x,T),{u_world:v}),Bg=(m,a)=>({u_matrix:m,u_ground_shadow_factor:a}),pd=(m,a,u,g,v)=>({u_matrix:m,u_camera_pos:[a[0],a[1],a[2]],u_depth_bias:u,u_height_scale:g,u_reset_depth:v}),ab=(m,a,u,g)=>{const v=r.aj/u.tileSize;return{u_matrix:m,u_camera_to_center_distance:a.getCameraToCenterDistance(g),u_extrude_scale:[a.pixelsToGLUnits[0]/v,a.pixelsToGLUnits[1]/v]}},Qc=(m,a,u=1)=>({u_matrix:m,u_color:a.toRenderColor(null),u_overlay:0,u_overlay_scale:u}),lb=r.bz(),cb=(m,a,u,g,v,x,T)=>{const C=m.transform,M=C.projection.name==="globe",D=M?r.dA(C.zoom,a.canonical)*C._pixelsPerMercatorPixel:r.aw(u,1,x),O={u_matrix:a.projMatrix,u_extrude_scale:D,u_intensity:T,u_inv_rot_matrix:lb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){O.u_inv_rot_matrix=g,O.u_merc_center=v,O.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],O.u_zoom_transition=r.ah(C.zoom);const z=v[0]*r.aj,L=v[1]*r.aj;O.u_up_dir=C.projection.upVector(new r.cp(0,0,0),z,L)}return O};function Og(m,[a,u,g,v],[x,T]){if(x===T)return[0,0,0,0];const C=255*(m-1)/(m*(T-x));return[a*C,u*C,g*C,v*C]}function fp(m,a,[u,g]){return u===g?0:.5/m+(a-u)*(m-1)/(m*(g-u))}const oc=(m,a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q,Z,se,de,me)=>({u_matrix:m,u_normalize_matrix:a,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:D,u_fade_t:O.mix,u_opacity:O.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:r.dB(z.paint.get("raster-saturation")),u_contrast_factor:r.dC(z.paint.get("raster-contrast")),u_spin_weights:hb(z.paint.get("raster-hue-rotate")),u_perspective_transform:L,u_raster_elevation:V,u_zoom_transition:T,u_merc_center:C,u_cutoff_params:M,u_colorization_mix:Og(r.dD,q,Z),u_colorization_offset:fp(r.dD,Q,Z),u_color_ramp:Y,u_texture_offset:[de/(se+2*de),se/(se+2*de)],u_texture_res:[se+2*de,se+2*de],u_emissive_strength:me});function hb(m){m*=Math.PI/180;const a=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*a-u+1)/3,(Math.sqrt(3)*a-u+1)/3]}const Bo=.05,Fg=(m,a,u,g,v,x,T,C,M,D,O,z)=>({u_matrix:m,u_normalize_matrix:a,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:D,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:T,u_merc_center:C,u_cutoff_params:M}),pp=(m,a,u,g,v,x,T,C,M,D)=>({u_particle_texture:m,u_particle_texture_side_len:a,u_tile_offset:u,u_velocity:g,u_color_ramp:x,u_velocity_res:v,u_max_speed:T,u_uv_offset:C,u_data_scale:[255*M[0],255*M[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Bo,Bo]}),ub=(m,a,u,g,v,x,T,C,M,D)=>({u_particle_texture:m,u_particle_texture_side_len:a,u_velocity:u,u_velocity_res:g,u_max_speed:v,u_speed_factor:x,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*M[0],255*M[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Bo,Bo]}),Lg=r.bz(),mp=(m,a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q,Z,se,de,me,Se,ve)=>{const xe=v.transform,ge={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:xe.getCameraToCenterDistance(se),u_rotate_symbol:+u,u_aspect_ratio:xe.width/xe.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:C,u_is_text:+D,u_elevation_from_sea:M?1:0,u_pitch_with_map:+g,u_texsize:O,u_texsize_icon:z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lg,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Lg,u_up_vector:[0,-1,0],u_color_adj_mat:me,u_icon_transition:Se||0,u_gamma_scale:g?v.transform.getCameraToCenterDistance(se)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:ve||1,u_ground_shadow_factor:de,u_inv_matrix:r.bi(r.bz(),T)};return se.name==="globe"&&(ge.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],ge.u_zoom_transition=Y,ge.u_inv_rot_matrix=Q,ge.u_merc_center=q,ge.u_camera_forward=xe._camera.forward(),ge.u_ecef_origin=r.dE(xe.globeMatrix,V.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(xe.globeMatrix),ge.u_up_vector=Z),ge},gp=(m,a,u,g)=>({u_matrix:m,u_emissive_strength:a,u_opacity:u,u_color:g}),db=(m,a,u,g,v,x,T,C,M)=>r.l(function(D,O,z,L,V,Y){const{width:q,height:Q}=L.imageManager.getPixelSize(O),Z=Math.pow(2,Y.tileID.overscaledZ),se=Y.tileSize*Math.pow(2,L.transform.tileZoom)/Z,de=se*(Y.tileID.canonical.x+Y.tileID.wrap*Z),me=se*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[q,Q],u_pattern_size:z.displaySize,u_pattern_units_to_pixels:V?[L.transform.width,-1*L.transform.height]:[1/r.aw(Y,1,L.transform.tileZoom),1/r.aw(Y,1,L.transform.tileZoom)],u_pixel_coord_upper:[de>>16,me>>16],u_pixel_coord_lower:[65535&de,65535&me]}}(0,x,T,g,C,M),{u_matrix:m,u_emissive_strength:a,u_opacity:u}),_p=new Float32Array(r.bx([])),eh=(m,a,u,g,v,x,T,C,M,D,O,z,L,V=[0,0,0],Y)=>{const q=v.style.light,Q=q.properties.get("position"),Z=[-Q.x,-Q.y,Q.z],se=r.dx();q.properties.get("anchor")==="viewport"&&(r.dy(se,-v.transform.angle),r.dz(Z,Z,se));const de=O.alphaMode==="MASK",me=q.properties.get("color").toRenderColor(null),Se=L.paint.get("model-ambient-occlusion-intensity"),ve=L.paint.get("model-color").constantOr(r.am.white).toRenderColor(null),xe=L.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:a,u_normal_matrix:u,u_node_matrix:g||_p,u_lightpos:Z,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_camera_pos:V,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+de,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:M,u_roughnessFactor:D,u_baseColorTexture:js.BaseColor,u_metallicRoughnessTexture:js.MetallicRoughness,u_normalTexture:js.Normal,u_occlusionTexture:js.Occlusion,u_emissionTexture:js.Emission,u_lutTexture:js.LUT,u_color_mix:[ve.r,ve.g,ve.b,xe],u_aoIntensity:Se,u_emissive_strength:z,u_occlusionTextureTransform:Y||[0,0,0,0]}},fb=(m,a=_p,u=_p)=>({u_matrix:m,u_instance:a,u_node_matrix:u}),Kw={fillExtrusion:m=>({u_matrix:new r.c8(m),u_lightpos:new r.ca(m),u_lightintensity:new r.cb(m),u_lightcolor:new r.ca(m),u_vertical_gradient:new r.cb(m),u_opacity:new r.cb(m),u_edge_radius:new r.cb(m),u_width_scale:new r.cb(m),u_ao:new r.c9(m),u_height_type:new r.cc(m),u_base_type:new r.cc(m),u_tile_id:new r.ca(m),u_zoom_transition:new r.cb(m),u_inv_rot_matrix:new r.c8(m),u_merc_center:new r.c9(m),u_up_dir:new r.ca(m),u_height_lift:new r.cb(m),u_flood_light_color:new r.ca(m),u_vertical_scale:new r.cb(m),u_flood_light_intensity:new r.cb(m),u_ground_shadow_factor:new r.ca(m)}),fillExtrusionDepth:m=>({u_matrix:new r.c8(m),u_edge_radius:new r.cb(m),u_width_scale:new r.cb(m),u_vertical_scale:new r.cb(m),u_height_type:new r.cc(m),u_base_type:new r.cc(m)}),fillExtrusionPattern:m=>({u_matrix:new r.c8(m),u_lightpos:new r.ca(m),u_lightintensity:new r.cb(m),u_lightcolor:new r.ca(m),u_vertical_gradient:new r.cb(m),u_height_factor:new r.cb(m),u_edge_radius:new r.cb(m),u_width_scale:new r.cb(m),u_ao:new r.c9(m),u_height_type:new r.cc(m),u_base_type:new r.cc(m),u_tile_id:new r.ca(m),u_zoom_transition:new r.cb(m),u_inv_rot_matrix:new r.c8(m),u_merc_center:new r.c9(m),u_up_dir:new r.ca(m),u_height_lift:new r.cb(m),u_image:new r.cc(m),u_texsize:new r.c9(m),u_pixel_coord_upper:new r.c9(m),u_pixel_coord_lower:new r.c9(m),u_tile_units_to_pixels:new r.cb(m),u_opacity:new r.cb(m),u_pattern_transition:new r.cb(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new r.c8(m),u_opacity:new r.cb(m),u_ao_pass:new r.cb(m),u_meter_to_tile:new r.cb(m),u_ao:new r.c9(m),u_flood_light_intensity:new r.cb(m),u_flood_light_color:new r.ca(m),u_attenuation:new r.cb(m),u_edge_radius:new r.cb(m),u_fb:new r.cc(m),u_fb_size:new r.cb(m),u_dynamic_offset:new r.cb(m)}),fill:m=>({u_matrix:new r.c8(m),u_emissive_strength:new r.cb(m),u_ground_shadow_factor:new r.ca(m)}),fillPattern:m=>({u_matrix:new r.c8(m),u_emissive_strength:new r.cb(m),u_image:new r.cc(m),u_texsize:new r.c9(m),u_pixel_coord_upper:new r.c9(m),u_pixel_coord_lower:new r.c9(m),u_tile_units_to_pixels:new r.cb(m),u_ground_shadow_factor:new r.ca(m),u_pattern_transition:new r.cb(m)}),fillOutline:m=>({u_matrix:new r.c8(m),u_emissive_strength:new r.cb(m),u_world:new r.c9(m),u_ground_shadow_factor:new r.ca(m)}),fillOutlinePattern:m=>({u_matrix:new r.c8(m),u_emissive_strength:new r.cb(m),u_world:new r.c9(m),u_image:new r.cc(m),u_texsize:new r.c9(m),u_pixel_coord_upper:new r.c9(m),u_pixel_coord_lower:new r.c9(m),u_tile_units_to_pixels:new r.cb(m),u_ground_shadow_factor:new r.ca(m),u_pattern_transition:new r.cb(m)}),building:m=>({u_matrix:new r.c8(m),u_normal_matrix:new r.c8(m),u_opacity:new r.cb(m)}),buildingDepth:m=>({u_matrix:new r.c8(m)}),elevatedStructuresDepth:m=>({u_matrix:new r.c8(m),u_depth_bias:new r.cb(m)}),elevatedStructures:m=>({u_matrix:new r.c8(m),u_ground_shadow_factor:new r.ca(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new r.c8(m),u_camera_pos:new r.ca(m),u_depth_bias:new r.cb(m),u_height_scale:new r.cb(m),u_reset_depth:new r.cb(m)}),circle:r.dF,collisionBox:m=>({u_matrix:new r.c8(m),u_camera_to_center_distance:new r.cb(m),u_extrude_scale:new r.c9(m)}),collisionCircle:m=>({u_matrix:new r.c8(m),u_inv_matrix:new r.c8(m),u_camera_to_center_distance:new r.cb(m),u_viewport_size:new r.c9(m)}),debug:m=>({u_color:new r.di(m),u_matrix:new r.c8(m),u_overlay:new r.cc(m),u_overlay_scale:new r.cb(m)}),clippingMask:m=>({u_matrix:new r.c8(m)}),heatmap:m=>({u_extrude_scale:new r.cb(m),u_intensity:new r.cb(m),u_matrix:new r.c8(m),u_inv_rot_matrix:new r.c8(m),u_merc_center:new r.c9(m),u_tile_id:new r.ca(m),u_zoom_transition:new r.cb(m),u_up_dir:new r.ca(m)}),heatmapTexture:m=>({u_image:new r.cc(m),u_color_ramp:new r.cc(m),u_opacity:new r.cb(m)}),hillshade:m=>({u_matrix:new r.c8(m),u_image:new r.cc(m),u_latrange:new r.c9(m),u_light:new r.c9(m),u_shadow:new r.di(m),u_highlight:new r.di(m),u_emissive_strength:new r.cb(m),u_accent:new r.di(m)}),hillshadePrepare:m=>({u_matrix:new r.c8(m),u_image:new r.cc(m),u_dimension:new r.c9(m),u_zoom:new r.cb(m)}),line:r.dG,linePattern:r.dH,raster:m=>({u_matrix:new r.c8(m),u_normalize_matrix:new r.c8(m),u_globe_matrix:new r.c8(m),u_merc_matrix:new r.c8(m),u_grid_matrix:new r.dj(m),u_tl_parent:new r.c9(m),u_scale_parent:new r.cb(m),u_fade_t:new r.cb(m),u_opacity:new r.cb(m),u_image0:new r.cc(m),u_image1:new r.cc(m),u_brightness_low:new r.cb(m),u_brightness_high:new r.cb(m),u_saturation_factor:new r.cb(m),u_contrast_factor:new r.cb(m),u_spin_weights:new r.ca(m),u_perspective_transform:new r.c9(m),u_raster_elevation:new r.cb(m),u_zoom_transition:new r.cb(m),u_merc_center:new r.c9(m),u_cutoff_params:new r.cQ(m),u_colorization_mix:new r.cQ(m),u_colorization_offset:new r.cb(m),u_color_ramp:new r.cc(m),u_texture_offset:new r.c9(m),u_texture_res:new r.c9(m),u_emissive_strength:new r.cb(m)}),rasterParticle:m=>({u_matrix:new r.c8(m),u_normalize_matrix:new r.c8(m),u_globe_matrix:new r.c8(m),u_merc_matrix:new r.c8(m),u_grid_matrix:new r.dj(m),u_tl_parent:new r.c9(m),u_scale_parent:new r.cb(m),u_fade_t:new r.cb(m),u_opacity:new r.cb(m),u_image0:new r.cc(m),u_image1:new r.cc(m),u_raster_elevation:new r.cb(m),u_zoom_transition:new r.cb(m),u_merc_center:new r.c9(m),u_cutoff_params:new r.cQ(m)}),rasterParticleTexture:m=>({u_texture:new r.cc(m),u_opacity:new r.cb(m)}),rasterParticleDraw:m=>({u_particle_texture:new r.cc(m),u_particle_texture_side_len:new r.cb(m),u_tile_offset:new r.c9(m),u_velocity:new r.cc(m),u_color_ramp:new r.cc(m),u_velocity_res:new r.c9(m),u_max_speed:new r.cb(m),u_uv_offset:new r.c9(m),u_data_scale:new r.c9(m),u_data_offset:new r.cb(m),u_particle_pos_scale:new r.cb(m),u_particle_pos_offset:new r.c9(m)}),rasterParticleUpdate:m=>({u_particle_texture:new r.cc(m),u_particle_texture_side_len:new r.cb(m),u_velocity:new r.cc(m),u_velocity_res:new r.c9(m),u_max_speed:new r.cb(m),u_speed_factor:new r.cb(m),u_reset_rate:new r.cb(m),u_rand_seed:new r.cb(m),u_uv_offset:new r.c9(m),u_data_scale:new r.c9(m),u_data_offset:new r.cb(m),u_particle_pos_scale:new r.cb(m),u_particle_pos_offset:new r.c9(m)}),symbol:m=>({u_is_size_zoom_constant:new r.cc(m),u_is_size_feature_constant:new r.cc(m),u_size_t:new r.cb(m),u_size:new r.cb(m),u_camera_to_center_distance:new r.cb(m),u_rotate_symbol:new r.cc(m),u_aspect_ratio:new r.cb(m),u_fade_change:new r.cb(m),u_matrix:new r.c8(m),u_label_plane_matrix:new r.c8(m),u_coord_matrix:new r.c8(m),u_is_text:new r.cc(m),u_elevation_from_sea:new r.cc(m),u_pitch_with_map:new r.cc(m),u_texsize:new r.c9(m),u_texsize_icon:new r.c9(m),u_texture:new r.cc(m),u_texture_icon:new r.cc(m),u_gamma_scale:new r.cb(m),u_device_pixel_ratio:new r.cb(m),u_tile_id:new r.ca(m),u_zoom_transition:new r.cb(m),u_inv_rot_matrix:new r.c8(m),u_merc_center:new r.c9(m),u_camera_forward:new r.ca(m),u_tile_matrix:new r.c8(m),u_up_vector:new r.ca(m),u_ecef_origin:new r.ca(m),u_is_halo:new r.cc(m),u_icon_transition:new r.cb(m),u_color_adj_mat:new r.c8(m),u_scale_factor:new r.cb(m),u_ground_shadow_factor:new r.ca(m),u_inv_matrix:new r.c8(m)}),background:m=>({u_matrix:new r.c8(m),u_emissive_strength:new r.cb(m),u_opacity:new r.cb(m),u_color:new r.di(m)}),backgroundPattern:m=>({u_matrix:new r.c8(m),u_emissive_strength:new r.cb(m),u_opacity:new r.cb(m),u_image:new r.cc(m),u_pattern_tl:new r.c9(m),u_pattern_br:new r.c9(m),u_texsize:new r.c9(m),u_pattern_size:new r.c9(m),u_pixel_coord_upper:new r.c9(m),u_pixel_coord_lower:new r.c9(m),u_pattern_units_to_pixels:new r.c9(m)}),terrainRaster:m=>({u_matrix:new r.c8(m),u_image0:new r.cc(m),u_skirt_height:new r.cb(m),u_ground_shadow_factor:new r.ca(m)}),skybox:m=>({u_matrix:new r.c8(m),u_sun_direction:new r.ca(m),u_cubemap:new r.cc(m),u_opacity:new r.cb(m),u_temporal_offset:new r.cb(m)}),skyboxGradient:m=>({u_matrix:new r.c8(m),u_color_ramp:new r.cc(m),u_center_direction:new r.ca(m),u_radius:new r.cb(m),u_opacity:new r.cb(m),u_temporal_offset:new r.cb(m)}),skyboxCapture:m=>({u_matrix_3f:new r.dj(m),u_sun_direction:new r.ca(m),u_sun_intensity:new r.cb(m),u_color_tint_r:new r.cQ(m),u_color_tint_m:new r.cQ(m),u_luminance:new r.cb(m)}),globeRaster:m=>({u_proj_matrix:new r.c8(m),u_globe_matrix:new r.c8(m),u_normalize_matrix:new r.c8(m),u_merc_matrix:new r.c8(m),u_zoom_transition:new r.cb(m),u_merc_center:new r.c9(m),u_image0:new r.cc(m),u_grid_matrix:new r.dj(m),u_skirt_height:new r.cb(m),u_far_z_cutoff:new r.cb(m),u_frustum_tl:new r.ca(m),u_frustum_tr:new r.ca(m),u_frustum_br:new r.ca(m),u_frustum_bl:new r.ca(m),u_globe_pos:new r.ca(m),u_globe_radius:new r.cb(m),u_viewport:new r.c9(m)}),globeAtmosphere:m=>({u_frustum_tl:new r.ca(m),u_frustum_tr:new r.ca(m),u_frustum_br:new r.ca(m),u_frustum_bl:new r.ca(m),u_horizon:new r.cb(m),u_transition:new r.cb(m),u_fadeout_range:new r.cb(m),u_color:new r.cQ(m),u_high_color:new r.cQ(m),u_space_color:new r.cQ(m),u_temporal_offset:new r.cb(m),u_horizon_angle:new r.cb(m)}),model:m=>({u_matrix:new r.c8(m),u_lighting_matrix:new r.c8(m),u_normal_matrix:new r.c8(m),u_node_matrix:new r.c8(m),u_lightpos:new r.ca(m),u_lightintensity:new r.cb(m),u_lightcolor:new r.ca(m),u_camera_pos:new r.ca(m),u_opacity:new r.cb(m),u_baseColorFactor:new r.cQ(m),u_emissiveFactor:new r.cQ(m),u_metallicFactor:new r.cb(m),u_roughnessFactor:new r.cb(m),u_baseTextureIsAlpha:new r.cc(m),u_alphaMask:new r.cc(m),u_alphaCutoff:new r.cb(m),u_baseColorTexture:new r.cc(m),u_metallicRoughnessTexture:new r.cc(m),u_normalTexture:new r.cc(m),u_occlusionTexture:new r.cc(m),u_emissionTexture:new r.cc(m),u_lutTexture:new r.cc(m),u_color_mix:new r.cQ(m),u_aoIntensity:new r.cb(m),u_emissive_strength:new r.cb(m),u_occlusionTextureTransform:new r.cQ(m)}),modelDepth:m=>({u_matrix:new r.c8(m),u_instance:new r.c8(m),u_node_matrix:new r.c8(m)}),groundShadow:m=>({u_matrix:new r.c8(m),u_ground_shadow_factor:new r.ca(m)}),stars:m=>({u_matrix:new r.c8(m),u_up:new r.ca(m),u_right:new r.ca(m),u_intensity_multiplier:new r.cb(m)}),snowParticle:m=>({u_modelview:new r.c8(m),u_projection:new r.c8(m),u_time:new r.cb(m),u_cam_pos:new r.ca(m),u_velocityConeAperture:new r.cb(m),u_velocity:new r.cb(m),u_horizontalOscillationRadius:new r.cb(m),u_horizontalOscillationRate:new r.cb(m),u_boxSize:new r.cb(m),u_billboardSize:new r.cb(m),u_simpleShapeParameters:new r.c9(m),u_screenSize:new r.c9(m),u_thinningCenterPos:new r.c9(m),u_thinningShape:new r.ca(m),u_thinningAffectedRatio:new r.cb(m),u_thinningParticleOffset:new r.cb(m),u_particleColor:new r.cQ(m),u_direction:new r.ca(m)}),rainParticle:m=>({u_modelview:new r.c8(m),u_projection:new r.c8(m),u_time:new r.cb(m),u_cam_pos:new r.ca(m),u_texScreen:new r.cc(m),u_velocityConeAperture:new r.cb(m),u_velocity:new r.cb(m),u_boxSize:new r.cb(m),u_rainDropletSize:new r.c9(m),u_distortionStrength:new r.cb(m),u_rainDirection:new r.ca(m),u_color:new r.cQ(m),u_screenSize:new r.c9(m),u_thinningCenterPos:new r.c9(m),u_thinningShape:new r.ca(m),u_thinningAffectedRatio:new r.cb(m),u_thinningParticleOffset:new r.cb(m),u_shapeDirectionalPower:new r.cb(m),u_shapeNormalPower:new r.cb(m),u_mode:new r.cb(m)}),vignette:m=>({u_vignetteShape:new r.ca(m),u_vignetteColor:new r.cQ(m)}),occlusion:m=>({u_matrix:new r.c8(m),u_anchorPos:new r.ca(m),u_screenSizePx:new r.c9(m),u_occluderSizePx:new r.c9(m),u_color:new r.cQ(m)})};class wl{constructor(a,u,g,v){this.id=wl.uniqueIdxCounter,wl.uniqueIdxCounter++,this.context=a;const x=a.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||v||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=wl.uniqueIdxCounter,wl.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}wl.uniqueIdxCounter=0;const Jw={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zg{constructor(a,u,g,v,x,T){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.instanceCount=T,this.context=a;const C=a.gl;this.buffer=C.createBuffer(),a.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||x||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,u){for(let g=0;g<this.attributes.length;g++){const v=u.attributes[this.attributes[g].name];v!==void 0&&a.enableVertexAttribArray(v)}}setVertexAttribPointers(a,u,g){for(let v=0;v<this.attributes.length;v++){const x=this.attributes[v],T=u.attributes[x.name];T!==void 0&&a.vertexAttribPointer(T,x.components,a[Jw[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(a,u,g){for(let v=0;v<this.attributes.length;v++){const x=u.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(x,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yp{constructor(a,u,g,v,x){this.context=a,this.width=u,this.height=g;const T=this.framebuffer=a.gl.createFramebuffer();v&&(this.colorAttachment=new Gw(a,T)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new op(a,T):new Cg(a,T))}destroy(){const a=this.context.gl;if(this.colorAttachment){const u=this.colorAttachment.get();u&&a.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&a.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&a.deleteTexture(u)}a.deleteFramebuffer(this.framebuffer)}}class Zh{constructor(a,u){this.gl=a,this.clearColor=new Uw(this),this.clearDepth=new Vw(this),this.clearStencil=new $w(this),this.colorMask=new Y0(this),this.depthMask=new jw(this),this.stencilMask=new ep(this),this.stencilFunc=new Hw(this),this.stencilOp=new Z0(this),this.stencilTest=new xg(this),this.depthRange=new tp(this),this.depthTest=new wg(this),this.depthFunc=new Kc(this),this.blend=new Ag(this),this.blendFunc=new K0(this),this.blendColor=new Hh(this),this.blendEquation=new cd(this),this.cullFace=new ip(this),this.cullFaceSide=new np(this),this.frontFace=new Wh(this),this.program=new rp(this),this.activeTexture=new Tg(this),this.viewport=new J0(this),this.bindFramebuffer=new Sg(this),this.bindRenderbuffer=new sp(this),this.bindTexture=new hd(this),this.bindVertexBuffer=new Q0(this),this.bindElementBuffer=new eb(this),this.bindVertexArrayOES=new tb(this),this.pixelStoreUnpack=new Gh(this),this.pixelStoreUnpackPremultiplyAlpha=new ib(this),this.pixelStoreUnpackFlipY=new Ww(this),this.options=u?Object.assign({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=u&&!!u.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,u,g){return new wl(this,a,u,g)}createVertexBuffer(a,u,g,v,x){return new zg(this,a,u,g,v,x)}createRenderbuffer(a,u,g){const v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,a,u,g),this.bindRenderbuffer.set(null),x}createFramebuffer(a,u,g,v){return new yp(this,a,u,g,v)}clear({color:a,depth:u,stencil:g,colorMask:v}){const x=this.gl;let T=0;a&&(T|=x.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set(v||[!0,!0,!0,!0])),u!==void 0&&(T|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),g!==void 0&&(T|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(T)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){r.bv(a.blendFunction,Ri.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let th;function Kh(m,a,u,g,v,x,T){const C=m.context,M=C.gl,D=m.transform,O=m.getOrCreateProgram("collisionBox"),z=[];let L=0,V=0;for(let me=0;me<g.length;me++){const Se=g[me],ve=a.getTile(Se),xe=ve.getBucket(u);if(!xe)continue;const ge=Gf(Se,xe,D);let Ie=ge;v[0]===0&&v[1]===0||(Ie=m.translatePosMatrix(ge,ve,v,x));const Re=T?xe.textCollisionBox:xe.iconCollisionBox,Xe=xe.collisionCircleArray;if(Xe.length>0){const je=r.bz(),lt=Ie;r.cB(je,xe.placementInvProjMatrix,D.glCoordMatrix),r.cB(je,je,xe.placementViewportMatrix),z.push({circleArray:Xe,circleOffset:V,transform:lt,invTransform:je,projection:xe.getProjection()}),L+=Xe.length/4,V=L}Re&&(m.terrain&&m.terrain.setupElevationDraw(ve,O),O.draw(m,M.LINES,Wt.disabled,di.disabled,m.colorModeForRenderPass(),fi.disabled,ab(Ie,D,ve,xe.getProjection()),u.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,D.zoom,null,[Re.collisionVertexBuffer,Re.collisionVertexBufferExt]))}if(!T||!z.length)return;const Y=m.getOrCreateProgram("collisionCircle"),q=new r.dI;q.resize(4*L),q._trim();let Q=0;for(const me of z)for(let Se=0;Se<me.circleArray.length/4;Se++){const ve=4*Se,xe=me.circleArray[ve+0],ge=me.circleArray[ve+1],Ie=me.circleArray[ve+2],Re=me.circleArray[ve+3];q.emplace(Q++,xe,ge,Ie,Re,0),q.emplace(Q++,xe,ge,Ie,Re,1),q.emplace(Q++,xe,ge,Ie,Re,2),q.emplace(Q++,xe,ge,Ie,Re,3)}(!th||th.length<2*L)&&(th=function(me){const Se=2*me,ve=new r.a_;ve.resize(Se),ve._trim();for(let xe=0;xe<Se;xe++){const ge=6*xe;ve.uint16[ge+0]=4*xe+0,ve.uint16[ge+1]=4*xe+1,ve.uint16[ge+2]=4*xe+2,ve.uint16[ge+3]=4*xe+2,ve.uint16[ge+4]=4*xe+3,ve.uint16[ge+5]=4*xe+0}return ve}(L));const Z=C.createIndexBuffer(th,!0),se=C.createVertexBuffer(q,r.dJ.members,!0);for(const me of z){const Se={u_matrix:me.transform,u_inv_matrix:me.invTransform,u_camera_to_center_distance:(de=D).getCameraToCenterDistance(me.projection),u_viewport_size:[de.width,de.height]};Y.draw(m,M.TRIANGLES,Wt.disabled,di.disabled,m.colorModeForRenderPass(),fi.disabled,Se,u.id,se,Z,r.bd.simpleSegment(0,2*me.circleOffset,me.circleArray.length,me.circleArray.length/2),null,D.zoom)}var de;se.destroy(),Z.destroy()}const md=r.bz();function gd(m){const a=m._camera.getWorldToCamera(m.worldSize,1),u=r.az([],a,m.globeMatrix);r.bi(u,u);const g=[0,0,0],v=[0,1,0,0];return r.aA(v,v,u),g[0]=v[0],g[1]=v[1],g[2]=v[2],r.au(g,g),g}function bp({width:m,height:a,anchor:u,textOffset:g,textScale:v},x){const{horizontalAlign:T,verticalAlign:C}=r.bV(u),M=-(T-.5)*m,D=-(C-.5)*a,O=r.bU(u,g);return new r.P((M/v+O[0])*x,(D/v+O[1])*x)}function Ng(m,a,u,g,v,x,T,C,M,D){const O=m.text.placedSymbolArray,z=m.text.dynamicLayoutVertexArray,L=m.icon.dynamicLayoutVertexArray,V={},Y=m.getProjection(),q=ed(T,Y,v),Q=v.elevation,Z=Y.upVectorScale(T.canonical,v.center.lat,v.worldSize).metersToTile;z.clear();for(let se=0;se<O.length;se++){const de=O.get(se),{tileAnchorX:me,tileAnchorY:Se,numGlyphs:ve}=de,xe=de.hidden||!de.crossTileID||m.allowVerticalPlacement&&!de.placedOrientation?null:g[de.crossTileID];if(xe){let ge=0,Ie=0,Re=0;if(Q){const ut=Q?Q.getAtTileOffset(T,me,Se):0,[Ze,gt,ct]=Y.upVector(T.canonical,me,Se);ge=ut*Ze*Z,Ie=ut*gt*Z,Re=ut*ct*Z}let[Xe,je,lt,it]=yo(de.projectedAnchorX+ge,de.projectedAnchorY+Ie,de.projectedAnchorZ+Re,u?q:x);const Ct=Jl(v.getCameraToCenterDistance(Y),it);let $e=r.bJ(m.textSizeData,M,de)*Ct/r.bO;u&&($e*=m.tilePixelRatio/C);const qe=bp(xe,$e);u?({x:Xe,y:je,z:lt}=Y.projectTilePoint(me+qe.x,Se+qe.y,T.canonical),[Xe,je,lt]=yo(Xe+ge,je+Ie,lt+Re,x)):(a&&qe._rotate(-v.angle),Xe+=qe.x,je+=qe.y,lt=0);const Ue=m.allowVerticalPlacement&&de.placedOrientation===r.bI.vertical?Math.PI/2:0;for(let ut=0;ut<ve;ut++)r.bL(z,Xe,je,lt,Ue);D&&de.associatedIconIndex>=0&&(V[de.associatedIconIndex]={x:Xe,y:je,z:lt,angle:Ue})}else rn(ve,z)}if(D){L.clear();const se=m.icon.placedSymbolArray;for(let de=0;de<se.length;de++){const me=se.get(de),{numGlyphs:Se}=me,ve=V[de];if(me.hidden||!ve)rn(Se,L);else{const{x:xe,y:ge,z:Ie,angle:Re}=ve;for(let Xe=0;Xe<Se;Xe++)r.bL(L,xe,ge,Ie,Re)}}m.icon.dynamicLayoutVertexBuffer.updateData(L)}m.text.dynamicLayoutVertexBuffer.updateData(z)}function vp(m,a,u,g,v,x,T={}){const C=u.paint.get("icon-translate"),M=u.paint.get("text-translate"),D=u.paint.get("icon-translate-anchor"),O=u.paint.get("text-translate-anchor"),z=u.layout.get("icon-rotation-alignment"),L=u.layout.get("text-rotation-alignment"),V=u.layout.get("icon-pitch-alignment"),Y=u.layout.get("text-pitch-alignment"),q=u.layout.get("icon-keep-upright"),Q=u.layout.get("text-keep-upright"),Z=u.paint.get("icon-color-saturation"),se=u.paint.get("icon-color-contrast"),de=u.paint.get("icon-color-brightness-min"),me=u.paint.get("icon-color-brightness-max"),Se=u.layout.get("symbol-elevation-reference")==="sea",ve=m.context,xe=ve.gl,ge=m.transform,Ie=z==="map",Re=L==="map",Xe=V==="map",je=Y==="map",lt=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let it=!1;const Ct=m.depthModeForSublayer(0,Wt.ReadOnly),$e=new Wt(m.context.gl.LEQUAL,Wt.ReadOnly,m.depthRangeFor3D),qe=[r.ay(ge.center.lng),r.aH(ge.center.lat)],Ue=u.layout.get("text-variable-anchor"),ut=ge.projection.name==="globe",Ze=[],gt=[0,-1,0];for(const ct of g){const yt=a.getTile(ct),vt=yt.getBucket(u);if(!vt||vt.projection.name==="mercator"&&ut||vt.fullyClipped)continue;const jt=vt.projection.name==="globe",Jt=jt?r.ah(ge.zoom):0,Vt=ed(ct,vt.getProjection(),ge),Qt=ge.calculatePixelsToTileUnitsMatrix(yt),Gt=Ue&&vt.hasTextData(),ai=vt.hasIconTextFit()&&Gt&&vt.hasIconData(),mi=vt.elevationType==="road"?$e:Ct,Oi=vt.getProjection().createInversionMatrix(ge,ct.canonical),mn=m.shadowRenderer,un=vt.elevationType==="road"&&!!mn&&mn.enabled;let zi=[0,0,0];if(un){const Vn=m.style.directionalLight,Ei=m.style.ambientLight;Vn&&Ei&&(zi=Ya(m.style,Vn,Ei))}const tr=Vn=>{ge.depthOcclusionForSymbolsAndCircles&&(u.hasInitialOcclusionOpacityProperties||m.terrain)&&(Vn.push("DEPTH_D24"),Vn.push("DEPTH_OCCLUSION"))},Wn=()=>{const Vn=Ie&&u.layout.get("symbol-placement")!=="point",Ei=[];tr(Ei);const Fn=Vn||ai,Yi=u.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&Xe&&Ei.push("PITCH_WITH_MAP_TERRAIN"),jt&&(Ei.push("PROJECTION_GLOBE_VIEW"),Fn&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),Yi>0&&Ei.push("ICON_TRANSITION"),vt.icon.zOffsetVertexBuffer&&Ei.push("Z_OFFSET"),Z===0&&se===0&&de===0&&me===1||Ei.push("COLOR_ADJUSTMENT"),vt.sdfIcons&&Ei.push("RENDER_SDF"),un&&Ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ln=vt.icon.programConfigurations.get(u.id),sn=m.getOrCreateProgram("symbol",{config:Ln,defines:Ei}),$n=yt.imageAtlasTexture?yt.imageAtlasTexture.size:[0,0],Yr=vt.iconSizeData,Mn=r.bH(Yr,ge.zoom),Qr=Xe||ge.pitch!==0,xr=Oh(Vt,yt.tileID.canonical,Xe,Ie,ge,vt.getProjection(),Qt),hs=ag(Vt,yt.tileID.canonical,Xe,Ie,ge,vt.getProjection(),Qt),xa=m.translatePosMatrix(hs,yt,C,D,!0),El=m.translatePosMatrix(Vt,yt,C,D),xo=Fn?md:xr,Zo=Ie&&!Xe&&!Vn;let Qa=gt;!ut&&!ge.mercatorFromTransition||Ie||(Qa=gd(ge));const el=jt?Qa:gt,wa=u.getColorAdjustmentMatrix(Z,se,de,me),cu=mp(Yr.kind,Mn,Zo,Xe,m,El,xo,xa,Se,!1,$n,[0,0],!0,ct,Jt,qe,Oi,el,vt.getProjection(),zi,wa,Yi),uh=yt.imageAtlasTexture?yt.imageAtlasTexture:null,Lp=u.layout.get("icon-size").constantOr(0)!==1||vt.iconsNeedLinear,zp=vt.sdfIcons||m.options.rotating||m.options.zooming||Lp||Qr?xe.LINEAR:xe.NEAREST,Np=vt.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,Pd=m.terrain&&Xe&&Vn?r.bi(r.bz(),xr):md;if(Vn&&vt.icon){const zn=ge.elevation,hu=zn?zn.getAtTileOffsetFunc(ct,ge.center.lat,ge.worldSize,vt.getProjection()):null,c_=$f(Vt,yt.tileID.canonical,Xe,Ie,ge,vt.getProjection(),Qt);cg(vt,Vt,m,!1,c_,hs,Xe,q,hu,ct)}return{program:sn,buffers:vt.icon,uniformValues:cu,atlasTexture:uh,atlasTextureIcon:null,atlasInterpolation:zp,atlasInterpolationIcon:null,isSDF:vt.sdfIcons,hasHalo:Np,depthMode:mi,tile:yt,renderWithShadows:un,labelPlaneMatrixInv:Pd}},wi=()=>{const Vn=Re&&u.layout.get("symbol-placement")!=="point",Ei=[],Fn=Vn||Ue||ai;m.terrainRenderModeElevated()&&je&&Ei.push("PITCH_WITH_MAP_TERRAIN"),jt&&(Ei.push("PROJECTION_GLOBE_VIEW"),Fn&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),vt.text.zOffsetVertexBuffer&&Ei.push("Z_OFFSET"),vt.iconsInText&&Ei.push("RENDER_TEXT_AND_SYMBOL"),Ei.push("RENDER_SDF"),un&&Ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),tr(Ei);const Yi=vt.text.programConfigurations.get(u.id),Ln=m.getOrCreateProgram("symbol",{config:Yi,defines:Ei});let sn,$n=[0,0],Yr=null;const Mn=vt.textSizeData;vt.iconsInText&&($n=yt.imageAtlasTexture?yt.imageAtlasTexture.size:[0,0],Yr=yt.imageAtlasTexture?yt.imageAtlasTexture:null,sn=je||ge.pitch!==0||m.options.rotating||m.options.zooming||Mn.kind==="composite"||Mn.kind==="camera"?xe.LINEAR:xe.NEAREST);const Qr=yt.glyphAtlasTexture?yt.glyphAtlasTexture.size:[0,0],xr=u.layout.get("text-size-scale-range"),hs=r.aD(m.scaleFactor,xr[0],xr[1]),xa=r.bH(Mn,ge.zoom,hs),El=Oh(Vt,yt.tileID.canonical,je,Re,ge,vt.getProjection(),Qt),xo=ag(Vt,yt.tileID.canonical,je,Re,ge,vt.getProjection(),Qt),Zo=m.translatePosMatrix(xo,yt,M,O,!0),Qa=m.translatePosMatrix(Vt,yt,M,O),el=Fn?md:El,wa=Re&&!je&&!Vn;let cu=gt;!ut&&!ge.mercatorFromTransition||Re||(cu=gd(ge));const uh=mp(Mn.kind,xa,wa,je,m,Qa,el,Zo,Se,!0,Qr,$n,!0,ct,Jt,qe,Oi,jt?cu:gt,vt.getProjection(),zi,null,null,hs),Lp=yt.glyphAtlasTexture?yt.glyphAtlasTexture:null,zp=xe.LINEAR,Np=u.paint.get("text-halo-width").constantOr(1)!==0,Pd=m.terrain&&je&&Vn?r.bi(r.bz(),El):md;if(Vn&&vt.text){const zn=ge.elevation,hu=zn?zn.getAtTileOffsetFunc(ct,ge.center.lat,ge.worldSize,vt.getProjection()):null,c_=$f(Vt,yt.tileID.canonical,je,Re,ge,vt.getProjection(),Qt);cg(vt,Vt,m,!0,c_,xo,je,Q,hu,ct)}return{program:Ln,buffers:vt.text,uniformValues:uh,atlasTexture:Lp,atlasTextureIcon:Yr,atlasInterpolation:zp,atlasInterpolationIcon:sn,isSDF:!0,hasHalo:Np,depthMode:mi,tile:yt,renderWithShadows:un,labelPlaneMatrixInv:Pd}},$i=vt.icon.segments.get().length,Ji=vt.text.segments.get().length,gn=$i&&!T.onlyText?Wn():null,Cr=Ji&&!T.onlyIcons?wi():null,ar=u.paint.get("icon-opacity").constantOr(1),Tr=u.paint.get("text-opacity").constantOr(1);if(lt&&vt.canOverlap){it=!0;const Vn=ar&&!T.onlyText?vt.icon.segments.get():[],Ei=Tr&&!T.onlyIcons?vt.text.segments.get():[];for(const Fn of Vn)Ze.push({segments:new r.bd([Fn]),sortKey:Fn.sortKey,state:gn});for(const Fn of Ei)Ze.push({segments:new r.bd([Fn]),sortKey:Fn.sortKey,state:Cr})}else T.onlyText||Ze.push({segments:ar?vt.icon.segments:new r.bd([]),sortKey:0,state:gn}),T.onlyIcons||Ze.push({segments:Tr?vt.text.segments:new r.bd([]),sortKey:0,state:Cr})}it&&Ze.sort((ct,yt)=>ct.sortKey-yt.sortKey);for(const ct of Ze){const yt=ct.state;if(yt)if(m.terrain?m.terrain.setupElevationDraw(yt.tile,yt.program,{useDepthForOcclusion:ge.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:yt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(ge.depthOcclusionForSymbolsAndCircles,yt.program),ve.activeTexture.set(xe.TEXTURE0),yt.atlasTexture&&yt.atlasTexture.bind(yt.atlasInterpolation,xe.CLAMP_TO_EDGE,!0),yt.atlasTextureIcon&&(ve.activeTexture.set(xe.TEXTURE1),yt.atlasTextureIcon&&yt.atlasTextureIcon.bind(yt.atlasInterpolationIcon,xe.CLAMP_TO_EDGE,!0)),yt.renderWithShadows&&m.shadowRenderer.setupShadows(yt.tile.tileID.toUnwrapped(),yt.program,"vector-tile",yt.tile.tileID.overscaledZ),m.uploadCommonLightUniforms(m.context,yt.program),yt.hasHalo){const vt=yt.uniformValues;vt.u_is_halo=1,Ug(yt.buffers,ct.segments,u,m,yt.program,yt.depthMode,v,x,vt,2),vt.u_is_halo=0}else{if(yt.isSDF){const vt=yt.uniformValues;yt.hasHalo&&(vt.u_is_halo=1,Ug(yt.buffers,ct.segments,u,m,yt.program,yt.depthMode,v,x,vt,1)),vt.u_is_halo=0}Ug(yt.buffers,ct.segments,u,m,yt.program,yt.depthMode,v,x,yt.uniformValues,1)}}}function Ug(m,a,u,g,v,x,T,C,M,D){const O=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];v.draw(g,g.context.gl.TRIANGLES,x,T,C,fi.disabled,M,u.id,m.layoutVertexBuffer,m.indexBuffer,a,u.paint,g.transform.zoom,m.programConfigurations.get(u.id),O,D)}function Jh(m,a){const u=1<<m.canonical.z,g=(a.x*u-m.canonical.x-m.wrap*u)*r.aj,v=(a.y*u-m.canonical.y)*r.aj,x=r.dS(a.z,a.y);return r.cS(g,v,x)}function _d(m,a,u,g,v){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const x=m.context.gl,T=new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),C=new Wt(m.context.gl.GREATER,Wt.ReadWrite,m.depthRangeFor3D),M=function(V){const Y=r.cJ(V.pitch);let q=.01;return V.isOrthographic&&(q=r.ai(1e-4,q,r.cO(Y>=ic?1:Y/ic))),2*q}(m.transform),D=m.transform.getFreeCameraOptions().position,O="elevatedStructuresDepthReconstruct",z=m.getOrCreateProgram(O,{defines:["DEPTH_RECONSTRUCTION"]}),L=m.getOrCreateProgram(O);for(const V of g){const Y=a.getTile(V),q=Y.getBucket(u);if(!q)continue;const Q=q.elevatedStructures;if(!Q)continue;const Z=q.elevationBufferData.heightRange,se=Jh(V.toUnwrapped(),D),de=m.translatePosMatrix(V.projMatrix,Y,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));let me,Se,ve,xe;if(v==="initialize"){if(!Z||Z.min>=1||Q.depthSegments.segments[0].primitiveLength===0)continue;me=pd(de,se,M,1,0),Se=T,ve=Q.depthSegments,xe=z}else if(v==="reset"){if(!Z||Z.min>=0||Q.maskSegments.segments[0].primitiveLength===0)continue;me=pd(de,se,0,0,1),Se=C,ve=Q.maskSegments,xe=z}else if(v==="geometry"){if(Q.depthSegments.segments[0].primitiveLength===0)continue;me=pd(de,se,M,1,0),Se=T,ve=Q.depthSegments,xe=L}xe.draw(m,x.TRIANGLES,Se,di.disabled,Ri.disabled,fi.disabled,me,u.id,Q.vertexBuffer,Q.indexBuffer,ve,u.paint,m.transform.zoom)}}function Ut(m,a,u){const{painter:g,sourceCache:v,layer:x,coords:T,colorMode:C,elevationType:M,terrainEnabled:D,pass:O}=m,z=g.context.gl,L=x.paint.get("fill-pattern"),V=x.paint.get("fill-pattern-cross-fade"),Y=L.constantOr(null);let q=M;M!=="road"||a&&!D||(q="none");const Q=q==="road",Z=m.painter.shadowRenderer,se=Q&&!!Z&&Z.enabled,de=new Wt(g.context.gl.LEQUAL,Wt.ReadOnly,g.depthRangeFor3D);let me=[0,0,0];if(se){const xe=g.style.directionalLight,ge=g.style.ambientLight;xe&&ge&&(me=Ya(g.style,xe,ge))}const Se=L&&L.constantOr(1),ve=(xe,ge)=>{let Ie,Re,Xe,je,lt;ge?(Ie=Se&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Xe=z.LINES):(Ie=Se?"fillPattern":"fill",Xe=z.TRIANGLES);for(const it of T){const Ct=v.getTile(it);if(Se&&!Ct.patternsLoaded())continue;const $e=Ct.getBucket(x);if(!$e)continue;const qe=a?$e.elevationBufferData:$e.bufferData;if(qe.isEmpty())continue;g.prepareDrawTile();const Ue=qe.programConfigurations.get(x.id),ut=g.isTileAffectedByFog(it),Ze=[],gt=[];Q&&(Ze.push("ELEVATED_ROADS"),gt.push(qe.elevatedLayoutVertexBuffer)),se&&Ze.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Se&&(g.context.activeTexture.set(z.TEXTURE0),Ct.imageAtlasTexture&&Ct.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ue.updatePaintBuffers());let ct=!1;if(Y&&Ct.imageAtlas){const Vt=Ct.imageAtlas,Qt=r.dN.from(Y),Gt=Qt.getPrimary().scaleSelf(r.q.devicePixelRatio).toString(),ai=Qt.getSecondary(),mi=Vt.patternPositions.get(Gt),Oi=ai?Vt.patternPositions.get(ai.scaleSelf(r.q.devicePixelRatio).toString()):null;ct=!!mi&&!!Oi,mi&&Ue.setConstantPatternPositions(mi,Oi)}V>0&&(ct||Ue.getPatternTransitionVertexBuffer("fill-pattern"))&&Ze.push("FILL_PATTERN_TRANSITION");const yt=g.getOrCreateProgram(Ie,{config:Ue,overrideFog:ut,defines:Ze}),vt=g.translatePosMatrix(it.projMatrix,Ct,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));se&&Z.setupShadows(Ct.tileID.toUnwrapped(),yt,"vector-tile",Ct.tileID.overscaledZ);const jt=x.paint.get("fill-emissive-strength");if(ge){je=qe.lineIndexBuffer,lt=qe.lineSegments;const Vt=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];Re=Ie==="fillOutlinePattern"&&Se?Zw(vt,jt,g,Ct,Vt,me,V):Yw(vt,jt,Vt,me)}else je=qe.indexBuffer,lt=qe.triangleSegments,Re=Se?ob(vt,jt,g,Ct,me,V):sb(vt,jt,me);g.uploadCommonUniforms(g.context,yt,it.toUnwrapped());let Jt=xe;(M==="road"&&!D||M==="offset")&&(Jt=de),yt.draw(g,Xe,Jt,u||g.stencilModeForClipping(it),C,fi.disabled,Re,x.id,qe.layoutVertexBuffer,je,lt,x.paint,g.transform.zoom,Ue,gt)}};g.renderPass===O&&ve(g.depthModeForSublayer(1,g.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly),!1),q==="none"&&g.renderPass==="translucent"&&x.paint.get("fill-antialias")&&ve(g.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly),!0)}function yd(m,a,u,g,v,x,T,C){u.resetLayerRenderingStats(m);const M=m.context,D=M.gl,O=m.transform,z=u.paint.get("fill-extrusion-pattern"),L=u.paint.get("fill-extrusion-pattern-cross-fade"),V=z.constantOr(null),Y=z.constantOr(1),q=u.paint.get("fill-extrusion-opacity"),Q=m.style.enable3dLights(),Z=u.paint.get(Q&&!Y?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),se=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],de=u.layout.get("fill-extrusion-edge-radius"),me=de>0&&!u.paint.get("fill-extrusion-rounded-roof"),Se=me?0:de,ve=O.projection.name==="globe"?r.dT():0,xe=O.projection.name==="globe",ge=xe?r.ah(O.zoom):0,Ie=[r.ay(O.center.lng),r.aH(O.center.lat)],Re=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Xe=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(Re?null:u.lut).toArray01().slice(0,3),je=u.paint.get("fill-extrusion-flood-light-intensity"),lt=u.paint.get("fill-extrusion-vertical-scale"),it=u.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ct=u.paint.get("fill-extrusion-height-alignment"),$e=u.paint.get("fill-extrusion-base-alignment"),qe=qc(m,u.paint.get("fill-extrusion-cutoff-fade-range")),Ue=[];let ut;xe&&Ue.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&Ue.push("FAUX_AO"),me&&Ue.push("ZERO_ROOF_RADIUS"),C&&Ue.push("HAS_CENTROID"),je>0&&Ue.push("FLOOD_LIGHT"),qe.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF"),it&&Ue.push("RENDER_WALL_MODE");const Ze=m.renderPass==="shadow",gt=m.shadowRenderer,ct=Ze&&!!gt,yt=Ze?fi.disabled:fi.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let vt=[0,0,0];if(gt){const Vt=m.style.directionalLight,Qt=m.style.ambientLight;Vt&&Qt&&(vt=Ya(m.style,Vt,Qt)),Ze||(Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),gt.useNormalOffset&&Ue.push("NORMAL_OFFSET")),ut=Ue.concat(["SHADOWS_SINGLE_CASCADE"])}const jt=ct?"fillExtrusionDepth":Y?"fillExtrusionPattern":"fillExtrusion",Jt=u.getLayerRenderingStats();for(const Vt of g){const Qt=a.getTile(Vt),Gt=Qt.getBucket(u);if(!Gt||Gt.projection.name!==O.projection.name)continue;let ai=!1;gt&&(ai=gt.getMaxCascadeForTile(Vt.toUnwrapped())===0);const mi=m.isTileAffectedByFog(Vt),Oi=Gt.programConfigurations.get(u.id);let mn=!1;if(V&&Qt.imageAtlas){const Ji=Qt.imageAtlas,gn=r.dN.from(V),Cr=gn.getPrimary().scaleSelf(r.q.devicePixelRatio).toString(),ar=gn.getSecondary(),Tr=Ji.patternPositions.get(Cr),Vn=ar?Ji.patternPositions.get(ar.scaleSelf(r.q.devicePixelRatio).toString()):null;mn=!!Tr&&!!Vn,Tr&&Oi.setConstantPatternPositions(Tr,Vn)}L>0&&(mn||Oi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ue.push("FILL_EXTRUSION_PATTERN_TRANSITION");const un=m.getOrCreateProgram(jt,{config:Oi,defines:ai?ut:Ue,overrideFog:mi});if(m.terrain&&m.terrain.setupElevationDraw(Qt,un,{useMeterToDem:!0}),!Gt.centroidVertexBuffer){const Ji=un.attributes.a_centroid_pos;Ji!==void 0&&D.vertexAttrib2f(Ji,0,0)}!Ze&&gt&&gt.setupShadows(Qt.tileID.toUnwrapped(),un,"vector-tile",Qt.tileID.overscaledZ),Y&&(m.context.activeTexture.set(D.TEXTURE0),Qt.imageAtlasTexture&&Qt.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Oi.updatePaintBuffers());const zi=u.paint.get("fill-extrusion-vertical-gradient"),tr=1/Gt.tileToMeter;let Wn;if(Ze&&gt){if(Qw(Qt.tileID,Gt,m))continue;const Ji=gt.calculateShadowPassMatrixFromTile(Qt.tileID.toUnwrapped());Wn=Xw(Ji,Se,tr,lt,Ct,$e)}else{const Ji=m.translatePosMatrix(Vt.expandedProjMatrix,Qt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),gn=O.projection.createInversionMatrix(O,Vt.canonical);Wn=Y?qw(Ji,m,zi,q,se,Se,tr,Vt,Qt,ve,Ct,$e,ge,Ie,gn,Xe,lt,L):Jc(Ji,m,zi,q,se,Se,tr,Vt,ve,Ct,$e,ge,Ie,gn,Xe,lt,je,vt)}m.uploadCommonUniforms(M,un,Vt.toUnwrapped(),null,qe);let wi=Gt.segments;if(O.projection.name==="mercator"&&!Ze&&(wi=Gt.getVisibleSegments(Qt.tileID,m.terrain,m.transform.getFrustum(0)),!wi.get().length))continue;if(Jt)if(Ze)for(const Ji of wi.get())Jt.numRenderedVerticesInShadowPass+=Ji.primitiveLength;else for(const Ji of wi.get())Jt.numRenderedVerticesInTransparentPass+=Ji.primitiveLength;const $i=[];(m.terrain||C)&&$i.push(Gt.centroidVertexBuffer),xe&&$i.push(Gt.layoutVertexExtBuffer),it&&$i.push(Gt.wallVertexBuffer),un.draw(m,M.gl.TRIANGLES,v,x,T,yt,Wn,u.id,Gt.layoutVertexBuffer,Gt.indexBuffer,wi,u.paint,m.transform.zoom,Oi,$i)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function ih(m,a,u,g,v,x,T,C,M,D,O,z,L,V,Y,q,Q,Z,se){const de=m.context,me=de.gl,Se=m.transform,ve=m.transform.zoom,xe=[],ge=qc(m,u.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(xe.push("CLEAR_SUBPASS"),se&&(xe.push("CLEAR_FROM_TEXTURE"),de.activeTexture.set(me.TEXTURE0),se.bind(me.LINEAR,me.CLAMP_TO_EDGE))):D==="sdf"&&xe.push("SDF_SUBPASS"),Q&&xe.push("HAS_CENTROID"),ge.shouldRenderCutoff&&xe.push("RENDER_CUTOFF");const Ie=u.layout.get("fill-extrusion-edge-radius"),Re=(Xe,je,lt,it,Ct)=>{const $e=je.programConfigurations.get(u.id),qe=m.isTileAffectedByFog(Xe),Ue=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:$e,defines:xe,overrideFog:qe}),ut=((gt,ct,yt,vt,jt,Jt,Vt,Qt,Gt,ai,mi)=>({u_matrix:ct,u_opacity:yt,u_ao_pass:vt?1:0,u_meter_to_tile:jt,u_ao:Jt,u_flood_light_intensity:Vt,u_flood_light_color:Qt,u_attenuation:Gt,u_edge_radius:ai,u_fb:0,u_fb_size:mi,u_dynamic_offset:1}))(0,it,O,M,Ct,[z,L*Ct],V,Y,q,ve>=17?0:Ie*Ct,se?se.size[0]:0),Ze=[];Q&&Ze.push(je.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(de,Ue,Xe.toUnwrapped(),null,ge),Ue.draw(m,de.gl.TRIANGLES,v,x,T,C,ut,u.id,je.vertexBuffer,je.indexBuffer,lt,u.paint,ve,$e,Ze)};for(const Xe of g){const je=a.getTile(Xe),lt=je.getBucket(u);if(!lt||lt.projection.name!==Se.projection.name||!lt.groundEffect||lt.groundEffect&&!lt.groundEffect.hasData())continue;const it=lt.groundEffect,Ct=1/lt.tileToMeter;{const $e=m.translatePosMatrix(Xe.projMatrix,je,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),qe=it.getDefaultSegment();Re(Xe,it,qe,$e,Ct)}if(Z)for(let $e=0;$e<4;$e++){const qe=r.dU[$e](Xe),Ue=a.getTile(qe);if(!Ue)continue;const ut=Ue.getBucket(u);if(!ut||ut.projection.name!==Se.projection.name||!ut.groundEffect||ut.groundEffect&&!ut.groundEffect.hasData())continue;const Ze=ut.groundEffect;let gt,ct;$e===0?(gt=[-r.aj,0,0],ct=1):$e===1?(gt=[r.aj,0,0],ct=0):$e===2?(gt=[0,-r.aj,0],ct=3):(gt=[0,r.aj,0],ct=2);const yt=Ze.regionSegments[ct];if(!yt)continue;const vt=new Float32Array(16);r.bo(vt,Xe.projMatrix,gt),Re(Xe,Ze,yt,m.translatePosMatrix(vt,je,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ct)}}}function ac(m,a,u,g,v,x,T){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const C=x?x.findDEMTileFor(u):null;if(!(C&&C.dem||T))return;x&&C&&C.dem&&g.selfDEMTileTimestamp!==C.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=C.dem._timestamp);const M=Z=>new r.P(Math.ceil((Z+r.dX)*r.dY),0),D=Z=>{const se=a.getSource().minzoom,de=Se=>{const ve=a.getTileByID(Se);if(ve&&ve.hasData())return ve.getBucket(v)},me=[0,-1,1];for(const Se of me){if(Z.overscaledZ+Se<se)continue;const ve=de(Z.calculateScaledKey(Z.overscaledZ+Se));if(ve)return ve}},O=[0,0,0],z=(Z,se)=>(O[0]=Math.min(Z.min.y,se.min.y),O[1]=Math.max(Z.max.y,se.max.y),O[2]=r.aj-se.min.x>Z.max.x?se.min.x-r.aj:Z.max.x,O),L=(Z,se)=>(O[0]=Math.min(Z.min.x,se.min.x),O[1]=Math.max(Z.max.x,se.max.x),O[2]=r.aj-se.min.y>Z.max.y?se.min.y-r.aj:Z.max.y,O),V=[(Z,se)=>z(Z,se),(Z,se)=>z(se,Z),(Z,se)=>L(Z,se),(Z,se)=>L(se,Z)],Y=(Z,se,de,me,Se,ve,xe)=>{if(!x)return 0;const ge=[[ve?de:Z,ve?Z:de,0],[ve?de:se,ve?se:de,0]],Ie=xe<0?r.aj+xe:xe,Re=[ve?Ie:(Z+se)/2,ve?(Z+se)/2:Ie,0];return de===0&&xe<0||de!==0&&xe>0?x.getForTilePoints(Se,[Re],!0,me):ge.push(Re),x.getForTilePoints(u,ge,!0,C),Math.max(ge[0][2],ge[1][2],Re[2])/x.exaggeration()};for(let Z=0;Z<4;Z++){const se=g.borderFeatureIndices[Z];if(se.length===0)continue;const de=r.dU[Z](u),me=D(de);if(!(me&&me instanceof r.dV))continue;const Se=x?x.findDEMTileFor(de):null;if(!(Se&&Se.dem||T)||(x&&Se&&Se.dem&&g.borderDEMTileTimestamp[Z]!==Se.dem._timestamp&&(g.borderDoneWithNeighborZ[Z]=-1,g.borderDEMTileTimestamp[Z]=Se.dem._timestamp),g.borderDoneWithNeighborZ[Z]===me.canonical.z))continue;me.centroidVertexArray.length===0&&me.createCentroidsBuffer();const ve=(Z<2?1:5)-Z,xe=me.borderDoneWithNeighborZ[ve]!==g.canonical.z,ge=me.borderFeatureIndices[ve];let Ie=0;if(g.canonical.z!==me.canonical.z){for(const Re of se)g.showCentroid(g.featuresOnBorder[Re]);if(xe)for(const Re of ge)me.showCentroid(me.featuresOnBorder[Re]);g.borderDoneWithNeighborZ[Z]=me.canonical.z,me.borderDoneWithNeighborZ[ve]=g.canonical.z}for(const Re of se){const Xe=g.featuresOnBorder[Re],je=g.centroidData[Xe.centroidDataIndex],lt=Xe.borders[Z];let it;for(;Ie<ge.length;){it=me.featuresOnBorder[ge[Ie]];const Ct=it.borders[ve];if(Ct[1]>lt[0]+3||Ct[0]>lt[0]-3)break;me.showCentroid(it),Ie++}if(it&&Ie<ge.length){const Ct=Ie;let $e=0;for(;!(it.borders[ve][0]>lt[1]-3)&&($e++,++Ie!==ge.length);)it=me.featuresOnBorder[ge[Ie]];it=me.featuresOnBorder[ge[Ct]];let qe=!1;if($e>=1){const Ze=it.borders[ve];Math.abs(lt[0]-Ze[0])<3&&Math.abs(lt[1]-Ze[1])<3&&($e=1,qe=!0,Ie=Ct+1)}else if($e===0){g.showCentroid(Xe);continue}const Ue=me.centroidData[it.centroidDataIndex];T&&qe&&(((q=je).flags|(Q=Ue).flags)&r.dW?(q.flags|=r.dW,Q.flags|=r.dW):(q.flags&=~r.dW,Q.flags&=~r.dW));const ut=Xe.intersectsCount()>1||it.intersectsCount()>1;if($e>1)Ie=Ct,je.centroidXY=Ue.centroidXY=new r.P(0,0);else if(Se&&Se.dem&&!ut){const Ze=V[Z](je,Ue),gt=Z%2?r.aj-1:0,ct=Y(Ze[0],Math.min(r.aj-1,Ze[1]),gt,Se,de,Z<2,Ze[2]);je.centroidXY=Ue.centroidXY=M(ct)}else ut?je.centroidXY=Ue.centroidXY=new r.P(0,0):(je.centroidXY=g.encodeBorderCentroid(Xe),Ue.centroidXY=me.encodeBorderCentroid(it));g.writeCentroidToBuffer(je),me.writeCentroidToBuffer(Ue)}else g.showCentroid(Xe)}g.borderDoneWithNeighborZ[Z]=me.canonical.z,me.borderDoneWithNeighborZ[ve]=g.canonical.z}var q,Q;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const lc=[1,0,0],oi=[0,1,0],Vg=[0,0,1];function Qw(m,a,u){const g=u.transform,v=u.shadowRenderer;if(!v)return!0;const x=m.toUnwrapped(),T=g.tileSize*v._cascades[u.currentShadowCascade].scale;let C=a.maxHeight;if(g.elevation){const q=g.elevation.getMinMaxForTile(m);q&&(C+=q.max)}const M=[...v.shadowDirection];M[2]=-M[2];const D=v.computeSimplifiedTileShadowVolume(x,C,T,M);if(!D)return!1;const O=[lc,oi,Vg,M,[M[0],0,M[2]],[0,M[1],M[2]]],z=g.projection.name==="globe",L=g.scaleZoom(T),V=r.cn.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,L,!z),Y=v.getCurrentCascadeFrustum();return V.intersectsPrecise(D.vertices,D.planes,O)===0||Y.intersectsPrecise(D.vertices,D.planes,O)===0}function pb(m){return[m[0]*r.dZ,m[1]*r.dZ,m[2]*r.dZ,0]}function bd(m,a,u,g,v,x,T,C,M){const D=g.getSource(),O=u.globeSharedBuffers;if(!O)return;let z,L,V;if(a&&(z=g.getTile(a)),D instanceof r.aP?(L=D.texture,V=r.ds(0,0,u.transform)):z&&a&&(L=z.texture,V=r.ds(a.canonical.z,a.canonical.x,u.transform)),!L||!V)return;m||(V=r.cE(r.bz(),V,[1,-1,1]));const Y=u.context,q=Y.gl,Q=v.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR,Z=u.colorModeForDrapableLayerRenderPass(x),se=T.defines;se.push("GLOBE_POLES");const de=new Wt(q.LEQUAL,Wt.ReadWrite,u.depthRangeFor3D),me=Float32Array.from(u.transform.expandedFarZProjMatrix),Se=Float32Array.from(r.bh(r.dr(new r.cp(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),Y.activeTexture.set(q.TEXTURE0),L.bind(Q,q.CLAMP_TO_EDGE),Y.activeTexture.set(q.TEXTURE1),L.bind(Q,q.CLAMP_TO_EDGE),"useMipmap"in L&&Y.extTextureFilterAnisotropic&&u.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const[ve,xe,ge,Ie]=a?O.getPoleBuffers(a.canonical.z,!1):O.getPoleBuffers(0,!0),Re=v.paint.get("raster-elevation");let Xe;m?(Xe=ve,u.renderDefaultNorthPole=Re!==0):(Xe=xe,u.renderDefaultSouthPole=Re!==0);const je=pb(T.mix),lt=((Ct,$e,qe,Ue,ut,Ze,gt,ct,yt,vt,jt,Jt,Vt)=>oc(Ct,$e,qe,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],ct,2,vt,jt,Jt,1,0,Vt))(me,Se,V,r.ah(u.transform.zoom),0,v,0,Re,0,je,T.offset,T.range,x),it=u.getOrCreateProgram("raster",{defines:se});u.uploadCommonUniforms(Y,it,null),it.draw(u,q.TRIANGLES,de,M,Z,C,lt,v.id,Xe,ge,Ie)}function mb(m){const a=m._nearZ,u=m.projection.farthestPixelDistance(m),g=u-a,v=.2*m.height,x=a+v;return[a,u,(x-v-a)/g,(x-a)/g]}function eA(m,a,u,g){if(m)return a instanceof Nc&&m instanceof Zu?a.getTextureDescriptor(m,u,!0):{texture:m.texture,mix:pb(g.mix),offset:g.offset,buffer:0,tileSize:1}}var gb=r.d_([{name:"a_index",type:"Int16",components:1}]);class tA{constructor(a,u,g,v){const x={width:g[0],height:g[1],data:null},T=a.gl;this.targetColorTexture=new r.T(a,x,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(a,x,T.RGBA8,{useMipmap:!1}),this.context=a,this.updateParticleTexture(u,v),this.lastInvalidatedAt=0}updateParticleTexture(a,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,v=u.width*u.height;this.particleTexture0=new r.T(this.context,u,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,u,g.RGBA8,{premultiply:!1,useMipmap:!1});const x=new r.d$;x.reserve(v);for(let T=0;T<v;T++)x.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(x,gb.members,!0),this.particleSegment=r.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function iA(m,a,u){if(!m)return null;const g=a.getTextureDescriptor(m,u,!0);if(!g)return null;let{texture:v,mix:x,offset:T,tileSize:C,buffer:M,format:D}=g;if(!v||!D)return null;let O=!1;return D==="uint32"&&(O=!0,x[3]=0,x=Og(r.e0,x,[0,u.paint.get("raster-particle-max-speed")]),T=fp(r.e0,T,[0,u.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[M/(C+2*M),C/(C+2*M)],tileSize:C,scalarData:O,scale:x,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function $g(m){const a=m._nearZ,u=m.projection.farthestPixelDistance(m),g=u-a,v=.2*m.height,x=a+v;return[a,u,(x-v-a)/g,(x-a)/g]}const jg=new r.am(1,0,0,1),Hg=new r.am(0,1,0,1),Wg=new r.am(0,0,1,1),vo=new r.am(1,0,1,1),cc=new r.am(0,1,1,1);function nh(m,a,u,g,v,x,T){const C=m.context,M=m.transform,D=C.gl,O=M.projection.name==="globe",z=O?["PROJECTION_GLOBE_VIEW"]:[];let L=r.bw(u.projMatrix);if(O&&r.ah(M.zoom)>0){const je=r.bg(u.canonical,M),lt=r.e1(je);L=r.az(new Float32Array(16),M.globeMatrix,lt),r.az(L,M.projMatrix,L)}const V=r.bz();V[12]+=2*v/(r.q.devicePixelRatio*M.width),V[13]+=2*x/(r.q.devicePixelRatio*M.height),r.az(L,V,L);const Y=m.getOrCreateProgram("debug",{defines:z}),q=a.getTileByID(u.key);m.terrain&&m.terrain.setupElevationDraw(q,Y);const Q=Wt.disabled,Z=di.disabled,se=m.colorModeForRenderPass(),de="$debug";C.activeTexture.set(D.TEXTURE0),m.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),O?q._makeGlobeTileDebugBuffers(m.context,M):q._makeDebugTileBoundsBuffers(m.context,M.projection);const me=q._tileDebugBuffer||m.debugBuffer,Se=q._tileDebugIndexBuffer||m.debugIndexBuffer,ve=q._tileDebugSegments||m.debugSegments;if(Y.draw(m,D.LINE_STRIP,Q,Z,se,fi.disabled,Qc(L,g),de,me,Se,ve,null,null,null,[q._globeTileDebugBorderBuffer]),T){const je=q.latestRawTileData,lt=Math.floor((je&&je.byteLength||0)/1024);let it=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(it+=` => ${u.overscaledZ}`),it+=` ${q.state}`,it+=` ${lt}kb`,function(Ct,$e){Ct.initDebugOverlayCanvas();const qe=Ct.debugOverlayCanvas,Ue=Ct.context.gl,ut=Ct.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,qe.width,qe.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText($e,5,5),ut.strokeText($e,5,5),Ct.debugOverlayTexture.update(qe),Ct.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(m,it)}const xe=a.getTile(u).tileSize,ge=512/Math.min(xe,512)*(u.overscaledZ/M.zoom)*.5,Ie=q._tileDebugTextBuffer||m.debugBuffer,Re=q._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Xe=q._tileDebugTextSegments||m.debugSegments;Y.draw(m,D.TRIANGLES,Q,Z,Ri.alphaBlended,fi.disabled,Qc(L,r.am.transparent,ge),de,Ie,Re,Xe,null,null,null,[q._globeTileDebugTextBuffer])}function xp(m,a,u,g){Qh(m,0,a+u/2,m.transform.width,u,g)}function wp(m,a,u,g){Qh(m,a-u/2,0,u,m.transform.height,g)}function Qh(m,a,u,g,v,x){const T=m.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(a*r.q.devicePixelRatio,u*r.q.devicePixelRatio,g*r.q.devicePixelRatio,v*r.q.devicePixelRatio),T.clear({color:x}),C.disable(C.SCISSOR_TEST)}const _b=r.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:qo}=_b;function pn(m,a,u,g){m.emplaceBack(a,u,g)}class vd{constructor(a){this.vertexArray=new r.e2,this.indices=new r.a_,pn(this.vertexArray,-1,-1,1),pn(this.vertexArray,1,-1,1),pn(this.vertexArray,-1,1,1),pn(this.vertexArray,1,1,1),pn(this.vertexArray,-1,-1,-1),pn(this.vertexArray,1,-1,-1),pn(this.vertexArray,-1,1,-1),pn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,qo),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=r.bd.simpleSegment(0,0,36,12)}}function hc(m,a,u,g,v,x){const T=m.context.gl,C=a.paint.get("sky-atmosphere-color"),M=a.paint.get("sky-atmosphere-halo-color"),D=a.paint.get("sky-atmosphere-sun-intensity"),O=((z,L,V,Y,q)=>({u_matrix_3f:z,u_sun_direction:L,u_sun_intensity:V,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[q.r,q.g,q.b,q.a],u_luminance:5e-5}))(r.e4(r.dx(),g),v,D,C,M);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,a.skyboxTexture,0),u.draw(m,T.TRIANGLES,Wt.disabled,di.disabled,Ri.unblended,fi.frontCW,O,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const yb=r.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bb{constructor(a){const u=new r.e5;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const g=new r.a_;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(u,yb.members),this.indexBuffer=a.createIndexBuffer(g),this.segments=r.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const vb=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class nA{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class eu{constructor(a){this.colorModeAlphaBlendedWriteRGB=new Ri([1,$s,1,$s],r.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ri([1,0,1,0],r.am.transparent,[!1,!1,!1,!0]),this.params=new nA,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){const u=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new bb(u);const g=this.params.sizeRange,v=this.params.intensityRange,x=function(O){const z=r.ea(30),L=[];for(let V=0;V<O;++V){const Y=2*Math.PI*z(),q=Math.acos(1-2*z())-.5*Math.PI;L.push(r.cS(Math.cos(q)*Math.cos(Y),Math.cos(q)*Math.sin(Y),Math.sin(q)))}return L}(this.params.starsCount),T=r.ea(300),C=new r.e6,M=new r.a_;let D=0;for(let O=0;O<x.length;++O){const z=r.b$([],x[O],200),L=Math.max(0,1+.01*g*(1*T()-.5)),V=Math.max(0,1+.01*v*(1*T()-.5));C.emplaceBack(z[0],z[1],z[2],-1,-1,L,V),C.emplaceBack(z[0],z[1],z[2],1,-1,L,V),C.emplaceBack(z[0],z[1],z[2],1,1,L,V),C.emplaceBack(z[0],z[1],z[2],-1,1,L,V),M.emplaceBack(D+0,D+1,D+2),M.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=u.createVertexBuffer(C,vb.members),this.starsIdx=u.createIndexBuffer(M),this.starsSegments=r.bd.simpleSegment(0,0,C.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,u){const g=a.context,v=g.gl,x=a.transform,T=new Wt(v.LEQUAL,Wt.ReadOnly,[0,1]),C=r.ah(x.zoom),M=a.style.getLut(u.scope),D=u.properties.get("color-use-theme")==="none",O=u.properties.get("color").toRenderColor(D?null:M).toArray01(),z=u.properties.get("high-color-use-theme")==="none",L=u.properties.get("high-color").toRenderColor(z?null:M).toArray01(),V=u.properties.get("space-color-use-theme")==="none",Y=u.properties.get("space-color").toRenderColor(V?null:M).toArray01PremultipliedAlpha(),q=5e-4,Q=r.e7(u.properties.get("horizon-blend"),0,1,q,.25),Z=r.dl(a,g,x)&&Q===q?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,se=a.frameCounter/1e3%1,de=r.ae(x.globeCenterInViewSpace),me=Math.sqrt(Math.pow(de,2)-Math.pow(Z,2)),Se=Math.acos(me/de),ve=xe=>{const ge=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];xe&&ge.push("ALPHA_PASS");const Ie=a.getOrCreateProgram("globeAtmosphere",{defines:ge}),Re=((je,lt,it,Ct,$e,qe,Ue,ut,Ze,gt,ct,yt)=>({u_frustum_tl:je,u_frustum_tr:lt,u_frustum_br:it,u_frustum_bl:Ct,u_horizon:$e,u_transition:qe,u_fadeout_range:Ue,u_color:ut,u_high_color:Ze,u_space_color:gt,u_temporal_offset:ct,u_horizon_angle:yt}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,C,Q,O,L,Y,se,Se);a.uploadCommonUniforms(g,Ie);const Xe=this.atmosphereBuffer;Xe&&Ie.draw(a,v.TRIANGLES,T,di.disabled,xe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,fi.backCW,Re,xe?"atmosphere_glow_alpha":"atmosphere_glow",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)};ve(!1),ve(!0)}drawStars(a,u){const g=r.aD(u.properties.get("star-intensity"),0,1);if(g===0)return;const v=a.context,x=v.gl,T=a.transform,C=a.getOrCreateProgram("stars"),M=r.bY([]);r.b_(M,M,-T._pitch),r.bZ(M,M,-T.angle),r.b_(M,M,r.al(T._center.lat)),r.e8(M,M,-r.al(T._center.lng));const D=r.c3(new Float32Array(16),M),O=r.az([],T.starsProjMatrix,D),z=r.e4([],D),L=r.e9([],z),V=[0,1,0];r.dz(V,V,L),r.b$(V,V,this.params.sizeMultiplier);const Y=[1,0,0];r.dz(Y,Y,L),r.b$(Y,Y,this.params.sizeMultiplier);const q=(Q=V,Z=Y,se=g,{u_matrix:Float32Array.from(O),u_up:Q,u_right:Z,u_intensity_multiplier:se});var Q,Z,se;a.uploadCommonUniforms(v,C),this.starsVx&&this.starsIdx&&C.draw(a,x.TRIANGLES,Wt.disabled,di.disabled,this.colorModeAlphaBlendedWriteRGB,fi.disabled,q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function rh(m,a){const u=[...m],g=a.cameraWorldSizeForFog/a.worldSize,v=r.bx([]);return r.cE(v,v,[g,g,1]),r.az(u,v,u),r.az(u,a.worldToFogMatrix,u),u}function It(m,a,u,g,v){const x=u.material,T=g.context,{baseColorTexture:C,metallicRoughnessTexture:M}=x.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:O,emissionTexture:z}=x;function L(Y,q,Q){if(Y&&(m.push(q),T.activeTexture.set(T.gl.TEXTURE0+Q),Y.gfxTexture)){const{minFilter:Z,magFilter:se,wrapS:de,wrapT:me}=Y.sampler;Y.gfxTexture.bindExtraParam(Z,se,de,me)}}L(C,"HAS_TEXTURE_u_baseColorTexture",js.BaseColor),L(M,"HAS_TEXTURE_u_metallicRoughnessTexture",js.MetallicRoughness),L(D,"HAS_TEXTURE_u_normalTexture",js.Normal),L(O,"HAS_TEXTURE_u_occlusionTexture",js.Occlusion),L(z,"HAS_TEXTURE_u_emissionTexture",js.Emission),v&&(v.texture||(v.texture=new r.ed(g.context,v.image,[v.image.height,v.image.height,v.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+js.LUT),v.texture&&v.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(u.texcoordBuffer)),u.colorBuffer&&(m.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(u.colorBuffer)),u.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(u.normalBuffer)),u.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(u.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||m.push("DIFFUSE_SHADED");const V=g.shadowRenderer;V&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Nt(m,a,u,g,v,x){const T=u.paint.get("model-opacity").constantOr(1),C=a.context,M=new Wt(a.context.gl.LEQUAL,Wt.ReadWrite,a.depthRangeFor3D),D=a.transform,O=m.mesh,z=O.material,L=z.pbrMetallicRoughness,V=a.style.fog;let Y;Y=a.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:r.az([],g.zScaleMatrix,m.nodeModelMatrix),r.az(Y,g.negCameraPosMatrix,Y);const q=r.bi([],Y);r.ee(q,q);const Q=u.paint.get("model-color-use-theme").constantOr("default")==="none",Z=u.paint.get("model-emissive-strength").constantOr(0),se=eh(new Float32Array(m.worldViewProjection),new Float32Array(Y),new Float32Array(q),null,a,T,L.baseColorFactor.toRenderColor(null),z.emissiveFactor,L.metallicFactor,L.roughnessFactor,z,Z,u),de={defines:[]},me=[],Se=a.shadowRenderer;Se&&(Se.useNormalOffset=!1),It(de.defines,me,O,a,Q?null:u.lut);let ve=null;if(V){const Ie=rh(m.nodeModelMatrix,a.transform);if(ve=new Float32Array(Ie),D.projection.name!=="globe"){const Re=O.aabb.min,Xe=O.aabb.max,[je,lt]=V.getOpacityForBounds(Ie,Re[0],Re[1],Xe[0],Xe[1]);de.overrideFog=je>=zt||lt>=zt}}const xe=qc(a,u.paint.get("model-cutoff-fade-range"));xe.shouldRenderCutoff&&de.defines.push("RENDER_CUTOFF");const ge=a.getOrCreateProgram("model",de);a.uploadCommonUniforms(C,ge,null,ve,xe),a.renderPass!=="shadow"&&Se&&Se.setupShadowsFromMatrix(m.nodeModelMatrix,ge),ge.draw(a,C.gl.TRIANGLES,M,v,x,O.material.doubleSided?fi.disabled:fi.backCCW,se,u.id,O.vertexBuffer,O.indexBuffer,O.segments,u.paint,a.transform.zoom,void 0,me)}function sh(m,a,u,g,v,x,T){let C;C=m.projection.name==="globe"?r.ef(u,m):[...u],r.az(C,C,a.matrix);const M=r.az([],g,C);if(a.meshes)for(const D of a.meshes){if(D.material.alphaMode!=="BLEND"){T.push({mesh:D,depth:0,modelIndex:v,worldViewProjection:M,nodeModelMatrix:C});continue}const O=r.ad([],D.centroid,M);!m.isOrthographic&&O[2]<=0||x.push({mesh:D,depth:O[2],modelIndex:v,worldViewProjection:M,nodeModelMatrix:C})}if(a.children)for(const D of a.children)sh(m,D,u,g,v,x,T)}function or(m,a,u,g){const v=u.shadowRenderer;if(!v)return;const x=v.getShadowPassDepthMode(),T=v.getShadowPassColorMode(),C=v.calculateShadowPassMatrixFromMatrix(a),M=fb(C);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,x,di.disabled,T,fi.backCCW,M,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,u.transform.zoom,void 0,void 0)}function He(m,a,u){const g=a.updateZoomBasedPaintProperties(),v=function(x,T,C){let M,D,O,z=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&z>0){const L=x.terrain,V=L.findDEMTileFor(C);V&&V.dem?M=r.el.create(L,C,V):z=0}if(z===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),z===T.validForExaggeration&&(z===0||M&&M._demTile&&M._demTile.tileID===T.validForDEMTile.id&&M._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const L in T.instancesPerModel){const V=T.instancesPerModel[L];for(let Y=0;Y<V.instancedDataArray.length;++Y){const q=(M?z*M.getElevationAt(0|V.instancedDataArray.float32[16*Y],0|V.instancedDataArray.float32[16*Y+1],!0,!0):0)+V.instancesEvaluatedElevation[Y];V.instancedDataArray.float32[16*Y+6]=q,D=D?Math.min(T.terrainElevationMin,q):q,O=O?Math.max(T.terrainElevationMax,q):q}}return T.terrainElevationMin=D||0,T.terrainElevationMax=O||0,T.validForExaggeration=z,T.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,a,u);(g||v)&&(a.uploaded=!1,a.upload(m.context))}const _a={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cV([0,0,0],[r.aj,r.aj,0])};function Ap(m,a){const u=1<<m.canonical.z,g=a.getFreeCameraOptions().position,v=a.elevation,x=m.canonical.x/u,T=(m.canonical.x+1)/u,C=m.canonical.y/u,M=(m.canonical.y+1)/u;let D=a._centerAltitude;if(v){const V=v.getMinMaxForTile(m);V&&V.max>D&&(D=V.max)}const O=r.aD(g.x,x,T)-g.x,z=r.aD(g.y,C,M)-g.y,L=r.c6(D,a.center.lat)-g.z;return a._zoomFromMercatorZ(Math.sqrt(O*O+z*z+L*L))}function Tp(m,a,u,g,v,x,T){const C=m.context,M=m.renderPass==="shadow",D=m.shadowRenderer,O=M&&D?D.getShadowPassDepthMode():new Wt(C.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),z=m.isTileAffectedByFog(x);if(u.meshes)for(const L of u.meshes){const V=["MODEL_POSITION_ON_GPU"],Y=[];let q,Q,Z;g.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");const se=qc(m,a.paint.get("model-cutoff-fade-range"));if(se.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),M&&D)q=m.getOrCreateProgram("modelDepth",{defines:V}),Q=fb(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(u.matrix)),Z=D.getShadowPassColorMode();else{It(V,Y,L,m,a.paint.get("model-color-use-theme").constantOr("default")==="none"?null:a.lut),q=m.getOrCreateProgram("model",{defines:V,overrideFog:z});const me=L.material,Se=me.pbrMetallicRoughness,ve=a.paint.get("model-opacity").constantOr(1),xe=a.paint.get("model-emissive-strength").constantOr(0);Q=eh(x.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,m,ve,Se.baseColorFactor.toRenderColor(null),me.emissiveFactor,Se.metallicFactor,Se.roughnessFactor,me,xe,a,v),D&&(T.shadowUniformsInitialized?q.setShadowUniformValues(C,D.getShadowUniformValues()):(D.setupShadows(x.toUnwrapped(),q,"model-tile",x.overscaledZ),T.shadowUniformsInitialized=!0)),Z=se.shouldRenderCutoff||ve<1||me.alphaMode!=="OPAQUE"?Ri.alphaBlended:Ri.unblended}m.uploadCommonUniforms(C,q,x.toUnwrapped(),null,se);const de=L.material.doubleSided?fi.disabled:fi.backCCW;if(g.instancedDataArray.length>20)Y.push(g.instancedDataBuffer),q.draw(m,C.gl.TRIANGLES,O,di.disabled,Z,de,Q,a.id,L.vertexBuffer,L.indexBuffer,L.segments,a.paint,m.transform.zoom,void 0,Y,g.instancedDataArray.length);else{const me=M?"u_instance":"u_normal_matrix";for(let Se=0;Se<g.instancedDataArray.length;++Se)Q[me]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Se,16),q.draw(m,C.gl.TRIANGLES,O,di.disabled,Z,de,Q,a.id,L.vertexBuffer,L.indexBuffer,L.segments,a.paint,m.transform.zoom,void 0,Y)}}if(u.children)for(const L of u.children)Tp(m,a,L,g,v,x,T)}const Gg=[1,-1,1];function xb(m,a,u,g){if(!u.modelManager)return!0;const v=u.modelManager;if(!u.shadowRenderer)return!0;const x=u.shadowRenderer,T=a.aabb;let C=!0,M=m.maxHeight;if(M===0){let O=0;for(const z in m.instancesPerModel){const L=v.getModel(z,g);L?O=Math.max(O,Math.max(Math.max(L.aabb.max[0],L.aabb.max[1]),L.aabb.max[2])):C=!1}M=m.maxScale*O*1.41+m.maxVerticalOffset,C&&(m.maxHeight=M)}T.max[2]=M,T.min[2]+=m.terrainElevationMin,T.max[2]+=m.terrainElevationMax,r.ad(T.min,T.min,a.tileMatrix),r.ad(T.max,T.max,a.tileMatrix);const D=T.intersects(x.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=D===2),D===0}function wb(m,a){const u=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],x=m.uniformValues.u_cutoff_params[3];return g===u||x===v?1:r.aD(((a-u)/(g-u)-v)/(x-v),0,1)}function tu(m,a,u,g){if(a.pitch<20)return 1;const v=a.getWorldToCameraMatrix();r.az(v,v,m);const x=r.ei(u.min[0],u.min[1],u.min[2],1);let T=r.aA(r.ej(),x,v),C=T,M=T;x[1]=u.max[1],T=r.aA(r.ej(),x,v),C=T[1]<C[1]?T:C,M=T[1]>M[1]?T:M,x[0]=u.max[0],T=r.aA(r.ej(),x,v),C=T[1]<C[1]?T:C,M=T[1]>M[1]?T:M,x[1]=u.min[1],T=r.aA(r.ej(),x,v),C=T[1]<C[1]?T:C,M=T[1]>M[1]?T:M;const D=r.aD(g[0],0,1),O=100*a.pixelsPerMeter*r.aD(g[1],0,1),z=r.aD(g[2],0,1),L=r.ek(r.ej(),C,M,D),V=Math.tan(.5*a.fovX),Y=-L[2]*V;if(O===0)return L[1]<-Math.abs(Y)?z:1;const q=(-Math.abs(Y)-L[1])/O,Q=(se,de,me)=>(1-me)*se+me*de,Z=r.aD(Q(1,z,q),z,1);return Q(1,Z,r.aD((a.pitch-20)/20,0,1))}class rA{}class sA{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,u,g){{const z=this._storage.get(u.id);if(z)return z.lastUsedFrameIdx=a,z.buf}const v=g.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),T=new ArrayBuffer(x),C=new Int16Array(T);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const M=new r.en;for(let z=0;z<x/2;z+=3){const L=C[z],V=C[z+1],Y=C[z+2];M.emplaceBack(L,V),M.emplaceBack(V,Y),M.emplaceBack(Y,L)}const D=g.bindVertexArrayOES.current,O=new rA;return O.buf=new wl(g,M),O.lastUsedFrameIdx=a,this._storage.set(u.id,O),g.bindVertexArrayOES.set(D),O.buf}update(a){for(const[u,g]of this._storage)a-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(u))}destroy(){for(const[a,u]of this._storage)u.buf.destroy(),this._storage.delete(a)}}class Ab{constructor(a){this.occluderSize=30,this.depthOffset=-1e-4,a.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),a.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Sp=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Xg{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class qg{constructor(a,u){this.revealStart=11,this.revealRange=2,a.registerParameter(this,[...u,"Reveal"],"revealStart",{min:0,max:17,step:.05}),a.registerParameter(this,[...u,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Tb=r.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Ep{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(a,u){const g=a.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new r.eo,C=new r.a_;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=a.context.createVertexBuffer(T,Tb.members),this.vignetteIdx=a.context.createIndexBuffer(C)}const v=r.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){a.uploadCommonUniforms(a.context,g);const T={u_vignetteShape:(x={vignetteShape:[u.start,u.range,Math.pow(10,u.fadePower)],vignetteColor:[u.color.r,u.color.g,u.color.b,u.color.a*u.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};g.draw(a,a.context.gl.TRIANGLES,Wt.disabled,di.disabled,Ri.alphaBlended,fi.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,v)}var x}}class xd{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(a,u){const g=a.getFreeCameraOptions().position,v=g.toAltitude(),x=g.toLngLat(),T=r.al(x.lng),C=r.al(x.lat),M=a.pixelsPerMeter/u,D=T*r.eq,O=r.eq*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const z=-this._offsetYPrev+O,L=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+D)*M,this._accumulatedOffsetY+=z*M,this._accumulatedElevation+=L*M,this._offsetXPrev=D,this._offsetYPrev=O,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function oh(m,a){return[-(m[0]-Math.floor(m[0]/a)*a),-(m[1]-Math.floor(m[1]/a)*a),-(m[2]-Math.floor(m[2]/a)*a)]}function Yg(m){const a=r.ea(1323123451230),u=[];for(let g=0;g<m;++g){const v=2*a()-1,x=2*a()-1,T=2*a()-1;u.push(r.cS(v,x,T))}return u}function uc(m,a,u,g,v){const x=r.aD((v-u)/(g-u),0,1);return(1-x)*m+x*a}class Ws{constructor(a){this._movement=new xd,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ep,this._ppmScaleFactor=a}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(a,u){const g=a.transform;this._movement.update(g,this._ppmScaleFactor);const v=g.starsProjMatrix,x=r.bY([]);r.b_(x,x,r.al(90)-g._pitch),r.bZ(x,x,-g.angle);const T=r.c3(new Float32Array(16),x),C=r.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),M=r.ee([],C),D=r.az([],M,T),O=Date.now()/1e3;return this._accumulatedTimeFromStart+=(O-this._prevTime)*u,this._prevTime=O,{projectionMatrix:v,modelviewMatrix:D}}}class oA extends Ws{constructor(a){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new qg(a.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(a){const u=a.context;if(!this.particlesVx){const g=Yg(this.particlesCount),v=new r.er,x=new r.a_;let T=0;const C=r.ea(1323123451230);for(let M=0;M<g.length;++M){const D=g[M],O=[2*C()-1,C(),C(),C()];v.emplaceBack(D[0],D[1],D[2],-1,-1,...O),v.emplaceBack(D[0],D[1],D[2],1,-1,...O),v.emplaceBack(D[0],D[1],D[2],1,1,...O),v.emplaceBack(D[0],D[1],D[2],-1,1,...O),x.emplaceBack(T+0,T+1,T+2),x.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=u.createVertexBuffer(v,Sp.members),this.particlesIdx=u.createIndexBuffer(x)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.rain)return;const u=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=a.transform.zoom;if(u.revealStart>g)return;const v=uc(0,1,u.revealStart,u.revealStart+u.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let T=[-x.direction.x,x.direction.y,-100];r.au(T,T);const C=structuredClone(this._vignetteParams);C.strength*=v,x.overrideStyleParameters||(x.intensity=a.style.rain.state.density,x.timeFactor=a.style.rain.state.intensity,x.color=structuredClone(a.style.rain.state.color),T=structuredClone(a.style.rain.state.direction),x.screenThinning.intensity=a.style.rain.state.centerThinning,x.dropletSizeX=a.style.rain.state.dropletSize[0],x.dropletSizeYScale=a.style.rain.state.dropletSize[1]/a.style.rain.state.dropletSize[0],x.distortionStrength=100*a.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(a.style.rain.state.vignetteColor));const M=this.updateOnRender(a,x.timeFactor),D=a.context,O=D.gl,z=a.transform;this.screenTexture&&this.screenTexture.size[0]===a.width&&this.screenTexture.size[1]===a.height||(this.screenTexture=new r.T(D,{width:a.width,height:a.height,data:null},O.RGBA8)),x.distortionStrength>0&&(D.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,a.width,a.height));const L=a.getOrCreateProgram("rainParticle");a.uploadCommonUniforms(D,L),D.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const V=[x.color.r,x.color.g,x.color.b,x.color.a],Y=(q,Q)=>{const Z=oh(this._movement.getPosition(),q),se=x.dropletSizeX,de=x.dropletSizeX*x.dropletSizeYScale,me=a.width/2,Se=a.height/2,ve=uc(0,x.screenThinning.start,0,1,x.screenThinning.intensity),xe=uc(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),ge=uc(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),Ie=(Re={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:q,rainDropletSize:[se,de],distortionStrength:x.distortionStrength,rainDirection:T,color:V,screenSize:[z.width,z.height],thinningCenterPos:[me,Se],thinningShape:[ve,xe,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:ge,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:Q?0:1},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_texScreen:0,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_boxSize:Re.boxSize,u_rainDropletSize:Re.rainDropletSize,u_distortionStrength:Re.distortionStrength,u_rainDirection:Re.rainDirection,u_color:Re.color,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_shapeDirectionalPower:Re.shapeDirectionalPower,u_shapeNormalPower:Re.shapeNormalPower,u_mode:Re.mode});var Re;const Xe=Math.round(x.intensity*this.particlesCount),je=r.bd.simpleSegment(0,0,4*Xe,2*Xe);L.draw(a,O.TRIANGLES,Wt.disabled,di.disabled,Ri.alphaBlended,fi.disabled,Ie,"rain_particles",this.particlesVx,this.particlesIdx,je)};x.distortionStrength>0&&Y(x.boxSize,!0),Y(x.boxSize,!1),this._vignette.draw(a,C)}}const wd=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Un extends Ws{constructor(a){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new qg(a.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(a){const u=a.context;if(!this.particlesVx){const g=Yg(this.particlesCount),v=new r.es,x=new r.a_;let T=0;const C=r.ea(1323123451230);for(let M=0;M<g.length;++M){const D=g[M],O=C(),z=C(),L=C(),V=[M/g.length,O,z,L],Y=[C(),C()];v.emplaceBack(D[0],D[1],D[2],-1,-1,...V,...Y),v.emplaceBack(D[0],D[1],D[2],1,-1,...V,...Y),v.emplaceBack(D[0],D[1],D[2],1,1,...V,...Y),v.emplaceBack(D[0],D[1],D[2],-1,1,...V,...Y),x.emplaceBack(T+0,T+1,T+2),x.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=u.createVertexBuffer(v,wd.members),this.particlesIdx=u.createIndexBuffer(x)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.snow)return;const u=structuredClone(this._params);let g=[-u.direction.x,u.direction.y,-100];r.au(g,g);const v=structuredClone(this._vignetteParams),x=u.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=a.transform.zoom;if(x.revealStart>T)return;const C=uc(0,1,x.revealStart,x.revealStart+x.revealRange,T);v.strength*=C,u.overrideStyleParameters||(u.intensity=a.style.snow.state.density,u.timeFactor=a.style.snow.state.intensity,u.color=structuredClone(a.style.snow.state.color),g=structuredClone(a.style.snow.state.direction),u.screenThinning.intensity=a.style.snow.state.centerThinning,u.billboardSize=2.79*a.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(a.style.snow.state.vignetteColor));const M=this.updateOnRender(a,u.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const D=a.context,O=D.gl,z=a.transform,L=a.getOrCreateProgram("snowParticle");a.uploadCommonUniforms(D,L),((V,Y,q)=>{const Q=oh(this._movement.getPosition(),V),Z=z.width/2,se=z.height/2,de=uc(0,q.screenThinning.start,0,1,q.screenThinning.intensity),me=uc(.001,q.screenThinning.range,0,1,q.screenThinning.intensity),Se=uc(0,q.screenThinning.particleOffset,0,1,q.screenThinning.intensity),ve=(xe={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Q,velocityConeAperture:q.velocityConeAperture,velocity:q.velocity,horizontalOscillationRadius:q.horizontalOscillationRadius,horizontalOscillationRate:q.horizontalOscillationRate,boxSize:V,billboardSize:1*q.billboardSize,simpleShapeParameters:[q.shapeFadeStart,q.shapeFadePower],screenSize:[z.width,z.height],thinningCenterPos:[Z,se],thinningShape:[de,me,Math.pow(10,q.screenThinning.fadePower)],thinningAffectedRatio:q.screenThinning.affectedRatio,thinningParticleOffset:Se,color:[q.color.r,q.color.g,q.color.b,q.color.a],direction:g},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_horizontalOscillationRadius:xe.horizontalOscillationRadius,u_horizontalOscillationRate:xe.horizontalOscillationRate,u_boxSize:xe.boxSize,u_billboardSize:xe.billboardSize,u_simpleShapeParameters:xe.simpleShapeParameters,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_particleColor:xe.color,u_direction:xe.direction});var xe;const ge=Math.round(q.intensity*this.particlesCount),Ie=r.bd.simpleSegment(0,0,4*ge,2*ge);this.particlesVx&&this.particlesIdx&&L.draw(a,O.TRIANGLES,Wt.disabled,di.disabled,Ri.alphaBlended,fi.disabled,ve,"snow_particles",this.particlesVx,this.particlesIdx,Ie)})(u.boxSize,0,u),this._vignette.draw(a,v)}}const tn={symbol:function(m,a,u,g,v){if(m.renderPass!=="translucent")return;const x=di.disabled,T=m.colorModeForRenderPass(),C=u.layout.get("text-variable-anchor"),M=u.layout.get("text-size-scale-range"),D=r.aD(m.scaleFactor,M[0],M[1]);C&&function(L,V,Y,q,Q,Z,se,de){const me=V.transform,Se=Q==="map",ve=Z==="map";for(const xe of L){const ge=q.getTile(xe),Ie=ge.getBucket(Y);if(!Ie||!Ie.text||!Ie.text.segments.get().length)continue;const Re=r.bH(Ie.textSizeData,me.zoom,de),Xe=ed(xe,Ie.getProjection(),me),je=me.calculatePixelsToTileUnitsMatrix(ge),lt=Oh(Xe,ge.tileID.canonical,ve,Se,me,Ie.getProjection(),je),it=Ie.hasIconTextFit()&&Ie.hasIconData();Re&&Ng(Ie,Se,ve,se,me,lt,xe,Math.pow(2,me.zoom-ge.tileID.overscaledZ),Re,it)}}(g,m,u,a,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v,D);const O=u.paint.get("icon-opacity").constantOr(1)!==0,z=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(O||z)?vp(m,a,u,g,x,T):(O&&vp(m,a,u,g,x,T,{onlyIcons:!0}),z&&vp(m,a,u,g,x,T,{onlyText:!0})),a.map.showCollisionBoxes&&(Kh(m,a,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Kh(m,a,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,u,g){if(m.renderPass!=="translucent")return;const v=u.paint.get("circle-opacity"),x=u.paint.get("circle-stroke-width"),T=u.paint.get("circle-stroke-opacity"),C=u.layout.get("circle-sort-key").constantOr(1)!==void 0,M=u.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const D=m.context,O=D.gl,z=m.transform,L=m.depthModeForSublayer(0,Wt.ReadOnly),V=di.disabled,Y=m.colorModeForDrapableLayerRenderPass(M),q=z.projection.name==="globe",Q=[r.ay(z.center.lng),r.aH(z.center.lat)],Z=[];for(let de=0;de<g.length;de++){const me=g[de],Se=a.getTile(me),ve=Se.getBucket(u);if(!ve||ve.projection.name!==z.projection.name)continue;const xe=ve.programConfigurations.get(u.id),ge=r.dK(u),Ie=m.isTileAffectedByFog(me);q&&ge.push("PROJECTION_GLOBE_VIEW"),ge.push("DEPTH_D24"),m.terrain&&z.depthOcclusionForSymbolsAndCircles&&ge.push("DEPTH_OCCLUSION");const Re=m.getOrCreateProgram("circle",{config:xe,defines:ge,overrideFog:Ie}),Xe=ve.layoutVertexBuffer,je=ve.globeExtVertexBuffer,lt=ve.indexBuffer,it=z.projection.createInversionMatrix(z,me.canonical),Ct={programConfiguration:xe,program:Re,layoutVertexBuffer:Xe,globeExtVertexBuffer:je,indexBuffer:lt,uniformValues:r.dL(m,me,Se,it,Q,u),tile:Se};if(C){const $e=ve.segments.get();for(const qe of $e)Z.push({segments:new r.bd([qe]),sortKey:qe.sortKey,state:Ct})}else Z.push({segments:ve.segments,sortKey:0,state:Ct})}C&&Z.sort((de,me)=>de.sortKey-me.sortKey);const se={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(const de of Z){const{programConfiguration:me,program:Se,layoutVertexBuffer:ve,globeExtVertexBuffer:xe,indexBuffer:ge,uniformValues:Ie,tile:Re}=de.state,Xe=de.segments;m.terrain&&m.terrain.setupElevationDraw(Re,Se,se),m.uploadCommonUniforms(D,Se,Re.tileID.toUnwrapped()),Se.draw(m,O.TRIANGLES,L,V,Y,fi.disabled,Ie,u.id,ve,ge,Xe,u.paint,z.zoom,me,[xe])}},heatmap:function(m,a,u,g){if(u.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const v=m.context,x=v.gl,T=di.disabled,C=new Ri([x.ONE,x.ONE,x.ONE,x.ONE],r.am.transparent,[!0,!0,!0,!0]);(function(V,Y,q,Q){const Z=V.gl,se=Y.width*Q,de=Y.height*Q;V.activeTexture.set(Z.TEXTURE1),V.viewport.set([0,0,se,de]);let me=q.heatmapFbo;if(!me||me&&(me.width!==se||me.height!==de)){me&&me.destroy();const Se=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,Se),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),me=q.heatmapFbo=V.createFramebuffer(se,de,!0,null),function(ve,xe,ge,Ie,Re,Xe){const je=ve.gl;je.texImage2D(je.TEXTURE_2D,0,ve.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Re,Xe,0,je.RGBA,ve.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),Ie.colorAttachment.set(ge)}(V,0,Se,me,se,de)}else Z.bindTexture(Z.TEXTURE_2D,me.colorAttachment.get()),V.bindFramebuffer.set(me.framebuffer)})(v,m,u,m.transform.projection.name==="globe"?.5:.25),v.clear({color:r.am.transparent});const M=m.transform,D=M.projection.name==="globe",O=D?["PROJECTION_GLOBE_VIEW"]:[],z=D?fi.frontCCW:fi.disabled,L=[r.ay(M.center.lng),r.aH(M.center.lat)];for(let V=0;V<g.length;V++){const Y=g[V];if(a.hasRenderableParent(Y))continue;const q=a.getTile(Y),Q=q.getBucket(u);if(!Q||Q.projection.name!==M.projection.name)continue;const Z=m.isTileAffectedByFog(Y),se=Q.programConfigurations.get(u.id),de=m.getOrCreateProgram("heatmap",{config:se,defines:O,overrideFog:Z}),{zoom:me}=m.transform;m.terrain&&m.terrain.setupElevationDraw(q,de),m.uploadCommonUniforms(v,de,Y.toUnwrapped());const Se=M.projection.createInversionMatrix(M,Y.canonical);de.draw(m,x.TRIANGLES,Wt.disabled,T,C,z,cb(m,Y,q,Se,L,me,u.paint.get("heatmap-intensity")),u.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,u.paint,m.transform.zoom,se,D?[Q.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,x){const T=v.context,C=T.gl,M=x.heatmapFbo;if(!M)return;T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),T.activeTexture.set(C.TEXTURE1);let D=x.colorRampTexture;D||(D=x.colorRampTexture=new r.T(T,x.colorRamp,C.RGBA8)),D.bind(C.LINEAR,C.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,C.TRIANGLES,Wt.disabled,di.disabled,v.colorModeForRenderPass(),fi.disabled,((O,z,L,V)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(m,u))},line:function(m,a,u,g){if(m.renderPass!=="translucent")return;const v=u.paint.get("line-opacity"),x=u.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;const T=u.paint.get("line-emissive-strength"),C=u.paint.get("line-occlusion-opacity"),M=u.layout.get("line-elevation-reference"),D=u.layout.get("line-width-unit")==="meters",O=M==="sea",z=!(!m.terrain||!m.terrain.enabled),L=m.context,V=L.gl;if(u.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const Y=u.layout.get("line-cross-slope"),q=Y!==void 0,Q=Y<1,Z=m.colorModeForDrapableLayerRenderPass(T),se=m.terrain&&m.terrain.renderingToTexture,de=se?1:r.q.devicePixelRatio,me=u.paint.get("line-dasharray"),Se=me.constantOr(1),ve=u.layout.get("line-cap"),xe=me.constantOr(null),ge=ve.constantOr(null),Ie=u.paint.get("line-pattern"),Re=Ie.constantOr(1),Xe=u.paint.get("line-pattern-cross-fade"),je=Ie.constantOr(null),lt=u.paint.get("line-opacity").constantOr(1);let it=!Re&&lt!==1||m.depthOcclusion&&C>0&&C<1;const Ct=u.paint.get("line-gradient"),$e=Re?"linePattern":"line",qe=r.dM(u);let Ue;if(se&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(it=!1),C!==0&&m.depthOcclusion){const ct=u.paint._values["line-opacity"];ct&&ct.value&&ct.value.kind==="constant"?Ue=ct.value:r.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&qe.push("VARIABLE_LINE_WIDTH");const ut=(ct,yt,vt,jt,Jt,Vt)=>{for(const Qt of ct){const Gt=a.getTile(Qt);if(Re&&!Gt.patternsLoaded())continue;const ai=Gt.getBucket(u);if(!ai||ai.elevationType!=="none"&&!Jt||ai.elevationType==="none"&&Jt)continue;m.prepareDrawTile();const mi=[...yt],Oi=m.shadowRenderer,mn=ai.elevationType==="road"&&!!Oi&&Oi.enabled;let un=[0,0,0];if(mn){const Ei=m.style.directionalLight,Fn=m.style.ambientLight;Ei&&Fn&&(un=Ya(m.style,Ei,Fn)),mi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const zi=ai.programConfigurations.get(u.id);let tr=!1;if(je&&Gt.imageAtlas){const Ei=r.dN.from(je),Fn=Ei.getPrimary().scaleSelf(de).toString(),Yi=Gt.imageAtlas.patternPositions.get(Fn),Ln=Ei.getSecondary(),sn=Ln?Gt.imageAtlas.patternPositions.get(Ln.scaleSelf(de).toString()):null;tr=!!Yi&&!!sn,Yi&&zi.setConstantPatternPositions(Yi,sn)}Xe>0&&(tr||zi.getPatternTransitionVertexBuffer("line-pattern"))&&mi.push("LINE_PATTERN_TRANSITION");const Wn=m.isTileAffectedByFog(Qt),wi=m.getOrCreateProgram($e,{config:zi,defines:mi,overrideFog:Wn,overrideRtt:!Jt&&void 0});if(!Re&&xe&&ge&&Gt.lineAtlas){const Ei=Gt.lineAtlas.getDash(xe,ge);Ei&&zi.setConstantPatternPositions(Ei)}mn&&Oi.setupShadows(Gt.tileID.toUnwrapped(),wi,"vector-tile",Gt.tileID.overscaledZ);let[$i,Ji]=u.paint.get("line-trim-offset");(ge==="round"||ge==="square")&&$i!==Ji&&($i===0&&($i-=1),Ji===1&&(Ji+=1));const gn=se?Qt.projMatrix:null,Cr=D?1/ai.tileToMeter/r.aw(Gt,1,m.transform.zoom):1,ar=D?1/ai.tileToMeter/r.aw(Gt,1,Math.floor(m.transform.zoom)):1,Tr=Re?r.dO(m,Gt,u,gn,de,Cr,ar,[$i,Ji],un,Xe):r.dP(m,Gt,u,gn,ai.lineClipsArray.length,de,Cr,ar,[$i,Ji],un);if(Ct){const Ei=ai.gradients[u.id];let Fn=Ei.texture;if(u.gradientVersion!==Ei.version){let Yi=256;if(u.stepInterpolant){const Ln=a.getSource().maxzoom,sn=Qt.canonical.z===Ln?Math.ceil(1<<m.transform.maxZoom-Qt.canonical.z):1;Yi=r.aD(r.dQ(ai.maxLineLength/r.aj*1024*sn),256,L.maxTextureSize)}Ei.gradient=r.dR({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Yi,image:Ei.gradient||void 0,clips:ai.lineClipsArray}),Ei.texture?Ei.texture.update(Ei.gradient):Ei.texture=new r.T(L,Ei.gradient,V.RGBA8),Ei.version=u.gradientVersion,Fn=Ei.texture}L.activeTexture.set(V.TEXTURE1),Fn.bind(u.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}Se&&(L.activeTexture.set(V.TEXTURE0),Gt.lineAtlasTexture&&Gt.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),zi.updatePaintBuffers()),Re&&(L.activeTexture.set(V.TEXTURE0),Gt.imageAtlasTexture&&Gt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),zi.updatePaintBuffers()),Jt&&!O&&m.terrain.setupElevationDraw(Gt,wi),m.uploadCommonUniforms(L,wi,Qt.toUnwrapped());const Vn=Ei=>{Ue!=null&&(Ue.value=lt*C),wi.draw(m,V.TRIANGLES,vt,Ei,Z,fi.disabled,Tr,u.id,ai.layoutVertexBuffer,ai.indexBuffer,ai.segments,u.paint,m.transform.zoom,zi,[ai.layoutVertexBuffer2,ai.patternVertexBuffer,ai.zOffsetVertexBuffer]),Ue!=null&&(Ue.value=lt)};if(it&&!Jt){const Ei=m.stencilModeForClipping(Qt).ref;Ei===0&&se&&L.clear({stencil:0});const Fn={func:V.EQUAL,mask:255};Tr.u_alpha_discard_threshold=.8,Vn(new di(Fn,Ei,255,V.KEEP,V.KEEP,V.INVERT)),Tr.u_alpha_discard_threshold=0,Vn(new di(Fn,Ei,255,V.KEEP,V.KEEP,V.KEEP))}else Tr.u_alpha_discard_threshold=it&&Jt&&Vt?.8:0,Vn(Jt?jt:m.stencilModeForClipping(Qt))}};let Ze=m.depthModeForSublayer(0,Wt.ReadOnly);const gt=new Wt(m.depthOcclusion?V.GREATER:V.LEQUAL,Wt.ReadOnly,m.depthRangeFor3D);if(u.hasNonElevatedBuckets){const ct=!se&&m.terrain;C!==0&&ct?r.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has line-z-offset enabled.`):ct?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${u.id}.`):ut(g,qe,Ze,di.disabled,!1,!0)}if(u.hasElevatedBuckets){M==="hd-road-markup"?z||(Ze=gt,qe.push("ELEVATED_ROADS")):(qe.push("ELEVATED"),Ze=gt,q&&qe.push(Q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),O&&qe.push("ELEVATION_REFERENCE_SEA"));const ct=it?m.stencilModeFor3D():di.disabled;m.forceTerrainMode=!0,ut(g,qe,Ze,ct,!0,!0),it&&ut(g,qe,Ze,ct,!0,!1),m.forceTerrainMode=!1}it&&(m.resetStencilClippingMasks(),se&&L.clear({stencil:0})),C===0||m.depthOcclusion||se||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,a,u,g){const v=u.paint.get("fill-color"),x=u.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const T=u.paint.get("fill-emissive-strength"),C=m.colorModeForDrapableLayerRenderPass(T),M=u.paint.get("fill-pattern"),D=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&v.constantOr(r.am.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";let O="none";u.layout.get("fill-elevation-reference")!=="none"?O="road":u.paint.get("fill-z-offset").constantOr(1)!==0&&(O="offset");const z=!(!m.terrain||!m.terrain.enabled),L={painter:m,sourceCache:a,layer:u,coords:g,colorMode:C,elevationType:O,terrainEnabled:z,pass:D};if(m.renderPass!=="shadow")if(O!=="offset"){if(Ut(L,!1),O==="road"){const V=!z&&m.renderPass==="translucent";V&&_d(m,a,u,g,"geometry"),Ut(L,!0,di.disabled),V&&function(Y){const{painter:q,sourceCache:Q,layer:Z,coords:se,colorMode:de}=Y,me=q.context.gl,Se=Y.painter.shadowRenderer,ve=!!Se&&Se.enabled,xe=new Wt(q.context.gl.LEQUAL,Wt.ReadOnly,q.depthRangeFor3D);let ge=[0,0,0];if(ve){const Ie=q.style.directionalLight,Re=q.style.ambientLight;Ie&&Re&&(ge=Ya(q.style,Ie,Re))}for(const Ie of se){const Re=Q.getTile(Ie),Xe=Re.getBucket(Z);if(!Xe)continue;const je=Xe.elevatedStructures;if(!je||!je.renderableSegments||je.renderableSegments.segments[0].primitiveLength===0)continue;q.prepareDrawTile();const lt=Xe.bufferData.programConfigurations.get(Z.id),it=q.isTileAffectedByFog(Ie),Ct=[];ve&&Ct.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const $e=q.getOrCreateProgram("elevatedStructures",{config:lt,overrideFog:it,defines:Ct}),qe=q.translatePosMatrix(Ie.projMatrix,Re,Z.paint.get("fill-translate"),Z.paint.get("fill-translate-anchor"));ve&&Se.setupShadows(Re.tileID.toUnwrapped(),$e,"vector-tile",Re.tileID.overscaledZ);const Ue=Bg(qe,ge);q.uploadCommonUniforms(q.context,$e,Ie.toUnwrapped()),$e.draw(q,me.TRIANGLES,xe,di.disabled,de,fi.backCCW,Ue,Z.id,je.vertexBuffer,je.indexBuffer,je.renderableSegments,Z.paint,q.transform.zoom,lt,[je.vertexBufferNormal])}}(L)}}else Ut(L,!1,m.stencilModeFor3D());else m.shadowRenderer&&O==="road"&&!z&&function(V){const{painter:Y,sourceCache:q,layer:Q,coords:Z}=V,se=Y.context.gl,de=V.painter.shadowRenderer;for(const me of Z){const Se=q.getTile(me),ve=Se.getBucket(Q);if(!ve)continue;const xe=ve.elevatedStructures;if(!xe||!xe.shadowCasterSegments||xe.shadowCasterSegments.segments[0].primitiveLength===0)continue;Y.prepareDrawTile();const ge=ve.bufferData.programConfigurations.get(Q.id),Ie=Y.isTileAffectedByFog(me),Re=Y.getOrCreateProgram("elevatedStructuresDepth",{config:ge,overrideFog:Ie}),Xe=de.calculateShadowPassMatrixFromTile(Se.tileID.toUnwrapped());Y.uploadCommonUniforms(Y.context,Re,me.toUnwrapped());const je={u_matrix:Xe,u_depth_bias:.001};Re.draw(Y,se.TRIANGLES,de.getShadowPassDepthMode(),di.disabled,de.getShadowPassColorMode(),fi.disabled,je,Q.id,xe.vertexBuffer,xe.indexBuffer,xe.shadowCasterSegments,Q.paint,Y.transform.zoom,ge)}}(L)},"fill-extrusion":function(m,a,u,g){const v=u.paint.get("fill-extrusion-opacity"),x=m.context,T=x.gl,C=m.terrain,M=C&&C.renderingToTexture;if(v===0)return;const D=m.conflationActive&&m.style.isLayerClipped(u,a.getSource()),O=m.style.order.indexOf(u.fqid);if(D&&function(z,L,V,Y,q){for(const Q of Y){const Z=L.getTile(Q).getBucket(V);Z&&(Z.updateReplacement(Q,z.replacementSource,q),Z.uploadCentroid(z.context))}}(m,a,u,g,O),C||D)for(const z of g){const L=a.getTile(z).getBucket(u);L&&ac(m.context,a,z,L,u,C,D)}if(m.renderPass==="shadow"&&m.shadowRenderer){const z=m.shadowRenderer;if(C&&v<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ab)return;const L=z.getShadowPassDepthMode(),V=z.getShadowPassColorMode();yd(m,a,u,g,L,di.disabled,V,D)}else if(m.renderPass==="translucent"){const z=!u.paint.get("fill-extrusion-pattern").constantOr(1),L=u.paint.get("fill-extrusion-color").constantOr(r.am.white);if(!M&&L.a!==0){const V=new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D);v===1&&z?yd(m,a,u,g,V,di.disabled,Ri.unblended,D):(yd(m,a,u,g,V,di.disabled,Ri.disabled,D),yd(m,a,u,g,V,m.stencilModeFor3D(),m.colorModeForRenderPass(),D),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&z&&(!C&&m.transform.projection.name!=="globe"||M)){const V=u.paint.get("fill-extrusion-opacity"),Y=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Q=u.paint.get("fill-extrusion-flood-light-intensity"),Z=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",se=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(Z?null:u.lut).toArray01().slice(0,3),de=Y>0&&q>0,me=Q>0,Se=(xe,ge,Ie)=>(1-Ie)*xe+Ie*ge,ve=xe=>{const ge=m.depthModeForSublayer(1,Wt.ReadOnly,T.LEQUAL,!0),Ie=u.paint.get(xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=Se(.1,3,Ie),Xe=m._showOverdrawInspector;if(!Xe){const je=new di({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),lt=new Ri([T.ONE,T.ONE,T.ONE,T.ONE],r.am.transparent,[!1,!1,!1,!0],T.MIN);ih(m,a,u,g,ge,je,lt,fi.disabled,xe,"sdf",V,Y,q,Q,se,Re,D,!1)}{const je=Xe?di.disabled:new di({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),lt=Xe?m.colorModeForRenderPass():new Ri([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.am.transparent,[!0,!0,!0,!0]);ih(m,a,u,g,ge,je,lt,fi.disabled,xe,"color",V,Y,q,Q,se,Re,D,!1)}};if(M){const xe=(ge,Ie,Re)=>{const Xe=m.depthModeForSublayer(1,Wt.ReadOnly,T.LEQUAL,!1),je=u.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),lt=Se(.1,3,je);{const it=new Ri([T.ONE,T.ONE,T.ONE,T.ONE],r.am.transparent,[!1,!1,!1,!0]);ih(m,a,u,g,Xe,di.disabled,it,fi.disabled,ge,"clear",V,Y,q,Q,se,lt,D,Ie)}{const it=new di({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Ct=new Ri([T.ONE,T.ONE,T.ONE,T.ONE],r.am.transparent,[!1,!1,!1,!0],T.MIN);ih(m,a,u,g,Xe,it,Ct,fi.disabled,ge,"sdf",V,Y,q,Q,se,lt,D,Ie)}{const it=ge?T.ZERO:T.ONE_MINUS_DST_ALPHA,Ct=new di({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),$e=new Ri([it,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.am.transparent,[!0,!0,!0,!0]);ih(m,a,u,g,Xe,Ct,$e,fi.disabled,ge,"color",V,Y,q,Q,se,lt,D,Ie)}{const it=new Ri([T.ONE,T.ONE,T.ONE,ge?T.ZERO:T.ONE],r.am.transparent,[!1,!1,!1,!0],ge?T.FUNC_ADD:T.MAX);ih(m,a,u,g,Xe,di.disabled,it,fi.disabled,ge,"clear",V,Y,q,Q,se,lt,D,Ie,Re)}};if(de||me){let ge;if(m.prepareDrawTile(),C){const Ie=C.drapeBufferSize[0],Re=C.drapeBufferSize[1];ge=C.framebufferCopyTexture,ge&&(!ge||ge.size[0]===Ie&&ge.size[1]===Re)||(ge&&ge.destroy(),ge=C.framebufferCopyTexture=new r.T(x,new r.r({width:Ie,height:Re}),T.RGBA8)),ge.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Ie,Re)}de&&xe(!0,!1,ge),me&&xe(!1,!0,ge)}}else de&&ve(!0),me&&ve(!1),(de||me)&&m.resetStencilClippingMasks()}}},hillshade:function(m,a,u,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const v=m.context,x=m.terrain&&m.terrain.renderingToTexture,[T,C]=m.renderPass!=="translucent"||x?[{},g]:m.stencilConfigForOverlap(g);for(const M of C){const D=a.getTile(M);if(D.needsHillshadePrepare&&m.renderPass==="offscreen")vg(m,D,u);else if(m.renderPass==="translucent"){const O=m.depthModeForSublayer(0,Wt.ReadOnly),z=u.paint.get("hillshade-emissive-strength"),L=m.colorModeForDrapableLayerRenderPass(z),V=x&&m.terrain?m.terrain.stencilModeForRTTOverlap(M):T[M.overscaledZ];q0(m,M,D,u,O,V,L)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,a,u,g,v,x){if(m.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const T=m.transform.projection.name==="globe",C=u.paint.get("raster-elevation")!==0,M=C&&T;if(m.renderElevatedRasterBackface&&!M)return;const D=m.context,O=D.gl,z=a.getSource(),L=function(ve,xe,ge,Ie){const Re=xe.paint.get("raster-color"),Xe=ve.type==="raster-array",je=[],lt=xe.paint.get("raster-resampling"),it=xe.paint.get("raster-color-mix");let Ct=xe.paint.get("raster-color-range");const $e=[it[0],it[1],it[2],0],qe=it[3];let Ue=lt==="nearest"?Ie.NEAREST:Ie.LINEAR;if(Xe&&(je.push("RASTER_ARRAY"),Re||je.push("RASTER_COLOR"),lt==="linear"&&je.push("RASTER_ARRAY_LINEAR"),Ue=Ie.NEAREST,!Ct&&ve.rasterLayers)){const ut=ve.rasterLayers.find(({id:Ze})=>Ze===xe.sourceLayer);ut&&ut.fields&&ut.fields.range&&(Ct=ut.fields.range)}if(Ct=Ct||[0,1],Re){je.push("RASTER_COLOR"),ge.activeTexture.set(Ie.TEXTURE2),xe.updateColorRamp(Ct);let ut=xe.colorRampTexture;ut||(ut=xe.colorRampTexture=new r.T(ge,xe.colorRamp,Ie.RGBA8)),ut.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}return{mix:$e,range:Ct,offset:qe,defines:je,resampling:Ue}}(z,u,D,O);if(z instanceof r.aP&&!g.length&&!T)return;const V=u.paint.get("raster-emissive-strength"),Y=m.colorModeForDrapableLayerRenderPass(V),q=m.terrain&&m.terrain.renderingToTexture,Q=!m.options.moving,Z=u.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(z instanceof r.aP&&!g.length&&(z.onNorthPole||z.onSouthPole)){const ve=C?m.stencilModeFor3D():di.disabled;return void bd(!!z.onNorthPole,null,m,a,u,V,L,fi.disabled,ve)}if(!g.length)return;const[se,de]=z instanceof r.aP||q?[{},g]:m.stencilConfigForOverlap(g),me=de[de.length-1].overscaledZ;M&&L.defines.push("PROJECTION_GLOBE_VIEW"),C&&L.defines.push("RENDER_CUTOFF");const Se=(ve,xe,ge)=>{for(const Ie of ve){const Re=Ie.toUnwrapped(),Xe=a.getTile(Ie);if(q&&(!Xe||!Xe.hasData()))continue;D.activeTexture.set(O.TEXTURE0);const je=eA(Xe,z,u,L);if(!je||!je.texture)continue;const{texture:lt,mix:it,offset:Ct,tileSize:$e,buffer:qe}=je;let Ue,ut;q?(Ue=Wt.disabled,ut=Ie.projMatrix):C?(Ue=new Wt(O.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),ut=T?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Re,Q)):(Ue=m.depthModeForSublayer(Ie.overscaledZ-me,u.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,O.LESS),ut=m.transform.calculateProjMatrix(Re,Q));const Ze=m.terrain&&q?m.terrain.stencilModeForRTTOverlap(Ie):se[Ie.overscaledZ],gt=x?0:u.paint.get("raster-fade-duration");Xe.registerFadeDuration(gt);const ct=a.findLoadedParent(Ie,0),yt=ud(Xe,ct,a,m.transform,gt);let vt,jt;m.terrain&&m.terrain.prepareDrawTile(),D.activeTexture.set(O.TEXTURE0),lt.bind(Z,O.CLAMP_TO_EDGE),D.activeTexture.set(O.TEXTURE1),ct?(ct.texture&&ct.texture.bind(Z,O.CLAMP_TO_EDGE),vt=Math.pow(2,ct.tileID.overscaledZ-Xe.tileID.overscaledZ),jt=[Xe.tileID.canonical.x*vt%1,Xe.tileID.canonical.y*vt%1]):lt.bind(Z,O.CLAMP_TO_EDGE),"useMipmap"in lt&&D.extTextureFilterAnisotropic&&m.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const Jt=m.transform;let Vt;const Qt=C?mb(Jt):[0,0,0,0];let Gt,ai,mi,Oi,mn,un=0;if(M&&z instanceof r.aP&&z.coordinates.length>3)Gt=Float32Array.from(r.bh(r.dr(new r.cp(0,0,0)))),ai=Float32Array.from(Jt.globeMatrix),mi=Float32Array.from(r.dm(Jt)),Oi=[r.ay(Jt.center.lng),r.aH(Jt.center.lat)],Vt=z.elevatedGlobePerspectiveTransform,mn=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){const wi=r.dn(Ie.canonical);un=r.dp(wi.getCenter().lat),Gt=Float32Array.from(r.bh(r.dr(Ie.canonical))),ai=Float32Array.from(Jt.globeMatrix),mi=Float32Array.from(r.dm(Jt)),Oi=[r.ay(Jt.center.lng),r.aH(Jt.center.lat)],Vt=[0,0],mn=Float32Array.from(r.dq(Ie.canonical,wi,un,Jt.worldSize/Jt._pixelsPerMercatorPixel))}else Vt=z instanceof r.aP?z.perspectiveTransform:[0,0],Gt=new Float32Array(16),ai=new Float32Array(9),mi=new Float32Array(16),Oi=[0,0],mn=new Float32Array(9);const zi=oc(ut,Gt,ai,mi,mn,jt||[0,0],r.ah(m.transform.zoom),Oi,Qt,vt||1,yt,u,Vt,C?u.paint.get("raster-elevation"):0,2,it,Ct,L.range,$e,qe,V),tr=m.isTileAffectedByFog(Ie),Wn=m.getOrCreateProgram("raster",{defines:L.defines,overrideFog:tr});if(m.uploadCommonUniforms(D,Wn,Re),z instanceof r.aP){const wi=z.elevatedGlobeVertexBuffer,$i=z.elevatedGlobeIndexBuffer;if(q||!T)z.boundsBuffer&&z.boundsSegments&&Wn.draw(m,O.TRIANGLES,Ue,di.disabled,Y,fi.disabled,zi,u.id,z.boundsBuffer,m.quadTriangleIndexBuffer,z.boundsSegments);else if(wi&&$i){const Ji=Jt.zoom<=r.cL?z.elevatedGlobeSegments:z.getSegmentsForLongitude(Jt.center.lng);Ji&&Wn.draw(m,O.TRIANGLES,Ue,di.disabled,Y,xe,zi,u.id,wi,$i,Ji)}}else if(M){Ue=new Wt(O.LEQUAL,Wt.ReadOnly,m.depthRangeFor3D);const wi=m.globeSharedBuffers;if(wi){const[$i,Ji,gn]=wi.getGridBuffers(un,!1);Wn.draw(m,O.TRIANGLES,Ue,ge||Ze,m.colorModeForRenderPass(),xe,zi,u.id,$i,Ji,gn)}}else{const{tileBoundsBuffer:wi,tileBoundsIndexBuffer:$i,tileBoundsSegments:Ji}=m.getTileBoundsBuffers(Xe);Wn.draw(m,O.TRIANGLES,Ue,Ze,Y,fi.disabled,zi,u.id,wi,$i,Ji)}}if(!(z instanceof r.aP)&&M)for(const Ie of ve){const Re=Ie.canonical.y===(1<<Ie.canonical.z)-1;Ie.canonical.y===0&&bd(!0,Ie,m,a,u,V,L,xe,ge||di.disabled),Re&&bd(!1,Ie,m,a,u,V,L,xe===fi.frontCW?fi.backCW:fi.frontCW,ge||di.disabled)}};M?Se(de,m.renderElevatedRasterBackface?fi.backCW:fi.frontCW,m.stencilModeFor3D()):Se(de,fi.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,a,u,g,v,x){m.renderPass==="offscreen"&&function(T,C,M,D){if(!D.length)return;const O=T.context,z=O.gl,L=C.getSource();if(!(L instanceof Nc))return;const V=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count")));let Y=M.particlePositionRGBAImage;if(!Y||Y.width!==V){const de=function(me){const Se=me*me,ve=new Uint8Array(4*Se),xe=function(Ie){return Ie|=0,Ie=Math.imul(2747636419^Ie,2654435769),Ie=Math.imul(Ie^Ie>>>16,2654435769),((Ie=Math.imul(Ie^Ie>>>16,2654435769))>>>0)/4294967296},ge=1/1.1;for(let Ie=0;Ie<Se;Ie++){const Re=ge*(xe(2*Ie+0)+Bo),Xe=ge*(xe(2*Ie+1)+Bo),je=255*Re%1,lt=255*Xe%1,it=je,Ct=Xe-lt/255,$e=lt;ve[4*Ie+0]=255*(Re-je/255),ve[4*Ie+1]=255*it,ve[4*Ie+2]=255*Ct,ve[4*Ie+3]=255*$e}return ve}(V);Y=M.particlePositionRGBAImage=new r.r({width:V,height:V},de)}let q=M.particleFramebuffer;q?q.width!==V&&(q.destroy(),q=M.particleFramebuffer=O.createFramebuffer(V,V,!0,null)):q=M.particleFramebuffer=O.createFramebuffer(V,V,!0,null);const Q=[];for(const de of D){const me=C.getTile(de);if(!(me instanceof Zu))continue;const Se=iA(me,L,M);if(!Se)continue;const ve=[me.tileSize,me.tileSize];let xe=M.tileFramebuffer;xe||(xe=M.tileFramebuffer=O.createFramebuffer(ve[0],ve[1],!0,null));let ge=me.rasterParticleState;ge||(ge=me.rasterParticleState=new tA(O,de,ve,Y));const Ie=ge.update(M.lastInvalidatedAt);ge.particleTextureDimension!==V&&ge.updateParticleTexture(de,Y);const Re=ge.targetColorTexture;ge.targetColorTexture=ge.backgroundColorTexture,ge.backgroundColorTexture=Re;const Xe=ge.particleTexture0;ge.particleTexture0=ge.particleTexture1,ge.particleTexture1=Xe,Q.push([de,Se,ge,Ie])}if(Q.length===0)return;const Z=r.q.now(),se=M.previousDrawTimestamp?.001*(Z-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=Z,M.hasColorMap()){O.activeTexture.set(z.TEXTURE0+2);let de=M.colorRampTexture;de||(de=M.colorRampTexture=new r.T(O,M.colorRamp,z.RGBA8)),de.bind(z.LINEAR,z.CLAMP_TO_EDGE)}O.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(de,me,Se){const ve=de.context,xe=ve.gl,ge=me.tileFramebuffer;ve.activeTexture.set(xe.TEXTURE0);const Ie={u_texture:0,u_opacity:1.05*(Xe=me.paint.get("raster-particle-fade-opacity-factor"))/(Xe+.05)},Re=de.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Xe;for(const je of Se){const[,,lt,it]=je;ge.colorAttachment.set(lt.targetColorTexture.texture),ve.viewport.set([0,0,ge.width,ge.height]),ve.clear({color:r.am.transparent}),it&&(lt.backgroundColorTexture.bind(xe.NEAREST,xe.CLAMP_TO_EDGE),Re.draw(de,xe.TRIANGLES,Wt.disabled,di.disabled,Ri.alphaBlended,fi.disabled,Ie,me.id,de.viewportBuffer,de.quadTriangleIndexBuffer,de.viewportSegments))}}(T,M,Q),function(de,me,Se,ve){const xe=de.context,ge=xe.gl,Ie=Se.tileFramebuffer,Re=de.transform.projection.name==="globe",Xe=Se.paint.get("raster-particle-max-speed");for(const je of ve){const[lt,it,Ct]=je;xe.activeTexture.set(ge.TEXTURE0+0),it.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Ie.colorAttachment.set(Ct.targetColorTexture.texture);const $e=de.getOrCreateProgram("rasterParticleDraw",{defines:it.defines,overrideFog:!1});xe.activeTexture.set(ge.TEXTURE0+1);const qe=it.scalarData?[]:[0,1,2,3].map(Ze=>r.dU[Ze](lt));qe.push(lt);const Ue=lt.canonical.x,ut=lt.canonical.y;for(const Ze of qe){const gt=me.getTile(Re?Ze.wrapped():Ze);if(!gt)continue;const ct=gt.rasterParticleState;if(!ct)continue;const yt=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-lt.wrap),vt=Ze.canonical.y;ct.particleTexture0.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const jt=pp(1,ct.particleTexture0.size[0],[yt-Ue,vt-ut],0,it.texture.size,2,Xe,it.textureOffset,it.scale,it.offset);$e.draw(de,ge.POINTS,Wt.disabled,di.disabled,Ri.alphaBlended,fi.disabled,jt,Se.id,ct.particleIndexBuffer,void 0,ct.particleSegment)}}}(T,C,M,Q),O.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(de,me,Se,ve){const xe=de.context,ge=xe.gl,Ie=me.paint.get("raster-particle-max-speed"),Re=ve*me.paint.get("raster-particle-speed-factor")*.15,Xe=function(lt){return Math.pow(lt,6)}(.01+1*me.paint.get("raster-particle-reset-rate-factor")),je=me.particleFramebuffer;xe.viewport.set([0,0,je.width,je.height]);for(const lt of Se){const[,it,Ct]=lt;xe.activeTexture.set(ge.TEXTURE0+0),it.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),xe.activeTexture.set(ge.TEXTURE0+1);const $e=Ct.particleTexture0;$e.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const qe=ub(1,$e.size[0],0,it.texture.size,Ie,Re,Xe,it.textureOffset,it.scale,it.offset);je.colorAttachment.set(Ct.particleTexture1.texture),xe.clear({color:r.am.transparent}),de.getOrCreateProgram("rasterParticleUpdate",{defines:it.defines}).draw(de,ge.TRIANGLES,Wt.disabled,di.disabled,Ri.unblended,fi.disabled,qe,me.id,de.viewportBuffer,de.quadTriangleIndexBuffer,de.viewportSegments)}}(T,M,Q,se)}(m,a,u,g),m.renderPass==="translucent"&&(function(T,C,M,D,O){const z=T.context,L=z.gl,V=C.getSource().tileSize,Y=5*(1-r.af(r.cx,r.cx+1,T.transform.zoom))*V+M.paint.get("raster-particle-elevation"),q=!T.options.moving,Q=T.transform.projection.name==="globe";if(!D.length)return;const[Z,se]=T.stencilConfigForOverlap(D),de=[];Q&&de.push("PROJECTION_GLOBE_VIEW");const me=T.stencilModeFor3D();for(const Se of se){const ve=Se.toUnwrapped(),xe=C.getTile(Se);if(!xe.rasterParticleState)continue;const ge=xe.rasterParticleState,Ie=100;xe.registerFadeDuration(Ie);const Re=C.findLoadedParent(Se,0),Xe=ud(xe,Re,C,T.transform,Ie);let je,lt;T.terrain&&T.terrain.prepareDrawTile(),z.activeTexture.set(L.TEXTURE0),ge.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),z.activeTexture.set(L.TEXTURE1),Re&&Re.rasterParticleState?(Re.rasterParticleState.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),je=Math.pow(2,Re.tileID.overscaledZ-xe.tileID.overscaledZ),lt=[xe.tileID.canonical.x*je%1,xe.tileID.canonical.y*je%1]):ge.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const it=Q?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(ve,q),Ct=T.transform,$e=$g(Ct),qe=r.dn(Se.canonical),Ue=r.dp(qe.getCenter().lat);let ut,Ze,gt,ct,yt;Q?(ut=Float32Array.from(r.bh(r.dr(Se.canonical))),Ze=Float32Array.from(Ct.globeMatrix),gt=Float32Array.from(r.dm(Ct)),ct=[r.ay(Ct.center.lng),r.aH(Ct.center.lat)],yt=Float32Array.from(r.dq(Se.canonical,qe,Ue,Ct.worldSize/Ct._pixelsPerMercatorPixel))):(ut=new Float32Array(16),Ze=new Float32Array(9),gt=new Float32Array(16),ct=[0,0],yt=new Float32Array(9));const vt=Fg(it,ut,Ze,gt,yt,lt||[0,0],r.ah(T.transform.zoom),ct,$e,je||1,Xe,Y),jt=T.isTileAffectedByFog(Se),Jt=T.getOrCreateProgram("rasterParticle",{defines:de,overrideFog:jt});if(T.uploadCommonUniforms(z,Jt,ve),Q){const Vt=new Wt(L.LEQUAL,Wt.ReadOnly,T.depthRangeFor3D),Qt=0,Gt=T.globeSharedBuffers;if(Gt){const[ai,mi,Oi]=Gt.getGridBuffers(Ue,Qt!==0);Jt.draw(T,L.TRIANGLES,Vt,me,Ri.alphaBlended,T.renderElevatedRasterBackface?fi.frontCCW:fi.backCCW,vt,M.id,ai,mi,Oi)}}else{const Vt=T.depthModeForSublayer(0,Wt.ReadOnly),Qt=Z[Se.overscaledZ],{tileBoundsBuffer:Gt,tileBoundsIndexBuffer:ai,tileBoundsSegments:mi}=T.getTileBoundsBuffers(xe);Jt.draw(T,L.TRIANGLES,Vt,Qt,Ri.alphaBlended,fi.disabled,vt,M.id,Gt,ai,mi)}}T.resetStencilClippingMasks()}(m,a,u,g),m.style.map.triggerRepaint())},background:function(m,a,u,g){const v=u.paint.get("background-color"),x=u.paint.get("background-color-use-theme").constantOr("default")==="none",T=u.paint.get("background-opacity"),C=u.paint.get("background-emissive-strength"),M=u.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const D=m.context,O=D.gl,z=m.transform,L=z.tileSize,V=u.paint.get("background-pattern");let Y;if(V!==void 0&&(V===null||(Y=m.imageManager.getPattern(r.I.from(V.toString()),u.scope,m.style.getLut(u.scope)),!Y)))return;const q=!V&&v.a===1&&T===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==q)return;const Q=di.disabled,Z=m.depthModeForSublayer(0,q==="opaque"?Wt.ReadWrite:Wt.ReadOnly),se=m.colorModeForDrapableLayerRenderPass(C),de=V?"backgroundPattern":"background";let me,Se=g;if(Se||(me=m.getBackgroundTiles(),Se=Object.values(me).map(ve=>ve.tileID)),V&&(D.activeTexture.set(O.TEXTURE0),m.imageManager.bind(m.context,u.scope)),M){const ve=m.getOrCreateProgram(de,{overrideFog:!1,overrideRtt:!0}),xe=new Float32Array(r.bx([])),ge=new r.aM(0,0,0,0,0),Ie=V?db(xe,C,T,m,0,u.scope,Y,M,{tileID:ge,tileSize:L}):gp(xe,C,T,v.toRenderColor(x?null:u.lut));ve.draw(m,O.TRIANGLES,Z,Q,se,fi.disabled,Ie,u.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const ve of Se){const xe=m.isTileAffectedByFog(ve),ge=m.getOrCreateProgram(de,{overrideFog:xe}),Ie=ve.toUnwrapped(),Re=g?ve.projMatrix:m.transform.calculateProjMatrix(Ie);m.prepareDrawTile();const Xe=a?a.getTile(ve):me?me[ve.key]:new bl(ve,L,z.zoom,m),je=V?db(Re,C,T,m,0,u.scope,Y,M,{tileID:ve,tileSize:L}):gp(Re,C,T,v.toRenderColor(x?null:u.lut));m.uploadCommonUniforms(D,ge,Ie);const{tileBoundsBuffer:lt,tileBoundsIndexBuffer:it,tileBoundsSegments:Ct}=m.getTileBoundsBuffers(Xe);ge.draw(m,O.TRIANGLES,Z,Q,se,fi.disabled,je,u.id,lt,it,Ct)}},sky:function(m,a,u){const g=m._atmosphere?r.ah(m.transform.zoom):1,v=u.paint.get("sky-opacity")*g;if(v===0)return;const x=m.context,T=u.paint.get("sky-type"),C=new Wt(x.gl.LEQUAL,Wt.ReadOnly,[0,1]),M=m.frameCounter/1e3%1;T==="atmosphere"?m.renderPass==="offscreen"?u.needsSkyboxCapture(m)&&(function(D,O,z,L){const V=D.context,Y=V.gl;let q=O.skyboxFbo;if(!q){q=O.skyboxFbo=V.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new vd(V),O.skyboxTexture=V.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,O.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let de=0;de<6;++de)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(q.framebuffer),V.viewport.set([0,0,32,32]);const Q=O.getCenter(D,!0),Z=D.getOrCreateProgram("skyboxCapture"),se=new Float64Array(16);r.bx(se),r.e3(se,se,.5*-Math.PI),hc(D,O,Z,se,Q,0),r.bx(se),r.e3(se,se,.5*Math.PI),hc(D,O,Z,se,Q,1),r.bx(se),r.cG(se,se,.5*-Math.PI),hc(D,O,Z,se,Q,2),r.bx(se),r.cG(se,se,.5*Math.PI),hc(D,O,Z,se,Q,3),r.bx(se),hc(D,O,Z,se,Q,4),r.bx(se),r.e3(se,se,Math.PI),hc(D,O,Z,se,Q,5),V.viewport.set([0,0,D.width,D.height])}(m,u),u.markSkyboxValid(m)):m.renderPass==="sky"&&function(D,O,z,L,V){const Y=D.context,q=Y.gl,Q=D.transform,Z=D.getOrCreateProgram("skybox");Y.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,O.skyboxTexture);const se=((de,me,Se,ve,xe)=>({u_matrix:de,u_sun_direction:me,u_cubemap:0,u_opacity:ve,u_temporal_offset:xe}))(Q.skyboxMatrix,O.getCenter(D,!1),0,L,V);D.uploadCommonUniforms(Y,Z),Z.draw(D,q.TRIANGLES,z,di.disabled,D.colorModeForRenderPass(),fi.backCW,se,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(m,u,C,v,M):T==="gradient"&&m.renderPass==="sky"&&function(D,O,z,L,V){const Y=D.context,q=Y.gl,Q=D.transform,Z=D.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new vd(Y)),Y.activeTexture.set(q.TEXTURE0);let se=O.colorRampTexture;se||(se=O.colorRampTexture=new r.T(Y,O.colorRamp,q.RGBA8)),se.bind(q.LINEAR,q.CLAMP_TO_EDGE);const de=((me,Se,ve,xe,ge)=>({u_matrix:me,u_color_ramp:0,u_center_direction:Se,u_radius:r.al(ve),u_opacity:xe,u_temporal_offset:ge}))(Q.skyboxMatrix,O.getCenter(D,!1),O.paint.get("sky-gradient-radius"),L,V);D.uploadCommonUniforms(Y,Z),Z.draw(D,q.TRIANGLES,z,di.disabled,D.colorModeForRenderPass(),fi.backCW,de,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(m,u,C,v,M)},debug:function(m,a,u,g,v,x){for(let T=0;T<u.length;T++)if(v){const D=new r.am(g.r*.8,g.g*.8,g.b*.8,1);nh(m,a,u[T],g,-1,-1,x),nh(m,a,u[T],g,-1,1,x),nh(m,a,u[T],g,1,1,x),nh(m,a,u[T],g,1,-1,x),nh(m,a,u[T],D,0,0,x)}else nh(m,a,u[T],g,0,0,x)},custom:function(m,a,u,g){const v=m.context,x=u.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&u.isDraped(a)){if(m.renderPass==="offscreen"){const T=x.prerender;if(T){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const C=m.transform.pointMerc;T.call(x,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),r.ah(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else T.call(x,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const C=x.renderToTile;if(C){const M=g[0].canonical,D={x:M.x+g[0].wrap*(x.wrapTileId?0:1<<M.z),y:M.y,z:M.z};v.setDepthMode(Wt.disabled),v.setStencilMode(di.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),C.call(x,v.gl,D),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(di.disabled);const T=x.renderingMode==="3d"?new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Wt.ReadOnly);if(v.setDepthMode(T),m.transform.projection.name==="globe"){const C=m.transform.pointMerc;x.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),r.ah(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else x.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,a,u,g){if(m.renderPass==="opaque")return;const v=u.paint.get("model-opacity").constantOr(1);if(v===0)return;const x=u.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!x||m.terrain&&v<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof r.ab))return;const T=m.shadowRenderer,C=u.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,C||(T.enabled=!1));const M=()=>{T&&(T.useNormalOffset=!0,C||(T.enabled=!0))},D=a.getSource();if(m.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(Z,se,de,me,Se){const ve=Z.transform;if(ve.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${ve.projection.name} projection is not yet implemented`);const xe=ve.getFreeCameraOptions().position;if(!Z.modelManager)return;const ge=Z.modelManager;de.modelManager=ge;const Ie=Z.shadowRenderer;if(!de._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Re=de._unevaluatedLayout._values["model-id"],Xe=Object.assign({},de.layout.get("model-id").parameters),je=Z.style.order.indexOf(de.fqid);for(const lt of me){const it=se.getTile(lt).getBucket(de);if(!it||it.projection.name!==ve.projection.name)continue;const Ct=it.getModelUris();Ct&&!it.modelsRequested&&(ge.addModelsFromBucket(Ct,Se),it.modelsRequested=!0);const $e=Ap(lt,ve);Xe.zoom=$e;const qe=Re.possiblyEvaluate(Xe);if(He(Z,it,lt),_a.shadowUniformsInitialized=!1,_a.useSingleShadowCascade=!!Ie&&Ie.getMaxCascadeForTile(lt.toUnwrapped())===0,Z.renderPass==="shadow"&&Ie){if(Z.currentShadowCascade===1&&it.isInsideFirstShadowMapFrustum)continue;const Ze=ve.calculatePosMatrix(lt.toUnwrapped(),ve.worldSize);if(_a.tileMatrix.set(Ze),_a.shadowTileMatrix=Float32Array.from(Ie.calculateShadowPassMatrixFromMatrix(Ze)),_a.aabb.min.fill(0),_a.aabb.max[0]=_a.aabb.max[1]=r.aj,_a.aabb.max[2]=0,xb(it,_a,Z,de.scope))continue}const Ue=1<<lt.canonical.z,ut=[((xe.x-lt.wrap)*Ue-lt.canonical.x)*r.aj,(xe.y*Ue-lt.canonical.y)*r.aj,xe.z*Ue*r.aj];Z.conflationActive&&Object.keys(it.instancesPerModel).length>0&&Z.style.isLayerClipped(de,se.getSource())&&it.updateReplacement(lt,Z.replacementSource,je,Se)&&(it.uploaded=!1,it.upload(Z.context));for(let Ze in it.instancesPerModel){const gt=it.instancesPerModel[Ze];gt.features.length>0&&(Ze=qe.evaluate(gt.features[0].feature,{}));const ct=ge.getModel(Ze,Se);if(ct||ge.hasURLBeenRequested(Ze)||it.modelUris.includes(Ze)||(it.modelUris.push(Ze),it.modelsRequested=!1),ct&&ct.uploaded)for(const yt of ct.nodes)Tp(Z,de,yt,gt,ut,lt,_a)}}}(m,a,u,g,D.type==="vector"?u.scope:""),void M();if(!D.loaded())return;if(D.type==="batched-model")return function(Z,se,de,me){de.resetLayerRenderingStats(Z);const Se=Z.context,ve=Z.transform,xe=Z.style.fog,ge=Z.shadowRenderer;if(ve.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${ve.projection.name} projection is not yet implemented`);const Ie=Z.transform.getFreeCameraOptions().position,Re=r.b$([],[Ie.x,Ie.y,Ie.z],Z.transform.worldSize),Xe=r.eb([],Re),je=r.bx([]),lt=r.ec(ve.center.lat,ve.zoom),it=r.bn([],[1,1,1/lt]);r.bo(je,je,Xe);const Ct=de.paint.get("model-opacity").constantOr(1),$e=new Wt(Se.gl.LEQUAL,Wt.ReadWrite,Z.depthRangeFor3D),qe=new Wt(Se.gl.LEQUAL,Wt.ReadOnly,Z.depthRangeFor3D),Ue=new r.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ut=Z.renderPass==="shadow",Ze=ut&&ge?ge.getCurrentCascadeFrustum():ve.getFrustum(ve.scaleZoom(ve.worldSize)),gt=de.paint.get("model-front-cutoff"),ct=gt[2]<1,yt=qc(Z,de.paint.get("model-cutoff-fade-range")),vt=de.getLayerRenderingStats();(function(jt,Jt,Vt,Qt){const Gt=jt.terrain?jt.terrain.exaggeration():0,ai=jt.transform.zoom;for(const mi of Qt){const Oi=Jt.getTile(mi).getBucket(Vt);Oi&&(Oi.setFilter(Vt.filter),jt.conflationActive&&Oi.updateReplacement(mi,jt.replacementSource),Oi.evaluateScale(jt,Vt),jt.terrain&&Gt>0&&Oi.elevationUpdate(jt.terrain,Gt,mi,Vt.source),Oi.needsReEvaluation(jt,ai,Vt)&&Oi.evaluate(Vt))}})(Z,se,de,me),function(){let jt,Jt,Vt;ct?(jt=me.length-1,Jt=-1,Vt=-1):(jt=0,Jt=me.length,Vt=1);const Qt=new Float64Array(16),Gt=r.eg(),ai=new r.P(0,0);for(let mi=jt;mi!==Jt;mi+=Vt){const Oi=me[mi],mn=se.getTile(Oi).getBucket(de);if(!mn||!mn.uploaded)continue;let un=!1;ge&&(un=ge.getMaxCascadeForTile(Oi.toUnwrapped())===0);const zi=ve.calculatePosMatrix(Oi.toUnwrapped(),ve.worldSize),tr=mn.modelTraits;!ut&&ct&&(r.bi(Qt,zi),r.ad(Gt,Re,Qt),ai.x=Gt[0],ai.y=Gt[1]);const Wn=[];mn.setFilter(de.filter);for(const wi of mn.getNodesInfo()){if(wi.hiddenByReplacement||!wi.node.meshes)continue;const $i=wi.node;let Ji=0;Z.terrain&&$i.elevation&&(Ji=$i.elevation*Z.terrain.exaggeration());const gn=(()=>{const $n=wi.aabb;return Ue.min=[...$n.min],Ue.max=[...$n.max],Ue.min[2]+=Ji,Ue.max[2]+=Ji,r.ad(Ue.min,Ue.min,zi),r.ad(Ue.max,Ue.max,zi),Ue})(),Cr=wi.evaluatedScale;if(Cr[0]<=1&&Cr[1]<=1&&Cr[2]<=1&&gn.intersects(Ze)===0)continue;if(!ut&&ct){const $n=.16666666666666666;wi.cameraCollisionOpacity=Re[0]>gn.min[0]&&Re[0]<gn.max[0]&&Re[1]>gn.min[1]&&Re[1]<gn.max[1]&&Re[2]*lt<gn.max[2]&&$i.footprint&&r.bS(ai,$i.footprint)?Math.max(wi.cameraCollisionOpacity-$n,0):Math.min(1,wi.cameraCollisionOpacity+$n)}const ar=[...zi],Tr=$i.anchor?$i.anchor[0]:0,Vn=$i.anchor?$i.anchor[1]:0;r.bo(ar,ar,[Tr*(Cr[0]-1),Vn*(Cr[1]-1),Ji]),r.ci(Cr,r.eh)||r.cE(ar,ar,Cr);const Ei=r.az([],ar,$i.matrix),Fn=r.az([],ve.expandedFarZProjMatrix,Ei),Yi=r.az([],ve.expandedFarZProjMatrix,ar),Ln=r.aA([],[Tr,Vn,Ji,1],Fn)[2];$i.hidden=!1;let sn=Ct;ut||(ct&&(sn*=wi.cameraCollisionOpacity,sn*=tu(ar,ve,wi.aabb,gt)),sn*=wb(yt,Ln)),sn!==0?Wn.push({nodeInfo:wi,depth:Ln,opacity:sn,wvpForNode:Fn,wvpForTile:Yi,nodeModelMatrix:Ei,tileModelMatrix:ar}):$i.hidden=!0}ut||Wn.sort((wi,$i)=>!ct||wi.opacity===1&&$i.opacity===1?wi.depth<$i.depth?-1:1:wi.opacity===1?-1:$i.opacity===1?1:wi.depth>$i.depth?-1:1);for(const wi of Wn){const $i=wi.nodeInfo,Ji=$i.node;let gn=r.az([],it,wi.tileModelMatrix);r.az(gn,je,gn);const Cr=r.bi([],gn);r.ee(Cr,Cr),r.cE(Cr,Cr,Gg),gn=r.az(gn,gn,Ji.matrix);const ar=Z.renderPass==="light-beam",Tr=de.paint.get("model-color-use-theme").constantOr("default")==="none",Vn=tr&r.em.HasMapboxMeshFeatures,Ei=Vn?0:$i.evaluatedRMEA[0][2];for(let Fn=0;Fn<Ji.meshes.length;++Fn){const Yi=Ji.meshes[Fn],Ln=Fn===Ji.lightMeshIndex;let sn=wi.wvpForNode;if(Ln){if(!ar&&!Z.terrain&&Z.shadowRenderer){Z.currentLayer<Z.firstLightBeamLayer&&(Z.firstLightBeamLayer=Z.currentLayer);continue}sn=wi.wvpForTile}else if(ar)continue;const $n={defines:[]},Yr=[];if(!ut&&ge&&(ge.useNormalOffset=!!Yi.normalBuffer),It($n.defines,Yr,Yi,Z,Tr?null:de.lut),Vn||$n.defines.push("DIFFUSE_SHADED"),un&&$n.defines.push("SHADOWS_SINGLE_CASCADE"),vt&&(ut?vt.numRenderedVerticesInShadowPass+=Yi.vertexArray.length:vt.numRenderedVerticesInTransparentPass+=Yi.vertexArray.length),ut){or(Yi,wi.nodeModelMatrix,Z,de);continue}let Mn=null;if(xe){const xo=rh(wi.nodeModelMatrix,Z.transform);if(Mn=new Float32Array(xo),ve.projection.name!=="globe"){const Zo=Yi.aabb.min,Qa=Yi.aabb.max,[el,wa]=xe.getOpacityForBounds(xo,Zo[0],Zo[1],Qa[0],Qa[1]);$n.overrideFog=el>=zt||wa>=zt}}const Qr=Yi.material;let xr;Qr.occlusionTexture&&Qr.occlusionTexture.offsetScale&&(xr=Qr.occlusionTexture.offsetScale,$n.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const hs=Z.getOrCreateProgram("model",$n);!ut&&ge&&ge.setupShadowsFromMatrix(wi.tileModelMatrix,hs,ge.useNormalOffset),Z.uploadCommonUniforms(Se,hs,null,Mn);const xa=Qr.pbrMetallicRoughness;xa.metallicFactor=.9,xa.roughnessFactor=.5;const El=eh(new Float32Array(sn),new Float32Array(gn),new Float32Array(Cr),new Float32Array(Ji.matrix),Z,wi.opacity,xa.baseColorFactor.toRenderColor(null),Qr.emissiveFactor,xa.metallicFactor,xa.roughnessFactor,Qr,Ei,de,[0,0,0],xr);!Ln&&($i.hasTranslucentParts||wi.opacity<1)&&hs.draw(Z,Se.gl.TRIANGLES,$e,di.disabled,Ri.disabled,fi.backCCW,El,de.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments,de.paint,Z.transform.zoom,void 0,Yr),hs.draw(Z,Se.gl.TRIANGLES,Ln?qe:$e,di.disabled,Ln||wi.opacity<1||$i.hasTranslucentParts?Ri.alphaBlended:Ri.unblended,fi.backCCW,El,de.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments,de.paint,Z.transform.zoom,void 0,Yr)}}}}()}(m,a,u,g),void M();if(D.type!=="model")return;const O=D.getModels(),z=[],L=m.transform.getFreeCameraOptions().position,V=r.b$([],[L.x,L.y,L.z],m.transform.worldSize);r.eb(V,V);const Y=[],q=[];let Q=0;for(const Z of O){const se=u.paint.get("model-rotation").constantOr(null),de=u.paint.get("model-scale").constantOr(null),me=u.paint.get("model-translation").constantOr(null);Z.computeModelMatrix(m,se,de,me,!0,!0,!1);const Se=r.bx([]),ve=r.ec(Z.position.lat,m.transform.zoom),xe=r.bn([],[1,1,1/ve]);r.bo(Se,Se,V),z.push({zScaleMatrix:xe,negCameraPosMatrix:Se});for(const ge of Z.nodes)sh(m.transform,ge,Z.matrix,m.transform.expandedFarZProjMatrix,Q,Y,q);Q++}if(Y.sort((Z,se)=>se.depth-Z.depth),m.renderPass!=="shadow"){if(v===1)for(const Z of q)Nt(Z,m,u,z[Z.modelIndex],di.disabled,m.colorModeForRenderPass());else{for(const Z of q)Nt(Z,m,u,z[Z.modelIndex],di.disabled,Ri.disabled);for(const Z of q)Nt(Z,m,u,z[Z.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const Z of Y)Nt(Z,m,u,z[Z.modelIndex],di.disabled,m.colorModeForRenderPass());M()}else{for(const Z of q)or(Z.mesh,Z.nodeModelMatrix,m,u);for(const Z of Y)or(Z.mesh,Z.nodeModelMatrix,m,u);M()}}},Zg={line:function(m,a,u){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(a){const g=a.getVisibleCoordinates();for(const v of g){const x=a.getTile(v).getBucket(m);if(x&&(x.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,a,u){const g=a.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,g.type==="vector"?m.scope:""));if(g.type==="batched-model"||g.type!=="model")return;const v=g.getModels();for(const x of v)x.upload(u.context)},raster:function(m,a,u){const g=a.getSource();if(!(g instanceof Nc&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const x=m.paint.get("raster-array-band")||g.getInitialBand(v);if(x==null)return;const T=a.getIds().map(C=>a.getTileByID(C));for(const C of T)C.updateNeeded(v,x)&&g.prepareTile(C,v,x)},"raster-particle":function(m,a,u){const g=a.getSource();if(!(g instanceof Nc&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const x=m.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(x==null)return;const T=a.getIds().map(C=>a.getTileByID(C));for(const C of T)C.updateNeeded(v,x)&&g.prepareTile(C,v,x)}},Al={fill:_d};class Cp{constructor(a,u,g,v,x){this.context=new Zh(a,u),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const M of T)this._debugParams.enabledLayers[M]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const M of T)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.occlusionParams=new Ab(x),this.setup(),this.numSublayers=Ns.maxUnderzooming+Ns.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ow(this),this._wireframeDebugCache=new sA,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,C,a.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v}updateTerrain(a,u){const g=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hp(this,a));const v=this._terrain;this.transform.elevation=g?v:null,v.update(a,this.transform,u),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(a){const u=a.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=u.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(a){a&&!this._terrain&&(this._terrain=new hp(this,this.style)),this._forceTerrainMode=a}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,u){if(this.width=a*r.q.devicePixelRatio,this.height=u*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const a=this.context,u=new r.ba;u.emplaceBack(0,0),u.emplaceBack(r.aj,0),u.emplaceBack(0,r.aj),u.emplaceBack(r.aj,r.aj),this.tileExtentBuffer=a.createVertexBuffer(u,r.bc.members),this.tileExtentSegments=r.bd.simpleSegment(0,0,4,2);const g=new r.ba;g.emplaceBack(0,0),g.emplaceBack(r.aj,0),g.emplaceBack(0,r.aj),g.emplaceBack(r.aj,r.aj),this.debugBuffer=a.createVertexBuffer(g,r.bc.members),this.debugSegments=r.bd.simpleSegment(0,0,4,5);const v=new r.ba;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(v,r.bc.members),this.viewportSegments=r.bd.simpleSegment(0,0,4,2);const x=new r.aZ;x.emplaceBack(0,0,0,0),x.emplaceBack(r.aj,0,r.aj,0),x.emplaceBack(0,r.aj,0,r.aj),x.emplaceBack(r.aj,r.aj,r.aj,r.aj),this.mercatorBoundsBuffer=a.createVertexBuffer(x,r.bf.members),this.mercatorBoundsSegments=r.bd.simpleSegment(0,0,4,2);const T=new r.a_;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(T);const C=new r.bb;for(const D of[0,1,3,2,0])C.emplaceBack(D);this.debugIndexBuffer=a.createIndexBuffer(C),this.emptyTexture=new r.T(a,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA8),this.identityMat=r.bz();const M=this.context.gl;this.stencilClearMode=new di({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,Wt.disabled,this.stencilClearMode,Ri.disabled,fi.disabled,io(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,u,g){if(!u||this.currentStencilSource===u.id||!a.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const M of g)if(this._tileClippingMaskIDs[M.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=u.id;const v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(Ri.disabled),v.setDepthMode(Wt.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of g){const M=u.getTile(C),D=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:z,tileBoundsSegments:L}=this.getTileBoundsBuffers(M);T.draw(this,x.TRIANGLES,Wt.disabled,new di({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),Ri.disabled,fi.disabled,io(C.projMatrix),"$clipping",O,z,L)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,u=this.context.gl;return new di({func:u.NOTEQUAL,mask:255},a,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const u=this.context.gl;return new di({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(a){const u=this.context.gl,g=a.sort((T,C)=>C.overscaledZ-T.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let C=0;C<x;C++)T[C+v]=new di({func:u.GEQUAL,mask:255},C+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[T,g]}return[{[v]:di.disabled},g]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new Ri([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new r.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ri.unblended:Ri.alphaBlended}colorModeForDrapableLayerRenderPass(a){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ri([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new r.am(0,0,0,a===void 0?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,u,g,v=!1){if(this.depthOcclusion)return new Wt(this.context.gl.GREATER,Wt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return Wt.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new Wt(g||this.context.gl.LEQUAL,u,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const a=this.context.gl,u=Math.ceil(this.width),g=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),x=a.getParameter(a.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===u&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),u!==0&&g!==0&&(this.depthFBO=new yp(this.context,u,g,!1,"texture"),this.depthTexture=new r.T(this.context,{width:u,height:g,data:null},a.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),a.bindTexture(a.TEXTURE_2D,x),this.depthFBO&&(a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),a.blitFramebuffer(0,0,u,g,0,0,u,g,a.DEPTH_BUFFER_BIT,a.NEAREST),a.bindFramebuffer(a.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((a,u)=>a+u/this._fpsHistory.length,0))}render(a,u){const g=r.q.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=u;const v=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(x).filter($e=>{const qe=v[$e];return!(qe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[qe.type]});let C=T(),M=!1,D=!1;for(const $e of C){const qe=v[$e];qe.type==="circle"&&(M=!0),qe.type==="symbol"&&(qe.hasInitialOcclusionOpacityProperties?D=!0:M=!0)}let O=C.map($e=>v[$e]);const z=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let L=0,V=!1;for(const $e in z){const qe=z[$e];qe.used&&(qe.prepare(this.context),qe.getSource().usedInConflation&&++L)}let Y=!1;for(const $e of O)$e.isHidden(this.transform.zoom)||($e.type==="clip"&&(Y=!0),this.prepareLayer($e));const q={},Q={},Z={},se={},de={};for(const $e in z){const qe=z[$e];q[$e]=qe.getVisibleCoordinates(),Q[$e]=q[$e].slice().reverse(),Z[$e]=qe.getVisibleCoordinates(!0).reverse(),se[$e]=qe.getShadowCasterCoordinates(),de[$e]=qe.sortCoordinatesByDistance(q[$e])}const me=$e=>{const qe=this.style.getLayerSourceCache($e);return qe&&qe.used?qe.getSource():null};if(L||Y||this._clippingActiveLastFrame){const $e=[],qe=[];let Ue=0;for(const ut of O)this.isSourceForClippingOrConflation(ut,me(ut))&&($e.push(ut),qe.push(Ue)),Ue++;if($e&&(Y||$e.length>1)||this._clippingActiveLastFrame){Y=!1;const ut=[];for(let Ze=0;Ze<$e.length;Ze++){const gt=$e[Ze],ct=qe[Ze],yt=this.style.getLayerSourceCache(gt);if(!yt||!yt.used||!yt.getSource().usedInConflation&&gt.type!=="clip")continue;let vt=r.ev,jt=r.bQ.None;const Jt=[];let Vt=!0;if(gt.type==="clip"){vt=ct;for(const Qt of gt.layout.get("clip-layer-types"))jt|=Qt==="model"?r.bQ.Model:Qt==="symbol"?r.bQ.Symbol:r.bQ.FillExtrusion;for(const Qt of gt.layout.get("clip-layer-scope"))Jt.push(Qt);gt.isHidden(this.transform.zoom)?Vt=!1:Y=!0}Vt&&ut.push({layer:gt.fqid,cache:yt,order:vt,clipMask:jt,clipScope:Jt})}this.replacementSource.setSources(ut),V=!0}}this._clippingActiveLastFrame=Y,V||this.replacementSource.clear(),this.conflationActive=V,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let $e=0;$e<O.length;$e++){const qe=O[$e],Ue=qe.cutoffRange();if(this.longestCutoffRange=Math.max(Ue,this.longestCutoffRange),Ue>0){const ut=me(qe);ut&&(this.minCutoffZoom=Math.max(ut.minzoom,this.minCutoffZoom)),qe.minzoom&&(this.minCutoffZoom=Math.max(qe.minzoom,this.minCutoffZoom))}qe.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=$e),this._lastOcclusionLayer=$e)}const Se=this.style&&this.style.fog;Se?(this._fogVisible=Se.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Se.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Z),this.opaquePassCutoff=0,C=T(),O=C.map($e=>v[$e]));const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const $e in z)for(const qe of q[$e]){let Ue={min:0,max:0};this.terrain&&(Ue=this.terrain.getMinMaxForTile(qe)||Ue),ve.addShadowReceiver(qe.toUnwrapped(),Ue.min,Ue.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new eu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(xe&&!this._snow&&(this._snow=new Un(this)),!xe&&this._snow&&(this._snow.destroy(),delete this._snow),ge&&!this._rain&&(this._rain=new oA(this)),!ge&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!aa.has(this.context.gl))return;this.renderPass="offscreen";for(const $e of O){const qe=a.getLayerSourceCache($e);if(!$e.hasOffscreenPass()||$e.isHidden(this.transform.zoom))continue;const Ue=qe?Q[qe.id]:void 0;($e.type==="custom"||$e.type==="raster"||$e.type==="raster-particle"||$e.isSky()||Ue&&Ue.length)&&this.renderLayer(this,qe,$e,Ue)}this.depthRangeFor3D=[0,1-(O.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,se)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ie=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Re=(()=>{if(u.showOverdrawInspector)return r.am.black;const $e=this.style.fog;if($e&&this.transform.projection.supportsFog){const qe=this.style.getLut($e.scope);if(!Ie){const Ue=$e.properties.get("color-use-theme")==="none",ut=$e.properties.get("color").toRenderColor(Ue?null:qe).toArray01();return new r.am(...ut)}if(Ie){const Ue=$e.properties.get("space-color-use-theme")==="none",ut=$e.properties.get("space-color").toRenderColor(Ue?null:qe).toArray01();return new r.am(...ut)}}return r.am.transparent})();if(this.context.clear({color:Re,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const $e=O[this.currentLayer],qe=a.getLayerSourceCache($e);if($e.isSky())continue;const Ue=qe?($e.is3D(x)?de:Q)[qe.id]:void 0;this._renderTileClippingMasks($e,qe,Ue),this.renderLayer(this,qe,$e,Ue)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const $e=O[this.currentLayer],qe=a.getLayerSourceCache($e);$e.isSky()&&this.renderLayer(this,qe,$e,qe?Q[qe.id]:void 0)}function Xe($e,qe){let Ue;return qe&&(Ue=($e.type==="symbol"?Z:$e.is3D(x)?de:Q)[qe.id]),Ue}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const $e=O[this.currentLayer];if($e.type==="raster"||$e.type==="raster-particle"){const qe=a.getLayerSourceCache($e);this.renderLayer(this,qe,$e,Xe($e,qe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let je=0;ve&&(je=ve.getShadowCastingLayerCount());let lt=!1,it=-1;for(let $e=0;$e<C.length;++$e){const qe=O[$e];qe.isHidden(this.transform.zoom)||qe.is3D(x)&&(it=$e)}D&&it===-1&&(M=!0);let Ct=!1;for(;this.currentLayer<C.length;){const $e=O[this.currentLayer],qe=a.getLayerSourceCache($e);if($e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped($e)){if($e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ct&&$e.is3D(x)&&!x){const Ue=this.currentLayer,ut=Ze=>{for(this.currentLayer=0;this.currentLayer<O.length;this.currentLayer++){const gt=O[this.currentLayer];if(Al[gt.type]){const ct=this.style.getLayerSourceCache(gt);Al[gt.type](this,ct,gt,Xe(gt,ct),Ze)}}};ut("initialize"),ut("reset"),this.currentLayer=Ue,Ct=!0}if(M&&!lt&&this.terrain&&!this.transform.isOrthographic&&(lt=!0,this.blitDepth()),D&&it!==-1&&this.currentLayer===it+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks($e,qe,qe?q[qe.id]:void 0),this.renderLayer(this,qe,$e,Xe($e,qe)),!this.terrain&&ve&&je>0&&$e.hasShadowPass()&&--je==0&&(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ue=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ue;this.currentLayer++){const ut=O[this.currentLayer];if(!ut.hasLightBeamPass())continue;const Ze=a.getLayerSourceCache(ut);this.renderLayer(this,Ze,ut,Ze?Q[Ze.id]:void 0)}this.currentLayer=Ue,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ue=this.currentLayer;this.depthOcclusion=!0;for(const ut of this.layersWithOcclusionOpacity){this.currentLayer=ut;const Ze=O[this.currentLayer],gt=a.getLayerSourceCache(Ze),ct=gt?Q[gt.id]:void 0;this.terrain||this._renderTileClippingMasks(Ze,gt,gt?q[gt.id]:void 0),this.renderLayer(this,gt,Ze,ct)}this.depthOcclusion=!1,this.currentLayer=Ue,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $e=null;O.forEach(qe=>{const Ue=a.getLayerSourceCache(qe);Ue&&!qe.isHidden(this.transform.zoom)&&Ue.getVisibleCoordinates().length&&(!$e||$e.getSource().maxzoom<Ue.getSource().maxzoom)&&($e=Ue)}),$e&&this.options.showTileBoundaries&&tn.debug(this,$e,$e.getVisibleCoordinates(),r.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&tn.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function($e){const qe=$e.transform.padding;xp($e,$e.transform.height-(qe.top||0),3,jg),xp($e,qe.bottom||0,3,Hg),wp($e,qe.left||0,3,Wg),wp($e,$e.transform.width-(qe.right||0),3,vo);const Ue=$e.transform.centerPoint;(function(ut,Ze,gt,ct){Qh(ut,Ze-1,gt-10,2,20,ct),Qh(ut,Ze-10,gt-1,20,2,ct)})($e,Ue.x,$e.transform.height-Ue.y,cc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),V||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);const{unsupportedLayers:u}=this.transform.projection,g=!u||!u.includes(a.type);if(Zg[a.type]&&(g||this.terrain&&a.type==="custom")){const v=this.style.getLayerSourceCache(a);Zg[a.type](a,v,this)}this.gpuTimingEnd()}renderLayer(a,u,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(g.type)&&(!a.terrain||g.type!=="custom")||g.type==="clip"||tn[g.type](a,u,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,g=this.context.gl;let v=this.gpuTimers[a.id];v||(v=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(u.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,u=this.context.gl,g=u.createQuery();this.deferredRenderGpuTimeQueries.push(g),u.beginQuery(a.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const u={};for(const g in a){const v=a[g],x=this.context.extTimerQuery,T=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),u[g]=T}return u}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.gl;let g=0;for(const v of a)g+=u.getQueryParameter(v,u.QUERY_RESULT)/1e6,u.deleteQuery(v);return g}translatePosMatrix(a,u,g,v,x){if(!g[0]&&!g[1])return a;const T=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){const D=Math.sin(T),O=Math.cos(T);g=[g[0]*O-g[1]*D,g[0]*D+g[1]*O]}const C=[x?g[0]:r.aw(u,g[0],this.transform.zoom),x?g[1]:r.aw(u,g[1],this.transform.zoom),0],M=new Float32Array(16);return r.bo(M,a,C),M}saveTileTexture(a){const u=a.size[0],g=this._tileTextures[u];g?g.push(a):this._tileTextures[u]=[a]}getTileTexture(a){const u=this._tileTextures[a];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,u,g){const v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,x=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||u!==void 0&&!u||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(a,u){this.cache=this.cache||{};const g=u&&u.defines||[],v=u&&u.config,x=this.currentGlobalDefines(a,u&&u.overrideFog,u&&u.overrideRtt).concat(g),T=dp.cacheKey(Zc[a],a,x,v);return this.cache[T]||(this.cache[T]=new dp(this.context,a,Zc[a],v,Kw[a],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,u){if(this.style.enable3dLights()){const g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){const x=((T,C,M)=>{const D=T.properties.get("direction"),O=T.properties.get("color-use-theme")==="none",z=T.properties.get("color").toRenderColor(O?null:M.getLut(T.scope)).toArray01(),L=T.properties.get("intensity"),V=C.properties.get("color-use-theme")==="none",Y=C.properties.get("color").toRenderColor(V?null:M.getLut(C.scope)).toArray01(),q=C.properties.get("intensity"),Q=[D.x,D.y,D.z],Z=r.dw(Y,q),se=r.dw(z,L);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:Q,u_lighting_directional_color:se,u_ground_radiance:Pg(Q,se,Z)}})(g,v,this.style);u.setLightsUniformValues(a,x)}}}uploadCommonUniforms(a,u,g,v,x){if(this.uploadCommonLightUniforms(a,u),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const C=T.getOpacity(this.transform.pitch),M=((D,O,z,L,V,Y,q,Q,Z,se,de,me)=>{const Se=D.transform,ve=O.properties.get("color-use-theme")==="none",xe=O.properties.get("color").toRenderColor(ve?null:D.style.getLut(O.scope)).toArray01();xe[3]=L;const ge=D.frameCounter/1e3%1,[Ie,Re]=O.properties.get("vertical-range");return{u_fog_matrix:z?Se.calculateFogTileMatrix(z):me||D.identityMat,u_fog_range:O.getFovAdjustedRange(Se._fov),u_fog_color:xe,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ie,Re),Re],u_fog_temporal_offset:ge,u_frustum_tl:V,u_frustum_tr:Y,u_frustum_br:q,u_frustum_bl:Q,u_globe_pos:Z,u_globe_radius:se,u_viewport:de,u_globe_transition:r.ah(Se.zoom),u_is_globe:+(Se.projection.name==="globe")}})(this,T,g,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],v);u.setFogUniformValues(a,M)}x&&u.setCutoffUniformValues(a,x.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,u=a.createTexture();return a.bindTexture(a.TEXTURE_2D,u),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)u[v.key]=a[v.key]||new bl(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(a,u){return!(!a.is3D(!(!this.terrain||!this.terrain.enabled))||a.type!=="clip"&&(a.minzoom&&a.minzoom>this.transform.zoom||(this.style._clipLayerPresent||a.sourceLayer!=="building")&&(!u||u.type!=="batched-model")))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[a.key];return u||(this._cachedTileFogOpacities[a.key]=u=this.style.fog.getOpacityForTile(a)),u[0]>=zt||u[1]>=zt}setupDepthForOcclusion(a,u,g){const v=this.context,x=v.gl,T=!!g;var C;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(x.TEXTURE3),a&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),v.activeTexture.set(x.TEXTURE0),T||u.setTerrainUniformValues(v,g)}}function ah(m,a){let u=!1,g=null;const v=()=>{g=null,u&&(m(),g=setTimeout(v,a),u=!1)};return()=>(u=!0,g||v(),g)}class iu{constructor(a){this._hashName=a&&encodeURIComponent(a),r.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ah(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const u=Ip(a);if(this._hashName){const g=this._hashName;let v=!1;const x=location.hash.slice(1).split("&").map(T=>{const C=T.split("=")[0];return C===g?(v=!0,`${C}=${u}`):T}).filter(T=>T);return v||x.push(`${g}=${u}`),`#${x.join("&")}`}return`#${u}`}_getCurrentHash(){const a=location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(Number(g)))){const g=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(u[3]||0):a.getBearing();return a.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ip(m,a){const u=m.getCenter(),g=Math.round(100*m.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),T=Math.round(u.lng*x)/x,C=Math.round(u.lat*x)/x,M=m.getBearing(),D=m.getPitch();let O=a?`/${T}/${C}/${g}`:`${g}/${C}/${T}`;return(M||D)&&(O+="/"+Math.round(10*M)/10),D&&(O+=`/${Math.round(D)}`),O}const nu={linearity:.3,easing:r.ew(0,0,.3,1)},Kg=r.l({deceleration:2500,maxSpeed:1400},nu),Jg=r.l({deceleration:20,maxSpeed:1400},nu),Za=r.l({deceleration:1e3,maxSpeed:360},nu),Tl=r.l({deceleration:1e3,maxSpeed:90},nu);class Mp{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,u=r.q.now();for(;a.length>0&&u-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const x=ru(u.pan.mag(),g,r.l({},Kg,a||{}));v.offset=u.pan.mult(x.amount/u.pan.mag()),v.center=this._map.transform.center,lh(v,x)}if(u.zoom){const x=ru(u.zoom,g,Jg);v.zoom=this._map.transform.zoom+x.amount,lh(v,x)}if(u.bearing){const x=ru(u.bearing,g,Za);v.bearing=this._map.transform.bearing+r.aD(x.amount,-179,179),lh(v,x)}if(u.pitch){const x=ru(u.pitch,g,Tl);v.pitch=this._map.transform.pitch+x.amount,lh(v,x)}if(v.zoom||v.bearing){const x=u.pinchAround===void 0?u.around:u.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function lh(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function ru(m,a,u){const{maxSpeed:g,linearity:v,deceleration:x}=u,T=r.aD(m*v/(a/1e3),-g,g),C=Math.abs(T)/(x*v);return{easing:u.easing,duration:1e3*C,amount:T*(C/2)}}class no extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g,v={}){const x=_t(u.getCanvasContainer(),g),T=u.unproject(x);super(a,r.l({point:x,lngLat:T,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class Ka extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g){const v=a==="touchend"?g.changedTouches:g.touches,x=St(u.getCanvasContainer(),v),T=x.map(M=>u.unproject(M)),C=x.reduce((M,D,O,z)=>M.add(D.div(z.length)),new r.P(0,0));super(a,{points:x,point:C,lngLats:T,lngLat:u.unproject(C),originalEvent:g}),this._defaultPrevented=!1}}class Qg extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class dc{constructor(a,u){this._map=a,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Qg(this._map,a))}mousedown(a,u){return this._mousedownPos=u,this._firePreventable(new no(a.type,this._map,a))}mouseup(a){this._map.fire(new no(a.type,this._map,a))}preclick(a){const u=r.l({},a);u.type="preclick",this._map.fire(new no(u.type,this._map,u))}click(a,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(a),this._map.fire(new no(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new no(a.type,this._map,a))}mouseover(a){this._map.fire(new no(a.type,this._map,a))}mouseout(a){this._map.fire(new no(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Ka(a.type,this._map,a))}touchmove(a){this._map.fire(new Ka(a.type,this._map,a))}touchend(a){this._map.fire(new Ka(a.type,this._map,a))}touchcancel(a){this._map.fire(new Ka(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class e_{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new no(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new no("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new no(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rp{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,u){this.isEnabled()&&a.shiftKey&&a.button===0&&(Ee(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(a,u){if(!this._active)return;const g=u,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=W("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const T=Math.min(v.x,g.x),C=Math.max(v.x,g.x),M=Math.min(v.y,g.y),D=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${M}px)`,this._box.style.width=C-T+"px",this._box.style.height=D-M+"px")})}mouseupWindow(a,u){if(!this._active)return;const g=this._startPos,v=u;if(g&&a.button===0){if(this.reset(),Tt(),g.x!==v.x||g.y!==v.y)return this._map.fire(new r.A("boxzoomend",{originalEvent:a})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Le(),delete this._startPos,delete this._lastPos}_fireEvent(a,u){return this._map.fire(new r.A(a,{originalEvent:u}))}}function Ad(m,a){const u={};for(let g=0;g<m.length;g++)u[m[g].identifier]=a[g];return u}class t_{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const x=new r.P(0,0);for(const T of v)x._add(T);return x.div(v.length)}(u),this.touches=Ad(g,u)))}touchmove(a,u,g){if(this.aborted||!this.centroid)return;const v=Ad(g,u);for(const x in this.touches){const T=v[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(a,u,g){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class qr{constructor(a){this.singleTap=new t_(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,u,g){this.singleTap.touchstart(a,u,g)}touchmove(a,u,g){this.singleTap.touchmove(a,u,g)}touchend(a,u,g){const v=this.singleTap.touchend(a,u,g);if(v){const x=a.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(x&&T||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class i_{constructor(){this._zoomIn=new qr({numTouches:1,numTaps:2}),this._zoomOut=new qr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,u,g){this._zoomIn.touchstart(a,u,g),this._zoomOut.touchstart(a,u,g)}touchmove(a,u,g){this._zoomIn.touchmove(a,u,g),this._zoomOut.touchmove(a,u,g)}touchend(a,u,g){const v=this._zoomIn.touchend(a,u,g),x=this._zoomOut.touchend(a,u,g);return v?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:a})}):x?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const n_={0:1,2:2},fc={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Td{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,u){return!1}_move(a,u){return{}}mousedown(a,u){if(this._lastPoint)return;const g=kt(a);this._correctButton(a,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(a,u){const g=this._lastPoint;if(g){if(a.preventDefault(),this._eventButton!=null&&function(v,x){const T=n_[x];return v.buttons===void 0||(v.buttons&T)!==T}(a,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}}mouseupWindow(a){this._lastPoint&&kt(a)===this._eventButton&&(this._moved&&Tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class r_ extends Td{mousedown(a,u){super.mousedown(a,u),this._lastPoint&&(this._active=!0)}_correctButton(a,u){return u===0&&!a.ctrlKey}_move(a,u){return{around:u,panDelta:u.sub(a)}}}class kp extends Td{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?fc[a.pitchRotateKey]:void 0}_correctButton(a,u){return this._pitchRotateKey?u===0&&a[this._pitchRotateKey]:u===0&&a.ctrlKey||u===2}_move(a,u){const g=.8*(u.x-a.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class ch extends Td{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?fc[a.pitchRotateKey]:void 0}_correctButton(a,u){return this._pitchRotateKey?u===0&&a[this._pitchRotateKey]:u===0&&a.ctrlKey||u===2}_move(a,u){const g=-.5*(u.y-a.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class s_{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),r.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(a,u,g){return this._calculateTransform(a,u,g)}touchmove(a,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!r.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,u,g)}}touchend(a,u,g){this._calculateTransform(a,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,u,g){g.length>0&&(this._active=!0);const v=Ad(g,u),x=new r.P(0,0),T=new r.P(0,0);let C=0;for(const D in v){const O=v[D],z=this._touches[D];z&&(x._add(O),T._add(O.sub(z)),C++,v[D]=O)}if(this._touches=v,C<this._minTouches||!T.mag())return;const M=T.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Sd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,u,g){return{}}touchstart(a,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(a,u,g){const v=this._firstTwoTouches;if(!v)return;a.preventDefault();const[x,T]=v,C=su(g,u,x),M=su(g,u,T);if(!C||!M)return;const D=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],D,a)}touchend(a,u,g){if(!this._firstTwoTouches)return;const[v,x]=this._firstTwoTouches,T=su(g,u,v),C=su(g,u,x);T&&C||(this._active&&Tt(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function su(m,a,u){for(let g=0;g<m.length;g++)if(m[g].identifier===u)return a[g]}function Ed(m,a){return Math.log(m/a)/Math.LN2}class o_ extends Sd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,u){const g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Ed(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ed(this._distance,g),pinchAround:u}}}function Pp(m,a){return 180*m.angleWith(a)/Math.PI}class Sb extends Sd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,u){const g=this._vector;if(this._vector=a[0].sub(a[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Pp(this._vector,g),pinchAround:u}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const u=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=Pp(a,g);return Math.abs(v)<u}}function Dp(m){return Math.abs(m.y)>Math.abs(m.x)}class Eb extends Sd{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Dp(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,u,g){const v=this._lastPoints;if(!v)return;const x=a[0].sub(v[0]),T=a[1].sub(v[1]);return this._map._cooperativeGestures&&!r.ex()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,g.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(a,u,g){if(this._valid!==void 0)return this._valid;const v=a.mag()>=2,x=u.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const T=a.y>0==u.y>0;return Dp(a)&&Dp(u)&&T}}const Cb={panStep:100,bearingStep:15,pitchStep:10};class Ib{constructor(){const a=Cb;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let u=0,g=0,v=0,x=0,T=0;switch(a.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:a.shiftKey?g=-1:(a.preventDefault(),x=-1);break;case 39:a.shiftKey?g=1:(a.preventDefault(),x=1);break;case 38:a.shiftKey?v=1:(a.preventDefault(),T=-1);break;case 40:a.shiftKey?v=-1:(a.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:C=>{const M=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Mb,zoom:u?Math.round(M)+u*(a.shiftKey?2:1):M,bearing:C.getBearing()+g*this._bearingStep,pitch:C.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:C.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mb(m){return m*(2-m)}const a_=4.000244140625,Rb=1/450;class kb{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Rb,r.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||r.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const g=r.q.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,u!==0&&u%a_==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=window.setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),a.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=a,this._delta-=u,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=_t(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>a_?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&O!==0&&(O=1/O);const z=u(),L=Math.pow(2,z),V=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):L;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(V*O))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:u(),v=this._startZoom,x=this._easing;let T,C=!1;if(this._type==="wheel"&&v&&x){const D=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),O=x(D);T=r.ai(v,g,O),D<1?this._frameId||(this._frameId=!0):C=!0}else T=g,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=T-u();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let u=r.ey;if(this._prevEase){const g=this._prevEase,v=(r.q.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),T=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-T*T);u=r.ew(T,C,.25,1)}return this._prevEase={start:r.q.now(),duration:a,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Pb{constructor(a,u){this._clickZoom=a,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Db{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,u){return a.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(a.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bb{constructor(){this._tap=new qr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,u,g){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(a,u,g))}touchmove(a,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=u[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,a.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(a,u,g)}touchend(a,u,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(a,u,g)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ob{constructor(a,u,g){this._el=a,this._mousePan=u,this._touchPan=g}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class aA{constructor(a,u,g){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class lA{constructor(a,u,g,v){this._el=a,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Gn=m=>m.zoom||m.drag||m.pitch||m.rotate;class Fb extends r.A{}class cA{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,u){const g=r.at([],u,a);this.radius=r.ae(g[2]<0?r.eA([],g,this.constants):[g[0],g[1],0])}projectRay(a){r.eA(a,a,this.constants),r.au(a,a),r.eB(a,a,this.constants);const u=r.b$([],a,this.radius);if(u[2]>0){const g=r.b$([],[0,0,1],r.bE(u,[0,0,1])),v=r.b$([],r.au([],[u[0],u[1],0]),this.radius),x=r.cU([],u,r.b$([],r.at([],r.cU([],v,g),u),2));u[0]=x[0],u[1]=x[1]}return u}}function ou(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class hA{constructor(a,u){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mp(a),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cA,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),r.aV(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,x,T]of this._listeners){const C=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,C,T)}}destroy(){for(const[a,u,g]of this._listeners){const v=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(u,v,g)}}_addDefaultHandlers(a){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new dc(u,a));const v=u.boxZoom=new Rp(u,a);this._add("boxZoom",v);const x=new i_,T=new Db;u.doubleClickZoom=new Pb(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const C=new Bb;this._add("tapDragZoom",C);const M=u.touchPitch=new Eb(u);this._add("touchPitch",M);const D=new kp(a),O=new ch(a);u.dragRotate=new aA(a,D,O),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const z=new r_(a),L=new s_(u,a);u.dragPan=new Ob(g,z,L),this._add("mousePan",z),this._add("touchPan",L,["touchZoom","touchRotate"]);const V=new Sb,Y=new o_;u.touchZoomRotate=new lA(g,Y,V,C),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new e_(u));const q=u.scrollZoom=new kb(u,this);this._add("scrollZoom",q,["mousePan"]);const Q=u.keyboard=new Ib;this._add("keyboard",Q);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[Z]&&u[Z].enable(a[Z])}_add(a,u,g){this._handlers.push({handlerName:a,handler:u,allowed:g}),this._handlersById[a]=u}stop(a){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,u,g){for(const v in a)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const u=[];for(const g of a)this._el.contains(g.target)&&u.push(g);return u}handleEvent(a,u){this._updatingCamera=!0;const g=a.type==="renderFrame",v=g?void 0:a,x={needsRenderFrame:!1},T={},C={},M=a.touches?this._getMapTouches(a.touches):void 0,D=M?St(this._el,M):g?void 0:_t(this._el,a);for(const{handlerName:L,handler:V,allowed:Y}of this._handlers){if(!V.isEnabled())continue;let q;this._blockedByActive(C,Y,L)?V.reset():V[u||a.type]&&(q=V[u||a.type](a,D,M),this.mergeHandlerResult(x,T,q,L,v),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||V.isActive())&&(C[L]=V)}const O={};for(const L in this._previousActiveHandlers)C[L]||(O[L]=v);this._previousActiveHandlers=C,(Object.keys(O).length||ou(x))&&(this._changes.push([x,T,O]),this._triggerRenderFrame()),(Object.keys(C).length||ou(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=x;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(a,u,g,v,x){if(!g)return;r.l(a,g);const T={handlerName:v,originalEvent:g.originalEvent||x};g.zoomDelta!==void 0&&(u.zoom=T),g.panDelta!==void 0&&(u.drag=T),g.pitchDelta!==void 0&&(u.pitch=T),g.bearingDelta!==void 0&&(u.rotate=T)}_applyChanges(){const a={},u={},g={};for(const[v,x,T]of this._changes)v.panDelta&&(a.panDelta=(a.panDelta||new r.P(0,0))._add(v.panDelta)),v.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(a.around=v.around),v.aroundCoord!==void 0&&(a.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(a.pinchAround=v.pinchAround),v.noInertia&&(a.noInertia=v.noInertia),r.l(u,x),r.l(g,T);this._updateMapTransform(a,u,g),this._changes=[]}_updateMapTransform(a,u,g){const v=this._map,x=v.transform,T=se=>[se.x,se.y,se.z];if((se=>{const de=this._eventsInProgress.drag;return de&&!this._handlersById[de.handlerName].isActive()})()&&!ou(a)){const se=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),se!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!ou(a))return void this._fireEvents(u,g,!0);let{panDelta:C,zoomDelta:M,bearingDelta:D,pitchDelta:O,around:z,aroundCoord:L,pinchAround:V}=a;x._isCameraConstrained&&(M>0&&(M=0),x._isCameraConstrained=!1),V!==void 0&&(z=V),(M||(se=>u[se]&&!this._eventsInProgress[se])("drag"))&&z&&(this._dragOrigin=T(x.pointCoordinate3D(z)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),z=z||v.transform.centerPoint,D&&(x.bearing+=D),O&&(x.pitch+=O),x._updateCameraState();const Y=[0,0,0];if(C)if(x.projection.name==="mercator"){const se=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z).dir),de=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z.sub(C)).dir);Y[0]=de[0]-se[0],Y[1]=de[1]-se[1]}else{const se=x.pointCoordinate(z);if(x.projection.name==="globe"){C=C.rotate(-x.angle);const de=x._pixelsPerMercatorPixel/x.worldSize;Y[0]=-C.x*r.ez(r.aY(se.y))*de,Y[1]=-C.y*r.ez(x.center.lat)*de}else{const de=x.pointCoordinate(z.sub(C));se&&de&&(Y[0]=de.x-se.x,Y[1]=de.y-se.y)}}const q=x.zoom,Q=[0,0,0];if(M){const se=T(L||x.pointCoordinate3D(z)),de={dir:r.au([],r.at([],se,x._camera.position))};if(de.dir[2]<0){const me=x.zoomDeltaToMovement(se,M);r.b$(Q,de.dir,me)}}const Z=r.cU(Y,Y,Q);x._translateCameraConstrained(Z),M&&Math.abs(x.zoom-q)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(u,g,!0)}_fireEvents(a,u,g){const v=Gn(this._eventsInProgress),x=Gn(a),T={};for(const O in a){const{originalEvent:z}=a[O];this._eventsInProgress[O]||(T[`${O}start`]=z),this._eventsInProgress[O]=a[O]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(const O in T)this._fireEvent(O,T[O]);x&&this._fireEvent("move",x.originalEvent);for(const O in a){const{originalEvent:z}=a[O];this._fireEvent(O,z)}const C={};let M;for(const O in this._eventsInProgress){const{handlerName:z,originalEvent:L}=this._eventsInProgress[O];this._handlersById[z].isActive()||(delete this._eventsInProgress[O],M=u[z]||L,C[`${O}end`]=M)}for(const O in C)this._fireEvent(O,C[O]);const D=Gn(this._eventsInProgress);if(g&&(v||x)&&!D){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;O?(z(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:M})):(this._map.fire(new r.A("moveend",{originalEvent:M})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,u){this._map.fire(new r.A(a,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Fb("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const au="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Lb extends r.E{constructor(a,u){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,r.aV(["_renderFrameCallback"],this)}getCenter(){return new r.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(a,u){return this.jumpTo({center:a},u)}panBy(a,u,g){return a=r.P.convert(a).mult(-1),this.panTo(this.transform.center,r.l({offset:a},u),g)}panTo(a,u,g){return this.easeTo(r.l({center:a},u),g)}getZoom(){return this.transform.zoom}setZoom(a,u){return this.jumpTo({zoom:a},u),this}zoomTo(a,u,g){return this.easeTo(r.l({zoom:a},u),g)}zoomIn(a,u){return this.zoomTo(this.getZoom()+1,a,u),this}zoomOut(a,u){return this.zoomTo(this.getZoom()-1,a,u),this}getBearing(){return this.transform.bearing}setBearing(a,u){return this.jumpTo({bearing:a},u),this}getPadding(){return this.transform.padding}setPadding(a,u){return this.jumpTo({padding:a},u),this}rotateTo(a,u,g){return this.easeTo(r.l({bearing:a},u),g)}resetNorth(a,u){return this.rotateTo(0,r.l({duration:1e3},a),u),this}resetNorthPitch(a,u){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},a),u),this}snapToNorth(a,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,u):this}getPitch(){return this.transform.pitch}setPitch(a,u){return this.jumpTo({pitch:a},u),this}cameraForBounds(a,u){a=r.aG.convert(a);const g=u&&u.bearing||0,v=u&&u.pitch||0,x=a.getNorthWest(),T=a.getSouthEast();return this._cameraForBounds(this.transform,x,T,g,v,u)}_extendPadding(a){const u={top:0,right:0,bottom:0,left:0};return a==null?r.l({},u,this.transform.padding):typeof a=="number"?{top:a,bottom:a,right:a,left:a}:r.l({},u,a)}_extendCameraOptions(a){return(a=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,u){const g=u.max[0]-u.min[0],v=u.max[1]-u.min[1];return g/v>a.aspect?g/(2*Math.tan(.5*a.fovX)*a.aspect):v/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,u,g,v,x,T){const C=a.clone(),M=this._extendCameraOptions(T);C.bearing=v,C.pitch=x;const D=r.cd.convert(u),O=r.cd.convert(g),z=.5*(D.lat+O.lat),L=.5*(D.lng+O.lng),V=r.eC(z,L),Y=r.au([],V),q=r.au([],r.bG([],Y,[0,1,0])),Q=r.bG([],q,Y),Z=[q[0],q[1],q[2],0,Q[0],Q[1],Q[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],se=[V,r.eC(D.lat,D.lng),r.eC(O.lat,D.lng),r.eC(O.lat,O.lng),r.eC(D.lat,O.lng),r.eC(z,D.lng),r.eC(z,O.lng),r.eC(D.lat,L),r.eC(O.lat,L)];let de=r.cV.fromPoints(se.map(Ze=>[r.bE(q,Ze),r.bE(Q,Ze),r.bE(Y,Ze)]));const me=r.ad([],de.center,Z);r.eD(me)===0&&r.eE(me,0,0,1),r.au(me,me),r.b$(me,me,r.aE),C.center=r.eF(me);const Se=C.getWorldToCameraMatrix(),ve=r.bi(new Float64Array(16),Se);de=r.cV.applyTransform(de,r.az([],Se,Z));const xe=this._extendAABB(de,C,M,v);if(!xe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=xe,r.ad(me,me,Se);const ge=.5*(de.max[2]-de.min[2]),Ie=this._minimumAABBFrustumDistance(C,de),Re=r.b$([],[0,0,1],ge),Xe=r.cU(Re,me,Re),je=Ie+(C.pitch===0?0:r.bD(me,Xe)),lt=C.globeCenterInViewSpace,it=r.at([],me,[lt[0],lt[1],lt[2]]);r.au(it,it),r.b$(it,it,je);const Ct=r.cU([],me,it);r.ad(Ct,Ct,ve);const $e=r.eq/r.aE,qe=r.ae(Ct),Ue=r.c6(Math.max(qe*$e-r.eq,Number.EPSILON),0),ut=Math.min(C.zoomFromMercatorZAdjusted(Ue),M.maxZoom);return ut>.5*(r.cL+r.cx)?(C.setProjection({name:"mercator"}),C.zoom=ut,this._cameraForBounds(C,u,g,v,x,T)):{center:C.center,zoom:ut,bearing:v,pitch:x}}_extendAABB(a,u,g,v){const x=.5*((g.padding.left||0)+(g.padding.right||0)),T=.5*((g.padding.top||0)+(g.padding.bottom||0)),C=T,M=x,D=x,O=T,z=u.width-(M+D),L=u.height-(C+O),V=r.at([],a.max,a.min),Y=Math.min(z/V[0],L/V[1]),q=Math.min(u.scaleZoom(u.scale*Y),g.maxZoom);if(isNaN(q))return null;const Q=u.scale/u.zoomScale(q),Z=new r.cV([a.min[0]-M*Q,a.min[1]-O*Q,a.min[2]],[a.max[0]+D*Q,a.max[1]+C*Q,a.max[2]]),se=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new r.P(g.offset.x,g.offset.y):r.P.convert(g.offset)).rotate(-r.al(v));return Z.center[0]-=se.x*Q,Z.center[1]+=se.y*Q,Z}queryTerrainElevation(a,u){const g=this.transform.elevation;return g?(u=r.l({},{exaggerated:!0},u),g.getAtPoint(r.ac.fromLngLat(a),null,u.exaggerated)):null}_cameraForBounds(a,u,g,v,x,T){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,u,g,v,x,T);const C=a.clone(),M=this._extendCameraOptions(T);C.bearing=v,C.pitch=x;const D=r.cd.convert(u),O=r.cd.convert(g),z=new r.cd(D.lng,O.lat),L=new r.cd(O.lng,D.lat),V=C.project(D),Y=C.project(O),q=this.queryTerrainElevation(D),Q=this.queryTerrainElevation(O),Z=this.queryTerrainElevation(z),se=this.queryTerrainElevation(L),de=[[V.x,V.y,Math.min(q||0,Q||0,Z||0,se||0)],[Y.x,Y.y,Math.max(q||0,Q||0,Z||0,se||0)]];let me=r.cV.fromPoints(de);const Se=C.getWorldToCameraMatrix(),ve=r.bi(new Float64Array(16),Se);me=r.cV.applyTransform(me,Se);const xe=this._extendAABB(me,C,M,v);if(!xe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=xe;const ge=.5*r.at([],me.max,me.min)[2],Ie=this._minimumAABBFrustumDistance(C,me),Re=[0,0,1,0];r.aA(Re,Re,Se),r.eG(Re,Re);const Xe=r.b$([],Re,Ie+ge),je=r.cU([],me.center,Xe);r.ad(me.center,me.center,ve),r.ad(je,je,ve);const lt=C.unproject(new r.P(me.center[0],me.center[1])),it=r.eH(C.projection,lt),Ct=Math.pow(2,it),$e=Math.min(C._zoomFromMercatorZ(je[2]*C.pixelsPerMeter*Ct/C.worldSize),M.maxZoom);return C.mercatorFromTransition&&$e<.5*(r.cL+r.cx)?(C.setProjection({name:"globe"}),C.zoom=$e,this._cameraForBounds(C,u,g,v,x,T)):{center:lt,zoom:$e,bearing:v,pitch:x}}fitBounds(a,u,g){const v=this.cameraForBounds(a,u);return this._fitInternal(v,u,g)}fitScreenCoordinates(a,u,g,v,x){const T=r.P.convert(a),C=r.P.convert(u),M=new r.P(Math.min(T.x,C.x),Math.min(T.y,C.y)),D=new r.P(Math.max(T.x,C.x),Math.max(T.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,C))return this;const O=this.transform.pointLocation3D(M),z=this.transform.pointLocation3D(D),L=this.transform.pointLocation3D(new r.P(M.x,D.y)),V=this.transform.pointLocation3D(new r.P(D.x,M.y)),Y=[Math.min(O.lng,z.lng,L.lng,V.lng),Math.min(O.lat,z.lat,L.lat,V.lat)],q=[Math.max(O.lng,z.lng,L.lng,V.lng),Math.max(O.lat,z.lat,L.lat,V.lat)],Q=v&&v.pitch?v.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,Y,q,g,Q,v);return this._fitInternal(Z,v,x)}_fitInternal(a,u,g){return a?(u=r.l(a,u)).linear?this.easeTo(u,g):this.flyTo(u,g):this}jumpTo(a,u){this.stop();const g=a.preloadOnly?this.transform.clone():this.transform;let v=!1,x=!1,T=!1;"zoom"in a&&g.zoom!==+a.zoom&&(v=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=r.cd.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(x=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(T=!0,g.pitch=+a.pitch);const C=typeof a.padding=="number"?this._extendPadding(a.padding):a.padding;if(a.padding!=null&&!g.isPaddingEqual(C))if(a.retainPadding===!1){const M=g.clone();M.padding=C,g.setLocationAtPoint(g.center,M.centerPoint)}else g.padding=C;return a.preloadOnly?(this._preloadTiles(g),this):(this.fire(new r.A("movestart",u)).fire(new r.A("move",u)),v&&this.fire(new r.A("zoomstart",u)).fire(new r.A("zoom",u)).fire(new r.A("zoomend",u)),x&&this.fire(new r.A("rotatestart",u)).fire(new r.A("rotate",u)).fire(new r.A("rotateend",u)),T&&this.fire(new r.A("pitchstart",u)).fire(new r.A("pitch",u)).fire(new r.A("pitchend",u)),this.fire(new r.A("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(au),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return r.w(au),this;this.stop();const v=g.zoom,x=g.pitch,T=g.bearing;g.setFreeCameraOptions(a);const C=v!==g.zoom,M=x!==g.pitch,D=T!==g.bearing;return this.fire(new r.A("movestart",u)).fire(new r.A("move",u)),C&&this.fire(new r.A("zoomstart",u)).fire(new r.A("zoom",u)).fire(new r.A("zoomend",u)),D&&this.fire(new r.A("rotatestart",u)).fire(new r.A("rotate",u)).fire(new r.A("rotateend",u)),M&&this.fire(new r.A("pitchstart",u)).fire(new r.A("pitch",u)).fire(new r.A("pitchend",u)),this.fire(new r.A("moveend",u)),this}easeTo(a,u){this._stop(!1,a.easeId),((a=r.l({offset:[0,0],duration:500,easing:r.ey},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const g=this.transform,v=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),M="zoom"in a?+a.zoom:v,D="bearing"in a?this._normalizeBearing(a.bearing,x):x,O="pitch"in a?+a.pitch:T,z=this._extendPadding(a.padding),L=r.P.convert(a.offset);let V,Y,q;if(g.projection.name==="globe"){const Re=r.ac.fromLngLat(g.center),Xe=L.rotate(-g.angle);Re.x+=Xe.x/g.worldSize,Re.y+=Xe.y/g.worldSize;const je=Re.toLngLat(),lt=r.cd.convert(a.center||je);this._normalizeCenter(lt),V=g.centerPoint.add(Xe),Y=new r.P(Re.x,Re.y).mult(g.worldSize),q=new r.P(r.ay(lt.lng),r.aH(lt.lat)).mult(g.worldSize).sub(Y)}else{V=g.centerPoint.add(L);const Re=g.pointLocation(V),Xe=r.cd.convert(a.center||Re);this._normalizeCenter(Xe),Y=g.project(Re),q=g.project(Xe).sub(Y)}const Q=g.zoomScale(M-v);let Z,se;a.around&&(Z=r.cd.convert(a.around),se=g.locationPoint(Z));const de=this._zooming||M!==v,me=this._rotating||x!==D,Se=this._pitching||O!==T,ve=!g.isPaddingEqual(z),xe=a.retainPadding===!1?g.clone():g,ge=Re=>Xe=>{if(de&&(Re.zoom=r.ai(v,M,Xe)),me&&(Re.bearing=r.ai(x,D,Xe)),Se&&(Re.pitch=r.ai(T,O,Xe)),ve&&(xe.interpolatePadding(C,z,Xe),V=xe.centerPoint.add(L)),Z)Re.setLocationAtPoint(Z,se);else{const je=Re.zoomScale(Re.zoom-v),lt=M>v?Math.min(2,Q):Math.max(.5,Q),it=Math.pow(lt,1-Xe),Ct=Re.unproject(Y.add(q.mult(Xe*it)).mult(je));Re.setLocationAtPoint(Re.renderWorldCopies?Ct.wrap():Ct,V)}return a.preloadOnly||this._fireMoveEvents(u),Re};if(a.preloadOnly){const Re=this._emulate(ge,a.duration,g);return this._preloadTiles(Re),this}const Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=de,this._rotating=me,this._pitching=Se,this._padding=ve,this._easeId=a.easeId,this._prepareEase(u,a.noMoveStart,Ie),this._ease(ge(g),Re=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(u,Re)},a),this}_prepareEase(a,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||g.moving||this.fire(new r.A("movestart",a)),this._zooming&&!g.zooming&&this.fire(new r.A("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new r.A("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new r.A("pitchstart",a))}_fireMoveEvents(a){this.fire(new r.A("move",a)),this._zooming&&this.fire(new r.A("zoom",a)),this._rotating&&this.fire(new r.A("rotate",a)),this._pitching&&this.fire(new r.A("pitch",a))}_afterEase(a,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new r.A("zoomend",a)),v&&this.fire(new r.A("rotateend",a)),x&&this.fire(new r.A("pitchend",a)),this.fire(new r.A("moveend",a))}flyTo(a,u){if(this._prefersReducedMotion(a)){const Ze=r.aF(a,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ze,u)}this.stop(),a=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.ey},a);const g=this.transform,v=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),M="zoom"in a?r.aD(+a.zoom,g.minZoom,g.maxZoom):v,D="bearing"in a?this._normalizeBearing(a.bearing,x):x,O="pitch"in a?+a.pitch:T,z=this._extendPadding(a.padding),L=g.zoomScale(M-v),V=r.P.convert(a.offset);let Y=g.centerPoint.add(V);const q=g.pointLocation(Y),Q=r.cd.convert(a.center||q);this._normalizeCenter(Q);const Z=g.project(q),se=g.project(Q).sub(Z);let de=a.curve;const me=Math.max(g.width,g.height),Se=me/L,ve=se.mag();if("minZoom"in a){const Ze=r.aD(Math.min(a.minZoom,v,M),g.minZoom,g.maxZoom),gt=me/g.zoomScale(Ze-v);de=Math.sqrt(gt/ve*2)}const xe=de*de;function ge(Ze){const gt=(Se*Se-me*me+(Ze?-1:1)*xe*xe*ve*ve)/(2*(Ze?Se:me)*xe*ve);return Math.log(Math.sqrt(gt*gt+1)-gt)}function Ie(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Re(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Xe=ge(0);let je=function(Ze){return Re(Xe)/Re(Xe+de*Ze)},lt=function(Ze){return me*((Re(Xe)*(Ie(gt=Xe+de*Ze)/Re(gt))-Ie(Xe))/xe)/ve;var gt},it=(ge(1)-Xe)/de;if(Math.abs(ve)<1e-6||!isFinite(it)){if(Math.abs(me-Se)<1e-6)return this.easeTo(a,u);const Ze=Se<me?-1:1;it=Math.abs(Math.log(Se/me))/de,lt=function(){return 0},je=function(gt){return Math.exp(Ze*de*gt)}}a.duration="duration"in a?+a.duration:1e3*it/("screenSpeed"in a?+a.screenSpeed/de:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Ct=x!==D,$e=O!==T,qe=!g.isPaddingEqual(z),Ue=a.retainPadding===!1?g.clone():g,ut=Ze=>gt=>{const ct=gt*it,yt=1/je(ct);Ze.zoom=gt===1?M:v+Ze.scaleZoom(yt),Ct&&(Ze.bearing=r.ai(x,D,gt)),$e&&(Ze.pitch=r.ai(T,O,gt)),qe&&(Ue.interpolatePadding(C,z,gt),Y=Ue.centerPoint.add(V));const vt=gt===1?Q:Ze.unproject(Z.add(se.mult(lt(ct))).mult(yt));return Ze.setLocationAtPoint(Ze.renderWorldCopies?vt.wrap():vt,Y),Ze._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(u),Ze};if(a.preloadOnly){const Ze=this._emulate(ut,a.duration,g);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=Ct,this._pitching=$e,this._padding=qe,this._prepareEase(u,!1),this._ease(ut(g),()=>this._afterEase(u),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!a){const g=this.handlers;g&&g.stop(!1)}return this}_ease(a,u,g){g.animate===!1||g.duration===0?(a(1),u()):(this._easeStart=r.q.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,u){a=r.bX(a,-180,180);const g=Math.abs(a-u);return Math.abs(a-360-u)<g&&(a-=360),Math.abs(a+360-u)<g&&(a+=360),a}_normalizeCenter(a){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const g=a.lng-u.center.lng;a.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,u,g){const v=Math.ceil(15*u/1e3),x=[],T=a(g.clone());for(let C=0;C<=v;C++){const M=T(C/v);x.push(M.clone())}return x}_preloadTiles(a,u){}}class Bp{constructor(a={}){this.options=a,r.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const u=this.options&&this.options.compact,g=a._getUIString("AttributionControl.ToggleAttribution");this._map=a,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const v=W("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",g),this._innerContainer=W("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(a){const g=u.reduce((v,x,T)=>(x.value&&(v+=`${x.key}=${x.value}${T<u.length-1?"&":""}`),v),"?");a.href=`${r.e.FEEDBACK_URL}/${g}#${Ip(this._map,!0)}`,a.rel="noopener nofollow"}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._mergedSourceCaches;for(const v in u){const x=u[v];if(x.used){const T=x.getSource();T.attribution&&a.indexOf(T.attribution)<0&&a.push(T.attribution)}}a.sort((v,x)=>v.length-x.length),a=a.filter((v,x)=>{for(let T=x+1;T<a.length;T++)if(a[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const g=a.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,a.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Cd{constructor(){r.aV(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=W("div","mapboxgl-ctrl");const u=W("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const u in a){const g=a[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Ja{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const u=++this._id;return this._queue.push({callback:a,id:u,cancelled:!1}),u}remove(a){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const v of g)if(v.id===a)return void(v.cancelled=!0)}run(a=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Op{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const u=r.dk((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,u,g){this._start=this.getValue(u),this._end=a,this._startTime=u,this._endTime=u+g}}const Ar={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ya extends r.A{constructor(a,u,g,v){const{point:x,lngLat:T,originalEvent:C,target:M}=a;super(a.type,{point:x,lngLat:T,originalEvent:C,target:M}),this.preventDefault=()=>{a.preventDefault()},this.id=u,this.interaction=g,this.feature=v}}class Id{constructor(a){this.map=a,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(a,u){if(this.typeById.has(a))throw new Error(`Interaction id "${a}" already exists.`);const g=u.filter;let v=u.type;g&&this.filters.set(a,r.b3(g)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const x=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(a,u)):x.size===0&&this.map.on(v,this.handleType),x.size===0&&this.interactionsByType.set(v,x),x.set(a,u),this.typeById.set(a,v)}get(a){const u=this.typeById.get(a);if(!u)return;const g=this.interactionsByType.get(u);return g?g.get(a):void 0}remove(a){const u=this.typeById.get(a);if(!u)return;this.typeById.delete(a),this.filters.delete(a);const g=this.interactionsByType.get(u);g&&(g.delete(a),u==="mouseenter"||u==="mouseleave"?(this.delegatedInteractions.delete(a),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(u,this.handleType))}queryTargets(a,u){const g=[];for(const[v,x]of u)x.target&&g.push({targetId:v,target:x.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(a,g,this.map.transform)}handleMove(a){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const u=this.queryTargets(a.point,Array.from(this.delegatedInteractions).reverse());u.length&&(a.type="mouseenter",this.handleType(a,u));const g=new Map;for(const[v,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||g.set(x.id,x);g.size&&(a.type="mouseleave",this.handleType(a,Array.from(g.values())))}handleOut(a){const u=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);u.length&&(a.type="mouseleave",this.handleType(a,u)),this.hoveredFeatures.clear()}handleType(a,u){const g=Array.from(this.interactionsByType.get(a.type)).reverse(),v=!!u;u=u||this.queryTargets(a.point,g);const x=a.type==="mouseenter";let T=!1;const C=new Set;for(const M of u){for(const[D,O]of g){if(!O.target)continue;const z=M.variants?M.variants[D]:null;if(z){for(const L of z){if(Xu(L,M,C,D))continue;const V=new r.df(M,L),Y=Lf(L,M,D);v&&(V.state=this.map.getFeatureState(V));const q=x?this.prevHoveredFeatures.get(Y):null,Q=new ya(a,D,O,V),Z=q?q.stop:O.handler(Q);if(x&&this.hoveredFeatures.set(Y,{feature:M,stop:Z}),Z!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[M,D]of g){const{handler:O,target:z}=D;if(!z&&O(new ya(a,M,D,null))!==!1)break}}}function Fp(m,a){if(Array.isArray(m)&&Array.isArray(a)){const u=new Set(m),g=new Set(a);return u.size===g.size&&m.every(v=>g.has(v))}return r.bv(m,a)}const zb={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},uA={showCompass:!0,showZoom:!0,visualizePitch:!1};class Md{constructor(a,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new kp({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,g&&(this.mousePitch=new ch({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),r.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(a,u){this.mouseRotate.mousedown(a,u),this.mousePitch&&this.mousePitch.mousedown(a,u),Ee()}move(a,u){const g=this.map,v=this.mouseRotate.mousemoveWindow(a,u),x=v&&v.bearingDelta;if(x&&g.setBearing(g.getBearing()+x),this.mousePitch){const T=this.mousePitch.mousemoveWindow(a,u),C=T&&T.pitchDelta;C&&g.setPitch(g.getPitch()+C)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Le(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(r.l({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),_t(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,_t(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=St(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=St(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Nb(m,a,u){if(m=new r.cd(m.lng,m.lat),a){const g=new r.cd(m.lng-360,m.lat),v=new r.cd(m.lng+360,m.lat),x=360*Math.ceil(Math.abs(m.lng-u.center.lng)/360),T=u.locationPoint3D(m).distSqr(a),C=a.x<0||a.y<0||a.x>u.width||a.y>u.height;u.locationPoint3D(g).distSqr(a)<T&&(C||Math.abs(g.lng-u.center.lng)<x)?m=g:u.locationPoint3D(v).distSqr(a)<T&&(C||Math.abs(v.lng-u.center.lng)<x)&&(m=v)}for(;Math.abs(m.lng-u.center.lng)>180;){const g=u.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const l_={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Yo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Rd extends r.E{constructor(a,u){super(),(a instanceof HTMLElement||u)&&(a=r.l({element:a},u)),r.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:v="#3FB1CE",scale:x=1,draggable:T=!1,clickTolerance:C=0,rotation:M=Yo.rotation,rotationAlignment:D=Yo.rotationAlignment,pitchAlignment:O=Yo.pitchAlignment,occludedOpacity:z=Yo.occludedOpacity,altitude:L=Yo.altitude}=a||{};this._anchor=g,this._color=v,this._scale=x,this._draggable=T,this._clickTolerance=C,this._rotation=M,this._rotationAlignment=D,this._pitchAlignment=O,this._occludedOpacity=z,this._altitude=L,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),a&&a.element?(this._element=a.element,this._offset=r.P.convert(a&&a.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(a&&a.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",q=>{q.preventDefault()}),this._element.addEventListener("mousedown",q=>{q.preventDefault()});const V=this._element.classList;for(const q in l_)V.remove(`mapboxgl-marker-anchor-${q}`);V.add(`mapboxgl-marker-anchor-${this._anchor}`);const Y=a&&a.className?a.className.trim().split(/\s+/):[];V.add(...Y),this._popup=null}_createDefaultMarker(){const a=W("div"),u=ne("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},a);if(this._altitude===0){const g=ne("radialGradient",{id:"shadowGradient"},ne("defs",{},u));ne("stop",{offset:"10%","stop-opacity":.4},g),ne("stop",{offset:"100%","stop-opacity":.05},g),ne("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u)}return ne("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),ne("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),ne("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),a}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=r.cd.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(a){return a===this._altitude||(this._defaultMarker&&(this._altitude===0&&a!==0||this._altitude!==0&&a===0)&&(this._element=this._createDefaultMarker()),this._altitude=a||Yo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,a._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const u=a.code,g=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(a){const u=a.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,u=this._pos;if(!a||!u)return!1;const g=a.unproject(u,this._altitude),v=a.getFreeCameraOptions();if(!v.position)return!1;const x=v.position.toLngLat();return x.distanceTo(g)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const u=this._pos;if(!u||u.x<0||u.x>a.transform.width||u.y<0||u.y>a.transform.height)return void this._clearFadeTimer();const g=a.unproject(u,this._altitude);let v;a._showingGlobe()&&r.eK(a.transform,this._lngLat)?v=0:(v=1-a._queryFogOpacity(g),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${l_[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const a=this._pos,u=this._map,g=this.getPitchAlignment();if(!u||!a||g!=="map")return"";if(!u._showingGlobe()){const M=u.getPitch();return M?`rotateX(${M}deg)`:""}const v=r.cJ(r.eL(u.transform,this._lngLat)),x=a.sub(r.eM(u.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";const C=v/T;return`rotateX(${-x.y*C}deg) rotateY(${x.x*C}deg)`}_calculateZTransform(){const a=this._pos,u=this._map;if(!u||!a)return"";let g=0;const v=this.getRotationAlignment();if(v==="map")if(u._showingGlobe()){const x=u.project(new r.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=u.project(new r.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);g=r.cJ(Math.atan2(T.y,T.x))-90}else g=-u.getBearing();else if(v==="horizon"){const x=r.af(4,6,u.getZoom()),T=r.eM(u.transform);T.y+=x*u.transform.height;const C=a.sub(T),M=r.cJ(Math.atan2(C.y,C.x));g=(M>90?M-270:M+90)*(1-x)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Nb(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat,this._altitude),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=r.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){const u=this._map;if(!u)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const x=this._clickTolerance||u._clickTolerance;if(a.point.dist(g)<x)return;this._isDragging=!0}this._pos=a.point.sub(v),this._lngLat=u.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.A("dragstart"))),this.fire(new r.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.A("dragend")),this._state="inactive"}_addDragHandler(a){const u=this._map,g=this._pos;u&&g&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(g),this._pointerdownPos=a.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const u=this._map;return u&&(a?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||Yo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||Yo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||Yo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||Yo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const kd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},lu={maxWidth:100,unit:"metric"},Sl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ba={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},va=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pc(m=new r.P(0,0),a="bottom"){if(typeof m=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(a){case"top":return new r.P(0,m);case"top-left":return new r.P(u,u);case"top-right":return new r.P(-u,u);case"bottom":return new r.P(0,-m);case"bottom-left":return new r.P(u,-u);case"bottom-right":return new r.P(-u,-u);case"left":return new r.P(m,0);case"right":return new r.P(-m,0)}return new r.P(0,0)}return m instanceof r.P||Array.isArray(m)?r.P.convert(m):r.P.convert(m[a]||[0,0])}return{version:b,supported:X.supported,setRTLTextPlugin:r.eN,getRTLTextPluginStatus:r.eO,Map:class extends Lb{constructor(m){E.mark(w.create);const a=m;if((m=r.l({},zb,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&r.eI(window)&&(m.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Xc(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Ja,this._domRenderTaskQueue=new Ja,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.a$(),this._locale=r.l({},Ar,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Op(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new ii(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const u=document.getElementById(m.container);if(!u)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=u}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,r.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Xg),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new hA(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||r.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new H0(this),m.hash&&(this._hash=new iu(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const u=m.bounds;u&&(this.resize(),this.fitBounds(u,r.l({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Bp({customAttribution:m.customAttribution})),this._logoControl=new Cd,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new r.A(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new r.A(`${u.dataType}dataloading`,u))}),this._interactions=new Id(this)}_getMapId(){return this._mapId}addControl(m,a){if(a===void 0&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new r.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[a];return a.indexOf("bottom")!==-1?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new r.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new r.A("movestart",m)).fire(new r.A("move",m)),this.fire(new r.A("resize",m)),a&&this.fire(new r.A("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(r.aG.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(a=>a.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(a=>a==="auto"?navigator.language:a):m}setLanguage(m){const a=this._parseLanguage(m);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,a=m.projection.name;let u;a==="globe"&&m.zoom>=r.cx?(m.setMercatorFromTransition(),u=!0):a==="mercator"&&m.zoom<r.cx&&(m.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,a){return this._updateProjection(m||a||{name:"mercator"})}_updateProjection(m){let a;return a=m.name==="globe"&&this.transform.zoom>=r.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),a&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,a){return this.transform.locationPoint3D(r.cd.convert(m),a)}unproject(m,a){return this.transform.pointLocation3D(r.P.convert(m),a)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,a,u){const g=v=>{let x=[];if(Array.isArray(a)){const T=a.filter(C=>this.getLayer(C));x=T.length?this.queryRenderedFeatures(v,{layers:T}):[]}else x=this.queryRenderedFeatures(v,{target:a});return x};if(m==="mouseenter"||m==="mouseover"){let v=!1;return{listener:u,targets:a,delegates:{mousemove:T=>{const C=g(T.point);C.length?v||(v=!0,u.call(this,new no(m,this,T.originalEvent,{features:C}))):v=!1},mouseout:()=>{v=!1}}}}if(m==="mouseleave"||m==="mouseout"){let v=!1;return{listener:u,targets:a,delegates:{mousemove:C=>{g(C.point).length?v=!0:v&&(v=!1,u.call(this,new no(m,this,C.originalEvent)))},mouseout:C=>{v&&(v=!1,u.call(this,new no(m,this,C.originalEvent)))}}}}{const v=x=>{const T=g(x.point);T.length&&(x.features=T,u.call(this,x),delete x.features)};return{listener:u,targets:a,delegates:{[m]:v}}}}on(m,a,u){if(typeof a=="function"||u===void 0)return super.on(m,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const g=this._createDelegatedListener(m,a,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,a,u){if(typeof a=="function"||u===void 0)return super.once(m,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const g=this._createDelegatedListener(m,a,u);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,a,u){if(typeof a=="function"||u===void 0)return super.off(m,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(v=>{for(let x=0;x<v.length;x++){const T=v[x];if(T.listener===u&&Fp(T.targets,a)){for(const C in T.delegates)this.off(C,T.delegates[C]);return v.splice(x,1),this}}})(g),this}queryRenderedFeatures(m,a){if(!this.style)return[];if(m===void 0||m instanceof r.P||Array.isArray(m)||a!==void 0||(a=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!a){const x=this.style.queryRenderedFeatures(m,void 0,this.transform),T=this.style.queryRenderedFeatureset(m,void 0,this.transform);return x.concat(T)}let u=!0;if(a.target&&(u=this._isTargetValid(a.target),u&&!a.layers))return this.style.queryRenderedFeatureset(m,a,this.transform);let g=!0;if(a.layers&&Array.isArray(a.layers)){for(const x of a.layers)if(!this._isValidId(x)){g=!1;break}if(g&&!a.target)return this.style.queryRenderedFeatures(m,a,this.transform)}let v=[];return g&&(v=v.concat(this.style.queryRenderedFeatures(m,a,this.transform))),u&&(v=v.concat(this.style.queryRenderedFeatureset(m,a,this.transform))),v}querySourceFeatures(m,a){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,a)}isPointOnSurface(m){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&r.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(m))}addInteraction(m,a){return this._interactions.add(m,a),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,a){return a=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&m&&a.diff!==!1&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(m,(u,g)=>{if(u){const v=typeof u=="string"?u:u instanceof Error?u.message:u.error;r.w(`Unable to perform style diff: ${v}. Rebuilding the style from scratch.`),this._updateStyle(m,a)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(m,a))}_getUIString(m){const a=this._locale[m];if(a==null)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const u=r.l({},a);a&&a.config&&(u.initialConfig=a.config,delete u.config),this.style=new Go(this,u).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Go(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new r.z(new Error("IDs can't be empty."))),!1):!r.d9(m)||(this.fire(new r.z(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const a of m)if(!this._isValidId(a))return!1;return!0}return this._isTargetValid(m)}addSource(m,a){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,a,u){this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,u)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,a,{pixelRatio:u=1,sdf:g=!1,stretchX:v,stretchY:x,content:T}={}){this._lazyInitEmptyStyle();const C=r.I.from(m);if(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){const{width:M,height:D,data:O}=r.q.getImageData(a);this.style.addImage(C,{data:new r.r({width:M,height:D},O),pixelRatio:u,stretchX:v,stretchY:x,content:T,sdf:g,version:0,usvg:!1})}else if(a.width===void 0||a.height===void 0)this.fire(new r.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:D}=a,O=a;this.style.addImage(C,{data:new r.r({width:M,height:D},new Uint8Array(O.data)),pixelRatio:u,stretchX:v,stretchY:x,content:T,sdf:g,usvg:!1,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m)}}updateImage(m,a){this._lazyInitEmptyStyle();const u=r.I.from(m),g=this.style.getImage(u);if(!g)return void this.fire(new r.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?r.q.getImageData(a):a,{width:x,height:T,data:C}=v;if(x===void 0||T===void 0)return void this.fire(new r.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||T!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new r.z(new Error(`The width and height of the updated image (${x}, ${T})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const M=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);let D=!1;g.usvg?(g.data=new r.r({width:x,height:T},new Uint8Array(C)),g.usvg=!1,g.icon=void 0,D=!0):g.data.replace(C,M),this.style.updateImage(u,g,D)}hasImage(m){return m?!!this.style&&!!this.style.getImage(r.I.from(m)):(this.fire(new r.z(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(r.I.from(m))}loadImage(m,a){r.o(this._requestManager.transformRequest(m,r.R.Image),(u,g)=>{a(u,g instanceof HTMLImageElement?r.q.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,a){this._lazyInitEmptyStyle(),this.style.addModel(m,a)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new r.z(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,a){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)):this}getSlot(m){const a=this.getLayer(m);return a&&a.slot||null}setSlot(m,a){return this.style.setSlot(m,a),this.style.mergeLayers(),this._update(!0)}addImport(m,a){return this.style.addImport(m,a).catch(u=>this.fire(new r.z(new Error("Failed to add import",u)))),this}updateImport(m,a){return typeof a!="string"&&a.id!==m?(this.removeImport(m),this.addImport(a)):(this.style.updateImport(m,a),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,a){return this.style.moveImport(m,a),this._update(!0)}moveLayer(m,a){return this._isValidId(m)?(this.style.moveLayer(m,a),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const a=this.style.getOwnLayer(m);return a?a.type==="custom"?a.implementation:a.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,a,u){return this._isValidId(m)?(this.style.setLayerZoomRange(m,a,u),this._update(!0)):this}setFilter(m,a,u={}){return this._isValidId(m)?(this.style.setFilter(m,a,u),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,a,u,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,a,u,g),this._update(!0)):this}getPaintProperty(m,a){return this._isValidId(m)?this.style.getPaintProperty(m,a):null}setLayoutProperty(m,a,u,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,a,u,g),this._update(!0)):this}getLayoutProperty(m,a){return this._isValidId(m)?this.style.getLayoutProperty(m,a):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,a){return this.style.setSchema(m,a),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,a){return this.style.setConfig(m,a),this._update(!0)}getConfigProperty(m,a){return this.style.getConfigProperty(m,a)}setConfigProperty(m,a,u){return this.style.setConfigProperty(m,a,u),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const a=m[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,a){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,a),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.cd.convert(m),this.transform):0}setFeatureState(m,a){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,a),this._update())}removeFeatureState(m,a){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,a),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let u,g,v,x=this._container;for(;x&&(!g||!v);){const T=window.getComputedStyle(x).transform;T&&T!=="none"&&(u=T.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(g=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(v=u[3])),x=x.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=v?Math.abs(a/v):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=W("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=W("div","mapboxgl-canvas-container",m);this._canvas=W("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=W("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{g[v]=W("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a){const u=r.q.devicePixelRatio||1;this._canvas.width=u*Math.ceil(m),this._canvas.height=u*Math.ceil(a),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const a=this._markers.indexOf(m);a!==-1&&this._markers.splice(a,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const a=this._popups.indexOf(m);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const m=r.l({},X.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",m);a?(fs(a,!0),this.painter=new Cp(a,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(a)):this.fire(new r.z(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.A("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.A("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let a;this.fire(new r.A("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,g=r.q.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=v.createQuery(),v.beginQuery(u.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,O=this.transform.pitch,z=r.q.now(),L=new r.aa(D,{now:z,fadeDuration:x,pitch:O,transition:this.style.transition});this.style.update(L)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(g);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,E.mark(w.load),this.fire(new r.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const D=r.q.now()-g;v.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const O=v.getQueryParameter(a,v.QUERY_RESULT)/1e6;v.deleteQuery(a),this.fire(new r.A("gpu-timing-frame",{cpuTime:D,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(D);this.fire(new r.A("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(D);this.fire(new r.A("gpu-timing-deferred-render",{gpuTime:O}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(M||this._repaint)this.triggerRepaint();else{const D=this.idle();if(D&&(T=this._updateAverageElevation(g,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new r.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new r.A("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,E.mark(w.fullLoad),this._performanceMetricsCollection&&go(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const a of this._markers)m&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!m||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(m,a=!1){const u=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(a||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const v=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;const T=Math.abs(v-x);if(T>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(x),u(x);this._averageElevation.easeTo(x,m,300)}else if(T>1e-4)return this._averageElevation.jumpTo(x),u(x)}return!!this._averageElevation.isEasing(m)&&u(this._averageElevation.getValue(m))}_authenticate(){Yl(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===bi||m.status===401)){const a=this.painter.context.gl;fs(a,!1),this._logoControl instanceof Cd&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Is(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&cn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function v(x){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,x,0);const T=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,T),T}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),a.canvasCopies.map(v),a.timeStamps)}_canvasPixelComparison(m,a,u){let g=u[1]-u[0];const v=m.length/4;for(let x=0;x<a.length;x++){const T=a[x];let C=0;for(let M=0;M<T.length;M+=4)T[M]===m[M]&&T[M+1]===m[M+1]&&T[M+2]===m[M+2]&&T[M+3]===m[M+3]&&(C+=1);g+=(u[x+2]-u[x+1])*(1-C/v)}return g}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),aa.delete(this.painter.context.gl),jn.remove(),mo.remove(),this._removed=!0,this.fire(new r.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=r.q.frame(a=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(a)}))}_preloadTiles(m){const a=this.style?this.style.getSourceCaches():[];return r.bt(a,(u,g)=>u._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,a){r.eJ(m,a)}get version(){return b}},NavigationControl:class{constructor(m={}){this.options=r.l({},uA,m),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(r.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),W("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),W("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:a}):u.resetNorth({},{originalEvent:a}))}),this._compassIcon=W("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const a=m.getZoom(),u=a===m.getMaxZoom(),g=a===m.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Md(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,a){const u=W("button",m,this._container);return u.type="button",u.addEventListener("click",a),u}_setButtonTitle(m,a){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${a}`);m.setAttribute("aria-label",u),m.firstElementChild&&m.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends r.E{constructor(m={}){super();const a=navigator.geolocation;this.options=r.l({geolocation:a},kd,m),r.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ah(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const a=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,m(u)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>a(u.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),u=m.coords;return!!a&&(u.longitude<a.getWest()||u.longitude>a.getEast()||u.latitude<a.getSouth()||u.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new r.A("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("geolocate",m)),this._finish()}}_updateCamera(m){const a=new r.cd(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,g=this._map.getBearing(),v=r.l({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(u),v,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new r.cd(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,a=r.c6(1,m._center.lat)*m.worldSize,u=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=W("button","mapboxgl-ctrl-geolocate",this._container),W("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W("div","mapboxgl-user-location"),this._dotElement.appendChild(W("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(W("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Rd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=W("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.A("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bp,ScaleControl:class{constructor(m={}){this.options=r.l({},lu,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,a=this._map,u=a._containerHeight/2,g=a._containerWidth/2-m/2,v=a.unproject([g,u]),x=a.unproject([g+m,u]),T=v.distanceTo(x);if(this.options.unit==="imperial"){const C=3.2808*T;C>5280?this._setScale(m,C/5280,"mile"):this._setScale(m,C,"foot")}else this.options.unit==="nautical"?this._setScale(m,T/1852,"nautical-mile"):T>=1e3?this._setScale(m,T/1e3,"kilometer"):this._setScale(m,T,"meter")}_setScale(m,a,u){this._map._requestDomTask(()=>{const g=function(x){const T=Math.pow(10,`${Math.floor(x)}`.length-1);let C=x/T;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(M){const D=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*D)/D}(C),T*C}(a),v=g/a;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(g):`${g}&nbsp;${Sl[u]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:r.w("Full screen control 'container' must be a DOM element.")),r.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=W("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(m){super(),this.options=r.l(Object.create(ba),m),this._altitude=this.options.altitude,r.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new r.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new r.A("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=r.cd.convert(m),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const a=document.createDocumentFragment(),u=document.createElement("body");let g;for(u.innerHTML=m;g=u.firstChild,g;)a.appendChild(g);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=W("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(m),this.options.closeButton){const u=this._closeButton=W("button","mapboxgl-popup-close-button",a);u.type="button",u.setAttribute("aria-label","Close popup"),u.innerHTML='<span aria-hidden="true">&#215;</span>',u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let a;return this._classList.delete(m)?a=!1:(this._classList.add(m),a=!0),this._updateClassList(),a}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const a=this._map,u=this._container,g=this._pos;if(!a||!u||!g)return"bottom";const v=u.offsetWidth,x=u.offsetHeight,T=g.x<v/2,C=g.x>a.transform.width-v/2;if(g.y+m<x)return T?"top-left":C?"top-right":"top";if(g.y>a.transform.height-x){if(T)return"bottom-left";if(C)return"bottom-right"}return T?"left":C?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),m.className=a.join(" ")}_update(m){const a=this._map,u=this._content;if(!a||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=W("div","mapboxgl-popup",a.getContainer()),this._tip=W("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Nb(this._lngLat,this._pos,a.transform)),!this._trackPointer||m){const v=this._pos=this._trackPointer&&m instanceof r.P?m:a.project(this._lngLat,this._altitude),x=pc(this.options.offset),T=this._anchor=this._getAnchor(x.y),C=pc(this.options.offset,T),M=v.add(C).round();a._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${l_[T]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&a._showingGlobe()){const v=r.eK(a.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(va);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Rd,Style:Go,LngLat:r.cd,LngLatBounds:r.aG,Point:r.P,MercatorCoordinate:r.ac,FreeCameraOptions:qf,Evented:r.E,config:r.e,prewarm:r.eP,clearPrewarmedResources:r.eQ,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(m){r.e.ACCESS_TOKEN=m},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(m){r.e.API_URL=m},get workerCount(){return r.eR.workerCount},set workerCount(m){r.eR.workerCount=m},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){r.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){r.eS(m)},get workerUrl(){return r.eT.workerUrl},set workerUrl(m){r.eT.workerUrl=m},get workerClass(){return r.eT.workerClass},set workerClass(m){r.eT.workerClass=m},get workerParams(){return r.eT.workerParams},set workerParams(m){r.eT.workerParams=m},get dracoUrl(){return r.eU()},set dracoUrl(m){r.eV(m)},get meshoptUrl(){return r.eW()},set meshoptUrl(m){r.eX(m)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var f=s;return f})}(Px)),Px.exports}var KH=ZH();const Qp=qH(KH);async function oF(i,e,t,n){return n._parse(i,e,t,n)}function Ah(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const bw=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Mk=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Mk&&parseFloat(Mk[1]);const Vv=globalThis,em=globalThis.process||{},JH=globalThis.navigator||{};function aF(i){var n,s;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Df(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||aF()}function QH(i){return Df()?aF()?"Electron":(JH.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const lF="4.1.0";function e9(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class t9{constructor(e,t,n="sessionStorage"){this.storage=e9(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function i9(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function n9(i,e=8){const t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}var s1;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(s1||(s1={}));const r9=10;function Rk(i){return typeof i!="string"?i:(i=i.toUpperCase(),s1[i]||s1.WHITE)}function s9(i,e,t){return!Df&&typeof i=="string"&&(e&&(i=`\x1B[${Rk(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${Rk(t)+r9}m${i}\x1B[49m`)),i}function o9(i,e=["constructor"]){const t=Object.getPrototypeOf(i),n=Object.getOwnPropertyNames(t),s=i;for(const c of n){const f=s[c];typeof f=="function"&&(e.find(r=>c===r)||(s[c]=f.bind(i)))}}function WE(i,e){if(!i)throw new Error("Assertion failed")}function tm(){var e,t,n;let i;if(Df()&&Vv.performance)i=(t=(e=Vv==null?void 0:Vv.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in em){const s=(n=em==null?void 0:em.hrtime)==null?void 0:n.call(em);i=s[0]*1e3+s[1]/1e6}else i=Date.now();return i}const im={debug:Df()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},a9={enabled:!0,level:0};function nm(){}const kk={},Pk={once:!0};class T0{constructor({id:e}={id:""}){this.VERSION=lF,this._startTs=tm(),this._deltaTs=tm(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new t9(`__probe-${this.id}__`,a9),this.timeStamp(`${this.id} started`),o9(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((tm()-this._startTs).toPrecision(10))}getDelta(){return Number((tm()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,im.warn,arguments,Pk)}error(e){return this._getLogFunction(0,e,im.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,im.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,im.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,im.debug||im.info,arguments,Pk)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||nm,n&&[n],{tag:c9(t)}):nm}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||nm)}group(e,t,n={collapsed:!1}){const s=Dk({logLevel:e,message:t,opts:n}),{collapsed:c}=n;return s.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||nm)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=cF(e)}_getLogFunction(e,t,n,s,c){if(this._shouldLog(e)){c=Dk({logLevel:e,message:t,args:s,opts:c}),n=n||c.method,WE(n),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=tm();const f=c.tag||c.message;if(c.once&&f)if(!kk[f])kk[f]=tm();else return nm;return t=l9(this.id,c.message,c),n.bind(console,t,...c.args)}return nm}}T0.VERSION=lF;function cF(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return WE(Number.isFinite(e)&&e>=0),e}function Dk(i){const{logLevel:e,message:t}=i;i.logLevel=cF(e);const n=i.args?Array.from(i.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const s=typeof i.message;return WE(s==="string"||s==="object"),Object.assign(i,{args:n},i.opts)}function l9(i,e,t){if(typeof e=="string"){const n=t.time?n9(i9(t.total)):"";e=t.time?`${i}: ${n}  ${e}`:`${i}: ${e}`,e=s9(e,t.color,t.background)}return e}function c9(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const WT="4.3.2",h9=WT[0]>="0"&&WT[0]<="9"?`v${WT}`:"";function u9(){const i=new T0({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=i,globalThis.loaders.version=h9,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=i,i}const d9=u9();function f9(i,e){return hF(i||{},e)}function hF(i,e,t=0){if(t>3)return e;const n={...i};for(const[s,c]of Object.entries(e))c&&typeof c=="object"&&!Array.isArray(c)?n[s]=hF(n[s]||{},e[s],t+1):n[s]=e[s];return n}function p9(i){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,i)}function m9(i){var t,n;return((n=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:n[i])||null}const g9="latest";function _9(){var i;return(i=globalThis._loadersgl_)!=null&&i.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const uF=_9();function Th(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const al=typeof process!="object"||String(process)!=="[object process]"||process.browser,GE=typeof importScripts=="function",y9=typeof window<"u"&&typeof window.orientation<"u",Bk=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Bk&&parseFloat(Bk[1]);class b9{constructor(e,t){ce(this,"name");ce(this,"workerThread");ce(this,"isRunning",!0);ce(this,"result");ce(this,"_resolve",()=>{});ce(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((n,s)=>{this._resolve=n,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Th(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Th(this.isRunning),this.isRunning=!1,this._reject(e)}}class GT{terminate(){}}const XT=new Map;function v9(i){Th(i.source&&!i.url||!i.source&&i.url);let e=XT.get(i.source||i.url);return e||(i.url&&(e=x9(i.url),XT.set(i.url,e)),i.source&&(e=dF(i.source),XT.set(i.source,e))),Th(e),e}function x9(i){if(!i.startsWith("http"))return i;const e=w9(i);return dF(e)}function dF(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function w9(i){return`try {
  importScripts('${i}');
} catch (error) {
  console.error(error);
  throw error;
}`}function fF(i,e=!0,t){const n=t||new Set;if(i){if(Ok(i))n.add(i);else if(Ok(i.buffer))n.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const s in i)fF(i[s],e,n)}}return t===void 0?Array.from(n):[]}function Ok(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const qT=()=>{};class pS{constructor(e){ce(this,"name");ce(this,"source");ce(this,"url");ce(this,"terminated",!1);ce(this,"worker");ce(this,"onMessage");ce(this,"onError");ce(this,"_loadableURL","");const{name:t,source:n,url:s}=e;Th(n||s),this.name=t,this.source=n,this.url=s,this.onMessage=qT,this.onError=c=>console.log(c),this.worker=al?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&al||typeof GT<"u"&&!al}destroy(){this.onMessage=qT,this.onError=qT,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||fF(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=v9({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new GT(n,{eval:!1})}else if(this.source)e=new GT(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class A9{constructor(e){ce(this,"name","unnamed");ce(this,"source");ce(this,"url");ce(this,"maxConcurrency",1);ce(this,"maxMobileConcurrency",1);ce(this,"onDebug",()=>{});ce(this,"reuseWorkers",!0);ce(this,"props",{});ce(this,"jobQueue",[]);ce(this,"idleQueue",[]);ce(this,"count",0);ce(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return pS.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,c,f)=>s.done(f),n=(s,c)=>s.error(c)){const s=new Promise(c=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:c}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new b9(t.name,e);e.onMessage=s=>t.onMessage(n,s.type,s.payload),e.onError=s=>t.onError(n,s),t.onStart(n);try{await n.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!al||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new pS({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return y9?this.maxMobileConcurrency:this.maxConcurrency}}const T9={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Eu=class Eu{constructor(e){ce(this,"props");ce(this,"workerPools",new Map);this.props={...T9},this.setProps(e),this.workerPools=new Map}static isSupported(){return pS.isSupported()}static getWorkerFarm(e={}){return Eu._workerFarm=Eu._workerFarm||new Eu({}),Eu._workerFarm.setProps(e),Eu._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:s}=e;let c=this.workerPools.get(t);return c||(c=new A9({name:t,source:n,url:s}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};ce(Eu,"_workerFarm");let o1=Eu;function S9(i,e={}){const t=e[i.id]||{},n=al?`${i.id}-worker.js`:`${i.id}-worker-node.js`;let s=t.workerUrl;if(!s&&i.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(al?s=`modules/${i.module}/dist/${n}`:s=`modules/${i.module}/src/workers/${i.id}-worker-node.ts`),!s){let c=i.version;c==="latest"&&(c=g9);const f=c?`@${c}`:"";s=`https://unpkg.com/@loaders.gl/${i.module}${f}/dist/${n}`}return Th(s),s}function E9(i,e=uF){Th(i,"no worker provided");const t=i.version;return!(!e||!t)}const YT={};async function df(i,e=null,t={},n=null){return e&&(i=C9(i,e,t,n)),YT[i]=YT[i]||I9(i),await YT[i]}function C9(i,e,t={},n=null){if(!t.useLocalLibraries&&i.startsWith("http"))return i;n=n||i;const s=t.modules||{};return s[n]?s[n]:al?t.CDN?(Th(t.CDN.startsWith("http")),`${t.CDN}/${e}@${uF}/dist/libs/${n}`):GE?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function I9(i){if(i.endsWith("wasm"))return await R9(i);if(!al)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(i))}catch(t){return console.error(t),null}if(GE)return importScripts(i);const e=await k9(i);return M9(e,i)}function M9(i,e){if(!al){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(i,e)}if(GE)return eval.call(globalThis,i),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(i))}catch{t.text=i}return document.body.appendChild(t),null}async function R9(i){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return al||!e||i.startsWith("http")?await(await fetch(i)).arrayBuffer():await e(i)}async function k9(i){const{readFileAsText:e}=globalThis.loaders||{};return al||!e||i.startsWith("http")?await(await fetch(i)).text():await e(i)}function P9(i,e){return!o1.isSupported()||!al&&!(e!=null&&e._nodeWorkers)?!1:i.worker&&(e==null?void 0:e.worker)}async function D9(i,e,t,n,s){const c=i.id,f=S9(i,t),b=o1.getWorkerFarm(t).getWorkerPool({name:c,url:f});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const w=await b.startJob("process-on-worker",B9.bind(null,s));return w.postMessage("process",{input:e,options:t,context:n}),await(await w.result).result}async function B9(i,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:s,input:c,options:f}=n;try{const r=await i(c,f);e.postMessage("done",{id:s,result:r})}catch(r){const b=r instanceof Error?r.message:"unknown error";e.postMessage("error",{id:s,error:b})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function O9(i,e=5){return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?Fk(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?Fk(i,0,e):""}function Fk(i,e,t){if(i.byteLength<=e+t)return"";const n=new DataView(i);let s="";for(let c=0;c<t;c++)s+=String.fromCharCode(n.getUint8(e+c));return s}function F9(i){try{return JSON.parse(i)}catch{throw new Error(`Failed to parse JSON from data starting with "${O9(i)}"`)}}function L9(i,e,t){if(t=t||i.byteLength,i.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(i),s=new Uint8Array(e);for(let c=0;c<n.length;++c)if(n[c]!==s[c])return!1;return!0}function z9(...i){return N9(i)}function N9(i){const e=i.map(c=>c instanceof ArrayBuffer?new Uint8Array(c):c),t=e.reduce((c,f)=>c+f.byteLength,0),n=new Uint8Array(t);let s=0;for(const c of e)n.set(c,s),s+=c.byteLength;return n.buffer}function pF(i,e,t){const n=t!==void 0?new Uint8Array(i).subarray(e,e+t):new Uint8Array(i).subarray(e);return new Uint8Array(n).buffer}function S0(i,e){return Ah(i>=0),Ah(e>0),i+(e-1)&-4}function U9(i,e,t){let n;if(i instanceof ArrayBuffer)n=new Uint8Array(i);else{const s=i.byteOffset,c=i.byteLength;n=new Uint8Array(i.buffer||i.arrayBuffer,s,c)}return e.set(n,t),t+S0(n.byteLength,4)}async function V9(i){const e=[];for await(const t of i)e.push(t);return z9(...e)}function Lk(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class zk{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Lk(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Lk()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class vw{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let s=this.stats[t];return s||(e instanceof zk?s=e:s=new zk(t,n),this.stats[t]=s),s}}let $9="";const Nk={};function j9(i){for(const e in Nk)if(i.startsWith(e)){const t=Nk[e];i=i.replace(e,t)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i=`${$9}${i}`),i}function H9(i){return i&&typeof i=="object"&&i.isBuffer}function mF(i){if(H9(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function gF(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(e+1):""}function W9(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(0,e):""}const G9=i=>typeof i=="boolean",Iy=i=>typeof i=="function",E0=i=>i!==null&&typeof i=="object",Uk=i=>E0(i)&&i.constructor==={}.constructor,X9=i=>!!i&&typeof i[Symbol.iterator]=="function",q9=i=>i&&typeof i[Symbol.asyncIterator]=="function",Bf=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,Of=i=>typeof Blob<"u"&&i instanceof Blob,Y9=i=>i&&typeof i=="object"&&i.isBuffer,Z9=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||E0(i)&&Iy(i.tee)&&Iy(i.cancel)&&Iy(i.getReader),K9=i=>E0(i)&&Iy(i.read)&&Iy(i.pipe)&&G9(i.readable),_F=i=>Z9(i)||K9(i);class J9 extends Error{constructor(t,n){super(t);ce(this,"reason");ce(this,"url");ce(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const Q9=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,e7=/^([-\w.]+\/[-\w.+]+)/;function Vk(i,e){return i.toLowerCase()===e.toLowerCase()}function t7(i){const e=e7.exec(i);return e?e[1]:i}function $k(i){const e=Q9.exec(i);return e?e[1]:""}const yF=/\?.*/;function i7(i){const e=i.match(yF);return e&&e[0]}function XE(i){return i.replace(yF,"")}function n7(i){if(i.length<50)return i;const e=i.slice(i.length-15);return`${i.substr(0,32)}...${e}`}function xw(i){return Bf(i)?i.url:Of(i)?i.name||"":typeof i=="string"?i:""}function qE(i){if(Bf(i)){const e=i,t=e.headers.get("content-type")||"",n=XE(e.url);return t7(t)||$k(n)}return Of(i)?i.type||"":typeof i=="string"?$k(i):""}function r7(i){return Bf(i)?i.headers["content-length"]||-1:Of(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function bF(i){if(Bf(i))return i;const e={},t=r7(i);t>=0&&(e["content-length"]=String(t));const n=xw(i),s=qE(i);s&&(e["content-type"]=s);const c=await a7(i);c&&(e["x-first-bytes"]=c),typeof i=="string"&&(i=new TextEncoder().encode(i));const f=new Response(i,{headers:e});return Object.defineProperty(f,"url",{value:n}),f}async function s7(i){if(!i.ok)throw await o7(i)}async function o7(i){const e=n7(i.url);let t=`Failed to fetch resource (${i.status}) ${i.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const n={reason:i.statusText,url:i.url,response:i};try{const s=i.headers.get("Content-Type");n.reason=!i.bodyUsed&&(s!=null&&s.includes("application/json"))?await i.json():await i.text()}catch{}return new J9(t,n)}async function a7(i){if(typeof i=="string")return`data:,${i.slice(0,5)}`;if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(n=>{const s=new FileReader;s.onload=c=>{var f;return n((f=c==null?void 0:c.target)==null?void 0:f.result)},s.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5);return`data:base64,${l7(t)}`}return null}function l7(i){let e="";const t=new Uint8Array(i);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function c7(i){return!h7(i)&&!u7(i)}function h7(i){return i.startsWith("http:")||i.startsWith("https:")}function u7(i){return i.startsWith("data:")}async function jk(i,e){var t,n;if(typeof i=="string"){const s=j9(i);return c7(s)&&(t=globalThis.loaders)!=null&&t.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(s,e):await fetch(s,e)}return await bF(i)}const Hk=new T0({id:"loaders.gl"});class d7{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class f7{constructor(){ce(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const vF={fetch:null,mimeType:void 0,nothrow:!1,log:new f7,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:bw,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},p7={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function xF(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state||(i._state={}),i._state}function wF(){const i=xF();return i.globalOptions=i.globalOptions||{...vF},i.globalOptions}function m7(i,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],g7(i,t),y7(e,i,n)}function g7(i,e){Wk(i,null,vF,p7,e);for(const t of e){const n=i&&i[t.id]||{},s=t.options&&t.options[t.id]||{},c=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};Wk(n,t.id,s,c,e)}}function Wk(i,e,t,n,s){const c=e||"Top level",f=e?`${e}.`:"";for(const r in i){const b=!e&&E0(i[r]),w=r==="baseUri"&&!e,E=r==="workerUrl"&&e;if(!(r in t)&&!w&&!E){if(r in n)Hk.warn(`${c} loader option '${f}${r}' no longer supported, use '${n[r]}'`)();else if(!b){const k=_7(r,s);Hk.warn(`${c} loader option '${f}${r}' not recognized. ${k}`)()}}}}function _7(i,e){const t=i.toLowerCase();let n="";for(const s of e)for(const c in s.options){if(i===c)return`Did you mean '${s.id}.${c}'?`;const f=c.toLowerCase();(t.startsWith(f)||f.startsWith(t))&&(n=n||`Did you mean '${s.id}.${c}'?`)}return n}function y7(i,e,t){const s={...i.options||{}};return b7(s,t),s.log===null&&(s.log=new d7),Gk(s,wF()),Gk(s,e),s}function Gk(i,e){for(const t in e)if(t in e){const n=e[t];Uk(n)&&Uk(i[t])?i[t]={...i[t],...e[t]}:i[t]=e[t]}}function b7(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function YE(i){return i?(Array.isArray(i)&&(i=i[0]),Array.isArray(i==null?void 0:i.extensions)):!1}function ZE(i){Ah(i,"null loader"),Ah(YE(i),"invalid loader");let e;return Array.isArray(i)&&(e=i[1],i=i[0],i={...i,options:{...i.options,...e}}),(i!=null&&i.parseTextSync||i!=null&&i.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const AF=()=>{const i=xF();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function v7(i){const e=AF();i=Array.isArray(i)?i:[i];for(const t of i){const n=ZE(t);e.find(s=>n===s)||e.unshift(n)}}function x7(){return AF()}const w7=/\.([^.]+)$/;async function A7(i,e=[],t,n){if(!TF(i))return null;let s=Xk(i,e,{...t,nothrow:!0},n);if(s)return s;if(Of(i)&&(i=await i.slice(0,10).arrayBuffer(),s=Xk(i,e,t,n)),!s&&!(t!=null&&t.nothrow))throw new Error(SF(i));return s}function Xk(i,e=[],t,n){if(!TF(i))return null;if(e&&!Array.isArray(e))return ZE(e);let s=[];e&&(s=s.concat(e)),t!=null&&t.ignoreRegisteredLoaders||s.push(...x7()),S7(s);const c=T7(i,s,t,n);if(!c&&!(t!=null&&t.nothrow))throw new Error(SF(i));return c}function T7(i,e,t,n){const s=xw(i),c=qE(i),f=XE(s)||(n==null?void 0:n.url);let r=null,b="";return t!=null&&t.mimeType&&(r=ZT(e,t==null?void 0:t.mimeType),b=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),r=r||E7(e,f),b=b||(r?`matched url ${f}`:""),r=r||ZT(e,c),b=b||(r?`matched MIME type ${c}`:""),r=r||I7(e,i),b=b||(r?`matched initial data ${EF(i)}`:""),t!=null&&t.fallbackMimeType&&(r=r||ZT(e,t==null?void 0:t.fallbackMimeType),b=b||(r?`matched fallback MIME type ${c}`:"")),b&&d9.log(1,`selectLoader selected ${r==null?void 0:r.name}: ${b}.`),r}function TF(i){return!(i instanceof Response&&i.status===204)}function SF(i){const e=xw(i),t=qE(i);let n="No valid loader found (";n+=e?`${gF(e)}, `:"no url provided, ",n+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=i?EF(i):"";return n+=s?` first bytes: "${s}"`:"first bytes: not available",n+=")",n}function S7(i){for(const e of i)ZE(e)}function E7(i,e){const t=e&&w7.exec(e),n=t&&t[1];return n?C7(i,n):null}function C7(i,e){e=e.toLowerCase();for(const t of i)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function ZT(i,e){var t;for(const n of i)if((t=n.mimeTypes)!=null&&t.some(s=>Vk(e,s))||Vk(e,`application/x.${n.id}`))return n;return null}function I7(i,e){if(!e)return null;for(const t of i)if(typeof e=="string"){if(M7(e,t))return t}else if(ArrayBuffer.isView(e)){if(qk(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&qk(e,0,t))return t;return null}function M7(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>i.startsWith(n))}function qk(i,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>R7(i,e,t,s))}function R7(i,e,t,n){if(n instanceof ArrayBuffer)return L9(n,i,n.byteLength);switch(typeof n){case"function":return n(i);case"string":const s=mS(i,e,n.length);return n===s;default:return!1}}function EF(i,e=5){return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?mS(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?mS(i,0,e):""}function mS(i,e,t){if(i.byteLength<e+t)return"";const n=new DataView(i);let s="";for(let c=0;c<t;c++)s+=String.fromCharCode(n.getUint8(e+c));return s}const k7=256*1024;function*P7(i,e){const t=(e==null?void 0:e.chunkSize)||k7;let n=0;const s=new TextEncoder;for(;n<i.length;){const c=Math.min(i.length-n,t),f=i.slice(n,n+c);n+=c,yield s.encode(f)}}const D7=256*1024;function*B7(i,e={}){const{chunkSize:t=D7}=e;let n=0;for(;n<i.byteLength;){const s=Math.min(i.byteLength-n,t),c=new ArrayBuffer(s),f=new Uint8Array(i,n,s);new Uint8Array(c).set(f),n+=s,yield c}}const O7=1024*1024;async function*F7(i,e){const t=(e==null?void 0:e.chunkSize)||O7;let n=0;for(;n<i.size;){const s=n+t,c=await i.slice(n,s).arrayBuffer();n=s,yield c}}function Yk(i,e){return bw?L7(i,e):z7(i)}async function*L7(i,e){const t=i.getReader();let n;try{for(;;){const s=n||t.read();e!=null&&e._streamReadAhead&&(n=t.read());const{done:c,value:f}=await s;if(c)return;yield mF(f)}}catch{t.releaseLock()}}async function*z7(i,e){for await(const t of i)yield mF(t)}function N7(i,e){if(typeof i=="string")return P7(i,e);if(i instanceof ArrayBuffer)return B7(i,e);if(Of(i))return F7(i,e);if(_F(i))return Yk(i,e);if(Bf(i))return Yk(i.body,e);throw new Error("makeIterator")}const CF="Cannot convert supplied data type";function U7(i,e,t){if(e.text&&typeof i=="string")return i;if(Y9(i)&&(i=i.buffer),i instanceof ArrayBuffer){const n=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let n=i.buffer;const s=i.byteLength||i.length;return(i.byteOffset!==0||s!==n.byteLength)&&(n=n.slice(i.byteOffset,i.byteOffset+s)),n}throw new Error(CF)}async function V7(i,e,t){const n=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||n)return U7(i,e);if(Of(i)&&(i=await bF(i)),Bf(i)){const s=i;return await s7(s),e.binary?await s.arrayBuffer():await s.text()}if(_F(i)&&(i=N7(i,t)),X9(i)||q9(i))return V9(i);throw new Error(CF)}function IF(i,e){const t=wF(),n=i||t;return typeof n.fetch=="function"?n.fetch:E0(n.fetch)?s=>jk(s,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:jk}function $7(i,e,t){if(t)return t;const n={fetch:IF(e,i),...i};if(n.url){const s=XE(n.url);n.baseUrl=s,n.queryString=i7(n.url),n.filename=gF(s),n.baseUrl=W9(s)}return Array.isArray(n.loaders)||(n.loaders=null),n}function j7(i,e){if(i&&!Array.isArray(i))return i;let t;if(i&&(t=Array.isArray(i)?i:[i]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:void 0}async function a1(i,e,t,n){e&&!Array.isArray(e)&&!YE(e)&&(n=void 0,t=e,e=void 0),i=await i,t=t||{};const s=xw(i),f=j7(e,n),r=await A7(i,f,t);return r?(t=m7(t,r,f,s),n=$7({url:s,_parse:a1,loaders:f},t,n||null),await H7(r,i,t,n)):null}async function H7(i,e,t,n){if(E9(i),t=f9(i.options,t),Bf(e)){const c=e,{ok:f,redirected:r,status:b,statusText:w,type:E,url:k}=c,F=Object.fromEntries(c.headers.entries());n.response={headers:F,ok:f,redirected:r,status:b,statusText:w,type:E,url:k}}e=await V7(e,i,t);const s=i;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,n);if(P9(i,t))return await D9(i,e,t,n,a1);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,n);if(s.parse)return await s.parse(e,t,n);throw Th(!s.parseSync),new Error(`${i.id} loader - no parser found and worker is disabled`)}function W7(i){switch(i.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function G7(i){let e=1/0,t=1/0,n=1/0,s=-1/0,c=-1/0,f=-1/0;const r=i.POSITION?i.POSITION.value:[],b=r&&r.length;for(let w=0;w<b;w+=3){const E=r[w],k=r[w+1],F=r[w+2];e=E<e?E:e,t=k<t?k:t,n=F<n?F:n,s=E>s?E:s,c=k>c?k:c,f=F>f?F:f}return[[e,t,n],[s,c,f]]}function X7(i,e,t){const n=W7(e.value),s=t||q7(e);return{name:i,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:s}}function q7(i){const e={};return"byteOffset"in i&&(e.byteOffset=i.byteOffset.toString(10)),"byteStride"in i&&(e.byteStride=i.byteStride.toString(10)),"normalized"in i&&(e.normalized=i.normalized.toString()),e}async function gS(i,e,t,n){let s,c;!Array.isArray(e)&&!YE(e)?(s=[],c=e):(s=e,c=t);const f=IF(c);let r=i;return typeof i=="string"&&(r=await f(i)),Of(i)&&(r=await f(i)),Array.isArray(s)?await a1(r,s,c):await a1(r,s,c)}const Y7="4.3.2";var yO;const Z7=(yO=globalThis.loaders)==null?void 0:yO.parseImageNode,_S=typeof Image<"u",yS=typeof ImageBitmap<"u",K7=!!Z7,bS=bw?!0:K7;function J7(i){switch(i){case"auto":return yS||_S||bS;case"imagebitmap":return yS;case"image":return _S;case"data":return bS;default:throw new Error(`@loaders.gl/images: image ${i} not supported in this environment`)}}function Q7(){if(yS)return"imagebitmap";if(_S)return"image";if(bS)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function eW(i){const e=tW(i);if(!e)throw new Error("Not an image");return e}function MF(i){switch(eW(i)){case"data":return i;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),t.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function tW(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const iW=/^data:image\/svg\+xml/,nW=/\.svg((\?|#).*)?$/;function KE(i){return i&&(iW.test(i)||nW.test(i))}function rW(i,e){if(KE(e)){let n=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(c){throw new Error(c.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return RF(i,e)}function RF(i,e){if(KE(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function kF(i,e,t){const n=rW(i,t),s=self.URL||self.webkitURL,c=typeof n!="string"&&s.createObjectURL(n);try{return await sW(c||n,e)}finally{c&&s.revokeObjectURL(c)}}async function sW(i,e){const t=new Image;return t.src=i,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,s)=>{try{t.onload=()=>n(t),t.onerror=c=>{const f=c instanceof Error?c.message:"error";s(new Error(f))}}catch(c){s(c)}})}const oW={};let Zk=!0;async function aW(i,e,t){let n;KE(t)?n=await kF(i,e,t):n=RF(i,t);const s=e&&e.imagebitmap;return await lW(n,s)}async function lW(i,e=null){if((cW(e)||!Zk)&&(e=null),e)try{return await createImageBitmap(i,e)}catch(t){console.warn(t),Zk=!1}return await createImageBitmap(i)}function cW(i){for(const e in i||oW)return!1;return!0}function hW(i){return!pW(i,"ftyp",4)||(i[8]&96)===0?null:uW(i)}function uW(i){switch(dW(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function dW(i,e,t){return String.fromCharCode(...i.slice(e,t))}function fW(i){return[...i].map(e=>e.charCodeAt(0))}function pW(i,e,t=0){const n=fW(e);for(let s=0;s<n.length;++s)if(n[s]!==i[s+t])return!1;return!0}const Ec=!1,My=!0;function JE(i){const e=C0(i);return gW(e)||bW(e)||_W(e)||yW(e)||mW(e)}function mW(i){const e=new Uint8Array(i instanceof DataView?i.buffer:i),t=hW(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function gW(i){const e=C0(i);return e.byteLength>=24&&e.getUint32(0,Ec)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ec),height:e.getUint32(20,Ec)}:null}function _W(i){const e=C0(i);return e.byteLength>=10&&e.getUint32(0,Ec)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,My),height:e.getUint16(8,My)}:null}function yW(i){const e=C0(i);return e.byteLength>=14&&e.getUint16(0,Ec)===16973&&e.getUint32(2,My)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,My),height:e.getUint32(22,My)}:null}function bW(i){const e=C0(i);if(!(e.byteLength>=3&&e.getUint16(0,Ec)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:s}=vW();let c=2;for(;c+9<e.byteLength;){const f=e.getUint16(c,Ec);if(s.has(f))return{mimeType:"image/jpeg",height:e.getUint16(c+5,Ec),width:e.getUint16(c+7,Ec)};if(!n.has(f))return null;c+=2,c+=e.getUint16(c,Ec)}return null}function vW(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function C0(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function xW(i,e){var s;const{mimeType:t}=JE(i)||{},n=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return Ah(n),await n(i,t)}async function wW(i,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:c}=t||{},f=AW(s);let r;switch(f){case"imagebitmap":r=await aW(i,e,c);break;case"image":r=await kF(i,e,c);break;case"data":r=await xW(i);break;default:Ah(!1)}return s==="data"&&(r=MF(r)),r}function AW(i){switch(i){case"auto":case"data":return Q7();default:return J7(i),i}}const TW=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],SW=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],EW={image:{type:"auto",decode:!0}},PF={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Y7,mimeTypes:SW,extensions:TW,parse:wW,tests:[i=>!!JE(new DataView(i))],options:EW},KT={};function CW(i){if(KT[i]===void 0){const e=bw?MW(i):IW(i);KT[i]=e}return KT[i]}function IW(i){var s,c;const e=["image/png","image/jpeg","image/gif"],t=((s=globalThis.loaders)==null?void 0:s.imageFormatsNode)||e;return!!((c=globalThis.loaders)==null?void 0:c.parseImageNode)&&t.includes(i)}function MW(i){switch(i){case"image/avif":case"image/webp":return RW(i);default:return!0}}function RW(i){try{return document.createElement("canvas").toDataURL(i).indexOf(`data:${i}`)===0}catch{return!1}}const gr=new T0({id:"deck"});let vS={};function kW(i){vS=i}function zo(i,e,t,n){gr.level>0&&vS[i]&&vS[i].call(null,e,t,n)}function PW(i){const e=i[0],t=i[i.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const DW={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:PW,parseTextSync:JSON.parse};function BW(){const i="9.1.12",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==i)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${i}`);return e||(gr.log(1,`deck.gl ${i}`)(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:gr,_registerLoggers:kW},v7([DW,[PF,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const OW=BW();function QE(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const JT={number:{type:"number",validate(i,e){return Number.isFinite(i)&&typeof e=="object"&&(e.max===void 0||i<=e.max)&&(e.min===void 0||i>=e.min)}},array:{type:"array",validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function FW(i){const e={};for(const[t,n]of Object.entries(i))e[t]=LW(n);return e}function LW(i){let e=Kk(i);if(e!=="object")return{value:i,...JT[e],type:e};if(typeof i=="object")return i?i.type!==void 0?{...i,...JT[i.type],type:i.type}:i.value===void 0?{type:"object",value:i}:(e=Kk(i.value),{...i,...JT[e],type:e}):{type:"object",value:null};throw new Error("props")}function Kk(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const zW=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,NW=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,UW={vertex:zW,fragment:NW},Jk=/void\s+main\s*\([^)]*\)\s*\{\n?/,Qk=/}\n?[^{}]*$/,QT=[],Dx="__LUMA_INJECT_DECLARATIONS__";function VW(i){const e={vertex:{},fragment:{}};for(const t in i){let n=i[t];const s=$W(t);typeof n=="string"&&(n={order:0,injection:n}),e[s][t]=n}return e}function $W(i){const e=i.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function l1(i,e,t,n=!1){const s=e==="vertex";for(const c in t){const f=t[c];f.sort((b,w)=>b.order-w.order),QT.length=f.length;for(let b=0,w=f.length;b<w;++b)QT[b]=f[b].injection;const r=`${QT.join(`
`)}
`;switch(c){case"vs:#decl":s&&(i=i.replace(Dx,r));break;case"vs:#main-start":s&&(i=i.replace(Jk,b=>b+r));break;case"vs:#main-end":s&&(i=i.replace(Qk,b=>r+b));break;case"fs:#decl":s||(i=i.replace(Dx,r));break;case"fs:#main-start":s||(i=i.replace(Jk,b=>b+r));break;case"fs:#main-end":s||(i=i.replace(Qk,b=>r+b));break;default:i=i.replace(c,b=>b+r)}}return i=i.replace(Dx,""),n&&(i=i.replace(/\}\s*$/,c=>c+UW[e])),i}function c1(i){i.map(e=>jW(e))}function jW(i){if(i.instance)return;c1(i.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:n={}}=i,s={normalizedInjections:VW(n),parsedDeprecations:HW(t)};e&&(s.propValidators=FW(e)),i.instance=s;let c={};e&&(c=Object.entries(e).reduce((f,[r,b])=>{const w=b==null?void 0:b.value;return w&&(f[r]=w),f},{})),i.defaultUniforms={...i.defaultUniforms,...c}}function DF(i,e,t){var n;(n=i.deprecations)==null||n.forEach(s=>{var c;(c=s.regex)!=null&&c.test(e)&&(s.deprecated?t.deprecated(s.old,s.new)():t.removed(s.old,s.new)())})}function HW(i){return i.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),i}function eC(i){c1(i);const e={},t={};BF({modules:i,level:0,moduleMap:e,moduleDepth:t});const n=Object.keys(t).sort((s,c)=>t[c]-t[s]).map(s=>e[s]);return c1(n),n}function BF(i){const{modules:e,level:t,moduleMap:n,moduleDepth:s}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)n[c.name]=c,(s[c.name]===void 0||s[c.name]<t)&&(s[c.name]=t);for(const c of e)c.dependencies&&BF({modules:c.dependencies,level:t+1,moduleMap:n,moduleDepth:s})}function WW(i){switch(i==null?void 0:i.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function GW(i,e){var n;if(Number(((n=i.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return i=eP(i,XW),i;case"fragment":return i=eP(i,qW),i;default:throw new Error(e)}}const OF=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],XW=[...OF,[xS("attribute"),"in $1"],[xS("varying"),"out $1"]],qW=[...OF,[xS("varying"),"in $1"]];function eP(i,e){for(const[t,n]of e)i=i.replace(t,n);return i}function xS(i){return new RegExp(`\\b${i}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function FF(i,e){let t="";for(const n in i){const s=i[n];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[n]){const c=e[n];c.sort((f,r)=>f.order-r.order);for(const f of c)t+=`  ${f.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function LF(i){const e={vertex:{},fragment:{}};for(const t of i){let n,s;typeof t!="string"?(n=t,s=n.hook):(n={},s=t),s=s.trim();const[c,f]=s.split(":"),r=s.replace(/\(.+/,""),b=Object.assign(n,{signature:f});switch(c){case"vs":e.vertex[r]=b;break;case"fs":e.fragment[r]=b;break;default:throw new Error(c)}}return e}function YW(i,e){return{name:ZW(i,e),language:"glsl",version:KW(i)}}function ZW(i,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(i);return n?n[1]:e}function KW(i){let e=100;const t=i.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const zF=`

${Dx}
`,JW=`precision highp float;
`;function QW(i){const e=eC(i.modules||[]);return{source:tG(i.platformInfo,{...i,source:i.source,stage:"vertex",modules:e}),getUniforms:NF(e)}}function eG(i){const{vs:e,fs:t}=i,n=eC(i.modules||[]);return{vs:tP(i.platformInfo,{...i,source:e,stage:"vertex",modules:n}),fs:tP(i.platformInfo,{...i,source:t,stage:"fragment",modules:n}),getUniforms:NF(n)}}function tG(i,e){var W;const{source:t,stage:n,modules:s,hookFunctions:c=[],inject:f={},log:r}=e;QE(typeof t=="string","shader source must be a string");const b=t;let w="";const E=LF(c),k={},F={},$={};for(const ne in f){const _e=typeof f[ne]=="string"?{injection:f[ne],order:0}:f[ne],Te=/^(v|f)s:(#)?([\w-]+)$/.exec(ne);if(Te){const we=Te[2],Ee=Te[3];we?Ee==="decl"?F[ne]=[_e]:$[ne]=[_e]:k[ne]=[_e]}else $[ne]=[_e]}const X=s;for(const ne of X){r&&DF(ne,b,r);const _e=UF(ne,"wgsl");w+=_e;const Te=((W=ne.injections)==null?void 0:W[n])||{};for(const we in Te){const Ee=/^(v|f)s:#([\w-]+)$/.exec(we);if(Ee){const Je=Ee[2]==="decl"?F:$;Je[we]=Je[we]||[],Je[we].push(Te[we])}else k[we]=k[we]||[],k[we].push(Te[we])}}return w+=zF,w=l1(w,n,F),w+=FF(E[n],k),w+=b,w=l1(w,n,$),w}function tP(i,e){var Tt;const{id:t,source:n,stage:s,language:c="glsl",modules:f,defines:r={},hookFunctions:b=[],inject:w={},prologue:E=!0,log:k}=e;QE(typeof n=="string","shader source must be a string");const F=c==="glsl"?YW(n).version:-1,$=i.shaderLanguageVersion,X=F===100?"#version 100":"#version 300 es",ne=n.split(`
`).slice(1).join(`
`),_e={};f.forEach(_t=>{Object.assign(_e,_t.defines)}),Object.assign(_e,r);let Te="";switch(c){case"wgsl":break;case"glsl":Te=E?`${X}

// ----- PROLOGUE -------------------------
${iG({id:t,source:n,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${WW(i)}
${s==="fragment"?JW:""}

// ----- APPLICATION DEFINES -------------------------

${nG(_e)}

`:`${X}
`;break}const we=LF(b),Ee={},Le={},Je={};for(const _t in w){const St=typeof w[_t]=="string"?{injection:w[_t],order:0}:w[_t],kt=/^(v|f)s:(#)?([\w-]+)$/.exec(_t);if(kt){const Lt=kt[2],si=kt[3];Lt?si==="decl"?Le[_t]=[St]:Je[_t]=[St]:Ee[_t]=[St]}else Je[_t]=[St]}for(const _t of f){k&&DF(_t,ne,k);const St=UF(_t,s);Te+=St;const kt=((Tt=_t.instance)==null?void 0:Tt.normalizedInjections[s])||{};for(const Lt in kt){const si=/^(v|f)s:#([\w-]+)$/.exec(Lt);if(si){const ii=si[2]==="decl"?Le:Je;ii[Lt]=ii[Lt]||[],ii[Lt].push(kt[Lt])}else Ee[Lt]=Ee[Lt]||[],Ee[Lt].push(kt[Lt])}}return Te+="// ----- MAIN SHADER SOURCE -------------------------",Te+=zF,Te=l1(Te,s,Le),Te+=FF(we[s],Ee),Te+=ne,Te=l1(Te,s,Je),c==="glsl"&&F!==$&&(Te=GW(Te,s)),Te.trim()}function NF(i){return function(t){var s;const n={};for(const c of i){const f=(s=c.getUniforms)==null?void 0:s.call(c,t,n);Object.assign(n,f)}return n}}function iG(i){const{id:e,source:t,stage:n}=i;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function nG(i={}){let e="";for(const t in i){const n=i[t];(n||Number.isFinite(n))&&(e+=`#define ${t.toUpperCase()} ${i[t]}
`)}return e}function UF(i,e){let t;switch(e){case"vertex":t=i.vs||"";break;case"fragment":t=i.fs||"";break;case"wgsl":t=i.source||"";break;default:QE(!1)}if(!i.name)throw new Error("Shader module must have a name");const n=i.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${i.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${n}
`),s+=`${t}
`,s}const rG=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,sG=/^\s*\#\s*endif\s*$/;function oG(i,e){var f;const t=i.split(`
`),n=[];let s=!0,c=null;for(const r of t){const b=r.match(rG),w=r.match(sG);b?(c=b[1],s=!!((f=e==null?void 0:e.defines)!=null&&f[c])):w?s=!0:s&&n.push(r)}return n.join(`
`)}const rf=class rf{constructor(){ce(this,"_hookFunctions",[]);ce(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return rf.defaultShaderAssembler=rf.defaultShaderAssembler||new rf,rf.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:s,getUniforms:c}=QW({...e,source:e.source,modules:t,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?oG(s):s,getUniforms:c,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions;return{...eG({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let s=0;for(let c=0,f=this._defaultModules.length;c<f;++c){const r=this._defaultModules[c],b=r.name;t[s++]=r,n[b]=!0}for(let c=0,f=e.length;c<f;++c){const r=e[c],b=r.name;n[b]||(t[s++]=r,n[b]=!0)}return t.length=s,c1(t),t}};ce(rf,"defaultShaderAssembler");let h1=rf;const aG=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,lG=`#version 300 es
${aG}`;function cG(i){const{input:e,inputChannels:t,output:n}={};if(!e)return lG;if(!t)throw new Error("inputChannels");const s=hG(t),c=uG(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${n};
void main() {
  ${n} = ${c};
}`}function hG(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${i}`)}}function uG(i,e){switch(e){case 1:return`vec4(${i}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${i}, 0.0, 1.0)`;case 3:return`vec4(${i}, 1.0)`;case 4:return i;default:throw new Error(`invalid channels: ${e}`)}}class dG{constructor(){ce(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new vw({id:e})),this.stats.get(e)}}const VF=new dG,ni=new T0({id:"luma.gl"}),e2={};function ww(i="id"){e2[i]=e2[i]||1;const e=e2[i]++;return`${i}-${e}`}var Q2;let Er=(Q2=class{constructor(e,t,n){ce(this,"id");ce(this,"props");ce(this,"userData",{});ce(this,"_device");ce(this,"destroyed",!1);ce(this,"allocatedBytes",0);ce(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=fG(t,n);const s=this.props.id!=="undefined"?this.props.id:ww(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},ce(Q2,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Q2);function fG(i,e){const t={...e};for(const n in i)i[n]!==void 0&&(t[n]=i[n]);return t}const ro=class ro extends Er{constructor(t,n){const s={...n};(n.usage||0)&ro.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?s.indexType="uint32":n.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data;super(t,s,ro.defaultProps);ce(this,"usage");ce(this,"indexType");ce(this,"updateTimestamp");ce(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,n){throw new Error("not implemented")}_setDebugData(t,n,s){const c=ArrayBuffer.isView(t)?t.buffer:t,f=Math.min(t?t.byteLength:s,ro.DEBUG_DATA_MAX_LENGTH);c===null?this.debugData=new ArrayBuffer(f):n===0&&s===c.byteLength?this.debugData=c.slice(0,f):this.debugData=c.slice(n,n+f)}};ce(ro,"defaultProps",{...Er.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),ce(ro,"MAP_READ",1),ce(ro,"MAP_WRITE",2),ce(ro,"COPY_SRC",4),ce(ro,"COPY_DST",8),ce(ro,"INDEX",16),ce(ro,"VERTEX",32),ce(ro,"UNIFORM",64),ce(ro,"STORAGE",128),ce(ro,"INDIRECT",256),ce(ro,"QUERY_RESOLVE",512),ce(ro,"DEBUG_DATA_MAX_LENGTH",32);let Hr=ro;function $F(i){const e=iP[i],t=pG(e),n=i.includes("norm"),s=!n&&!i.startsWith("float"),c=i.startsWith("s");return{dataType:iP[i],byteLength:t,integer:s,signed:c,normalized:n}}function pG(i){return mG[i]}const iP={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},mG={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},To="texture-compression-bc",Sr="texture-compression-astc",bc="texture-compression-etc2",gG="texture-compression-etc1-webgl",$v="texture-compression-pvrtc-webgl",t2="texture-compression-atc-webgl",jv="float32-renderable-webgl",i2="float16-renderable-webgl",_G="rgb9e5ufloat-renderable-webgl",n2="snorm8-renderable-webgl",J_="norm16-renderable-webgl",r2="snorm16-renderable-webgl",Hv="float32-filterable",nP="float16-filterable-webgl";function jF(i){const e=yG[i];if(!e)throw new Error(`Unsupported texture format ${i}`);return e}const yG={r8unorm:{},r8snorm:{render:n2},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:n2},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:i2,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:J_},"r16snorm-webgl":{f:r2},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:n2},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:i2,filter:nP},"rg16unorm-webgl":{render:J_},"rg16snorm-webgl":{render:r2},r32uint:{},r32sint:{},r32float:{render:jv,filter:Hv},rgb9e5ufloat:{channels:"rgb",packed:!0,render:_G},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:jv},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:J_},"rgb16snorm-webgl":{f:J_},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Hv},rgba16uint:{},rgba16sint:{},rgba16float:{render:i2,filter:nP},"rgba16unorm-webgl":{render:J_},"rgba16snorm-webgl":{render:r2},"rgb32float-webgl":{render:jv,filter:Hv},rgba32uint:{},rgba32sint:{},rgba32float:{render:jv,filter:Hv},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:To},"bc1-rgb-unorm-srgb-webgl":{f:To},"bc1-rgba-unorm":{f:To},"bc1-rgba-unorm-srgb":{f:To},"bc2-rgba-unorm":{f:To},"bc2-rgba-unorm-srgb":{f:To},"bc3-rgba-unorm":{f:To},"bc3-rgba-unorm-srgb":{f:To},"bc4-r-unorm":{f:To},"bc4-r-snorm":{f:To},"bc5-rg-unorm":{f:To},"bc5-rg-snorm":{f:To},"bc6h-rgb-ufloat":{f:To},"bc6h-rgb-float":{f:To},"bc7-rgba-unorm":{f:To},"bc7-rgba-unorm-srgb":{f:To},"etc2-rgb8unorm":{f:bc},"etc2-rgb8unorm-srgb":{f:bc},"etc2-rgb8a1unorm":{f:bc},"etc2-rgb8a1unorm-srgb":{f:bc},"etc2-rgba8unorm":{f:bc},"etc2-rgba8unorm-srgb":{f:bc},"eac-r11unorm":{f:bc},"eac-r11snorm":{f:bc},"eac-rg11unorm":{f:bc},"eac-rg11snorm":{f:bc},"astc-4x4-unorm":{f:Sr},"astc-4x4-unorm-srgb":{f:Sr},"astc-5x4-unorm":{f:Sr},"astc-5x4-unorm-srgb":{f:Sr},"astc-5x5-unorm":{f:Sr},"astc-5x5-unorm-srgb":{f:Sr},"astc-6x5-unorm":{f:Sr},"astc-6x5-unorm-srgb":{f:Sr},"astc-6x6-unorm":{f:Sr},"astc-6x6-unorm-srgb":{f:Sr},"astc-8x5-unorm":{f:Sr},"astc-8x5-unorm-srgb":{f:Sr},"astc-8x6-unorm":{f:Sr},"astc-8x6-unorm-srgb":{f:Sr},"astc-8x8-unorm":{f:Sr},"astc-8x8-unorm-srgb":{f:Sr},"astc-10x5-unorm":{f:Sr},"astc-10x5-unorm-srgb":{f:Sr},"astc-10x6-unorm":{f:Sr},"astc-10x6-unorm-srgb":{f:Sr},"astc-10x8-unorm":{f:Sr},"astc-10x8-unorm-srgb":{f:Sr},"astc-10x10-unorm":{f:Sr},"astc-10x10-unorm-srgb":{f:Sr},"astc-12x10-unorm":{f:Sr},"astc-12x10-unorm-srgb":{f:Sr},"astc-12x12-unorm":{f:Sr},"astc-12x12-unorm-srgb":{f:Sr},"pvrtc-rgb4unorm-webgl":{f:$v},"pvrtc-rgba4unorm-webgl":{f:$v},"pvrtc-rbg2unorm-webgl":{f:$v},"pvrtc-rgba2unorm-webgl":{f:$v},"etc1-rbg-unorm-webgl":{f:gG},"atc-rgb-unorm-webgl":{f:t2},"atc-rgba-unorm-webgl":{f:t2},"atc-rgbai-unorm-webgl":{f:t2}},bG=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],vG=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function HF(i){return bG.some(e=>i.startsWith(e))}function tC(i){let e=xG(i);if(HF(i)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=wG(i);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const t=vG.exec(i);if(t){const[,n,s,c,f,r]=t,b=`${c}${s}`,w=$F(b),E=w.byteLength*8,k=n.length,F=[E,k>=2?E:0,k>=3?E:0,k>=4?E:0];e={format:i,attachment:e.attachment,dataType:w.dataType,components:k,channels:n,integer:w.integer,signed:w.signed,normalized:w.normalized,bitsPerChannel:F,bytesPerPixel:w.byteLength*n.length,packed:e.packed,srgb:e.srgb},r==="-webgl"&&(e.webgl=!0),f==="-srgb"&&(e.srgb=!0)}return i.endsWith("-webgl")&&(e.webgl=!0),i.endsWith("-srgb")&&(e.srgb=!0),e}function xG(i){var c;const e=jF(i),t=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:i,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((c=e.channels)==null?void 0:c.length)||1,bytesPerPixel:t,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function wG(i){const t=/.*-(\d+)x(\d+)-.*/.exec(i);if(t){const[,n,s]=t;return{blockWidth:Number(n),blockHeight:Number(s)}}return null}function AG(i){const e=jF(i),t={format:i,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=tC(i),s=i.startsWith("depth")||i.startsWith("stencil"),c=n==null?void 0:n.signed,f=n==null?void 0:n.integer,r=n==null?void 0:n.webgl;return t.render&&(t.render=!c),t.filter&&(t.filter=!s&&!c&&!f&&!r),t}class TG{}class SG{constructor(e=[],t){ce(this,"features");ce(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const Z1=class Z1{constructor(e){ce(this,"id");ce(this,"props");ce(this,"userData",{});ce(this,"statsManager",VF);ce(this,"timestamp",0);ce(this,"_reused",!1);ce(this,"_lumaData",{});this.props={...Z1.defaultProps,...e},this.id=this.props.id||ww(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=AG(e),n=f=>(typeof f=="string"?this.features.has(f):f)??!0,s=n(t.create),c={format:e,create:s,render:s&&n(t.render),filter:s&&n(t.filter),blend:s&&n(t.blend),store:s&&n(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(c)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return HF(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Hr.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":ni.warn("indices buffer content must be of integer type")()),t}};ce(Z1,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ni.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ni.get("debug")||void 0,debugShaders:ni.get("debug-shaders")||void 0,debugFramebuffers:!!ni.get("debug-framebuffers"),debugWebGL:!!ni.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Ou=Z1;const EG=Df()&&typeof document<"u",CG=()=>EG&&document.readyState==="complete",IG="set luma.log.level=1 (or higher) to trace rendering",rP="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Cu=class Cu{constructor(){ce(this,"stats",VF);ce(this,"log",ni);ce(this,"VERSION","9.1.9");ce(this,"spector");ce(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ni.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ni.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ni.error("This version of luma.gl has already been initialized")()}ni.log(1,`${this.VERSION} - ${IG}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,n])=>n).filter(n=>{var s;return(s=n.isSupported)==null?void 0:s.call(n)}).map(n=>n.type)}getBestAvailableAdapter(e=[]){var n,s,c,f;const t=this.getAdapterMap(e);return(s=(n=t.get("webgpu"))==null?void 0:n.isSupported)!=null&&s.call(n)?"webgpu":(f=(c=t.get("webgl"))==null?void 0:c.isSupported)!=null&&f.call(c)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Cu.defaultProps,e)}async createDevice(e={}){var r;e={...Cu.defaultProps,...e},e.waitForPageLoad&&await Cu.pageLoaded;const t=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const c=(this.getAdapterMap(e.adapters)||t).get(n),f=await((r=c==null?void 0:c.create)==null?void 0:r.call(c,e));if(f)return f;throw new Error(rP)}async attachDevice(e){var f;const t=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await Cu.pageLoaded,e.handle===null&&(n="unknown");const s=t.get(n),c=await((f=s==null?void 0:s.attach)==null?void 0:f.call(s,null));if(c)return c;throw new Error(rP)}enforceWebGL2(e=!0,t=[]){var c;const s=this.getAdapterMap(t).get("webgl");s||ni.warn("enforceWebGL2: webgl adapter not found")(),(c=s==null?void 0:s.enforceWebGL2)==null||c.call(s,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}registerDevices(e){ni.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const n=t.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}};ce(Cu,"defaultProps",{...Ou.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),ce(Cu,"pageLoaded",MG().then(()=>{ni.probe(2,"DOM is loaded")()}));let wS=Cu;const AS=new wS;function MG(){return CG()||typeof window>"u"?Promise.resolve():new Promise(i=>{window.addEventListener("load",()=>i())})}class RG{}const K1=class K1{constructor(e){ce(this,"id");ce(this,"props");ce(this,"canvas");ce(this,"htmlCanvas");ce(this,"offscreenCanvas");ce(this,"type");ce(this,"width",1);ce(this,"height",1);ce(this,"resizeObserver");ce(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...K1.defaultProps,...e},e=this.props,!Df()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=PG(e.canvas):this.canvas=e.canvas;else{const t=DG(e),n=kG((e==null?void 0:e.container)||null);n.insertBefore(t,n.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const n of t)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return n?t/n:1}catch{return 1}}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[s,c]=this.getDrawingBufferSize();return BG(e,n,s,c,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,s="height"in t?t.height:this.htmlCanvas.clientHeight;(!n||!s)&&(ni.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const c=this._canvasSizeInfo;if(c.clientWidth!==n||c.clientHeight!==s||c.devicePixelRatio!==e){let f=e;const r=Math.floor(n*f),b=Math.floor(s*f);if(this.htmlCanvas.width=r,this.htmlCanvas.height=b,this.device.gl){const[E,k]=this.getDrawingBufferSize();(E!==r||k!==b)&&(f=Math.min(E/n,k/s),this.htmlCanvas.width=Math.floor(n*f),this.htmlCanvas.height=Math.floor(s*f),ni.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};ce(K1,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let TS=K1;function kG(i){if(typeof i=="string"){const e=document.getElementById(i);if(!e)throw new Error(`${i} is not an HTML element`);return e}else if(i)return i;return document.body}function PG(i){const e=document.getElementById(i);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function DG(i){const{width:e,height:t}=i,n=document.createElement("canvas");return n.id=ww("lumagl-auto-created-canvas"),n.width=e||1,n.height=t||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(t)?`${t}px`:"100%",n}function BG(i,e,t,n,s){const c=i,f=sP(c[0],e,t);let r=oP(c[1],e,n,s),b=sP(c[0]+1,e,t);const w=b===t-1?b:b-1;b=oP(c[1]+1,e,n,s);let E;return s?(b=b===0?b:b+1,E=r,r=b):E=b===n-1?b:b-1,{x:f,y:r,width:Math.max(w-f+1,1),height:Math.max(E-r+1,1)}}function sP(i,e,t){return Math.min(Math.round(i*e),t-1)}function oP(i,e,t,n){return n?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}const so=class so extends Er{constructor(t,n){n=so.normalizeProps(t,n);super(t,n,so.defaultProps);ce(this,"dimension");ce(this,"format");ce(this,"width");ce(this,"height");ce(this,"depth");ce(this,"mipLevels");ce(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=so.getTextureDataSize(this.props.data);this.width=(s==null?void 0:s.width)||1,this.height=(s==null?void 0:s.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?so.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const n=t==null?void 0:t.data;return ArrayBuffer.isView(n)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return so.getTextureDataSize(t[0]);if(so.isExternalImage(t))return so.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const s=Object.values(t)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,n){let s;return ArrayBuffer.isView(t)?s=[{data:t,width:n.width,height:n.height}]:Array.isArray(t)?s=t:s=[t],s}static getMipLevelCount(t,n){return Math.floor(Math.log2(Math.max(t,n)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,n){var b,w;const s={...n},c=((w=(b=t==null?void 0:t.props)==null?void 0:b._resourceDefaults)==null?void 0:w.texture)||{};Object.assign(s,c);const{width:f,height:r}=s;return typeof f=="number"&&(s.width=Math.max(1,Math.ceil(f))),typeof r=="number"&&(s.height=Math.max(1,Math.ceil(r))),s}};ce(so,"COPY_SRC",1),ce(so,"COPY_DST",2),ce(so,"TEXTURE",4),ce(so,"STORAGE",8),ce(so,"RENDER_ATTACHMENT",16),ce(so,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),ce(so,"defaultProps",{...Er.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),ce(so,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let ns=so;const J1=class J1 extends Er{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,J1.defaultProps)}};ce(J1,"defaultProps",{...Er.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let u1=J1;function OG(i,e,t){let n="";const s=e.split(/\r?\n/),c=i.slice().sort((f,r)=>f.lineNum-r.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let f=0;for(let r=1;r<=s.length;r++)for(n+=WF(s[r-1],r,t);c.length>f&&c[f].lineNum===r;){const b=c[f++];n+=aP(b,s,b.lineNum,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const r of i)n+=aP(r,s,r.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return n}}function aP(i,e,t,n){if(n!=null&&n.inlineSource){const c=FG(e,t),f=i.linePos>0?`${" ".repeat(i.linePos+5)}^^^
`:"";return`
${c}${f}${i.type.toUpperCase()}: ${i.message}

`}const s=i.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${i.type.toUpperCase()}: ${i.message}</b></div>`:`${i.type.toUpperCase()}: ${i.message}`}function FG(i,e,t){let n="";for(let s=e-2;s<=e;s++){const c=i[s-1];c!==void 0&&(n+=WF(c,e,t))}return n}function WF(i,e,t){const n=t!=null&&t.html?zG(i):i;return`${LG(String(e),4)}: ${n}${t!=null&&t.html?"<br/>":`
`}`}function LG(i,e){let t="";for(let n=i.length;n<e;++n)t+=" ";return t+i}function zG(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Q1=class Q1 extends Er{constructor(t,n){n={...n,debugShaders:n.debugShaders||t.props.debugShaders||"errors"};super(t,{id:NG(n),...n},Q1.defaultProps);ce(this,"stage");ce(this,"source");ce(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();t==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(t){var w;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=GF(this.source),s=`${this.stage} ${n}`;let c=OG(t,this.source,{showSourceCode:"all",html:!0});const f=this.getTranslatedSource();f&&(c+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${f}</pre></code>`);const r=document.createElement("Button");r.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${c}
</pre></code>`,r.style.top="10px",r.style.left="10px",r.style.position="absolute",r.style.zIndex="9999",r.style.width="100%",r.style.textAlign="left",document.body.appendChild(r),(w=document.getElementsByClassName("luma-compiler-log-error")[0])==null||w.scrollIntoView(),r.onclick=()=>{const E=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(E)}}};ce(Q1,"defaultProps",{...Er.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let d1=Q1;function NG(i){return GF(i.source)||i.id||ww(`unnamed ${i.stage}-shader`)}function GF(i,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(i);return n?n[1]:e}const Wy=class Wy extends Er{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Wy.normalizeProps(e,t),super(e,t,Wy.defaultProps)}static normalizeProps(e,t){var c,f;const n=((f=(c=e==null?void 0:e.props)==null?void 0:c._resourceDefaults)==null?void 0:f.sampler)||{};return{...t,...n}}};ce(Wy,"defaultProps",{...Er.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let f1=Wy;const ew=class ew extends Er{constructor(t,n={}){super(t,n,ew.defaultProps);ce(this,"width");ce(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const n=this.colorAttachments.map(c=>c.texture.clone(t)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:s})}resize(t){let n=!t;if(t){const[s,c]=Array.isArray(t)?t:[t.width,t.height];n=n||c!==this.height||s!==this.width,this.width=s,this.height=c}n&&(ni.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,s)=>{if(typeof n=="string"){const c=this.createColorTexture(n,s);return this.attachResource(c),c.view}return n instanceof ns?n.view:n});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const n=this.createDepthStencilTexture(t);this.attachResource(n),this.depthStencilAttachment=n.view}else t instanceof ns?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:ns.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ns.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,n){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const c=this.colorAttachments[s].texture.clone({width:t,height:n});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=c.view,this.attachResource(c.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:t,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}};ce(ew,"defaultProps",{...Er.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let p1=ew;const tw=class tw extends Er{constructor(t,n){super(t,n,tw.defaultProps);ce(this,"shaderLayout");ce(this,"bufferLayout");ce(this,"linkStatus","pending");ce(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};ce(tw,"defaultProps",{...Er.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Pm=tw;const Dl=class Dl extends Er{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Dl.normalizeProps(e,t),super(e,t,Dl.defaultProps)}static normalizeProps(e,t){var c;return{...(c=e.props._resourceDefaults)==null?void 0:c.renderPass,...t}}};ce(Dl,"defaultClearColor",[0,0,0,1]),ce(Dl,"defaultClearDepth",1),ce(Dl,"defaultClearStencil",0),ce(Dl,"defaultProps",{...Er.defaultProps,framebuffer:null,parameters:void 0,clearColor:Dl.defaultClearColor,clearColors:void 0,clearDepth:Dl.defaultClearDepth,clearStencil:Dl.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let SS=Dl;const iw=class iw extends Er{constructor(t,n){super(t,n,iw.defaultProps);ce(this,"hash","");ce(this,"shaderLayout");this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};ce(iw,"defaultProps",{...Er.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let m1=iw;const nw=class nw extends Er{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,nw.defaultProps)}};ce(nw,"defaultProps",{...Er.defaultProps,measureExecutionTime:void 0});let ES=nw;const rw=class rw extends Er{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,rw.defaultProps)}};ce(rw,"defaultProps",{...Er.defaultProps});let CS=rw;function UG(i){const[e,t]=$G[i],n=e==="i32"||e==="u32",s=e!=="u32",c=jG[e]*t,f=VG(e,t);return{dataType:e,components:t,defaultVertexFormat:f,byteLength:c,integer:n,signed:s}}function VG(i,e){let t;switch(i){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const $G={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},jG={f32:4,f16:2,i32:4,u32:4};function XF(i){let e;i.endsWith("-webgl")&&(i.replace("-webgl",""),e=!0);const[t,n]=i.split("x"),s=t,c=n?parseInt(n):1,f=$F(s),r={type:s,components:c,byteLength:f.byteLength*c,integer:f.integer,signed:f.signed,normalized:f.normalized};return e&&(r.webglOnly=!0),r}function qF(i,e){const t={};for(const n of i.attributes){const s=WG(i,e,n.name);s&&(t[n.name]=s)}return t}function HG(i,e,t=16){const n=qF(i,e),s=new Array(t).fill(null);for(const c of Object.values(n))s[c.location]=c;return s}function WG(i,e,t){const n=GG(i,t),s=XG(e,t);if(!n)return null;const c=UG(n.type),f=(s==null?void 0:s.vertexFormat)||c.defaultVertexFormat,r=XF(f);return{attributeName:(s==null?void 0:s.attributeName)||n.name,bufferName:(s==null?void 0:s.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:c.dataType,shaderComponents:c.components,vertexFormat:f,bufferDataType:r.type,bufferComponents:r.components,normalized:r.normalized,integer:c.integer,stepMode:(s==null?void 0:s.stepMode)||n.stepMode||"vertex",byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function GG(i,e){const t=i.attributes.find(n=>n.name===e);return t||ni.warn(`shader layout attribute "${e}" not present in shader`),t||null}function XG(i,e){qG(i);let t=YG(i,e);return t||(t=ZG(i,e),t)?t:(ni.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function qG(i){for(const e of i)(e.attributes&&e.format||!e.attributes&&!e.format)&&ni.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function YG(i,e){for(const t of i)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function ZG(i,e){var t;for(const n of i){let s=n.byteStride;if(typeof n.byteStride!="number")for(const f of n.attributes||[]){const r=XF(f.format);s+=r.byteLength}const c=(t=n.attributes)==null?void 0:t.find(f=>f.attribute===e);if(c)return{attributeName:c.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:c.format,byteOffset:c.byteOffset,byteStride:s}}return null}const sw=class sw extends Er{constructor(t,n){super(t,n,sw.defaultProps);ce(this,"maxVertexAttributes");ce(this,"attributeInfos");ce(this,"indexBuffer",null);ce(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:c}=n.renderPipeline||{};if(!s||!c)throw new Error("VertexArray");this.attributeInfos=HG(s,c,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,n){this.device.reportError(new Error("constant attributes not supported"))}};ce(sw,"defaultProps",{...Er.defaultProps,renderPipeline:null});let IS=sw;const ow=class ow extends Er{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,ow.defaultProps)}};ce(ow,"defaultProps",{...Er.defaultProps,layout:void 0,buffers:{}});let MS=ow;const aw=class aw extends Er{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,aw.defaultProps)}};ce(aw,"defaultProps",{...Er.defaultProps,type:void 0,count:void 0});let RS=aw;const KG={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function JG(i){return KG[i]}function QG(i,e){switch(e){case 1:return i;case 2:return i+i%2;default:return i+(4-i%4)%4}}let Wv;function YF(i){return(!Wv||Wv.byteLength<i)&&(Wv=new ArrayBuffer(i)),Wv}function eX(i,e){const t=YF(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function tX(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function g1(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":tX(i)}const lP=1024;class iX{constructor(e){ce(this,"layout",{});ce(this,"byteLength");let t=0;for(const[s,c]of Object.entries(e)){const f=JG(c),{type:r,components:b}=f;t=QG(t,b);const w=t;t+=b,this.layout[s]={type:r,size:b,offset:w}}t+=(4-t%4)%4;const n=t*4;this.byteLength=Math.max(n,lP)}getData(e){const t=Math.max(this.byteLength,lP),n=YF(t),s={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[c,f]of Object.entries(e)){const r=this.layout[c];if(!r){ni.warn(`Supplied uniform value ${c} not present in uniform block layout`)();continue}const{type:b,size:w,offset:E}=r,k=s[b];if(w===1){if(typeof f!="number"&&typeof f!="boolean"){ni.warn(`Supplied value for single component uniform ${c} is not a number: ${f}`)();continue}k[E]=Number(f)}else{if(!g1(f)){ni.warn(`Supplied value for multi component / array uniform ${c} is not a numeric array: ${f}`)();continue}k.set(f,E)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function nX(i,e,t=16){if(i!==e)return!1;const n=i,s=e;if(!g1(n))return!1;if(g1(s)&&n.length===s.length){for(let c=0;c<n.length;++c)if(s[c]!==n[c])return!1}return!0}function rX(i){return g1(i)?i.slice():i}class sX{constructor(e){ce(this,"name");ce(this,"uniforms",{});ce(this,"modifiedUniforms",{});ce(this,"modified",!0);ce(this,"bindingLayout",{});ce(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(c=>c.type==="uniform"&&c.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const s=n;for(const c of s.uniforms||[])this.bindingLayout[c.name]=c}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){nX(this.uniforms[e],t)||(this.uniforms[e]=rX(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class oX{constructor(e){ce(this,"uniformBlocks",new Map);ce(this,"uniformBufferLayouts",new Map);ce(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const s=t,c=new iX(n.uniformTypes||{});this.uniformBufferLayouts.set(s,c);const f=new sX({name:t});f.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(s,f)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,s]of Object.entries(e))(t=this.uniformBlocks.get(n))==null||t.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var n,s;const t=((n=this.uniformBlocks.get(e))==null?void 0:n.getAllUniforms())||{};return(s=this.uniformBufferLayouts.get(e))==null?void 0:s.getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const s=this.getUniformBufferByteLength(t),c=e.createBuffer({usage:Hr.UNIFORM|Hr.COPY_DST,byteLength:s}),f=this.getUniformBufferData(t);return c.write(f),c}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Hr.UNIFORM|Hr.COPY_DST,byteLength:n});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&ni.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var c;const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),s=!1;if(n&&(t!=null&&t.needsRedraw)){s||(s=t.needsRedraw);const f=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n==null||n.write(f);const r=(c=this.uniformBlocks.get(e))==null?void 0:c.getAllUniforms();ni.log(4,`Writing to uniform buffer ${String(e)}`,f,r)()}return s}}function ZF(i){const e=ArrayBuffer.isView(i)?i.constructor:i;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function KF(i){switch(i){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(i)}}function aX(i,e,t){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let s=ZF(i);if(s==="uint8"&&t&&n===1)return"unorm8-webgl";if(s==="uint8"&&t&&n===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${n}`}if(s==="uint16"||s==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${n}`}return n===1?s:`${s}x${n}`}class s2{constructor(e){ce(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const s of t){const c=n.findIndex(f=>f.name===s.name);c<0?n.push(s):n[c]=s}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(n=>n.name===e);return t===-1&&ni.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function lX(i,e){const t=Object.fromEntries(i.attributes.map(s=>[s.name,s.location])),n=e.slice();return n.sort((s,c)=>{const f=s.attributes?s.attributes.map(E=>E.attribute):[s.name],r=c.attributes?c.attributes.map(E=>E.attribute):[c.name],b=Math.min(...f.map(E=>t[E])),w=Math.min(...r.map(E=>t[E]));return b-w}),n}class ll{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class cP{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ru extends ll{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Fu extends ll{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class kS extends ll{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class wf extends ll{constructor(e,t,n,s){super(e,n),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Su;(i=>{i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})(Su||(Su={}));class Gv{constructor(e,t,n,s,c,f,r){this.name=e,this.type=t,this.group=n,this.binding=s,this.attributes=c,this.resourceType=f,this.access=r}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class cX{constructor(e,t){this.name=e,this.type=t}}class hX{constructor(e,t,n,s){this.name=e,this.type=t,this.locationType=n,this.location=s,this.interpolation=null}}class hP{constructor(e,t,n,s){this.name=e,this.type=t,this.locationType=n,this.location=s}}class uX{constructor(e,t,n,s){this.name=e,this.type=t,this.attributes=n,this.id=s}}class dX{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class fX{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class pX{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const JF=new Float32Array(1),mX=new Int32Array(JF.buffer),So=new Uint16Array(1);function gX(i){JF[0]=i;const e=mX[0],t=e>>31&1;let n=e>>23&255,s=8388607&e;if(n===255)return So[0]=t<<15|31744|(s!==0?512:0),So[0];if(n===0){if(s===0)return So[0]=t<<15,So[0];s|=8388608;let c=113;for(;!(8388608&s);)s<<=1,c--;return n=127-c,s&=8388607,n>0?(s=(s>>126-n)+(s>>127-n&1),So[0]=t<<15|n<<10|s>>13,So[0]):(So[0]=t<<15,So[0])}return n=n-127+15,n>=31?(So[0]=t<<15|31744,So[0]):n<=0?n<-10?(So[0]=t<<15,So[0]):(s=(8388608|s)>>1-n,So[0]=t<<15|s>>13,So[0]):(s>>=13,So[0]=t<<15|n<<10|s,So[0])}const iC=new Uint32Array(1),QF=new Float32Array(iC.buffer,0,1);function uP(i){const e=112+(i>>6&31)<<23|(63&i)<<17;return iC[0]=e,QF[0]}function _X(i,e,t,n,s,c,f,r,b){const w=n*(f>>=s)*(c>>=s)+t*f+e*r;switch(b){case"r8unorm":return[ur(i,w,"8unorm",1)[0]];case"r8snorm":return[ur(i,w,"8snorm",1)[0]];case"r8uint":return[ur(i,w,"8uint",1)[0]];case"r8sint":return[ur(i,w,"8sint",1)[0]];case"rg8unorm":{const E=ur(i,w,"8unorm",2);return[E[0],E[1]]}case"rg8snorm":{const E=ur(i,w,"8snorm",2);return[E[0],E[1]]}case"rg8uint":{const E=ur(i,w,"8uint",2);return[E[0],E[1]]}case"rg8sint":{const E=ur(i,w,"8sint",2);return[E[0],E[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const E=ur(i,w,"8unorm",4);return[E[0],E[1],E[2],E[3]]}case"rgba8snorm":{const E=ur(i,w,"8snorm",4);return[E[0],E[1],E[2],E[3]]}case"rgba8uint":{const E=ur(i,w,"8uint",4);return[E[0],E[1],E[2],E[3]]}case"rgba8sint":{const E=ur(i,w,"8sint",4);return[E[0],E[1],E[2],E[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const E=ur(i,w,"8unorm",4);return[E[2],E[1],E[0],E[3]]}case"r16uint":return[ur(i,w,"16uint",1)[0]];case"r16sint":return[ur(i,w,"16sint",1)[0]];case"r16float":return[ur(i,w,"16float",1)[0]];case"rg16uint":{const E=ur(i,w,"16uint",2);return[E[0],E[1]]}case"rg16sint":{const E=ur(i,w,"16sint",2);return[E[0],E[1]]}case"rg16float":{const E=ur(i,w,"16float",2);return[E[0],E[1]]}case"rgba16uint":{const E=ur(i,w,"16uint",4);return[E[0],E[1],E[2],E[3]]}case"rgba16sint":{const E=ur(i,w,"16sint",4);return[E[0],E[1],E[2],E[3]]}case"rgba16float":{const E=ur(i,w,"16float",4);return[E[0],E[1],E[2],E[3]]}case"r32uint":return[ur(i,w,"32uint",1)[0]];case"r32sint":return[ur(i,w,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[ur(i,w,"32float",1)[0]];case"rg32uint":{const E=ur(i,w,"32uint",2);return[E[0],E[1]]}case"rg32sint":{const E=ur(i,w,"32sint",2);return[E[0],E[1]]}case"rg32float":{const E=ur(i,w,"32float",2);return[E[0],E[1]]}case"rgba32uint":{const E=ur(i,w,"32uint",4);return[E[0],E[1],E[2],E[3]]}case"rgba32sint":{const E=ur(i,w,"32sint",4);return[E[0],E[1],E[2],E[3]]}case"rgba32float":{const E=ur(i,w,"32float",4);return[E[0],E[1],E[2],E[3]]}case"rg11b10ufloat":{const E=new Uint32Array(i.buffer,w,1)[0],k=(4192256&E)>>11,F=(4290772992&E)>>22;return[uP(2047&E),uP(k),function($){const X=112+($>>5&31)<<23|(31&$)<<18;return iC[0]=X,QF[0]}(F),1]}}return null}function ur(i,e,t,n){const s=[0,0,0,0];for(let w=0;w<n;++w)switch(t){case"8unorm":s[w]=i[e]/255,e++;break;case"8snorm":s[w]=i[e]/255*2-1,e++;break;case"8uint":s[w]=i[e],e++;break;case"8sint":s[w]=i[e]-127,e++;break;case"16uint":s[w]=i[e]|i[e+1]<<8,e+=2;break;case"16sint":s[w]=(i[e]|i[e+1]<<8)-32768,e+=2;break;case"16float":s[w]=(c=i[e]|i[e+1]<<8,f=void 0,r=void 0,b=void 0,f=(32768&c)>>15,b=1023&c,(r=(31744&c)>>10)==0?(f?-1:1)*Math.pow(2,-14)*(b/Math.pow(2,10)):r==31?b?NaN:1/0*(f?-1:1):(f?-1:1)*Math.pow(2,r-15)*(1+b/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":s[w]=i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24,e+=4;break;case"32float":s[w]=new Float32Array(i.buffer,e,1)[0],e+=4}var c,f,r,b;return s}function mr(i,e,t,n,s){for(let c=0;c<n;++c)switch(t){case"8unorm":i[e]=255*s[c],e++;break;case"8snorm":i[e]=.5*(s[c]+1)*255,e++;break;case"8uint":i[e]=s[c],e++;break;case"8sint":i[e]=s[c]+127,e++;break;case"16uint":new Uint16Array(i.buffer,e,1)[0]=s[c],e+=2;break;case"16sint":new Int16Array(i.buffer,e,1)[0]=s[c],e+=2;break;case"16float":{const f=gX(s[c]);new Uint16Array(i.buffer,e,1)[0]=f,e+=2;break}case"32uint":new Uint32Array(i.buffer,e,1)[0]=s[c],e+=4;break;case"32sint":new Int32Array(i.buffer,e,1)[0]=s[c],e+=4;break;case"32float":new Float32Array(i.buffer,e,1)[0]=s[c],e+=4}return s}const o2={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class fl{constructor(){this.id=fl._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(_1.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(y1.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}fl._id=0;class _1 extends fl{}_1.instance=new _1;class y1 extends fl{}y1.instance=new y1;const eL=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Wr extends fl{constructor(){super()}}class Zy extends Wr{constructor(e,t,n,s,c,f){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=s,this.startLine=c,this.endLine=f}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class yX extends Wr{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class tL extends Wr{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class PS extends Wr{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class iL extends Wr{constructor(e,t,n,s){super(),this.init=e,this.condition=t,this.increment=n,this.body=s}get astNodeType(){return"for"}search(e){var t,n,s;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class xh extends Wr{constructor(e,t,n,s,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=c}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class nC extends Wr{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Ry extends Wr{constructor(e,t,n,s,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=c}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Bx extends Wr{constructor(e,t,n,s,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=c}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var fm,ay,bt,ot;(i=>{i.increment="++",i.decrement="--"})(fm||(fm={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return i[t]}})(fm||(fm={}));class nL extends Wr{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(i=>{i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(ay||(ay={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(ay||(ay={}));class rL extends Wr{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class rC extends Wr{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return eL.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class sL extends Wr{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class oL extends Wr{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class aL extends Wr{constructor(e,t,n,s){super(),this.condition=e,this.body=t,this.elseif=n,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class lL extends Wr{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class bX extends Wr{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class vX extends Wr{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class cL extends Wr{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class sC extends Wr{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class xX extends Wr{constructor(){super()}get astNodeType(){return"discard"}}class hL extends Wr{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class uL extends Wr{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Ht extends Wr{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const s=Ht._priority.get(t.name);Ht._priority.get(e[n].name)<s&&(t=e[n])}return t.name==="x32"?Ht.i32:t}getTypeName(){return this.name}}Ht.x32=new Ht("x32"),Ht.f32=new Ht("f32"),Ht.i32=new Ht("i32"),Ht.u32=new Ht("u32"),Ht.f16=new Ht("f16"),Ht.bool=new Ht("bool"),Ht.void=new Ht("void"),Ht._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class dP extends Ht{constructor(e){super(e)}}class _h extends Ht{constructor(e,t,n,s){super(e),this.members=t,this.startLine=n,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class dt extends Ht{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}dt.vec2f=new dt("vec2",Ht.f32,null),dt.vec3f=new dt("vec3",Ht.f32,null),dt.vec4f=new dt("vec4",Ht.f32,null),dt.vec2i=new dt("vec2",Ht.i32,null),dt.vec3i=new dt("vec3",Ht.i32,null),dt.vec4i=new dt("vec4",Ht.i32,null),dt.vec2u=new dt("vec2",Ht.u32,null),dt.vec3u=new dt("vec3",Ht.u32,null),dt.vec4u=new dt("vec4",Ht.u32,null),dt.vec2h=new dt("vec2",Ht.f16,null),dt.vec3h=new dt("vec3",Ht.f16,null),dt.vec4h=new dt("vec4",Ht.f16,null),dt.vec2b=new dt("vec2",Ht.bool,null),dt.vec3b=new dt("vec3",Ht.bool,null),dt.vec4b=new dt("vec4",Ht.bool,null),dt.mat2x2f=new dt("mat2x2",Ht.f32,null),dt.mat2x3f=new dt("mat2x3",Ht.f32,null),dt.mat2x4f=new dt("mat2x4",Ht.f32,null),dt.mat3x2f=new dt("mat3x2",Ht.f32,null),dt.mat3x3f=new dt("mat3x3",Ht.f32,null),dt.mat3x4f=new dt("mat3x4",Ht.f32,null),dt.mat4x2f=new dt("mat4x2",Ht.f32,null),dt.mat4x3f=new dt("mat4x3",Ht.f32,null),dt.mat4x4f=new dt("mat4x4",Ht.f32,null),dt.mat2x2h=new dt("mat2x2",Ht.f16,null),dt.mat2x3h=new dt("mat2x3",Ht.f16,null),dt.mat2x4h=new dt("mat2x4",Ht.f16,null),dt.mat3x2h=new dt("mat3x2",Ht.f16,null),dt.mat3x3h=new dt("mat3x3",Ht.f16,null),dt.mat3x4h=new dt("mat3x4",Ht.f16,null),dt.mat4x2h=new dt("mat4x2",Ht.f16,null),dt.mat4x3h=new dt("mat4x3",Ht.f16,null),dt.mat4x4h=new dt("mat4x4",Ht.f16,null),dt.mat2x2i=new dt("mat2x2",Ht.i32,null),dt.mat2x3i=new dt("mat2x3",Ht.i32,null),dt.mat2x4i=new dt("mat2x4",Ht.i32,null),dt.mat3x2i=new dt("mat3x2",Ht.i32,null),dt.mat3x3i=new dt("mat3x3",Ht.i32,null),dt.mat3x4i=new dt("mat3x4",Ht.i32,null),dt.mat4x2i=new dt("mat4x2",Ht.i32,null),dt.mat4x3i=new dt("mat4x3",Ht.i32,null),dt.mat4x4i=new dt("mat4x4",Ht.i32,null),dt.mat2x2u=new dt("mat2x2",Ht.u32,null),dt.mat2x3u=new dt("mat2x3",Ht.u32,null),dt.mat2x4u=new dt("mat2x4",Ht.u32,null),dt.mat3x2u=new dt("mat3x2",Ht.u32,null),dt.mat3x3u=new dt("mat3x3",Ht.u32,null),dt.mat3x4u=new dt("mat3x4",Ht.u32,null),dt.mat4x2u=new dt("mat4x2",Ht.u32,null),dt.mat4x3u=new dt("mat4x3",Ht.u32,null),dt.mat4x4u=new dt("mat4x4",Ht.u32,null);class Ox extends Ht{constructor(e,t,n,s){super(e),this.storage=t,this.type=n,this.access=s}get astNodeType(){return"pointer"}}class ky extends Ht{constructor(e,t,n,s){super(e),this.attributes=t,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class ly extends Ht{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class ql extends fl{constructor(){super(),this.postfix=null}}class Af extends ql{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Tc extends ql{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class oC extends ql{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return eL.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Pa extends ql{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class dL extends ql{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class Bs extends ql{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof rt}get isVector(){return this.value instanceof Ne||this.value instanceof nn}get scalarValue(){return this.value instanceof rt?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Ne||this.value instanceof nn?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class fL extends ql{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Dm extends ql{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class pL extends ql{constructor(){super()}}class As extends pL{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Pl extends pL{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Ht.f32:e.name==="u32"||t.name==="u32"?Ht.u32:Ht.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class mL extends fl{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Fx extends ql{constructor(){super()}get astNodeType(){return"default"}}class gL extends mL{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class _L extends mL{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class fP extends fl{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class wX extends fl{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class pP extends fl{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class yL extends fl{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class hl{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=hl._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}hl._id=0;class DS extends hl{constructor(){super(new ll("void",null),null)}toString(){return"void"}}DS.void=new DS;class rm extends hl{constructor(e){super(new kS("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,s){this.reference.setDataValue(e,t,n,s)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class rt extends hl{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new rt(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new rt(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new rt(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,s){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof rt))return void console.error("SetDataValue: Invalid value",t);let c=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?c=Math.floor(c):this.typeInfo.name==="bool"&&(c=c?1:0),this.data[0]=c}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function AX(i,e,t){const n=e.length;return n===2?t==="f32"?new Ne(new Float32Array(e),i.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new Ne(new Int32Array(e),i.getTypeInfo("vec2i")):t==="u32"?new Ne(new Uint32Array(e),i.getTypeInfo("vec2u")):t==="f16"?new Ne(new Float32Array(e),i.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):n===3?t==="f32"?new Ne(new Float32Array(e),i.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new Ne(new Int32Array(e),i.getTypeInfo("vec3i")):t==="u32"?new Ne(new Uint32Array(e),i.getTypeInfo("vec3u")):t==="f16"?new Ne(new Float32Array(e),i.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):n===4?t==="f32"?new Ne(new Float32Array(e),i.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new Ne(new Int32Array(e),i.getTypeInfo("vec4i")):t==="u32"?new Ne(new Uint32Array(e),i.getTypeInfo("vec4u")):t==="f16"?new Ne(new Float32Array(e),i.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Ne extends hl{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new Ne(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ne(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ne(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,s){n instanceof Af?console.error("TODO: Set vector postfix"):t instanceof Ne?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof wf)s=this.typeInfo.format||s;else{const f=this.typeInfo.name;f==="vec2f"||f==="vec3f"||f==="vec4f"?s=e.getTypeInfo("f32"):f==="vec2i"||f==="vec3i"||f==="vec4i"?s=e.getTypeInfo("i32"):f==="vec2b"||f==="vec3b"||f==="vec4b"?s=e.getTypeInfo("bool"):f==="vec2u"||f==="vec3u"||f==="vec4u"?s=e.getTypeInfo("u32"):f==="vec2h"||f==="vec3h"||f==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${f}`)}let c=this;for(;t!==null&&c!==null;){if(t instanceof Dm){const f=t.index;let r=-1;if(f instanceof Bs){if(!(f.value instanceof rt))return console.error(`GetSubData: Invalid array index ${f.value}`),null;r=f.value.value}else{const b=e.evalExpression(f,n);if(!(b instanceof rt))return console.error("GetSubData: Unknown index type",f),null;r=b.value}if(r<0||r>=c.data.length)return console.error("GetSubData: Index out of range",r),null;if(c.data instanceof Float32Array){const b=new Float32Array(c.data.buffer,c.data.byteOffset+4*r,1);return new rt(b,s)}if(c.data instanceof Int32Array){const b=new Int32Array(c.data.buffer,c.data.byteOffset+4*r,1);return new rt(b,s)}if(c.data instanceof Uint32Array){const b=new Uint32Array(c.data.buffer,c.data.byteOffset+4*r,1);return new rt(b,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof Af))return console.error("GetSubData: Unknown postfix",t),null;{const f=t.value.toLowerCase();if(f.length===1){let b=0;if(f==="x"||f==="r")b=0;else if(f==="y"||f==="g")b=1;else if(f==="z"||f==="b")b=2;else{if(f!=="w"&&f!=="a")return console.error(`GetSubData: Unknown member ${f}`),null;b=3}if(this.data instanceof Float32Array){let w=new Float32Array(this.data.buffer,this.data.byteOffset+4*b,1);return new rt(w,s,this)}if(this.data instanceof Int32Array){let w=new Int32Array(this.data.buffer,this.data.byteOffset+4*b,1);return new rt(w,s,this)}if(this.data instanceof Uint32Array){let w=new Uint32Array(this.data.buffer,this.data.byteOffset+4*b,1);return new rt(w,s,this)}}const r=[];for(const b of f)b==="x"||b==="r"?r.push(this.data[0]):b==="y"||b==="g"?r.push(this.data[1]):b==="z"||b==="b"?r.push(this.data[2]):b==="w"||b==="a"?r.push(this.data[3]):console.error(`GetDataValue: Unknown member ${b}`);c=AX(e,r,s.name)}t=t.postfix}return c}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class nn extends hl{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new nn(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,s){n instanceof Af?console.error("TODO: Set matrix postfix"):t instanceof nn?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof wf)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof Dm){const c=t.index;let f=-1;if(c instanceof Bs){if(!(c.value instanceof rt))return console.error(`GetDataValue: Invalid array index ${c.value}`),null;f=c.value.value}else{const w=e.evalExpression(c,n);if(!(w instanceof rt))return console.error("GetDataValue: Unknown index type",c),null;f=w.value}if(f<0||f>=this.data.length)return console.error("GetDataValue: Index out of range",f),null;const r=s.endsWith("h")?"h":"f";let b;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")b=new Ne(new Float32Array(this.data.buffer,this.data.byteOffset+2*f*4,2),e.getTypeInfo(`vec2${r}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")b=new Ne(new Float32Array(this.data.buffer,this.data.byteOffset+3*f*4,3),e.getTypeInfo(`vec3${r}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;b=new Ne(new Float32Array(this.data.buffer,this.data.byteOffset+4*f*4,4),e.getTypeInfo(`vec4${r}`))}return t.postfix?b.getSubData(e,t.postfix,n):b}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class rs extends hl{constructor(e,t,n=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new rs(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,s){if(t===null)return void console.log("setDataValue: NULL data.");let c=this.offset,f=this.typeInfo;for(;n;){if(n instanceof Dm)if(f instanceof Fu){const r=n.index;if(r instanceof Bs){if(!(r.value instanceof rt))return void console.error(`SetDataValue: Invalid index type ${r.value}`);c+=r.value.value*f.stride}else{const b=e.evalExpression(r,s);if(!(b instanceof rt))return void console.error("SetDataValue: Unknown index type",r);c+=b.value*f.stride}f=f.format}else console.error(`SetDataValue: Type ${f.getTypeName()} is not an array`);else{if(!(n instanceof Af))return void console.error("SetDataValue: Unknown postfix type",n);{const r=n.value;if(f instanceof Ru){let b=!1;for(const w of f.members)if(w.name===r){c+=w.offset,f=w.type,b=!0;break}if(!b)return void console.error(`SetDataValue: Member ${r} not found`)}else if(f instanceof ll){const b=f.getTypeName();let w=0;if(r==="x"||r==="r")w=0;else if(r==="y"||r==="g")w=1;else if(r==="z"||r==="b")w=2;else{if(r!=="w"&&r!=="a")return void console.error(`SetDataValue: Unknown member ${r}`);w=3}if(!(t instanceof rt))return void console.error("SetDataValue: Invalid value",t);const E=t.value;return b==="vec2f"?void(new Float32Array(this.buffer,c,2)[w]=E):b==="vec3f"?void(new Float32Array(this.buffer,c,3)[w]=E):b==="vec4f"?void(new Float32Array(this.buffer,c,4)[w]=E):b==="vec2i"?void(new Int32Array(this.buffer,c,2)[w]=E):b==="vec3i"?void(new Int32Array(this.buffer,c,3)[w]=E):b==="vec4i"?void(new Int32Array(this.buffer,c,4)[w]=E):b==="vec2u"?void(new Uint32Array(this.buffer,c,2)[w]=E):b==="vec3u"?void(new Uint32Array(this.buffer,c,3)[w]=E):b==="vec4u"?void(new Uint32Array(this.buffer,c,4)[w]=E):void console.error(`SetDataValue: Type ${b} is not a struct`)}}}n=n.postfix}this.setData(e,t,f,c,s)}setData(e,t,n,s,c){const f=n.getTypeName();if(f!=="f32"&&f!=="f16")if(f!=="i32"&&f!=="atomic<i32>"&&f!=="x32")if(f!=="u32"&&f!=="atomic<u32>")if(f!=="bool")if(f!=="vec2f"&&f!=="vec2h")if(f!=="vec3f"&&f!=="vec3h")if(f!=="vec4f"&&f!=="vec4h")if(f!=="vec2i")if(f!=="vec3i")if(f!=="vec4i")if(f!=="vec2u")if(f!=="vec3u")if(f!=="vec4u")if(f!=="vec2b")if(f!=="vec3b")if(f!=="vec4b")if(f!=="mat2x2f"&&f!=="mat2x2h")if(f!=="mat2x3f"&&f!=="mat2x3h")if(f!=="mat2x4f"&&f!=="mat2x4h")if(f!=="mat3x2f"&&f!=="mat3x2h")if(f!=="mat3x3f"&&f!=="mat3x3h")if(f!=="mat3x4f"&&f!=="mat3x4h")if(f!=="mat4x2f"&&f!=="mat4x2h")if(f!=="mat4x3f"&&f!=="mat4x3h")if(f!=="mat4x4f"&&f!=="mat4x4h")if(t instanceof rs){if(n===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",f,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${f}`);else{const r=new Float32Array(this.buffer,s,16);t instanceof nn?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3],r[4]=t.data[4],r[5]=t.data[5],r[6]=t.data[6],r[7]=t.data[7],r[8]=t.data[8],r[9]=t.data[9],r[10]=t.data[10],r[11]=t.data[11],r[12]=t.data[12],r[13]=t.data[13],r[14]=t.data[14],r[15]=t.data[15]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15])}else{const r=new Float32Array(this.buffer,s,12);t instanceof nn?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3],r[4]=t.data[4],r[5]=t.data[5],r[6]=t.data[6],r[7]=t.data[7],r[8]=t.data[8],r[9]=t.data[9],r[10]=t.data[10],r[11]=t.data[11]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11])}else{const r=new Float32Array(this.buffer,s,8);t instanceof nn?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3],r[4]=t.data[4],r[5]=t.data[5],r[6]=t.data[6],r[7]=t.data[7]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7])}else{const r=new Float32Array(this.buffer,s,12);t instanceof nn?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3],r[4]=t.data[4],r[5]=t.data[5],r[6]=t.data[6],r[7]=t.data[7],r[8]=t.data[8],r[9]=t.data[9],r[10]=t.data[10],r[11]=t.data[11]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11])}else{const r=new Float32Array(this.buffer,s,9);t instanceof nn?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3],r[4]=t.data[4],r[5]=t.data[5],r[6]=t.data[6],r[7]=t.data[7],r[8]=t.data[8]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8])}else{const r=new Float32Array(this.buffer,s,6);t instanceof nn?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3],r[4]=t.data[4],r[5]=t.data[5]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5])}else{const r=new Float32Array(this.buffer,s,8);t instanceof nn?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3],r[4]=t.data[4],r[5]=t.data[5],r[6]=t.data[6],r[7]=t.data[7]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7])}else{const r=new Float32Array(this.buffer,s,6);t instanceof nn?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3],r[4]=t.data[4],r[5]=t.data[5]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5])}else{const r=new Float32Array(this.buffer,s,4);t instanceof nn?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3])}else{const r=new Uint32Array(this.buffer,s,4);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3])}else{const r=new Uint32Array(this.buffer,s,3);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2]):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}else{const r=new Uint32Array(this.buffer,s,2);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1]):(r[0]=t[0],r[1]=t[1])}else{const r=new Uint32Array(this.buffer,s,4);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3])}else{const r=new Uint32Array(this.buffer,s,3);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2]):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}else{const r=new Uint32Array(this.buffer,s,2);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1]):(r[0]=t[0],r[1]=t[1])}else{const r=new Int32Array(this.buffer,s,4);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3])}else{const r=new Int32Array(this.buffer,s,3);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2]):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}else{const r=new Int32Array(this.buffer,s,2);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1]):(r[0]=t[0],r[1]=t[1])}else{const r=new Float32Array(this.buffer,s,4);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2],r[3]=t.data[3]):(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3])}else{const r=new Float32Array(this.buffer,s,3);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1],r[2]=t.data[2]):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}else{const r=new Float32Array(this.buffer,s,2);t instanceof Ne?(r[0]=t.data[0],r[1]=t.data[1]):(r[0]=t[0],r[1]=t[1])}else t instanceof rt&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof rt&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof rt&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof rt&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,n){var s,c,f;if(t===null)return this;let r=this.offset,b=this.typeInfo;for(;t;){if(t instanceof Dm){const E=t.index,k=E instanceof ql?e.evalExpression(E,n):E;let F=0;if(k instanceof rt?F=k.value:typeof k=="number"?F=k:console.error("GetDataValue: Invalid index type",E),b instanceof Fu)r+=F*b.stride,b=b.format;else{const $=b.getTypeName();$==="mat4x4"||$==="mat4x4f"||$==="mat4x4h"?(r+=16*F,b=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${b.getTypeName()} is not an array`)}}else{if(!(t instanceof Af))return console.error("GetDataValue: Unknown postfix type",t),null;{const E=t.value;if(b instanceof Ru){let k=!1;for(const F of b.members)if(F.name===E){r+=F.offset,b=F.type,k=!0;break}if(!k)return console.error(`GetDataValue: Member ${E} not found`),null}else if(b instanceof ll){const k=b.getTypeName();if(k==="vec2f"||k==="vec3f"||k==="vec4f"||k==="vec2i"||k==="vec3i"||k==="vec4i"||k==="vec2u"||k==="vec3u"||k==="vec4u"||k==="vec2b"||k==="vec3b"||k==="vec4b"||k==="vec2h"||k==="vec3h"||k==="vec4h"||k==="vec2"||k==="vec3"||k==="vec4"){if(E.length>0&&E.length<5){let F="f";const $=[];for(let X=0;X<E.length;++X){const W=E[X].toLowerCase();let ne=0;if(W==="x"||W==="r")ne=0;else if(W==="y"||W==="g")ne=1;else if(W==="z"||W==="b")ne=2;else{if(W!=="w"&&W!=="a")return console.error(`Unknown member ${E}`),null;ne=3}if(E.length===1){if(k.endsWith("f"))return this.buffer.byteLength<r+4*ne+4?(console.log("Insufficient buffer data"),null):new rt(new Float32Array(this.buffer,r+4*ne,1),e.getTypeInfo("f32"),this);if(k.endsWith("h"))return new rt(new Float32Array(this.buffer,r+4*ne,1),e.getTypeInfo("f16"),this);if(k.endsWith("i"))return new rt(new Int32Array(this.buffer,r+4*ne,1),e.getTypeInfo("i32"),this);if(k.endsWith("b"))return new rt(new Int32Array(this.buffer,r+4*ne,1),e.getTypeInfo("bool"),this);if(k.endsWith("u"))return new rt(new Uint32Array(this.buffer,r+4*ne,1),e.getTypeInfo("i32"),this)}if(k==="vec2f")$.push(new Float32Array(this.buffer,r,2)[ne]);else if(k==="vec3f"){if(r+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const _e=new Float32Array(this.buffer,r,3);$.push(_e[ne])}else if(k==="vec4f")$.push(new Float32Array(this.buffer,r,4)[ne]);else if(k==="vec2i")F="i",$.push(new Int32Array(this.buffer,r,2)[ne]);else if(k==="vec3i")F="i",$.push(new Int32Array(this.buffer,r,3)[ne]);else if(k==="vec4i")F="i",$.push(new Int32Array(this.buffer,r,4)[ne]);else if(k==="vec2u"){F="u";const _e=new Uint32Array(this.buffer,r,2);$.push(_e[ne])}else k==="vec3u"?(F="u",$.push(new Uint32Array(this.buffer,r,3)[ne])):k==="vec4u"&&(F="u",$.push(new Uint32Array(this.buffer,r,4)[ne]))}return $.length===2?b=e.getTypeInfo(`vec2${F}`):$.length===3?b=e.getTypeInfo(`vec3${F}`):$.length===4?b=e.getTypeInfo(`vec4${F}`):console.error(`GetDataValue: Invalid vector length ${$.length}`),new Ne($,b,null)}return console.error(`GetDataValue: Unknown member ${E}`),null}return console.error(`GetDataValue: Type ${k} is not a struct`),null}}}t=t.postfix}const w=b.getTypeName();return w==="f32"?new rt(new Float32Array(this.buffer,r,1),b,this):w==="i32"?new rt(new Int32Array(this.buffer,r,1),b,this):w==="u32"?new rt(new Uint32Array(this.buffer,r,1),b,this):w==="vec2f"?new Ne(new Float32Array(this.buffer,r,2),b,this):w==="vec3f"?new Ne(new Float32Array(this.buffer,r,3),b,this):w==="vec4f"?new Ne(new Float32Array(this.buffer,r,4),b,this):w==="vec2i"?new Ne(new Int32Array(this.buffer,r,2),b,this):w==="vec3i"?new Ne(new Int32Array(this.buffer,r,3),b,this):w==="vec4i"?new Ne(new Int32Array(this.buffer,r,4),b,this):w==="vec2u"?new Ne(new Uint32Array(this.buffer,r,2),b,this):w==="vec3u"?new Ne(new Uint32Array(this.buffer,r,3),b,this):w==="vec4u"?new Ne(new Uint32Array(this.buffer,r,4),b,this):b instanceof wf&&b.name==="atomic"?((s=b.format)===null||s===void 0?void 0:s.name)==="u32"?new rt(new Uint32Array(this.buffer,r,1)[0],b.format,this):((c=b.format)===null||c===void 0?void 0:c.name)==="i32"?new rt(new Int32Array(this.buffer,r,1)[0],b.format,this):(console.error(`GetDataValue: Invalid atomic format ${(f=b.format)===null||f===void 0?void 0:f.name}`),null):new rs(this.buffer,b,r,this)}toString(){let e="";if(this.typeInfo instanceof Fu)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof Ru?e+="{...}":e="[...]";return e}}class yh extends hl{constructor(e,t,n,s){super(t,null),this.data=e,this.descriptor=n,this.view=s}clone(){return new yh(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.width)!==null&&t!==void 0?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=o2[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=o2[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=o2[e],n=this.width;if(!e||n<=0||!t)return-1;const s=this.height,c=this.depthOrArrayLayers,f=this.dimension;return n/t.blockWidth*(f==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*c}getPixel(e,t,n=0,s=0){const c=this.texelByteSize,f=this.bytesPerRow,r=this.height,b=this.data[s];return _X(new Uint8Array(b),e,t,n,s,r,f,c,this.format)}setPixel(e,t,n,s,c){const f=this.texelByteSize,r=this.bytesPerRow,b=this.height,w=this.data[s];(function(E,k,F,$,X,W,ne,_e,Te,we){const Ee=$*(ne>>=X)*(W>>=X)+F*ne+k*_e;switch(Te){case"r8unorm":return void mr(E,Ee,"8unorm",1,we);case"r8snorm":return void mr(E,Ee,"8snorm",1,we);case"r8uint":return void mr(E,Ee,"8uint",1,we);case"r8sint":return void mr(E,Ee,"8sint",1,we);case"rg8unorm":return void mr(E,Ee,"8unorm",2,we);case"rg8snorm":return void mr(E,Ee,"8snorm",2,we);case"rg8uint":return void mr(E,Ee,"8uint",2,we);case"rg8sint":return void mr(E,Ee,"8sint",2,we);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void mr(E,Ee,"8unorm",4,we);case"rgba8snorm":return void mr(E,Ee,"8snorm",4,we);case"rgba8uint":return void mr(E,Ee,"8uint",4,we);case"rgba8sint":return void mr(E,Ee,"8sint",4,we);case"r16uint":return void mr(E,Ee,"16uint",1,we);case"r16sint":return void mr(E,Ee,"16sint",1,we);case"r16float":return void mr(E,Ee,"16float",1,we);case"rg16uint":return void mr(E,Ee,"16uint",2,we);case"rg16sint":return void mr(E,Ee,"16sint",2,we);case"rg16float":return void mr(E,Ee,"16float",2,we);case"rgba16uint":return void mr(E,Ee,"16uint",4,we);case"rgba16sint":return void mr(E,Ee,"16sint",4,we);case"rgba16float":return void mr(E,Ee,"16float",4,we);case"r32uint":return void mr(E,Ee,"32uint",1,we);case"r32sint":return void mr(E,Ee,"32sint",1,we);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void mr(E,Ee,"32float",1,we);case"rg32uint":return void mr(E,Ee,"32uint",2,we);case"rg32sint":return void mr(E,Ee,"32sint",2,we);case"rg32float":return void mr(E,Ee,"32float",2,we);case"rgba32uint":return void mr(E,Ee,"32uint",4,we);case"rgba32sint":return void mr(E,Ee,"32sint",4,we);case"rgba32float":return void mr(E,Ee,"32float",4,we);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(w),e,t,n,s,b,r,f,this.format,c)}}(i=>{i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(ot||(ot={}));class at{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class Pe{}bt=Pe,Pe.none=new at("",ot.reserved,""),Pe.eof=new at("EOF",ot.token,""),Pe.reserved={asm:new at("asm",ot.reserved,"asm"),bf16:new at("bf16",ot.reserved,"bf16"),do:new at("do",ot.reserved,"do"),enum:new at("enum",ot.reserved,"enum"),f16:new at("f16",ot.reserved,"f16"),f64:new at("f64",ot.reserved,"f64"),handle:new at("handle",ot.reserved,"handle"),i8:new at("i8",ot.reserved,"i8"),i16:new at("i16",ot.reserved,"i16"),i64:new at("i64",ot.reserved,"i64"),mat:new at("mat",ot.reserved,"mat"),premerge:new at("premerge",ot.reserved,"premerge"),regardless:new at("regardless",ot.reserved,"regardless"),typedef:new at("typedef",ot.reserved,"typedef"),u8:new at("u8",ot.reserved,"u8"),u16:new at("u16",ot.reserved,"u16"),u64:new at("u64",ot.reserved,"u64"),unless:new at("unless",ot.reserved,"unless"),using:new at("using",ot.reserved,"using"),vec:new at("vec",ot.reserved,"vec"),void:new at("void",ot.reserved,"void")},Pe.keywords={array:new at("array",ot.keyword,"array"),atomic:new at("atomic",ot.keyword,"atomic"),bool:new at("bool",ot.keyword,"bool"),f32:new at("f32",ot.keyword,"f32"),i32:new at("i32",ot.keyword,"i32"),mat2x2:new at("mat2x2",ot.keyword,"mat2x2"),mat2x3:new at("mat2x3",ot.keyword,"mat2x3"),mat2x4:new at("mat2x4",ot.keyword,"mat2x4"),mat3x2:new at("mat3x2",ot.keyword,"mat3x2"),mat3x3:new at("mat3x3",ot.keyword,"mat3x3"),mat3x4:new at("mat3x4",ot.keyword,"mat3x4"),mat4x2:new at("mat4x2",ot.keyword,"mat4x2"),mat4x3:new at("mat4x3",ot.keyword,"mat4x3"),mat4x4:new at("mat4x4",ot.keyword,"mat4x4"),ptr:new at("ptr",ot.keyword,"ptr"),sampler:new at("sampler",ot.keyword,"sampler"),sampler_comparison:new at("sampler_comparison",ot.keyword,"sampler_comparison"),struct:new at("struct",ot.keyword,"struct"),texture_1d:new at("texture_1d",ot.keyword,"texture_1d"),texture_2d:new at("texture_2d",ot.keyword,"texture_2d"),texture_2d_array:new at("texture_2d_array",ot.keyword,"texture_2d_array"),texture_3d:new at("texture_3d",ot.keyword,"texture_3d"),texture_cube:new at("texture_cube",ot.keyword,"texture_cube"),texture_cube_array:new at("texture_cube_array",ot.keyword,"texture_cube_array"),texture_multisampled_2d:new at("texture_multisampled_2d",ot.keyword,"texture_multisampled_2d"),texture_storage_1d:new at("texture_storage_1d",ot.keyword,"texture_storage_1d"),texture_storage_2d:new at("texture_storage_2d",ot.keyword,"texture_storage_2d"),texture_storage_2d_array:new at("texture_storage_2d_array",ot.keyword,"texture_storage_2d_array"),texture_storage_3d:new at("texture_storage_3d",ot.keyword,"texture_storage_3d"),texture_depth_2d:new at("texture_depth_2d",ot.keyword,"texture_depth_2d"),texture_depth_2d_array:new at("texture_depth_2d_array",ot.keyword,"texture_depth_2d_array"),texture_depth_cube:new at("texture_depth_cube",ot.keyword,"texture_depth_cube"),texture_depth_cube_array:new at("texture_depth_cube_array",ot.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new at("texture_depth_multisampled_2d",ot.keyword,"texture_depth_multisampled_2d"),texture_external:new at("texture_external",ot.keyword,"texture_external"),u32:new at("u32",ot.keyword,"u32"),vec2:new at("vec2",ot.keyword,"vec2"),vec3:new at("vec3",ot.keyword,"vec3"),vec4:new at("vec4",ot.keyword,"vec4"),bitcast:new at("bitcast",ot.keyword,"bitcast"),block:new at("block",ot.keyword,"block"),break:new at("break",ot.keyword,"break"),case:new at("case",ot.keyword,"case"),continue:new at("continue",ot.keyword,"continue"),continuing:new at("continuing",ot.keyword,"continuing"),default:new at("default",ot.keyword,"default"),diagnostic:new at("diagnostic",ot.keyword,"diagnostic"),discard:new at("discard",ot.keyword,"discard"),else:new at("else",ot.keyword,"else"),enable:new at("enable",ot.keyword,"enable"),fallthrough:new at("fallthrough",ot.keyword,"fallthrough"),false:new at("false",ot.keyword,"false"),fn:new at("fn",ot.keyword,"fn"),for:new at("for",ot.keyword,"for"),function:new at("function",ot.keyword,"function"),if:new at("if",ot.keyword,"if"),let:new at("let",ot.keyword,"let"),const:new at("const",ot.keyword,"const"),loop:new at("loop",ot.keyword,"loop"),while:new at("while",ot.keyword,"while"),private:new at("private",ot.keyword,"private"),read:new at("read",ot.keyword,"read"),read_write:new at("read_write",ot.keyword,"read_write"),return:new at("return",ot.keyword,"return"),requires:new at("requires",ot.keyword,"requires"),storage:new at("storage",ot.keyword,"storage"),switch:new at("switch",ot.keyword,"switch"),true:new at("true",ot.keyword,"true"),alias:new at("alias",ot.keyword,"alias"),type:new at("type",ot.keyword,"type"),uniform:new at("uniform",ot.keyword,"uniform"),var:new at("var",ot.keyword,"var"),override:new at("override",ot.keyword,"override"),workgroup:new at("workgroup",ot.keyword,"workgroup"),write:new at("write",ot.keyword,"write"),r8unorm:new at("r8unorm",ot.keyword,"r8unorm"),r8snorm:new at("r8snorm",ot.keyword,"r8snorm"),r8uint:new at("r8uint",ot.keyword,"r8uint"),r8sint:new at("r8sint",ot.keyword,"r8sint"),r16uint:new at("r16uint",ot.keyword,"r16uint"),r16sint:new at("r16sint",ot.keyword,"r16sint"),r16float:new at("r16float",ot.keyword,"r16float"),rg8unorm:new at("rg8unorm",ot.keyword,"rg8unorm"),rg8snorm:new at("rg8snorm",ot.keyword,"rg8snorm"),rg8uint:new at("rg8uint",ot.keyword,"rg8uint"),rg8sint:new at("rg8sint",ot.keyword,"rg8sint"),r32uint:new at("r32uint",ot.keyword,"r32uint"),r32sint:new at("r32sint",ot.keyword,"r32sint"),r32float:new at("r32float",ot.keyword,"r32float"),rg16uint:new at("rg16uint",ot.keyword,"rg16uint"),rg16sint:new at("rg16sint",ot.keyword,"rg16sint"),rg16float:new at("rg16float",ot.keyword,"rg16float"),rgba8unorm:new at("rgba8unorm",ot.keyword,"rgba8unorm"),rgba8unorm_srgb:new at("rgba8unorm_srgb",ot.keyword,"rgba8unorm_srgb"),rgba8snorm:new at("rgba8snorm",ot.keyword,"rgba8snorm"),rgba8uint:new at("rgba8uint",ot.keyword,"rgba8uint"),rgba8sint:new at("rgba8sint",ot.keyword,"rgba8sint"),bgra8unorm:new at("bgra8unorm",ot.keyword,"bgra8unorm"),bgra8unorm_srgb:new at("bgra8unorm_srgb",ot.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new at("rgb10a2unorm",ot.keyword,"rgb10a2unorm"),rg11b10float:new at("rg11b10float",ot.keyword,"rg11b10float"),rg32uint:new at("rg32uint",ot.keyword,"rg32uint"),rg32sint:new at("rg32sint",ot.keyword,"rg32sint"),rg32float:new at("rg32float",ot.keyword,"rg32float"),rgba16uint:new at("rgba16uint",ot.keyword,"rgba16uint"),rgba16sint:new at("rgba16sint",ot.keyword,"rgba16sint"),rgba16float:new at("rgba16float",ot.keyword,"rgba16float"),rgba32uint:new at("rgba32uint",ot.keyword,"rgba32uint"),rgba32sint:new at("rgba32sint",ot.keyword,"rgba32sint"),rgba32float:new at("rgba32float",ot.keyword,"rgba32float"),static_assert:new at("static_assert",ot.keyword,"static_assert")},Pe.tokens={decimal_float_literal:new at("decimal_float_literal",ot.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new at("hex_float_literal",ot.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new at("int_literal",ot.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new at("uint_literal",ot.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new at("name",ot.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new at("ident",ot.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new at("and",ot.token,"&"),and_and:new at("and_and",ot.token,"&&"),arrow:new at("arrow ",ot.token,"->"),attr:new at("attr",ot.token,"@"),forward_slash:new at("forward_slash",ot.token,"/"),bang:new at("bang",ot.token,"!"),bracket_left:new at("bracket_left",ot.token,"["),bracket_right:new at("bracket_right",ot.token,"]"),brace_left:new at("brace_left",ot.token,"{"),brace_right:new at("brace_right",ot.token,"}"),colon:new at("colon",ot.token,":"),comma:new at("comma",ot.token,","),equal:new at("equal",ot.token,"="),equal_equal:new at("equal_equal",ot.token,"=="),not_equal:new at("not_equal",ot.token,"!="),greater_than:new at("greater_than",ot.token,">"),greater_than_equal:new at("greater_than_equal",ot.token,">="),shift_right:new at("shift_right",ot.token,">>"),less_than:new at("less_than",ot.token,"<"),less_than_equal:new at("less_than_equal",ot.token,"<="),shift_left:new at("shift_left",ot.token,"<<"),modulo:new at("modulo",ot.token,"%"),minus:new at("minus",ot.token,"-"),minus_minus:new at("minus_minus",ot.token,"--"),period:new at("period",ot.token,"."),plus:new at("plus",ot.token,"+"),plus_plus:new at("plus_plus",ot.token,"++"),or:new at("or",ot.token,"|"),or_or:new at("or_or",ot.token,"||"),paren_left:new at("paren_left",ot.token,"("),paren_right:new at("paren_right",ot.token,")"),semicolon:new at("semicolon",ot.token,";"),star:new at("star",ot.token,"*"),tilde:new at("tilde",ot.token,"~"),underscore:new at("underscore",ot.token,"_"),xor:new at("xor",ot.token,"^"),plus_equal:new at("plus_equal",ot.token,"+="),minus_equal:new at("minus_equal",ot.token,"-="),times_equal:new at("times_equal",ot.token,"*="),division_equal:new at("division_equal",ot.token,"/="),modulo_equal:new at("modulo_equal",ot.token,"%="),and_equal:new at("and_equal",ot.token,"&="),or_equal:new at("or_equal",ot.token,"|="),xor_equal:new at("xor_equal",ot.token,"^="),shift_right_equal:new at("shift_right_equal",ot.token,">>="),shift_left_equal:new at("shift_left_equal",ot.token,"<<=")},Pe.simpleTokens={"@":bt.tokens.attr,"{":bt.tokens.brace_left,"}":bt.tokens.brace_right,":":bt.tokens.colon,",":bt.tokens.comma,"(":bt.tokens.paren_left,")":bt.tokens.paren_right,";":bt.tokens.semicolon},Pe.literalTokens={"&":bt.tokens.and,"&&":bt.tokens.and_and,"->":bt.tokens.arrow,"/":bt.tokens.forward_slash,"!":bt.tokens.bang,"[":bt.tokens.bracket_left,"]":bt.tokens.bracket_right,"=":bt.tokens.equal,"==":bt.tokens.equal_equal,"!=":bt.tokens.not_equal,">":bt.tokens.greater_than,">=":bt.tokens.greater_than_equal,">>":bt.tokens.shift_right,"<":bt.tokens.less_than,"<=":bt.tokens.less_than_equal,"<<":bt.tokens.shift_left,"%":bt.tokens.modulo,"-":bt.tokens.minus,"--":bt.tokens.minus_minus,".":bt.tokens.period,"+":bt.tokens.plus,"++":bt.tokens.plus_plus,"|":bt.tokens.or,"||":bt.tokens.or_or,"*":bt.tokens.star,"~":bt.tokens.tilde,_:bt.tokens.underscore,"^":bt.tokens.xor,"+=":bt.tokens.plus_equal,"-=":bt.tokens.minus_equal,"*=":bt.tokens.times_equal,"/=":bt.tokens.division_equal,"%=":bt.tokens.modulo_equal,"&=":bt.tokens.and_equal,"|=":bt.tokens.or_equal,"^=":bt.tokens.xor_equal,">>=":bt.tokens.shift_right_equal,"<<=":bt.tokens.shift_left_equal},Pe.regexTokens={decimal_float_literal:bt.tokens.decimal_float_literal,hex_float_literal:bt.tokens.hex_float_literal,int_literal:bt.tokens.int_literal,uint_literal:bt.tokens.uint_literal,ident:bt.tokens.ident},Pe.storage_class=[bt.keywords.function,bt.keywords.private,bt.keywords.workgroup,bt.keywords.uniform,bt.keywords.storage],Pe.access_mode=[bt.keywords.read,bt.keywords.write,bt.keywords.read_write],Pe.sampler_type=[bt.keywords.sampler,bt.keywords.sampler_comparison],Pe.sampled_texture_type=[bt.keywords.texture_1d,bt.keywords.texture_2d,bt.keywords.texture_2d_array,bt.keywords.texture_3d,bt.keywords.texture_cube,bt.keywords.texture_cube_array],Pe.multisampled_texture_type=[bt.keywords.texture_multisampled_2d],Pe.storage_texture_type=[bt.keywords.texture_storage_1d,bt.keywords.texture_storage_2d,bt.keywords.texture_storage_2d_array,bt.keywords.texture_storage_3d],Pe.depth_texture_type=[bt.keywords.texture_depth_2d,bt.keywords.texture_depth_2d_array,bt.keywords.texture_depth_cube,bt.keywords.texture_depth_cube_array,bt.keywords.texture_depth_multisampled_2d],Pe.texture_external_type=[bt.keywords.texture_external],Pe.any_texture_type=[...bt.sampled_texture_type,...bt.multisampled_texture_type,...bt.storage_texture_type,...bt.depth_texture_type,...bt.texture_external_type],Pe.texel_format=[bt.keywords.r8unorm,bt.keywords.r8snorm,bt.keywords.r8uint,bt.keywords.r8sint,bt.keywords.r16uint,bt.keywords.r16sint,bt.keywords.r16float,bt.keywords.rg8unorm,bt.keywords.rg8snorm,bt.keywords.rg8uint,bt.keywords.rg8sint,bt.keywords.r32uint,bt.keywords.r32sint,bt.keywords.r32float,bt.keywords.rg16uint,bt.keywords.rg16sint,bt.keywords.rg16float,bt.keywords.rgba8unorm,bt.keywords.rgba8unorm_srgb,bt.keywords.rgba8snorm,bt.keywords.rgba8uint,bt.keywords.rgba8sint,bt.keywords.bgra8unorm,bt.keywords.bgra8unorm_srgb,bt.keywords.rgb10a2unorm,bt.keywords.rg11b10float,bt.keywords.rg32uint,bt.keywords.rg32sint,bt.keywords.rg32float,bt.keywords.rgba16uint,bt.keywords.rgba16sint,bt.keywords.rgba16float,bt.keywords.rgba32uint,bt.keywords.rgba32sint,bt.keywords.rgba32float],Pe.const_literal=[bt.tokens.int_literal,bt.tokens.uint_literal,bt.tokens.decimal_float_literal,bt.tokens.hex_float_literal,bt.keywords.true,bt.keywords.false],Pe.literal_or_ident=[bt.tokens.ident,bt.tokens.int_literal,bt.tokens.uint_literal,bt.tokens.decimal_float_literal,bt.tokens.hex_float_literal,bt.tokens.name],Pe.element_count_expression=[bt.tokens.int_literal,bt.tokens.uint_literal,bt.tokens.ident],Pe.template_types=[bt.keywords.vec2,bt.keywords.vec3,bt.keywords.vec4,bt.keywords.mat2x2,bt.keywords.mat2x3,bt.keywords.mat2x4,bt.keywords.mat3x2,bt.keywords.mat3x3,bt.keywords.mat3x4,bt.keywords.mat4x2,bt.keywords.mat4x3,bt.keywords.mat4x4,bt.keywords.atomic,bt.keywords.bitcast,...bt.any_texture_type],Pe.attribute_name=[bt.tokens.ident,bt.keywords.block,bt.keywords.diagnostic],Pe.assignment_operators=[bt.tokens.equal,bt.tokens.plus_equal,bt.tokens.minus_equal,bt.tokens.times_equal,bt.tokens.division_equal,bt.tokens.modulo_equal,bt.tokens.and_equal,bt.tokens.or_equal,bt.tokens.xor_equal,bt.tokens.shift_right_equal,bt.tokens.shift_left_equal],Pe.increment_operators=[bt.tokens.plus_plus,bt.tokens.minus_minus];class mP{constructor(e,t,n,s,c){this.type=e,this.lexeme=t,this.line=n,this.start=s,this.end=c}toString(){return this.lexeme}isTemplateType(){return Pe.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Pe.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class TX{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new mP(Pe.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let f=1;for(;f>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),f--,f==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),f++)}return!0}}const t=Pe.simpleTokens[e];if(t)return this._addToken(t),!0;let n=Pe.none;const s=this._isAlpha(e),c=e==="_";if(this._isAlphaNumeric(e)){let f=this._peekAhead();for(;this._isAlphaNumeric(f);)e+=this._advance(),f=this._peekAhead()}if(s){const f=Pe.keywords[e];if(f)return this._addToken(f),!0}if(s||c)return this._addToken(Pe.tokens.ident),!0;for(;;){let f=this._findType(e);const r=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(r=="=")return this._current++,e+=r,this._addToken(Pe.tokens.minus_equal),!0;if(r=="-")return this._current++,e+=r,this._addToken(Pe.tokens.minus_minus),!0;const b=this._tokens.length-1;if((Pe.literal_or_ident.indexOf(this._tokens[b].type)!=-1||this._tokens[b].type==Pe.tokens.paren_right)&&r!=">")return this._addToken(f),!0}if(e==">"&&(r==">"||r=="=")){let b=!1,w=this._tokens.length-1;for(let E=0;E<5&&w>=0&&Pe.assignment_operators.indexOf(this._tokens[w].type)===-1;++E,--w)if(this._tokens[w].type===Pe.tokens.less_than){w>0&&this._tokens[w-1].isArrayOrTemplateType()&&(b=!0);break}if(b)return this._addToken(f),!0}if(f===Pe.none){let b=e,w=0;const E=2;for(let k=0;k<E;++k)if(b+=this._peekAhead(k),f=this._findType(b),f!==Pe.none){w=k;break}if(f===Pe.none)return n!==Pe.none&&(this._current--,this._addToken(n),!0);e=b,this._current+=w+1}if(n=f,this._isAtEnd())break;e+=this._advance()}return n!==Pe.none&&(this._addToken(n),!0)}_findType(e){for(const n in Pe.regexTokens){const s=Pe.regexTokens[n];if(this._match(e,s.rule))return s}return Pe.literalTokens[e]||Pe.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new mP(e,t,this._line,this._start,this._current))}}function _i(i){return Array.isArray(i)||(i==null?void 0:i.buffer)instanceof ArrayBuffer}const b1=new Float32Array(1),SX=new Uint32Array(b1.buffer),EX=new Uint32Array(b1.buffer),v1=new Int32Array(1),CX=new Float32Array(v1.buffer),IX=new Uint32Array(v1.buffer),x1=new Uint32Array(1),MX=new Float32Array(x1.buffer),RX=new Int32Array(x1.buffer);function gP(i,e,t){if(e===t)return i;if(e==="f32"){if(t==="i32"||t==="x32")return b1[0]=i,SX[0];if(t==="u32")return b1[0]=i,EX[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return v1[0]=i,CX[0];if(t==="u32")return v1[0]=i,IX[0]}else if(e==="u32"){if(t==="f32")return x1[0]=i,MX[0];if(t==="i32"||t==="x32")return x1[0]=i,RX[0]}return console.error(`Unsupported cast from ${e} to ${t}`),i}class kX{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Xv{constructor(e,t){this.align=e,this.size=t}}class Cc{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new pX,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Zy&&this._functions.set(t.name,new kX(t));for(const t of e)if(t instanceof _h){const n=this.getTypeInfo(t,null);n instanceof Ru&&this.structs.push(n)}for(const t of e)if(t instanceof sC)this.aliases.push(this._getAliasInfo(t));else if(t instanceof nC){const n=t,s=this._getAttributeNum(n.attributes,"id",0),c=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new uX(n.name,c,n.attributes,s))}else if(this._isUniformVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),f=this.getTypeInfo(n.type,n.attributes),r=new Gv(n.name,f,s,c,n.attributes,Su.Uniform,n.access);r.access||(r.access="read"),this.uniforms.push(r)}else if(this._isStorageVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),f=this.getTypeInfo(n.type,n.attributes),r=this._isStorageTexture(f),b=new Gv(n.name,f,s,c,n.attributes,r?Su.StorageTexture:Su.Storage,n.access);b.access||(b.access="read"),this.storage.push(b)}else if(this._isTextureVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),f=this.getTypeInfo(n.type,n.attributes),r=this._isStorageTexture(f),b=new Gv(n.name,f,s,c,n.attributes,r?Su.StorageTexture:Su.Texture,n.access);b.access||(b.access="read"),r?this.storage.push(b):this.textures.push(b)}else if(this._isSamplerVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),f=this.getTypeInfo(n.type,n.attributes),r=new Gv(n.name,f,s,c,n.attributes,Su.Sampler,n.access);this.samplers.push(r)}for(const t of e)if(t instanceof Zy){const n=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),c=this._getAttribute(t,"compute"),f=n||s||c,r=new fX(t.name,f==null?void 0:f.name,t.attributes);r.attributes=t.attributes,r.startLine=t.startLine,r.endLine=t.endLine,this.functions.push(r),this._functions.get(t.name).info=r,f&&(this._functions.get(t.name).inUse=!0,r.inUse=!0,r.resources=this._findResources(t,!!f),r.inputs=this._getInputs(t.args),r.outputs=this._getOutputs(t.returnType),this.entry[f.name].push(r)),r.arguments=t.args.map(b=>new dX(b.name,this.getTypeInfo(b.type,b.attributes),b.attributes)),r.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(n=>{var s,c,f;if(n instanceof yL){if(n.value)if(_i(n.value))for(const r of n.value)for(const b of this.overrides)r===b.name&&((s=t.info)===null||s===void 0||s.overrides.push(b));else for(const r of this.overrides)n.value===r.name&&((c=t.info)===null||c===void 0||c.overrides.push(r))}else if(n instanceof Pa)for(const r of this.overrides)n.name===r.name&&((f=t.info)===null||f===void 0||f.overrides.push(r))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const s of e.calls){const c=(n=this._functions.get(s.name))===null||n===void 0?void 0:n.info;c&&t.add(c)}}findResource(e,t,n){if(n){for(const s of this.entry.compute)if(s.name===n){for(const c of s.resources)if(c.group==e&&c.binding==t)return c}for(const s of this.entry.vertex)if(s.name===n){for(const c of s.resources)if(c.group==e&&c.binding==t)return c}for(const s of this.entry.fragment)if(s.name===n){for(const c of s.resources)if(c.group==e&&c.binding==t)return c}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],s=this,c=[];return e.search(f=>{if(f instanceof _1)c.push({});else if(f instanceof y1)c.pop();else if(f instanceof xh){const r=f;t&&r.type!==null&&this._markStructsFromAST(r.type),c.length>0&&(c[c.length-1][r.name]=r)}else if(f instanceof Tc){const r=f;t&&r.type!==null&&this._markStructsFromAST(r.type)}else if(f instanceof Ry){const r=f;t&&r.type!==null&&this._markStructsFromAST(r.type),c.length>0&&(c[c.length-1][r.name]=r)}else if(f instanceof Pa){const r=f;if(c.length>0&&c[c.length-1][r.name])return;const b=s._findResource(r.name);b&&n.push(b)}else if(f instanceof oC){const r=f,b=s._functions.get(r.name);b&&(t&&(b.inUse=!0),e.calls.add(b.node),b.resources===null&&(b.resources=s._findResources(b.node,t)),n.push(...b.resources))}else if(f instanceof rC){const r=f,b=s._functions.get(r.name);b&&(t&&(b.inUse=!0),e.calls.add(b.node),b.resources===null&&(b.resources=s._findResources(b.node,t)),n.push(...b.resources))}}),[...new Map(n.map(f=>[f.name,f])).values()]}getBindGroups(){const e=[];function t(n,s){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),s>=e[n].length&&(e[n].length=s+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof _h)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof _h)this._getStructOutputs(n.type,t);else{const s=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(s!==null){const c=this.getTypeInfo(n.type,n.type.attributes),f=this._parseInt(s.value),r=new hP(n.name,c,s.name,f);t.push(r)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new hP("",n,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const n of e)if(n.type instanceof _h)this._getStructInputs(n.type,t);else{const s=this._getInputInfo(n);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof _h)this._getStructInputs(n.type,t);else{const s=this._getInputInfo(n);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),c=this._parseInt(t.value),f=new hX(e.name,s,t.name,c);return n!==null&&(f.interpolation=this._parseString(n.value)),f}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new cX(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Ox){const s=e.type?this.getTypeInfo(e.type,e.attributes):null,c=new kS(e.name,s,t);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof ky){const s=e,c=s.format?this.getTypeInfo(s.format,s.attributes):null,f=new Fu(s.name,t);return f.format=c,f.count=s.count,this._types.set(e,f),this._updateTypeInfo(f),f}if(e instanceof _h){const s=e,c=new Ru(s.name,t);c.startLine=s.startLine,c.endLine=s.endLine;for(const f of s.members){const r=this.getTypeInfo(f.type,f.attributes);c.members.push(new cP(f.name,r,f.attributes))}return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof ly){const s=e,c=s.format instanceof Ht,f=s.format?c?this.getTypeInfo(s.format,null):new ll(s.format,null):null,r=new wf(s.name,f,t,s.access);return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof dt){const s=e,c=s.format?this.getTypeInfo(s.format,null):null,f=new wf(s.name,c,t,s.access);return this._types.set(e,f),this._updateTypeInfo(f),f}const n=new ll(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,s;const c=this._getTypeSize(e);if(e.size=(t=c==null?void 0:c.size)!==null&&t!==void 0?t:0,e instanceof Fu&&e.format){const f=this._getTypeSize(e.format);e.stride=Math.max((n=f==null?void 0:f.size)!==null&&n!==void 0?n:0,(s=f==null?void 0:f.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof kS&&this._updateTypeInfo(e.format),e instanceof Ru&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,s=0,c=0,f=0;for(let r=0,b=e.members.length;r<b;++r){const w=e.members[r],E=this._getTypeSize(w);if(!E)continue;(t=this._getAlias(w.type.name))!==null&&t!==void 0||w.type;const k=E.align,F=E.size;n=this._roundUp(k,n+s),s=F,c=n,f=Math.max(f,k),w.offset=n,w.size=F,this._updateTypeInfo(w.type)}e.size=this._roundUp(f,c+s),e.align=f}_getTypeSize(e){var t,n;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),c=this._getAttributeNum(e.attributes,"align",0);if(e instanceof cP&&(e=e.type),e instanceof ll){const f=this._getAlias(e.name);f!==null&&(e=f)}{const f=Cc._typeInfo[e.name];if(f!==void 0){const r=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Xv(Math.max(c,f.align/r),Math.max(s,f.size/r))}}{const f=Cc._typeInfo[e.name.substring(0,e.name.length-1)];if(f){const r=e.name[e.name.length-1]==="h"?2:1;return new Xv(Math.max(c,f.align/r),Math.max(s,f.size/r))}}if(e instanceof Fu){let f=e,r=8,b=8;const w=this._getTypeSize(f.format);return w!==null&&(b=w.size,r=w.align),b=f.count*this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(r,b)),s&&(b=s),new Xv(Math.max(c,r),Math.max(s,b))}if(e instanceof Ru){let f=0,r=0,b=0,w=0,E=0;for(const k of e.members){const F=this._getTypeSize(k.type);F!==null&&(f=Math.max(F.align,f),b=this._roundUp(F.align,b+w),w=F.size,E=b)}return r=this._roundUp(f,E+w),new Xv(Math.max(c,f),Math.max(s,r))}return null}_isUniformVar(e){return e instanceof xh&&e.storage=="uniform"}_isStorageVar(e){return e instanceof xh&&e.storage=="storage"}_isTextureVar(e){return e instanceof xh&&e.type!==null&&Cc._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof xh&&e.type!==null&&Cc._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const s=n.attributes;for(let c of s)if(c.name==t)return c;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let s of e)if(s.name==t){let c=s!==null&&s.value!==null?s.value:n;return c instanceof Array&&(c=c[0]),typeof c=="number"?c:typeof c=="string"?parseInt(c):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}Cc._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Cc._textureTypes=Pe.any_texture_type.map(i=>i.name),Cc._samplerTypes=Pe.sampler_type.map(i=>i.name);let aC=0;class lC{constructor(e,t,n){this.id=aC++,this.name=e,this.value=t,this.node=n}clone(){return new lC(this.name,this.value,this.node)}}class cC{constructor(e){this.id=aC++,this.name=e.name,this.node=e}clone(){return new cC(this.node)}}class hC{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=aC++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new lC(e,t,n??null))}setVariable(e,t,n){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return(t=n==null?void 0:n.value)!==null&&t!==void 0?t:null}clone(){return new hC(this)}}class PX{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class DX{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let s=!0;if(n instanceof Ne)return n.data.forEach(c=>{c||(s=!1)}),new rt(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne){const s=n.data.some(c=>c);return new rt(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof rt))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.evalExpression(n,t);if(s instanceof rs&&s.typeInfo.size===0){const c=s.typeInfo,f=s.buffer.byteLength/c.stride;return new rt(f,this.getTypeInfo("u32"))}return new rt(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.abs(c)),n.typeInfo);const s=n;return new rt(Math.abs(s.value),s.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.acos(c)),n.typeInfo);const s=n;return new rt(Math.acos(s.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.acosh(c)),n.typeInfo);const s=n;return new rt(Math.acosh(s.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.asin(c)),n.typeInfo);const s=n;return new rt(Math.asin(s.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.asinh(c)),n.typeInfo);const s=n;return new rt(Math.asinh(s.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.atan(c)),n.typeInfo);const s=n;return new rt(Math.atan(s.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.atanh(c)),n.typeInfo);const s=n;return new rt(Math.atanh(s.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ne&&s instanceof Ne)return new Ne(n.data.map((r,b)=>Math.atan2(r,s.data[b])),n.typeInfo);const c=n,f=s;return new rt(Math.atan2(c.value,f.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.ceil(c)),n.typeInfo);const s=n;return new rt(Math.ceil(s.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(n instanceof Ne&&s instanceof Ne&&c instanceof Ne)return new Ne(n.data.map((w,E)=>this._clamp(w,s.data[E],c.data[E])),n.typeInfo);const f=n,r=s,b=c;return new rt(this._clamp(f.value,r.value,b.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.cos(c)),n.typeInfo);const s=n;return new rt(Math.cos(s.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.cosh(c)),n.typeInfo);const s=n;return new rt(Math.cos(s.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.clz32(c)),n.typeInfo);const s=n;return new rt(Math.clz32(s.value),n.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>this._countOneBits(c)),n.typeInfo);const s=n;return new rt(this._countOneBits(s.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>this._countTrailingZeros(c)),n.typeInfo);const s=n;return new rt(this._countTrailingZeros(s.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ne&&s instanceof Ne){if(n.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const c=n.data,f=s.data;return new Ne([c[1]*f[2]-f[1]*c[2],c[2]*f[0]-f[2]*c[0],c[0]*f[1]-f[0]*c[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return n instanceof Ne?new Ne(n.data.map(c=>c*s),n.typeInfo):new rt(n.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof nn){const s=n.data,c=n.typeInfo.getTypeName(),f=c.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(c==="mat2x2"||c==="mat2x2f"||c==="mat2x2h")return new rt(s[0]*s[3]-s[1]*s[2],f);if(c==="mat2x3"||c==="mat2x3f"||c==="mat2x3h")return new rt(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),f);if(c==="mat2x4"||c==="mat2x4f"||c==="mat2x4h")console.error(`TODO: Determinant for ${c}`);else if(c==="mat3x2"||c==="mat3x2f"||c==="mat3x2h")console.error(`TODO: Determinant for ${c}`);else{if(c==="mat3x3"||c==="mat3x3f"||c==="mat3x3h")return new rt(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),f);c==="mat3x4"||c==="mat3x4f"||c==="mat3x4h"||c==="mat4x2"||c==="mat4x2f"||c==="mat4x2h"||c==="mat4x3"||c==="mat4x3f"||c==="mat4x3h"?console.error(`TODO: Determinant for ${c}`):c!=="mat4x4"&&c!=="mat4x4f"&&c!=="mat4x4h"||console.error(`TODO: Determinant for ${c}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ne&&s instanceof Ne){let r=0;for(let b=0;b<n.data.length;++b)r+=(n.data[b]-s.data[b])*(n.data[b]-s.data[b]);return new rt(Math.sqrt(r),this.getTypeInfo("f32"))}const c=n,f=s;return new rt(Math.abs(c.value-f.value),n.typeInfo)}_dot(e,t){let n=0;for(let s=0;s<e.length;++s)n+=t[s]*e[s];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return n instanceof Ne&&s instanceof Ne?new rt(this._dot(n.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.exp(c)),n.typeInfo);const s=n;return new rt(Math.exp(s.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.pow(2,c)),n.typeInfo);const s=n;return new rt(Math.pow(2,s.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const f=s.value,r=c.value;if(n instanceof Ne)return new Ne(n.data.map(w=>w>>f&(1<<r)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const b=n.value;return new rt(b>>f&(1<<r)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(n instanceof Ne&&s instanceof Ne&&c instanceof Ne){const f=this._dot(s.data,c.data);return new Ne(f<0?Array.from(n.data):n.data.map(r=>-r),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>this._firstLeadingBit(c)),n.typeInfo);const s=n;return new rt(this._firstLeadingBit(s.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>this._firstTrailingBit(c)),n.typeInfo);const s=n;return new rt(this._firstTrailingBit(s.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.floor(c)),n.typeInfo);const s=n;return new rt(Math.floor(s.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(n instanceof Ne&&s instanceof Ne&&c instanceof Ne)return n.data.length!==s.data.length||n.data.length!==c.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Ne(n.data.map((w,E)=>w*s.data[E]+c.data[E]),n.typeInfo);const f=n,r=s,b=c;return new rt(f.value*r.value+b.value,f.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>c-Math.floor(c)),n.typeInfo);const s=n;return new rt(s.value-Math.floor(s.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t),f=this.exec.evalExpression(e.args[3],t);if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const r=c.value,b=(1<<f.value)-1<<r,w=~b;if(n instanceof Ne&&s instanceof Ne)return new Ne(n.data.map((F,$)=>F&w|s.data[$]<<r&b),n.typeInfo);const E=n.value,k=s.value;return new rt(E&w|k<<r&b,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>1/Math.sqrt(c)),n.typeInfo);const s=n;return new rt(1/Math.sqrt(s.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne){let c=0;return n.data.forEach(f=>{c+=f*f}),new rt(Math.sqrt(c),this.getTypeInfo("f32"))}const s=n;return new rt(Math.abs(s.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.log(c)),n.typeInfo);const s=n;return new rt(Math.log(s.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.log2(c)),n.typeInfo);const s=n;return new rt(Math.log2(s.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ne&&s instanceof Ne)return new Ne(n.data.map((r,b)=>Math.max(r,s.data[b])),n.typeInfo);const c=n,f=s;return new rt(Math.max(c.value,f.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ne&&s instanceof Ne)return new Ne(n.data.map((r,b)=>Math.min(r,s.data[b])),n.typeInfo);const c=n,f=s;return new rt(Math.min(c.value,f.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(n instanceof Ne&&s instanceof Ne&&c instanceof Ne)return new Ne(n.data.map((b,w)=>n.data[w]*(1-c.data[w])+s.data[w]*c.data[w]),n.typeInfo);const f=s,r=c;return new rt(n.value*(1-r.value)+f.value*r.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ne&&s instanceof Ne)return new Ne(n.data.map((f,r)=>f%s.data[r]),n.typeInfo);const c=s;return new rt(n.value%c.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne){const s=this.Length(e,t).value;return new Ne(n.data.map(c=>c/s),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ne&&s instanceof Ne)return new Ne(n.data.map((r,b)=>Math.pow(r,s.data[b])),n.typeInfo);const c=n,f=s;return new rt(Math.pow(c.value,f.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Ne?new Ne(n.data.map(s=>s),n.typeInfo):new rt(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Ne?new Ne(n.data.map(s=>s*Math.PI/180),n.typeInfo):new rt(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ne&&s instanceof Ne){const c=this._dot(n.data,s.data);return new Ne(n.data.map((f,r)=>f-2*c*s.data[r]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(n instanceof Ne&&s instanceof Ne&&c instanceof rt){const f=this._dot(s.data,n.data);return new Ne(n.data.map((r,b)=>{const w=1-c.value*c.value*(1-f*f);if(w<0)return 0;const E=Math.sqrt(w);return c.value*r-(c.value*f+E)*s.data[b]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.round(c)),n.typeInfo);const s=n;return new rt(Math.round(s.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.min(Math.max(c,0),1)),n.typeInfo);const s=n;return new rt(Math.min(Math.max(s.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.sign(c)),n.typeInfo);const s=n;return new rt(Math.sign(s.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.sin(c)),n.typeInfo);const s=n;return new rt(Math.sin(s.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.sinh(c)),n.typeInfo);const s=n;return new rt(Math.sinh(s.value),n.typeInfo)}_smoothstep(e,t,n){const s=Math.min(Math.max((n-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(c instanceof Ne&&n instanceof Ne&&s instanceof Ne)return new Ne(c.data.map((w,E)=>this._smoothstep(n.data[E],s.data[E],w)),c.typeInfo);const f=n,r=s,b=c;return new rt(this._smoothstep(f.value,r.value,b.value),c.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.sqrt(c)),n.typeInfo);const s=n;return new rt(Math.sqrt(s.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof Ne&&n instanceof Ne)return new Ne(s.data.map((f,r)=>f<n.data[r]?0:1),s.typeInfo);const c=n;return new rt(s.value<c.value?0:1,c.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.tan(c)),n.typeInfo);const s=n;return new rt(Math.tan(s.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.tanh(c)),n.typeInfo);const s=n;return new rt(Math.tanh(s.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof nn))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const c=n.data;return new nn([c[0],c[2],c[1],c[3]],s)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const c=n.data;return new nn([c[0],c[3],c[6],c[1],c[4],c[7]],s)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const c=n.data;return new nn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13]],s)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const c=n.data;return new nn([c[0],c[3],c[1],c[4],c[2],c[5]],s)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const c=n.data;return new nn([c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]],s)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const c=n.data;return new nn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14]],s)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const c=n.data;return new nn([c[0],c[4],c[1],c[5],c[2],c[6]],s)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const c=n.data;return new nn([c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]],s)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const c=n.data;return new nn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14],c[3],c[7],c[11],c[15]],s)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ne)return new Ne(n.data.map(c=>Math.trunc(c)),n.typeInfo);const s=n;return new rt(Math.trunc(s.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof Pa){const c=n.name,f=t.getVariableValue(c);if(f instanceof yh){if(s<0||s>=f.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const r=f.getMipLevelSize(s),b=f.dimension;return b==="1d"?new rt(r[0],this.getTypeInfo("u32")):b==="3d"?new Ne(r,this.getTypeInfo("vec3u")):b==="2d"?new Ne(r.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${b} not found. Line ${e.line}`),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],s=this.exec.evalExpression(e.args[1],t),c=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof Ne)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof Pa){const f=n.name,r=t.getVariableValue(f);if(r instanceof yh){const b=Math.floor(s.data[0]),w=Math.floor(s.data[1]);if(b<0||b>=r.width||w<0||w>=r.height)return console.error(`Texture ${f} out of bounds. Line ${e.line}`),null;const E=r.getPixel(b,w,0,c);return E===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Ne(E,this.getTypeInfo("vec4f"))}return console.error(`Texture ${f} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof Pa){const s=n.name,c=t.getVariableValue(s);return c instanceof yh?new rt(c.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof Pa){const s=n.name,c=t.getVariableValue(s);return c instanceof yh?new rt(c.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof Pa){const s=n.name,c=t.getVariableValue(s);return c instanceof yh?new rt(c.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],s=this.exec.evalExpression(e.args[1],t),c=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,f=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(f.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof Ne)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof Pa){const r=n.name,b=t.getVariableValue(r);if(b instanceof yh){const w=b.getMipLevelSize(0),E=Math.floor(s.data[0]),k=Math.floor(s.data[1]);return E<0||E>=w[0]||k<0||k>=w[1]?(console.error(`Texture ${r} out of bounds. Line ${e.line}`),null):(b.setPixel(E,k,0,c,Array.from(f)),null)}return console.error(`Texture ${r} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t);return t.getVariable(s).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t),c=t.getVariable(s);let f=e.args[1];const r=this.exec.evalExpression(f,t),b=c.value.getSubData(this.exec,n.postfix,t);return b instanceof rt&&r instanceof rt&&(b.value=r.value),c.value instanceof rs&&c.value.setDataValue(this.exec,b,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t),c=t.getVariable(s);let f=e.args[1];const r=this.exec.evalExpression(f,t),b=c.value.getSubData(this.exec,n.postfix,t),w=new rt(b.value,b.typeInfo);return b instanceof rt&&r instanceof rt&&(b.value+=r.value),c.value instanceof rs&&c.value.setDataValue(this.exec,b,n.postfix,t),w}AtomicSub(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t),c=t.getVariable(s);let f=e.args[1];const r=this.exec.evalExpression(f,t),b=c.value.getSubData(this.exec,n.postfix,t),w=new rt(b.value,b.typeInfo);return b instanceof rt&&r instanceof rt&&(b.value-=r.value),c.value instanceof rs&&c.value.setDataValue(this.exec,b,n.postfix,t),w}AtomicMax(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t),c=t.getVariable(s);let f=e.args[1];const r=this.exec.evalExpression(f,t),b=c.value.getSubData(this.exec,n.postfix,t),w=new rt(b.value,b.typeInfo);return b instanceof rt&&r instanceof rt&&(b.value=Math.max(b.value,r.value)),c.value instanceof rs&&c.value.setDataValue(this.exec,b,n.postfix,t),w}AtomicMin(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t),c=t.getVariable(s);let f=e.args[1];const r=this.exec.evalExpression(f,t),b=c.value.getSubData(this.exec,n.postfix,t),w=new rt(b.value,b.typeInfo);return b instanceof rt&&r instanceof rt&&(b.value=Math.min(b.value,r.value)),c.value instanceof rs&&c.value.setDataValue(this.exec,b,n.postfix,t),w}AtomicAnd(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t),c=t.getVariable(s);let f=e.args[1];const r=this.exec.evalExpression(f,t),b=c.value.getSubData(this.exec,n.postfix,t),w=new rt(b.value,b.typeInfo);return b instanceof rt&&r instanceof rt&&(b.value=b.value&r.value),c.value instanceof rs&&c.value.setDataValue(this.exec,b,n.postfix,t),w}AtomicOr(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t),c=t.getVariable(s);let f=e.args[1];const r=this.exec.evalExpression(f,t),b=c.value.getSubData(this.exec,n.postfix,t),w=new rt(b.value,b.typeInfo);return b instanceof rt&&r instanceof rt&&(b.value=b.value|r.value),c.value instanceof rs&&c.value.setDataValue(this.exec,b,n.postfix,t),w}AtomicXor(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t),c=t.getVariable(s);let f=e.args[1];const r=this.exec.evalExpression(f,t),b=c.value.getSubData(this.exec,n.postfix,t),w=new rt(b.value,b.typeInfo);return b instanceof rt&&r instanceof rt&&(b.value=b.value^r.value),c.value instanceof rs&&c.value.setDataValue(this.exec,b,n.postfix,t),w}AtomicExchange(e,t){let n=e.args[0];n instanceof As&&(n=n.right);const s=this.exec.getVariableName(n,t),c=t.getVariable(s);let f=e.args[1];const r=this.exec.evalExpression(f,t),b=c.value.getSubData(this.exec,n.postfix,t),w=new rt(b.value,b.typeInfo);return b instanceof rt&&r instanceof rt&&(b.value=r.value),c.value instanceof rs&&c.value.setDataValue(this.exec,b,n.postfix,t),w}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const a2={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Fo={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Eo extends PX{constructor(e,t){var n;super(),this.ast=e??[],this.reflection=new Cc,this.reflection.updateAST(this.ast),this.context=(n=t==null?void 0:t.clone())!==null&&n!==void 0?n:new hC,this.builtins=new DX(this),this.typeInfo={bool:this.getTypeInfo(Ht.bool),i32:this.getTypeInfo(Ht.i32),u32:this.getTypeInfo(Ht.u32),f32:this.getTypeInfo(Ht.f32),f16:this.getTypeInfo(Ht.f16),vec2f:this.getTypeInfo(dt.vec2f),vec2u:this.getTypeInfo(dt.vec2u),vec2i:this.getTypeInfo(dt.vec2i),vec2h:this.getTypeInfo(dt.vec2h),vec3f:this.getTypeInfo(dt.vec3f),vec3u:this.getTypeInfo(dt.vec3u),vec3i:this.getTypeInfo(dt.vec3i),vec3h:this.getTypeInfo(dt.vec3h),vec4f:this.getTypeInfo(dt.vec4f),vec4u:this.getTypeInfo(dt.vec4u),vec4i:this.getTypeInfo(dt.vec4i),vec4h:this.getTypeInfo(dt.vec4h),mat2x2f:this.getTypeInfo(dt.mat2x2f),mat2x3f:this.getTypeInfo(dt.mat2x3f),mat2x4f:this.getTypeInfo(dt.mat2x4f),mat3x2f:this.getTypeInfo(dt.mat3x2f),mat3x3f:this.getTypeInfo(dt.mat3x3f),mat3x4f:this.getTypeInfo(dt.mat3x4f),mat4x2f:this.getTypeInfo(dt.mat4x2f),mat4x3f:this.getTypeInfo(dt.mat4x3f),mat4x4f:this.getTypeInfo(dt.mat4x4f)}}getVariableValue(e){var t,n;const s=(n=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:null;if(s===null)return null;if(s instanceof rt)return s.value;if(s instanceof Ne||s instanceof nn)return Array.from(s.data);if(s instanceof rs&&s.typeInfo instanceof Fu){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,s){const c=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,c),this._execStatements(this.ast,c);const f=c.getFunction(e);if(!f)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const r=t[0],b=t[1],w=t[2],E=this.getTypeInfo("vec3u");c.setVariable("@num_workgroups",new Ne(t,E));for(const k in n)for(const F in n[k]){const $=n[k][F];c.variables.forEach(X=>{var W;const ne=X.node;if(ne!=null&&ne.attributes){let _e=null,Te=null;for(const we of ne.attributes)we.name==="binding"?_e=we.value:we.name==="group"&&(Te=we.value);if(F==_e&&k==Te)if($.texture!==void 0&&$.descriptor!==void 0){const we=new yh($.texture,this.getTypeInfo(ne.type),$.descriptor,(W=$.texture.view)!==null&&W!==void 0?W:null);X.value=we}else $.uniform!==void 0?X.value=new rs($.uniform,this.getTypeInfo(ne.type)):X.value=new rs($,this.getTypeInfo(ne.type))}})}for(let k=0;k<w;++k)for(let F=0;F<b;++F)for(let $=0;$<r;++$)c.setVariable("@workgroup_id",new Ne([$,F,k],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(f,[$,F,k],c)}execStatement(e,t){if(e instanceof lL)return this.evalExpression(e.value,t);if(e instanceof hL){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof rt))throw new Error("Invalid break-if condition");if(!n.value)return null}return Eo._breakObj}if(e instanceof uL)return Eo._continueObj;if(e instanceof Ry)this._let(e,t);else if(e instanceof xh)this._var(e,t);else if(e instanceof Bx)this._const(e,t);else if(e instanceof Zy)this._function(e,t);else{if(e instanceof aL)return this._if(e,t);if(e instanceof oL)return this._switch(e,t);if(e instanceof iL)return this._for(e,t);if(e instanceof tL)return this._while(e,t);if(e instanceof sL)return this._loop(e,t);if(e instanceof PS){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof rL)this._assign(e,t);else if(e instanceof nL)this._increment(e,t);else{if(e instanceof _h)return null;if(e instanceof nC){const n=e.name;t.getVariable(n)===null&&t.setVariable(n,new rt(0,this.getTypeInfo("u32")))}else if(e instanceof rC)this._call(e,t);else{if(e instanceof cL||e instanceof sC)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Pl?this._evalBinaryOp(e,t):e instanceof Bs?this._evalLiteral(e,t):e instanceof Pa?this._evalVariable(e,t):e instanceof oC?this._evalCall(e,t):e instanceof Tc?this._evalCreate(e,t):e instanceof dL?this._evalConst(e,t):e instanceof fL?this._evalBitcast(e,t):e instanceof As?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Ht){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let n=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const s=e[n],c=this.reflection.getOverrideInfo(n);c!==null?(c.type===null&&(c.type=this.getTypeInfo("u32")),c.type.name==="u32"||c.type.name==="i32"||c.type.name==="f32"||c.type.name==="f16"?t.setVariable(n,new rt(s,c.type)):c.type.name==="bool"?t.setVariable(n,new rt(s?1:0,c.type)):c.type.name==="vec2"||c.type.name==="vec3"||c.type.name==="vec4"||c.type.name==="vec2f"||c.type.name==="vec3f"||c.type.name==="vec4f"||c.type.name==="vec2i"||c.type.name==="vec3i"||c.type.name==="vec4i"||c.type.name==="vec2u"||c.type.name==="vec3u"||c.type.name==="vec4u"||c.type.name==="vec2h"||c.type.name==="vec3h"||c.type.name==="vec4h"?t.setVariable(n,new Ne(s,c.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const s=[1,1,1];for(const E of e.node.attributes)if(E.name==="workgroup_size"){if(E.value.length>0){const k=n.getVariableValue(E.value[0]);s[0]=k instanceof rt?k.value:parseInt(E.value[0])}if(E.value.length>1){const k=n.getVariableValue(E.value[1]);s[1]=k instanceof rt?k.value:parseInt(E.value[1])}if(E.value.length>2){const k=n.getVariableValue(E.value[2]);s[2]=k instanceof rt?k.value:parseInt(E.value[2])}}const c=this.getTypeInfo("vec3u"),f=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Ne(s,c));const r=s[0],b=s[1],w=s[2];for(let E=0,k=0;E<w;++E)for(let F=0;F<b;++F)for(let $=0;$<r;++$,++k){const X=[$,F,E],W=[$+t[0]*s[0],F+t[1]*s[1],E+t[2]*s[2]];n.setVariable("@local_invocation_id",new Ne(X,c)),n.setVariable("@global_invocation_id",new Ne(W,c)),n.setVariable("@local_invocation_index",new rt(k,f)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const s of n.attributes)if(s.name==="builtin"){const c=`@${s.value}`,f=t.getVariable(c);f!==void 0&&t.variables.set(n.name,f)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof As;)e=e.right;return e instanceof Pa?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const c=t.clone(),f=this._execStatements(n,c);if(f)return f;continue}const s=this.execStatement(n,t);if(s)return s}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let c=0;c<s.node.args.length;++c){const f=s.node.args[c],r=this.evalExpression(e.args[c],n);n.setVariable(f.name,r,f)}this._execStatements(s.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),s=t.getVariable(n);s?e.operator==="++"?s.value instanceof rt?s.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof rt?s.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Pa){const n=this.getVariableName(e,t),s=t.getVariable(n);return s===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof As){if(e.operator==="*"){const n=this._getVariableData(e.right,t);return n instanceof rm?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,t);return new rm(n)}}return null}_assign(e,t){let n=null,s="<var>",c=null;if(e.variable instanceof As){const b=this._getVariableData(e.variable,t),w=this.evalExpression(e.value,t),E=e.operator;if(E==="="){if(b instanceof rt||b instanceof Ne||b instanceof nn){if(w instanceof rt||w instanceof Ne||w instanceof nn&&b.data.length===w.data.length)return void b.data.set(w.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(b instanceof rs&&w instanceof rs&&b.buffer.byteLength-b.offset>=w.buffer.byteLength-w.offset)return void(b.buffer.byteLength%4==0?new Uint32Array(b.buffer,b.offset,b.typeInfo.size/4).set(new Uint32Array(w.buffer,w.offset,w.typeInfo.size/4)):new Uint8Array(b.buffer,b.offset,b.typeInfo.size).set(new Uint8Array(w.buffer,w.offset,w.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(E==="+=")return b instanceof rt||b instanceof Ne||b instanceof nn?w instanceof rt||w instanceof Ne||w instanceof nn?void b.data.set(w.data.map((k,F)=>b.data[F]+k)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(E==="-=")return(b instanceof rt||b instanceof Ne||b instanceof nn)&&(w instanceof rt||w instanceof Ne||w instanceof nn)?void b.data.set(w.data.map((k,F)=>b.data[F]-k)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof As){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const b=t.getVariable(s);if(!(b&&b.value instanceof rm))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);n=b.value.reference;let w=e.variable.postfix;if(!w){let E=e.variable.right;for(;E instanceof As;){if(E.postfix){w=E.postfix;break}E=E.right}}w&&(n=n.getSubData(this,w,t))}}else{c=e.variable.postfix,s=this.getVariableName(e.variable,t);const b=t.getVariable(s);if(b===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);n=b.value}if(n instanceof rm&&(n=n.reference),n===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const f=this.evalExpression(e.value,t),r=e.operator;if(r==="=")if(n instanceof rs)n.setDataValue(this,f,c,t);else if(c){if(!(n instanceof Ne||n instanceof nn))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(c instanceof Dm){const b=this.evalExpression(c.index,t).value;if(n instanceof Ne){if(!(f instanceof rt))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[b]=f.value}else{if(!(n instanceof nn))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const w=this.evalExpression(c.index,t).value;if(w<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(f instanceof Ne))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const E=n.typeInfo.getTypeName();if(E==="mat2x2"||E==="mat2x2f"||E==="mat2x2h"){if(!(w<2&&f.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*w]=f.data[0],n.data[2*w+1]=f.data[1]}else if(E==="mat2x3"||E==="mat2x3f"||E==="mat2x3h"){if(!(w<2&&f.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*w]=f.data[0],n.data[3*w+1]=f.data[1],n.data[3*w+2]=f.data[2]}else if(E==="mat2x4"||E==="mat2x4f"||E==="mat2x4h"){if(!(w<2&&f.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*w]=f.data[0],n.data[4*w+1]=f.data[1],n.data[4*w+2]=f.data[2],n.data[4*w+3]=f.data[3]}else if(E==="mat3x2"||E==="mat3x2f"||E==="mat3x2h"){if(!(w<3&&f.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*w]=f.data[0],n.data[2*w+1]=f.data[1]}else if(E==="mat3x3"||E==="mat3x3f"||E==="mat3x3h"){if(!(w<3&&f.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*w]=f.data[0],n.data[3*w+1]=f.data[1],n.data[3*w+2]=f.data[2]}else if(E==="mat3x4"||E==="mat3x4f"||E==="mat3x4h"){if(!(w<3&&f.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*w]=f.data[0],n.data[4*w+1]=f.data[1],n.data[4*w+2]=f.data[2],n.data[4*w+3]=f.data[3]}else if(E==="mat4x2"||E==="mat4x2f"||E==="mat4x2h"){if(!(w<4&&f.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*w]=f.data[0],n.data[2*w+1]=f.data[1]}else if(E==="mat4x3"||E==="mat4x3f"||E==="mat4x3h"){if(!(w<4&&f.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*w]=f.data[0],n.data[3*w+1]=f.data[1],n.data[3*w+2]=f.data[2]}else{if(E!=="mat4x4"&&E!=="mat4x4f"&&E!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(w<4&&f.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*w]=f.data[0],n.data[4*w+1]=f.data[1],n.data[4*w+2]=f.data[2],n.data[4*w+3]=f.data[3]}}}}}else if(c instanceof Af){const b=c.value;if(!(n instanceof Ne))return void console.error(`Invalid assignment to ${b}. Variable ${s} is not a vector. Line ${e.line}`);if(f instanceof rt){if(b.length>1)return void console.error(`Invalid assignment to ${b} for variable ${s}. Line ${e.line}`);if(b==="x")n.data[0]=f.value;else if(b==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${b} for variable ${s}. Line ${e.line}`);n.data[1]=f.value}else if(b==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${b} for variable ${s}. Line ${e.line}`);n.data[2]=f.value}else if(b==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${b} for variable ${s}. Line ${e.line}`);n.data[3]=f.value}}else{if(!(f instanceof Ne))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(b.length!==f.data.length)return void console.error(`Invalid assignment to ${b} for variable ${s}. Line ${e.line}`);for(let w=0;w<b.length;++w){const E=b[w];if(E==="x"||E==="r")n.data[0]=f.data[w];else if(E==="y"||E==="g"){if(f.data.length<2)return void console.error(`Invalid assignment to ${E} for variable ${s}. Line ${e.line}`);n.data[1]=f.data[w]}else if(E==="z"||E==="b"){if(f.data.length<3)return void console.error(`Invalid assignment to ${E} for variable ${s}. Line ${e.line}`);n.data[2]=f.data[w]}else{if(E!=="w"&&E!=="a")return void console.error(`Invalid assignment to ${E} for variable ${s}. Line ${e.line}`);if(f.data.length<4)return void console.error(`Invalid assignment to ${E} for variable ${s}. Line ${e.line}`);n.data[3]=f.data[w]}}}}}else n instanceof rt&&f instanceof rt?n.value=f.value:n instanceof Ne&&f instanceof Ne||n instanceof nn&&f instanceof nn?n.data.set(f.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`);else{const b=n.getSubData(this,c,t);if(b instanceof Ne&&f instanceof rt){const w=b.data,E=f.value;if(r==="+=")for(let k=0;k<w.length;++k)w[k]+=E;else if(r==="-=")for(let k=0;k<w.length;++k)w[k]-=E;else if(r==="*=")for(let k=0;k<w.length;++k)w[k]*=E;else if(r==="/=")for(let k=0;k<w.length;++k)w[k]/=E;else if(r==="%=")for(let k=0;k<w.length;++k)w[k]%=E;else if(r==="&=")for(let k=0;k<w.length;++k)w[k]&=E;else if(r==="|=")for(let k=0;k<w.length;++k)w[k]|=E;else if(r==="^=")for(let k=0;k<w.length;++k)w[k]^=E;else if(r==="<<=")for(let k=0;k<w.length;++k)w[k]<<=E;else if(r===">>=")for(let k=0;k<w.length;++k)w[k]>>=E;else console.error(`Invalid operator ${r}. Line ${e.line}`)}else if(b instanceof Ne&&f instanceof Ne){const w=b.data,E=f.data;if(w.length!==E.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(r==="+=")for(let k=0;k<w.length;++k)w[k]+=E[k];else if(r==="-=")for(let k=0;k<w.length;++k)w[k]-=E[k];else if(r==="*=")for(let k=0;k<w.length;++k)w[k]*=E[k];else if(r==="/=")for(let k=0;k<w.length;++k)w[k]/=E[k];else if(r==="%=")for(let k=0;k<w.length;++k)w[k]%=E[k];else if(r==="&=")for(let k=0;k<w.length;++k)w[k]&=E[k];else if(r==="|=")for(let k=0;k<w.length;++k)w[k]|=E[k];else if(r==="^=")for(let k=0;k<w.length;++k)w[k]^=E[k];else if(r==="<<=")for(let k=0;k<w.length;++k)w[k]<<=E[k];else if(r===">>=")for(let k=0;k<w.length;++k)w[k]>>=E[k];else console.error(`Invalid operator ${r}. Line ${e.line}`)}else{if(!(b instanceof rt&&f instanceof rt))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);r==="+="?b.value+=f.value:r==="-="?b.value-=f.value:r==="*="?b.value*=f.value:r==="/="?b.value/=f.value:r==="%="?b.value%=f.value:r==="&="?b.value&=f.value:r==="|="?b.value|=f.value:r==="^="?b.value^=f.value:r==="<<="?b.value<<=f.value:r===">>="?b.value>>=f.value:console.error(`Invalid operator ${r}. Line ${e.line}`)}n instanceof rs&&n.setDataValue(this,b,c,t)}}_function(e,t){const n=new cC(e);t.functions.set(e.name,n)}_const(e,t){let n=null;e.value!==null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof As||(n=n.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const c=new Tc(e.type,[]);n=this._evalCreate(c,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof As||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof ky||e.type instanceof _h||e.type instanceof dt){const c=new Tc(e.type,[]);n=this._evalCreate(c,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof rt))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const c of e.cases)if(c instanceof gL)for(const f of c.selectors){if(f instanceof Fx){s=c;continue}const r=this.evalExpression(f,t);if(!(r instanceof rt))return console.error(`Invalid case selector. Line ${e.line}`),null;if(r.value===n.value)return this._execStatements(c.body,t)}else c instanceof _L&&(s=c);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof rt))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const s of e.elseif){const c=this.evalExpression(s.condition,t);if(!(c instanceof rt))return console.error(`Invalid if condition. Line ${e.line}`),null;if(c.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof rt?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Eo._breakObj)break;if(n!==null&&n!==Eo._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===Eo._breakObj)break;if(n===Eo._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Eo._breakObj)break}else if(n!==null)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Eo._breakObj)break;if(n!==Eo._continueObj&&n!==null)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),s=e.type;if(n instanceof rt){const c=gP(n.value,n.typeInfo.name,s.name);return new rt(c,this.getTypeInfo(s))}if(n instanceof Ne){const c=n.typeInfo.getTypeName();let f="";if(c.endsWith("f"))f="f32";else if(c.endsWith("i"))f="i32";else if(c.endsWith("u"))f="u32";else if(c.endsWith("b"))f="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${c}. Line ${e.line}`),null;f="f16"}const r=s.getTypeName();let b="";if(r.endsWith("f"))b="f32";else if(r.endsWith("i"))b="i32";else if(r.endsWith("u"))b="u32";else if(r.endsWith("b"))b="bool";else{if(!r.endsWith("h"))return console.error(`Unknown vector type ${b}. Line ${e.line}`),null;b="f16"}const w=function(E,k,F){if(k===F)return E;const $=new Array(E.length);for(let X=0;X<E.length;X++)$[X]=gP(E[X],k,F);return $}(Array.from(n.data),f,b);return new Ne(w,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof Tc){if(e.type===null)return DS.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof Tc?e.type.name:e.name,c=e instanceof Tc?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(c===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(c.size===0)return null;const f=new rs(new ArrayBuffer(c.size),c,0);if(c instanceof Ru){if(e.args)for(let r=0;r<e.args.length;++r){const b=c.members[r],w=e.args[r],E=this.evalExpression(w,t);f.setData(this,E,b.type,b.offset,t)}}else if(c instanceof Fu){let r=0;if(e.args)for(let b=0;b<e.args.length;++b){const w=e.args[b],E=this.evalExpression(w,t);c.format===null&&(((n=E.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?c.format=this.getTypeInfo("i32"):c.format=E.typeInfo),f.setData(this,E,c.format,r,t),r+=c.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof Tc?f.getSubData(this,e.postfix,t):f}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),s=n.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new rt(e.scalarValue,n):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const s=Eo._priority.get(t.name);Eo._priority.get(e[n].name)<s&&(t=e[n])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if(e.operator==="&")return new rm(n);if(e.operator==="*")return n instanceof rm?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=n instanceof rt?n.value:n instanceof Ne?Array.from(n.data):null;switch(e.operator){case"+":{if(_i(s)){const r=s.map((b,w)=>+b);return new Ne(r,n.typeInfo)}const c=s,f=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new rt(+c,f)}case"-":{if(_i(s)){const r=s.map((b,w)=>-b);return new Ne(r,n.typeInfo)}const c=s,f=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new rt(-c,f)}case"!":{if(_i(s)){const r=s.map((b,w)=>b?0:1);return new Ne(r,n.typeInfo)}const c=s,f=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new rt(c?0:1,f)}case"~":{if(_i(s)){const r=s.map((b,w)=>~b);return new Ne(r,n.typeInfo)}const c=s,f=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new rt(~c,f)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),c=n instanceof rt?n.value:n instanceof Ne||n instanceof nn?Array.from(n.data):null,f=s instanceof rt?s.value:s instanceof Ne||s instanceof nn?Array.from(s.data):null;switch(e.operator){case"+":{if(_i(c)&&_i(f)){const E=c,k=f;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$+k[X]);return new Ne(F,n.typeInfo)}if(_i(c)){const E=f,k=c.map((F,$)=>F+E);return new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E+F);return new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r+b,w)}case"-":{if(_i(c)&&_i(f)){const E=c,k=f;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$-k[X]);return new Ne(F,n.typeInfo)}if(_i(c)){const E=f,k=c.map((F,$)=>F-E);return new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E-F);return new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r-b,w)}case"*":{if(_i(c)&&_i(f)){const E=c,k=f;if(n instanceof nn&&s instanceof nn){const F=function(ne,_e,Te,we){if(Fo[_e.name]===void 0||Fo[we.name]===void 0)return null;const Ee=Fo[_e.name][0],Le=Fo[_e.name][1],Je=Fo[we.name][0];if(Ee!==Fo[we.name][1])return null;const Tt=new Array(Je*Le);for(let _t=0;_t<Le;_t++)for(let St=0;St<Je;St++){let kt=0;for(let Lt=0;Lt<Ee;Lt++)kt+=ne[Lt*Le+_t]*Te[St*Ee+Lt];Tt[_t*Je+St]=kt}return Tt}(E,n.typeInfo,k,s.typeInfo);if(F===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const $=Fo[s.typeInfo.name][0],X=Fo[n.typeInfo.name][1],W=this.getTypeInfo(`mat${$}x${X}f`);return new nn(F,W)}if(n instanceof nn&&s instanceof Ne){const F=function($,X,W,ne){if(Fo[X.name]===void 0||a2[ne.name]===void 0)return null;const _e=Fo[X.name][0],Te=Fo[X.name][1];if(_e!==W.length)return null;const we=new Array(Te);for(let Ee=0;Ee<Te;Ee++){let Le=0;for(let Je=0;Je<_e;Je++)Le+=$[Je*Te+Ee]*W[Je];we[Ee]=Le}return we}(E,n.typeInfo,k,s.typeInfo);return F===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ne(F,s.typeInfo)}if(n instanceof Ne&&s instanceof nn){const F=function($,X,W,ne){if(a2[X.name]===void 0||Fo[ne.name]===void 0)return null;const _e=Fo[ne.name][0],Te=Fo[ne.name][1];if(Te!==$.length)return null;const we=[];for(let Ee=0;Ee<_e;Ee++){let Le=0;for(let Je=0;Je<Te;Je++)Le+=$[Je]*W[Je*_e+Ee];we[Ee]=Le}return we}(E,n.typeInfo,k,s.typeInfo);return F===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ne(F,n.typeInfo)}{if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$*k[X]);return new Ne(F,n.typeInfo)}}if(_i(c)){const E=f,k=c.map((F,$)=>F*E);return n instanceof nn?new nn(k,n.typeInfo):new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E*F);return s instanceof nn?new nn(k,s.typeInfo):new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r*b,w)}case"%":{if(_i(c)&&_i(f)){const E=c,k=f;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$%k[X]);return new Ne(F,n.typeInfo)}if(_i(c)){const E=f,k=c.map((F,$)=>F%E);return new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E%F);return new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r%b,w)}case"/":{if(_i(c)&&_i(f)){const E=c,k=f;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$/k[X]);return new Ne(F,n.typeInfo)}if(_i(c)){const E=f,k=c.map((F,$)=>F/E);return new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E/F);return new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r/b,w)}case"&":{if(_i(c)&&_i(f)){const E=c,k=f;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$&k[X]);return new Ne(F,n.typeInfo)}if(_i(c)){const E=f,k=c.map((F,$)=>F&E);return new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E&F);return new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r&b,w)}case"|":{if(_i(c)&&_i(f)){const E=c,k=f;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$|k[X]);return new Ne(F,n.typeInfo)}if(_i(c)){const E=f,k=c.map((F,$)=>F|E);return new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E|F);return new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r|b,w)}case"^":{if(_i(c)&&_i(f)){const E=c,k=f;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$^k[X]);return new Ne(F,n.typeInfo)}if(_i(c)){const E=f,k=c.map((F,$)=>F^E);return new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E^F);return new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r^b,w)}case"<<":{if(_i(c)&&_i(f)){const E=c,k=f;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$<<k[X]);return new Ne(F,n.typeInfo)}if(_i(c)){const E=f,k=c.map((F,$)=>F<<E);return new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E<<F);return new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r<<b,w)}case">>":{if(_i(c)&&_i(f)){const E=c,k=f;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map(($,X)=>$>>k[X]);return new Ne(F,n.typeInfo)}if(_i(c)){const E=f,k=c.map((F,$)=>F>>E);return new Ne(k,n.typeInfo)}if(_i(f)){const E=c,k=f.map((F,$)=>E>>F);return new Ne(k,s.typeInfo)}const r=c,b=f,w=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new rt(r>>b,w)}case">":if(_i(c)&&_i(f)){const r=c,b=f;if(r.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=r.map((E,k)=>E>b[k]?1:0);return new Ne(w,n.typeInfo)}if(_i(c)){const r=f,b=c.map((w,E)=>w>r?1:0);return new Ne(b,n.typeInfo)}if(_i(f)){const r=c,b=f.map((w,E)=>r>w?1:0);return new Ne(b,s.typeInfo)}return new rt(c>f?1:0,this.getTypeInfo("bool"));case"<":if(_i(c)&&_i(f)){const r=c,b=f;if(r.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=r.map((E,k)=>E<b[k]?1:0);return new Ne(w,n.typeInfo)}if(_i(c)){const r=f,b=c.map((w,E)=>w<r?1:0);return new Ne(b,n.typeInfo)}if(_i(f)){const r=c,b=f.map((w,E)=>r<w?1:0);return new Ne(b,s.typeInfo)}return new rt(c<f?1:0,this.getTypeInfo("bool"));case"==":if(_i(c)&&_i(f)){const r=c,b=f;if(r.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=r.map((E,k)=>E===b[k]?1:0);return new Ne(w,n.typeInfo)}if(_i(c)){const r=f,b=c.map((w,E)=>w==r?1:0);return new Ne(b,n.typeInfo)}if(_i(f)){const r=c,b=f.map((w,E)=>r==w?1:0);return new Ne(b,s.typeInfo)}return new rt(c===f?1:0,this.getTypeInfo("bool"));case"!=":if(_i(c)&&_i(f)){const r=c,b=f;if(r.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=r.map((E,k)=>E!==b[k]?1:0);return new Ne(w,n.typeInfo)}if(_i(c)){const r=f,b=c.map((w,E)=>w!==r?1:0);return new Ne(b,n.typeInfo)}if(_i(f)){const r=c,b=f.map((w,E)=>r!==w?1:0);return new Ne(b,s.typeInfo)}return new rt(c!==f?1:0,this.getTypeInfo("bool"));case">=":if(_i(c)&&_i(f)){const r=c,b=f;if(r.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=r.map((E,k)=>E>=b[k]?1:0);return new Ne(w,n.typeInfo)}if(_i(c)){const r=f,b=c.map((w,E)=>w>=r?1:0);return new Ne(b,n.typeInfo)}if(_i(f)){const r=c,b=f.map((w,E)=>r>=w?1:0);return new Ne(b,s.typeInfo)}return new rt(c>=f?1:0,this.getTypeInfo("bool"));case"<=":if(_i(c)&&_i(f)){const r=c,b=f;if(r.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=r.map((E,k)=>E<=b[k]?1:0);return new Ne(w,n.typeInfo)}if(_i(c)){const r=f,b=c.map((w,E)=>w<=r?1:0);return new Ne(b,n.typeInfo)}if(_i(f)){const r=c,b=f.map((w,E)=>r<=w?1:0);return new Ne(b,s.typeInfo)}return new rt(c<=f?1:0,this.getTypeInfo("bool"));case"&&":if(_i(c)&&_i(f)){const r=c,b=f;if(r.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=r.map((E,k)=>E&&b[k]?1:0);return new Ne(w,n.typeInfo)}if(_i(c)){const r=f,b=c.map((w,E)=>w&&r?1:0);return new Ne(b,n.typeInfo)}if(_i(f)){const r=c,b=f.map((w,E)=>r&&w?1:0);return new Ne(b,s.typeInfo)}return new rt(c&&f?1:0,this.getTypeInfo("bool"));case"||":if(_i(c)&&_i(f)){const r=c,b=f;if(r.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=r.map((E,k)=>E||b[k]?1:0);return new Ne(w,n.typeInfo)}if(_i(c)){const r=f,b=c.map((w,E)=>w||r?1:0);return new Ne(b,n.typeInfo)}if(_i(f)){const r=c,b=f.map((w,E)=>r||w?1:0);return new Ne(b,s.typeInfo)}return new rt(c||f?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let c=0;c<s.node.args.length;++c){const f=s.node.args[c],r=this.evalExpression(e.args[c],n);n.createVariable(f.name,r,f)}return this._execStatements(s.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const s=t.clone();for(let c=0;c<n.node.args.length;++c){const f=n.node.args[c],r=this.evalExpression(e.args[c],s);s.setVariable(f.name,r,f)}return this._execStatements(n.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new rt(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),c=a2[s];if(c===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const f=[];if(e instanceof Bs)if(e.isVector){const r=e.vectorValue;for(const b of r)f.push(b)}else f.push(e.scalarValue);else if(e.args)for(const r of e.args){const b=this.evalExpression(r,t);if(b instanceof Ne){const w=b.data;for(let E=0;E<w.length;++E){let k=w[E];f.push(k)}}else if(b instanceof rt){let w=b.value;f.push(w)}}if(e.type instanceof dt&&e.type.format===null&&(e.type.format=dt.f32),f.length===0){const r=new Array(c).fill(0);return new Ne(r,n).getSubData(this,e.postfix,t)}if(f.length===1)for(;f.length<c;)f.push(f[0]);return f.length<c?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Ne(f.length>c?f.slice(0,c):f,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),c=Fo[s];if(c===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const f=[];if(e instanceof Bs)if(e.isVector){const r=e.vectorValue;for(const b of r)f.push(b)}else f.push(e.scalarValue);else if(e.args)for(const r of e.args){const b=this.evalExpression(r,t);b instanceof Ne?f.push(...b.data):b instanceof rt?f.push(b.value):b instanceof nn&&f.push(...b.data)}if(n instanceof wf&&n.format===null&&(n.format=this.getTypeInfo("f32")),f.length===0){const r=new Array(c[2]).fill(0);return new nn(r,n).getSubData(this,e.postfix,t)}return f.length!==c[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new nn(f,n).getSubData(this,e.postfix,t)}}Eo._breakObj=new hl(new ll("BREAK",null),null),Eo._continueObj=new hl(new ll("CONTINUE",null),null),Eo._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class BX{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class OX{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new BX,this._exec=new Eo,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const s=n.arrayType,c=n.countNode;if(c instanceof Pa){const f=c.name,r=this._context.constants.get(f);if(r)try{const b=r.constEvaluate(this._exec);s.count=b}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search(s=>{s instanceof pP||s instanceof Ox?s.type=this._forwardType(s.type):s instanceof ky?s.format=this._forwardType(s.format):s instanceof xh||s instanceof Ry||s instanceof Bx?s.type=this._forwardType(s.type):s instanceof Zy?s.returnType=this._forwardType(s.returnType):s instanceof fP&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof dP){const t=this._getType(e.name);if(t)return t}else e instanceof Ox?e.type=this._forwardType(e.type):e instanceof ky&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new TX(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Pe.eof}_match(e){if(e instanceof at)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let s=!1;for(const c of e){if(n===c)return!0;c===Pe.tokens.name&&(s=!0)}if(s){const c=Pe.tokens.name.rule.exec(t.lexeme);if(c&&c.index==0&&c[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Pe.tokens.name){const n=Pe.tokens.name.rule.exec(t.lexeme);return n&&n.index==0&&n[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Pe.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Pe.keywords.alias)){const t=this._type_alias();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Pe.keywords.diagnostic)){const t=this._diagnostic();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Pe.keywords.requires)){const t=this._requires_directive();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Pe.keywords.enable)){const t=this._enable_directive();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(Pe.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Pe.keywords.fn))return null;const e=this._currentLine,t=this._consume(Pe.tokens.ident,"Expected function name.").toString();this._consume(Pe.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Pe.tokens.paren_right))do{if(this._check(Pe.tokens.paren_right))break;const r=this._attribute(),b=this._consume(Pe.tokens.name,"Expected argument name.").toString();this._consume(Pe.tokens.colon,"Expected ':' for argument type.");const w=this._attribute(),E=this._type_decl();E!=null&&(E.attributes=w,n.push(this._updateNode(new fP(b,E,r))))}while(this._match(Pe.tokens.comma));this._consume(Pe.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(Pe.tokens.arrow)){const r=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=r)}const c=this._compound_statement(),f=this._currentLine;return this._updateNode(new Zy(t,n,s,c,e,f),e)}_compound_statement(){const e=[];for(this._consume(Pe.tokens.brace_left,"Expected '{' for block.");!this._check(Pe.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(Pe.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Pe.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Pe.tokens.attr)&&this._attribute(),this._check(Pe.keywords.if))return this._if_statement();if(this._check(Pe.keywords.switch))return this._switch_statement();if(this._check(Pe.keywords.loop))return this._loop_statement();if(this._check(Pe.keywords.for))return this._for_statement();if(this._check(Pe.keywords.while))return this._while_statement();if(this._check(Pe.keywords.continuing))return this._continuing_statement();if(this._check(Pe.keywords.static_assert))return this._static_assert_statement();if(this._check(Pe.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Pe.keywords.return))e=this._return_statement();else if(this._check([Pe.keywords.var,Pe.keywords.let,Pe.keywords.const]))e=this._variable_statement();else if(this._match(Pe.keywords.discard))e=this._updateNode(new xX);else if(this._match(Pe.keywords.break)){const t=this._updateNode(new hL);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t,this._check(Pe.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Pe.keywords.continue)){const t=this._updateNode(new uL);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(Pe.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Pe.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new yX(t),e)}_while_statement(){if(!this._match(Pe.keywords.while))return null;const e=this._updateNode(new tL(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Pe.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new PS(n,e),t)}_for_statement(){if(!this._match(Pe.keywords.for))return null;this._consume(Pe.tokens.paren_left,"Expected '('.");const e=this._updateNode(new iL(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Pe.tokens.semicolon)?null:this._for_init(),this._consume(Pe.tokens.semicolon,"Expected ';'."),e.condition=this._check(Pe.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Pe.tokens.semicolon,"Expected ';'."),e.increment=this._check(Pe.tokens.paren_right)?null:this._for_increment(),this._consume(Pe.tokens.paren_right,"Expected ')'."),this._check(Pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Pe.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Pe.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new xh(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Pe.keywords.let)){const e=this._currentLine,t=this._consume(Pe.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Pe.tokens.colon)){const c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}this._consume(Pe.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new Ry(t,n,null,null,s),e)}if(this._match(Pe.keywords.const)){const e=this._currentLine,t=this._consume(Pe.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Pe.tokens.colon)){const c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}this._consume(Pe.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return n===null&&s instanceof Bs&&(n=s.type),this._updateNode(new Bx(t,n,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(Pe.increment_operators))return this._current=e,null;const n=this._consume(Pe.increment_operators,"Expected increment operator");return this._updateNode(new nL(n.type===Pe.tokens.plus_plus?fm.increment:fm.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(Pe.tokens.brace_right))return null;let n=this._match(Pe.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const s=this._consume(Pe.assignment_operators,"Expected assignment operator."),c=this._short_circuit_or_expression();return this._updateNode(new rL(ay.parse(s.lexeme),e,c),t)}_func_call_statement(){if(!this._check(Pe.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(Pe.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new rC(n.lexeme,s),e)}_loop_statement(){if(!this._match(Pe.keywords.loop))return null;this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new sL([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof PS){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Pe.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Pe.keywords.switch))return null;const e=this._updateNode(new oL(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Pe.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Pe.keywords.default,Pe.keywords.case]);){if(this._match(Pe.keywords.case)){const n=this._case_selectors();for(const c of n)if(c instanceof Fx){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Pe.tokens.colon),this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(Pe.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new gL(n,s)))}if(this._match(Pe.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Pe.tokens.colon),this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Pe.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new _L(n)))}}return e}_case_selectors(){const e=[];for(this._match(Pe.keywords.default)?e.push(this._updateNode(new Fx)):e.push(this._shift_expression());this._match(Pe.tokens.comma);)this._match(Pe.keywords.default)?e.push(this._updateNode(new Fx)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Pe.keywords.fallthrough))return this._consume(Pe.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(Pe.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Pe.tokens.attr)&&this._attribute();const n=this._compound_statement();let s=[];this._match_elseif()&&(this._check(Pe.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let c=null;return this._match(Pe.keywords.else)&&(this._check(Pe.tokens.attr)&&this._attribute(),c=this._compound_statement()),this._updateNode(new aL(t,n,s,c),e)}_match_elseif(){return this._tokens[this._current].type===Pe.keywords.else&&this._tokens[this._current+1].type===Pe.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new wX(t,n))),this._match_elseif()&&(this._check(Pe.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Pe.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new lL(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Pe.tokens.or_or);)e=this._updateNode(new Pl(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Pe.tokens.and_and);)e=this._updateNode(new Pl(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Pe.tokens.or);)e=this._updateNode(new Pl(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Pe.tokens.xor);)e=this._updateNode(new Pl(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Pe.tokens.and);)e=this._updateNode(new Pl(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Pe.tokens.equal_equal,Pe.tokens.not_equal])?this._updateNode(new Pl(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Pe.tokens.less_than,Pe.tokens.greater_than,Pe.tokens.less_than_equal,Pe.tokens.greater_than_equal]);)e=this._updateNode(new Pl(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Pe.tokens.shift_left,Pe.tokens.shift_right]);)e=this._updateNode(new Pl(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Pe.tokens.plus,Pe.tokens.minus]);)e=this._updateNode(new Pl(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Pe.tokens.star,Pe.tokens.forward_slash,Pe.tokens.modulo]);)e=this._updateNode(new Pl(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Pe.tokens.minus,Pe.tokens.bang,Pe.tokens.tilde,Pe.tokens.star,Pe.tokens.and])?this._updateNode(new As(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Pe.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Pe.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Dm(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(Pe.tokens.period)){const e=this._consume(Pe.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new Af(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Ht.void;case"bool":return Ht.bool;case"i32":return Ht.i32;case"u32":return Ht.u32;case"f32":return Ht.f32;case"f16":return Ht.f16;case"vec2f":return dt.vec2f;case"vec3f":return dt.vec3f;case"vec4f":return dt.vec4f;case"vec2i":return dt.vec2i;case"vec3i":return dt.vec3i;case"vec4i":return dt.vec4i;case"vec2u":return dt.vec2u;case"vec3u":return dt.vec3u;case"vec4u":return dt.vec4u;case"vec2h":return dt.vec2h;case"vec3h":return dt.vec3h;case"vec4h":return dt.vec4h;case"mat2x2f":return dt.mat2x2f;case"mat2x3f":return dt.mat2x3f;case"mat2x4f":return dt.mat2x4f;case"mat3x2f":return dt.mat3x2f;case"mat3x3f":return dt.mat3x3f;case"mat3x4f":return dt.mat3x4f;case"mat4x2f":return dt.mat4x2f;case"mat4x3f":return dt.mat4x3f;case"mat4x4f":return dt.mat4x4f;case"mat2x2h":return dt.mat2x2h;case"mat2x3h":return dt.mat2x3h;case"mat2x4h":return dt.mat2x4h;case"mat3x2h":return dt.mat3x2h;case"mat3x3h":return dt.mat3x3h;case"mat3x4h":return dt.mat3x4h;case"mat4x2h":return dt.mat4x2h;case"mat4x3h":return dt.mat4x3h;case"mat4x4h":return dt.mat4x4h;case"mat2x2i":return dt.mat2x2i;case"mat2x3i":return dt.mat2x3i;case"mat2x4i":return dt.mat2x4i;case"mat3x2i":return dt.mat3x2i;case"mat3x3i":return dt.mat3x3i;case"mat3x4i":return dt.mat3x4i;case"mat4x2i":return dt.mat4x2i;case"mat4x3i":return dt.mat4x3i;case"mat4x4i":return dt.mat4x4i;case"mat2x2u":return dt.mat2x2u;case"mat2x3u":return dt.mat2x3u;case"mat2x4u":return dt.mat2x4u;case"mat3x2u":return dt.mat3x2u;case"mat3x3u":return dt.mat3x3u;case"mat3x4u":return dt.mat3x4u;case"mat4x2u":return dt.mat4x2u;case"mat4x3u":return dt.mat4x3u;case"mat4x4u":return dt.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Pe.tokens.ident)){const n=this._previous().toString();if(this._check(Pe.tokens.paren_left)){const s=this._argument_expression_list(),c=this._getType(n);return c!==null?this._updateNode(new Tc(c,s)):this._updateNode(new oC(n,s))}if(this._context.constants.has(n)){const s=this._context.constants.get(n);return this._updateNode(new dL(n,s.value))}return this._updateNode(new Pa(n))}if(this._match(Pe.tokens.int_literal)){const n=this._previous().toString();let s=n.endsWith("i")||n.endsWith("i")?Ht.i32:n.endsWith("u")||n.endsWith("U")?Ht.u32:Ht.x32;const c=parseInt(n);return this._validateTypeRange(c,s),this._updateNode(new Bs(new rt(c,this._exec.getTypeInfo(s)),s))}if(this._match(Pe.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Ht.u32),this._updateNode(new Bs(new rt(n,this._exec.getTypeInfo(Ht.u32)),Ht.u32))}if(this._match([Pe.tokens.decimal_float_literal,Pe.tokens.hex_float_literal])){let n=this._previous().toString(),s=n.endsWith("h");s&&(n=n.substring(0,n.length-1));const c=parseFloat(n);this._validateTypeRange(c,s?Ht.f16:Ht.f32);const f=s?Ht.f16:Ht.f32;return this._updateNode(new Bs(new rt(c,this._exec.getTypeInfo(f)),f))}if(this._match([Pe.keywords.true,Pe.keywords.false])){let n=this._previous().toString()===Pe.keywords.true.rule;return this._updateNode(new Bs(new rt(n?1:0,this._exec.getTypeInfo(Ht.bool)),Ht.bool))}if(this._check(Pe.tokens.paren_left))return this._paren_expression();if(this._match(Pe.keywords.bitcast)){this._consume(Pe.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(Pe.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new fL(n,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Tc(e,t))}_argument_expression_list(){if(!this._match(Pe.tokens.paren_left))return null;const e=[];do{if(this._check(Pe.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Pe.tokens.comma));return this._consume(Pe.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Pe.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Pe.tokens.paren_right),e}_paren_expression(){this._consume(Pe.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Pe.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Pe.keywords.struct))return null;const e=this._currentLine,t=this._consume(Pe.tokens.ident,"Expected name for struct.").toString();this._consume(Pe.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Pe.tokens.brace_right);){const f=this._attribute(),r=this._consume(Pe.tokens.name,"Expected variable name.").toString();this._consume(Pe.tokens.colon,"Expected ':' for struct member type.");const b=this._attribute(),w=this._type_decl();w!=null&&(w.attributes=b),this._check(Pe.tokens.brace_right)?this._match(Pe.tokens.comma):this._consume(Pe.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new pP(r,w,f)))}this._consume(Pe.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,c=this._updateNode(new _h(t,n,e,s),e);return this._context.structs.set(t,c),c}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Pe.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Bs){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Bs&&(e.type=e.value.type.name==="x32"?Ht.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Pe.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Pe.keywords.const))return null;const t=this._consume(Pe.tokens.name,"Expected variable name"),n=this._currentLine;let s=null;if(this._match(Pe.tokens.colon)){const b=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=b)}let c=null;this._consume(Pe.tokens.equal,"const declarations require an assignment");const f=this._short_circuit_or_expression();try{let b=[Ht.f32],w=f.constEvaluate(this._exec,b);w instanceof rt&&this._validateTypeRange(w.value,b[0]),b[0]instanceof dt&&b[0].format===null&&w.typeInfo instanceof wf&&w.typeInfo.format!==null&&(w.typeInfo.format.name==="f16"?b[0].format=Ht.f16:w.typeInfo.format.name==="f32"?b[0].format=Ht.f32:w.typeInfo.format.name==="i32"?b[0].format=Ht.i32:w.typeInfo.format.name==="u32"?b[0].format=Ht.u32:w.typeInfo.format.name==="bool"?b[0].format=Ht.bool:console.error(`TODO: impelement template format type ${w.typeInfo.format.name}`)),c=this._updateNode(new Bs(w,b[0])),this._exec.context.setVariable(t.toString(),w)}catch{c=f}if(s!==null&&c instanceof Bs){if(c.type.name!=="x32"&&s.getTypeName()!==c.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${c.type.name} to ${s.name}. Line:${this._currentLine}`);c.type=s,c.isScalar&&this._validateTypeRange(c.scalarValue,c.type)}else s===null&&c instanceof Bs&&(s=(e=c==null?void 0:c.type)!==null&&e!==void 0?e:Ht.f32,s===Ht.x32&&(s=Ht.i32));const r=this._updateNode(new Bx(t.toString(),s,"","",c),n);return this._context.constants.set(r.name,r),r}_global_let_decl(){if(!this._match(Pe.keywords.let))return null;const e=this._currentLine,t=this._consume(Pe.tokens.name,"Expected variable name");let n=null;if(this._match(Pe.tokens.colon)){const c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}let s=null;if(this._match(Pe.tokens.equal)&&(s=this._const_expression()),n!==null&&s instanceof Bs){if(s.type.name!=="x32"&&n.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${n.name}. Line:${this._currentLine}`);s.type=n}else n===null&&s instanceof Bs&&(n=s.type.name==="x32"?Ht.i32:s.type);return s instanceof Bs&&s.isScalar&&this._validateTypeRange(s.scalarValue,n),this._updateNode(new Ry(t.toString(),n,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Pe.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(Pe.tokens.less_than)&&(t=this._consume(Pe.storage_class,"Expected storage_class.").toString(),this._match(Pe.tokens.comma)&&(n=this._consume(Pe.access_mode,"Expected access_mode.").toString()),this._consume(Pe.tokens.greater_than,"Expected '>'."));const s=this._consume(Pe.tokens.name,"Expected variable name");let c=null;if(this._match(Pe.tokens.colon)){const f=this._attribute();c=this._type_decl(),c!=null&&(c.attributes=f)}return this._updateNode(new xh(s.toString(),c,t,n,null),e)}_override_decl(){if(!this._match(Pe.keywords.override))return null;const e=this._consume(Pe.tokens.name,"Expected variable name");let t=null;if(this._match(Pe.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return this._updateNode(new nC(e.toString(),t,null))}_diagnostic(){this._consume(Pe.tokens.paren_left,"Expected '('");const e=this._consume(Pe.tokens.ident,"Expected severity control name.");this._consume(Pe.tokens.comma,"Expected ','");let t=this._consume(Pe.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Pe.tokens.period)&&(t+=`.${this._consume(Pe.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Pe.tokens.paren_right,"Expected ')'"),this._updateNode(new cL(e.toString(),t))}_enable_directive(){const e=this._consume(Pe.tokens.ident,"identity expected.");return this._updateNode(new bX(e.toString()))}_requires_directive(){const e=[this._consume(Pe.tokens.ident,"identity expected.").toString()];for(;this._match(Pe.tokens.comma);){const t=this._consume(Pe.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new vX(e))}_type_alias(){const e=this._consume(Pe.tokens.ident,"identity expected.");this._consume(Pe.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new sC(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Pe.tokens.ident,...Pe.texel_format,Pe.keywords.bool,Pe.keywords.f32,Pe.keywords.i32,Pe.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const s=this._updateNode(new dP(n));return this._forwardTypeCount++,s}return this._updateNode(new Ht(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Pe.template_types)){let n=this._advance().toString(),s=null,c=null;return this._match(Pe.tokens.less_than)&&(s=this._type_decl(),c=null,this._match(Pe.tokens.comma)&&(c=this._consume(Pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(Pe.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new dt(n,s,c))}if(this._match(Pe.keywords.ptr)){let n=this._previous().toString();this._consume(Pe.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(Pe.storage_class,"Expected storage_class for pointer");this._consume(Pe.tokens.comma,"Expected ',' for pointer.");const c=this._type_decl();let f=null;return this._match(Pe.tokens.comma)&&(f=this._consume(Pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(Pe.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Ox(n,s.toString(),c,f))}const t=this._attribute();if(this._match(Pe.keywords.array)){let n=null,s=-1;const c=this._previous();let f=null;if(this._match(Pe.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let b="";if(this._match(Pe.tokens.comma)){f=this._shift_expression();try{b=f.constEvaluate(this._exec).toString(),f=null}catch{b="1"}}this._consume(Pe.tokens.greater_than,"Expected '>' for array."),s=b?parseInt(b):0}const r=this._updateNode(new ky(c.toString(),t,n,s));return f&&this._deferArrayCountEval.push({arrayType:r,countNode:f}),r}return null}_texture_sampler_types(){if(this._match(Pe.sampler_type))return this._updateNode(new ly(this._previous().toString(),null,null));if(this._match(Pe.depth_texture_type))return this._updateNode(new ly(this._previous().toString(),null,null));if(this._match(Pe.sampled_texture_type)||this._match(Pe.multisampled_texture_type)){const e=this._previous();this._consume(Pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new ly(e.toString(),t,null))}if(this._match(Pe.storage_texture_type)){const e=this._previous();this._consume(Pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Pe.texel_format,"Invalid texel format.").toString();this._consume(Pe.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Pe.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new ly(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(Pe.tokens.attr);){const t=this._consume(Pe.attribute_name,"Expected attribute name"),n=this._updateNode(new yL(t.toString(),null));if(this._match(Pe.tokens.paren_left)){if(n.value=this._consume(Pe.literal_or_ident,"Expected attribute value").toString(),this._check(Pe.tokens.comma)){this._advance();do{const s=this._consume(Pe.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(s)}while(this._match(Pe.tokens.comma))}this._consume(Pe.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class FX extends Cc{constructor(e){super(),e&&this.update(e)}update(e){const t=new OX().parse(e);this.updateAST(t)}}function LX(i){var c;const e={attributes:[],bindings:[]};let t;try{t=zX(i)}catch(f){return ni.error(f.message)(),e}for(const f of t.uniforms){const r=[];for(const b of((c=f.type)==null?void 0:c.members)||[])r.push({name:b.name,type:_P(b.type)});e.bindings.push({type:"uniform",name:f.name,group:f.group,location:f.binding,members:r})}for(const f of t.textures)e.bindings.push({type:"texture",name:f.name,group:f.group,location:f.binding});for(const f of t.samplers)e.bindings.push({type:"sampler",name:f.name,group:f.group,location:f.binding});const n=t.entry.vertex[0],s=(n==null?void 0:n.inputs.length)||0;for(let f=0;f<s;f++){const r=n.inputs[f];if(r.locationType==="location"){const b=_P(r.type);e.attributes.push({name:r.name,location:Number(r.location),type:b})}}return e}function _P(i){return i.format?`${i.name}<${i.format.name}>`:i.name}function zX(i){try{return new FX(i)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const NX={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...NX}};const ra=globalThis.mathgl.config;function UX(i,{precision:e=ra.precision}={}){return i=VX(i),`${parseFloat(i.toPrecision(e))}`}function Tf(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Ic(i,e,t){return jX(i,n=>Math.max(e,Math.min(t,n)))}function w1(i,e,t){return Tf(i)?i.map((n,s)=>w1(n,e[s],t)):t*e+(1-t)*i}function Ky(i,e,t){const n=ra.EPSILON;try{if(i===e)return!0;if(Tf(i)&&Tf(e)){if(i.length!==e.length)return!1;for(let s=0;s<i.length;++s)if(!Ky(i[s],e[s]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=ra.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{ra.EPSILON=n}}function VX(i){return Math.round(i/ra.EPSILON)*ra.EPSILON}function $X(i){return i.clone?i.clone():new Array(i.length)}function jX(i,e,t){if(Tf(i)){const n=i;t=t||$X(n);for(let s=0;s<t.length&&s<n.length;++s){const c=typeof i=="number"?i:i[s];t[s]=e(c,s,t)}return t}return e(i)}class uC extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Tf(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ra)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+UX(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Ky(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const c=e[s],f=typeof t=="number"?t:t[s];this[s]=c+n*(f-c)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=t[n];return this.check()}subtract(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=t[n];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ra.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function HX(i,e){if(i.length!==e)return!1;for(let t=0;t<i.length;++t)if(!Number.isFinite(i[t]))return!1;return!0}function Rr(i){if(!Number.isFinite(i))throw new Error(`Invalid number ${JSON.stringify(i)}`);return i}function Py(i,e,t=""){if(ra.debug&&!HX(i,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return i}function yP(i,e){if(!i)throw new Error(`math.gl assertion ${e}`)}class bL extends uC{get x(){return this[0]}set x(e){this[0]=Rr(e)}get y(){return this[1]}set y(e){this[1]=Rr(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const s=this[n]-e[n];t+=s*s}return Rr(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Rr(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=t[n];return this.check()}divide(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return yP(e>=0&&e<this.ELEMENTS,"index is out of range"),Rr(this[e])}setComponent(e,t){return yP(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Dy=1e-6;let Ul=typeof Float32Array<"u"?Float32Array:Array;function WX(){const i=new Ul(2);return Ul!=Float32Array&&(i[0]=0,i[1]=0),i}function bP(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i}function GX(i,e){return i[0]=-e[0],i[1]=-e[1],i}function vL(i,e,t,n){const s=e[0],c=e[1];return i[0]=s+n*(t[0]-s),i[1]=c+n*(t[1]-c),i}function XX(i,e,t){const n=e[0],s=e[1];return i[0]=t[0]*n+t[3]*s+t[6],i[1]=t[1]*n+t[4]*s+t[7],i}function qX(i,e,t){const n=e[0],s=e[1];return i[0]=t[0]*n+t[4]*s+t[12],i[1]=t[1]*n+t[5]*s+t[13],i}(function(){const i=WX();return function(e,t,n,s,c,f){let r,b;for(t||(t=2),n||(n=0),s?b=Math.min(s*t+n,e.length):b=e.length,r=n;r<b;r+=t)i[0]=e[r],i[1]=e[r+1],c(i,i,f),e[r]=i[0],e[r+1]=i[1];return e}})();function YX(i,e,t){const n=e[0],s=e[1],c=t[3]*n+t[7]*s||1;return i[0]=(t[0]*n+t[4]*s)/c,i[1]=(t[1]*n+t[5]*s)/c,i}function xL(i,e,t){const n=e[0],s=e[1],c=e[2],f=t[3]*n+t[7]*s+t[11]*c||1;return i[0]=(t[0]*n+t[4]*s+t[8]*c)/f,i[1]=(t[1]*n+t[5]*s+t[9]*c)/f,i[2]=(t[2]*n+t[6]*s+t[10]*c)/f,i}function ZX(i,e,t){const n=e[0],s=e[1];return i[0]=t[0]*n+t[2]*s,i[1]=t[1]*n+t[3]*s,i[2]=e[2],i}function KX(i,e,t){const n=e[0],s=e[1];return i[0]=t[0]*n+t[2]*s,i[1]=t[1]*n+t[3]*s,i[2]=e[2],i[3]=e[3],i}function wL(i,e,t){const n=e[0],s=e[1],c=e[2];return i[0]=t[0]*n+t[3]*s+t[6]*c,i[1]=t[1]*n+t[4]*s+t[7]*c,i[2]=t[2]*n+t[5]*s+t[8]*c,i[3]=e[3],i}function AL(){const i=new Ul(3);return Ul!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function JX(i){const e=i[0],t=i[1],n=i[2];return Math.sqrt(e*e+t*t+n*n)}function vP(i,e,t){const n=new Ul(3);return n[0]=i,n[1]=e,n[2]=t,n}function QX(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function eq(i){const e=i[0],t=i[1],n=i[2];return e*e+t*t+n*n}function tq(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function iq(i,e){const t=e[0],n=e[1],s=e[2];let c=t*t+n*n+s*s;return c>0&&(c=1/Math.sqrt(c)),i[0]=e[0]*c,i[1]=e[1]*c,i[2]=e[2]*c,i}function TL(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function Lx(i,e,t){const n=e[0],s=e[1],c=e[2],f=t[0],r=t[1],b=t[2];return i[0]=s*b-c*r,i[1]=c*f-n*b,i[2]=n*r-s*f,i}function nq(i,e,t,n){const s=e[0],c=e[1],f=e[2];return i[0]=s+n*(t[0]-s),i[1]=c+n*(t[1]-c),i[2]=f+n*(t[2]-f),i}function dC(i,e,t){const n=e[0],s=e[1],c=e[2];let f=t[3]*n+t[7]*s+t[11]*c+t[15];return f=f||1,i[0]=(t[0]*n+t[4]*s+t[8]*c+t[12])/f,i[1]=(t[1]*n+t[5]*s+t[9]*c+t[13])/f,i[2]=(t[2]*n+t[6]*s+t[10]*c+t[14])/f,i}function SL(i,e,t){const n=e[0],s=e[1],c=e[2];return i[0]=n*t[0]+s*t[3]+c*t[6],i[1]=n*t[1]+s*t[4]+c*t[7],i[2]=n*t[2]+s*t[5]+c*t[8],i}function EL(i,e,t){const n=t[0],s=t[1],c=t[2],f=t[3],r=e[0],b=e[1],w=e[2];let E=s*w-c*b,k=c*r-n*w,F=n*b-s*r,$=s*F-c*k,X=c*E-n*F,W=n*k-s*E;const ne=f*2;return E*=ne,k*=ne,F*=ne,$*=2,X*=2,W*=2,i[0]=r+E+$,i[1]=b+k+X,i[2]=w+F+W,i}function rq(i,e,t,n){const s=[],c=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],c[0]=s[0],c[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),c[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),i[0]=c[0]+t[0],i[1]=c[1]+t[1],i[2]=c[2]+t[2],i}function sq(i,e,t,n){const s=[],c=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],c[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),c[1]=s[1],c[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),i[0]=c[0]+t[0],i[1]=c[1]+t[1],i[2]=c[2]+t[2],i}function oq(i,e,t,n){const s=[],c=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],c[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),c[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),c[2]=s[2],i[0]=c[0]+t[0],i[1]=c[1]+t[1],i[2]=c[2]+t[2],i}function aq(i,e){const t=i[0],n=i[1],s=i[2],c=e[0],f=e[1],r=e[2],b=Math.sqrt((t*t+n*n+s*s)*(c*c+f*f+r*r)),w=b&&TL(i,e)/b;return Math.acos(Math.min(Math.max(w,-1),1))}const CL=QX,IL=JX,l2=eq;(function(){const i=AL();return function(e,t,n,s,c,f){let r,b;for(t||(t=3),n||(n=0),s?b=Math.min(s*t+n,e.length):b=e.length,r=n;r<b;r+=t)i[0]=e[r],i[1]=e[r+1],i[2]=e[r+2],c(i,i,f),e[r]=i[0],e[r+1]=i[1],e[r+2]=i[2];return e}})();const c2=[0,0,0];let qv;class lo extends bL{static get ZERO(){return qv||(qv=new lo(0,0,0),Object.freeze(qv)),qv}constructor(e=0,t=0,n=0){super(-0,-0,-0),arguments.length===1&&Tf(e)?this.copy(e):(ra.debug&&(Rr(e),Rr(t),Rr(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ra.debug&&(Rr(e.x),Rr(e.y),Rr(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Rr(e)}angle(e){return aq(this,e)}cross(e){return Lx(this,this,e),this.check()}rotateX({radians:e,origin:t=c2}){return rq(this,this,t,e),this.check()}rotateY({radians:e,origin:t=c2}){return sq(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=c2}){return oq(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return dC(this,this,e),this.check()}transformAsVector(e){return xL(this,this,e),this.check()}transformByMatrix3(e){return SL(this,this,e),this.check()}transformByMatrix2(e){return ZX(this,this,e),this.check()}transformByQuaternion(e){return EL(this,this,e),this.check()}}let Yv;class fC extends bL{static get ZERO(){return Yv||(Yv=new fC(0,0,0,0),Object.freeze(Yv)),Yv}constructor(e=0,t=0,n=0,s=0){super(-0,-0,-0,-0),Tf(e)&&arguments.length===1?this.copy(e):(ra.debug&&(Rr(e),Rr(t),Rr(n),Rr(s)),this[0]=e,this[1]=t,this[2]=n,this[3]=s)}set(e,t,n,s){return this[0]=e,this[1]=t,this[2]=n,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return ra.debug&&(Rr(e.x),Rr(e.y),Rr(e.z),Rr(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Rr(e)}get w(){return this[3]}set w(e){this[3]=Rr(e)}transform(e){return dC(this,this,e),this.check()}transformByMatrix3(e){return wL(this,this,e),this.check()}transformByMatrix2(e){return KX(this,this,e),this.check()}transformByQuaternion(e){return EL(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class ML extends uC{toString(){let e="[";if(ra.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Rr(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[n+s];return t}setColumn(e,t){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=t[s];return this}}function lq(){const i=new Ul(9);return Ul!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function cq(i,e){if(i===e){const t=e[1],n=e[2],s=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=n,i[7]=s}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i}function hq(i,e){const t=e[0],n=e[1],s=e[2],c=e[3],f=e[4],r=e[5],b=e[6],w=e[7],E=e[8],k=E*f-r*w,F=-E*c+r*b,$=w*c-f*b;let X=t*k+n*F+s*$;return X?(X=1/X,i[0]=k*X,i[1]=(-E*n+s*w)*X,i[2]=(r*n-s*f)*X,i[3]=F*X,i[4]=(E*t-s*b)*X,i[5]=(-r*t+s*c)*X,i[6]=$*X,i[7]=(-w*t+n*b)*X,i[8]=(f*t-n*c)*X,i):null}function uq(i){const e=i[0],t=i[1],n=i[2],s=i[3],c=i[4],f=i[5],r=i[6],b=i[7],w=i[8];return e*(w*c-f*b)+t*(-w*s+f*r)+n*(b*s-c*r)}function xP(i,e,t){const n=e[0],s=e[1],c=e[2],f=e[3],r=e[4],b=e[5],w=e[6],E=e[7],k=e[8],F=t[0],$=t[1],X=t[2],W=t[3],ne=t[4],_e=t[5],Te=t[6],we=t[7],Ee=t[8];return i[0]=F*n+$*f+X*w,i[1]=F*s+$*r+X*E,i[2]=F*c+$*b+X*k,i[3]=W*n+ne*f+_e*w,i[4]=W*s+ne*r+_e*E,i[5]=W*c+ne*b+_e*k,i[6]=Te*n+we*f+Ee*w,i[7]=Te*s+we*r+Ee*E,i[8]=Te*c+we*b+Ee*k,i}function dq(i,e,t){const n=e[0],s=e[1],c=e[2],f=e[3],r=e[4],b=e[5],w=e[6],E=e[7],k=e[8],F=t[0],$=t[1];return i[0]=n,i[1]=s,i[2]=c,i[3]=f,i[4]=r,i[5]=b,i[6]=F*n+$*f+w,i[7]=F*s+$*r+E,i[8]=F*c+$*b+k,i}function fq(i,e,t){const n=e[0],s=e[1],c=e[2],f=e[3],r=e[4],b=e[5],w=e[6],E=e[7],k=e[8],F=Math.sin(t),$=Math.cos(t);return i[0]=$*n+F*f,i[1]=$*s+F*r,i[2]=$*c+F*b,i[3]=$*f-F*n,i[4]=$*r-F*s,i[5]=$*b-F*c,i[6]=w,i[7]=E,i[8]=k,i}function wP(i,e,t){const n=t[0],s=t[1];return i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[3]=s*e[3],i[4]=s*e[4],i[5]=s*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i}function pq(i,e){const t=e[0],n=e[1],s=e[2],c=e[3],f=t+t,r=n+n,b=s+s,w=t*f,E=n*f,k=n*r,F=s*f,$=s*r,X=s*b,W=c*f,ne=c*r,_e=c*b;return i[0]=1-k-X,i[3]=E-_e,i[6]=F+ne,i[1]=E+_e,i[4]=1-w-X,i[7]=$-W,i[2]=F-ne,i[5]=$+W,i[8]=1-w-k,i}var BS;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(BS||(BS={}));const mq=Object.freeze([1,0,0,0,1,0,0,0,1]);class I0 extends ML{static get IDENTITY(){return _q()}static get ZERO(){return gq()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return BS}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(mq)}fromObject(e){return this.check()}fromQuaternion(e){return pq(this,e),this.check()}set(e,t,n,s,c,f,r,b,w){return this[0]=e,this[1]=t,this[2]=n,this[3]=s,this[4]=c,this[5]=f,this[6]=r,this[7]=b,this[8]=w,this.check()}setRowMajor(e,t,n,s,c,f,r,b,w){return this[0]=e,this[1]=s,this[2]=r,this[3]=t,this[4]=c,this[5]=b,this[6]=n,this[7]=f,this[8]=w,this.check()}determinant(){return uq(this)}transpose(){return cq(this,this),this.check()}invert(){return hq(this,this),this.check()}multiplyLeft(e){return xP(this,e,this),this.check()}multiplyRight(e){return xP(this,this,e),this.check()}rotate(e){return fq(this,this,e),this.check()}scale(e){return Array.isArray(e)?wP(this,this,e):wP(this,this,[e,e]),this.check()}translate(e){return dq(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=XX(t||[-0,-0],e,this);break;case 3:n=SL(t||[-0,-0,-0],e,this);break;case 4:n=wL(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Py(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let Zv,Kv=null;function gq(){return Zv||(Zv=new I0([0,0,0,0,0,0,0,0,0]),Object.freeze(Zv)),Zv}function _q(){return Kv||(Kv=new I0,Object.freeze(Kv)),Kv}function yq(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function bq(i,e){if(i===e){const t=e[1],n=e[2],s=e[3],c=e[6],f=e[7],r=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=n,i[9]=c,i[11]=e[14],i[12]=s,i[13]=f,i[14]=r}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function OS(i,e){const t=e[0],n=e[1],s=e[2],c=e[3],f=e[4],r=e[5],b=e[6],w=e[7],E=e[8],k=e[9],F=e[10],$=e[11],X=e[12],W=e[13],ne=e[14],_e=e[15],Te=t*r-n*f,we=t*b-s*f,Ee=t*w-c*f,Le=n*b-s*r,Je=n*w-c*r,Tt=s*w-c*b,_t=E*W-k*X,St=E*ne-F*X,kt=E*_e-$*X,Lt=k*ne-F*W,si=k*_e-$*W,bi=F*_e-$*ne;let ii=Te*bi-we*si+Ee*Lt+Le*kt-Je*St+Tt*_t;return ii?(ii=1/ii,i[0]=(r*bi-b*si+w*Lt)*ii,i[1]=(s*si-n*bi-c*Lt)*ii,i[2]=(W*Tt-ne*Je+_e*Le)*ii,i[3]=(F*Je-k*Tt-$*Le)*ii,i[4]=(b*kt-f*bi-w*St)*ii,i[5]=(t*bi-s*kt+c*St)*ii,i[6]=(ne*Ee-X*Tt-_e*we)*ii,i[7]=(E*Tt-F*Ee+$*we)*ii,i[8]=(f*si-r*kt+w*_t)*ii,i[9]=(n*kt-t*si-c*_t)*ii,i[10]=(X*Je-W*Ee+_e*Te)*ii,i[11]=(k*Ee-E*Je-$*Te)*ii,i[12]=(r*St-f*Lt-b*_t)*ii,i[13]=(t*Lt-n*St+s*_t)*ii,i[14]=(W*we-X*Le-ne*Te)*ii,i[15]=(E*Le-k*we+F*Te)*ii,i):null}function vq(i){const e=i[0],t=i[1],n=i[2],s=i[3],c=i[4],f=i[5],r=i[6],b=i[7],w=i[8],E=i[9],k=i[10],F=i[11],$=i[12],X=i[13],W=i[14],ne=i[15],_e=e*f-t*c,Te=e*r-n*c,we=t*r-n*f,Ee=w*X-E*$,Le=w*W-k*$,Je=E*W-k*X,Tt=e*Je-t*Le+n*Ee,_t=c*Je-f*Le+r*Ee,St=w*we-E*Te+k*_e,kt=$*we-X*Te+W*_e;return b*Tt-s*_t+ne*St-F*kt}function ff(i,e,t){const n=e[0],s=e[1],c=e[2],f=e[3],r=e[4],b=e[5],w=e[6],E=e[7],k=e[8],F=e[9],$=e[10],X=e[11],W=e[12],ne=e[13],_e=e[14],Te=e[15];let we=t[0],Ee=t[1],Le=t[2],Je=t[3];return i[0]=we*n+Ee*r+Le*k+Je*W,i[1]=we*s+Ee*b+Le*F+Je*ne,i[2]=we*c+Ee*w+Le*$+Je*_e,i[3]=we*f+Ee*E+Le*X+Je*Te,we=t[4],Ee=t[5],Le=t[6],Je=t[7],i[4]=we*n+Ee*r+Le*k+Je*W,i[5]=we*s+Ee*b+Le*F+Je*ne,i[6]=we*c+Ee*w+Le*$+Je*_e,i[7]=we*f+Ee*E+Le*X+Je*Te,we=t[8],Ee=t[9],Le=t[10],Je=t[11],i[8]=we*n+Ee*r+Le*k+Je*W,i[9]=we*s+Ee*b+Le*F+Je*ne,i[10]=we*c+Ee*w+Le*$+Je*_e,i[11]=we*f+Ee*E+Le*X+Je*Te,we=t[12],Ee=t[13],Le=t[14],Je=t[15],i[12]=we*n+Ee*r+Le*k+Je*W,i[13]=we*s+Ee*b+Le*F+Je*ne,i[14]=we*c+Ee*w+Le*$+Je*_e,i[15]=we*f+Ee*E+Le*X+Je*Te,i}function A1(i,e,t){const n=t[0],s=t[1],c=t[2];let f,r,b,w,E,k,F,$,X,W,ne,_e;return e===i?(i[12]=e[0]*n+e[4]*s+e[8]*c+e[12],i[13]=e[1]*n+e[5]*s+e[9]*c+e[13],i[14]=e[2]*n+e[6]*s+e[10]*c+e[14],i[15]=e[3]*n+e[7]*s+e[11]*c+e[15]):(f=e[0],r=e[1],b=e[2],w=e[3],E=e[4],k=e[5],F=e[6],$=e[7],X=e[8],W=e[9],ne=e[10],_e=e[11],i[0]=f,i[1]=r,i[2]=b,i[3]=w,i[4]=E,i[5]=k,i[6]=F,i[7]=$,i[8]=X,i[9]=W,i[10]=ne,i[11]=_e,i[12]=f*n+E*s+X*c+e[12],i[13]=r*n+k*s+W*c+e[13],i[14]=b*n+F*s+ne*c+e[14],i[15]=w*n+$*s+_e*c+e[15]),i}function pC(i,e,t){const n=t[0],s=t[1],c=t[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[7]=e[7]*s,i[8]=e[8]*c,i[9]=e[9]*c,i[10]=e[10]*c,i[11]=e[11]*c,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function xq(i,e,t,n){let s=n[0],c=n[1],f=n[2],r=Math.sqrt(s*s+c*c+f*f),b,w,E,k,F,$,X,W,ne,_e,Te,we,Ee,Le,Je,Tt,_t,St,kt,Lt,si,bi,ii,vi;return r<Dy?null:(r=1/r,s*=r,c*=r,f*=r,w=Math.sin(t),b=Math.cos(t),E=1-b,k=e[0],F=e[1],$=e[2],X=e[3],W=e[4],ne=e[5],_e=e[6],Te=e[7],we=e[8],Ee=e[9],Le=e[10],Je=e[11],Tt=s*s*E+b,_t=c*s*E+f*w,St=f*s*E-c*w,kt=s*c*E-f*w,Lt=c*c*E+b,si=f*c*E+s*w,bi=s*f*E+c*w,ii=c*f*E-s*w,vi=f*f*E+b,i[0]=k*Tt+W*_t+we*St,i[1]=F*Tt+ne*_t+Ee*St,i[2]=$*Tt+_e*_t+Le*St,i[3]=X*Tt+Te*_t+Je*St,i[4]=k*kt+W*Lt+we*si,i[5]=F*kt+ne*Lt+Ee*si,i[6]=$*kt+_e*Lt+Le*si,i[7]=X*kt+Te*Lt+Je*si,i[8]=k*bi+W*ii+we*vi,i[9]=F*bi+ne*ii+Ee*vi,i[10]=$*bi+_e*ii+Le*vi,i[11]=X*bi+Te*ii+Je*vi,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function RL(i,e,t){const n=Math.sin(t),s=Math.cos(t),c=e[4],f=e[5],r=e[6],b=e[7],w=e[8],E=e[9],k=e[10],F=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=c*s+w*n,i[5]=f*s+E*n,i[6]=r*s+k*n,i[7]=b*s+F*n,i[8]=w*s-c*n,i[9]=E*s-f*n,i[10]=k*s-r*n,i[11]=F*s-b*n,i}function wq(i,e,t){const n=Math.sin(t),s=Math.cos(t),c=e[0],f=e[1],r=e[2],b=e[3],w=e[8],E=e[9],k=e[10],F=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=c*s-w*n,i[1]=f*s-E*n,i[2]=r*s-k*n,i[3]=b*s-F*n,i[8]=c*n+w*s,i[9]=f*n+E*s,i[10]=r*n+k*s,i[11]=b*n+F*s,i}function kL(i,e,t){const n=Math.sin(t),s=Math.cos(t),c=e[0],f=e[1],r=e[2],b=e[3],w=e[4],E=e[5],k=e[6],F=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=c*s+w*n,i[1]=f*s+E*n,i[2]=r*s+k*n,i[3]=b*s+F*n,i[4]=w*s-c*n,i[5]=E*s-f*n,i[6]=k*s-r*n,i[7]=F*s-b*n,i}function Aq(i,e){const t=e[0],n=e[1],s=e[2],c=e[3],f=t+t,r=n+n,b=s+s,w=t*f,E=n*f,k=n*r,F=s*f,$=s*r,X=s*b,W=c*f,ne=c*r,_e=c*b;return i[0]=1-k-X,i[1]=E+_e,i[2]=F-ne,i[3]=0,i[4]=E-_e,i[5]=1-w-X,i[6]=$+W,i[7]=0,i[8]=F+ne,i[9]=$-W,i[10]=1-w-k,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Tq(i,e,t,n,s,c,f){const r=1/(t-e),b=1/(s-n),w=1/(c-f);return i[0]=c*2*r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c*2*b,i[6]=0,i[7]=0,i[8]=(t+e)*r,i[9]=(s+n)*b,i[10]=(f+c)*w,i[11]=-1,i[12]=0,i[13]=0,i[14]=f*c*2*w,i[15]=0,i}function Sq(i,e,t,n,s){const c=1/Math.tan(e/2);if(i[0]=c/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,s!=null&&s!==1/0){const f=1/(n-s);i[10]=(s+n)*f,i[14]=2*s*n*f}else i[10]=-1,i[14]=-2*n;return i}const Eq=Sq;function Cq(i,e,t,n,s,c,f){const r=1/(e-t),b=1/(n-s),w=1/(c-f);return i[0]=-2*r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+t)*r,i[13]=(s+n)*b,i[14]=(f+c)*w,i[15]=1,i}const Iq=Cq;function Mq(i,e,t,n){let s,c,f,r,b,w,E,k,F,$;const X=e[0],W=e[1],ne=e[2],_e=n[0],Te=n[1],we=n[2],Ee=t[0],Le=t[1],Je=t[2];return Math.abs(X-Ee)<Dy&&Math.abs(W-Le)<Dy&&Math.abs(ne-Je)<Dy?yq(i):(k=X-Ee,F=W-Le,$=ne-Je,s=1/Math.sqrt(k*k+F*F+$*$),k*=s,F*=s,$*=s,c=Te*$-we*F,f=we*k-_e*$,r=_e*F-Te*k,s=Math.sqrt(c*c+f*f+r*r),s?(s=1/s,c*=s,f*=s,r*=s):(c=0,f=0,r=0),b=F*r-$*f,w=$*c-k*r,E=k*f-F*c,s=Math.sqrt(b*b+w*w+E*E),s?(s=1/s,b*=s,w*=s,E*=s):(b=0,w=0,E=0),i[0]=c,i[1]=b,i[2]=k,i[3]=0,i[4]=f,i[5]=w,i[6]=F,i[7]=0,i[8]=r,i[9]=E,i[10]=$,i[11]=0,i[12]=-(c*X+f*W+r*ne),i[13]=-(b*X+w*W+E*ne),i[14]=-(k*X+F*W+$*ne),i[15]=1,i)}function Rq(){const i=new Ul(4);return Ul!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function kq(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function mC(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Pq(i){const e=i[0],t=i[1],n=i[2],s=i[3];return Math.sqrt(e*e+t*t+n*n+s*s)}function Dq(i){const e=i[0],t=i[1],n=i[2],s=i[3];return e*e+t*t+n*n+s*s}function Bq(i,e){const t=e[0],n=e[1],s=e[2],c=e[3];let f=t*t+n*n+s*s+c*c;return f>0&&(f=1/Math.sqrt(f)),i[0]=t*f,i[1]=n*f,i[2]=s*f,i[3]=c*f,i}function Oq(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]}function Fq(i,e,t,n){const s=e[0],c=e[1],f=e[2],r=e[3];return i[0]=s+n*(t[0]-s),i[1]=c+n*(t[1]-c),i[2]=f+n*(t[2]-f),i[3]=r+n*(t[3]-r),i}function Km(i,e,t){const n=e[0],s=e[1],c=e[2],f=e[3];return i[0]=t[0]*n+t[4]*s+t[8]*c+t[12]*f,i[1]=t[1]*n+t[5]*s+t[9]*c+t[13]*f,i[2]=t[2]*n+t[6]*s+t[10]*c+t[14]*f,i[3]=t[3]*n+t[7]*s+t[11]*c+t[15]*f,i}function Lq(i,e,t){const n=e[0],s=e[1],c=e[2],f=t[0],r=t[1],b=t[2],w=t[3],E=w*n+r*c-b*s,k=w*s+b*n-f*c,F=w*c+f*s-r*n,$=-f*n-r*s-b*c;return i[0]=E*w+$*-f+k*-b-F*-r,i[1]=k*w+$*-r+F*-f-E*-b,i[2]=F*w+$*-b+E*-r-k*-f,i[3]=e[3],i}(function(){const i=Rq();return function(e,t,n,s,c,f){let r,b;for(t||(t=4),n||(n=0),s?b=Math.min(s*t+n,e.length):b=e.length,r=n;r<b;r+=t)i[0]=e[r],i[1]=e[r+1],i[2]=e[r+2],i[3]=e[r+3],c(i,i,f),e[r]=i[0],e[r+1]=i[1],e[r+2]=i[2],e[r+3]=i[3];return e}})();var FS;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(FS||(FS={}));const zq=45*Math.PI/180,Nq=1,h2=.1,u2=500,Uq=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class co extends ML{static get IDENTITY(){return $q()}static get ZERO(){return Vq()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return FS}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,s,c,f,r,b,w,E,k,F,$,X,W,ne){return this[0]=e,this[1]=t,this[2]=n,this[3]=s,this[4]=c,this[5]=f,this[6]=r,this[7]=b,this[8]=w,this[9]=E,this[10]=k,this[11]=F,this[12]=$,this[13]=X,this[14]=W,this[15]=ne,this.check()}setRowMajor(e,t,n,s,c,f,r,b,w,E,k,F,$,X,W,ne){return this[0]=e,this[1]=c,this[2]=w,this[3]=$,this[4]=t,this[5]=f,this[6]=E,this[7]=X,this[8]=n,this[9]=r,this[10]=k,this[11]=W,this[12]=s,this[13]=b,this[14]=F,this[15]=ne,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Uq)}fromObject(e){return this.check()}fromQuaternion(e){return Aq(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:s,top:c,near:f=h2,far:r=u2}=e;return r===1/0?jq(this,t,n,s,c,f):Tq(this,t,n,s,c,f,r),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:s=[0,1,0]}=e;return Mq(this,t,n,s),this.check()}ortho(e){const{left:t,right:n,bottom:s,top:c,near:f=h2,far:r=u2}=e;return Iq(this,t,n,s,c,f,r),this.check()}orthographic(e){const{fovy:t=zq,aspect:n=Nq,focalDistance:s=1,near:c=h2,far:f=u2}=e;AP(t);const r=t/2,b=s*Math.tan(r),w=b*n;return this.ortho({left:-w,right:w,bottom:-b,top:b,near:c,far:f})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:s=.1,far:c=500}=e;return AP(t),Eq(this,t,n,s,c),this.check()}determinant(){return vq(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),s=1/n[0],c=1/n[1],f=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*c,e[2]=this[2]*f,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*c,e[6]=this[6]*f,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*c,e[10]=this[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),s=1/n[0],c=1/n[1],f=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*c,e[2]=this[2]*f,e[3]=this[4]*s,e[4]=this[5]*c,e[5]=this[6]*f,e[6]=this[8]*s,e[7]=this[9]*c,e[8]=this[10]*f,e}transpose(){return bq(this,this),this.check()}invert(){return OS(this,this),this.check()}multiplyLeft(e){return ff(this,e,this),this.check()}multiplyRight(e){return ff(this,this,e),this.check()}rotateX(e){return RL(this,this,e),this.check()}rotateY(e){return wq(this,this,e),this.check()}rotateZ(e){return kL(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return xq(this,this,e,t),this.check()}scale(e){return pC(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return A1(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Km(t||[-0,-0,-0,-0],e,this),Py(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let s;switch(n){case 2:s=qX(t||[-0,-0],e,this);break;case 3:s=dC(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Py(s,e.length),s}transformAsVector(e,t){let n;switch(e.length){case 2:n=YX(t||[-0,-0],e,this);break;case 3:n=xL(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Py(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let Jv,Qv;function Vq(){return Jv||(Jv=new co([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Jv)),Jv}function $q(){return Qv||(Qv=new co,Object.freeze(Qv)),Qv}function AP(i){if(i>Math.PI*2)throw Error("expected radians")}function jq(i,e,t,n,s,c){const f=2*c/(t-e),r=2*c/(s-n),b=(t+e)/(t-e),w=(s+n)/(s-n),E=-1,k=-1,F=-2*c;return i[0]=f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r,i[6]=0,i[7]=0,i[8]=b,i[9]=w,i[10]=E,i[11]=k,i[12]=0,i[13]=0,i[14]=F,i[15]=0,i}function TP(){const i=new Ul(4);return Ul!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Hq(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function PL(i,e,t){t=t*.5;const n=Math.sin(t);return i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[3]=Math.cos(t),i}function SP(i,e,t){const n=e[0],s=e[1],c=e[2],f=e[3],r=t[0],b=t[1],w=t[2],E=t[3];return i[0]=n*E+f*r+s*w-c*b,i[1]=s*E+f*b+c*r-n*w,i[2]=c*E+f*w+n*b-s*r,i[3]=f*E-n*r-s*b-c*w,i}function Wq(i,e,t){t*=.5;const n=e[0],s=e[1],c=e[2],f=e[3],r=Math.sin(t),b=Math.cos(t);return i[0]=n*b+f*r,i[1]=s*b+c*r,i[2]=c*b-s*r,i[3]=f*b-n*r,i}function Gq(i,e,t){t*=.5;const n=e[0],s=e[1],c=e[2],f=e[3],r=Math.sin(t),b=Math.cos(t);return i[0]=n*b-c*r,i[1]=s*b+f*r,i[2]=c*b+n*r,i[3]=f*b-s*r,i}function Xq(i,e,t){t*=.5;const n=e[0],s=e[1],c=e[2],f=e[3],r=Math.sin(t),b=Math.cos(t);return i[0]=n*b+s*r,i[1]=s*b-n*r,i[2]=c*b+f*r,i[3]=f*b-c*r,i}function qq(i,e){const t=e[0],n=e[1],s=e[2];return i[0]=t,i[1]=n,i[2]=s,i[3]=Math.sqrt(Math.abs(1-t*t-n*n-s*s)),i}function zx(i,e,t,n){const s=e[0],c=e[1],f=e[2],r=e[3];let b=t[0],w=t[1],E=t[2],k=t[3],F,$,X,W,ne;return F=s*b+c*w+f*E+r*k,F<0&&(F=-F,b=-b,w=-w,E=-E,k=-k),1-F>Dy?($=Math.acos(F),ne=Math.sin($),X=Math.sin((1-n)*$)/ne,W=Math.sin(n*$)/ne):(X=1-n,W=n),i[0]=X*s+W*b,i[1]=X*c+W*w,i[2]=X*f+W*E,i[3]=X*r+W*k,i}function Yq(i,e){const t=e[0],n=e[1],s=e[2],c=e[3],f=t*t+n*n+s*s+c*c,r=f?1/f:0;return i[0]=-t*r,i[1]=-n*r,i[2]=-s*r,i[3]=c*r,i}function Zq(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i}function DL(i,e){const t=e[0]+e[4]+e[8];let n;if(t>0)n=Math.sqrt(t+1),i[3]=.5*n,n=.5/n,i[0]=(e[5]-e[7])*n,i[1]=(e[6]-e[2])*n,i[2]=(e[1]-e[3])*n;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const c=(s+1)%3,f=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[c*3+c]-e[f*3+f]+1),i[s]=.5*n,n=.5/n,i[3]=(e[c*3+f]-e[f*3+c])*n,i[c]=(e[c*3+s]+e[s*3+c])*n,i[f]=(e[f*3+s]+e[s*3+f])*n}return i}const Kq=kq,Jq=mC,Qq=Oq,eY=Fq,tY=Pq,iY=Dq,BL=Bq,nY=function(){const i=AL(),e=vP(1,0,0),t=vP(0,1,0);return function(n,s,c){const f=TL(s,c);return f<-.999999?(Lx(i,e,s),IL(i)<1e-6&&Lx(i,t,s),iq(i,i),PL(n,i,Math.PI),n):f>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Lx(i,s,c),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1+f,BL(n,n))}}();(function(){const i=TP(),e=TP();return function(t,n,s,c,f,r){return zx(i,n,f,r),zx(e,s,c,r),zx(t,i,e,2*r*(1-r)),t}})();(function(){const i=lq();return function(e,t,n,s){return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=s[0],i[4]=s[1],i[7]=s[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],BL(e,DL(e,i))}})();const rY=[0,0,0,1];class sY extends uC{constructor(e=0,t=0,n=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,n,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,s){return this[0]=e,this[1]=t,this[2]=n,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return DL(this,e),this.check()}fromAxisRotation(e,t){return PL(this,e,t),this.check()}identity(){return Hq(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Rr(e)}get y(){return this[1]}set y(e){this[1]=Rr(e)}get z(){return this[2]}set z(e){this[2]=Rr(e)}get w(){return this[3]}set w(e){this[3]=Rr(e)}len(){return tY(this)}lengthSquared(){return iY(this)}dot(e){return Qq(this,e)}rotationTo(e,t){return nY(this,e,t),this.check()}add(e){return Kq(this,this,e),this.check()}calculateW(){return qq(this,this),this.check()}conjugate(){return Zq(this,this),this.check()}invert(){return Yq(this,this),this.check()}lerp(e,t,n){return n===void 0?this.lerp(this,e,t):(eY(this,e,t,n),this.check())}multiplyRight(e){return SP(this,this,e),this.check()}multiplyLeft(e){return SP(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return Wq(this,this,e),this.check()}rotateY(e){return Gq(this,this,e),this.check()}rotateZ(e){return Xq(this,this,e),this.check()}scale(e){return Jq(this,this,e),this.check()}slerp(e,t,n){let s,c,f;switch(arguments.length){case 1:({start:s=rY,target:c,ratio:f}=e);break;case 2:s=this,c=e,f=t;break;default:s=e,c=t,f=n}return zx(this,s,c,f),this.check()}transformVector4(e,t=new fC){return Lq(t,e,this),Py(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}function OL(i,e=[],t=0){const n=Math.fround(i),s=i-n;return e[t]=n,e[t+1]=s,e}function oY(i){return i-Math.fround(i)}function aY(i){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let n=0;n<4;++n){const s=t*4+n;OL(i[n*4+t],e,s*2)}return e}const lY=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,cY={name:"fp32",vs:lY},hY=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,uY={ONE:1},dY={name:"fp64arithmetic",vs:hY,defaultUniforms:uY,uniformTypes:{ONE:"f32"},fp64ify:OL,fp64LowPart:oY,fp64ifyMatrix4:aY},fY=[0,1,1,1],pY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,mY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,EP={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:fY},vs:pY,fs:mY,getUniforms:gY};function gY(i={},e){const t={};if(i.highlightedObjectColor!==void 0)if(i.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const n=i.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=n}if(i.highlightColor){const n=Array.from(i.highlightColor,s=>s/255);Number.isFinite(n[3])||(n[3]=1),t.highlightColor=n}return i.isActive!==void 0&&(t.isActive=!!i.isActive,t.isAttribute=!!i.isAttribute),i.useFloatColors!==void 0&&(t.useFloatColors=!!i.useFloatColors),t}const CP=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,_Y=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,FL=3,yY=255;var Jy;(function(i){i[i.POINT=0]="POINT",i[i.DIRECTIONAL=1]="DIRECTIONAL"})(Jy||(Jy={}));const Nx={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:FL},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Jy.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:_Y,vs:CP,fs:CP,getUniforms:bY};function bY(i,e={}){if(i=i&&{...i},!i)return{...Nx.defaultUniforms};i.lights&&(i={...i,...xY(i.lights),lights:void 0});const{ambientLight:t,pointLights:n,directionalLights:s}=i||{};if(!(t||n&&n.length>0||s&&s.length>0))return{...Nx.defaultUniforms,enabled:0};const f={...Nx.defaultUniforms,...e,...vY({ambientLight:t,pointLights:n,directionalLights:s})};return i.enabled!==void 0&&(f.enabled=i.enabled?1:0),f}function vY({ambientLight:i,pointLights:e=[],directionalLights:t=[]}){const n={};n.ambientLightColor=d2(i);let s=0;for(const c of e){n.lightType=Jy.POINT;const f=s;n[`lightColor${f}`]=d2(c),n[`lightPosition${f}`]=c.position,n[`lightAttenuation${f}`]=c.attenuation||[1,0,0],s++}for(const c of t){n.lightType=Jy.DIRECTIONAL;const f=s;n[`lightColor${f}`]=d2(c),n[`lightDirection${f}`]=c.direction,s++}return s>FL&&ni.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=t.length,n.pointLightCount=e.length,n}function xY(i){var t,n;const e={pointLights:[],directionalLights:[]};for(const s of i||[])switch(s.type){case"ambient":e.ambientLight=s;break;case"directional":(t=e.directionalLights)==null||t.push(s);break;case"point":(n=e.pointLights)==null||n.push(s);break}return e}function d2(i={}){const{color:e=[0,0,0],intensity:t=1}=i;return e.map(n=>n*t/yY)}const wY=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,AY=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,IP=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,TY={name:"pbrProjection",vs:IP,fs:IP,getUniforms:i=>i,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},LL={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Nx,TY],vs:wY,fs:AY,defines:{LIGHTING_FRAGMENT:1},getUniforms:i=>i,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},MP=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,SY={name:"layer",vs:MP,fs:MP,getUniforms:i=>({opacity:Math.pow(i.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},EY=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,zL="#define SMOOTH_EDGE_RADIUS 0.5",CY=`${zL}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,IY=`${zL}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,NL={name:"geometry",source:EY,vs:CY,fs:IY},MY=25;var Ss;(function(i){i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel"})(Ss||(Ss={}));var Os;(function(i){i[i.None=0]="None",i[i.Left=1]="Left",i[i.Right=2]="Right",i[i.Up=4]="Up",i[i.Down=8]="Down",i[i.Horizontal=3]="Horizontal",i[i.Vertical=12]="Vertical",i[i.All=15]="All"})(Os||(Os={}));var wn;(function(i){i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Recognized=8]="Recognized",i[i.Cancelled=16]="Cancelled",i[i.Failed=32]="Failed"})(wn||(wn={}));const RY="compute",kY="auto",LS="manipulation",Ux="none",zS="pan-x",NS="pan-y";function PY(i){if(i.includes(Ux))return Ux;const e=i.includes(zS),t=i.includes(NS);return e&&t?Ux:e||t?e?zS:NS:i.includes(LS)?LS:kY}class DY{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===RY&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return PY(e.join(" "))}}function T1(i){return i.trim().split(/\s+/g)}function f2(i,e,t){if(i)for(const n of T1(e))i.addEventListener(n,t,!1)}function p2(i,e,t){if(i)for(const n of T1(e))i.removeEventListener(n,t,!1)}function RP(i){return(i.ownerDocument||i).defaultView}function BY(i,e){let t=i;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function UL(i){const e=i.length;if(e===1)return{x:Math.round(i[0].clientX),y:Math.round(i[0].clientY)};let t=0,n=0,s=0;for(;s<e;)t+=i[s].clientX,n+=i[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(n/e)}}function kP(i){const e=[];let t=0;for(;t<i.pointers.length;)e[t]={clientX:Math.round(i.pointers[t].clientX),clientY:Math.round(i.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:UL(e),deltaX:i.deltaX,deltaY:i.deltaY}}function VL(i,e){const t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)}function PP(i,e){const t=e.clientX-i.clientX,n=e.clientY-i.clientY;return Math.sqrt(t*t+n*n)}function OY(i,e){const t=e.x-i.x,n=e.y-i.y;return Math.atan2(n,t)*180/Math.PI}function DP(i,e){const t=e.clientX-i.clientX,n=e.clientY-i.clientY;return Math.atan2(n,t)*180/Math.PI}function $L(i,e){return i===e?Os.None:Math.abs(i)>=Math.abs(e)?i<0?Os.Left:Os.Right:e<0?Os.Up:Os.Down}function FY(i,e){const t=e.center;let n=i.offsetDelta,s=i.prevDelta;const c=i.prevInput;return(e.eventType===Ss.Start||(c==null?void 0:c.eventType)===Ss.End)&&(s=i.prevDelta={x:(c==null?void 0:c.deltaX)||0,y:(c==null?void 0:c.deltaY)||0},n=i.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-n.x),deltaY:s.y+(t.y-n.y)}}function jL(i,e,t){return{x:e/i||0,y:t/i||0}}function LY(i,e){return PP(e[0],e[1])/PP(i[0],i[1])}function zY(i,e){return DP(e[1],e[0])-DP(i[1],i[0])}function NY(i,e){const t=i.lastInterval||e,n=e.timeStamp-t.timeStamp;let s,c,f,r;if(e.eventType!==Ss.Cancel&&(n>MY||t.velocity===void 0)){const b=e.deltaX-t.deltaX,w=e.deltaY-t.deltaY,E=jL(n,b,w);c=E.x,f=E.y,s=Math.abs(E.x)>Math.abs(E.y)?E.x:E.y,r=$L(b,w),i.lastInterval=e}else s=t.velocity,c=t.velocityX,f=t.velocityY,r=t.direction;e.velocity=s,e.velocityX=c,e.velocityY=f,e.direction=r}function UY(i,e){const{session:t}=i,{pointers:n}=e,{length:s}=n;t.firstInput||(t.firstInput=kP(e)),s>1&&!t.firstMultiple?t.firstMultiple=kP(e):s===1&&(t.firstMultiple=!1);const{firstInput:c,firstMultiple:f}=t,r=f?f.center:c.center,b=e.center=UL(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-c.timeStamp,e.angle=OY(r,b),e.distance=VL(r,b);const{deltaX:w,deltaY:E}=FY(t,e);e.deltaX=w,e.deltaY=E,e.offsetDirection=$L(e.deltaX,e.deltaY);const k=jL(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=k.x,e.overallVelocityY=k.y,e.overallVelocity=Math.abs(k.x)>Math.abs(k.y)?k.x:k.y,e.scale=f?LY(f.pointers,n):1,e.rotation=f?zY(f.pointers,n):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let F=i.element;return BY(e.srcEvent.target,F)&&(F=e.srcEvent.target),e.target=F,NY(t,e),e}function VY(i,e,t){const n=t.pointers.length,s=t.changedPointers.length,c=e&Ss.Start&&n-s===0,f=e&(Ss.End|Ss.Cancel)&&n-s===0;t.isFirst=!!c,t.isFinal=!!f,c&&(i.session={}),t.eventType=e;const r=UY(i,t);i.emit("hammer.input",r),i.recognize(r),i.session.prevInput=r}let $Y=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){VY(this.manager,e,t)}init(){f2(this.element,this.evEl,this.domHandler),f2(this.target,this.evTarget,this.domHandler),f2(RP(this.element),this.evWin,this.domHandler)}destroy(){p2(this.element,this.evEl,this.domHandler),p2(this.target,this.evTarget,this.domHandler),p2(RP(this.element),this.evWin,this.domHandler)}};const jY={pointerdown:Ss.Start,pointermove:Ss.Move,pointerup:Ss.End,pointercancel:Ss.Cancel,pointerout:Ss.Cancel},HY="pointerdown",WY="pointermove pointerup pointercancel";class GY extends $Y{constructor(e){super(e),this.evEl=HY,this.evWin=WY,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const s=jY[e.type],c=e.pointerType,f=c==="touch";let r=t.findIndex(b=>b.pointerId===e.pointerId);s&Ss.Start&&(e.buttons||f)?r<0&&(t.push(e),r=t.length-1):s&(Ss.End|Ss.Cancel)&&(n=!0),!(r<0)&&(t[r]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:c,srcEvent:e}),n&&t.splice(r,1))}}const XY=["","webkit","Moz","MS","ms","o"];function qY(i,e){const t=e[0].toUpperCase()+e.slice(1);for(const n of XY){const s=n?n+t:e;if(s in i)return s}}const YY=1,BP=2,OP={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class ZY{constructor(e,t){this.options={...OP,...t,cssProps:{...OP.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new GY(this),this.touchAction=new DY(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?BP:YY}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:s}=this;let{curRecognizer:c}=t;(!c||c&&c.state&wn.Recognized)&&(c=t.curRecognizer=null);let f=0;for(;f<s.length;)n=s[f],t.stopped!==BP&&(!c||n===c||n.canRecognizeWith(c))?n.recognize(e):n.reset(),!c&&n.state&(wn.Began|wn.Changed|wn.Ended)&&(c=t.curRecognizer=n),f++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:n}=this,s=n.indexOf(t);s!==-1&&(n.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const s of T1(e))n[s]=n[s]||[],n[s].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const s of T1(e))t?n[s]&&n[s].splice(n[s].indexOf(t),1):delete n[s]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let c=0;for(;c<n.length;)n[c](s),c++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,s]of Object.entries(this.options.cssProps)){const c=qY(t.style,n);e?(this.oldCssProps[c]=t.style[c],t.style[c]=s):t.style[c]=this.oldCssProps[c]||""}e||(this.oldCssProps={})}}}let KY=1;function JY(){return KY++}function FP(i){return i&wn.Cancelled?"cancel":i&wn.Ended?"end":i&wn.Changed?"move":i&wn.Began?"start":""}class HL{constructor(e){this.options=e,this.id=JY(),this.state=wn.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return n.indexOf(t)===-1&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const n=this.requireFail.indexOf(t);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<wn.Ended&&this.manager.emit(this.options.event+FP(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=wn.Ended&&this.manager.emit(this.options.event+FP(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=wn.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(wn.Failed|wn.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=wn.Failed;return}this.state&(wn.Recognized|wn.Cancelled|wn.Failed)&&(this.state=wn.Possible),this.state=this.process(t),this.state&(wn.Began|wn.Changed|wn.Ended|wn.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class WL extends HL{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,s=t&(wn.Began|wn.Changed),c=this.attrTest(e);return s&&(n&Ss.Cancel||!c)?t|wn.Cancelled:s||c?n&Ss.End?t|wn.Ended:t&wn.Began?t|wn.Changed:wn.Began:wn.Failed}}class LP extends HL{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[LS]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,s=e.distance<t.threshold,c=e.deltaTime<t.time;if(this.reset(),e.eventType&Ss.Start&&this.count===0)return this.failTimeout();if(s&&c&&n){if(e.eventType!==Ss.End)return this.failTimeout();const f=this.pTime?e.timeStamp-this.pTime<t.interval:!0,r=!this.pCenter||VL(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!r||!f?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=wn.Recognized,this.tryEmit(this._input)},t.interval),wn.Began):wn.Recognized}return wn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=wn.Failed},this.options.interval),wn.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===wn.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const QY=["","start","move","end","cancel","up","down","left","right"];class zP extends WL{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Os.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Os.Horizontal&&t.push(NS),e&Os.Vertical&&t.push(zS),t}getEventNames(){return QY.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:s}=e,{direction:c}=e;const f=e.deltaX,r=e.deltaY;return c&t.direction||(t.direction&Os.Horizontal?(c=f===0?Os.None:f<0?Os.Left:Os.Right,n=f!==this.pX,s=Math.abs(e.deltaX)):(c=r===0?Os.None:r<0?Os.Up:Os.Down,n=r!==this.pY,s=Math.abs(e.deltaY))),e.direction=c,n&&s>t.threshold&&!!(c&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&wn.Began)||!(this.state&wn.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Os[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const eZ=["","start","move","end","cancel","in","out"];class tZ extends WL{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Ux]}getEventNames(){return eZ.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&wn.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Aw{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const iZ=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",nZ=iZ.indexOf("firefox")!==-1,NP=4.000244140625,rZ=40,sZ=.25;class oZ extends Aw{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=s=>{if(!this.options.enable)return;let c=s.deltaY;globalThis.WheelEvent&&(nZ&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(c/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(c*=rZ)),c!==0&&c%NP===0&&(c=Math.floor(c/NP)),s.shiftKey&&c&&(c=c*sZ),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-c,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const UP=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class aZ extends Aw{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=c=>{this.handleOverEvent(c),this.handleOutEvent(c),this.handleEnterEvent(c),this.handleLeaveEvent(c),this.handleMoveEvent(c)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,UP.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){UP.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const VP=["keydown","keyup"];class lZ extends Aw{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=s=>{const c=s.target||s.srcElement;c.tagName==="INPUT"&&c.type==="text"||c.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",VP.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){VP.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class cZ extends Aw{constructor(e,t,n){super(e,t,n),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const $P=1,US=2,jP=4,hZ={pointerdown:$P,pointermove:US,pointerup:jP,mousedown:$P,mousemove:US,mouseup:jP},uZ=0,dZ=1,fZ=2,pZ=1,mZ=2,gZ=4;function _Z(i){const e=hZ[i.srcEvent.type];if(!e)return null;const{buttons:t,button:n}=i.srcEvent;let s=!1,c=!1,f=!1;return e===US?(s=!!(t&pZ),c=!!(t&gZ),f=!!(t&mZ)):(s=n===uZ,c=n===dZ,f=n===fZ),{leftButton:s,middleButton:c,rightButton:f}}function yZ(i,e){const t=i.center;if(!t)return null;const n=e.getBoundingClientRect(),s=n.width/e.offsetWidth||1,c=n.height/e.offsetHeight||1,f={x:(t.x-n.left-e.clientLeft)/s,y:(t.y-n.top-e.clientTop)/c};return{center:t,offsetCenter:f}}const bZ={srcElement:"root",priority:0};class vZ{constructor(e,t){this.handleEvent=n=>{if(this.isEmpty())return;const s=this._normalizeEvent(n);let c=n.srcEvent.target;for(;c&&c!==s.rootElement;){if(this._emit(s,c),s.handled)return;c=c.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,s=!1,c=!1){const{handlers:f,handlersByElement:r}=this,b={...bZ,...n};let w=r.get(b.srcElement);w||(w=[],r.set(b.srcElement,w));const E={type:e,handler:t,srcElement:b.srcElement,priority:b.priority};s&&(E.once=!0),c&&(E.passive=!0),f.push(E),this._active=this._active||!E.passive;let k=w.length-1;for(;k>=0&&!(w[k].priority>=E.priority);)k--;w.splice(k+1,0,E)}remove(e,t){const{handlers:n,handlersByElement:s}=this;for(let c=n.length-1;c>=0;c--){const f=n[c];if(f.type===e&&f.handler===t){n.splice(c,1);const r=s.get(f.srcElement);r.splice(r.indexOf(f),1),r.length===0&&s.delete(f.srcElement)}}this._active=n.some(c=>!c.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let s=!1;const c=()=>{e.handled=!0},f=()=>{e.handled=!0,s=!0},r=[];for(let b=0;b<n.length;b++){const{type:w,handler:E,once:k}=n[b];if(E({...e,type:w,stopPropagation:c,stopImmediatePropagation:f}),k&&r.push(n[b]),s)break}for(let b=0;b<r.length;b++){const{type:w,handler:E}=r[b];this.remove(w,E)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,..._Z(e),...yZ(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function xZ(i){if("recognizer"in i)return i;let e;const t=Array.isArray(i)?[...i]:[i];if(typeof t[0]=="function"){const n=t.shift(),s=t.shift()||{};e=new n(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class wZ{constructor(e=null,t={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new ZY(e,this.options);for(const n of this.options.recognizers){const{recognizer:s,recognizeWith:c,requireFailure:f}=xZ(n);this.manager.add(s),c&&s.recognizeWith(c),f&&s.requireFailure(f)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new oZ(e,this._onOtherEvent,{enable:!1}),this.moveInput=new aZ(e,this._onOtherEvent,{enable:!1}),this.keyInput=new lZ(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new cZ(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var c,f,r,b;const{manager:n}=this;if(!n)return;const s=n.get(e);s&&(s.set({enable:t}),n.touchAction.update()),(c=this.wheelInput)==null||c.enableEventType(e,t),(f=this.moveInput)==null||f.enableEventType(e,t),(r=this.keyInput)==null||r.enableEventType(e,t),(b=this.contextmenuInput)==null||b.enableEventType(e,t)}_addEventHandler(e,t,n,s,c){if(typeof e!="string"){n=t;for(const[w,E]of Object.entries(e))this._addEventHandler(w,E,n,s,c);return}const{manager:f,events:r}=this;if(!f)return;let b=r.get(e);if(!b){const w=this._getRecognizerName(e)||e;b=new vZ(this,w),r.set(e,b),f&&f.on(e,b.handleEvent)}b.add(e,t,n,s,c),b.isEmpty()||this._toggleRecognizer(b.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[c,f]of Object.entries(e))this._removeEventHandler(c,f);return}const{events:n}=this,s=n.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:c}=s;let f=!1;for(const r of n.values())if(r.recognizerName===c&&!r.isEmpty()){f=!0;break}f||this._toggleRecognizer(c,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(n=>n.getEventNames().includes(e)))==null?void 0:t.options.event}}const Qn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Qn,"IDENTITY",{get:()=>(gr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ba={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},S1={common:0,meters:1,pixels:2},VS={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},HP={multipan:[zP,{threshold:10,direction:Os.Vertical,pointers:2}],pinch:[tZ,{},null,["multipan"]],pan:[zP,{threshold:1},["pinch"],["multipan"]],dblclick:[LP,{event:"dblclick",taps:2}],click:[LP,{event:"click"},null,["dblclick"]]};function AZ(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(i[n]!==e[n])return!1;return!0}return!1}function M0(i){let e={},t;return n=>{for(const s in n)if(!AZ(n[s],e[s])){t=i(n),e=n;break}return t}}const WP=[0,0,0,0],TZ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],GL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],SZ=[0,0,0],XL=[0,0,0],EZ=M0(MZ);function qL(i,e,t=XL){t.length<3&&(t=[t[0],t[1],0]);let n=t,s,c=!0;switch(e===Qn.LNGLAT_OFFSETS||e===Qn.METER_OFFSETS?s=t:s=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Ba.WEB_MERCATOR:(e===Qn.LNGLAT||e===Qn.CARTESIAN)&&(s=[0,0,0],c=!1);break;case Ba.WEB_MERCATOR_AUTO_OFFSET:e===Qn.LNGLAT?n=s:e===Qn.CARTESIAN&&(n=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],s=i.unprojectPosition(n),n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]);break;case Ba.IDENTITY:n=i.position.map(Math.fround),n[2]=n[2]||0;break;case Ba.GLOBE:c=!1,s=null;break;default:c=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:n,offsetMode:c}}function CZ(i,e,t){const{viewMatrixUncentered:n,projectionMatrix:s}=i;let{viewMatrix:c,viewProjectionMatrix:f}=i,r=WP,b=WP,w=i.cameraPosition;const{geospatialOrigin:E,shaderCoordinateOrigin:k,offsetMode:F}=qL(i,e,t);return F&&(b=i.projectPosition(E||k),w=[w[0]-b[0],w[1]-b[1],w[2]-b[2]],b[3]=1,r=Km([],b,f),c=n||c,f=ff([],s,c),f=ff([],f,TZ)),{viewMatrix:c,viewProjectionMatrix:f,projectionCenter:r,originCommon:b,cameraPosCommon:w,shaderCoordinateOrigin:k,geospatialOrigin:E}}function IZ({viewport:i,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:n=Qn.DEFAULT,coordinateOrigin:s=XL,autoWrapLongitude:c=!1}){n===Qn.DEFAULT&&(n=i.isGeospatial?Qn.LNGLAT:Qn.CARTESIAN);const f=EZ({viewport:i,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:s});return f.wrapLongitude=c,f.modelMatrix=t||GL,f}function MZ({viewport:i,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:n}){const{projectionCenter:s,viewProjectionMatrix:c,originCommon:f,cameraPosCommon:r,shaderCoordinateOrigin:b,geospatialOrigin:w}=CZ(i,t,n),E=i.getDistanceScales(),k=[i.width*e,i.height*e],F=Km([],[0,0,-i.focalDistance,1],i.projectionMatrix)[3]||1,$={coordinateSystem:t,projectionMode:i.projectionMode,coordinateOrigin:b,commonOrigin:f.slice(0,3),center:s,pseudoMeters:!!i._pseudoMeters,viewportSize:k,devicePixelRatio:e,focalDistance:F,commonUnitsPerMeter:E.unitsPerMeter,commonUnitsPerWorldUnit:E.unitsPerMeter,commonUnitsPerWorldUnit2:SZ,scale:i.scale,wrapLongitude:!1,viewProjectionMatrix:c,modelMatrix:GL,cameraPosition:r};if(w){const X=i.getDistanceScales(w);switch(t){case Qn.METER_OFFSETS:$.commonUnitsPerWorldUnit=X.unitsPerMeter,$.commonUnitsPerWorldUnit2=X.unitsPerMeter2;break;case Qn.LNGLAT:case Qn.LNGLAT_OFFSETS:i._pseudoMeters||($.commonUnitsPerMeter=X.unitsPerMeter),$.commonUnitsPerWorldUnit=X.unitsPerDegree,$.commonUnitsPerWorldUnit2=X.unitsPerDegree2;break;case Qn.CARTESIAN:$.commonUnitsPerWorldUnit=[1,1,X.unitsPerMeter[2]],$.commonUnitsPerWorldUnit2=[0,0,X.unitsPerMeter2[2]];break}}return $}const RZ=Object.keys(Qn).map(i=>`const COORDINATE_SYSTEM_${i}: i32 = ${Qn[i]};`).join(""),kZ=Object.keys(Ba).map(i=>`const PROJECTION_MODE_${i}: i32 = ${Ba[i]};`).join(""),PZ=Object.keys(S1).map(i=>`const UNIT_${i.toUpperCase()}: i32 = ${S1[i]};`).join(""),DZ=`${RZ}
${kZ}
${PZ}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,BZ=`${DZ}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,OZ=Object.keys(Qn).map(i=>`const int COORDINATE_SYSTEM_${i} = ${Qn[i]};`).join(""),FZ=Object.keys(Ba).map(i=>`const int PROJECTION_MODE_${i} = ${Ba[i]};`).join(""),LZ=Object.keys(S1).map(i=>`const int UNIT_${i.toUpperCase()} = ${S1[i]};`).join(""),zZ=`${OZ}
${FZ}
${LZ}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,NZ={};function UZ(i=NZ){return"viewport"in i?IZ(i):{}}const gC={name:"project",dependencies:[cY,NL],source:BZ,vs:zZ,getUniforms:UZ,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},VZ=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,$Z=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,jZ={name:"project32",dependencies:[gC],source:VZ,vs:$Z};function HZ(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xm(i,e){const t=Km([],e,i);return mC(t,t,1/t[3]),t}function GP(i,e){const t=i%e;return t<0?e+t:t}function $S(i,e,t){return i<e?e:i>t?t:i}function WZ(i){return Math.log(i)*Math.LOG2E}const _C=Math.log2||WZ;function Sh(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ol=Math.PI,YL=Ol/4,cl=Ol/180,jS=180/Ol,Bm=512,E1=4003e4,C1=85.051129,GZ=1.5;function XZ(i){return _C(i)}function Qy(i){const[e,t]=i;Sh(Number.isFinite(e)),Sh(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*cl,s=t*cl,c=Bm*(n+Ol)/(2*Ol),f=Bm*(Ol+Math.log(Math.tan(YL+s*.5)))/(2*Ol);return[c,f]}function Om(i){const[e,t]=i,n=e/Bm*(2*Ol)-Ol,s=2*(Math.atan(Math.exp(t/Bm*(2*Ol)-Ol))-YL);return[n*jS,s*jS]}function qZ(i){const{latitude:e}=i;Sh(Number.isFinite(e));const t=Math.cos(e*cl);return XZ(E1*t)-9}function Vx(i){const e=Math.cos(i*cl);return Bm/E1/e}function HS(i){const{latitude:e,longitude:t,highPrecision:n=!1}=i;Sh(Number.isFinite(e)&&Number.isFinite(t));const s=Bm,c=Math.cos(e*cl),f=s/360,r=f/c,b=s/E1/c,w={unitsPerMeter:[b,b,b],metersPerUnit:[1/b,1/b,1/b],unitsPerDegree:[f,r,b],degreesPerUnit:[1/f,1/r,1/b]};if(n){const E=cl*Math.tan(e*cl)/c,k=f*E/2,F=s/E1*E,$=F/r*b;w.unitsPerDegree2=[0,k,F],w.unitsPerMeter2=[$,0,$]}return w}function ZL(i,e){const[t,n,s]=i,[c,f,r]=e,{unitsPerMeter:b,unitsPerMeter2:w}=HS({longitude:t,latitude:n,highPrecision:!0}),E=Qy(i);E[0]+=c*(b[0]+w[0]*f),E[1]+=f*(b[1]+w[1]*f);const k=Om(E),F=(s||0)+(r||0);return Number.isFinite(s)||Number.isFinite(r)?[k[0],k[1],F]:k}function YZ(i){const{height:e,pitch:t,bearing:n,altitude:s,scale:c,center:f}=i,r=HZ();A1(r,r,[0,0,-s]),RL(r,r,-t*cl),kL(r,r,n*cl);const b=c/e;return pC(r,r,[b,b,b]),f&&A1(r,r,tq([],f)),r}function ZZ(i){const{width:e,height:t,altitude:n,pitch:s=0,offset:c,center:f,scale:r,nearZMultiplier:b=1,farZMultiplier:w=1}=i;let{fovy:E=e0(GZ)}=i;n!==void 0&&(E=e0(n));const k=E*cl,F=s*cl,$=yC(E);let X=$;f&&(X+=f[2]*r/Math.cos(F)/t);const W=k*(.5+(c?c[1]:0)/t),ne=Math.sin(W)*X/Math.sin($S(Math.PI/2-F-W,.01,Math.PI-.01)),_e=Math.sin(F)*ne+X,Te=X*10,we=Math.min(_e*w,Te);return{fov:k,aspect:e/t,focalDistance:$,near:b,far:we}}function e0(i){return 2*Math.atan(.5/i)*jS}function yC(i){return .5/Math.tan(.5*i*cl)}function KL(i,e){const[t,n,s=0]=i;return Sh(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(s)),xm(e,[t,n,s,1])}function bC(i,e,t=0){const[n,s,c]=i;if(Sh(Number.isFinite(n)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(c))return xm(e,[n,s,c,1]);const f=xm(e,[n,s,0,1]),r=xm(e,[n,s,1,1]),b=f[2],w=r[2],E=b===w?0:((t||0)-b)/(w-b);return vL([],f,r,E)}function KZ(i){const{width:e,height:t,bounds:n,minExtent:s=0,maxZoom:c=24,offset:f=[0,0]}=i,[[r,b],[w,E]]=n,k=JZ(i.padding),F=Qy([r,$S(E,-85.051129,C1)]),$=Qy([w,$S(b,-85.051129,C1)]),X=[Math.max(Math.abs($[0]-F[0]),s),Math.max(Math.abs($[1]-F[1]),s)],W=[e-k.left-k.right-Math.abs(f[0])*2,t-k.top-k.bottom-Math.abs(f[1])*2];Sh(W[0]>0&&W[1]>0);const ne=W[0]/X[0],_e=W[1]/X[1],Te=(k.right-k.left)/2/ne,we=(k.top-k.bottom)/2/_e,Ee=[($[0]+F[0])/2+Te,($[1]+F[1])/2+we],Le=Om(Ee),Je=Math.min(c,_C(Math.abs(Math.min(ne,_e))));return Sh(Number.isFinite(Je)),{longitude:Le[0],latitude:Le[1],zoom:Je}}function JZ(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(Sh(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const XP=Math.PI/180;function QZ(i,e=0){const{width:t,height:n,unproject:s}=i,c={targetZ:e},f=s([0,n],c),r=s([t,n],c);let b,w;const E=i.fovy?.5*i.fovy*XP:Math.atan(.5/i.altitude),k=(90-i.pitch)*XP;return E>k-.01?(b=qP(i,0,e),w=qP(i,t,e)):(b=s([0,0],c),w=s([t,0],c)),[f,r,w,b]}function qP(i,e,t){const{pixelUnprojectionMatrix:n}=i,s=xm(n,[e,0,1,1]),c=xm(n,[e,i.height,1,1]),r=(t*i.distanceScales.unitsPerMeter[2]-s[2])/(c[2]-s[2]),b=vL([],s,c,r),w=Om(b);return w.push(t),w}const YP=512;function eK(i){const{width:e,height:t,pitch:n=0}=i;let{longitude:s,latitude:c,zoom:f,bearing:r=0}=i;(s<-180||s>180)&&(s=GP(s+180,360)-180),(r<-180||r>180)&&(r=GP(r+180,360)-180);const b=_C(t/YP);if(f<=b)f=b,c=0;else{const w=t/2/Math.pow(2,f),E=Om([0,w])[1];if(c<E)c=E;else{const k=Om([0,YP-w])[1];c>k&&(c=k)}}return{width:e,height:t,longitude:s,latitude:c,zoom:f,pitch:n,bearing:r}}const JL=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,tK=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,iK=`
${JL}
${tK}
`,nK=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,rK=`
${JL}
${nK}
`,sK=M0(hK),oK=M0(uK),aK=[0,0,0,1],lK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function cK(i,e){const[t,n,s]=i,c=bC([t,n,s],e);return Number.isFinite(s)?c:[c[0],c[1],0]}function hK({viewport:i,center:e}){return new co(i.viewProjectionMatrix).invert().transform(e)}function uK({viewport:i,shadowMatrices:e}){const t=[],n=i.pixelUnprojectionMatrix,s=i.isGeospatial?void 0:1,c=[[0,0,s],[i.width,0,s],[0,i.height,s],[i.width,i.height,s],[0,0,-1],[i.width,0,-1],[0,i.height,-1],[i.width,i.height,-1]].map(f=>cK(f,n));for(const f of e){const r=f.clone().translate(new lo(i.center).negate()),b=c.map(E=>r.transform(E)),w=new co().ortho({left:Math.min(...b.map(E=>E[0])),right:Math.max(...b.map(E=>E[0])),bottom:Math.min(...b.map(E=>E[1])),top:Math.max(...b.map(E=>E[1])),near:Math.min(...b.map(E=>-E[2])),far:Math.max(...b.map(E=>-E[2]))});t.push(w.multiplyRight(f))}return t}function dK(i){const{shadowEnabled:e=!0,project:t}=i;if(!e||!t||!i.shadowMatrices||!i.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};const n=gC.getUniforms(t),s=sK({viewport:t.viewport,center:n.center}),c=[],f=oK({shadowMatrices:i.shadowMatrices,viewport:t.viewport}).slice();for(let b=0;b<i.shadowMatrices.length;b++){const w=f[b],E=w.clone().translate(new lo(t.viewport.center).negate());n.coordinateSystem===Qn.LNGLAT&&n.projectionMode===Ba.WEB_MERCATOR?(f[b]=E,c[b]=s):(f[b]=w.clone().multiplyRight(lK),c[b]=E.transform(s))}const r={drawShadowMap:!!i.drawToShadowMap,useShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,color:i.shadowColor||aK,lightId:i.shadowLightId||0,lightCount:i.shadowMatrices.length,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};for(let b=0;b<f.length;b++)r[`viewProjectionMatrix${b}`]=f[b],r[`projectCenter${b}`]=c[b];for(let b=0;b<2;b++)r[`shadow_uShadowMap${b}`]=i.shadowMaps&&i.shadowMaps[b]||i.dummyShadowMap;return r}const ZP={name:"shadow",dependencies:[gC],vs:iK,fs:rK,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:dK,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},fK={...EP,defaultUniforms:{...EP.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},pK=[NL],mK=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],gK=[];function _K(i){const e=h1.getDefaultShaderAssembler();for(const n of pK)e.addDefaultModule(n);const t=i==="glsl"?mK:gK;for(const n of t)e.addShaderHook(n);return e}const yK=[255,255,255],bK=1;let vK=0;class xK{constructor(e={}){this.type="ambient";const{color:t=yK}=e,{intensity:n=bK}=e;this.id=e.id||`ambient-${vK++}`,this.color=t,this.intensity=n}}const wK=[255,255,255],AK=1,TK=[0,0,-1];let SK=0;class KP{constructor(e={}){this.type="directional";const{color:t=wK}=e,{intensity:n=AK}=e,{direction:s=TK}=e,{_shadow:c=!1}=e;this.id=e.id||`directional-${SK++}`,this.color=t,this.intensity=n,this.type="directional",this.direction=new lo(s).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}class EK{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class vC extends EK{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,c=e.clearColor??(s?[0,0,0,0]:!1),f=s?1:!1,r=s?0:!1,b=e.colorMask??15,w={viewport:[0,0,t,n]};e.colorMask&&(w.colorMask=b),e.scissorRect&&(w.scissorRect=e.scissorRect);const E=this.device.beginRenderPass({framebuffer:e.target,parameters:w,clearColor:c,clearDepth:f,clearStencil:r});try{return this._drawLayers(E,e)}finally{E.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:s,viewports:c,views:f,onViewportActive:r,clearStack:b=!0}=t;t.pass=t.pass||"unknown",b&&(this._lastRenderIndex=-1);const w=[];for(const E of c){const k=f&&f[E.id];r==null||r(E);const F=this._getDrawLayerParams(E,t),$=E.subViewports||[E];for(const X of $){const W=this._drawLayersInViewport(e,{target:n,shaderModuleProps:s,viewport:X,view:k,pass:t.pass,layers:t.layers},F);w.push(W)}}return w}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:s=!1,layerFilter:c,cullRect:f,effects:r,shaderModuleProps:b},w=!1){var X;const E=[],k=QL(this._lastRenderIndex+1),F={layer:t[0],viewport:e,isPicking:s,renderPass:n,cullRect:f},$={};for(let W=0;W<t.length;W++){const ne=t[W],_e=this._shouldDrawLayer(ne,F,c,$),Te={shouldDrawLayer:_e};_e&&!w&&(Te.shouldDrawLayer=!0,Te.layerRenderIndex=k(ne,_e),Te.shaderModuleProps=this._getShaderModuleProps(ne,r,n,b),Te.layerParameters={...(X=ne.context.deck)==null?void 0:X.props.parameters,...this.getLayerParameters(ne,W,e)}),E[W]=Te}return E}_drawLayersInViewport(e,{layers:t,shaderModuleProps:n,pass:s,target:c,viewport:f,view:r},b){const w=CK(this.device,{shaderModuleProps:n,target:c,viewport:f});if(r&&r.props.clear){const k=r.props.clear===!0?{color:!0,depth:!0}:r.props.clear;this.device.beginRenderPass({framebuffer:c,parameters:{viewport:w,scissorRect:w},clearColor:k.color?[0,0,0,0]:!1,clearDepth:k.depth?1:!1}).end()}const E={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:w});for(let k=0;k<t.length;k++){const F=t[k],$=b[k],{shouldDrawLayer:X}=$;if(X&&F.props.pickable&&E.pickableCount++,F.isComposite&&E.compositeCount++,F.isDrawable&&$.shouldDrawLayer){const{layerRenderIndex:W,shaderModuleProps:ne,layerParameters:_e}=$;E.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,W),ne.project&&(ne.project.viewport=f),F.context.renderPass=e;try{F._drawLayer({renderPass:e,shaderModuleProps:ne,uniforms:{layerIndex:W},parameters:_e})}catch(Te){F.raiseError(Te,`drawing ${F} to ${s}`)}}}return E}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let f=e.parent;for(;f;){if(!f.props.visible||!f.filterSubLayer(t))return!1;t.layer=f,f=f.parent}if(n){const r=t.layer.id;if(r in s||(s[r]=n(t)),!s[r])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,s){var b,w;const c=this.device.canvasContext.cssToDeviceRatio(),f=((b=e.internalState)==null?void 0:b.propsInTransition)||e.props,r={layer:f,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:c,modelMatrix:f.modelMatrix,coordinateSystem:f.coordinateSystem,coordinateOrigin:f.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const E of t)JP(r,(w=E.getShaderModuleProps)==null?void 0:w.call(E,e,r));return JP(r,this.getShaderModuleProps(e,t,r),s)}}function QL(i=0,e={}){const t={},n=(s,c)=>{const f=s.props._offset,r=s.id,b=s.parent&&s.parent.id;let w;if(b&&!(b in e)&&n(s.parent,!1),b in t){const E=t[b]=t[b]||QL(e[b],e);w=E(s,c),t[r]=E}else Number.isFinite(f)?(w=f+(e[b]||0),t[r]=null):w=i;return c&&w>=i&&(i=w+1),e[r]=w,w};return n}function CK(i,{shaderModuleProps:e,target:t,viewport:n}){var b;const s=((b=e==null?void 0:e.project)==null?void 0:b.devicePixelRatio)??i.canvasContext.cssToDeviceRatio(),[,c]=i.canvasContext.getDrawingBufferSize(),f=t?t.height:c,r=n;return[r.x*s,f-(r.y+r.height)*s,r.width*s,r.height*s]}function JP(i,...e){for(const t of e)if(t)for(const n in t)i[n]?Object.assign(i[n],t[n]):i[n]=t[n];return i}class IK extends vC{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],c=s.width*n,f=s.height*n,r=[1,1,1,1];(c!==t.width||f!==t.height)&&t.resize({width:c,height:f}),super.render({...e,clearColor:r,target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const MK={color:[255,255,255],intensity:1},QP=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],RK=[0,0,0,200/255];class ez{constructor(e={}){this.id="lighting-effect",this.shadowColor=RK,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(ZP),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:s,views:c}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let f=0;f<this.shadowPasses.length;f++)this.shadowPasses[f].render({layers:e,layerFilter:t,viewports:n,onViewportActive:s,views:c,shaderModuleProps:{shadow:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(f=>f.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(f=>f.getProjectedLight({layer:e})),pointLights:this.pointLights.map(f=>f.getProjectedLight({layer:e}))},c=e.props.material;return{shadow:n,lighting:s,phongMaterial:c,gouraudMaterial:c}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(ZP))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=new co().lookAt({eye:new lo(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new IK(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;!e&&t.length===0&&n.length===0&&(this.ambientLight=new xK(MK),this.directionalLights.push(new KP(QP[0]),new KP(QP[1])))}}class kK{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:s,padding:c=0,copy:f=!1,initialize:r=!1,maxCount:b}){const w=s||e&&e.constructor||Float32Array,E=t*n+c;if(ArrayBuffer.isView(e)){if(E<=e.length)return e;if(E*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new w(e.buffer,0,E)}let k=1/0;b&&(k=b*n+c);const F=this._allocate(w,E,r,k);return e&&f?F.set(e):r||F.fill(0,0,4),this._release(e),F}release(e){this._release(e)}_allocate(e,t,n,s){let c=Math.max(Math.ceil(t*this.opts.overAlloc),1);c>s&&(c=s);const f=this._pool,r=e.BYTES_PER_ELEMENT*c,b=f.findIndex(w=>w.byteLength>=r);if(b>=0){const w=new e(f.splice(b,1)[0],0,c);return n&&w.fill(0),w}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:s}=n,c=t.findIndex(f=>f.byteLength>=s);c<0?t.push(n):(c>0||t.length<this.opts.poolSize)&&t.splice(c,0,n),t.length>this.opts.poolSize&&t.shift()}}const t0=new kK;function cy(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function PK(i,e){const t=i%e;return t<0?e+t:t}function DK(i){return[i[12],i[13],i[14]]}function BK(i){return{left:sm(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:sm(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:sm(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:sm(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:sm(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:sm(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const eD=new lo;function sm(i,e,t,n){eD.set(i,e,t);const s=eD.len();return{distance:n/s,normal:new lo(-i/s,-e/s,-t/s)}}function OK(i){return i-Math.fround(i)}let Q_;function m2(i,e){const{size:t=1,startIndex:n=0}=e,s=e.endIndex!==void 0?e.endIndex:i.length,c=(s-n)/t;Q_=t0.allocate(Q_,c,{type:Float32Array,size:t*2});let f=n,r=0;for(;f<s;){for(let b=0;b<t;b++){const w=i[f++];Q_[r+b]=w,Q_[r+b+t]=OK(w)}r+=t*2}return Q_.subarray(0,c*t*2)}function FK(i){let e=null,t=!1;for(const n of i)n&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const LK=Math.PI/180,zK=cy(),tD=[0,0,0],NK={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function UK({width:i,height:e,orthographic:t,fovyRadians:n,focalDistance:s,padding:c,near:f,far:r}){const b=i/e,w=t?new co().orthographic({fovy:n,aspect:b,focalDistance:s,near:f,far:r}):new co().perspective({fovy:n,aspect:b,near:f,far:r});if(c){const{left:E=0,right:k=0,top:F=0,bottom:$=0}=c,X=Ic((E+i-k)/2,0,i)-i/2,W=Ic((F+e-$)/2,0,e)-e/2;w[8]-=X*2/i,w[9]+=W*2/e}return w}class Jm{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||NK,this.focalDistance=e.focalDistance||1,this.position=e.position||tD,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ba.WEB_MERCATOR:Ba.WEB_MERCATOR_AUTO_OFFSET:Ba.IDENTITY}equals(e){return e instanceof Jm?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ky(e.projectionMatrix,this.projectionMatrix)&&Ky(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const n=this.projectPosition(e),s=KL(n,this.pixelProjectionMatrix),[c,f]=s,r=t?f:this.height-f;return e.length===2?[c,r]:[c,r,s[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[s,c,f]=e,r=t?c:this.height-c,b=n&&n*this.distanceScales.unitsPerMeter[2],w=bC([s,r,f],this.pixelUnprojectionMatrix,b),[E,k,F]=this.unprojectPosition(w);return Number.isFinite(f)?[E,k,F]:Number.isFinite(n)?[E,k,n]:[E,k]}projectPosition(e){const[t,n]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,n,s]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,n,s]}projectFlat(e){if(this.isGeospatial){const t=Qy(e);return t[1]=Ic(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Om(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),s=this.unproject([this.width,0],t),c=this.unproject([0,this.height],t),f=this.unproject([this.width,this.height],t);return[Math.min(n[0],s[0],c[0],f[0]),Math.min(n[1],s[1],c[1],f[1]),Math.max(n[0],s[0],c[0],f[0]),Math.max(n[1],s[1],c[1],f[1])]}getDistanceScales(e){return e&&this.isGeospatial?HS({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:s=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,BK(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=qZ({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||HS({latitude:n,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:c,modelMatrix:f}=e;let r=tD;if(c&&(r=f?new co(f).transformAsVector(c,[]):c),this.isGeospatial){const b=this.projectPosition([t,n,0]);this.center=new lo(r).scale(this.distanceScales.unitsPerMeter).add(b)}else this.center=this.projectPosition(r)}_initMatrices(e){const{viewMatrix:t=zK,projectionMatrix:n=null,orthographic:s=!1,fovyRadians:c,fovy:f=75,near:r=.1,far:b=1e3,padding:w=null,focalDistance:E=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new co().multiplyRight(t).translate(new lo(this.center).negate()),this.projectionMatrix=n||UK({width:this.width,height:this.height,orthographic:s,fovyRadians:c||f*LK,focalDistance:E,padding:w,near:r,far:b});const k=cy();ff(k,k,this.projectionMatrix),ff(k,k,this.viewMatrix),this.viewProjectionMatrix=k,this.viewMatrixInverse=OS([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=DK(this.viewMatrixInverse);const F=cy(),$=cy();pC(F,F,[this.width/2,-this.height/2,1]),A1(F,F,[1,-1,0]),ff($,F,this.viewProjectionMatrix),this.pixelProjectionMatrix=$,this.pixelUnprojectionMatrix=OS(cy(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||gr.warn("Pixel project matrix not invertible")()}}Jm.displayName="Viewport";class Sf extends Jm{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:s=0,pitch:c=0,bearing:f=0,nearZMultiplier:r=.1,farZMultiplier:b=1.01,nearZ:w,farZ:E,orthographic:k=!1,projectionMatrix:F,repeat:$=!1,worldOffset:X=0,position:W,padding:ne,legacyMeterSizes:_e=!1}=e;let{width:Te,height:we,altitude:Ee=1.5}=e;const Le=Math.pow(2,s);Te=Te||1,we=we||1;let Je,Tt=null;if(F)Ee=F[5]/2,Je=e0(Ee);else{e.fovy?(Je=e.fovy,Ee=yC(Je)):Je=e0(Ee);let St;if(ne){const{top:kt=0,bottom:Lt=0}=ne;St=[0,Ic((kt+we-Lt)/2,0,we)-we/2]}Tt=ZZ({width:Te,height:we,scale:Le,center:W&&[0,0,W[2]*Vx(t)],offset:St,pitch:c,fovy:Je,nearZMultiplier:r,farZMultiplier:b}),Number.isFinite(w)&&(Tt.near=w),Number.isFinite(E)&&(Tt.far=E)}let _t=YZ({height:we,pitch:c,bearing:f,scale:Le,altitude:Ee});X&&(_t=new co().translate([512*X,0,0]).multiplyLeft(_t)),super({...e,width:Te,height:we,viewMatrix:_t,longitude:n,latitude:t,zoom:s,...Tt,fovy:Je,focalDistance:Ee}),this.latitude=t,this.longitude=n,this.zoom=s,this.pitch=c,this.bearing=f,this.altitude=Ee,this.fovy=Je,this.orthographic=k,this._subViewports=$?[]:null,this._pseudoMeters=_e,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let s=t;s<=n;s++){const c=s?new Sf({...this,worldOffset:s}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e),s=(e[2]||0)*Vx(e[1]);return[t,n,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e),s=(e[2]||0)/Vx(n);return[t,n,s]}addMetersToLngLat(e,t){return ZL(e,t)}panByPosition(e,t){const n=bC(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),c=bP([],s,GX([],n)),f=bP([],this.center,c),[r,b]=this.unprojectFlat(f);return{longitude:r,latitude:b}}getBounds(e={}){const t=QZ(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:s}=this,{longitude:c,latitude:f,zoom:r}=KZ({width:n,height:s,bounds:e,...t});return new Sf({width:n,height:s,longitude:c,latitude:f,zoom:r})}}Sf.displayName="WebMercatorViewport";const iD=[0,0,0];function g2(i,e,t=!1){const n=e.projectPosition(i);if(t&&e instanceof Sf){const[s,c,f=0]=i,r=e.getDistanceScales([s,c]);n[2]=f*r.unitsPerMeter[2]}return n}function VK(i){const{viewport:e,modelMatrix:t,coordinateOrigin:n}=i;let{coordinateSystem:s,fromCoordinateSystem:c,fromCoordinateOrigin:f}=i;return s===Qn.DEFAULT&&(s=e.isGeospatial?Qn.LNGLAT:Qn.CARTESIAN),c===void 0&&(c=s),f===void 0&&(f=n),{viewport:e,coordinateSystem:s,coordinateOrigin:n,modelMatrix:t,fromCoordinateSystem:c,fromCoordinateOrigin:f}}function tz(i,{viewport:e,modelMatrix:t,coordinateSystem:n,coordinateOrigin:s,offsetMode:c}){let[f,r,b=0]=i;switch(t&&([f,r,b]=Km([],[f,r,b,1],t)),n){case Qn.LNGLAT:return g2([f,r,b],e,c);case Qn.LNGLAT_OFFSETS:return g2([f+s[0],r+s[1],b+(s[2]||0)],e,c);case Qn.METER_OFFSETS:return g2(ZL(s,[f,r,b]),e,c);case Qn.CARTESIAN:default:return e.isGeospatial?[f+s[0],r+s[1],b+s[2]]:e.projectPosition([f,r,b])}}function $K(i,e){const{viewport:t,coordinateSystem:n,coordinateOrigin:s,modelMatrix:c,fromCoordinateSystem:f,fromCoordinateOrigin:r}=VK(e),{autoOffset:b=!0}=e,{geospatialOrigin:w=iD,shaderCoordinateOrigin:E=iD,offsetMode:k=!1}=b?qL(t,n,s):{},F=tz(i,{viewport:t,modelMatrix:c,coordinateSystem:f,coordinateOrigin:r,offsetMode:k});if(k){const $=t.projectPosition(w||E);CL(F,F,$)}return F}let jK=1,HK=1;class iz{constructor(){ce(this,"time",0);ce(this,"channels",new Map);ce(this,"animations",new Map);ce(this,"playing",!1);ce(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:s=1,repeat:c=1}=e,f=jK++,r={time:0,delay:t,duration:n,rate:s,repeat:c};return this._setChannelTime(r,this.time),this.channels.set(f,r),f}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const n=this.animations.values();for(const s of n){const{animation:c,channel:f}=s;c.setTime(this.getTime(f))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=HK++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay,s=e.duration*e.repeat;n>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function WK(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function GK(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}let XK=0;const qK={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:i=>console.error(i),stats:AS.stats.get(`animation-loop-${XK++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class YK{constructor(e){ce(this,"device",null);ce(this,"canvas",null);ce(this,"props");ce(this,"animationProps",null);ce(this,"timeline",null);ce(this,"stats");ce(this,"cpuTime");ce(this,"gpuTime");ce(this,"frameRate");ce(this,"display");ce(this,"needsRedraw","initialized");ce(this,"_initialized",!1);ce(this,"_running",!1);ce(this,"_animationFrameId",null);ce(this,"_nextFramePromise",null);ce(this,"_resolveNextFrame",null);ce(this,"_cpuStartTime",0);ce(this,"_error",null);if(this.props={...qK,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new vw({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var n,s;if(this.props.onError(e),this._error=Error(),((s=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:s.canvas)instanceof HTMLCanvasElement){const c=document.createElement("h1");c.innerHTML=e.message,c.style.position="absolute",c.style.top="20%",c.style.left="10px",c.style.color="black",c.style.backgroundColor="red",document.body.appendChild(c)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=WK(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(GK(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,n;const e=(n=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:n.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var c,f,r,b;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((f=(c=this.device)==null?void 0:c.canvasContext)==null?void 0:f.getPixelSize())||[1,1];let n=1;const s=(b=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:b.canvas;return s&&s.clientHeight?n=s.clientWidth/s.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const _2={};function R0(i="id"){_2[i]=_2[i]||1;const e=_2[i]++;return`${i}-${e}`}class nD{constructor(e){ce(this,"id");ce(this,"userData",{});ce(this,"topology");ce(this,"bufferLayout",[]);ce(this,"vertexCount");ce(this,"indices");ce(this,"attributes");if(this.id=e.id||R0("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Hr.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function ZK(i,e){if(e instanceof nD)return e;const t=KK(i,e),{attributes:n,bufferLayout:s}=JK(i,e);return new nD({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:n})}function KK(i,e){if(!e.indices)return;const t=e.indices.value;return i.createBuffer({usage:Hr.INDEX,data:t})}function JK(i,e){const t=[],n={};for(const[c,f]of Object.entries(e.attributes)){let r=c;switch(c){case"POSITION":r="positions";break;case"NORMAL":r="normals";break;case"TEXCOORD_0":r="texCoords";break;case"COLOR_0":r="colors";break}if(f){n[r]=i.createBuffer({data:f.value,id:`${c}-buffer`});const{value:b,size:w,normalized:E}=f;t.push({name:r,format:aX(b,w,E)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:t,vertexCount:s}}const lw=class lw{constructor(e){ce(this,"device");ce(this,"destroyPolicy");ce(this,"_hashCounter",0);ce(this,"_hashes",{});ce(this,"_renderPipelineCache",{});ce(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new lw(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...Pm.defaultProps,...e},n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=n,this._renderPipelineCache[n]={pipeline:s,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t={...m1.defaultProps,...e},n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=n,this._computePipelineCache[n]={pipeline:s,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof m1?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,n[t].useCount===0&&this.destroyPolicy==="unused"&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,s="-",c=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${n}V${s}BL${c}`;default:const f=this._getHash(JSON.stringify(e.parameters));return`${t}/${n}V${s}T${e.topology}P${f}BL${c}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};ce(lw,"defaultProps",{...Pm.defaultProps});let WS=lw;const cw=class cw{constructor(e){ce(this,"device");ce(this,"destroyPolicy");ce(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new cw(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:s,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};ce(cw,"defaultProps",{...d1.defaultProps});let GS=cw;function QK(i,e){var s;const t={},n="Values";if(i.attributes.length===0&&!((s=i.varyings)!=null&&s.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const c of i.attributes)if(c){const f=`${c.location} ${c.name}: ${c.type}`;t[`in ${f}`]={[n]:c.stepMode||"vertex"}}for(const c of i.varyings||[]){const f=`${c.location} ${c.name}`;t[`out ${f}`]={[n]:JSON.stringify(c)}}return t}let Xs=null,Wd=null;function eJ(i,{id:e,minimap:t,opaque:n,top:s="0",left:c="0",rgbaScale:f=1}){Xs||(Xs=document.createElement("canvas"),Xs.id=e,Xs.title=e,Xs.style.zIndex="100",Xs.style.position="absolute",Xs.style.top=s,Xs.style.left=c,Xs.style.border="blue 5px solid",Xs.style.transform="scaleY(-1)",document.body.appendChild(Xs),Wd=Xs.getContext("2d")),(Xs.width!==i.width||Xs.height!==i.height)&&(Xs.width=i.width/2,Xs.height=i.height/2,Xs.style.width="400px",Xs.style.height="400px");const r=i.device.readPixelsToArrayWebGL(i),b=Wd==null?void 0:Wd.createImageData(i.width,i.height);if(b){for(let E=0;E<r.length;E+=4)b.data[0+E+0]=r[E+0]*f,b.data[0+E+1]=r[E+1]*f,b.data[0+E+2]=r[E+2]*f,b.data[0+E+3]=n?255:r[E+3]*f;Wd==null||Wd.putImageData(b,0,0)}}function XS(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!XS(i[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const n=Object.keys(i),s=Object.keys(e);if(n.length!==s.length)return!1;for(const c of n)if(!e.hasOwnProperty(c)||!XS(i[c],e[c],t-1))return!1;return!0}return!1}function tJ(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function iJ(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":!1}function nz(i){return tJ(i)||iJ(i)}function nJ(i){return nz(i)||typeof i=="number"||typeof i=="boolean"}function rz(i){const e={bindings:{},uniforms:{}};return Object.keys(i).forEach(t=>{const n=i[t];nJ(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}class rJ{constructor(e,t){ce(this,"options",{disableWarnings:!1});ce(this,"modules");ce(this,"moduleUniforms");ce(this,"moduleBindings");Object.assign(this.options,t);const n=eC(Object.values(e).filter(s=>s.dependencies));for(const s of n)e[s.name]=s;ni.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,c]of Object.entries(e))this._addModule(c),c.name&&s!==c.name&&!this.options.disableWarnings&&ni.warn(`Module name: ${s} vs ${c.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const s=n,c=e[s]||{},f=this.modules[s];if(!f){this.options.disableWarnings||ni.warn(`Module ${n} not found`)();continue}const r=this.moduleUniforms[s],b=this.moduleBindings[s],w=((t=f.getUniforms)==null?void 0:t.call(f,c,r))||c,{uniforms:E,bindings:k}=rz(w);this.moduleUniforms[s]={...r,...E},this.moduleBindings[s]={...b,...k}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[n,s]of Object.entries(this.moduleUniforms))for(const[c,f]of Object.entries(s))e[`${n}.${c}`]={type:(t=this.modules[n].uniformTypes)==null?void 0:t[c],value:String(f)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let sJ="";async function oJ(i,e){const t=new Image;return t.crossOrigin="anonymous",t.src=i.startsWith("http")?i:sJ+i,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class y2{constructor(e,t){ce(this,"device");ce(this,"id");ce(this,"texture");ce(this,"sampler");ce(this,"view");ce(this,"ready");ce(this,"isReady",!1);ce(this,"destroyed",!1);ce(this,"resolveReady",()=>{});ce(this,"rejectReady",()=>{});this.device=e,this.id=t.id||R0("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:oJ(t.data)}),this.ready=new Promise((n,s)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=s}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data;let n;try{n=await sz(t)}catch(c){this.rejectReady(c)}if(this.destroyed)return;const s={...e,data:n};this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function sz(i){if(i=await i,Array.isArray(i))return await Promise.all(i.map(sz));if(i&&typeof i=="object"&&i.constructor===Object){const e=i,t=await Promise.all(Object.values(e)),n=Object.keys(e),s={};for(let c=0;c<n.length;c++)s[n[c]]=t[c];return s}return i}const Gd=2,aJ=1e4,hw=class hw{constructor(e,t){ce(this,"device");ce(this,"id");ce(this,"source");ce(this,"vs");ce(this,"fs");ce(this,"pipelineFactory");ce(this,"shaderFactory");ce(this,"userData",{});ce(this,"parameters");ce(this,"topology");ce(this,"bufferLayout");ce(this,"isInstanced");ce(this,"instanceCount",0);ce(this,"vertexCount");ce(this,"indexBuffer",null);ce(this,"bufferAttributes",{});ce(this,"constantAttributes",{});ce(this,"bindings",{});ce(this,"uniforms",{});ce(this,"vertexArray");ce(this,"transformFeedback",null);ce(this,"pipeline");ce(this,"shaderInputs");ce(this,"_uniformStore");ce(this,"_attributeInfos",{});ce(this,"_gpuGeometry",null);ce(this,"_getModuleUniforms");ce(this,"props");ce(this,"_pipelineNeedsUpdate","newly created");ce(this,"_needsRedraw","initializing");ce(this,"_destroyed",!1);ce(this,"_lastDrawTimestamp",-1);ce(this,"_lastLogTime",0);ce(this,"_logOpen",!1);ce(this,"_drawCount",0);var b,w,E,k;this.props={...hw.defaultProps,...t},t=this.props,this.id=t.id||R0("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(((b=this.props.modules)==null?void 0:b.map(F=>[F.name,F]))||[]),s=t.shaderInputs||new rJ(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const c=cJ(e),f=(((w=this.props.modules)==null?void 0:w.length)>0?this.props.modules:(E=this.shaderInputs)==null?void 0:E.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:F,getUniforms:$}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:c,...this.props,modules:f});this.source=F,this._getModuleUniforms=$,(k=this.props).shaderLayout||(k.shaderLayout=LX(this.source))}else{const{vs:F,fs:$,getUniforms:X}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:c,...this.props,modules:f});this.vs=F,this.fs=$,this._getModuleUniforms=X}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||WS.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||GS.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ni.info(Gd,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),qS(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:c}=this.vertexArray,f=c?c.byteLength/(c.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:f,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const t=e&&ZK(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const s=new s2(this.bufferLayout);this.bufferLayout=s.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new s2(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){XS(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new oX(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(lJ(n)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&ni.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=lX(this.pipeline.shaderLayout,this.bufferLayout);const s=new s2(this.bufferLayout);for(const[c,f]of Object.entries(e)){const r=s.getBufferLayout(c);if(!r){n||ni.warn(`Model(${this.id}): Missing layout for buffer "${c}".`)();continue}const b=s.getAttributeNamesForBuffer(r);let w=!1;for(const E of b){const k=this._attributeInfos[E];if(k){const F=this.device.type==="webgpu"?s.getBufferIndex(k.bufferName):k.location;this.vertexArray.setBuffer(F,f),w=!0}}!w&&!n&&ni.warn(`Model(${this.id}): Ignoring buffer "${f.id}" for unknown attribute "${c}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,s]of Object.entries(e)){const c=this._attributeInfos[n];c?this.vertexArray.setConstantWebGL(c.location,s):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||ni.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){qS(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:n}=rz(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof y2&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof y2?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof u1?e=Math.max(e,t.texture.updateTimestamp):t instanceof Hr||t instanceof ns?e=Math.max(e,t.updateTimestamp):t instanceof y2?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof f1||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===n)&&n!=="positions"&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ni.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=n:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:s}),this._attributeInfos=qF(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=ni.level>3?0:aJ;ni.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ni.group(Gd,`>>> DRAWING MODEL ${this.id}`,{collapsed:ni.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=QK(this.pipeline.shaderLayout,this.id);ni.table(Gd,e)();const t=this.shaderInputs.getDebugTable();for(const[s,c]of Object.entries(this.uniforms))t[s]={value:c};ni.table(Gd,t)();const n=this._getAttributeDebugTable();ni.table(Gd,this._attributeInfos)(),ni.table(Gd,n)(),ni.groupEnd(Gd)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&eJ(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:s?this._getBufferOrConstantValues(s,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=KF(t);return(e instanceof Hr?new n(e.debugData):e).toString()}};ce(hw,"defaultProps",{...Pm.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:h1.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let i0=hw;function lJ(i){return!!(i.uniformTypes&&!qS(i.uniformTypes))}function cJ(i){return{type:i.type,shaderLanguage:i.info.shadingLanguage,shaderLanguageVersion:i.info.shadingLanguageVersion,gpu:i.info.gpu,features:i.features}}function qS(i){for(const e in i)return!1;return!0}const Gy=class Gy{constructor(e,t=Gy.defaultProps){ce(this,"device");ce(this,"model");ce(this,"transformFeedback");if(!Gy.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new i0(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||cG(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Hr)return t.readAsync();const{buffer:n,byteOffset:s=0,byteLength:c=n.byteLength}=t;return n.readAsync(s,c)}};ce(Gy,"defaultProps",{...i0.defaultProps,outputs:void 0,feedbackBuffers:void 0});let n0=Gy;class hJ{constructor(e){ce(this,"id");ce(this,"topology");ce(this,"vertexCount");ce(this,"indices");ce(this,"attributes");ce(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:s=null}=e;this.id=e.id||R0("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[c,f]of Object.entries(t)){const r=ArrayBuffer.isView(f)?{value:f}:f;if(!ArrayBuffer.isView(r.value))throw new Error(`${this._print(c)}: must be typed array or object with value as typed array`);if((c==="POSITION"||c==="positions")&&!r.size&&(r.size=3),c==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=r}else this.attributes[c]=r}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const s of Object.values(e)){const{value:c,size:f,constant:r}=s;!r&&c&&f!==void 0&&f>=1&&(n=Math.min(n,c.length/f))}return n}}class I1{constructor(e={}){ce(this,"id");ce(this,"matrix",new co);ce(this,"display",!0);ce(this,"position",new lo);ce(this,"rotation",new lo);ce(this,"scale",new lo(1,1,1));ce(this,"userData",{});ce(this,"props",{});const{id:t}=e;this.id=t||R0(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:n,scale:s,update:c=!0}=e;return t&&this.setPosition(t),n&&this.setRotation(n),s&&this.setScale(s),c&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}update(e={}){const{position:t,rotation:n,scale:s}=e;return t&&this.setPosition(t),n&&this.setRotation(n),s&&this.setScale(s),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;const n=new co(e).multiplyRight(t),s=n.invert(),c=s.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:s,worldInverseTransposeMatrix:c}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class wm extends I1{constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:n=[]}=t;ni.assert(n.every(s=>s instanceof I1),"every child must an instance of ScenegraphNode");super(t);ce(this,"children");this.children=n}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,{worldMatrix:s})=>{const c=n.getBounds();if(!c)return;const[f,r]=c,b=new lo(f).add(r).divide([2,2,2]);s.transformAsPoint(b,b);const w=new lo(r).subtract(f).divide([2,2,2]);s.transformAsVector(w,w);for(let E=0;E<8;E++){const k=new lo(E&1?-1:1,E&2?-1:1,E&4?-1:1).multiply(w).add(b);for(let F=0;F<3;F++)t[0][F]=Math.min(t[0][F],k[F]),t[1][F]=Math.max(t[1][F],k[F])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const n of t)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(t){const n=this.children,s=n.indexOf(t);return s>-1&&n.splice(s,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:n=new co}={}){const s=new co(n).multiplyRight(this.matrix);for(const c of this.children)c instanceof wm?c.traverse(t,{worldMatrix:s}):t(c,{worldMatrix:s})}}class YS extends I1{constructor(t){super(t);ce(this,"model");ce(this,"bounds",null);ce(this,"managedResources");this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}const uJ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class oz extends vC{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:s,onViewportActive:c,pickingFBO:f,deviceRect:{x:r,y:b,width:w,height:E},cullRect:k,effects:F,pass:$="picking",pickZ:X,shaderModuleProps:W}){this.pickZ=X;const ne=this._resetColorEncoder(X),_e=[r,b,w,E],Te=super.render({target:f,layers:e,layerFilter:t,views:n,viewports:s,onViewportActive:c,cullRect:k,effects:F==null?void 0:F.filter(Ee=>Ee.useInPicking),pass:$,isPicking:!0,shaderModuleProps:W,clearColor:[0,0,0,0],colorMask:15,scissorRect:_e});return this._colorEncoderState=null,{decodePickingColor:ne&&fJ.bind(null,ne),stats:Te}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const s={...e.props.parameters},{pickable:c,operation:f}=e.props;return!this._colorEncoderState||f.includes("terrain")?s.blend=!1:c&&f.includes("draw")&&(Object.assign(s,uJ),s.blend=!0,s.blendColor=dJ(this._colorEncoderState,e,n)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function dJ(i,e,t){const{byLayer:n,byAlpha:s}=i;let c,f=n.get(e);return f?(f.viewports.push(t),c=f.a):(c=n.size+1,c<=255?(f={a:c,layer:e,viewports:[t]},n.set(e,f),s[c]=f):(gr.warn("Too many pickable layers, only picking the first 255")(),c=0)),[0,0,0,c/255]}function fJ(i,e){const t=i.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const hm={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},M1=Symbol.for("component"),pf=Symbol.for("propTypes"),b2=Symbol.for("deprecatedProps"),Am=Symbol.for("asyncPropDefaults"),Ef=Symbol.for("asyncPropOriginal"),ku=Symbol.for("asyncPropResolved");function r0(i,e=()=>!0){return Array.isArray(i)?az(i,e,[]):e(i)?[i]:[]}function az(i,e,t){let n=-1;for(;++n<i.length;){const s=i[n];Array.isArray(s)?az(s,e,t):e(s)&&t.push(s)}return t}function pJ({target:i,source:e,start:t=0,count:n=1}){const s=e.length,c=n*s;let f=0;for(let r=t;f<s;f++)i[r++]=e[f];for(;f<c;)f<c-f?(i.copyWithin(t+f,t,t+f),f*=2):(i.copyWithin(t+f,t,t+c-f),f=c);return i}class mJ{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let s=e;typeof e=="string"&&(s=gS(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(c=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=c)}).catch(c=>{this._loadCount===n&&(this.isLoaded=!0,this._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const c of this._subscribers)c.onChange(this.getData())}}class gJ{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:s=!0}){let c=this._resources[e];c?c.setData(t,n):(c=new mJ(e,t,this._context),this._resources[e]=c),c.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const n in t){const s=t[n],c=this._resources[s.resourceId];c&&c.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:s="default"}){const{_resources:c,protocol:f}=this;e.startsWith(f)&&(e=e.replace(f,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const r=c[e];if(this._track(n,s,r,t),r)return r.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,s){const c=this._consumers,f=c[e]=c[e]||{};let r=f[t];const b=r&&r.resourceId&&this._resources[r.resourceId];b&&(b.unsubscribe(r),this.prune()),n&&(r?(r.onChange=s,r.resourceId=n.id):r={onChange:s,resourceId:n.id},f[t]=r,n.subscribe(r))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const _J="layerManager.setLayers",yJ="layerManager.activateViewport";class bJ{constructor(e,t){var r;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=b=>{zo(yJ,this,b),b&&(this.context.viewport=b)};const{deck:n,stats:s,viewport:c,timeline:f}=t||{};this.layers=[],this.resourceManager=new gJ({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:_K(((r=e==null?void 0:e.info)==null?void 0:r.shadingLanguage)||"glsl"),defaultShaderModules:[SY],renderPass:void 0,stats:s||new vw({id:"deck.gl"}),viewport:c||new Jm({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:f||new iz,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const s=n.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(n=>t.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){zo(_J,this,t,e),this._lastRenderedLayers=e;const n=r0(e,Boolean);for(const s of n)s.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(n=>n.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(s=>s.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const f of e)n[f.id]?gr.warn(`Multiple old layers with same id ${f.id}`)():n[f.id]=f;if(this._defaultShaderModulesChanged){for(const f of e)f.setNeedsUpdate(),f.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,n,s),this._finalizeOldLayers(n);let c=!1;for(const f of s)if(f.hasUniformTransition()){c=`Uniform transition in ${f}`;break}this._needsUpdate=c,this.layers=s}_updateSublayersRecursively(e,t,n){for(const s of e){s.context=this.context;const c=t[s.id];c===null&&gr.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let f=null;try{this._debug&&c!==s&&s.validateProps(),c?(this._transferLayerState(c,s),this._updateLayer(s)):this._initializeLayer(s),n.push(s),f=s.isComposite?s.getSubLayers():null}catch(r){this._handleError("matching",r,s)}f&&this._updateSublayersRecursively(f,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=hm.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=hm.MATCHED,t!==e&&(e.lifecycle=hm.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=hm.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=hm.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Fl(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!Fl(i[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const n=Object.keys(i),s=Object.keys(e);if(n.length!==s.length)return!1;for(const c of n)if(!e.hasOwnProperty(c)||!Fl(i[c],e[c],t-1))return!1;return!0}return!1}class vJ{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),s={x:e[0],y:e[1]};for(let c=n.length-1;c>=0;--c){const f=n[c];if(f.containsPixel(s)){const r=e.slice();return r[0]-=f.x,r[1]-=f.y,f.unproject(r,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=r0(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Fl(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):gr.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=t.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:c=>{var f;return(f=this.getView(e.id))==null?void 0:f.makeViewport({viewState:c,width:this.width,height:this.height})}})}_updateController(e,t,n,s){const c=e.controller;if(c&&n){const f={...t,...c,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!s||s.constructor!==c.type)&&(s=this._createController(e,f)),s&&s.setProps(f),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let s=e.length;s--;){const c=e[s],f=this.getViewState(c),r=c.makeViewport({viewState:f,width:this.width,height:this.height});let b=t[c.id];const w=!!c.controller;w&&!b&&(n=!0),(n||!w)&&b&&(b.finalize(),b=null),this.controllers[c.id]=this._updateController(c,f,r,b),r&&this._viewports.unshift(r)}for(const s in t){const c=t[s];c&&!this.controllers[s]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((n,s)=>!e[s].equals(t[s]))}}const xJ=/([0-9]+\.?[0-9]*)(%|px)/;function vu(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const e=xJ.exec(i);if(e&&e.length>=3){const t=e[2]==="%",n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error(`Could not parse position string ${i}`)}}function xu(i,e){return i.relative?Math.round(i.position*e):i.position}class lz{constructor(e){const{id:t,x:n=0,y:s=0,width:c="100%",height:f="100%",padding:r=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=vu(n),this._y=vu(s),this._width=vu(c),this._height=vu(f),this._padding=r&&{left:vu(r.left||0),right:vu(r.right||0),top:vu(r.top||0),bottom:vu(r.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Fl(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const c=this.getViewportType(n);return new c({...n,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const n in this.props.viewState)n!=="id"&&(t[n]=this.props.viewState[n]);return t}return e}getDimensions({width:e,height:t}){const n={x:xu(this._x,e),y:xu(this._y,t),width:xu(this._width,e),height:xu(this._height,t)};return this._padding&&(n.padding={left:xu(this._padding.left,e),top:xu(this._padding.top,t),right:xu(this._padding.right,e),bottom:xu(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Tw{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(t=this.settings).onStart)==null||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:s}=this;this._handle=n.addChannel({delay:n.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const rD=()=>{},ZS={BREAK:1,SNAP_TO_END:2,IGNORE:3},wJ=i=>i,AJ=ZS.BREAK;class TJ{constructor(e){this._onTransitionUpdate=t=>{const{time:n,settings:{interpolator:s,startProps:c,endProps:f,duration:r,easing:b}}=t,w=b(n/r),E=s.interpolateProps(c,f,w);this.propsInTransition=this.getControllerState({...this.props,...E}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Tw(e.timeline),this.onViewStateChange=e.onViewStateChange||rD,this.onStateChange=e.onStateChange||rD}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let s=n;if(this.transition.inProgress){const{interruption:c,endProps:f}=this.transition.settings;s={...n,...c===ZS.SNAP_TO_END?f:this.propsInTransition||n}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||t==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===ZS.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const n=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(n),c=t.transitionInterpolator,f=c.getDuration?c.getDuration(e,t):t.transitionDuration;if(f===0)return;const r=c.initializeProps(e,s);this.propsInTransition={};const b={duration:f,easing:t.transitionEasing||wJ,interpolator:c,interruption:t.transitionInterruption||AJ,startProps:r.start,endProps:r.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(b),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function Fs(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}class SJ{constructor(e){const{compare:t,extract:n,required:s}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=s}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Ky(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},s={};for(const c of this._propsToExtract)(c in e||c in t)&&(n[c]=e[c],s[c]=t[c]);return this._checkRequiredProps(n),this._checkRequiredProps(s),{start:n,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];Fs(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const EJ=["longitude","latitude","zoom","bearing","pitch"],CJ=["longitude","latitude","zoom"];class xC extends SJ{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:EJ,required:CJ},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:s,around:c}=this.opts;if(s&&c){const f=s(e),r=s(t),b=f.unproject(c);n.start.around=c,Object.assign(n.end,{around:r.project(b),aroundPosition:b,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const s={};for(const c of this._propsToExtract)s[c]=w1(e[c]||0,t[c]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const c=this.opts.makeViewport({...t,...s});Object.assign(s,c.panByPosition(t.aroundPosition,w1(e.around,t.around,n)))}return s}}const wu={transitionDuration:0},IJ=300,ex=i=>1-(1-i)*(1-i),om={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Xd={};class cz{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new TJ({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-n]}isPointInBounds(e,t){const{width:n,height:s}=this.props;if(t&&t.handled)return!1;const c=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=s;return c&&t&&t.stopPropagation(),c}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?IJ:0;const{scrollZoom:n=!0,dragPan:s=!0,dragRotate:c=!0,doubleClickZoom:f=!0,touchZoom:r=!0,touchRotate:b=!1,keyboard:w=!0}=e,E=!!this.onViewStateChange;this.toggleEvents(om.WHEEL,E&&n),this.toggleEvents(om.PAN,E),this.toggleEvents(om.PINCH,E&&(r||b)),this.toggleEvents(om.MULTI_PAN,E&&b),this.toggleEvents(om.DOUBLE_CLICK,E&&f),this.toggleEvents(om.KEYBOARD,E&&w),this.scrollZoom=n,this.dragPan=s,this.dragRotate=c,this.doubleClickZoom=f,this.touchZoom=r,this.touchRotate=b,this.keyboard=w}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(n=>{this._events[n]!==t&&(this._events[n]=t,t?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,t=null,n={}){const s={...e.getViewportProps(),...t},c=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),c){const f=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:f,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const s=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(s,wu,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,wu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],c=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ex},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,wu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],c=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ex},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:c}=e;let f=2/(1+Math.exp(-Math.abs(c*n)));c<0&&f!==0&&(f=1/f);const r=this.controllerState.zoom({pos:t,scale:f});return this.updateViewport(r,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,wu,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,wu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),s=[n[0],n[1]+=e.velocityY*t/2],c=this.controllerState.rotate({pos:s});this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ex},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Xd._startPinchRotation=e.rotation,Xd._lastPinchEvent=e,this.updateViewport(n,wu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:Xd._startPinchRotation-n})}return this.updateViewport(t,wu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Xd._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=Xd;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const s=this.getCenter(e);let c=this.controllerState.rotateEnd();const f=Math.log2(e.scale),r=(f-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),b=Math.pow(2,f+r*t/2);c=c.zoom({pos:s,scale:b}).zoomEnd(),this.updateViewport(c,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:ex},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Xd._startPinchRotation=null,Xd._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:s,rotateSpeedX:c,rotateSpeedY:f}=this.keyboard===!0?{}:this.keyboard,{controllerState:r}=this;let b;const w={};switch(e.srcEvent.code){case"Minus":b=t?r.zoomOut(n).zoomOut(n):r.zoomOut(n),w.isZooming=!0;break;case"Equal":b=t?r.zoomIn(n).zoomIn(n):r.zoomIn(n),w.isZooming=!0;break;case"ArrowLeft":t?(b=r.rotateLeft(c),w.isRotating=!0):(b=r.moveLeft(s),w.isPanning=!0);break;case"ArrowRight":t?(b=r.rotateRight(c),w.isRotating=!0):(b=r.moveRight(s),w.isPanning=!0);break;case"ArrowUp":t?(b=r.rotateUp(f),w.isRotating=!0):(b=r.moveUp(s),w.isPanning=!0);break;case"ArrowDown":t?(b=r.rotateDown(f),w.isRotating=!0):(b=r.moveDown(s),w.isPanning=!0);break;default:return!1}return this.updateViewport(b,this._getTransitionProps(),w),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?wu:e?{...t,transitionInterpolator:new xC({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class MJ{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const sD=5,RJ=1.2;class hz extends MJ{constructor(e){const{width:t,height:n,latitude:s,longitude:c,zoom:f,bearing:r=0,pitch:b=0,altitude:w=1.5,position:E=[0,0,0],maxZoom:k=20,minZoom:F=0,maxPitch:$=60,minPitch:X=0,startPanLngLat:W,startZoomLngLat:ne,startRotatePos:_e,startBearing:Te,startPitch:we,startZoom:Ee,normalize:Le=!0}=e;Fs(Number.isFinite(c)),Fs(Number.isFinite(s)),Fs(Number.isFinite(f)),super({width:t,height:n,latitude:s,longitude:c,zoom:f,bearing:r,pitch:b,altitude:w,maxZoom:k,minZoom:F,maxPitch:$,minPitch:X,normalize:Le,position:E},{startPanLngLat:W,startZoomLngLat:ne,startRotatePos:_e,startBearing:Te,startPitch:we,startZoom:Ee}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:s,startBearing:c,startPitch:f}=this.getState();if(!s||c===void 0||f===void 0)return this;let r;return e?r=this._getNewRotation(e,s,f,c):r={bearing:c+t,pitch:f+n},this._getUpdatedState(r)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:s,startZoomLngLat:c}=this.getState();if(c||(s=this.getViewportProps().zoom,c=this._unproject(t)||this._unproject(e)),!c)return this;const{maxZoom:f,minZoom:r}=this.getViewportProps();let b=s+Math.log2(n);b=Ic(b,r,f);const w=this.makeViewport({...this.getViewportProps(),zoom:b});return this._getUpdatedState({zoom:b,...w.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:s,longitude:c}=n;return Math.abs(s-t.bearing)>180&&(n.bearing=s<0?s+360:s-360),Math.abs(c-t.longitude)>180&&(n.longitude=c<0?c+360:c-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:s}=e;e.zoom=Ic(s,n,t);const{maxPitch:c,minPitch:f,pitch:r}=e;e.pitch=Ic(r,f,c);const{normalize:b=!0}=e;return b&&Object.assign(e,eK(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,s){const c=e[0]-t[0],f=e[1]-t[1],r=e[1],b=t[1],{width:w,height:E}=this.getViewportProps(),k=c/w;let F=0;f>0?Math.abs(E-b)>sD&&(F=f/(b-E)*RJ):f<0&&b>sD&&(F=1-r/b),F=Ic(F,-1,1);const{minPitch:$,maxPitch:X}=this.getViewportProps(),W=s+180*k;let ne=n;return F>0?ne=n+F*(X-n):F<0&&(ne=n-F*($-n)),{pitch:ne,bearing:W}}}class kJ extends cz{constructor(){super(...arguments),this.ControllerState=hz,this.transition={transitionDuration:300,transitionInterpolator:new xC({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class wC extends lz{constructor(e={}){super(e)}getViewportType(){return Sf}get ControllerType(){return kJ}}wC.displayName="MapView";const PJ=new ez;function DJ(i,e){const t=i.order??1/0,n=e.order??1/0;return t-n}class BJ{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(n=>n.id===e.id)){const n=t.findIndex(s=>DJ(s,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Fl(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const n=[];for(const s of e){const c=t[s.id];let f=s;c&&c!==s?c.setProps?(c.setProps(s.props),f=c):c.cleanup(this._context):c||s.setup(this._context),n.push(f),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(s=>s instanceof ez)||this._resolvedEffects.push(PJ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class OJ extends vC{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const FJ="deckRenderer.renderLayers";class LJ{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new OJ(e),this.pickLayersPass=new oz(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const s=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const c=t.render({...n,target:s});n.effects&&this._postRender(n.effects,n),this.renderCount++,zo(FJ,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[s]}))});for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,s={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const c of e)if(c.postRender){s.target=c.id===this.lastPostProcessEffect?t.target:void 0;const f=c.postRender(s);s.inputBuffer=f,s.swapBuffer=f===n[0]?n[1]:n[0]}}}const zJ={pickedColor:null,pickedObjectIndex:-1};function NJ({pickedColors:i,decodePickingColor:e,deviceX:t,deviceY:n,deviceRadius:s,deviceRect:c}){const{x:f,y:r,width:b,height:w}=c;let E=s*s,k=-1,F=0;for(let $=0;$<w;$++){const X=$+r-n,W=X*X;if(W>E)F+=4*b;else for(let ne=0;ne<b;ne++){if(i[F+3]-1>=0){const Te=ne+f-t,we=Te*Te+W;we<=E&&(E=we,k=F)}F+=4}}if(k>=0){const $=i.slice(k,k+4),X=e($);if(X){const W=Math.floor(k/4/b),ne=k/4-W*b;return{...X,pickedColor:$,pickedX:f+ne,pickedY:r+W}}gr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return zJ}function UJ({pickedColors:i,decodePickingColor:e}){const t=new Map;if(i){for(let n=0;n<i.length;n+=4)if(i[n+3]-1>=0){const c=i.slice(n,n+4),f=c.join(",");if(!t.has(f)){const r=e(c);r?t.set(f,{...r,color:c}):gr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function uz({pickInfo:i,viewports:e,pixelRatio:t,x:n,y:s,z:c}){let f=e[0];e.length>1&&(f=$J((i==null?void 0:i.pickedViewports)||e,{x:n,y:s}));let r;if(f){const b=[n-f.x,s-f.y];c!==void 0&&(b[2]=c),r=f.unproject(b)}return{color:null,layer:null,viewport:f,index:-1,picked:!1,x:n,y:s,pixel:[n,s],coordinate:r,devicePixel:i&&"pickedX"in i?[i.pickedX,i.pickedY]:void 0,pixelRatio:t}}function VJ(i){const{pickInfo:e,lastPickedInfo:t,mode:n,layers:s}=i,{pickedColor:c,pickedLayer:f,pickedObjectIndex:r}=e,b=f?[f]:[];if(n==="hover"){const k=t.index,F=t.layerId,$=f?f.props.id:null;if($!==F||r!==k){if($!==F){const X=s.find(W=>W.props.id===F);X&&b.unshift(X)}t.layerId=$,t.index=r,t.info=null}}const w=uz(i),E=new Map;return E.set(null,w),b.forEach(k=>{let F={...w};k===f&&(F.color=c,F.index=r,F.picked=!0),F=dz({layer:k,info:F,mode:n});const $=F.layer;k===f&&n==="hover"&&(t.info=F),E.set($.id,F),n==="hover"&&$.updateAutoHighlight(F)}),E}function dz({layer:i,info:e,mode:t}){for(;i&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=i,e=i.getPickingInfo({info:e,mode:t,sourceLayer:n}),i=i.parent}return e}function $J(i,e){for(let t=i.length-1;t>=0;t--){const n=i[t];if(n.containsPixel(e))return n}return i[0]}class jJ{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new oz(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:s},c=this.lastPickedInfo.info){const f=c&&c.layer&&c.layer.id,r=c&&c.viewport&&c.viewport.id,b=f?n.find(F=>F.id===f):null,w=r&&s.find(F=>F.id===r)||s[0],E=w&&w.unproject([e-w.x,t-w.y]);return{...c,...{x:e,y:t,viewport:w,coordinate:E,layer:b}}}_resizeBuffer(){var t,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:n,x:s,y:c,radius:f=0,depth:r=1,mode:b="query",unproject3D:w,onViewportActive:E,effects:k}){const F=this.device.canvasContext.cssToDeviceRatio(),$=this._getPickable(e);if(!$||n.length===0)return{result:[],emptyInfo:uz({viewports:n,x:s,y:c,pixelRatio:F})};this._resizeBuffer();const X=this.device.canvasContext.cssToDevicePixels([s,c],!0),W=[X.x+Math.floor(X.width/2),X.y+Math.floor(X.height/2)],ne=Math.round(f*F),{width:_e,height:Te}=this.pickingFBO,we=this._getPickingRect({deviceX:W[0],deviceY:W[1],deviceRadius:ne,deviceWidth:_e,deviceHeight:Te}),Ee={x:s-f,y:c-f,width:f*2+1,height:f*2+1};let Le;const Je=[],Tt=new Set;for(let _t=0;_t<r;_t++){let St;if(we){const Lt=this._drawAndSample({layers:$,views:t,viewports:n,onViewportActive:E,deviceRect:we,cullRect:Ee,effects:k,pass:`picking:${b}`});St=NJ({...Lt,deviceX:W[0],deviceY:W[1],deviceRadius:ne,deviceRect:we})}else St={pickedColor:null,pickedObjectIndex:-1};let kt;if(St.pickedLayer&&w&&this.depthFBO){const{pickedColors:Lt}=this._drawAndSample({layers:[St.pickedLayer],views:t,viewports:n,onViewportActive:E,deviceRect:{x:St.pickedX,y:St.pickedY,width:1,height:1},cullRect:Ee,effects:k,pass:`picking:${b}:z`},!0);Lt[3]&&(kt=Lt[0])}St.pickedLayer&&_t+1<r&&(Tt.add(St.pickedLayer),St.pickedLayer.disablePickingIndex(St.pickedObjectIndex)),Le=VJ({pickInfo:St,lastPickedInfo:this.lastPickedInfo,mode:b,layers:$,viewports:n,x:s,y:c,z:kt,pixelRatio:F});for(const Lt of Le.values())Lt.layer&&Je.push(Lt);if(!St.pickedColor)break}for(const _t of Tt)_t.restorePickingColors();return{result:Je,emptyInfo:Le.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:n,x:s,y:c,width:f=1,height:r=1,mode:b="query",maxObjects:w=null,onViewportActive:E,effects:k}){const F=this._getPickable(e);if(!F||n.length===0)return[];this._resizeBuffer();const $=this.device.canvasContext.cssToDeviceRatio(),X=this.device.canvasContext.cssToDevicePixels([s,c],!0),W=X.x,ne=X.y+X.height,_e=this.device.canvasContext.cssToDevicePixels([s+f,c+r],!0),Te=_e.x+_e.width,we=_e.y,Ee={x:W,y:we,width:Te-W,height:ne-we},Le=this._drawAndSample({layers:F,views:t,viewports:n,onViewportActive:E,deviceRect:Ee,cullRect:{x:s,y:c,width:f,height:r},effects:k,pass:`picking:${b}`}),Je=UJ(Le),Tt=new Map,_t=[],St=Number.isFinite(w);for(let kt=0;kt<Je.length&&!(St&&_t.length>=w);kt++){const Lt=Je[kt];let si={color:Lt.pickedColor,layer:null,index:Lt.pickedObjectIndex,picked:!0,x:s,y:c,pixelRatio:$};si=dz({layer:Lt.pickedLayer,info:si,mode:b});const bi=si.layer.id;Tt.has(bi)||Tt.set(bi,new Set);const ii=Tt.get(bi),vi=si.object??si.index;ii.has(vi)||(ii.add(vi),_t.push(si))}return _t}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:s,deviceRect:c,cullRect:f,effects:r,pass:b},w=!1){const E=w?this.depthFBO:this.pickingFBO,k={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:s,pickingFBO:E,deviceRect:c,cullRect:f,effects:r,pass:b,pickZ:w,preRenderStats:{},isPicking:!0};for(const Te of r)Te.useInPicking&&(k.preRenderStats[Te.id]=Te.preRender(k));const{decodePickingColor:F}=this.pickLayersPass.render(k),{x:$,y:X,width:W,height:ne}=c,_e=new(w?Float32Array:Uint8Array)(W*ne*4);return this.device.readPixelsToArrayWebGL(E,{sourceX:$,sourceY:X,sourceWidth:W,sourceHeight:ne,target:_e}),{pickedColors:_e,decodePickingColor:F}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:s,deviceHeight:c}){const f=Math.max(0,e-n),r=Math.max(0,t-n),b=Math.min(s,e+n+1)-f,w=Math.min(c,t+n+1)-r;return b<=0||w<=0?null:{x:f,y:r,width:b,height:w}}}const HJ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},WJ="top-left",oD="__root";class GJ{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Fl(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const s=t[n.id];s?s.viewId!==n.viewId||s.placement!==n.placement?(this._remove(s),this._add(n)):n!==s&&(s.setProps(n.props),n=s):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const s=t[n];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=WJ}=e,s=e.onAdd({deck:this.deck,viewId:t});s&&this._getContainer(t,n).append(s),e._element=s}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var f;const n=e||oD;let s=this.containers[n];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(f=this.parentElement)==null||f.append(s),this.containers[n]=s);let c=s.querySelector(`.${t}`);return c||(c=document.createElement("div"),c.className=t,c.style.position="absolute",c.style.zIndex="2",Object.assign(c.style,HJ[t]),s.append(c)),c}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const s=this.lastViewports[n]||null,c=n===oD||s,f=this.containers[n];c?(f.style.display="block",f.style.left=`${s?s.x:0}px`,f.style.top=`${s?s.y:0}px`,f.style.width=`${s?s.width:e}px`,f.style.height=`${s?s.height:t}px`):f.style.display="none"}}onRedraw({viewports:e,layers:t}){var s,c;const n=e.reduce((f,r)=>(f[r.id]=r,f),{});for(const f of this.getWidgets()){const{viewId:r}=f;if(r){const b=n[r];b&&(f.onViewportChange&&f.onViewportChange(b),(s=f.onRedraw)==null||s.call(f,{viewports:[b],layers:t}))}else{if(f.onViewportChange)for(const b of e)f.onViewportChange(b);(c=f.onRedraw)==null||c.call(f,{viewports:e,layers:t})}}this.lastViewports=n,this._updateContainers()}onHover(e,t){var n,s;for(const c of this.getWidgets()){const{viewId:f}=c;(!f||f===((n=e.viewport)==null?void 0:n.id))&&((s=c.onHover)==null||s.call(c,e,t))}}onEvent(e,t){var s,c;const n=VS[t.type];if(n)for(const f of this.getWidgets()){const{viewId:r}=f;(!r||r===((s=e.viewport)==null?void 0:s.id))&&((c=f[n])==null||c.call(f,e,t))}}}const XJ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};let qJ=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,XJ),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const s=n(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,n){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}};var pm;(function(i){i[i.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",i[i.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",i[i.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i[i.ZERO=0]="ZERO",i[i.ONE=1]="ONE",i[i.SRC_COLOR=768]="SRC_COLOR",i[i.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.DST_ALPHA=772]="DST_ALPHA",i[i.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",i[i.DST_COLOR=774]="DST_COLOR",i[i.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",i[i.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",i[i.CONSTANT_COLOR=32769]="CONSTANT_COLOR",i[i.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",i[i.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",i[i.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",i[i.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",i[i.BLEND_EQUATION=32777]="BLEND_EQUATION",i[i.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",i[i.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",i[i.BLEND_DST_RGB=32968]="BLEND_DST_RGB",i[i.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",i[i.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",i[i.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",i[i.BLEND_COLOR=32773]="BLEND_COLOR",i[i.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",i[i.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",i[i.LINE_WIDTH=2849]="LINE_WIDTH",i[i.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",i[i.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",i[i.CULL_FACE_MODE=2885]="CULL_FACE_MODE",i[i.FRONT_FACE=2886]="FRONT_FACE",i[i.DEPTH_RANGE=2928]="DEPTH_RANGE",i[i.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",i[i.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",i[i.DEPTH_FUNC=2932]="DEPTH_FUNC",i[i.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",i[i.STENCIL_FUNC=2962]="STENCIL_FUNC",i[i.STENCIL_FAIL=2964]="STENCIL_FAIL",i[i.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",i[i.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",i[i.STENCIL_REF=2967]="STENCIL_REF",i[i.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",i[i.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",i[i.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",i[i.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",i[i.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",i[i.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",i[i.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",i[i.VIEWPORT=2978]="VIEWPORT",i[i.SCISSOR_BOX=3088]="SCISSOR_BOX",i[i.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",i[i.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",i[i.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",i[i.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",i[i.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",i[i.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",i[i.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",i[i.RED_BITS=3410]="RED_BITS",i[i.GREEN_BITS=3411]="GREEN_BITS",i[i.BLUE_BITS=3412]="BLUE_BITS",i[i.ALPHA_BITS=3413]="ALPHA_BITS",i[i.DEPTH_BITS=3414]="DEPTH_BITS",i[i.STENCIL_BITS=3415]="STENCIL_BITS",i[i.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",i[i.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",i[i.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",i[i.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",i[i.SAMPLES=32937]="SAMPLES",i[i.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",i[i.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",i[i.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",i[i.VENDOR=7936]="VENDOR",i[i.RENDERER=7937]="RENDERER",i[i.VERSION=7938]="VERSION",i[i.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",i[i.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",i[i.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",i[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.BUFFER_SIZE=34660]="BUFFER_SIZE",i[i.BUFFER_USAGE=34661]="BUFFER_USAGE",i[i.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",i[i.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",i[i.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",i[i.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",i[i.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",i[i.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",i[i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",i[i.CULL_FACE=2884]="CULL_FACE",i[i.FRONT=1028]="FRONT",i[i.BACK=1029]="BACK",i[i.FRONT_AND_BACK=1032]="FRONT_AND_BACK",i[i.BLEND=3042]="BLEND",i[i.DEPTH_TEST=2929]="DEPTH_TEST",i[i.DITHER=3024]="DITHER",i[i.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",i[i.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",i[i.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",i[i.SCISSOR_TEST=3089]="SCISSOR_TEST",i[i.STENCIL_TEST=2960]="STENCIL_TEST",i[i.NO_ERROR=0]="NO_ERROR",i[i.INVALID_ENUM=1280]="INVALID_ENUM",i[i.INVALID_VALUE=1281]="INVALID_VALUE",i[i.INVALID_OPERATION=1282]="INVALID_OPERATION",i[i.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",i[i.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",i[i.CW=2304]="CW",i[i.CCW=2305]="CCW",i[i.DONT_CARE=4352]="DONT_CARE",i[i.FASTEST=4353]="FASTEST",i[i.NICEST=4354]="NICEST",i[i.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",i[i.BYTE=5120]="BYTE",i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.SHORT=5122]="SHORT",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.INT=5124]="INT",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.FLOAT=5126]="FLOAT",i[i.DOUBLE=5130]="DOUBLE",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.ALPHA=6406]="ALPHA",i[i.RGB=6407]="RGB",i[i.RGBA=6408]="RGBA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",i[i.VERTEX_SHADER=35633]="VERTEX_SHADER",i[i.COMPILE_STATUS=35713]="COMPILE_STATUS",i[i.DELETE_STATUS=35712]="DELETE_STATUS",i[i.LINK_STATUS=35714]="LINK_STATUS",i[i.VALIDATE_STATUS=35715]="VALIDATE_STATUS",i[i.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",i[i.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",i[i.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",i[i.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",i[i.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",i[i.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",i[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",i[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",i[i.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",i[i.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",i[i.SHADER_TYPE=35663]="SHADER_TYPE",i[i.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",i[i.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",i[i.NEVER=512]="NEVER",i[i.LESS=513]="LESS",i[i.EQUAL=514]="EQUAL",i[i.LEQUAL=515]="LEQUAL",i[i.GREATER=516]="GREATER",i[i.NOTEQUAL=517]="NOTEQUAL",i[i.GEQUAL=518]="GEQUAL",i[i.ALWAYS=519]="ALWAYS",i[i.KEEP=7680]="KEEP",i[i.REPLACE=7681]="REPLACE",i[i.INCR=7682]="INCR",i[i.DECR=7683]="DECR",i[i.INVERT=5386]="INVERT",i[i.INCR_WRAP=34055]="INCR_WRAP",i[i.DECR_WRAP=34056]="DECR_WRAP",i[i.NEAREST=9728]="NEAREST",i[i.LINEAR=9729]="LINEAR",i[i.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",i[i.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",i[i.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",i[i.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE=5890]="TEXTURE",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i[i.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",i[i.TEXTURE0=33984]="TEXTURE0",i[i.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",i[i.REPEAT=10497]="REPEAT",i[i.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i[i.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",i[i.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",i[i.FLOAT_VEC2=35664]="FLOAT_VEC2",i[i.FLOAT_VEC3=35665]="FLOAT_VEC3",i[i.FLOAT_VEC4=35666]="FLOAT_VEC4",i[i.INT_VEC2=35667]="INT_VEC2",i[i.INT_VEC3=35668]="INT_VEC3",i[i.INT_VEC4=35669]="INT_VEC4",i[i.BOOL=35670]="BOOL",i[i.BOOL_VEC2=35671]="BOOL_VEC2",i[i.BOOL_VEC3=35672]="BOOL_VEC3",i[i.BOOL_VEC4=35673]="BOOL_VEC4",i[i.FLOAT_MAT2=35674]="FLOAT_MAT2",i[i.FLOAT_MAT3=35675]="FLOAT_MAT3",i[i.FLOAT_MAT4=35676]="FLOAT_MAT4",i[i.SAMPLER_2D=35678]="SAMPLER_2D",i[i.SAMPLER_CUBE=35680]="SAMPLER_CUBE",i[i.LOW_FLOAT=36336]="LOW_FLOAT",i[i.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",i[i.HIGH_FLOAT=36338]="HIGH_FLOAT",i[i.LOW_INT=36339]="LOW_INT",i[i.MEDIUM_INT=36340]="MEDIUM_INT",i[i.HIGH_INT=36341]="HIGH_INT",i[i.FRAMEBUFFER=36160]="FRAMEBUFFER",i[i.RENDERBUFFER=36161]="RENDERBUFFER",i[i.RGBA4=32854]="RGBA4",i[i.RGB5_A1=32855]="RGB5_A1",i[i.RGB565=36194]="RGB565",i[i.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",i[i.STENCIL_INDEX=6401]="STENCIL_INDEX",i[i.STENCIL_INDEX8=36168]="STENCIL_INDEX8",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i[i.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",i[i.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",i[i.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",i[i.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",i[i.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",i[i.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",i[i.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",i[i.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",i[i.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",i[i.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",i[i.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",i[i.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",i[i.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",i[i.NONE=0]="NONE",i[i.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",i[i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",i[i.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",i[i.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",i[i.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",i[i.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",i[i.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",i[i.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",i[i.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",i[i.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",i[i.READ_BUFFER=3074]="READ_BUFFER",i[i.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",i[i.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",i[i.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",i[i.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",i[i.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",i[i.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",i[i.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",i[i.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",i[i.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",i[i.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",i[i.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",i[i.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",i[i.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",i[i.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",i[i.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",i[i.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",i[i.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",i[i.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",i[i.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",i[i.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",i[i.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",i[i.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",i[i.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",i[i.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",i[i.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",i[i.RED=6403]="RED",i[i.RGB8=32849]="RGB8",i[i.RGBA8=32856]="RGBA8",i[i.RGB10_A2=32857]="RGB10_A2",i[i.TEXTURE_3D=32879]="TEXTURE_3D",i[i.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",i[i.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",i[i.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",i[i.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",i[i.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",i[i.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",i[i.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",i[i.SRGB=35904]="SRGB",i[i.SRGB8=35905]="SRGB8",i[i.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",i[i.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",i[i.RGBA32F=34836]="RGBA32F",i[i.RGB32F=34837]="RGB32F",i[i.RGBA16F=34842]="RGBA16F",i[i.RGB16F=34843]="RGB16F",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",i[i.R11F_G11F_B10F=35898]="R11F_G11F_B10F",i[i.RGB9_E5=35901]="RGB9_E5",i[i.RGBA32UI=36208]="RGBA32UI",i[i.RGB32UI=36209]="RGB32UI",i[i.RGBA16UI=36214]="RGBA16UI",i[i.RGB16UI=36215]="RGB16UI",i[i.RGBA8UI=36220]="RGBA8UI",i[i.RGB8UI=36221]="RGB8UI",i[i.RGBA32I=36226]="RGBA32I",i[i.RGB32I=36227]="RGB32I",i[i.RGBA16I=36232]="RGBA16I",i[i.RGB16I=36233]="RGB16I",i[i.RGBA8I=36238]="RGBA8I",i[i.RGB8I=36239]="RGB8I",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.R8=33321]="R8",i[i.RG8=33323]="RG8",i[i.R16F=33325]="R16F",i[i.R32F=33326]="R32F",i[i.RG16F=33327]="RG16F",i[i.RG32F=33328]="RG32F",i[i.R8I=33329]="R8I",i[i.R8UI=33330]="R8UI",i[i.R16I=33331]="R16I",i[i.R16UI=33332]="R16UI",i[i.R32I=33333]="R32I",i[i.R32UI=33334]="R32UI",i[i.RG8I=33335]="RG8I",i[i.RG8UI=33336]="RG8UI",i[i.RG16I=33337]="RG16I",i[i.RG16UI=33338]="RG16UI",i[i.RG32I=33339]="RG32I",i[i.RG32UI=33340]="RG32UI",i[i.R8_SNORM=36756]="R8_SNORM",i[i.RG8_SNORM=36757]="RG8_SNORM",i[i.RGB8_SNORM=36758]="RGB8_SNORM",i[i.RGBA8_SNORM=36759]="RGBA8_SNORM",i[i.RGB10_A2UI=36975]="RGB10_A2UI",i[i.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",i[i.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.HALF_FLOAT=5131]="HALF_FLOAT",i[i.RG=33319]="RG",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",i[i.CURRENT_QUERY=34917]="CURRENT_QUERY",i[i.QUERY_RESULT=34918]="QUERY_RESULT",i[i.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",i[i.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",i[i.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",i[i.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",i[i.DRAW_BUFFER0=34853]="DRAW_BUFFER0",i[i.DRAW_BUFFER1=34854]="DRAW_BUFFER1",i[i.DRAW_BUFFER2=34855]="DRAW_BUFFER2",i[i.DRAW_BUFFER3=34856]="DRAW_BUFFER3",i[i.DRAW_BUFFER4=34857]="DRAW_BUFFER4",i[i.DRAW_BUFFER5=34858]="DRAW_BUFFER5",i[i.DRAW_BUFFER6=34859]="DRAW_BUFFER6",i[i.DRAW_BUFFER7=34860]="DRAW_BUFFER7",i[i.DRAW_BUFFER8=34861]="DRAW_BUFFER8",i[i.DRAW_BUFFER9=34862]="DRAW_BUFFER9",i[i.DRAW_BUFFER10=34863]="DRAW_BUFFER10",i[i.DRAW_BUFFER11=34864]="DRAW_BUFFER11",i[i.DRAW_BUFFER12=34865]="DRAW_BUFFER12",i[i.DRAW_BUFFER13=34866]="DRAW_BUFFER13",i[i.DRAW_BUFFER14=34867]="DRAW_BUFFER14",i[i.DRAW_BUFFER15=34868]="DRAW_BUFFER15",i[i.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",i[i.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",i[i.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",i[i.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",i[i.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",i[i.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",i[i.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",i[i.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",i[i.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",i[i.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",i[i.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",i[i.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",i[i.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",i[i.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",i[i.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",i[i.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",i[i.SAMPLER_3D=35679]="SAMPLER_3D",i[i.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",i[i.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",i[i.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",i[i.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",i[i.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",i[i.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",i[i.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",i[i.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",i[i.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",i[i.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",i[i.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",i[i.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",i[i.MAX_SAMPLES=36183]="MAX_SAMPLES",i[i.SAMPLER_BINDING=35097]="SAMPLER_BINDING",i[i.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",i[i.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",i[i.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",i[i.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",i[i.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",i[i.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",i[i.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",i[i.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",i[i.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",i[i.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",i[i.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",i[i.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",i[i.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",i[i.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",i[i.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",i[i.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",i[i.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",i[i.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",i[i.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",i[i.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",i[i.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",i[i.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",i[i.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",i[i.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",i[i.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",i[i.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",i[i.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",i[i.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",i[i.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",i[i.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",i[i.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",i[i.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",i[i.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",i[i.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",i[i.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",i[i.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",i[i.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",i[i.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",i[i.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",i[i.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",i[i.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i[i.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",i[i.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",i[i.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",i[i.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",i[i.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",i[i.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",i[i.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",i[i.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",i[i.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",i[i.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",i[i.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",i[i.UNIFORM_TYPE=35383]="UNIFORM_TYPE",i[i.UNIFORM_SIZE=35384]="UNIFORM_SIZE",i[i.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",i[i.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",i[i.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",i[i.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",i[i.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",i[i.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",i[i.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",i[i.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",i[i.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",i[i.OBJECT_TYPE=37138]="OBJECT_TYPE",i[i.SYNC_CONDITION=37139]="SYNC_CONDITION",i[i.SYNC_STATUS=37140]="SYNC_STATUS",i[i.SYNC_FLAGS=37141]="SYNC_FLAGS",i[i.SYNC_FENCE=37142]="SYNC_FENCE",i[i.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",i[i.UNSIGNALED=37144]="UNSIGNALED",i[i.SIGNALED=37145]="SIGNALED",i[i.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",i[i.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",i[i.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",i[i.WAIT_FAILED=37149]="WAIT_FAILED",i[i.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",i[i.COLOR=6144]="COLOR",i[i.DEPTH=6145]="DEPTH",i[i.STENCIL=6146]="STENCIL",i[i.MIN=32775]="MIN",i[i.MAX=32776]="MAX",i[i.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",i[i.STREAM_READ=35041]="STREAM_READ",i[i.STREAM_COPY=35042]="STREAM_COPY",i[i.STATIC_READ=35045]="STATIC_READ",i[i.STATIC_COPY=35046]="STATIC_COPY",i[i.DYNAMIC_READ=35049]="DYNAMIC_READ",i[i.DYNAMIC_COPY=35050]="DYNAMIC_COPY",i[i.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",i[i.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",i[i.INVALID_INDEX=4294967295]="INVALID_INDEX",i[i.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",i[i.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",i[i.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",i[i.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",i[i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",i[i.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",i[i.R16_EXT=33322]="R16_EXT",i[i.RG16_EXT=33324]="RG16_EXT",i[i.RGB16_EXT=32852]="RGB16_EXT",i[i.RGBA16_EXT=32859]="RGBA16_EXT",i[i.R16_SNORM_EXT=36760]="R16_SNORM_EXT",i[i.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",i[i.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",i[i.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",i[i.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",i[i.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",i[i.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",i[i.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",i[i.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",i[i.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",i[i.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",i[i.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",i[i.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",i[i.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",i[i.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",i[i.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",i[i.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",i[i.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",i[i.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",i[i.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",i[i.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",i[i.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",i[i.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",i[i.LINE_WEBGL=6913]="LINE_WEBGL",i[i.FILL_WEBGL=6914]="FILL_WEBGL",i[i.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",i[i.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",i[i.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",i[i.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",i[i.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",i[i.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",i[i.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",i[i.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",i[i.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",i[i.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",i[i.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",i[i.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",i[i.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",i[i.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",i[i.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",i[i.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",i[i.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",i[i.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",i[i.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",i[i.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",i[i.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",i[i.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",i[i.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",i[i.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(pm||(pm={}));const AC={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},xs=(i,e,t)=>e?i.enable(t):i.disable(t),aD=(i,e,t)=>i.hint(t,e),Sa=(i,e,t)=>i.pixelStorei(t,e),lD=(i,e,t)=>{const n=t===36006?36009:36008;return i.bindFramebuffer(n,e)},ey=(i,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];i.bindBuffer(s,e)};function v2(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}const YJ={3042:xs,32773:(i,e)=>i.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,e)=>i.clearColor(...e),3107:(i,e)=>i.colorMask(...e),2884:xs,2885:(i,e)=>i.cullFace(e),2929:xs,2931:(i,e)=>i.clearDepth(e),2932:(i,e)=>i.depthFunc(e),2928:(i,e)=>i.depthRange(...e),2930:(i,e)=>i.depthMask(e),3024:xs,35723:aD,35725:(i,e)=>i.useProgram(e),36007:(i,e)=>i.bindRenderbuffer(36161,e),36389:(i,e)=>{var t;return(t=i.bindTransformFeedback)==null?void 0:t.call(i,36386,e)},34229:(i,e)=>i.bindVertexArray(e),36006:lD,36010:lD,34964:ey,36662:ey,36663:ey,35053:ey,35055:ey,2886:(i,e)=>i.frontFace(e),33170:aD,2849:(i,e)=>i.lineWidth(e),32823:xs,32824:"polygonOffset",10752:"polygonOffset",35977:xs,32926:xs,32928:xs,32938:"sampleCoverage",32939:"sampleCoverage",3089:xs,3088:(i,e)=>i.scissor(...e),2960:xs,2961:(i,e)=>i.clearStencil(e),2968:(i,e)=>i.stencilMaskSeparate(1028,e),36005:(i,e)=>i.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,e)=>i.viewport(...e),34383:xs,10754:xs,12288:xs,12289:xs,12290:xs,12291:xs,12292:xs,12293:xs,12294:xs,12295:xs,3333:Sa,3317:Sa,37440:Sa,37441:Sa,37443:Sa,3330:Sa,3332:Sa,3331:Sa,3314:Sa,32878:Sa,3316:Sa,3315:Sa,32877:Sa,framebuffer:(i,e)=>{const t=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,t)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{const t=typeof e=="number"?[e,e]:e;i.blendEquationSeparate(...t)},blendFunc:(i,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;i.blendFuncSeparate(...t)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(e[0],e[1]||!1),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=v2(e)?e:[e,e];const[t,n]=e;i.stencilMaskSeparate(1028,t),i.stencilMaskSeparate(1029,n)},stencilFunc:(i,e)=>{e=v2(e)&&e.length===3?[...e,...e]:e;const[t,n,s,c,f,r]=e;i.stencilFuncSeparate(1028,t,n,s),i.stencilFuncSeparate(1029,c,f,r)},stencilOp:(i,e)=>{e=v2(e)&&e.length===3?[...e,...e]:e;const[t,n,s,c,f,r]=e;i.stencilOpSeparate(1028,t,n,s),i.stencilOpSeparate(1029,c,f,r)},viewport:(i,e)=>i.viewport(...e)};function ts(i,e,t){return e[i]!==void 0?e[i]:t[i]}const ZJ={blendEquation:(i,e,t)=>i.blendEquationSeparate(ts(32777,e,t),ts(34877,e,t)),blendFunc:(i,e,t)=>i.blendFuncSeparate(ts(32969,e,t),ts(32968,e,t),ts(32971,e,t),ts(32970,e,t)),polygonOffset:(i,e,t)=>i.polygonOffset(ts(32824,e,t),ts(10752,e,t)),sampleCoverage:(i,e,t)=>i.sampleCoverage(ts(32938,e,t),ts(32939,e,t)),stencilFuncFront:(i,e,t)=>i.stencilFuncSeparate(1028,ts(2962,e,t),ts(2967,e,t),ts(2963,e,t)),stencilFuncBack:(i,e,t)=>i.stencilFuncSeparate(1029,ts(34816,e,t),ts(36003,e,t),ts(36004,e,t)),stencilOpFront:(i,e,t)=>i.stencilOpSeparate(1028,ts(2964,e,t),ts(2965,e,t),ts(2966,e,t)),stencilOpBack:(i,e,t)=>i.stencilOpSeparate(1029,ts(34817,e,t),ts(34818,e,t),ts(34819,e,t))},cD={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,t)=>i({[e]:t}),hint:(i,e,t)=>i({[e]:t}),useProgram:(i,e)=>i({35725:e}),bindRenderbuffer:(i,e,t)=>i({36007:t}),bindTransformFeedback:(i,e,t)=>i({36389:t}),bindVertexArray:(i,e)=>i({34229:e}),bindFramebuffer:(i,e,t)=>{switch(e){case 36160:return i({36006:t,36010:t});case 36009:return i({36006:t});case 36008:return i({36010:t});default:return null}},bindBuffer:(i,e,t)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?i({[n]:t}):{valueChanged:!0}},blendColor:(i,e,t,n,s)=>i({32773:new Float32Array([e,t,n,s])}),blendEquation:(i,e)=>i({32777:e,34877:e}),blendEquationSeparate:(i,e,t)=>i({32777:e,34877:t}),blendFunc:(i,e,t)=>i({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(i,e,t,n,s)=>i({32969:e,32968:t,32971:n,32970:s}),clearColor:(i,e,t,n,s)=>i({3106:new Float32Array([e,t,n,s])}),clearDepth:(i,e)=>i({2931:e}),clearStencil:(i,e)=>i({2961:e}),colorMask:(i,e,t,n,s)=>i({3107:[e,t,n,s]}),cullFace:(i,e)=>i({2885:e}),depthFunc:(i,e)=>i({2932:e}),depthRange:(i,e,t)=>i({2928:new Float32Array([e,t])}),depthMask:(i,e)=>i({2930:e}),frontFace:(i,e)=>i({2886:e}),lineWidth:(i,e)=>i({2849:e}),polygonOffset:(i,e,t)=>i({32824:e,10752:t}),sampleCoverage:(i,e,t)=>i({32938:e,32939:t}),scissor:(i,e,t,n,s)=>i({3088:new Int32Array([e,t,n,s])}),stencilMask:(i,e)=>i({2968:e,36005:e}),stencilMaskSeparate:(i,e,t)=>i({[e===1028?2968:36005]:t}),stencilFunc:(i,e,t,n)=>i({2962:e,2967:t,2963:n,34816:e,36003:t,36004:n}),stencilFuncSeparate:(i,e,t,n,s)=>i({[e===1028?2962:34816]:t,[e===1028?2967:36003]:n,[e===1028?2963:36004]:s}),stencilOp:(i,e,t,n)=>i({2964:e,2965:t,2966:n,34817:e,34818:t,34819:n}),stencilOpSeparate:(i,e,t,n,s)=>i({[e===1028?2964:34817]:t,[e===1028?2965:34818]:n,[e===1028?2966:34819]:s}),viewport:(i,e,t,n,s)=>i({2978:[e,t,n,s]})},vc=(i,e)=>i.isEnabled(e),hD={3042:vc,2884:vc,2929:vc,3024:vc,32823:vc,32926:vc,32928:vc,3089:vc,2960:vc,35977:vc},KJ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Qm(i,e){if(QJ(e))return;const t={};for(const s in e){const c=Number(s),f=YJ[s];f&&(typeof f=="string"?t[f]=!0:f(i,e[s],c))}const n=i.state&&i.state.cache;if(n)for(const s in t){const c=ZJ[s];c(i,e,n)}}function fz(i,e=AC){if(typeof e=="number"){const s=e,c=hD[s];return c?c(i,s):i.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),n={};for(const s of t){const c=hD[s];n[s]=c?c(i,Number(s)):i.getParameter(Number(s))}return n}function JJ(i){Qm(i,AC)}function QJ(i){for(const e in i)return!1;return!0}function eQ(i,e){if(i===e)return!0;const t=Array.isArray(i)||ArrayBuffer.isView(i),n=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&n&&i.length===e.length){for(let s=0;s<i.length;++s)if(i[s]!==e[s])return!1;return!0}return!1}class mf{constructor(e,t){ce(this,"gl");ce(this,"program",null);ce(this,"stateStack",[]);ce(this,"enable",!0);ce(this,"cache",null);ce(this,"log");ce(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Qm(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?fz(e):Object.assign({},AC),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,iQ(e);for(const n in cD){const s=cD[n];tQ(e,n,s)}uD(e,"getParameter"),uD(e,"isEnabled")}_updateCache(e){let t=!1,n;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const c in e){const f=e[c],r=this.cache[c];eQ(f,r)||(t=!0,n=r,s&&!(c in s)&&(s[c]=r),this.cache[c]=f)}return{valueChanged:t,oldValue:n}}}function uD(i,e){const t=i[e].bind(i);i[e]=function(s){if(s===void 0||KJ.has(s))return t(s);const c=mf.get(i);return s in c.cache||(c.cache[s]=t(s)),c.enable?c.cache[s]:t(s)},Object.defineProperty(i[e],"name",{value:`${e}-from-cache`,configurable:!1})}function tQ(i,e,t){if(!i[e])return;const n=i[e].bind(i);i[e]=function(...c){const f=mf.get(i),{valueChanged:r,oldValue:b}=t(f._updateCache,...c);return r&&n(...c),b},Object.defineProperty(i[e],"name",{value:`${e}-to-cache`,configurable:!1})}function iQ(i){const e=i.useProgram.bind(i);i.useProgram=function(n){const s=mf.get(i);s.program!==n&&(e(n),s.program=n)}}function nQ(i,e,t){let n="";const s={preserveDrawingBuffer:!0,...t};let c=null;if(c||(c=i.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(n||(n="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!c&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,c=i.getContext("webgl2",s),c.luma||(c.luma={}),c.luma.softwareRenderer=!0),c||(c=i.getContext("webgl",{}),c&&(c=null,n||(n="Your browser only supports WebGL1"))),!c)throw n||(n="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:f,onContextRestored:r}=e;return i.addEventListener("webglcontextlost",b=>f(b),!1),i.addEventListener("webglcontextrestored",b=>r(b),!1),c.luma||(c.luma={}),c}function Fm(i,e,t){return t[e]===void 0&&(t[e]=i.getExtension(e)||null),t[e]}function rQ(i,e){const t=i.getParameter(7936),n=i.getParameter(7937);Fm(i,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,c=i.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),f=i.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),r=c||t,b=f||n,w=i.getParameter(7938),E=pz(r,b),k=sQ(r,b),F=oQ(r,b);return{type:"webgl",gpu:E,gpuType:F,gpuBackend:k,vendor:r,renderer:b,version:w,shadingLanguage:"glsl",shadingLanguageVersion:300}}function pz(i,e){return/NVIDIA/i.exec(i)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(i)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(i)||/Apple/i.exec(e)?"apple":/AMD/i.exec(i)||/AMD/i.exec(e)||/ATI/i.exec(i)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(i)||/SwiftShader/i.exec(e)?"software":"unknown"}function sQ(i,e){return/Metal/i.exec(i)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(i)||/ANGLE/i.exec(e)?"opengl":"unknown"}function oQ(i,e){if(/SwiftShader/i.exec(i)||/SwiftShader/i.exec(e))return"cpu";switch(pz(i,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function mz(i){switch(i){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(i))}const hy="WEBGL_compressed_texture_s3tc",uy="WEBGL_compressed_texture_s3tc_srgb",mm="EXT_texture_compression_rgtc",gm="EXT_texture_compression_bptc",aQ="WEBGL_compressed_texture_etc",lQ="WEBGL_compressed_texture_astc",cQ="WEBGL_compressed_texture_etc1",hQ="WEBGL_compressed_texture_pvrtc",uQ="WEBGL_compressed_texture_atc",dD="EXT_texture_norm16",fD="EXT_render_snorm",dQ="EXT_color_buffer_float",TC={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[fD],"norm16-renderable-webgl":[dD],"snorm16-renderable-webgl":[dD,fD],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[hy,uy,mm,gm],"texture-compression-bc5-webgl":[mm],"texture-compression-bc7-webgl":[gm],"texture-compression-etc2":[aQ],"texture-compression-astc":[lQ],"texture-compression-etc1-webgl":[cQ],"texture-compression-pvrtc-webgl":[hQ],"texture-compression-atc-webgl":[uQ]};function fQ(i){return i in TC}function pQ(i,e,t){return(TC[e]||[]).every(s=>Fm(i,s,t))}const SC={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:dQ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:hy},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:uy},"bc1-rgba-unorm":{gl:33777,x:hy},"bc1-rgba-unorm-srgb":{gl:35916,x:uy},"bc2-rgba-unorm":{gl:33778,x:hy},"bc2-rgba-unorm-srgb":{gl:35918,x:uy},"bc3-rgba-unorm":{gl:33779,x:hy},"bc3-rgba-unorm-srgb":{gl:35919,x:uy},"bc4-r-unorm":{gl:36283,x:mm},"bc4-r-snorm":{gl:36284,x:mm},"bc5-rg-unorm":{gl:36285,x:mm},"bc5-rg-snorm":{gl:36286,x:mm},"bc6h-rgb-ufloat":{gl:36495,x:gm},"bc6h-rgb-float":{gl:36494,x:gm},"bc7-rgba-unorm":{gl:36492,x:gm},"bc7-rgba-unorm-srgb":{gl:36493,x:gm},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function mQ(i,e,t){let n=e.create;const s=SC[e.format];return(s==null?void 0:s.gl)===void 0&&(n=!1),s!=null&&s.x&&(n=n&&!!Fm(i,s.x,t)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function gz(i){var s;const e=SC[i],t=yQ(i),n=tC(i);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||_Q(n.channels,n.integer,n.normalized,t),type:n.dataType?mz(n.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:n.compressed||!1}}function gQ(i){switch(tC(i).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${i}`)}}function _Q(i,e,t,n){if(n===6408||n===6407)return n;switch(i){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function yQ(i){const e=SC[i],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${i}`);return t}const pD={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class bQ extends SG{constructor(t,n,s){super([],s);ce(this,"gl");ce(this,"extensions");ce(this,"testedFeatures",new Set);this.gl=t,this.extensions=n,Fm(t,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const t=this.getFeatures();for(const n of t)this.has(n)&&(yield n);return[]}has(t){var n;return(n=this.disabledFeatures)!=null&&n[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),fQ(t)&&pQ(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of t)this.has(n)}getFeatures(){return[...Object.keys(pD),...Object.keys(TC)]}getWebGLFeature(t){const n=pD[t];return typeof n=="string"?!!Fm(this.gl,n,this.extensions):!!n}}class vQ extends TG{constructor(t){super();ce(this,"gl");ce(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class By extends p1{constructor(t,n){super(t,n);ce(this,"device");ce(this,"gl");ce(this,"handle");ce(this,"colorAttachments",[]);ce(this,"depthStencilAttachment",null);const s=n.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const s=this.colorAttachments[n];if(s){const c=36064+n;this._attachTextureView(c,s)}}if(this.depthStencilAttachment){const n=gQ(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${wQ(n)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,n){const{gl:s}=this.device,{texture:c}=n,f=n.props.baseMipLevel,r=n.props.baseArrayLayer;switch(s.bindTexture(c.glTarget,c.handle),c.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,t,c.handle,f,r);break;case 34067:const b=xQ(r);s.framebufferTexture2D(36160,t,b,c.handle,f);break;case 3553:s.framebufferTexture2D(36160,t,3553,c.handle,f);break;default:throw new Error("Illegal texture type")}s.bindTexture(c.glTarget,null)}}function xQ(i){return i<34069?i+34069:i}function wQ(i){switch(i){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${i}`}}class AQ extends TS{constructor(t,n){super(n);ce(this,"device");ce(this,"format","rgba8unorm");ce(this,"depthStencilFormat","depth24plus");ce(this,"presentationSize");ce(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new By(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(n,t);return}}commit(){}}async function _z(i,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",i),new Promise((s,c)=>{n.onload=s,n.onerror=f=>c(new Error(`Unable to load script '${i}': ${f}`)),t.appendChild(n)})}const TQ=1;let Mr=null,mD=!1;const EC={debugSpectorJS:ni.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function SQ(i){if(!globalThis.SPECTOR)try{await _z(i.debugSpectorJSUrl||EC.debugSpectorJSUrl)}catch(e){ni.warn(String(e))}}function EQ(i){var e;if(i={...EC,...i},!i.debugSpectorJS)return null;if(!Mr&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){ni.probe(TQ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;Mr=new t,globalThis.luma&&(globalThis.luma.spector=Mr)}if(!Mr)return null;if(mD||(mD=!0,Mr.spyCanvases(),Mr==null||Mr.onCaptureStarted.add(t=>ni.info("Spector capture started:",t)()),Mr==null||Mr.onCapture.add(t=>{ni.info("Spector capture complete:",t)(),Mr==null||Mr.getResultUI(),Mr==null||Mr.resultView.display(),Mr==null||Mr.resultView.addCapture(t)})),i.gl){const t=i.gl,n=t.device;Mr==null||Mr.startCapture(i.gl,500),t.device=n,new Promise(s=>setTimeout(s,2e3)).then(s=>{ni.info("Spector capture stopped after 2 seconds")(),Mr==null||Mr.stopCapture()})}return Mr}const CQ="https://unpkg.com/webgl-debug@2.0.1/index.js";function yz(i){return i.luma=i.luma||{},i.luma}async function IQ(){Df()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await _z(CQ))}function MQ(i,e={}){return e.debugWebGL||e.traceWebGL?kQ(i,e):RQ(i)}function RQ(i){const e=yz(i);return e.realContext?e.realContext:i}function kQ(i,e){if(!globalThis.WebGLDebugUtils)return ni.warn("webgl-debug not loaded")(),i;const t=yz(i);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...pm,...i});const n=globalThis.WebGLDebugUtils.makeDebugContext(i,PQ.bind(null,e),DQ.bind(null,e));for(const f in pm)!(f in n)&&typeof pm[f]=="number"&&(n[f]=pm[f]);class s{}Object.setPrototypeOf(n,Object.getPrototypeOf(i)),Object.setPrototypeOf(s,n);const c=Object.create(s);return t.realContext=i,t.debugContext=c,c.debug=!0,c}function gD(i,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${i}(${t})`}function PQ(i,e,t,n){n=Array.from(n).map(r=>r===void 0?"undefined":r);const s=globalThis.WebGLDebugUtils.glEnumToString(e),c=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,n),f=`${s} in gl.${t}(${c})`;ni.error(f)();debugger}function DQ(i,e,t){let n="";ni.level>=1&&(n=gD(e,t),i.traceWebGL&&ni.log(1,n)());for(const s of t)if(s===void 0){n=n||gD(e,t);debugger}}const x2={};function BQ(i="id"){x2[i]=x2[i]||1;const e=x2[i]++;return`${i}-${e}`}class Oy extends Hr{constructor(t,n={}){super(t,n);ce(this,"device");ce(this,"gl");ce(this,"handle");ce(this,"glTarget");ce(this,"glUsage");ce(this,"glIndexType",5123);ce(this,"byteLength");ce(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const s=typeof n=="object"?n.handle:void 0;this.handle=s||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=OQ(this.props.usage),this.glUsage=FQ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(t,n=0,s=t.byteLength+n){const c=this.glTarget;this.gl.bindBuffer(c,this.handle),this.gl.bufferData(c,s,this.glUsage),this.gl.bufferSubData(c,n,t),this.gl.bindBuffer(c,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(t,n,s),this.trackAllocatedMemory(s)}_initWithByteLength(t){let n=t;t===0&&(n=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,n,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,n,t.byteLength)}async readAsync(t=0,n){return this.readSyncWebGL(t,n)}readSyncWebGL(t=0,n){n=n??this.byteLength-t;const s=new Uint8Array(n),c=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,s,c,n),this.gl.bindBuffer(36662,null),this._setDebugData(s,t,n),s}}function OQ(i){return i&Hr.INDEX?34963:i&Hr.VERTEX?34962:i&Hr.UNIFORM?35345:34962}function FQ(i){return i&Hr.INDEX||i&Hr.VERTEX?35044:i&Hr.UNIFORM?35048:35044}function LQ(i){const e=i.split(/\r?\n/),t=[];for(const n of e){if(n.length<=1)continue;const s=n.split(":");if(s.length===2){const[k,F]=s;t.push({message:F.trim(),type:_D(k),lineNum:0,linePos:0});continue}const[c,f,r,...b]=s;let w=parseInt(r,10);isNaN(w)&&(w=0);let E=parseInt(f,10);isNaN(E)&&(E=0),t.push({message:b.join(":").trim(),type:_D(c),lineNum:w,linePos:E})}return t}function _D(i){const e=["warning","error","info"],t=i.toLowerCase();return e.includes(t)?t:"info"}class zQ extends d1{constructor(t,n){super(t,n);ce(this,"device");ce(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?LQ(t):[]}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(n==null?void 0:n.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,t),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ni.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ni.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async c=>await new Promise(f=>setTimeout(f,c));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function NQ(i,e,t,n){if(jQ(e))return n(i);const s=i;s.pushState();try{return UQ(i,e),Qm(s.gl,t),n(i)}finally{s.popState()}}function UQ(i,e){const t=i,{gl:n}=t;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(gf("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&i.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&i.features.has("provoking-vertex-webgl")){const c=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,f=gf("provokingVertex",e.provokingVertex,{first:36429,last:36430});c==null||c.provokingVertexWEBGL(f)}if((e.polygonMode||e.polygonOffsetLine)&&i.features.has("polygon-mode-webgl")){if(e.polygonMode){const c=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,f=gf("polygonMode",e.polygonMode,{fill:6914,line:6913});c==null||c.polygonModeWEBGL(1028,f),c==null||c.polygonModeWEBGL(1029,f)}e.polygonOffsetLine&&n.enable(10754)}if(i.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask($Q("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(KS("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;n.stencilMaskSeparate(1028,s),n.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&ni.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,c=KS("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,c,0,s),n.stencilFuncSeparate(1029,c,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=w2("stencilPassOperation",e.stencilPassOperation),c=w2("stencilFailOperation",e.stencilFailOperation),f=w2("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,c,f,s),n.stencilOpSeparate(1029,c,f,s)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=yD("blendColorOperation",e.blendColorOperation||"add"),c=yD("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(s,c);const f=tx("blendColorSrcFactor",e.blendColorSrcFactor||"one"),r=tx("blendColorDstFactor",e.blendColorDstFactor||"zero"),b=tx("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),w=tx("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(f,r,b,w)}}function KS(i,e){return gf(i,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function w2(i,e){return gf(i,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function yD(i,e){return gf(i,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function tx(i,e){return gf(i,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function VQ(i,e){return`Illegal parameter ${e} for ${i}`}function gf(i,e,t){if(!(e in t))throw new Error(VQ(i,e));return t[e]}function $Q(i,e){return e}function jQ(i){let e=!0;for(const t in i){e=!1;break}return e}function bz(i){const e={};return i.addressModeU&&(e[10242]=A2(i.addressModeU)),i.addressModeV&&(e[10243]=A2(i.addressModeV)),i.addressModeW&&(e[32882]=A2(i.addressModeW)),i.magFilter&&(e[10240]=JS(i.magFilter)),(i.minFilter||i.mipmapFilter)&&(e[10241]=HQ(i.minFilter||"linear",i.mipmapFilter)),i.lodMinClamp!==void 0&&(e[33082]=i.lodMinClamp),i.lodMaxClamp!==void 0&&(e[33083]=i.lodMaxClamp),i.type==="comparison-sampler"&&(e[34892]=34894),i.compare&&(e[34893]=KS("compare",i.compare)),i.maxAnisotropy&&(e[34046]=i.maxAnisotropy),e}function A2(i){switch(i){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function JS(i){switch(i){case"nearest":return 9728;case"linear":return 9729}}function HQ(i,e="none"){if(!e)return JS(i);switch(e){case"none":return JS(i);case"nearest":return i==="nearest"?9984:9986;case"linear":return i==="nearest"?9985:9987}}class QS extends f1{constructor(t,n){super(t,n);ce(this,"device");ce(this,"handle");ce(this,"parameters");this.device=t,this.parameters=bz(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[n,s]of Object.entries(t)){const c=Number(n);switch(c){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,c,s);break;default:this.device.gl.samplerParameteri(this.handle,c,s);break}}}}class _m extends u1{constructor(t,n){super(t,{...ns.defaultProps,...n});ce(this,"device");ce(this,"gl");ce(this,"handle");ce(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const WQ="Failed to deduce GL constant from typed array";function GQ(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(WQ)}}function XQ(i,e){const{clamped:t=!0}=e||{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function vz(i){switch(i){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function qQ(i){switch(i){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function R1(i,e,t){if(YQ(e))return t(i);const{nocatch:n=!0}=e,s=mf.get(i);s.push(),Qm(i,e);let c;if(n)c=t(i),s.pop();else try{c=t(i)}finally{s.pop()}return c}function YQ(i){for(const e in i)return!1;return!0}function ZQ(i,e,t){const{dimension:n,width:s,height:c,depth:f=0}=t,{glInternalFormat:r}=t,b=t.glTarget;switch(n){case"2d-array":case"3d":i.texStorage3D(b,e,r,s,c,f);break;default:i.texStorage2D(b,e,r,s,c)}}function bD(i,e,t,n){const{width:s,height:c}=n,{dimension:f,depth:r=0,mipLevel:b=0}=n,{x:w=0,y:E=0,z:k=0}=n,{glFormat:F,glType:$}=n,X=xz(n.glTarget,f,r),W=n.flipY?{37440:!0}:{};R1(i,W,()=>{switch(f){case"2d-array":case"3d":i.bindTexture(X,e),i.texSubImage3D(X,b,w,E,k,s,c,r,F,$,t),i.bindTexture(X,null);break;case"2d":case"cube":i.bindTexture(X,e),i.texSubImage2D(X,b,w,E,s,c,F,$,t),i.bindTexture(X,null);break;default:throw new Error(f)}})}function vD(i,e,t){const{dimension:n,width:s,height:c,depth:f=0,mipLevel:r=0,byteOffset:b=0}=t,{x:w=0,y:E=0,z:k=0}=t,{glFormat:F,glType:$,compressed:X}=t,W=xz(t.glTarget,n,f);switch(n){case"2d-array":case"3d":X?i.compressedTexSubImage3D(W,r,w,E,k,s,c,f,F,e,b):i.texSubImage3D(W,r,w,E,k,s,c,f,F,$,e,b);break;case"2d":case"cube":X?i.compressedTexSubImage2D(W,r,w,E,s,c,F,e,b):i.texSubImage2D(W,r,w,E,s,c,F,$,e,b);break;default:throw new Error(n)}}function KQ(i){switch(i){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(i)}function xz(i,e,t){return e==="cube"?34069+t:i}function JQ(i,e){var _e;const{sourceX:t=0,sourceY:n=0,sourceAttachment:s=0}=e||{};let{target:c=null,sourceWidth:f,sourceHeight:r,sourceDepth:b,sourceFormat:w,sourceType:E}=e||{};const{framebuffer:k,deleteFramebuffer:F}=wz(i),{gl:$,handle:X}=k;f||(f=k.width),r||(r=k.height);const W=(_e=k.colorAttachments[s])==null?void 0:_e.texture;if(!W)throw new Error(`Invalid framebuffer attachment ${s}`);b=(W==null?void 0:W.depth)||1,w||(w=(W==null?void 0:W.glFormat)||6408),E||(E=(W==null?void 0:W.glType)||5121),c=tee(c,E,w,f,r),E=E||GQ(c);const ne=$.bindFramebuffer(36160,X);return $.readBuffer(36064+s),$.readPixels(t,n,f,r,w,E,c),$.readBuffer(36064),$.bindFramebuffer(36160,ne||null),F&&k.destroy(),c}function QQ(i,e){const{target:t,sourceX:n=0,sourceY:s=0,sourceFormat:c=6408,targetByteOffset:f=0}=e||{};let{sourceWidth:r,sourceHeight:b,sourceType:w}=e||{};const{framebuffer:E,deleteFramebuffer:k}=wz(i);r=r||E.width,b=b||E.height;const F=E;w=w||5121;let $=t;if(!$){const W=vz(c),ne=qQ(w),_e=f+r*b*W*ne;$=F.device.createBuffer({byteLength:_e})}const X=i.device.createCommandEncoder();return X.copyTextureToBuffer({sourceTexture:i,width:r,height:b,origin:[n,s],destinationBuffer:$,byteOffset:f}),X.destroy(),k&&E.destroy(),$}function wz(i){return i instanceof p1?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:eee(i),deleteFramebuffer:!0}}function eee(i,e){const{device:t,width:n,height:s,id:c}=i;return t.createFramebuffer({...e,id:`framebuffer-for-${c}`,width:n,height:s,colorAttachments:[i]})}function tee(i,e,t,n,s,c){if(i)return i;e||(e=5121);const f=XQ(e,{clamped:!1}),r=vz(t);return new f(n*s*r)}class Fy extends ns{constructor(t,n){super(t,n);ce(this,"device");ce(this,"gl");ce(this,"handle");ce(this,"sampler");ce(this,"view");ce(this,"mipmaps");ce(this,"compressed");ce(this,"glTarget");ce(this,"glFormat");ce(this,"glType");ce(this,"glInternalFormat");ce(this,"textureUnit",0);const s={...this.props};s.data=n.data,this.device=t,this.gl=this.device.gl,this.glTarget=KQ(this.props.dimension);const c=gz(this.props.format);this.glInternalFormat=c.internalFormat,this.glFormat=c.format,this.glType=c.type,this.compressed=c.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:n,height:s}=t;if(!n||!s){const c=ns.getTextureDataSize(t.data);n=(c==null?void 0:c.width)||1,s=(c==null?void 0:c.height)||1}if(this.width=n,this.height=s,this.depth=t.depth,this.setSampler(t.sampler),this.view=new _m(this.device,{...this.props,texture:this}),this.bind(),ZQ(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new _m(this.device,{...t,texture:this})}setSampler(t={}){let n;t instanceof QS?(this.sampler=t,n=t.props):(this.sampler=new QS(this.device,t),n=t);const s=bz(n);this._setSamplerParameters(s)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ni.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){ni.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const n=ns.getExternalImageSize(t.image),s={...ns.defaultCopyExternalImageOptions,...n,...t},{image:c,depth:f,mipLevel:r,x:b,y:w,z:E,flipY:k}=s;let{width:F,height:$}=s;const{dimension:X,glTarget:W,glFormat:ne,glInternalFormat:_e,glType:Te}=this;if(F=Math.min(F,this.width-b),$=Math.min($,this.height-w),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return bD(this.device.gl,this.handle,c,{dimension:X,mipLevel:r,x:b,y:w,z:E,width:F,height:$,depth:f,glFormat:ne,glType:Te,glTarget:W,flipY:k}),{width:s.width,height:s.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,n=0){this.bind();const s=ns.normalizeTextureData(t,this);s.length>1&&this.props.mipmaps!==!1&&ni.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let c=0;c<s.length;c++){const f=s[c];this._setMipLevel(n,c,f)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),vD(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,n=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of ns.CubeFaces)this.setTextureCubeFaceData(t[s],s)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,n,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&ni.warn(`${this.id} has mipmap and multiple LODs.`)();const c=ns.CubeFaces.indexOf(n);this.setTexture2DData(t,c)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:n,width:s,height:c,pixels:f,data:r,format:b=6408,type:w=5121}=t,{gl:E}=this,k=f||r;this.bind(),k instanceof Promise?k.then(F=>this.setImageDataForFace(Object.assign({},t,{face:n,data:F,pixels:F}))):this.width||this.height?E.texImage2D(n,0,b,s,c,0,b,w,k):E.texImage2D(n,0,b,b,w,k)}_getImageDataMap(t){for(let n=0;n<ns.CubeFaces.length;++n){const s=ns.CubeFaces[n];t[s]&&(t[34069+n]=t[s],delete t[s])}return t}_setSamplerParameters(t){ni.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,s]of Object.entries(t)){const c=Number(n),f=s;switch(c){case 33082:case 33083:this.gl.texParameterf(this.glTarget,c,f);break;case 10241:this.gl.texParameteri(this.glTarget,c,f);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,c,f);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,c,f);break;default:this.gl.texParameteri(this.glTarget,c,f);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,n,s,c=this.glTarget){if(ns.isExternalImage(s)){bD(this.device.gl,this.handle,s,{...this,depth:t,mipLevel:n,glTarget:c,flipY:this.props.flipY});return}if(ns.isTextureLevelData(s)){vD(this.device.gl,s.data,{...this,depth:t,mipLevel:n,glTarget:c});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.glTarget,null),t}}const iee=[1,2,4,8];class nee extends SS{constructor(t,n){var f;super(t,n);ce(this,"device");ce(this,"glParameters");this.device=t;let s;if(!((f=n==null?void 0:n.parameters)!=null&&f.viewport))if(n!=null&&n.framebuffer){const{width:r,height:b}=n.framebuffer;s=[0,0,r,b]}else{const[r,b]=t.getCanvasContext().getDrawingBufferSize();s=[0,0,r,b]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const c=this.props.framebuffer;if(c!=null&&c.handle)if(this.props.framebuffer){const r=this.props.framebuffer.colorAttachments.map((b,w)=>36064+w);this.device.gl.drawBuffers(r)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(n.viewport=t.viewport.slice(0,4),n.depthRange=[t.viewport[4],t.viewport[5]]):n.viewport=t.viewport),t.scissorRect&&(n.scissorTest=!0,n.scissor=t.scissorRect),t.blendConstant&&(n.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(n.colorMask=iee.map(s=>!!(s&t.colorMask))),this.glParameters=n,Qm(this.device.gl,n)}beginOcclusionQuery(t){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((s,c)=>{s&&this.clearColorBuffer(c,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,t.clearStencil=this.props.clearStencil),n!==0&&R1(this.device.gl,t,()=>{this.device.gl.clear(n)})}clearColorBuffer(t=0,n=[0,0,0,0]){R1(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function ree(i){return see.includes(i)}const see=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Az={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Tz(i){const e=Az[i];if(!e)throw new Error("uniform");const[t,n,,s]=e;return{format:s,components:n,glType:t}}function oee(i){const e=Az[i];if(!e)throw new Error("attribute");const[,t,,n,s]=e;return{attributeType:n,vertexFormat:s,components:t}}function aee(i,e){const t={attributes:[],bindings:[]};t.attributes=lee(i,e);const n=uee(i,e);for(const r of n){const b=r.uniforms.map(w=>({name:w.name,format:w.format,byteOffset:w.byteOffset,byteStride:w.byteStride,arrayLength:w.arrayLength}));t.bindings.push({type:"uniform",name:r.name,group:0,location:r.location,visibility:(r.vertex?1:0)&(r.fragment?2:0),minBindingSize:r.byteLength,uniforms:b})}const s=hee(i,e);let c=0;for(const r of s)if(ree(r.type)){const{viewDimension:b,sampleType:w}=fee(r.type);t.bindings.push({type:"texture",name:r.name,group:0,location:c,viewDimension:b,sampleType:w}),r.textureUnit=c,c+=1}s.length&&(t.uniforms=s);const f=cee(i,e);return f!=null&&f.length&&(t.varyings=f),t}function lee(i,e){const t=[],n=i.getProgramParameter(e,35721);for(let s=0;s<n;s++){const c=i.getActiveAttrib(e,s);if(!c)throw new Error("activeInfo");const{name:f,type:r}=c,b=i.getAttribLocation(e,f);if(b>=0){const{attributeType:w}=oee(r),E=/instance/i.test(f)?"instance":"vertex";t.push({name:f,location:b,stepMode:E,type:w})}}return t.sort((s,c)=>s.location-c.location),t}function cee(i,e){const t=[],n=i.getProgramParameter(e,35971);for(let s=0;s<n;s++){const c=i.getTransformFeedbackVarying(e,s);if(!c)throw new Error("activeInfo");const{name:f,type:r,size:b}=c,{glType:w,components:E}=Tz(r),k={location:s,name:f,type:w,size:b*E};t.push(k)}return t.sort((s,c)=>s.location-c.location),t}function hee(i,e){const t=[],n=i.getProgramParameter(e,35718);for(let s=0;s<n;s++){const c=i.getActiveUniform(e,s);if(!c)throw new Error("activeInfo");const{name:f,size:r,type:b}=c,{name:w,isArray:E}=pee(f);let k=i.getUniformLocation(e,w);const F={location:k,name:w,size:r,type:b,isArray:E};if(t.push(F),F.size>1)for(let $=0;$<F.size;$++){const X=`${w}[${$}]`;k=i.getUniformLocation(e,X);const W={...F,name:X,location:k};t.push(W)}}return t}function uee(i,e){const t=(c,f)=>i.getActiveUniformBlockParameter(e,c,f),n=[],s=i.getProgramParameter(e,35382);for(let c=0;c<s;c++){const f={name:i.getActiveUniformBlockName(e,c)||"",location:t(c,35391),byteLength:t(c,35392),vertex:t(c,35396),fragment:t(c,35398),uniformCount:t(c,35394),uniforms:[]},r=t(c,35395)||[],b=i.getActiveUniforms(e,r,35383),w=i.getActiveUniforms(e,r,35384),E=i.getActiveUniforms(e,r,35387),k=i.getActiveUniforms(e,r,35388);for(let F=0;F<f.uniformCount;++F){const $=i.getActiveUniform(e,r[F]);if(!$)throw new Error("activeInfo");f.uniforms.push({name:$.name,format:Tz(b[F]).format,type:b[F],arrayLength:w[F],byteOffset:E[F],byteStride:k[F]})}n.push(f)}return n.sort((c,f)=>c.location-f.location),n}const dee={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function fee(i){const e=dee[i];if(!e)throw new Error("sampler");const[t,n]=e;return{viewDimension:t,sampleType:n}}function pee(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(i);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${i}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function mee(i,e,t,n){const s=i;let c=n;c===!0&&(c=1),c===!1&&(c=0);const f=typeof c=="number"?[c]:c;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return i.uniform1i(e,n);case 5126:return i.uniform1fv(e,f);case 35664:return i.uniform2fv(e,f);case 35665:return i.uniform3fv(e,f);case 35666:return i.uniform4fv(e,f);case 5124:return i.uniform1iv(e,f);case 35667:return i.uniform2iv(e,f);case 35668:return i.uniform3iv(e,f);case 35669:return i.uniform4iv(e,f);case 35670:return i.uniform1iv(e,f);case 35671:return i.uniform2iv(e,f);case 35672:return i.uniform3iv(e,f);case 35673:return i.uniform4iv(e,f);case 5125:return s.uniform1uiv(e,f,1);case 36294:return s.uniform2uiv(e,f,2);case 36295:return s.uniform3uiv(e,f,3);case 36296:return s.uniform4uiv(e,f,4);case 35674:return i.uniformMatrix2fv(e,!1,f);case 35675:return i.uniformMatrix3fv(e,!1,f);case 35676:return i.uniformMatrix4fv(e,!1,f);case 35685:return s.uniformMatrix2x3fv(e,!1,f);case 35686:return s.uniformMatrix2x4fv(e,!1,f);case 35687:return s.uniformMatrix3x2fv(e,!1,f);case 35688:return s.uniformMatrix3x4fv(e,!1,f);case 35689:return s.uniformMatrix4x2fv(e,!1,f);case 35690:return s.uniformMatrix4x3fv(e,!1,f)}throw new Error("Illegal uniform")}function gee(i){return nz(i)!==null||typeof i=="number"||typeof i=="boolean"}function _ee(i){const e={bindings:{},uniforms:{}};return Object.keys(i).forEach(t=>{const n=i[t];gee(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}function yee(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(i)}}function bee(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(i)}}const xD=4;class vee extends Pm{constructor(t,n){super(t,n);ce(this,"device");ce(this,"handle");ce(this,"vs");ce(this,"fs");ce(this,"introspectedLayout");ce(this,"uniforms",{});ce(this,"bindings",{});ce(this,"varyings",null);ce(this,"_uniformCount",0);ce(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:s,bufferMode:c=35981}=n;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,c)),this._linkShaders(),ni.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=aee(this.device.gl,this.handle),ni.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=xee(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,n){for(const[s,c]of Object.entries(t)){const f=this.shaderLayout.bindings.find(r=>r.name===s)||this.shaderLayout.bindings.find(r=>r.name===`${s}Uniforms`);if(!f){const r=this.shaderLayout.bindings.map(b=>`"${b.name}"`).join(", ");n!=null&&n.disableWarnings||ni.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${r}`,c)();continue}switch(c||ni.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),f.type){case"uniform":if(!(c instanceof Oy)&&!(c.buffer instanceof Oy))throw new Error("buffer value");break;case"texture":if(!(c instanceof _m||c instanceof Fy||c instanceof By))throw new Error("texture value");break;case"sampler":ni.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(f.type)}this.bindings[s]=c}}draw(t){var ne;const{renderPass:n,parameters:s=this.props.parameters,topology:c=this.props.topology,vertexArray:f,vertexCount:r,instanceCount:b,isInstanced:w=!1,firstVertex:E=0,transformFeedback:k}=t,F=yee(c),$=!!f.indexBuffer,X=(ne=f.indexBuffer)==null?void 0:ne.glIndexType;if(this.linkStatus!=="success")return ni.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ni.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),f.bindBeforeRender(n),k&&k.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const W=n;return NQ(this.device,s,W.glParameters,()=>{$&&w?this.device.gl.drawElementsInstanced(F,r||0,X,E,b||0):$?this.device.gl.drawElements(F,r||0,X,E):w?this.device.gl.drawArraysInstanced(F,E,r||0,b||0):this.device.gl.drawArrays(F,E,r||0),k&&k.end()}),f.unbindAfterRender(n),!0}setUniformsWebGL(t){const{bindings:n}=_ee(t);Object.keys(n).forEach(s=>{ni.warn(`Unsupported value "${JSON.stringify(n[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ni.time(xD,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),ni.timeEnd(xD,`linkProgram for ${this.id}`)(),ni.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}ni.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ni.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(t){var n;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((n=this.fs)==null?void 0:n.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const s=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${s}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async c=>await new Promise(f=>setTimeout(f,c));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(ni.warn(`Binding ${n.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let n=0,s=0;for(const c of this.shaderLayout.bindings){const f=this.bindings[c.name]||this.bindings[c.name.replace(/Uniforms$/,"")];if(!f)throw new Error(`No value for binding ${c.name} in ${this.id}`);switch(c.type){case"uniform":const{name:r}=c,b=t.getUniformBlockIndex(this.handle,r);if(b===4294967295)throw new Error(`Invalid uniform block name ${r}`);t.uniformBlockBinding(this.handle,s,b),f instanceof Oy?t.bindBufferBase(35345,s,f.handle):t.bindBufferRange(35345,s,f.buffer.handle,f.offset||0,f.size||f.buffer.byteLength-f.offset),s+=1;break;case"texture":if(!(f instanceof _m||f instanceof Fy||f instanceof By))throw new Error("texture");let w;if(f instanceof _m)w=f.texture;else if(f instanceof Fy)w=f;else if(f instanceof By&&f.colorAttachments[0]instanceof _m)ni.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),w=f.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+n),t.bindTexture(w.glTarget,w.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${c.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:n,location:s,type:c,textureUnit:f}=t,r=this.uniforms[n]??f;r!==void 0&&mee(this.device.gl,s,c,r)}}}function xee(i,e){const t={...i,attributes:i.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const s=t.attributes.find(c=>c.name===n.name);s?(s.type=n.type||s.type,s.stepMode=n.stepMode||s.stepMode):ni.warn(`shader layout attribute ${n.name} not present in shader`)}return t}class wee extends CS{constructor(t){super(t,{});ce(this,"device");ce(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const n of t)switch(n.name){case"copy-buffer-to-buffer":Aee(this.device,n.options);break;case"copy-buffer-to-texture":Tee(this.device,n.options);break;case"copy-texture-to-buffer":See(this.device,n.options);break;case"copy-texture-to-texture":Eee(this.device,n.options);break;default:throw new Error(n.name)}}}function Aee(i,e){const t=e.sourceBuffer,n=e.destinationBuffer;i.gl.bindBuffer(36662,t.handle),i.gl.bindBuffer(36663,n.handle),i.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),i.gl.bindBuffer(36662,null),i.gl.bindBuffer(36663,null)}function Tee(i,e){throw new Error("Not implemented")}function See(i,e){const{sourceTexture:t,mipLevel:n=0,aspect:s="all",width:c=e.sourceTexture.width,height:f=e.sourceTexture.height,depthOrArrayLayers:r=0,origin:b=[0,0],destinationBuffer:w,byteOffset:E=0,bytesPerRow:k,rowsPerImage:F}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||r!==0||k||F)throw new Error("not implemented");const{framebuffer:$,destroyFramebuffer:X}=Sz(t);let W;try{const ne=w,_e=c||$.width,Te=f||$.height,we=gz($.colorAttachments[0].texture.props.format),Ee=we.format,Le=we.type;i.gl.bindBuffer(35051,ne.handle),W=i.gl.bindFramebuffer(36160,$.handle),i.gl.readPixels(b[0],b[1],_e,Te,Ee,Le,E)}finally{i.gl.bindBuffer(35051,null),W!==void 0&&i.gl.bindFramebuffer(36160,W),X&&$.destroy()}}function Eee(i,e){const{sourceTexture:t,destinationMipLevel:n=0,origin:s=[0,0],destinationOrigin:c=[0,0],destinationTexture:f}=e;let{width:r=e.destinationTexture.width,height:b=e.destinationTexture.height}=e;const{framebuffer:w,destroyFramebuffer:E}=Sz(t),[k,F]=s,[$,X,W]=c,ne=i.gl.bindFramebuffer(36160,w.handle);let _e=null,Te;if(f instanceof Fy)_e=f,r=Number.isFinite(r)?r:_e.width,b=Number.isFinite(b)?b:_e.height,_e.bind(0),Te=_e.glTarget;else throw new Error("invalid destination");switch(Te){case 3553:case 34067:i.gl.copyTexSubImage2D(Te,n,$,X,k,F,r,b);break;case 35866:case 32879:i.gl.copyTexSubImage3D(Te,n,$,X,W,k,F,r,b);break}_e&&_e.unbind(),i.gl.bindFramebuffer(36160,ne),E&&w.destroy()}function Sz(i){if(i instanceof ns){const{width:e,height:t,id:n}=i;return{framebuffer:i.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:t,colorAttachments:[i]}),destroyFramebuffer:!0}}return{framebuffer:i,destroyFramebuffer:!1}}class Cee extends ES{constructor(t,n){super(t,n);ce(this,"device");ce(this,"commandBuffer");this.device=t,this.commandBuffer=new wee(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,n,s){}}function Iee(i){const{target:e,source:t,start:n=0,count:s=1}=i,c=t.length,f=s*c;let r=0;for(let b=n;r<c;r++)e[b++]=t[r];for(;r<f;)r<f-r?(e.copyWithin(n+r,n,n+r),r*=2):(e.copyWithin(n+r,n,n+f-r),r=f);return i.target}class CC extends IS{constructor(t,n){super(t,n);ce(this,"device");ce(this,"handle");ce(this,"buffer",null);ce(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return QH()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const n=t;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(t,n){const s=n;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:c,type:f,stride:r,offset:b,normalized:w,integer:E,divisor:k}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),E?this.device.gl.vertexAttribIPointer(t,c,f,r,b):this.device.gl.vertexAttribPointer(t,c,f,w,r,b),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,k||0),this.attributes[t]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,n){this._enable(t,!1),this.attributes[t]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const n=this.attributes[t];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(t,n)}}_getAccessor(t){const n=this.attributeInfos[t];if(!n)throw new Error(`Unknown attribute location ${t}`);const s=mz(n.bufferDataType);return{size:n.bufferComponents,type:s,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(t,n=!0){const c=CC.isConstantAttributeZeroSupported(this.device)||t!==0;(n||c)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,n){const s=Mee(n),c=s.byteLength*t,f=s.length*t;if(this.buffer&&c!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${c} !== ${this.buffer.byteLength}.`);let r=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:c}),r=r||!Ree(s,this.bufferValue),r){const b=eX(n.constructor,f);Iee({target:b,source:s,start:0,count:f}),this.buffer.write(b),this.bufferValue=n}return this.buffer}}function Mee(i){return Array.isArray(i)?new Float32Array(i):i}function Ree(i,e){if(!i||!e||i.length!==e.length||i.constructor!==e.constructor)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}class kee extends MS{constructor(t,n){super(t,n);ce(this,"device");ce(this,"gl");ce(this,"handle");ce(this,"layout");ce(this,"buffers",{});ce(this,"unusedBuffers",{});ce(this,"bindOnUse",!0);ce(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(bee(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in t)this.setBuffer(n,t[n])})}setBuffer(t,n){const s=this._getVaryingIndex(t),{buffer:c,byteLength:f,byteOffset:r}=this._getBufferRange(n);if(s<0){this.unusedBuffers[t]=c,ni.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[s]={buffer:c,byteLength:f,byteOffset:r},this.bindOnUse||this._bindBuffer(s,c,r,f)}getBuffer(t){if(wD(t))return this.buffers[t]||null;const n=this._getVaryingIndex(t);return n>=0?this.buffers[n]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let n;return this._bound?n=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof Oy)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:n,byteOffset:s=0,byteLength:c=t.buffer.byteLength}=t;return{buffer:n,byteOffset:s,byteLength:c}}_getVaryingIndex(t){if(wD(t))return Number(t);for(const n of this.layout.varyings)if(t===n.name)return n.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:n,byteLength:s,byteOffset:c}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),n,c,s)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,n,s=0,c){const f=n&&n.handle;!f||c===void 0?this.gl.bindBufferBase(35982,t,f):this.gl.bindBufferRange(35982,t,f,s,c)}}function wD(i){return typeof i=="number"?Number.isInteger(i):/^\d+$/.test(i)}class Pee extends RS{constructor(t,n){super(t,n);ce(this,"device");ce(this,"handle");ce(this,"target",null);ce(this,"_queryPending",!1);ce(this,"_pollingPromise",null);if(this.device=t,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((s,c)=>{const f=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):n++>t?(c("Timed out"),this._pollingPromise=null):requestAnimationFrame(f)};requestAnimationFrame(f)}),this._pollingPromise}}class ym extends Ou{constructor(t){var k,F;super({...t,id:t.id||BQ("webgl-device")});ce(this,"type","webgl");ce(this,"handle");ce(this,"features");ce(this,"limits");ce(this,"info");ce(this,"canvasContext");ce(this,"lost");ce(this,"_resolveContextLost");ce(this,"gl");ce(this,"debug",!1);ce(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});ce(this,"_extensions",{});ce(this,"_polyfilled",!1);ce(this,"spectorJS");ce(this,"renderPass",null);ce(this,"_constants");const n=Ou._getCanvasContextProps(t);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(F=(k=n.canvas)==null?void 0:k.gl)==null?void 0:F.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new AQ(this,n),this.lost=new Promise($=>{this._resolveContextLost=$});const c={...t.webgl};n.alphaMode==="premultiplied"&&(c.premultipliedAlpha=!0),t.powerPreference!==void 0&&(c.powerPreference=t.powerPreference);const r=this.props._handle||nQ(this.canvasContext.canvas,{onContextLost:$=>{var X;return(X=this._resolveContextLost)==null?void 0:X.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:$=>console.log("WebGL context restored")},c);if(!r)throw new Error("WebGL context creation failed");if(s=r.device,s){if(t._reuseDevices)return ni.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=r,this.gl=r,this.spectorJS=EQ({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=rQ(this.gl,this._extensions),this.limits=new vQ(this.gl),this.features=new bQ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new mf(this.gl,{log:(...$)=>ni.log(1,...$)()}).trackState(this.gl,{copyState:!1});const w=t.debugWebGL||t.debug,E=t.debugWebGL;w&&(this.gl=MQ(this.gl,{debugWebGL:w,traceWebGL:E}),ni.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(ni.level=Math.max(ni.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const n=this._normalizeBufferProps(t);return new Oy(this,n)}createTexture(t){return new Fy(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new QS(this,t)}createShader(t){return new zQ(this,t)}createFramebuffer(t){return new By(this,t)}createVertexArray(t){return new CC(this,t)}createTransformFeedback(t){return new kee(this,t)}createQuerySet(t){return new Pee(this,t)}createRenderPipeline(t){return new vee(this,t)}beginRenderPass(t){return new nee(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new Cee(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,n){return JQ(t,n)}readPixelsToBufferWebGL(t,n){return QQ(t,n)}setParametersWebGL(t){Qm(this.gl,t)}getParametersWebGL(t){return fz(this.gl,t)}withParametersWebGL(t,n){return R1(this.gl,t,n)}resetWebGL(){ni.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),JJ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return mQ(this.gl,t,this._extensions)}loseDevice(){var c;let t=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(t=!0,s.loseContext()),(c=this._resolveContextLost)==null||c.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){mf.get(this.gl).push()}popState(){mf.get(this.gl).pop()}setSpectorMetadata(t,n){t.__SPECTOR_Metadata=n}getGLKey(t,n){const s=Number(t);for(const c in this.gl)if(this.gl[c]===s)return`GL.${c}`;return n!=null&&n.emptyIfUnknown?"":String(t)}getGLKeys(t){const n={emptyIfUnknown:!0};return Object.entries(t).reduce((s,[c,f])=>(s[`${c}:${this.getGLKey(c,n)}`]=`${f}:${this.getGLKey(f,n)}`,s),{})}setConstantAttributeWebGL(t,n){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const c=this._constants[t];switch(c&&Fee(c,n)&&ni.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=n,n.constructor){case Float32Array:Dee(this,t,n);break;case Int32Array:Bee(this,t,n);break;case Uint32Array:Oee(this,t,n);break;default:throw new Error("constant")}}getExtension(t){return Fm(this.gl,t,this._extensions),this._extensions}}function Dee(i,e,t){switch(t.length){case 1:i.gl.vertexAttrib1fv(e,t);break;case 2:i.gl.vertexAttrib2fv(e,t);break;case 3:i.gl.vertexAttrib3fv(e,t);break;case 4:i.gl.vertexAttrib4fv(e,t);break}}function Bee(i,e,t){i.gl.vertexAttribI4iv(e,t)}function Oee(i,e,t){i.gl.vertexAttribI4uiv(e,t)}function Fee(i,e){if(!i||!e||i.length!==e.length||i.constructor!==e.constructor)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}const Lee={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},zee=i=>({drawBuffersWEBGL(e){return i.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Nee=i=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return i.createVertexArray()},deleteVertexArrayOES(e){return i.deleteVertexArray(e)},isVertexArrayOES(e){return i.isVertexArray(e)},bindVertexArrayOES(e){return i.bindVertexArray(e)}}),Uee=i=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return i.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return i.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return i.vertexAttribDivisor(...e)}});function Vee(i=!0){const e=HTMLCanvasElement.prototype;if(!i&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,n){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",n);return s instanceof HTMLElement&&$ee(s),s}return this.originalGetContext(t,n)}}function $ee(i){i.getExtension("EXT_color_buffer_float");const e={...Lee,WEBGL_disjoint_timer_query:i.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:zee(i),OES_vertex_array_object:Nee(i),ANGLE_instanced_arrays:Uee(i)},t=i.getExtension;i.getExtension=function(s){const c=t.call(i,s);return c||(s in e?e[s]:null)};const n=i.getSupportedExtensions;i.getSupportedExtensions=function(){const s=n.apply(i)||[];return s==null?void 0:s.concat(Object.keys(e))}}const ix=1;class jee extends RG{constructor(){super();ce(this,"type","webgl");Ou.defaultProps={...Ou.defaultProps,...EC},ym.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){Vee(t)}async attach(t){if(t instanceof ym)return t;if((t==null?void 0:t.device)instanceof Ou)return t.device;if(!Hee(t))throw new Error("Invalid WebGL2RenderingContext");return new ym({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){ni.groupCollapsed(ix,"WebGLDevice created")();const n=[];(t.debugWebGL||t.debug)&&n.push(IQ()),t.debugSpectorJS&&n.push(SQ(t));const s=await Promise.allSettled(n);for(const r of s)r.status==="rejected"&&ni.error(`Failed to initialize debug libraries ${r.reason}`)();const c=new ym(t),f=`${c._reused?"Reusing":"Created"} device with WebGL2 ${c.debug?"debug ":""}context: ${c.info.vendor}, ${c.info.renderer} for canvas: ${c.canvasContext.id}`;return ni.probe(ix,f)(),ni.table(ix,c.info)(),ni.groupEnd(ix)(),c}}function Hee(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}const AD=new jee;function Au(){}const Wee=({isDragging:i})=>i?"grabbing":"grab",Ez={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Au,onWebGLInitialized:Au,onResize:Au,onViewStateChange:Au,onInteractionStateChange:Au,onBeforeRender:Au,onAfterRender:Au,onLoad:Au,onError:i=>gr.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Wee,getTooltip:null,debug:!1,drawPickingColors:!1};class s0{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new vw({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:s}=this;if(n.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(n.leftButton||n.rightButton)return;{const c=n.offsetCenter;if(!c)return;s.x=c.x,s.y=c.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=n},this._onEvent=n=>{const s=VS[n.type],c=n.offsetCenter;if(!s||!c||!this.layerManager)return;const f=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:c.x,y:c.y,layers:f,viewports:this.getViewports(c)},this._lastPointerDownInfo),{layer:b}=r,w=b&&(b[s]||b.props[s]),E=this.props[s];let k=!1;w&&(k=w.call(b,r,n)),k||(E==null||E(r,n),this.widgetManager.onEvent(r,n))},this._onPointerDown=n=>{var f;if(((f=this.device)==null?void 0:f.type)==="webgpu")return;const s=n.offsetCenter,c=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=c.result[0]||c.emptyInfo},this.props={...Ez,...e},e=this.props,e.viewState&&e.initialViewState&&gr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&gr.error("WebGL1 context not supported.")(),t=AD.attach(e.gl)),t||(t=AS.createDevice({type:"best-available",_reuseDevices:!0,adapters:[AD],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&t0.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,s,c,f,r,b,w,E;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(c=this.effectManager)==null||c.finalize(),this.effectManager=null,(f=this.deckRenderer)==null||f.finalize(),this.deckRenderer=null,(r=this.deckPicker)==null||r.finalize(),this.deckPicker=null,(b=this.eventManager)==null||b.destroy(),this.eventManager=null,(w=this.widgetManager)==null||w.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((E=this.canvas.parentElement)==null||E.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&gr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&gr.removed("onLayerClick","onClick")(),e.initialViewState&&!Fl(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),c=this.effectManager.needsRedraw(e),f=this.deckRenderer.needsRedraw(e);return t=t||n||s||c||f,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Fs(this.viewManager),this.viewManager.views}getViewports(e){return Fs(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,n){Fs(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const c=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return s.get(t).timeEnd(),c}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Fs(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:t,height:n}=e;if(t||t===0){const c=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=c}if(n||n===0){const c=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=c}}_updateCanvasSize(){var s,c;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,(s=this.viewManager)==null||s.setProps({width:t,height:n}),(c=this.layerManager)==null||c.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:s,useDevicePixels:c}=t;return new YK({device:e,useDevicePixels:c,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:f=>this._setDevice(f.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new wC({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,n,s,c;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:f,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=f.length>0;let b=r,w=!1;for(const E of f)b=E,w=((n=E.layer)==null?void 0:n.onHover(E,e.event))||w;w||((c=(s=this.props).onHover)==null||c.call(s,b,e.event),this.widgetManager.onHover(b,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,c;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new iz;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new wZ(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(HP).map(f=>{var $;const[r,b,w,E]=HP[f],k=($=this.props.eventRecognizerOptions)==null?void 0:$[f],F={...b,...k,event:f};return{recognizer:new r(F),recognizeWith:w,requestFailure:E}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const f in VS)this.eventManager.on(f,this._onEvent);this.viewManager=new vJ({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new bJ(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new BJ({deck:this,device:this.device}),this.deckRenderer=new LJ(this.device),this.deckPicker=new jJ(this.device),this.widgetManager=new GJ({deck:this,parentElement:(c=this.canvas)==null?void 0:c.parentElement}),this.widgetManager.addDefault(new qJ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var f;const{device:n,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:s});const c={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(f=this.deckRenderer)==null||f.renderLayers(c),c.pass==="screen"&&this.widgetManager.onRedraw({viewports:c.viewports,layers:c.layers}),this.props.onAfterRender({device:n,gl:s})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),gr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=AS.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}s0.defaultProps=Ez;s0.VERSION=OW;function Gee(i){switch(i){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return KF(i)}}const Xee=ZF;function nx(i,e,t){const n=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:i,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function af(i){return i.stride||i.size*i.bytesPerElement}function qee(i,e){return i.type===e.type&&i.size===e.size&&af(i)===af(e)&&(i.offset||0)===(e.offset||0)}function eE(i,e){e.offset&&gr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=af(i),n=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,s=e.elementOffset||0,c=n*t+s*i.bytesPerElement+(i.offset||0);return{...e,offset:c,stride:t}}function Yee(i,e){const t=eE(i,e);return{high:t,low:{...t,offset:t.offset+i.size*4}}}class Zee{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,c=s==="float64";let{defaultValue:f}=t;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let r;c?r="float32":!s&&t.isIndexed?r="uint32":r=s||"float32";let b=Gee(s||r);this.doublePrecision=c,c&&t.fp64===!1&&(b=Float32Array),this.value=null,this.settings={...t,defaultType:b,defaultValue:f,logicalType:s,type:r,normalized:r.includes("norm"),size:this.size,bytesPerElement:b.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*af(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),t0.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const s=this.value;if(t){const c=eE(this.getAccessor(),t),f=c.offset/s.BYTES_PER_ELEMENT,r=c.size||this.size;n[e]=s.subarray(f,f+r)}else n[e]=s}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),s=[],c={name:this.id,byteStride:af(n),attributes:s};if(this.doublePrecision){const f=Yee(n,t||{});s.push(nx(e,{...n,...f.high},this.device.type),nx(`${e}64Low`,{...n,...f.low},this.device.type))}else if(t){const f=eE(n,t);s.push(nx(e,{...n,...f},this.device.type))}else s.push(nx(e,n,this.device.type));return c}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:s}=this,c=n*s;if(t&&c&&t.length>=c){const f=new Array(s).fill(1/0),r=new Array(s).fill(-1/0);for(let b=0;b<c;)for(let w=0;w<s;w++){const E=t[b++];E<f[w]&&(f[w]=E),E>r[w]&&(r[w]=E)}e=[f,r]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Hr?n={buffer:e}:n=e;const s={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)s.type="float32";else{const f=Xee(n.value);s.type=s.normalized?f.replace("int","norm"):f}s.bytesPerElement=n.value.BYTES_PER_ELEMENT,s.stride=af(s)}if(t.bounds=null,n.constant){let c=n.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!t.constant||!this._areValuesEqual(c,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(c)?c:new Float32Array(c)}else if(n.buffer){const c=n.buffer;t.externalBuffer=c,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let c=n.value;t.externalBuffer=null,t.constant=!1,this.value=c;let{buffer:f}=this;const r=af(s),b=(s.vertexOffset||0)*r;if(this.doublePrecision&&c instanceof Float64Array&&(c=m2(c,s)),this.settings.isIndexed){const E=this.settings.defaultType;c.constructor!==E&&(c=new E(c))}const w=c.byteLength+b+r*2;(!f||f.byteLength<w)&&(f=this._createBuffer(w)),f.write(c,b)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?m2(t,{size:this.size,startIndex:n,endIndex:s}):t.subarray(n,s),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,s=n.allocatedValue,c=t0.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=c;const{byteOffset:f}=this;let{buffer:r}=this;return(!r||r.byteLength<c.byteLength+f)&&(r=this._createBuffer(c.byteLength+f),t&&s&&r.write(s instanceof Float64Array?m2(s,this):s,f)),n.allocatedValue=c,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof n)&&this.settings.normalized&&!("normalized"in e)&&gr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:s,size:c}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let f=c;for(;--f>=0;)t[n+f]=s[f];return t}switch(c){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let f=c;for(;--f>=0;)t[n+f]=Number.isFinite(e[f])?e[f]:s[f]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:(t?Hr.INDEX:Hr.VERTEX)|Hr.COPY_DST,indexType:t?n:void 0,byteLength:e}),this._buffer}}const TD=[],SD=[];function Cz(i,e=0,t=1/0){let n=TD;const s={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?n=i:i.length>0&&(SD.length=i.length,n=SD):n=TD,(e>0||Number.isFinite(t))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,t),s.index=e-1),{iterable:n,objectInfo:s}}function Iz(i){return i&&i[Symbol.asyncIterator]}function Kee(i,e){const{size:t,stride:n,offset:s,startIndices:c,nested:f}=e,r=i.BYTES_PER_ELEMENT,b=n?n/r:t,w=s?s/r:0,E=Math.floor((i.length-w)/b);return(k,{index:F,target:$})=>{if(!c){const _e=F*b+w;for(let Te=0;Te<t;Te++)$[Te]=i[_e+Te];return $}const X=c[F],W=c[F+1]||E;let ne;if(f){ne=new Array(W-X);for(let _e=X;_e<W;_e++){const Te=_e*b+w;$=new Array(t);for(let we=0;we<t;we++)$[we]=i[Te+we];ne[_e-X]=$}}else if(b===t)ne=i.subarray(X*t+w,W*t+w);else{ne=new i.constructor((W-X)*t);let _e=0;for(let Te=X;Te<W;Te++){const we=Te*b+w;for(let Ee=0;Ee<t;Ee++)ne[_e++]=i[we+Ee]}}return ne}}const Jee=[],$x=[[0,1/0]];function Qee(i,e){if(i===$x||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const t=[],n=i.length;let s=0;for(let c=0;c<n;c++){const f=i[c];f[1]<e[0]?(t.push(f),s=c+1):f[0]>e[1]?t.push(f):e=[Math.min(f[0],e[0]),Math.max(f[1],e[1])]}return t.splice(s,0,e),t}const ete={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function Mz(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const t=i.type||"interpolation";return{...ete[t],...e,...i,type:t}}class Rz extends Zee{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:$x}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!qee(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,s=Array.isArray(t)?e[t.find(c=>e[c])]:e[t];return Mz(s,n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:n=0,endRow:s=1/0}=t;this.state.updateRanges=Qee(this.state.updateRanges,[n,s])}else this.state.updateRanges=$x}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Jee}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,t.updateRanges!==$x),!0):!1}updateBuffer({numInstances:e,data:t,props:n,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:f,noAlloc:r}}=this;let b=!0;if(f){for(const[w,E]of c)f.call(s,this,{data:t,startRow:w,endRow:E,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,E]of c){const k=Number.isFinite(w)?this.getVertexOffset(w):0,F=Number.isFinite(E)?this.getVertexOffset(E):r||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:k,endOffset:F})}this._checkAttributeArray()}else b=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),b}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:s}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const f=e;Fs(ArrayBuffer.isView(f.value),`invalid ${s.accessor}`);const r=!!f.size&&f.size!==this.size;return n.binaryAccessor=Kee(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:t,nested:r}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=s??"vertex",!t)return n;for(const c in t){const f=super._getBufferLayout(c,t[c]);n.attributes.push(...f.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:s,props:c,numInstances:f}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:r,state:b,value:w,size:E,startIndices:k}=e,{accessor:F,transform:$}=r;let X=b.binaryAccessor||(typeof F=="function"?F:c[F]);typeof X!="function"&&(X=()=>X),Fs(typeof X=="function",`accessor "${F}" is not a function`);let W=e.getVertexOffset(n);const{iterable:ne,objectInfo:_e}=Cz(t,n,s);for(const Te of ne){_e.index++;let we=X(Te,_e);if($&&(we=$.call(this,we)),k){const Ee=(_e.index<k.length-1?k[_e.index+1]:f)-k[_e.index];if(we&&Array.isArray(we[0])){let Le=W;for(const Je of we)e._normalizeValue(Je,w,Le),Le+=E}else we&&we.length>E?w.set(we,W):(e._normalizeValue(we,_e.target,0),pJ({target:w,source:_e.target,start:W,count:Ee}));W+=Ee*E}else e._normalizeValue(we,w,W),W+=E}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function T2(i){const{source:e,target:t,start:n=0,size:s,getData:c}=i,f=i.end||t.length,r=e.length,b=f-n;if(r>b){t.set(e.subarray(0,b),n);return}if(t.set(e,n),!c)return;let w=r;for(;w<b;){const E=c(w,e);for(let k=0;k<s;k++)t[n+w]=E[k]||0,w++}}function tte({source:i,target:e,size:t,getData:n,sourceStartIndices:s,targetStartIndices:c}){if(!s||!c)return T2({source:i,target:e,size:t,getData:n}),e;let f=0,r=0;const b=n&&((E,k)=>n(E+r,k)),w=Math.min(s.length,c.length);for(let E=1;E<w;E++){const k=s[E]*t,F=c[E]*t;T2({source:i.subarray(f,k),target:e,start:r,end:F,size:t,getData:b}),f=k,r=F}return r<e.length&&T2({source:[],target:e,start:r,size:t,getData:b}),e}function ite(i){const{device:e,settings:t,value:n}=i,s=new Rz(e,t);return s.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function kz(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${i}"`)}}function Pz(i){switch(i){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Dz(i){i.push(i.shift())}function nte(i,e){const{doublePrecision:t,settings:n,value:s,size:c}=i,f=t&&s instanceof Float64Array?2:1;let r=0;const{shaderAttributes:b}=i.settings;if(b)for(const w of Object.values(b))r=Math.max(r,w.vertexOffset??0);return(n.noAlloc?s.length:(e+r)*c)*f}function Bz({device:i,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=i.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function Oz({device:i,buffer:e,attribute:t,fromLength:n,toLength:s,fromStartIndices:c,getData:f=r=>r}){const r=t.doublePrecision&&t.value instanceof Float64Array?2:1,b=t.size*r,w=t.byteOffset,E=t.settings.bytesPerElement<4?w/t.settings.bytesPerElement*4:w,k=t.startIndices,F=c&&k,$=t.isConstant;if(!F&&e&&n>=s)return e;const X=t.value instanceof Float64Array?Float32Array:t.value.constructor,W=$?t.value:new X(t.getBuffer().readSyncWebGL(w,s*X.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!$){const we=f;f=(Ee,Le)=>t.normalizeConstant(we(Ee,Le))}const ne=$?(we,Ee)=>f(W,Ee):(we,Ee)=>f(W.subarray(we+w,we+w+b),Ee),_e=e?new Float32Array(e.readSyncWebGL(E,n*4).buffer):new Float32Array(0),Te=new Float32Array(s);return tte({source:_e,target:Te,sourceStartIndices:c,targetStartIndices:k,size:b,getData:ne}),(!e||e.byteLength<Te.byteLength+E)&&(e==null||e.destroy(),e=i.createBuffer({byteLength:Te.byteLength+E,usage:35050})),e.write(Te,E),e}class Fz{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Tw(n),this.attribute=t,this.attributeInTransition=ite(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=nte(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class rte extends Fz{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=lte(e,t)}start(e,t){const n=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:c,attribute:f}=this;Dz(c),c[0]=Oz({device:this.device,buffer:c[0],attribute:f,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),c[1]=Bz({device:this.device,source:c[0],target:c[1]}),this.setBuffer(c[1]);const{transform:r}=this,b=r.model;let w=Math.floor(this.currentLength/f.size);Lz(f)&&(w/=2),b.setVertexCount(w),f.isConstant?(b.setAttributes({aFrom:c[0]}),b.setConstantAttributes({aTo:f.value})):b.setAttributes({aFrom:c[0],aTo:f.getBuffer()}),r.transformFeedback.setBuffers({vCurrent:c[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let s=n/e;t&&(s=t(s));const{model:c}=this.transform,f={time:s};c.shaderInputs.setProps({interpolation:f}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const ste=`uniform interpolationUniforms {
  float time;
} interpolation;
`,ED={name:"interpolation",vs:ste,uniformTypes:{time:"f32"}},ote=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,ate=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Lz(i){return i.doublePrecision&&i.value instanceof Float64Array}function lte(i,e){const t=e.size,n=kz(t),s=Pz(t),c=e.getBufferLayout();return Lz(e)?new n0(i,{vs:ate,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[dY,ED],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new n0(i,{vs:ote,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:c.attributes[0].format}],modules:[ED],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class cte extends Fz{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=mte(e),this.framebuffer=gte(e,this.texture),this.transform=pte(e,t)}start(e,t){const n=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:c,attribute:f}=this;for(let b=0;b<2;b++)c[b]=Oz({device:this.device,buffer:c[b],attribute:f,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});c[2]=Bz({device:this.device,source:c[0],target:c[2]}),this.setBuffer(c[1]);const{model:r}=this.transform;r.setVertexCount(Math.floor(this.currentLength/f.size)),f.isConstant?r.setConstantAttributes({aTo:f.value}):r.setAttributes({aTo:f.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:s}=this,c=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const f={stiffness:c.stiffness,damping:c.damping};t.model.shaderInputs.setProps({spring:f}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Dz(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const hte=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,ute={name:"spring",vs:hte,uniformTypes:{damping:"f32",stiffness:"f32"}},dte=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fte=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function pte(i,e){const t=kz(e.size),n=Pz(e.size);return new n0(i,{vs:dte,fs:fte,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[ute],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function mte(i){return i.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function gte(i,e){return i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const _te={interpolation:rte,spring:cte};class yte{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const s in e){const c=e[s],f=c.getTransitionSetting(t);f&&this._updateAttribute(s,c,f)}for(const s in this.transitions){const c=e[s];(!c||!c.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const s=this.transitions[e];let c=!s||s.type!==n.type;if(c){s&&this._removeTransition(e);const f=_te[n.type];f?this.transitions[e]=new f({attribute:t,timeline:this.timeline,device:this.device}):(gr.error(`unsupported transition type '${n.type}'`)(),c=!1)}(c||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const CD="attributeManager.invalidate",bte="attributeManager.updateStart",vte="attributeManager.updateEnd",xte="attribute.updateStart",wte="attribute.allocate",Ate="attribute.updateEnd";class Tte{constructor(e,{id:t="attribute-manager",stats:n,timeline:s}={}){this.mergeBoundsMemoized=M0(FK),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new yte(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);zo(CD,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);zo(CD,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:s,props:c={},buffers:f={},context:r={}}){let b=!1;zo(bte,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const E=this.attributes[w],k=E.settings.accessor;E.startIndices=n,E.numInstances=t,c[w]&&gr.removed(`props.${w}`,`data.attributes.${w}`)(),E.setExternalBuffer(f[w])||E.setBinaryValue(typeof k=="string"?f[k]:void 0,e.startIndices)||typeof k=="string"&&!f[k]&&E.setConstantValue(c[k])||E.needsUpdate()&&(b=!0,this._updateAttribute({attribute:E,numInstances:t,data:e,props:c,context:r})),this.needsRedraw=this.needsRedraw||E.needsRedraw()}b&&zo(vte,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(n=>{var s;return(s=this.attributes[n])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,s={...n.getAttributes()};for(const c in t){const f=t[c];f.needsRedraw(e)&&!n.hasAttribute(c)&&(s[c]=f)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const s=e[n],c={...s,id:n,size:s.isIndexed&&1||s.size||1,...t};this.attributes[n]=new Rz(this.device,c)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:s}=this,c=s[e];return c&&c.forEach(f=>{const r=n[f];r&&r.setNeedsUpdate(r.id,t)}),c}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(zo(xte,t),t.constant){t.setConstantValue(t.value);return}t.allocate(n)&&zo(wte,t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,zo(Ate,t,n))}}class Ste extends Tw{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:s,easing:c}}=this,f=c(e/s);this._value=w1(t,n,f)}}const ID=1e-5;function MD(i,e,t,n,s){const c=e-i,r=(t-e)*s,b=-c*n;return r+b+c+e}function Ete(i,e,t,n,s){if(Array.isArray(t)){const c=[];for(let f=0;f<t.length;f++)c[f]=MD(i[f],e[f],t[f],n,s);return c}return MD(i,e,t,n,s)}function RD(i,e){if(Array.isArray(i)){let t=0;for(let n=0;n<i.length;n++){const s=i[n]-e[n];t+=s*s}return Math.sqrt(t)}return Math.abs(i-e)}class Cte extends Tw{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:s}=this.settings,{_prevValue:c=e,_currValue:f=e}=this;let r=Ete(c,f,t,n,s);const b=RD(r,t),w=RD(r,f);b<ID&&w<ID&&(r=t,this.end()),this._prevValue=f,this._currValue=r}}const Ite={interpolation:Ste,spring:Cte};class Mte{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,s){const{transitions:c}=this;if(c.has(e)){const b=c.get(e),{value:w=b.settings.fromValue}=b;t=w,this.remove(e)}if(s=Mz(s),!s)return;const f=Ite[s.type];if(!f){gr.error(`unsupported transition type '${s.type}'`)();return}const r=new f(this.timeline);r.start({...s,fromValue:t,toValue:n}),c.set(e,r)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Rte(i){const e=i[pf];for(const t in e){const n=e[t],{validate:s}=n;if(s&&!s(i[t],n))throw new Error(`Invalid prop ${t}: ${i[t]}`)}}function kte(i,e){const t=zz({newProps:i,oldProps:e,propTypes:i[pf],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=Dte(i,e);let s=!1;return n||(s=Bte(i,e)),{dataChanged:n,propsChanged:t,updateTriggersChanged:s,extensionsChanged:Ote(i,e),transitionsChanged:Pte(i,e)}}function Pte(i,e){if(!i.transitions)return!1;const t={},n=i[pf];let s=!1;for(const c in i.transitions){const f=n[c],r=f&&f.type;(r==="number"||r==="color"||r==="array")&&tE(i[c],e[c],f)&&(t[c]=!0,s=!0)}return s?t:!1}function zz({newProps:i,oldProps:e,ignoreProps:t={},propTypes:n={},triggerName:s="props"}){if(e===i)return!1;if(typeof i!="object"||i===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const c of Object.keys(i))if(!(c in t)){if(!(c in e))return`${s}.${c} added`;const f=tE(i[c],e[c],n[c]);if(f)return`${s}.${c} ${f}`}for(const c of Object.keys(e))if(!(c in t)){if(!(c in i))return`${s}.${c} dropped`;if(!Object.hasOwnProperty.call(i,c)){const f=tE(i[c],e[c],n[c]);if(f)return`${s}.${c} ${f}`}}return!1}function tE(i,e,t){let n=t&&t.equal;return n&&!n(i,e,t)||!n&&(n=i&&e&&i.equals,n&&!n.call(i,e))?"changed deeply":!n&&e!==i?"changed shallowly":null}function Dte(i,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:n,_dataDiff:s}=i;return n?n(i.data,e.data)||(t="Data comparator detected a change"):i.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(i.data,e.data)||t),t}function Bte(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&kD(i,e,"all"))return{all:!0};const t={};let n=!1;for(const s in i.updateTriggers)s!=="all"&&kD(i,e,s)&&(t[s]=!0,n=!0);return n?t:!1}function Ote(i,e){if(e===null)return!0;const t=e.extensions,{extensions:n}=i;if(n===t)return!1;if(!t||!n||n.length!==t.length)return!0;for(let s=0;s<n.length;s++)if(!n[s].equals(t[s]))return!0;return!1}function kD(i,e,t){let n=i.updateTriggers[t];n=n??{};let s=e.updateTriggers[t];return s=s??{},zz({oldProps:s,newProps:n,triggerName:t})}const Fte="count(): argument not an object",Lte="count(): argument not a container";function zte(i){if(!Ute(i))throw new Error(Fte);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(Nte(i))return Object.keys(i).length;throw new Error(Lte)}function Nte(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function Ute(i){return i!==null&&typeof i=="object"}function PD(i,e){if(!e)return i;const t={...i,...e};if("defines"in e&&(t.defines={...i.defines,...e.defines}),"modules"in e&&(t.modules=(i.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=t.modules.findIndex(s=>s.name==="project32");n>=0&&t.modules.splice(n,1)}if("inject"in e)if(!i.inject)t.inject=e.inject;else{const n={...i.inject};for(const s in e.inject)n[s]=(n[s]||"")+e.inject[s];t.inject=n}return t}const Vte={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},iE={};function $te(i,e,t,n){if(t instanceof ns)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const c=e.createTexture({...t,sampler:{...Vte,...s,...n},mipmaps:!0});return iE[c.id]=i,c}function jte(i,e){!e||!(e instanceof ns)||iE[e.id]===i&&(e.delete(),delete iE[e.id])}const Hte={boolean:{validate(i,e){return!0},equal(i,e,t){return!!i==!!e}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||nE(i)&&(i.length===3||i.length===4)},equal(i,e,t){return Fl(i,e,1)}},accessor:{validate(i,e){const t=k1(i);return t==="function"||t===k1(e.value)},equal(i,e,t){return typeof e=="function"?!0:Fl(i,e,1)}},array:{validate(i,e){return e.optional&&!i||nE(i)},equal(i,e,t){const{compare:n}=t,s=Number.isInteger(n)?n:n?1:0;return n?Fl(i,e,s):i===e}},object:{equal(i,e,t){if(t.ignore)return!0;const{compare:n}=t,s=Number.isInteger(n)?n:n?1:0;return n?Fl(i,e,s):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,t){return!t.compare&&t.ignore!==!1||i===e}},data:{transform:(i,e,t)=>{if(!i)return i;const{dataTransform:n}=t.props;return n?n(i):typeof i.shape=="string"&&i.shape.endsWith("-table")&&Array.isArray(i.data)?i.data:i}},image:{transform:(i,e,t)=>{const n=t.context;return!n||!n.device?null:$te(t.id,n.device,i,{...e.parameters,...t.props.textureParameters})},release:(i,e,t)=>{jte(t.id,i)}}};function Wte(i){const e={},t={},n={};for(const[s,c]of Object.entries(i)){const f=c==null?void 0:c.deprecatedFor;if(f)n[s]=Array.isArray(f)?f:[f];else{const r=Gte(s,c);e[s]=r,t[s]=r.value}}return{propTypes:e,defaultProps:t,deprecatedProps:n}}function Gte(i,e){switch(k1(e)){case"object":return ty(i,e);case"array":return ty(i,{type:"array",value:e,compare:!1});case"boolean":return ty(i,{type:"boolean",value:e});case"number":return ty(i,{type:"number",value:e});case"function":return ty(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function ty(i,e){return"type"in e?{name:i,...Hte[e.type],...e}:"value"in e?{name:i,type:k1(e.value),...e}:{name:i,type:"object",value:e}}function nE(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function k1(i){return nE(i)?"array":i===null?"null":typeof i}function Xte(i,e){let t;for(let c=e.length-1;c>=0;c--){const f=e[c];"extensions"in f&&(t=f.extensions)}const n=rE(i.constructor,t),s=Object.create(n);s[M1]=i,s[Ef]={},s[ku]={};for(let c=0;c<e.length;++c){const f=e[c];for(const r in f)s[r]=f[r]}return Object.freeze(s),s}const qte="_mergedDefaultProps";function rE(i,e){if(!(i instanceof Sw.constructor))return{};let t=qte;if(e)for(const s of e){const c=s.constructor;c&&(t+=`:${c.extensionName||c.name}`)}const n=Nz(i,t);return n||(i[t]=Yte(i,e||[]))}function Yte(i,e){if(!i.prototype)return null;const n=Object.getPrototypeOf(i),s=rE(n),c=Nz(i,"defaultProps")||{},f=Wte(c),r=Object.assign(Object.create(null),s,f.defaultProps),b=Object.assign(Object.create(null),s==null?void 0:s[pf],f.propTypes),w=Object.assign(Object.create(null),s==null?void 0:s[b2],f.deprecatedProps);for(const E of e){const k=rE(E.constructor);k&&(Object.assign(r,k),Object.assign(b,k[pf]),Object.assign(w,k[b2]))}return Zte(r,i),Jte(r,b),Kte(r,w),r[pf]=b,r[b2]=w,e.length===0&&!IC(i,"_propTypes")&&(i._propTypes=b),r}function Zte(i,e){const t=eie(e);Object.defineProperties(i,{id:{writable:!0,value:t}})}function Kte(i,e){for(const t in e)Object.defineProperty(i,t,{enumerable:!1,set(n){const s=`${this.id}: ${t}`;for(const c of e[t])IC(this,c)||(this[c]=n);gr.deprecated(s,e[t].join("/"))()}})}function Jte(i,e){const t={},n={};for(const s in e){const c=e[s],{name:f,value:r}=c;c.async&&(t[f]=r,n[f]=Qte(f))}i[Am]=t,i[Ef]={},Object.defineProperties(i,n)}function Qte(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Iz(e)?this[Ef][i]=e:this[ku][i]=e},get(){if(this[ku]){if(i in this[ku])return this[ku][i]||this[Am][i];if(i in this[Ef]){const e=this[M1]&&this[M1].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[Am][i]}}return this[Am][i]}}}function IC(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function Nz(i,e){return IC(i,e)&&i[e]}function eie(i){const e=i.componentName;return e||gr.warn(`${i.name}.componentName not specified`)(),e||i.name}let tie=0;class Sw{constructor(...e){this.props=Xte(this,e),this.id=this.props.id,this.count=tie++}clone(e){const{props:t}=this,n={};for(const s in t[Am])s in t[ku]?n[s]=t[ku][s]:s in t[Ef]&&(n[s]=t[Ef][s]);return new this.constructor({...t,...n,...e})}}Sw.componentName="Component";Sw.defaultProps={};const iie=Object.freeze({});class nie{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||iie}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[M1]||this.component;const t=e[ku]||{},n=e[Ef]||e,s=e[Am]||{};for(const c in t){const f=t[c];this._createAsyncPropData(c,s[c]),this._updateAsyncProp(c,f),t[c]=this.getAsyncProp(c)}for(const c in n){const f=n[c];this._createAsyncPropData(c,s[c]),this._updateAsyncProp(c,f)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(Iz(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t===n.resolvedValue||t===n.lastValue?!1:(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const s=this.asyncProps[e];s&&n>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const s=n.pendingLoadCount;t.then(c=>{this.component&&(c=this._postProcessValue(n,c),this._setAsyncPropValue(e,c,s),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const s=n.pendingLoadCount;let c=[],f=0;for await(const r of t){if(!this.component)return;const{dataTransform:b}=this.component.props;b?c=b(r,c):c=c.concat(r),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:f,endRow:c.length}]}),f=c.length,this._setAsyncPropValue(e,c,s)}this._onResolve(e,c)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[pf];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class rie extends nie{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,s=n==null?void 0:n.props.fetch;return s?s(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const s=n.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const sie="layer.changeFlag",oie="layer.initialize",aie="layer.update",lie="layer.finalize",cie="layer.matched",DD=2**24-1,hie=Object.freeze([]),uie=M0(({oldViewport:i,viewport:e})=>i.equals(e));let kl=new Uint8ClampedArray(0);const die={data:{type:"data",value:hie,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,{propName:e,layer:t,loaders:n,loadOptions:s,signal:c})=>{const{resourceManager:f}=t.context;s=s||t.getLoadOptions(),n=n||t.props.loaders,c&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:c}});let r=f.contains(i);return!r&&!s&&(f.add({resourceId:i,data:gS(i,n),persistent:!1}),r=!0),r?f.subscribe({resourceId:i,onChange:b=>{var w;return(w=t.internalState)==null?void 0:w.reloadAsyncProp(e,b)},consumerId:t.id,requestId:e}):gS(i,n,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Qn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:i})=>[0,-i*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class MC extends Sw{constructor(){super(...arguments),this.internalState=null,this.lifecycle=hm.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Fs(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=tz(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,c,f]=KL(n,t.pixelProjectionMatrix);return e.length===2?[s,c]:[s,c,f]}unproject(e){return Fs(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Fs(this.internalState);const n=this.internalState.viewport||this.context.viewport;return $K(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Qn.DEFAULT||e===Qn.LNGLAT||e===Qn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Fs(e instanceof Uint8Array);const[t,n,s]=e;return t+n*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:zte(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=PD(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=PD(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const s of n)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,c=this.internalState.hasPickingBuffer,f=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(r=>r.getNeedsPickingBuffer.call(this,r));if(c!==f){this.internalState.hasPickingBuffer=f;const{pickingColors:r,instancePickingColors:b}=t.attributes,w=r||b;w&&(f&&w.constant&&(w.constant=!1,t.invalidate(w.id)),!w.value&&!f&&(w.constant=!0,w.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){var n,s,c,f;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(s=(n=this.props).onError)!=null&&s.call(n,e)||(f=(c=this.context)==null?void 0:c.onError)==null||f.call(c,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!uie({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const s in t)Object.defineProperty(n,s,{value:t[s]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(kl.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>DD&&gr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),kl=t0.allocate(kl,t,{size:4,copy:!0,maxCount:Math.max(t,DD)});const s=Math.floor(kl.length/4),c=[0,0,0];for(let f=n;f<s;f++)this.encodePickingColor(f,c),kl[f*4+0]=c[0],kl[f*4+1]=c[1],kl[f*4+2]=c[2],kl[f*4+3]=0}e.value=kl.subarray(0,t*4)}_setModelAttributes(e,t,n=!1){var r;if(!Object.keys(t).length)return;if(n){const b=this.getAttributeManager();e.setBufferLayout(b.getBufferLayouts(e)),t=b.getAttributes()}const s=((r=e.userData)==null?void 0:r.excludeAttributes)||{},c={},f={};for(const b in t){if(s[b])continue;const w=t[b].getValue();for(const E in w){const k=w[E];k instanceof Hr?t[b].settings.isIndexed?e.setIndexBuffer(k):c[E]=k:k&&(f[E]=k)}}e.setAttributes(c),e.setConstantAttributes(f)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:s}=this.getAttributeManager().attributes,c=n||s,f=c&&t.attributes&&t.attributes[c.id];if(f&&f.value){const r=f.value,b=this.encodePickingColor(e);for(let w=0;w<t.length;w++){const E=c.getVertexOffset(w);r[E]===b[0]&&r[E+1]===b[1]&&r[E+2]===b[2]&&this._disablePickingIndex(w)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,s=t||n;if(!s)return;const c=s.getVertexOffset(e),f=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(f-c),c)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==kl.buffer&&(n.value=kl.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Fs(!this.internalState),Fs(Number.isFinite(this.props.coordinateSystem)),zo(oie,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new rie({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(gr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Mte(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){zo(cie,this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(zo(aie,this,e),!e)return;const t=this.props,n=this.context,s=this.internalState,c=n.viewport,f=this._updateUniformTransition();s.propsInTransition=f,n.viewport=s.viewport||c,this.props=f;try{const r=this._getUpdateParams(),b=this.getModels();if(n.device)this.updateState(r);else try{this.updateState(r)}catch{}for(const E of this.props.extensions)E.updateState.call(this,r,E);this.setNeedsRedraw(),this._updateAttributes();const w=this.getModels()[0]!==b[0];this._postUpdate(r,w)}finally{n.viewport=c,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){zo(lie,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:n={},parameters:s={}}){this._updateAttributeTransition();const c=this.props,f=this.context;this.props=this.internalState.propsInTransition||c;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:r}=this.props,b=r&&r(n)||[0,0];f.device instanceof ym&&f.device.setParametersWebGL({polygonOffset:b});for(const w of this.getModels())w.device.type==="webgpu"?w.setParameters({...w.parameters,...s}):w.setParameters(s);if(f.device instanceof ym)f.device.withParametersWebGL(s,()=>{const w={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:s,context:f};for(const E of this.props.extensions)E.draw.call(this,w,E);this.draw(w)});else{const w={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:s,context:f};for(const E of this.props.extensions)E.draw.call(this,w,E);this.draw(w)}}finally{this.props=c}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let c=!1;switch(s){case"dataChanged":const f=e[s],r=t[s];f&&Array.isArray(r)&&(t.dataChanged=Array.isArray(f)?r.concat(f):f,c=!0);default:t[s]||(t[s]=e[s],c=!0)}c&&zo(sie,this,s,e)}const n=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var s;const n=kte(e,t);if(n.updateTriggersChanged)for(const c in n.updateTriggersChanged)n.updateTriggersChanged[c]&&this.invalidateAttribute(c);if(n.transitionsChanged)for(const c in n.transitionsChanged)this.internalState.uniformTransitions.add(c,t[c],e[c],(s=e.transitions)==null?void 0:s[c]);return this.setChangeFlags(n)}validateProps(){Rte(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Tte(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:s}=e,c=this.state.model;c!=null&&c.isInstanced&&c.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:r,highlightColor:b}=n;if(t||s.autoHighlight!==f||s.highlightedObjectIndex!==r||s.highlightColor!==b){const w={};Array.isArray(b)&&(w.highlightColor=b),(t||s.autoHighlight!==f||r!==s.highlightedObjectIndex)&&(w.highlightedObjectColor=Number.isFinite(r)&&r>=0?this.encodePickingColor(r):null),this.setShaderModuleProps({picking:w})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),s=n?n.getNeedsRedraw(e):!1;if(t=t||s,t)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}MC.defaultProps=die;MC.layerName="Layer";const rx=Math.PI/180,BD=180/Math.PI,jx=6370972,bm=256;function fie(){const i=bm/jx,e=Math.PI/180*bm;return{unitsPerMeter:[i,i,i],unitsPerMeter2:[0,0,0],metersPerUnit:[1/i,1/i,1/i],unitsPerDegree:[e,e,i],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/i]}}class pie extends Jm{constructor(e={}){const{longitude:t=0,zoom:n=0,nearZMultiplier:s=.5,farZMultiplier:c=1,resolution:f=10}=e;let{latitude:r=0,height:b,altitude:w=1.5,fovy:E}=e;r=Math.max(Math.min(r,C1),-85.051129),b=b||1,E?w=yC(E):E=e0(w);const k=1/Math.PI/Math.cos(r*Math.PI/180),F=Math.pow(2,n)*k,$=e.nearZ??s,X=e.farZ??(w+bm*2*F/b)*c,W=new co().lookAt({eye:[0,-w,0],up:[0,0,1]});W.rotateX(r*rx),W.rotateZ(-t*rx),W.scale(F/b),super({...e,height:b,viewMatrix:W,longitude:t,latitude:r,zoom:n,distanceScales:fie(),fovy:E,focalDistance:w,near:$,far:X}),this.scale=F,this.latitude=r,this.longitude=t,this.resolution=f}get projectionMode(){return Ba.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),c=this.unproject([this.width,this.height/2],t),f=this.unproject([this.width/2,this.height],t);return c[0]<this.longitude&&(c[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],c[0],s[0],f[0]),Math.min(n[1],c[1],s[1],f[1]),Math.max(n[0],c[0],s[0],f[0]),Math.max(n[1],c[1],s[1],f[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[s,c,f]=e,r=t?c:this.height-c,{pixelUnprojectionMatrix:b}=this;let w;if(Number.isFinite(f))w=S2(b,[s,r,f,1]);else{const $=S2(b,[s,r,-1,1]),X=S2(b,[s,r,1,1]),W=((n||0)/jx+1)*bm,ne=l2(CL([],$,X)),_e=l2($),Te=l2(X),Ee=4*((4*_e*Te-(ne-_e-Te)**2)/16)/ne,Le=Math.sqrt(_e-Ee),Je=Math.sqrt(Math.max(0,W*W-Ee)),Tt=(Le-Je)/Math.sqrt(ne);w=nq([],$,X,Tt)}const[E,k,F]=this.unprojectPosition(w);return Number.isFinite(f)?[E,k,F]:Number.isFinite(n)?[E,k,n]:[E,k]}projectPosition(e){const[t,n,s=0]=e,c=t*rx,f=n*rx,r=Math.cos(f),b=(s/jx+1)*bm;return[Math.sin(c)*r*b,-Math.cos(c)*r*b,Math.sin(f)*b]}unprojectPosition(e){const[t,n,s]=e,c=IL(e),f=Math.asin(s/c),b=Math.atan2(t,-n)*BD,w=f*BD,E=(c/bm-1)*jx;return[b,w,E]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function S2(i,e){const t=Km([],e,i);return mC(t,t,1/t[3]),t}class mie extends hz{applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:s}=e;e.zoom=Ic(s,n,t);const{longitude:c,latitude:f}=e;return(c<-180||c>180)&&(e.longitude=PK(c+180,360)-180),e.latitude=Ic(f,-85.051129,C1),e}}class gie extends cz{constructor(){super(...arguments),this.ControllerState=mie,this.transition={transitionDuration:300,transitionInterpolator:new xC(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class Uz extends lz{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?Sf:pie}get ControllerType(){return gie}}Uz.displayName="GlobeView";const E2=512,_ie=Math.PI/180;function Vz({map:i,gl:e,deck:t}){if(i.__deck)return i.__deck;const n=t==null?void 0:t.props._customRender,s=t==null?void 0:t.props.onLoad,c={...t==null?void 0:t.props,_customRender:()=>{i.triggerRepaint(),n==null||n("")}};c.parameters={...sE(i,!0),...c.parameters},c.views||(c.views=P1(i));let f;return(!t||t.props.gl===e)&&(Object.assign(c,{gl:e,width:null,height:null,touchAction:"unset",viewState:o0(i)}),t!=null&&t.isInitialized?OD(t,i):c.onLoad=()=>{s==null||s(),OD(f,i)}),t?(f=t,t.setProps(c),t.userData.isExternal=!0):(f=new s0(c),i.on("remove",()=>{$z(i)})),f.userData.mapboxLayers=new Set,i.__deck=f,i.on("render",()=>{f.isInitialized&&Aie(f,i)}),f}function OD(i,e){const t=()=>{i.isInitialized?Tie(i,e):e.off("move",t)};e.on("move",t)}function $z(i){var e;(e=i.__deck)==null||e.finalize(),i.__deck=null}function sE(i,e){const t=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return jz(i)==="globe"&&(t.cullMode="back"),t}function yie(i,e){i.userData.mapboxLayers.add(e),RC(i)}function bie(i,e){i.userData.mapboxLayers.delete(e),RC(i)}function vie(i,e){RC(i)}function xie(i,e,t,n){let{currentViewport:s}=i.userData,c=!1;s||(s=Hz(i,e,n),i.userData.currentViewport=s,c=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:({layer:f})=>t.id===f.id||f.props.operation.includes("terrain"),clearStack:c,clearCanvas:!1})}function jz(i){var n;const e=(n=i.getProjection)==null?void 0:n.call(i),t=(e==null?void 0:e.type)||(e==null?void 0:e.name);if(t==="globe")return"globe";if(t&&t!=="mercator")throw new Error("Unsupported projection");return"mercator"}function P1(i){return jz(i)==="globe"?new Uz({id:"mapbox"}):new wC({id:"mapbox"})}function o0(i){var s;const{lng:e,lat:t}=i.getCenter(),n={longitude:(e+540)%360-180,latitude:t,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(s=i.getTerrain)!=null&&s.call(i)&&wie(i,n),n}function wie(i,e){if(i.getFreeCameraOptions){const{position:t}=i.getFreeCameraOptions();if(!t||t.z===void 0)return;const n=i.transform.height,{longitude:s,latitude:c,pitch:f}=e,r=t.x*E2,b=(1-t.y)*E2,w=t.z*E2,E=Qy([s,c]),k=r-E[0],F=b-E[1],$=Math.sqrt(k*k+F*F),X=f*_ie,W=1.5*n,ne=X<.001?W*Math.cos(X)/w:W*Math.sin(X)/$;e.zoom=Math.log2(ne);const _e=W*Math.cos(X)/ne,Te=w-_e;e.position=[0,0,Te/Vx(c)]}else typeof i.transform.elevation=="number"&&(e.position=[0,0,i.transform.elevation])}function Hz(i,e,t){const n=o0(e),s=P1(e);t&&(s.props.nearZMultiplier=.2);const c=(t==null?void 0:t.nearZ)??e.transform._nearZ,f=(t==null?void 0:t.farZ)??e.transform._farZ;return Number.isFinite(c)&&(n.nearZ=c/e.transform.height,n.farZ=f/e.transform.height),s.makeViewport({width:i.width,height:i.height,viewState:n})}function Aie(i,e){const{mapboxLayers:t,isExternal:n}=i.userData;if(n){const s=Array.from(t,E=>E.id),f=r0(i.props.layers,Boolean).some(E=>E&&!s.includes(E.id));let r=i.getViewports();const b=r.findIndex(E=>E.id==="mapbox"),w=r.length>1||b<0;(f||w)&&(b>=0&&(r=r.slice(),r[b]=Hz(i,e)),i._drawLayers("mapbox-repaint",{viewports:r,layerFilter:E=>(!i.props.layerFilter||i.props.layerFilter(E))&&(E.viewport.id!=="mapbox"||!s.includes(E.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function Tie(i,e){i.setProps({viewState:o0(e)}),i.needsRedraw({clearRedrawFlags:!0})}function RC(i){if(i.userData.isExternal)return;const e=[];i.userData.mapboxLayers.forEach(t=>{const n=t.props.type,s=new n(t.props);e.push(s)}),i.setProps({layers:e})}class Sie{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=Vz({map:e,gl:t,deck:this.props.deck}),yie(this.deck,this)}onRemove(){this.deck&&bie(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&vie(this.deck)}render(e,t){xie(this.deck,this.map,this,t)}}const C2="__UNDEFINED__";function sx(i,e,t,n){if(!i||!e||!i.style||!i.style._loaded)return;const s=r0(n,Boolean);if(t!==n){const r=r0(t,Boolean),b=new Set(r.map(w=>w.id));for(const w of s)b.delete(w.id);for(const w of b)i.getLayer(w)&&i.removeLayer(w)}for(const r of s){const b=i.getLayer(r.id);b?(b.implementation||b).setProps(r.props):i.addLayer(new Sie({id:r.id,deck:e,slot:r.props.slot}),r.props.beforeId)}const c=i.style._order,f={};for(const r of s){let{beforeId:b}=r.props;(!b||!c.includes(b))&&(b=C2),f[b]=f[b]||[],f[b].push(r.id)}for(const r in f){const b=f[r];let w=r===C2?c.length:c.indexOf(r),E=r===C2?void 0:r;for(let k=b.length-1;k>=0;k--){const F=b[k],$=c.indexOf(F);$!==w-1&&(i.moveLayer(F,E),$>w&&w++),w--,E=F}}}class Eie{constructor(e){this._handleStyleChange=()=>{sx(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:s,clientHeight:c}=this._map.getContainer();Object.assign(this._container.style,{width:`${s}px`,height:`${c}px`})}},this._updateViewState=()=>{const s=this._deck,c=this._map;s&&c&&(s.setProps({views:this._props.views||P1(c),viewState:o0(c)}),s.isInitialized&&s.redraw())},this._handleMouseEvent=s=>{const c=this._deck;if(!c||!c.isInitialized)return;const f={type:s.type,offsetCenter:s.point,srcEvent:s},r=this._lastMouseDownPoint;switch(!s.point&&r&&(f.deltaX=s.originalEvent.clientX-r.clientX,f.deltaY=s.originalEvent.clientY-r.clientY,f.offsetCenter={x:r.x+f.deltaX,y:r.y+f.deltaY}),f.type){case"mousedown":c._onPointerDown(f),this._lastMouseDownPoint={...s.point,clientX:s.originalEvent.clientX,clientY:s.originalEvent.clientY};break;case"dragstart":f.type="panstart",c._onEvent(f);break;case"drag":f.type="panmove",c._onEvent(f);break;case"dragend":f.type="panend",c._onEvent(f);break;case"click":f.tapCount=1,c._onEvent(f);break;case"dblclick":f.type="click",f.tapCount=2,c._onEvent(f);break;case"mousemove":f.type="pointermove",c._onPointerMove(f);break;case"mouseout":f.type="pointerleave",c._onPointerMove(f);break;default:return}};const{interleaved:t=!1,...n}=e;this._interleaved=t,this._props=n}setProps(e){this._interleaved&&e.layers&&sx(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...sE(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new s0({...this._props,parent:t,parameters:{...sE(e,!1),...this._props.parameters},views:this._props.views||P1(e),viewState:o0(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&gr.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=Vz({map:e,gl:t,deck:new s0({...this._props,gl:t})}),e.on("styledata",this._handleStyleChange),sx(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var t;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(t=this._deck)==null||t.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),sx(e,this._deck,this._props.layers,[]),$z(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Fs(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Fs(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Fs(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}var oE=function(i,e){return oE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])},oE(i,e)};function Ih(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");oE(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Cie(i,e,t,n){function s(c){return c instanceof t?c:new t(function(f){f(c)})}return new(t||(t=Promise))(function(c,f){function r(E){try{w(n.next(E))}catch(k){f(k)}}function b(E){try{w(n.throw(E))}catch(k){f(k)}}function w(E){E.done?c(E.value):s(E.value).then(r,b)}w((n=n.apply(i,e||[])).next())})}function Wz(i,e){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,f=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return f.next=r(0),f.throw=r(1),f.return=r(2),typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function r(w){return function(E){return b([w,E])}}function b(w){if(n)throw new TypeError("Generator is already executing.");for(;f&&(f=0,w[0]&&(t=0)),t;)try{if(n=1,s&&(c=w[0]&2?s.return:w[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,w[1])).done)return c;switch(s=0,c&&(w=[w[0]&2,c.value]),w[0]){case 0:case 1:c=w;break;case 4:return t.label++,{value:w[1],done:!1};case 5:t.label++,s=w[1],w=[0];continue;case 7:w=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(w[0]===6||w[0]===2)){t=0;continue}if(w[0]===3&&(!c||w[1]>c[0]&&w[1]<c[3])){t.label=w[1];break}if(w[0]===6&&t.label<c[1]){t.label=c[1],c=w;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(w);break}c[2]&&t.ops.pop(),t.trys.pop();continue}w=e.call(i,t)}catch(E){w=[6,E],s=0}finally{n=c=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}}function Lm(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function D1(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var n=t.call(i),s,c=[],f;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(r){f={error:r}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return c}function B1(i,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,c;n<s;n++)(c||!(n in e))&&(c||(c=Array.prototype.slice.call(e,0,n)),c[n]=e[n]);return i.concat(c||Array.prototype.slice.call(e))}function Tm(i){return this instanceof Tm?(this.v=i,this):new Tm(i)}function Iie(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),s,c=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),r("next"),r("throw"),r("return",f),s[Symbol.asyncIterator]=function(){return this},s;function f($){return function(X){return Promise.resolve(X).then($,k)}}function r($,X){n[$]&&(s[$]=function(W){return new Promise(function(ne,_e){c.push([$,W,ne,_e])>1||b($,W)})},X&&(s[$]=X(s[$])))}function b($,X){try{w(n[$](X))}catch(W){F(c[0][3],W)}}function w($){$.value instanceof Tm?Promise.resolve($.value.v).then(E,k):F(c[0][2],$)}function E($){b("next",$)}function k($){b("throw",$)}function F($,X){$(X),c.shift(),c.length&&b(c[0][0],c[0][1])}}function Mie(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof Lm=="function"?Lm(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=i[c]&&function(f){return new Promise(function(r,b){f=i[c](f),s(r,b,f.done,f.value)})}}function s(c,f,r,b){Promise.resolve(b).then(function(w){c({value:w,done:r})},f)}}function Cs(i){return typeof i=="function"}function Gz(i){var e=function(n){Error.call(n),n.stack=new Error().stack},t=i(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var I2=Gz(function(i){return function(t){i(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,s){return s+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function O1(i,e){if(i){var t=i.indexOf(e);0<=t&&i.splice(t,1)}}var k0=function(){function i(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return i.prototype.unsubscribe=function(){var e,t,n,s,c;if(!this.closed){this.closed=!0;var f=this._parentage;if(f)if(this._parentage=null,Array.isArray(f))try{for(var r=Lm(f),b=r.next();!b.done;b=r.next()){var w=b.value;w.remove(this)}}catch(W){e={error:W}}finally{try{b&&!b.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}else f.remove(this);var E=this.initialTeardown;if(Cs(E))try{E()}catch(W){c=W instanceof I2?W.errors:[W]}var k=this._finalizers;if(k){this._finalizers=null;try{for(var F=Lm(k),$=F.next();!$.done;$=F.next()){var X=$.value;try{FD(X)}catch(W){c=c??[],W instanceof I2?c=B1(B1([],D1(c)),D1(W.errors)):c.push(W)}}}catch(W){n={error:W}}finally{try{$&&!$.done&&(s=F.return)&&s.call(F)}finally{if(n)throw n.error}}}if(c)throw new I2(c)}},i.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)FD(e);else{if(e instanceof i){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},i.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},i.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},i.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&O1(t,e)},i.prototype.remove=function(e){var t=this._finalizers;t&&O1(t,e),e instanceof i&&e._removeParent(this)},i.EMPTY=function(){var e=new i;return e.closed=!0,e}(),i}(),Xz=k0.EMPTY;function qz(i){return i instanceof k0||i&&"closed"in i&&Cs(i.remove)&&Cs(i.add)&&Cs(i.unsubscribe)}function FD(i){Cs(i)?i():i.unsubscribe()}var Rie={Promise:void 0},kie={setTimeout:function(i,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];return setTimeout.apply(void 0,B1([i,e],D1(t)))},clearTimeout:function(i){return clearTimeout(i)},delegate:void 0};function Yz(i){kie.setTimeout(function(){throw i})}function aE(){}function Hx(i){i()}var kC=function(i){Ih(e,i);function e(t){var n=i.call(this)||this;return n.isStopped=!1,t?(n.destination=t,qz(t)&&t.add(n)):n.destination=Bie,n}return e.create=function(t,n,s){return new lE(t,n,s)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,i.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(k0),Pie=function(){function i(e){this.partialObserver=e}return i.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){ox(n)}},i.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){ox(n)}else ox(e)},i.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){ox(t)}},i}(),lE=function(i){Ih(e,i);function e(t,n,s){var c=i.call(this)||this,f;return Cs(t)||!t?f={next:t??void 0,error:n??void 0,complete:s??void 0}:f=t,c.destination=new Pie(f),c}return e}(kC);function ox(i){Yz(i)}function Die(i){throw i}var Bie={closed:!0,next:aE,error:Die,complete:aE},PC=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function P0(i){return i}function Oie(i){return i.length===0?P0:i.length===1?i[0]:function(t){return i.reduce(function(n,s){return s(n)},t)}}var sa=function(){function i(e){e&&(this._subscribe=e)}return i.prototype.lift=function(e){var t=new i;return t.source=this,t.operator=e,t},i.prototype.subscribe=function(e,t,n){var s=this,c=Lie(e)?e:new lE(e,t,n);return Hx(function(){var f=s,r=f.operator,b=f.source;c.add(r?r.call(c,b):b?s._subscribe(c):s._trySubscribe(c))}),c},i.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},i.prototype.forEach=function(e,t){var n=this;return t=LD(t),new t(function(s,c){var f=new lE({next:function(r){try{e(r)}catch(b){c(b),f.unsubscribe()}},error:c,complete:s});n.subscribe(f)})},i.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},i.prototype[PC]=function(){return this},i.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Oie(e)(this)},i.prototype.toPromise=function(e){var t=this;return e=LD(e),new e(function(n,s){var c;t.subscribe(function(f){return c=f},function(f){return s(f)},function(){return n(c)})})},i.create=function(e){return new i(e)},i}();function LD(i){var e;return(e=i??Rie.Promise)!==null&&e!==void 0?e:Promise}function Fie(i){return i&&Cs(i.next)&&Cs(i.error)&&Cs(i.complete)}function Lie(i){return i&&i instanceof kC||Fie(i)&&qz(i)}function zie(i){return Cs(i==null?void 0:i.lift)}function oa(i){return function(e){if(zie(e))return e.lift(function(t){try{return i(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function ho(i,e,t,n,s){return new Nie(i,e,t,n,s)}var Nie=function(i){Ih(e,i);function e(t,n,s,c,f,r){var b=i.call(this,t)||this;return b.onFinalize=f,b.shouldUnsubscribe=r,b._next=n?function(w){try{n(w)}catch(E){t.error(E)}}:i.prototype._next,b._error=c?function(w){try{c(w)}catch(E){t.error(E)}finally{this.unsubscribe()}}:i.prototype._error,b._complete=s?function(){try{s()}catch(w){t.error(w)}finally{this.unsubscribe()}}:i.prototype._complete,b}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;i.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(kC),Uie=Gz(function(i){return function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),zm=function(i){Ih(e,i);function e(){var t=i.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new zD(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new Uie},e.prototype.next=function(t){var n=this;Hx(function(){var s,c;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var f=Lm(n.currentObservers),r=f.next();!r.done;r=f.next()){var b=r.value;b.next(t)}}catch(w){s={error:w}}finally{try{r&&!r.done&&(c=f.return)&&c.call(f)}finally{if(s)throw s.error}}}})},e.prototype.error=function(t){var n=this;Hx(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var s=n.observers;s.length;)s.shift().error(t)}})},e.prototype.complete=function(){var t=this;Hx(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),i.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,s=this,c=s.hasError,f=s.isStopped,r=s.observers;return c||f?Xz:(this.currentObservers=null,r.push(t),new k0(function(){n.currentObservers=null,O1(r,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,s=n.hasError,c=n.thrownError,f=n.isStopped;s?t.error(c):f&&t.complete()},e.prototype.asObservable=function(){var t=new sa;return t.source=this,t},e.create=function(t,n){return new zD(t,n)},e}(sa),zD=function(i){Ih(e,i);function e(t,n){var s=i.call(this)||this;return s.destination=t,s.source=n,s}return e.prototype.next=function(t){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.next)===null||s===void 0||s.call(n,t)},e.prototype.error=function(t){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.error)===null||s===void 0||s.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,s;return(s=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&s!==void 0?s:Xz},e}(zm),Vie=function(i){Ih(e,i);function e(t){var n=i.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=i.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,s=t.thrownError,c=t._value;if(n)throw s;return this._throwIfClosed(),c},e.prototype.next=function(t){i.prototype.next.call(this,this._value=t)},e}(zm),$ie={now:function(){return Date.now()}},jie=function(i){Ih(e,i);function e(t,n){return i.call(this)||this}return e.prototype.schedule=function(t,n){return this},e}(k0),ND={setInterval:function(i,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];return setInterval.apply(void 0,B1([i,e],D1(t)))},clearInterval:function(i){return clearInterval(i)},delegate:void 0},Hie=function(i){Ih(e,i);function e(t,n){var s=i.call(this,t,n)||this;return s.scheduler=t,s.work=n,s.pending=!1,s}return e.prototype.schedule=function(t,n){var s;if(n===void 0&&(n=0),this.closed)return this;this.state=t;var c=this.id,f=this.scheduler;return c!=null&&(this.id=this.recycleAsyncId(f,c,n)),this.pending=!0,this.delay=n,this.id=(s=this.id)!==null&&s!==void 0?s:this.requestAsyncId(f,this.id,n),this},e.prototype.requestAsyncId=function(t,n,s){return s===void 0&&(s=0),ND.setInterval(t.flush.bind(t,this),s)},e.prototype.recycleAsyncId=function(t,n,s){if(s===void 0&&(s=0),s!=null&&this.delay===s&&this.pending===!1)return n;n!=null&&ND.clearInterval(n)},e.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var s=this._execute(t,n);if(s)return s;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,n){var s=!1,c;try{this.work(t)}catch(f){s=!0,c=f||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),c},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,n=t.id,s=t.scheduler,c=s.actions;this.work=this.state=this.scheduler=null,this.pending=!1,O1(c,this),n!=null&&(this.id=this.recycleAsyncId(s,n,null)),this.delay=null,i.prototype.unsubscribe.call(this)}},e}(jie),UD=function(){function i(e,t){t===void 0&&(t=i.now),this.schedulerActionCtor=e,this.now=t}return i.prototype.schedule=function(e,t,n){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},i.now=$ie.now,i}(),Wie=function(i){Ih(e,i);function e(t,n){n===void 0&&(n=UD.now);var s=i.call(this,t,n)||this;return s.actions=[],s._active=!1,s}return e.prototype.flush=function(t){var n=this.actions;if(this._active){n.push(t);return}var s;this._active=!0;do if(s=t.execute(t.state,t.delay))break;while(t=n.shift());if(this._active=!1,s){for(;t=n.shift();)t.unsubscribe();throw s}},e}(UD),DC=new Wie(Hie),Gie=DC,Zz=new sa(function(i){return i.complete()});function Kz(i){return i&&Cs(i.schedule)}function Xie(i){return i[i.length-1]}function qie(i){return Kz(Xie(i))?i.pop():void 0}var Jz=function(i){return i&&typeof i.length=="number"&&typeof i!="function"};function Qz(i){return Cs(i==null?void 0:i.then)}function e4(i){return Cs(i[PC])}function t4(i){return Symbol.asyncIterator&&Cs(i==null?void 0:i[Symbol.asyncIterator])}function i4(i){return new TypeError("You provided "+(i!==null&&typeof i=="object"?"an invalid object":"'"+i+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Yie(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var n4=Yie();function r4(i){return Cs(i==null?void 0:i[n4])}function s4(i){return Iie(this,arguments,function(){var t,n,s,c;return Wz(this,function(f){switch(f.label){case 0:t=i.getReader(),f.label=1;case 1:f.trys.push([1,,9,10]),f.label=2;case 2:return[4,Tm(t.read())];case 3:return n=f.sent(),s=n.value,c=n.done,c?[4,Tm(void 0)]:[3,5];case 4:return[2,f.sent()];case 5:return[4,Tm(s)];case 6:return[4,f.sent()];case 7:return f.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function o4(i){return Cs(i==null?void 0:i.getReader)}function pl(i){if(i instanceof sa)return i;if(i!=null){if(e4(i))return Zie(i);if(Jz(i))return Kie(i);if(Qz(i))return Jie(i);if(t4(i))return a4(i);if(r4(i))return Qie(i);if(o4(i))return ene(i)}throw i4(i)}function Zie(i){return new sa(function(e){var t=i[PC]();if(Cs(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Kie(i){return new sa(function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()})}function Jie(i){return new sa(function(e){i.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Yz)})}function Qie(i){return new sa(function(e){var t,n;try{for(var s=Lm(i),c=s.next();!c.done;c=s.next()){var f=c.value;if(e.next(f),e.closed)return}}catch(r){t={error:r}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}e.complete()})}function a4(i){return new sa(function(e){tne(i,e).catch(function(t){return e.error(t)})})}function ene(i){return a4(s4(i))}function tne(i,e){var t,n,s,c;return Cie(this,void 0,void 0,function(){var f,r;return Wz(this,function(b){switch(b.label){case 0:b.trys.push([0,5,6,11]),t=Mie(i),b.label=1;case 1:return[4,t.next()];case 2:if(n=b.sent(),!!n.done)return[3,4];if(f=n.value,e.next(f),e.closed)return[2];b.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return r=b.sent(),s={error:r},[3,11];case 6:return b.trys.push([6,,9,10]),n&&!n.done&&(c=t.return)?[4,c.call(t)]:[3,8];case 7:b.sent(),b.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function _f(i,e,t,n,s){n===void 0&&(n=0),s===void 0&&(s=!1);var c=e.schedule(function(){t(),s?i.add(this.schedule(null,n)):this.unsubscribe()},n);if(i.add(c),!s)return c}function l4(i,e){return e===void 0&&(e=0),oa(function(t,n){t.subscribe(ho(n,function(s){return _f(n,i,function(){return n.next(s)},e)},function(){return _f(n,i,function(){return n.complete()},e)},function(s){return _f(n,i,function(){return n.error(s)},e)}))})}function c4(i,e){return e===void 0&&(e=0),oa(function(t,n){n.add(i.schedule(function(){return t.subscribe(n)},e))})}function ine(i,e){return pl(i).pipe(c4(e),l4(e))}function nne(i,e){return pl(i).pipe(c4(e),l4(e))}function rne(i,e){return new sa(function(t){var n=0;return e.schedule(function(){n===i.length?t.complete():(t.next(i[n++]),t.closed||this.schedule())})})}function sne(i,e){return new sa(function(t){var n;return _f(t,e,function(){n=i[n4](),_f(t,e,function(){var s,c,f;try{s=n.next(),c=s.value,f=s.done}catch(r){t.error(r);return}f?t.complete():t.next(c)},0,!0)}),function(){return Cs(n==null?void 0:n.return)&&n.return()}})}function h4(i,e){if(!i)throw new Error("Iterable cannot be null");return new sa(function(t){_f(t,e,function(){var n=i[Symbol.asyncIterator]();_f(t,e,function(){n.next().then(function(s){s.done?t.complete():t.next(s.value)})},0,!0)})})}function one(i,e){return h4(s4(i),e)}function ane(i,e){if(i!=null){if(e4(i))return ine(i,e);if(Jz(i))return rne(i,e);if(Qz(i))return nne(i,e);if(t4(i))return h4(i,e);if(r4(i))return sne(i,e);if(o4(i))return one(i,e)}throw i4(i)}function lne(i,e){return e?ane(i,e):pl(i)}function VD(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var t=qie(i);return lne(i,t)}function cne(i){return i instanceof Date&&!isNaN(i)}function D0(i,e){return oa(function(t,n){var s=0;t.subscribe(ho(n,function(c){n.next(i.call(e,c,s++))}))})}function hne(i,e,t,n,s,c,f,r){var b=[],w=0,E=0,k=!1,F=function(){k&&!b.length&&!w&&e.complete()},$=function(W){return w<n?X(W):b.push(W)},X=function(W){w++;var ne=!1;pl(t(W,E++)).subscribe(ho(e,function(_e){e.next(_e)},function(){ne=!0},void 0,function(){if(ne)try{w--;for(var _e=function(){var Te=b.shift();f||X(Te)};b.length&&w<n;)_e();F()}catch(Te){e.error(Te)}}))};return i.subscribe(ho(e,$,function(){k=!0,F()})),function(){}}function u4(i,e,t){return t===void 0&&(t=1/0),Cs(e)?u4(function(n,s){return D0(function(c,f){return e(n,c,s,f)})(pl(i(n,s)))},t):(typeof e=="number"&&(t=e),oa(function(n,s){return hne(n,s,i,t)}))}function une(i){return new sa(function(e){pl(i()).subscribe(e)})}function BC(i,e,t){i===void 0&&(i=0),t===void 0&&(t=Gie);var n=-1;return e!=null&&(Kz(e)?t=e:n=e),new sa(function(s){var c=cne(i)?+i-t.now():i;c<0&&(c=0);var f=0;return t.schedule(function(){s.closed||(s.next(f++),0<=n?this.schedule(void 0,n):s.complete())},c)})}function d4(i,e){return oa(function(t,n){var s=0;t.subscribe(ho(n,function(c){return i.call(e,c,s++)&&n.next(c)}))})}function f4(i){return oa(function(e,t){var n=null,s=!1,c;n=e.subscribe(ho(t,void 0,void 0,function(f){c=pl(i(f,f4(i)(e))),n?(n.unsubscribe(),n=null,c.subscribe(t)):s=!0})),s&&(n.unsubscribe(),n=null,c.subscribe(t))})}function dne(i,e){return e===void 0&&(e=DC),oa(function(t,n){var s=null,c=null,f=null,r=function(){if(s){s.unsubscribe(),s=null;var w=c;c=null,n.next(w)}};function b(){var w=f+i,E=e.now();if(E<w){s=this.schedule(void 0,w-E),n.add(s);return}r()}t.subscribe(ho(n,function(w){c=w,f=e.now(),s||(s=e.schedule(b,i),n.add(s))},function(){r(),n.complete()},void 0,function(){c=s=null}))})}function fne(i){return i<=0?function(){return Zz}:oa(function(e,t){var n=0;e.subscribe(ho(t,function(s){++n<=i&&(t.next(s),i<=n&&t.complete())}))})}function pne(i){return D0(function(){return i})}function mne(i,e){return u4(function(t,n){return pl(i(t,n)).pipe(fne(1),pne(t))})}function p4(i,e){e===void 0&&(e=DC);var t=BC(i,e);return mne(function(){return t})}function OC(i,e){return e===void 0&&(e=P0),i=i??gne,oa(function(t,n){var s,c=!0;t.subscribe(ho(n,function(f){var r=e(f);(c||!i(s,r))&&(c=!1,s=r,n.next(f))}))})}function gne(i,e){return i===e}function _ne(i){var e,t=1/0,n;return i!=null&&(typeof i=="object"?(e=i.count,t=e===void 0?1/0:e,n=i.delay):t=i),t<=0?function(){return Zz}:oa(function(s,c){var f=0,r,b=function(){if(r==null||r.unsubscribe(),r=null,n!=null){var E=typeof n=="number"?BC(n):pl(n(f)),k=ho(c,function(){k.unsubscribe(),w()});E.subscribe(k)}else w()},w=function(){var E=!1;r=s.subscribe(ho(c,void 0,function(){++f<t?r?b():E=!0:c.complete()})),E&&b()};w()})}function yne(i){i===void 0&&(i=1/0);var e;i&&typeof i=="object"?e=i:e={count:i};var t=e.count,n=t===void 0?1/0:t,s=e.delay,c=e.resetOnSuccess,f=c===void 0?!1:c;return n<=0?P0:oa(function(r,b){var w=0,E,k=function(){var F=!1;E=r.subscribe(ho(b,function($){f&&(w=0),b.next($)},void 0,function($){if(w++<n){var X=function(){E?(E.unsubscribe(),E=null,k()):F=!0};if(s!=null){var W=typeof s=="number"?BC(s):pl(s($,w)),ne=ho(b,function(){ne.unsubscribe(),X()},function(){b.complete()});W.subscribe(ne)}else X()}else b.error($)})),F&&(E.unsubscribe(),E=null,k())};k()})}function bne(i,e){return oa(function(t,n){var s=null,c=0,f=!1,r=function(){return f&&!s&&n.complete()};t.subscribe(ho(n,function(b){s==null||s.unsubscribe();var w=0,E=c++;pl(i(b,E)).subscribe(s=ho(n,function(k){return n.next(e?e(b,k,E,w++):k)},function(){s=null,r()}))},function(){f=!0,r()}))})}function m4(i){return oa(function(e,t){pl(i).subscribe(ho(t,function(){return t.complete()},aE)),!t.closed&&e.subscribe(t)})}function cE(i,e,t){var n=Cs(i)||e||t?{next:i,error:e,complete:t}:i;return n?oa(function(s,c){var f;(f=n.subscribe)===null||f===void 0||f.call(n);var r=!0;s.subscribe(ho(c,function(b){var w;(w=n.next)===null||w===void 0||w.call(n,b),c.next(b)},function(){var b;r=!1,(b=n.complete)===null||b===void 0||b.call(n),c.complete()},function(b){var w;r=!1,(w=n.error)===null||w===void 0||w.call(n,b),c.error(b)},function(){var b,w;r&&((b=n.unsubscribe)===null||b===void 0||b.call(n)),(w=n.finalize)===null||w===void 0||w.call(n)}))}):P0}class vne{constructor(e=""){this.baseUrl=e}async get(e,t={}){try{const n=await fetch(this.baseUrl+e,{method:"GET",...t});return await this.handleResponse(n)}catch(n){this.handleError(n)}}async post(e,t={},n={}){try{const s=await fetch(this.baseUrl+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),...n});return await this.handleResponse(s)}catch(s){this.handleError(s)}}async put(e,t={},n={}){try{const s=await fetch(this.baseUrl+e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),...n});return await this.handleResponse(s)}catch(s){this.handleError(s)}}async delete(e,t={}){try{const n=await fetch(this.baseUrl+e,{method:"DELETE",...t});return await this.handleResponse(n)}catch(n){this.handleError(n)}}async handleResponse(e){if(!e.ok){const t=await e.json();throw new Error(t.message||"Unknown error")}return e.json()}handleError(e){throw console.error("[HttpService]",e),e}}class xne extends vne{constructor(e,t){super(e),this.token=t,this.vehicleTrack$=new Vie(null)}getInitialVehicles(){const e=new Date;e.setHours(0,0,0,0);const t=new Date,n=r=>`${String(r.getDate()).padStart(2,"0")}.${String(r.getMonth()+1).padStart(2,"0")}.${r.getFullYear()} ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}`,s=n(e),c=n(t);return VD([{id:"22216",name:"ID:22216",startDateTime:s,endDateTime:c,speed:4,active:!0,isRepeat:!0,color:"#1abc9c"},{id:"24121",name:"ID:24121",startDateTime:s,endDateTime:c,speed:4,active:!1,isRepeat:!0,color:"#e74c3c"},{id:"24488",name:"ID:24488",startDateTime:s,endDateTime:c,speed:4,active:!1,isRepeat:!0,color:"#3498db"},{id:"27067",name:"ID:27067",startDateTime:s,endDateTime:c,speed:4,active:!1,isRepeat:!0,color:"#2ecc71"},{id:"07322",name:"ID:07322",startDateTime:s,endDateTime:c,speed:4,active:!1,isRepeat:!0,color:"#f39c12"},{id:"07496",name:"ID:07496",startDateTime:s,endDateTime:c,speed:4,active:!1,isRepeat:!0,color:"#9b59b6"},{id:"07321",name:"ID:07321",startDateTime:s,endDateTime:c,speed:4,active:!1,isRepeat:!0,color:"#34495e"}])}getVehicleTrack(e,t,n,s=!1){const c=new URLSearchParams({token:this.token,vehicle_id:e,start:t,end:n});return une(()=>this.get(`/tracking?${c.toString()}`)).pipe(D0(f=>f),f4(f=>(console.error("Error loading track:",f),VD(null))),yne({delay:1e4}),s?_ne({delay:1e4}):P0,cE(f=>this.vehicleTrack$.next({vehicleId:e,data:f,isRepeat:s})))}}const FC=new xne("https://artemis.itmontag.keenetic.pro","27afb877422133945a0f5241bc649145bd928fa17ca239d23b942850a770cd06");class wne{constructor(){this._loaderSubject=new zm,this._priority=0}get inProgress(){return this._loaderSubject.asObservable()}show(e=0){this._priority=e>this._priority?e:this._priority,this._loaderSubject.next(!0)}hide(e=0){e>=this._priority&&(this._priority=0,this._loaderSubject.next(!1))}}const LC=new wne,M2=Math.PI/180,ax=new Float32Array(16),$D=new Float32Array(12);function jD(i,e,t){const n=e[0]*M2,s=e[1]*M2,c=e[2]*M2,f=Math.sin(c),r=Math.sin(n),b=Math.sin(s),w=Math.cos(c),E=Math.cos(n),k=Math.cos(s),F=t[0],$=t[1],X=t[2];i[0]=F*k*E,i[1]=F*b*E,i[2]=F*-r,i[3]=$*(-b*w+k*r*f),i[4]=$*(k*w+b*r*f),i[5]=$*E*f,i[6]=X*(b*f+k*r*w),i[7]=X*(-k*f+b*r*w),i[8]=X*E*w}function HD(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const Ane={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,{startRow:e,endRow:t}){const{data:n,getOrientation:s,getScale:c,getTranslation:f,getTransformMatrix:r}=this.props,b=Array.isArray(r),w=b&&r.length===16,E=Array.isArray(c),k=Array.isArray(s),F=Array.isArray(f),$=w||!b&&!!r(n[0]);$?i.constant=w:i.constant=k&&E&&F;const X=i.value;if(i.constant){let W;$?(ax.set(r),W=HD(ax)):(W=$D,jD(W,s,c),W.set(f,9)),i.value=new Float32Array(W)}else{let W=e*i.size;const{iterable:ne,objectInfo:_e}=Cz(n,e,t);for(const Te of ne){_e.index++;let we;if($)ax.set(w?r:r(Te,_e)),we=HD(ax);else{we=$D;const Ee=k?s:s(Te,_e),Le=E?c:c(Te,_e);jD(we,Ee,Le),we.set(F?f:f(Te,_e),9)}X[W++]=we[0],X[W++]=we[1],X[W++]=we[2],X[W++]=we[3],X[W++]=we[4],X[W++]=we[5],X[W++]=we[6],X[W++]=we[7],X[W++]=we[8],X[W++]=we[9],X[W++]=we[10],X[W++]=we[11]}}}};function Tne(i,e){return e===Qn.CARTESIAN||e===Qn.METER_OFFSETS||e===Qn.DEFAULT&&!i.isGeospatial}var Bl;(function(i){i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.ONE=1]="ONE",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.LINEAR=9729]="LINEAR",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Bl||(Bl={}));function Sne(i,e,t,n){const s={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};s.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:c}=n;return c&&(s.bindings.pbr_diffuseEnvSampler=c.diffuseEnvSampler.texture,s.bindings.pbr_specularEnvSampler=c.specularEnvSampler.texture,s.bindings.pbr_BrdfLUT=c.brdfLutTexture.texture,s.uniforms.scaleIBLAmbient=[1,1]),n!=null&&n.pbrDebug&&(s.defines.PBR_DEBUG=1,s.uniforms.scaleDiffBaseMR=[0,0,0,0],s.uniforms.scaleFGDSpec=[0,0,0,0]),t.NORMAL&&(s.defines.HAS_NORMALS=1),t.TANGENT&&(n!=null&&n.useTangents)&&(s.defines.HAS_TANGENTS=1),t.TEXCOORD_0&&(s.defines.HAS_UV=1),n!=null&&n.imageBasedLightingEnvironment&&(s.defines.USE_IBL=1),n!=null&&n.lights&&(s.defines.USE_LIGHTS=1),e&&Ene(i,e,s),s}function Ene(i,e,t){if(t.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&Cne(i,e.pbrMetallicRoughness,t),e.normalTexture){Ly(i,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",t);const{scale:n=1}=e.normalTexture;t.uniforms.normalScale=n}if(e.occlusionTexture){Ly(i,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",t);const{strength:n=1}=e.occlusionTexture;t.uniforms.occlusionStrength=n}switch(e.emissiveTexture&&(Ly(i,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:n=.5}=e;t.defines.ALPHA_CUTOFF=1,t.uniforms.alphaCutoff=n;break;case"BLEND":ni.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=Bl.FUNC_ADD,t.glParameters.blendFunc=[Bl.SRC_ALPHA,Bl.ONE_MINUS_SRC_ALPHA,Bl.ONE,Bl.ONE_MINUS_SRC_ALPHA];break}}function Cne(i,e,t){e.baseColorTexture&&Ly(i,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&Ly(i,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);const{metallicFactor:n=1,roughnessFactor:s=1}=e;t.uniforms.metallicRoughnessValues=[n,s]}function Ly(i,e,t,n=null,s){var E,k;const c=((k=(E=e==null?void 0:e.texture)==null?void 0:E.sampler)==null?void 0:k.parameters)||{},f=e.texture.source.image;let r,b={};f.compressed?(r=f,b={[Bl.TEXTURE_MIN_FILTER]:f.data.length>1?Bl.LINEAR_MIPMAP_NEAREST:Bl.LINEAR}):r={data:f};const w=i.createTexture({id:e.uniformName||e.id,parameters:{...c,...b},pixelStore:{[Bl.UNPACK_FLIP_Y_WEBGL]:!1},...r});s.bindings[t]=w,n&&(s.defines[n]=1),s.generatedTextures.push(w)}const Ine="4.3.2",F1={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let WD;async function GD(i){p9(i.modules);const e=m9("basis");return e||(WD||(WD=Mne(i)),await WD)}async function Mne(i){let e=null,t=null;return[e,t]=await Promise.all([await df(F1.TRANSCODER,"textures",i),await df(F1.TRANSCODER_WASM,"textures",i)]),e=e||globalThis.BASIS,await Rne(e,t)}function Rne(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{i(t).then(s=>{const{BasisFile:c,initializeBasis:f}=s;f(),n({BasisFile:c})})})}let R2;async function XD(i){const e=i.modules||{};return e.basisEncoder?e.basisEncoder:(R2=R2||kne(i),await R2)}async function kne(i){let e=null,t=null;return[e,t]=await Promise.all([await df(F1.ENCODER,"textures",i),await df(F1.ENCODER_WASM,"textures",i)]),e=e||globalThis.BASIS,await Pne(e,t)}function Pne(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{i(t).then(s=>{const{BasisFile:c,KTX2File:f,initializeBasis:r,BasisEncoder:b}=s;r(),n({BasisFile:c,KTX2File:f,BasisEncoder:b})})})}const am={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},Dne=["","WEBKIT_","MOZ_"],qD={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let lx=null;function Bne(i){if(!lx){i=i||One()||void 0,lx=new Set;for(const e of Dne)for(const t in qD)if(i&&i.getExtension(`${e}${t}`)){const n=qD[t];lx.add(n)}}return lx}function One(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Ea=[171,75,84,88,32,50,48,187,13,10,26,10];function Fne(i){const e=new Uint8Array(i);return!(e.byteLength<Ea.length||e[0]!==Ea[0]||e[1]!==Ea[1]||e[2]!==Ea[2]||e[3]!==Ea[3]||e[4]!==Ea[4]||e[5]!==Ea[5]||e[6]!==Ea[6]||e[7]!==Ea[7]||e[8]!==Ea[8]||e[9]!==Ea[9]||e[10]!==Ea[10]||e[11]!==Ea[11])}const Lne={etc1:{basisFormat:0,compressed:!0,format:am.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:am.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:am.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:am.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:am.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:am.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function zne(i,e){if(e.basis.containerFormat==="auto"){if(Fne(i)){const n=await XD(e);return YD(n.KTX2File,i,e)}const{BasisFile:t}=await GD(e);return k2(t,i,e)}switch(e.basis.module){case"encoder":const t=await XD(e);switch(e.basis.containerFormat){case"ktx2":return YD(t.KTX2File,i,e);case"basis":default:return k2(t.BasisFile,i,e)}case"transcoder":default:const{BasisFile:n}=await GD(e);return k2(n,i,e)}}function k2(i,e,t){const n=new i(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const s=n.getNumImages(),c=[];for(let f=0;f<s;f++){const r=n.getNumLevels(f),b=[];for(let w=0;w<r;w++)b.push(Nne(n,f,w,t));c.push(b)}return c}finally{n.close(),n.delete()}}function Nne(i,e,t,n){const s=i.getImageWidth(e,t),c=i.getImageHeight(e,t),f=i.getHasAlpha(),{compressed:r,format:b,basisFormat:w}=g4(n,f),E=i.getImageTranscodedSizeInBytes(e,t,w),k=new Uint8Array(E);if(!i.transcodeImage(k,e,t,w,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:c,data:k,compressed:r,format:b,hasAlpha:f}}function YD(i,e,t){const n=new i(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=n.getLevels(),c=[];for(let f=0;f<s;f++)c.push(Une(n,f,t));return[c]}finally{n.close(),n.delete()}}function Une(i,e,t){const{alphaFlag:n,height:s,width:c}=i.getImageLevelInfo(e,0,0),{compressed:f,format:r,basisFormat:b}=g4(t,n),w=i.getImageTranscodedSizeInBytes(e,0,0,b),E=new Uint8Array(w);if(!i.transcodeImage(E,e,0,0,b,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:c,height:s,data:E,compressed:f,levelSize:w,hasAlpha:n,format:r}}function g4(i,e){let t=i&&i.basis&&i.basis.format;return t==="auto"&&(t=_4()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),Lne[t]}function _4(){const i=Bne();return i.has("astc")?"astc-4x4":i.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:i.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:i.has("etc1")?"etc1":i.has("etc2")?"etc2":"rgb565"}const Vne={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Ine,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},$ne={...Vne,parse:zne},jne={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Hne={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class Wne{constructor(e){ce(this,"name");ce(this,"startTime",0);ce(this,"playing",!0);ce(this,"speed",1);ce(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const n=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:s,target:c,path:f})=>{Jne(n,s,c,f),qne(c,c._node)})}}class Gne{constructor(e){ce(this,"animations");this.animations=e.animations.map((t,n)=>{const s=t.name||`Animation-${n}`,c=t.samplers.map(({input:r,interpolation:b="LINEAR",output:w})=>({input:ZD(e.accessors[r]),interpolation:b,output:ZD(e.accessors[w])})),f=t.channels.map(({sampler:r,target:b})=>({sampler:c[r],target:e.nodes[b.node],path:b.path}));return new Wne({name:s,channels:f})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}function ZD(i){if(!i._animation){const e=Hne[i.componentType],t=jne[i.type],n=t*i.count,{buffer:s,byteOffset:c}=i.bufferView.data,f=new e(s,c+(i.byteOffset||0),n);if(t===1)i._animation=Array.from(f);else{const r=[];for(let b=0;b<f.length;b+=t)r.push(Array.from(f.slice(b,b+t)));i._animation=r}}return i._animation}const Xne=new co;function qne(i,e){if(e.matrix.identity(),i.translation&&e.matrix.translate(i.translation),i.rotation){const t=Xne.fromQuaternion(i.rotation);e.matrix.multiplyRight(t)}i.scale&&e.matrix.scale(i.scale)}const P2=new sY;function Yne(i,e,t,n,s){if(e==="rotation"){P2.slerp({start:t,target:n,ratio:s});for(let c=0;c<P2.length;c++)i[e][c]=P2[c]}else for(let c=0;c<t.length;c++)i[e][c]=s*n[c]+(1-s)*t[c]}function Zne(i,e,{p0:t,outTangent0:n,inTangent1:s,p1:c,tDiff:f,ratio:r}){for(let b=0;b<i[e].length;b++){const w=n[b]*f,E=s[b]*f;i[e][b]=(2*Math.pow(r,3)-3*Math.pow(r,2)+1)*t[b]+(Math.pow(r,3)-2*Math.pow(r,2)+r)*w+(-2*Math.pow(r,3)+3*Math.pow(r,2))*c[b]+(Math.pow(r,3)-Math.pow(r,2))*E}}function Kne(i,e,t){for(let n=0;n<t.length;n++)i[e][n]=t[n]}function Jne(i,{input:e,interpolation:t,output:n},s,c){const f=e[e.length-1],r=i%f,b=e.findIndex(F=>F>=r),w=Math.max(0,b-1);if(!Array.isArray(s[c]))switch(c){case"translation":s[c]=[0,0,0];break;case"rotation":s[c]=[0,0,0,1];break;case"scale":s[c]=[1,1,1];break;default:ni.warn(`Bad animation path ${c}`)()}const E=e[w],k=e[b];switch(t){case"STEP":Kne(s,c,n[w]);break;case"LINEAR":if(k>E){const F=(r-E)/(k-E);Yne(s,c,n[w],n[b],F)}break;case"CUBICSPLINE":if(k>E){const F=(r-E)/(k-E),$=k-E,X=n[3*w+1],W=n[3*w+2],ne=n[3*b+0],_e=n[3*b+1];Zne(s,c,{p0:X,outTangent0:W,inTangent1:ne,p1:_e,tDiff:$,ratio:F})}break;default:ni.warn(`Interpolation ${t} not supported`)();break}}const Qne=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,ere=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,tre=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function ire(i,e){const{id:t,geometry:n,material:s,vertexCount:c,materialOptions:f,modelOptions:r}=e,b=Sne(i,s,n.attributes,f);ni.info(4,"createGLTFModel defines: ",b.defines)();const w=[],E={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},k={id:t,source:Qne,vs:ere,fs:tre,geometry:n,topology:n.topology,vertexCount:c,modules:[LL],...r,defines:{...b.defines,...r.defines},parameters:{...E,...b.parameters,...r.parameters}},F=new i0(i,k),{camera:$,...X}={...b.uniforms,...r.uniforms,...b.bindings,...r.bindings};return F.shaderInputs.setProps({pbrMaterial:X,pbrProjection:{camera:$}}),new YS({managedResources:w,model:F})}var tf;(function(i){i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(tf||(tf={}));function nre(i){switch(i){case tf.POINTS:return"point-list";case tf.LINES:return"line-list";case tf.LINE_STRIP:return"line-strip";case tf.TRIANGLES:return"triangle-list";case tf.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(i))}}const rre={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class sre{constructor(e,t={}){ce(this,"device");ce(this,"options");ce(this,"gltf");this.device=e,this.options={...rre,...t}}instantiate(e){return this.gltf=hE(e),(this.gltf.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new Gne(this.gltf):null}createScene(e){const n=(e.nodes||[]).map(c=>this.createNode(c));return new wm({id:e.name||e.id,children:n})}createNode(e){if(!e._node){const s=(e.children||[]).map(f=>this.createNode(f));e.mesh&&s.push(this.createMesh(e.mesh));const c=new wm({id:e.name||e.id,children:s});if(e.matrix)c.setMatrix(e.matrix);else{if(c.matrix.identity(),e.translation&&c.matrix.translate(e.translation),e.rotation){const f=new co().fromQuaternion(e.rotation);c.matrix.multiplyRight(f)}e.scale&&c.matrix.scale(e.scale)}e._node=c}const t=this.gltf.nodes.find(n=>n.id===e.id);return t._node=e._node,e._node}createMesh(e){if(!e._mesh){const n=(e.primitives||[]).map((c,f)=>this.createPrimitive(c,f,e)),s=new wm({id:e.name||e.id,children:n});e._mesh=s}return e._mesh}createPrimitive(e,t,n){const s=e.name||`${n.name||n.id}-primitive-${t}`,c=nre(e.mode||4),f=e.indices?e.indices.count:this.getVertexCount(e.attributes),r=ire(this.device,{id:s,geometry:this.createGeometry(s,e,c),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:f});return r.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],r}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,n){const s={};for(const[c,f]of Object.entries(t.attributes)){const{components:r,size:b,value:w}=f;s[c]={size:b??r,value:w}}return new hJ({id:e,topology:n,indices:t.indices.value,attributes:s})}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:n}=e;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[t]||(n.lumaBuffers[t]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||e.value})),n.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}function hE(i){if(ArrayBuffer.isView(i)||i instanceof ArrayBuffer||i instanceof ImageBitmap)return i;if(Array.isArray(i))return i.map(hE);if(i&&typeof i=="object"){const e={};for(const t in i)e[t]=hE(i[t]);return e}return i}function ore(i,e,t){const n=new sre(i,t),s=n.instantiate(e),c=n.createAnimator();return{scenes:s,animator:c}}function Oa(i,e){if(!i)throw new Error(e||"assert failed: gltf")}const y4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},b4={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},KD=["SCALAR","VEC2","VEC3","VEC4"],are=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],lre=new Map(are),cre={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hre={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ure={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function v4(i){return KD[i-1]||KD[0]}function Ew(i){const e=lre.get(i.constructor);if(!e)throw new Error("Illegal typed array");return e}function zC(i,e){const t=ure[i.componentType],n=cre[i.type],s=hre[i.componentType],c=i.count*n,f=i.count*n*s;Oa(f>=0&&f<=e.byteLength);const r=b4[i.componentType],b=y4[i.type];return{ArrayType:t,length:c,byteLength:f,componentByteSize:r,numberOfComponentsInElement:b}}function dre(i,e,t){const n=i.bufferViews[t];Oa(n);const s=n.buffer,c=e[s];Oa(c);const f=(n.byteOffset||0)+c.byteOffset;return new Uint8Array(c.arrayBuffer,f,n.byteLength)}function fre(i,e,t){var W,ne;const n=typeof t=="number"?(W=i.accessors)==null?void 0:W[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const s=(ne=i.bufferViews)==null?void 0:ne[n.bufferView||0];if(!s)throw new Error(`No gltf buffer view for accessor ${s}`);const{arrayBuffer:c,byteOffset:f}=e[s.buffer],r=(f||0)+(n.byteOffset||0)+(s.byteOffset||0),{ArrayType:b,length:w,componentByteSize:E,numberOfComponentsInElement:k}=zC(n,s),F=E*k,$=s.byteStride||F;if(typeof s.byteStride>"u"||s.byteStride===F)return new b(c,r,w);const X=new b(w);for(let _e=0;_e<n.count;_e++){const Te=new b(c,r+_e*$,k);X.set(Te,_e*k)}return X}function pre(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Ks{constructor(e){ce(this,"gltf");ce(this,"sourceBuffers");ce(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||pre(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(s=>s===e),n=this.getRequiredExtensions().find(s=>s===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(s=>s===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Oa(n);const s=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,s,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return fre(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),s=this.getBuffer(t.buffer).data,c=t.byteOffset||0;return new Uint8Array(s,c,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const s=e.extensions||{};s[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(t)||s.push(t)}delete n[t]}addExtension(e,t={}){return Oa(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Oa(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const s={mesh:t};return n&&(s.matrix=n),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:s,mode:c=4}=e,r={primitives:[{attributes:this._addAttributes(t),mode:c}]};if(n){const b=this._addIndices(n);r.primitives[0].indices=b}return Number.isFinite(s)&&(r.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=JE(e),s=t||(n==null?void 0:n.mimeType),f={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(f),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const s=e.byteLength;Oa(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const c={buffer:t,byteOffset:n,byteLength:s};return this.byteLength+=S0(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(c),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:v4(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let s={min:t.min,max:t.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(e,t.size));const c={size:t.size,componentType:Ew(e),count:Math.round(e.length/t.size),min:s.min,max:s.max};return this.addAccessor(n,Object.assign(c,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var c,f;const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let s=0;for(const r of this.sourceBuffers||[])s=U9(r,n,s);(f=(c=this.json)==null?void 0:c.buffers)!=null&&f[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const s=e.indexOf(t);s>-1?e.splice(s,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const s=e[n],c=this._getGltfAttributeName(n),f=this.addBinaryBuffer(s.value,s);t[c]=f}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const s=e.subarray(0,t);for(const c of s)n.min.push(c),n.max.push(c);for(let c=t;c<e.length;c+=t)for(let f=0;f<t;f++)n.min[0+f]=Math.min(n.min[0+f],e[c+f]),n.max[0+f]=Math.max(n.max[0+f],e[c+f]);return n}}function JD(i){return(i%1+1)%1}const x4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},mre={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},w4={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function NC(i,e){return w4[e]*x4[i]}function Cw(i,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const s=i.getTypedArrayForBufferView(e),c=Iw(s,"SCALAR",t,n+1);return c instanceof BigInt64Array||c instanceof BigUint64Array?null:c}function Iw(i,e,t,n=1){const s=x4[e],c=mre[t],f=w4[t],r=n*s,b=r*f;let w=i.buffer,E=i.byteOffset;return E%f!==0&&(w=new Uint8Array(w).slice(E,E+b).buffer,E=0),new c(w,E,r)}function UC(i,e,t){var w,E,k,F,$;const n=`TEXCOORD_${e.texCoord||0}`,s=t.attributes[n],c=i.getTypedArrayForAccessor(s),f=i.gltf.json,r=e.index,b=(E=(w=f.textures)==null?void 0:w[r])==null?void 0:E.source;if(typeof b<"u"){const X=(F=(k=f.images)==null?void 0:k[b])==null?void 0:F.mimeType,W=($=i.gltf.images)==null?void 0:$[b];if(W&&typeof W.width<"u"){const ne=[];for(let _e=0;_e<c.length;_e+=2){const Te=gre(W,X,c,_e,e.channels);ne.push(Te)}return ne}}return[]}function A4(i,e,t,n,s){if(!(t!=null&&t.length))return;const c=[];for(const E of t){let k=n.findIndex(F=>F===E);k===-1&&(k=n.push(E)-1),c.push(k)}const f=new Uint32Array(c),r=i.gltf.buffers.push({arrayBuffer:f.buffer,byteOffset:f.byteOffset,byteLength:f.byteLength})-1,b=i.addBufferView(f,r,0),w=i.addAccessor(b,{size:1,componentType:Ew(f),count:f.length});s.attributes[e]=w}function gre(i,e,t,n,s=[0]){const c={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},f=t[n],r=t[n+1];let b=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(b=4);const w=_re(f,r,i,b);let E=0;for(const k of s){const F=typeof k=="number"?Object.values(c)[k]:c[k],$=w+F.offset,X=MF(i);if(X.data.length<=$)throw new Error(`${X.data.length} <= ${$}`);const W=X.data[$];E|=W<<F.shift}return E}function _re(i,e,t,n=1){const s=t.width,c=JD(i)*(s-1),f=Math.round(c),r=t.height,b=JD(e)*(r-1),w=Math.round(b),E=t.components?t.components:n;return(w*s+f)*E}function T4(i,e,t,n,s){const c=[];for(let f=0;f<e;f++){const r=t[f],b=t[f+1]-t[f];if(b+r>n)break;const w=r/s,E=b/s;c.push(i.slice(w,w+E))}return c}function S4(i,e,t){const n=[];for(let s=0;s<e;s++){const c=s*t;n.push(i.slice(c,c+t))}return n}function E4(i,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const s=[],c=new TextDecoder("utf8");let f=0;for(let r=0;r<i;r++){const b=n[r+1]-n[r];if(b+f<=e.length){const w=e.subarray(f,b+f),E=c.decode(w);s.push(E),f+=b}}return s}return[]}const Sm="EXT_mesh_features",yre=Sm;async function bre(i,e){const t=new Ks(i);xre(t,e)}function vre(i,e){const t=new Ks(i);return Are(t),t.createBinaryChunk(),t.gltf}function xre(i,e){const t=i.gltf.json;if(t.meshes)for(const n of t.meshes)for(const s of n.primitives)wre(i,s,e)}function wre(i,e,t){var c,f,r;if(!((c=t==null?void 0:t.gltf)!=null&&c.loadBuffers))return;const n=(f=e.extensions)==null?void 0:f[Sm],s=n==null?void 0:n.featureIds;if(s)for(const b of s){let w;if(typeof b.attribute<"u"){const E=`_FEATURE_ID_${b.attribute}`,k=e.attributes[E];w=i.getTypedArrayForAccessor(k)}else typeof b.texture<"u"&&((r=t==null?void 0:t.gltf)!=null&&r.loadImages)?w=UC(i,b.texture,e):w=[];b.data=w}}function Are(i,e){const t=i.gltf.json.meshes;if(t)for(const n of t)for(const s of n.primitives)Sre(i,s)}function Tre(i,e,t,n){e.extensions||(e.extensions={});let s=e.extensions[Sm];s||(s={featureIds:[]},e.extensions[Sm]=s);const{featureIds:c}=s,f={featureCount:t.length,propertyTable:n,data:t};c.push(f),i.addObjectExtension(e,Sm,s)}function Sre(i,e){var s;const t=(s=e.extensions)==null?void 0:s[Sm];if(!t)return;const n=t.featureIds;n.forEach((c,f)=>{if(c.data){const{accessorKey:r,index:b}=Ere(e.attributes),w=new Uint32Array(c.data);n[f]={featureCount:w.length,propertyTable:c.propertyTable,attribute:b},i.gltf.buffers.push({arrayBuffer:w.buffer,byteOffset:w.byteOffset,byteLength:w.byteLength});const E=i.addBufferView(w),k=i.addAccessor(E,{size:1,componentType:Ew(w),count:w.length});e.attributes[r]=k}})}function Ere(i){const e="_FEATURE_ID_",t=Object.keys(i).filter(c=>c.indexOf(e)===0);let n=-1;for(const c of t){const f=Number(c.substring(e.length));f>n&&(n=f)}return n++,{accessorKey:`${e}${n}`,index:n}}const Cre=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:Tre,decode:bre,encode:vre,name:yre},Symbol.toStringTag,{value:"Module"})),Nm="EXT_structural_metadata",Ire=Nm;async function Mre(i,e){const t=new Ks(i);kre(t,e)}function Rre(i,e){const t=new Ks(i);return Xre(t),t.createBinaryChunk(),t.gltf}function kre(i,e){var n,s;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=i.getExtension(Nm);t&&((s=e.gltf)!=null&&s.loadImages&&Pre(i,t),Dre(i,t))}function Pre(i,e){const t=e.propertyTextures,n=i.gltf.json;if(t&&n.meshes)for(const s of n.meshes)for(const c of s.primitives)Ore(i,t,c,e)}function Dre(i,e){const t=e.schema;if(!t)return;const n=t.classes,s=e.propertyTables;if(n&&s)for(const c in n){const f=Bre(s,c);f&&Lre(i,t,f)}}function Bre(i,e){for(const t of i)if(t.class===e)return t;return null}function Ore(i,e,t,n){var f;if(!e)return;const s=(f=t.extensions)==null?void 0:f[Nm],c=s==null?void 0:s.propertyTextures;if(c)for(const r of c){const b=e[r];Fre(i,b,t,n)}}function Fre(i,e,t,n){var c;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const s=e.class;for(const f in e.properties){const r=`${s}_${f}`,b=(c=e.properties)==null?void 0:c[f];if(!b)continue;b.data||(b.data=[]);const w=b.data,E=UC(i,b,t);E!==null&&(A4(i,r,E,w,t),b.data=w,n.dataAttributeNames.push(r))}}function Lre(i,e,t){var c,f;const n=(c=e.classes)==null?void 0:c[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const s=t.count;for(const r in n.properties){const b=n.properties[r],w=(f=t.properties)==null?void 0:f[r];if(w){const E=zre(i,e,b,s,w);w.data=E}}}function zre(i,e,t,n,s){let c=[];const f=s.values,r=i.getTypedArrayForBufferView(f),b=Nre(i,t,s,n),w=Ure(i,s,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{c=Vre(t,n,r,b);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{c=E4(n,r,b,w);break}case"ENUM":{c=$re(e,t,n,r,b);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return c}function Nre(i,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?Cw(i,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function Ure(i,e,t){return typeof e.stringOffsets<"u"?Cw(i,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function Vre(i,e,t,n){const s=i.array,c=i.count,f=NC(i.type,i.componentType),r=t.byteLength/f;let b;return i.componentType?b=Iw(t,i.type,i.componentType,r):b=t,s?n?T4(b,e,n,t.length,f):c?S4(b,e,c):[]:b}function $re(i,e,t,n,s){var k;const c=e.enumType;if(!c)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const f=(k=i.enums)==null?void 0:k[c];if(!f)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${c}`);const r=f.valueType||"UINT16",b=NC(e.type,r),w=n.byteLength/b;let E=Iw(n,e.type,r,w);if(E||(E=n),e.array){if(s)return jre({valuesData:E,numberOfElements:t,arrayOffsets:s,valuesDataBytesLength:n.length,elementSize:b,enumEntry:f});const F=e.count;return F?Hre(E,t,F,f):[]}return VC(E,0,t,f)}function jre(i){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:s,elementSize:c,enumEntry:f}=i,r=[];for(let b=0;b<t;b++){const w=n[b],E=n[b+1]-n[b];if(E+w>s)break;const k=w/c,F=E/c,$=VC(e,k,F,f);r.push($)}return r}function Hre(i,e,t,n){const s=[];for(let c=0;c<e;c++){const f=t*c,r=VC(i,f,t,n);s.push(r)}return s}function VC(i,e,t,n){const s=[];for(let c=0;c<t;c++)if(i instanceof BigInt64Array||i instanceof BigUint64Array)s.push("");else{const f=i[e+c],r=Wre(n,f);r?s.push(r.name):s.push("")}return s}function Wre(i,e){for(const t of i.values)if(t.value===e)return t;return null}const Gre="schemaClassId";function Xre(i,e){var n,s;const t=i.getExtension(Nm);if(t&&t.propertyTables)for(const c of t.propertyTables){const f=c.class,r=(s=(n=t.schema)==null?void 0:n.classes)==null?void 0:s[f];c.properties&&r&&qre(c,r,i)}}function qre(i,e,t){for(const n in i.properties){const s=i.properties[n].data;if(s){const c=e.properties[n];if(c){const f=Jre(s,c,t);i.properties[n]=f}}}}function Yre(i,e,t=Gre){let n=i.getExtension(Nm);n||(n=i.addExtension(Nm)),n.schema=Zre(e,t,n.schema);const s=Kre(e,t,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(s)-1}function Zre(i,e,t){const n=t??{id:"schema_id"},s={properties:{}};for(const c of i){const f={type:c.elementType,componentType:c.componentType};s.properties[c.name]=f}return n.classes={},n.classes[e]=s,n}function Kre(i,e,t){var f;const n={class:e,count:0};let s=0;const c=(f=t.classes)==null?void 0:f[e];for(const r of i){if(s===0&&(s=r.values.length),s!==r.values.length&&r.values.length)throw new Error("Illegal values in attributes");(c==null?void 0:c.properties[r.name])&&(n.properties||(n.properties={}),n.properties[r.name]={values:0,data:r.values})}return n.count=s,n}function Jre(i,e,t){const n={values:0};if(e.type==="STRING"){const{stringData:s,stringOffsets:c}=tse(i);n.stringOffsets=D2(c,t),n.values=D2(s,t)}else if(e.type==="SCALAR"&&e.componentType){const s=ese(i,e.componentType);n.values=D2(s,t)}return n}const Qre={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function ese(i,e){const t=[];for(const s of i)t.push(Number(s));const n=Qre[e];if(!n)throw new Error("Illegal component type");return new n(t)}function tse(i){const e=new TextEncoder,t=[];let n=0;for(const b of i){const w=e.encode(b);n+=w.length,t.push(w)}const s=new Uint8Array(n),c=[];let f=0;for(const b of t)s.set(b,f),c.push(f),f+=b.length;c.push(f);const r=new Uint32Array(c);return{stringData:s,stringOffsets:r}}function D2(i,e){return e.gltf.buffers.push({arrayBuffer:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}),e.addBufferView(i)}const ise=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:Yre,decode:Mre,encode:Rre,name:Ire},Symbol.toStringTag,{value:"Module"})),C4="EXT_feature_metadata",nse=C4;async function rse(i,e){const t=new Ks(i);sse(t,e)}function sse(i,e){var n,s;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=i.getExtension(C4);t&&((s=e.gltf)!=null&&s.loadImages&&ose(i,t),ase(i,t))}function ose(i,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:s}=e;if(n&&s)for(const c in n){const f=n[c],r=cse(s,c);r&&use(i,r,f)}}function ase(i,e){const t=e.schema;if(!t)return;const n=t.classes,s=e.featureTables;if(n&&s)for(const c in n){const f=lse(s,c);f&&hse(i,t,f)}}function lse(i,e){for(const t in i){const n=i[t];if(n.class===e)return n}return null}function cse(i,e){for(const t in i){const n=i[t];if(n.class===e)return n}return null}function hse(i,e,t){var c,f;if(!t.class)return;const n=(c=e.classes)==null?void 0:c[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const s=t.count;for(const r in n.properties){const b=n.properties[r],w=(f=t.properties)==null?void 0:f[r];if(w){const E=dse(i,e,b,s,w);w.data=E}}}function use(i,e,t){var s;const n=e.class;for(const c in t.properties){const f=(s=e==null?void 0:e.properties)==null?void 0:s[c];if(f){const r=_se(i,f,n);f.data=r}}}function dse(i,e,t,n,s){let c=[];const f=s.bufferView,r=i.getTypedArrayForBufferView(f),b=fse(i,t,s,n),w=pse(i,t,s,n);return t.type==="STRING"||t.componentType==="STRING"?c=E4(n,r,b,w):mse(t)&&(c=gse(t,n,r,b)),c}function fse(i,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?Cw(i,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function pse(i,e,t,n){return typeof t.stringOffsetBufferView<"u"?Cw(i,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function mse(i){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(i.type)||typeof i.componentType<"u"&&e.includes(i.componentType)}function gse(i,e,t,n){const s=i.type==="ARRAY",c=i.componentCount,f="SCALAR",r=i.componentType||i.type,b=NC(f,r),w=t.byteLength/b,E=Iw(t,f,r,w);return s?n?T4(E,e,n,t.length,b):c?S4(E,e,c):[]:E}function _se(i,e,t){const n=i.gltf.json;if(!n.meshes)return[];const s=[];for(const c of n.meshes)for(const f of c.primitives)yse(i,t,e,s,f);return s}function yse(i,e,t,n,s){const c={channels:t.channels,...t.texture},f=UC(i,c,s);f&&A4(i,e,f,n,s)}const bse=Object.freeze(Object.defineProperty({__proto__:null,decode:rse,name:nse},Symbol.toStringTag,{value:"Module"})),vse="4.3.2",Um=!0,QD=1735152710,$C=12,L1=8,xse=1313821514,wse=5130562,Ase=0,Tse=0,Sse=1;function Ese(i,e=0){return`${String.fromCharCode(i.getUint8(e+0))}${String.fromCharCode(i.getUint8(e+1))}${String.fromCharCode(i.getUint8(e+2))}${String.fromCharCode(i.getUint8(e+3))}`}function Cse(i,e=0,t={}){const n=new DataView(i),{magic:s=QD}=t,c=n.getUint32(e,!1);return c===s||c===QD}function Ise(i,e,t=0,n={}){const s=new DataView(e),c=Ese(s,t+0),f=s.getUint32(t+4,Um),r=s.getUint32(t+8,Um);switch(Object.assign(i,{header:{byteOffset:t,byteLength:r,hasBinChunk:!1},type:c,version:f,json:{},binChunks:[]}),t+=$C,i.version){case 1:return Mse(i,s,t);case 2:return Rse(i,s,t,n={});default:throw new Error(`Invalid GLB version ${i.version}. Only supports version 1 and 2.`)}}function Mse(i,e,t){Ah(i.header.byteLength>$C+L1);const n=e.getUint32(t+0,Um),s=e.getUint32(t+4,Um);return t+=L1,Ah(s===Ase),uE(i,e,t,n),t+=n,t+=dE(i,e,t,i.header.byteLength),t}function Rse(i,e,t,n){return Ah(i.header.byteLength>$C+L1),kse(i,e,t,n),t+i.header.byteLength}function kse(i,e,t,n){for(;t+8<=i.header.byteLength;){const s=e.getUint32(t+0,Um),c=e.getUint32(t+4,Um);switch(t+=L1,c){case xse:uE(i,e,t,s);break;case wse:dE(i,e,t,s);break;case Tse:n.strict||uE(i,e,t,s);break;case Sse:n.strict||dE(i,e,t,s);break}t+=S0(s,4)}return t}function uE(i,e,t,n){const s=new Uint8Array(e.buffer,t,n),f=new TextDecoder("utf8").decode(s);return i.json=JSON.parse(f),S0(n,4)}function dE(i,e,t,n){return i.header.hasBinChunk=!0,i.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),S0(n,4)}function I4(i,e){if(i.startsWith("data:")||i.startsWith("http:")||i.startsWith("https:"))return i;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${i}`);return n.substr(0,n.lastIndexOf("/")+1)+i}const Pse="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Dse="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Bse=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Ose=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Fse={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Lse={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function zse(i,e,t,n,s,c="NONE"){const f=await Nse();$se(f,f.exports[Lse[s]],i,e,t,n,f.exports[Fse[c||"NONE"]])}let B2;async function Nse(){return B2||(B2=Use()),B2}async function Use(){let i=Pse;WebAssembly.validate(Bse)&&(i=Dse,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(Vse(i),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Vse(i){const e=new Uint8Array(i.length);for(let n=0;n<i.length;++n){const s=i.charCodeAt(n);e[n]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let t=0;for(let n=0;n<i.length;++n)e[t++]=e[n]<60?Ose[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function $se(i,e,t,n,s,c,f){const r=i.exports.sbrk,b=n+3&-4,w=r(b*s),E=r(c.length),k=new Uint8Array(i.exports.memory.buffer);k.set(c,E);const F=e(w,n,s,E,c.length);if(F===0&&f&&f(w,b,s),t.set(k.subarray(w,w+n*s)),r(w-r(0)),F!==0)throw new Error(`Malformed buffer data: ${F}`)}const z1="EXT_meshopt_compression",jse=z1;async function Hse(i,e){var s,c;const t=new Ks(i);if(!((s=e==null?void 0:e.gltf)!=null&&s.decompressMeshes)||!((c=e.gltf)!=null&&c.loadBuffers))return;const n=[];for(const f of i.json.bufferViews||[])n.push(Wse(t,f));await Promise.all(n),t.removeExtension(z1)}async function Wse(i,e){const t=i.getObjectExtension(e,z1);if(t){const{byteOffset:n=0,byteLength:s=0,byteStride:c,count:f,mode:r,filter:b="NONE",buffer:w}=t,E=i.gltf.buffers[w],k=new Uint8Array(E.arrayBuffer,E.byteOffset+n,s),F=new Uint8Array(i.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await zse(F,f,c,k,r,b),i.removeObjectExtension(e,z1)}}const Gse=Object.freeze(Object.defineProperty({__proto__:null,decode:Hse,name:jse},Symbol.toStringTag,{value:"Module"})),um="EXT_texture_webp",Xse=um;function qse(i,e){const t=new Ks(i);if(!CW("image/webp")){if(t.getRequiredExtensions().includes(um))throw new Error(`gltf: Required extension ${um} not supported by browser`);return}const{json:n}=t;for(const s of n.textures||[]){const c=t.getObjectExtension(s,um);c&&(s.source=c.source),t.removeObjectExtension(s,um)}t.removeExtension(um)}const Yse=Object.freeze(Object.defineProperty({__proto__:null,name:Xse,preprocess:qse},Symbol.toStringTag,{value:"Module"})),Wx="KHR_texture_basisu",Zse=Wx;function Kse(i,e){const t=new Ks(i),{json:n}=t;for(const s of n.textures||[]){const c=t.getObjectExtension(s,Wx);c&&(s.source=c.source,t.removeObjectExtension(s,Wx))}t.removeExtension(Wx)}const Jse=Object.freeze(Object.defineProperty({__proto__:null,name:Zse,preprocess:Kse},Symbol.toStringTag,{value:"Module"})),Qse="4.3.2",eoe={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Qse,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function toe(i,e,t){const n=M4(e.metadata),s=[],c=ioe(e.attributes);for(const f in i){const r=i[f],b=eB(f,r,c[f]);s.push(b)}if(t){const f=eB("indices",t);s.push(f)}return{fields:s,metadata:n}}function ioe(i){const e={};for(const t in i){const n=i[t];e[n.name||"undefined"]=n}return e}function eB(i,e,t){const n=t?M4(t.metadata):void 0;return X7(i,e,n)}function M4(i){Object.entries(i);const e={};for(const t in i)e[`${t}.string`]=JSON.stringify(i[t]);return e}const tB={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},noe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},roe=4;class soe{constructor(e){ce(this,"draco");ce(this,"decoder");ce(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const s=this.decoder.GetEncodedGeometryType(n),c=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let f;switch(s){case this.draco.TRIANGULAR_MESH:f=this.decoder.DecodeBufferToMesh(n,c);break;case this.draco.POINT_CLOUD:f=this.decoder.DecodeBufferToPointCloud(n,c);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!f.ok()||!c.ptr){const F=`DRACO decompression failed: ${f.error_msg()}`;throw new Error(F)}const r=this._getDracoLoaderData(c,s,t),b=this._getMeshData(c,r,t),w=G7(b.attributes),E=toe(b.attributes,r,b.indices);return{loader:"draco",loaderData:r,header:{vertexCount:c.num_points(),boundingBox:w},...b,schema:E}}finally{this.draco.destroy(n),c&&this.draco.destroy(c)}}_getDracoLoaderData(e,t,n){const s=this._getTopLevelMetadata(e),c=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:c}}_getDracoAttributes(e,t){const n={};for(let s=0;s<e.num_attributes();s++){const c=this.decoder.GetAttribute(e,s),f=this._getAttributeMetadata(e,s);n[c.unique_id()]={unique_id:c.unique_id(),attribute_type:c.attribute_type(),data_type:c.data_type(),num_components:c.num_components(),byte_offset:c.byte_offset(),byte_stride:c.byte_stride(),normalized:c.normalized(),attribute_index:s,metadata:f};const r=this._getQuantizationTransform(c,t);r&&(n[c.unique_id()].quantization_transform=r);const b=this._getOctahedronTransform(c,t);b&&(n[c.unique_id()].octahedron_transform=b)}return n}_getMeshData(e,t,n){const s=this._getMeshAttributes(t,e,n);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,t,n){const s={};for(const c of Object.values(e.attributes)){const f=this._deduceAttributeName(c,n);c.name=f;const r=this._getAttributeValues(t,c);if(r){const{value:b,size:w}=r;s[f]={value:b,size:w,byteOffset:c.byte_offset,byteStride:c.byte_stride,normalized:c.normalized}}}return s}_getTriangleListIndices(e){const n=e.num_faces()*3,s=n*roe,c=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(e,s,c),new Uint32Array(this.draco.HEAPF32.buffer,c,n).slice()}finally{this.draco._free(c)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),loe(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=noe[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const s=t.num_components,f=e.num_points()*s,r=f*n.BYTES_PER_ELEMENT,b=ooe(this.draco,n);let w;const E=this.draco._malloc(r);try{const k=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,k,b,r,E),w=new n(this.draco.HEAPF32.buffer,E,f).slice()}finally{this.draco._free(E)}return{value:w,size:s}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[f,r]of Object.entries(t.extraAttributes||{}))if(r===n)return f;const s=e.attribute_type;for(const f in tB)if(this.draco[f]===s)return tB[f];const c=t.attributeNameEntry||"name";return e.metadata[c]?e.metadata[c].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let s=0;s<n;s++){const c=this.metadataQuerier.GetEntryName(e,s);t[c]=this._getDracoMetadataField(e,c)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const s=aoe(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:s}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,s=[...t,...n];for(const c of s)this.decoder.SkipAttributeTransform(this.draco[c])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,s=e.attribute_type();if(n.map(f=>this.decoder[f]).includes(s)){const f=new this.draco.AttributeQuantizationTransform;try{if(f.InitFromAttribute(e))return{quantization_bits:f.quantization_bits(),range:f.range(),min_values:new Float32Array([1,2,3]).map(r=>f.min_value(r))}}finally{this.draco.destroy(f)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,s=e.attribute_type();if(n.map(f=>this.decoder[f]).includes(s)){const f=new this.draco.AttributeQuantizationTransform;try{if(f.InitFromAttribute(e))return{quantization_bits:f.quantization_bits()}}finally{this.draco.destroy(f)}}return null}}function ooe(i,e){switch(e){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32;default:return i.DT_INVALID}}function aoe(i){const e=i.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=i.GetValue(n);return t}function loe(i){const e=i.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=i.GetValue(n);return t}const coe="1.5.6",hoe="1.4.1",O2=`https://www.gstatic.com/draco/versioned/decoders/${coe}`,ea={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},F2={[ea.DECODER]:`${O2}/${ea.DECODER}`,[ea.DECODER_WASM]:`${O2}/${ea.DECODER_WASM}`,[ea.FALLBACK_DECODER]:`${O2}/${ea.FALLBACK_DECODER}`,[ea.ENCODER]:`https://raw.githubusercontent.com/google/draco/${hoe}/javascript/${ea.ENCODER}`};let L2;async function uoe(i){const e=i.modules||{};return e.draco3d?L2||(L2=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):L2||(L2=doe(i)),await L2}async function doe(i){let e,t;switch(i.draco&&i.draco.decoderType){case"js":e=await df(F2[ea.FALLBACK_DECODER],"draco",i,ea.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await df(F2[ea.DECODER],"draco",i,ea.DECODER),await df(F2[ea.DECODER_WASM],"draco",i,ea.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await foe(e,t)}function foe(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{i({...t,onModuleLoaded:s=>n({draco:s})})})}const poe={...eoe,parse:moe};async function moe(i,e){const{draco:t}=await uoe(e),n=new soe(t);try{return n.parseSync(i,e==null?void 0:e.draco)}finally{n.destroy()}}function goe(i){const e={};for(const t in i){const n=i[t];if(t!=="indices"){const s=R4(n);e[t]=s}}return e}function R4(i){const{buffer:e,size:t,count:n}=_oe(i);return{value:e,size:t,byteOffset:0,count:n,type:v4(t),componentType:Ew(e)}}function _oe(i){let e=i,t=1,n=0;return i&&i.value&&(e=i.value,t=i.size||1),e&&(ArrayBuffer.isView(e)||(e=yoe(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function yoe(i,e,t=!1){return i?Array.isArray(i)?new e(i):t&&!(i instanceof e)?new e(i):i:null}const Vu="KHR_draco_mesh_compression",boe=Vu;function voe(i,e,t){const n=new Ks(i);for(const s of k4(n))n.getObjectExtension(s,Vu)}async function xoe(i,e,t){var c;if(!((c=e==null?void 0:e.gltf)!=null&&c.decompressMeshes))return;const n=new Ks(i),s=[];for(const f of k4(n))n.getObjectExtension(f,Vu)&&s.push(Aoe(n,f,e,t));await Promise.all(s),n.removeExtension(Vu)}function woe(i,e={}){const t=new Ks(i);for(const n of t.json.meshes||[])Toe(n),t.addRequiredExtension(Vu)}async function Aoe(i,e,t,n){const s=i.getObjectExtension(e,Vu);if(!s)return;const c=i.getTypedArrayForBufferView(s.bufferView),f=pF(c.buffer,c.byteOffset),r={...t};delete r["3d-tiles"];const b=await oF(f,poe,r,n),w=goe(b.attributes);for(const[E,k]of Object.entries(w))if(E in e.attributes){const F=e.attributes[E],$=i.getAccessor(F);$!=null&&$.min&&($!=null&&$.max)&&(k.min=$.min,k.max=$.max)}e.attributes=w,b.indices&&(e.indices=R4(b.indices)),i.removeObjectExtension(e,Vu),Soe(e)}function Toe(i,e,t=4,n,s){var E;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const c=n.DracoWriter.encodeSync({attributes:i}),f=(E=s==null?void 0:s.parseSync)==null?void 0:E.call(s,{attributes:i}),r=n._addFauxAttributes(f.attributes),b=n.addBufferView(c);return{primitives:[{attributes:r,mode:t,extensions:{[Vu]:{bufferView:b,attributes:r}}}]}}function Soe(i){if(!i.attributes&&Object.keys(i.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*k4(i){for(const e of i.json.meshes||[])for(const t of e.primitives)yield t}const Eoe=Object.freeze(Object.defineProperty({__proto__:null,decode:xoe,encode:woe,name:boe,preprocess:voe},Symbol.toStringTag,{value:"Module"})),Mw="KHR_texture_transform",Coe=Mw,cx=new lo,Ioe=new I0,Moe=new I0;async function Roe(i,e){var c;if(!new Ks(i).hasExtension(Mw)||!((c=e.gltf)!=null&&c.loadBuffers))return;const s=i.json.materials||[];for(let f=0;f<s.length;f++)koe(f,i)}function koe(i,e){var c,f,r,b;const t=(c=e.json.materials)==null?void 0:c[i],n=[(f=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:f.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(r=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:r.metallicRoughnessTexture],s=[];for(const w of n)w&&((b=w==null?void 0:w.extensions)!=null&&b[Mw])&&Poe(e,i,w,s)}function Poe(i,e,t,n){const s=Doe(t,n);if(!s)return;const c=i.json.meshes||[];for(const f of c)for(const r of f.primitives){const b=r.material;Number.isFinite(b)&&e===b&&Boe(i,r,s)}}function Doe(i,e){var f;const t=(f=i.extensions)==null?void 0:f[Mw],{texCoord:n=0}=i,{texCoord:s=n}=t;if(!(e.findIndex(([r,b])=>r===n&&b===s)!==-1)){const r=Loe(t);return n!==s&&(i.texCoord=s),e.push([n,s]),{originalTexCoord:n,texCoord:s,matrix:r}}return null}function Boe(i,e,t){var r,b;const{originalTexCoord:n,texCoord:s,matrix:c}=t,f=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(f)){const w=(r=i.json.accessors)==null?void 0:r[f];if(w&&w.bufferView){const E=(b=i.json.bufferViews)==null?void 0:b[w.bufferView];if(E){const{arrayBuffer:k,byteOffset:F}=i.buffers[E.buffer],$=(F||0)+(w.byteOffset||0)+(E.byteOffset||0),{ArrayType:X,length:W}=zC(w,E),ne=b4[w.componentType],_e=y4[w.type],Te=E.byteStride||ne*_e,we=new Float32Array(W);for(let Ee=0;Ee<w.count;Ee++){const Le=new X(k,$+Ee*Te,2);cx.set(Le[0],Le[1],1),cx.transformByMatrix3(c),we.set([cx[0],cx[1]],Ee*_e)}n===s?Ooe(w,E,i.buffers,we):Foe(s,w,e,i,we)}}}}function Ooe(i,e,t,n){i.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Foe(i,e,t,n,s){n.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const c=n.json.bufferViews;if(!c)return;c.push({buffer:n.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const f=n.json.accessors;f&&(f.push({bufferView:(c==null?void 0:c.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${i}`]=f.length-1)}function Loe(i){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=i,s=new I0().set(1,0,0,0,1,0,e[0],e[1],1),c=Ioe.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),f=Moe.set(n[0],0,0,0,n[1],0,0,0,1);return s.multiplyRight(c).multiplyRight(f)}const zoe=Object.freeze(Object.defineProperty({__proto__:null,decode:Roe,name:Coe},Symbol.toStringTag,{value:"Module"})),lf="KHR_lights_punctual",Noe=lf;async function Uoe(i){const e=new Ks(i),{json:t}=e,n=e.getExtension(lf);n&&(e.json.lights=n.lights,e.removeExtension(lf));for(const s of t.nodes||[]){const c=e.getObjectExtension(s,lf);c&&(s.light=c.light),e.removeObjectExtension(s,lf)}}async function Voe(i){const e=new Ks(i),{json:t}=e;if(t.lights){const n=e.addExtension(lf);Oa(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const s=n.node;e.addObjectExtension(s,lf,n)}delete e.json.lights}}const $oe=Object.freeze(Object.defineProperty({__proto__:null,decode:Uoe,encode:Voe,name:Noe},Symbol.toStringTag,{value:"Module"})),a0="KHR_materials_unlit",joe=a0;async function Hoe(i){const e=new Ks(i),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,a0);e.removeExtension(a0)}function Woe(i){const e=new Ks(i),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,a0,{}),e.addExtension(a0))}const Goe=Object.freeze(Object.defineProperty({__proto__:null,decode:Hoe,encode:Woe,name:joe},Symbol.toStringTag,{value:"Module"})),dy="KHR_techniques_webgl",Xoe=dy;async function qoe(i){const e=new Ks(i),{json:t}=e,n=e.getExtension(dy);if(n){const s=Zoe(n,e);for(const c of t.materials||[]){const f=e.getObjectExtension(c,dy);f&&(c.technique=Object.assign({},f,s[f.technique]),c.technique.values=Koe(c.technique,e)),e.removeObjectExtension(c,dy)}e.removeExtension(dy)}}async function Yoe(i,e){}function Zoe(i,e){const{programs:t=[],shaders:n=[],techniques:s=[]}=i,c=new TextDecoder;return n.forEach(f=>{if(Number.isFinite(f.bufferView))f.code=c.decode(e.getTypedArrayForBufferView(f.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(f=>{f.fragmentShader=n[f.fragmentShader],f.vertexShader=n[f.vertexShader]}),s.forEach(f=>{f.program=t[f.program]}),s}function Koe(i,e){const t=Object.assign({},i.values);return Object.keys(i.uniforms||{}).forEach(n=>{i.uniforms[n].value&&!(n in t)&&(t[n]=i.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const Joe=Object.freeze(Object.defineProperty({__proto__:null,decode:qoe,encode:Yoe,name:Xoe},Symbol.toStringTag,{value:"Module"})),P4=[ise,Cre,Gse,Yse,Jse,Eoe,$oe,Goe,Joe,zoe,bse];function Qoe(i,e={},t){var s;const n=P4.filter(c=>D4(c.name,e));for(const c of n)(s=c.preprocess)==null||s.call(c,i,e,t)}async function eae(i,e={},t){var s;const n=P4.filter(c=>D4(c.name,e));for(const c of n)await((s=c.decode)==null?void 0:s.call(c,i,e,t))}function D4(i,e){var s;const t=((s=e==null?void 0:e.gltf)==null?void 0:s.excludeExtensions)||{};return!(i in t&&!t[i])}const z2="KHR_binary_glTF";function tae(i){const e=new Ks(i),{json:t}=e;for(const n of t.images||[]){const s=e.getObjectExtension(n,z2);s&&Object.assign(n,s),e.removeObjectExtension(n,z2)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(z2)}const iB={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},iae={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class nae{constructor(){ce(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});ce(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),tae(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in iB)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const s in n){const c=n[s];c.id=c.id||s;const f=e[t].length;e[t].push(c),this.idToIndexMap[t][s]=f}}}_convertObjectIdsToArrayIndices(e){for(const t in iB)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:s,material:c}=t;for(const f in n)n[f]=this._convertIdToIndex(n[f],"accessor");s&&(t.indices=this._convertIdToIndex(s,"accessor")),c&&(t.material=this._convertIdToIndex(c,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const s in n){const c=n[s],f=this._convertIdToIndex(c,s);n[s]=f}}_convertIdToIndex(e,t){const n=iae[t];if(n in this.idToIndexMap){const s=this.idToIndexMap[n][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return s}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,s;for(const c of e.materials){c.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const f=((t=c.values)==null?void 0:t.tex)||((n=c.values)==null?void 0:n.texture2d_0)||((s=c.values)==null?void 0:s.diffuseTex),r=e.textures.findIndex(b=>b.id===f);r!==-1&&(c.pbrMetallicRoughness.baseColorTexture={index:r})}}}function rae(i,e={}){return new nae().normalize(i,e)}async function sae(i,e,t=0,n,s){var c,f,r;return oae(i,e,t,n),rae(i,{normalize:(c=n==null?void 0:n.gltf)==null?void 0:c.normalize}),Qoe(i,n,s),(f=n==null?void 0:n.gltf)!=null&&f.loadBuffers&&i.json.buffers&&await aae(i,n,s),(r=n==null?void 0:n.gltf)!=null&&r.loadImages&&await lae(i,n,s),await eae(i,n,s),i}function oae(i,e,t,n){if(n.uri&&(i.baseUri=n.uri),e instanceof ArrayBuffer&&!Cse(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")i.json=F9(e);else if(e instanceof ArrayBuffer){const f={};t=Ise(f,e,t,n.glb),Oa(f.type==="glTF",`Invalid GLB magic string ${f.type}`),i._glb=f,i.json=f.json}else Oa(!1,"GLTF: must be ArrayBuffer or string");const s=i.json.buffers||[];if(i.buffers=new Array(s.length).fill(null),i._glb&&i._glb.header.hasBinChunk){const{binChunks:f}=i._glb;i.buffers[0]={arrayBuffer:f[0].arrayBuffer,byteOffset:f[0].byteOffset,byteLength:f[0].byteLength}}const c=i.json.images||[];i.images=new Array(c.length).fill({})}async function aae(i,e,t){var s,c;const n=i.json.buffers||[];for(let f=0;f<n.length;++f){const r=n[f];if(r.uri){const{fetch:b}=t;Oa(b);const w=I4(r.uri,e),E=await((s=t==null?void 0:t.fetch)==null?void 0:s.call(t,w)),k=await((c=E==null?void 0:E.arrayBuffer)==null?void 0:c.call(E));i.buffers[f]={arrayBuffer:k,byteOffset:0,byteLength:k.byteLength},delete r.uri}else i.buffers[f]===null&&(i.buffers[f]={arrayBuffer:new ArrayBuffer(r.byteLength),byteOffset:0,byteLength:r.byteLength})}}async function lae(i,e,t){const n=cae(i),s=i.json.images||[],c=[];for(const f of n)c.push(hae(i,s[f],f,e,t));return await Promise.all(c)}function cae(i){const e=new Set,t=i.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function hae(i,e,t,n,s){let c;if(e.uri&&!e.hasOwnProperty("bufferView")){const r=I4(e.uri,n),{fetch:b}=s;c=await(await b(r)).arrayBuffer(),e.bufferView={data:c}}if(Number.isFinite(e.bufferView)){const r=dre(i.json,i.buffers,e.bufferView);c=pF(r.buffer,r.byteOffset,r.byteLength)}Oa(c,"glTF image has no data");let f=await oF(c,[PF,$ne],{...n,mimeType:e.mimeType,basis:n.basis||{format:_4()}},s);f&&f[0]&&(f={compressed:!0,mipmaps:!1,width:f[0].width,height:f[0].height,data:f[0]}),i.images=i.images||[],i.images[t]=f}const fE={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:vse,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:uae,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function uae(i,e={},t){e={...fE.options,...e},e.gltf={...fE.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await sae({},i,n,e,t)}const dae={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},fae={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},sl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},pae={magFilter:sl.TEXTURE_MAG_FILTER,minFilter:sl.TEXTURE_MIN_FILTER,wrapS:sl.TEXTURE_WRAP_S,wrapT:sl.TEXTURE_WRAP_T},mae={[sl.TEXTURE_MAG_FILTER]:sl.LINEAR,[sl.TEXTURE_MIN_FILTER]:sl.NEAREST_MIPMAP_LINEAR,[sl.TEXTURE_WRAP_S]:sl.REPEAT,[sl.TEXTURE_WRAP_T]:sl.REPEAT};function gae(){return{id:"default-sampler",parameters:mae}}function _ae(i){return fae[i]}function yae(i){return dae[i]}class bae{constructor(){ce(this,"baseUri","");ce(this,"jsonUnprocessed");ce(this,"json");ce(this,"buffers",[]);ce(this,"images",[])}postProcess(e,t={}){const{json:n,buffers:s=[],images:c=[]}=e,{baseUri:f=""}=e;return Oa(n),this.baseUri=f,this.buffers=s,this.images=c,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((s,c)=>this._resolveBufferView(s,c))),e.images&&(n.images=e.images.map((s,c)=>this._resolveImage(s,c))),e.samplers&&(n.samplers=e.samplers.map((s,c)=>this._resolveSampler(s,c))),e.textures&&(n.textures=e.textures.map((s,c)=>this._resolveTexture(s,c))),e.accessors&&(n.accessors=e.accessors.map((s,c)=>this._resolveAccessor(s,c))),e.materials&&(n.materials=e.materials.map((s,c)=>this._resolveMaterial(s,c))),e.meshes&&(n.meshes=e.meshes.map((s,c)=>this._resolveMesh(s,c))),e.nodes&&(n.nodes=e.nodes.map((s,c)=>this._resolveNode(s,c)),n.nodes=n.nodes.map((s,c)=>this._resolveNodeChildren(s))),e.skins&&(n.skins=e.skins.map((s,c)=>this._resolveSkin(s,c))),e.scenes&&(n.scenes=e.scenes.map((s,c)=>this._resolveScene(s,c))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((s,c)=>{const f=this.getMesh(c);return s.id=f.id,s.primitives=s.primitives.concat(f.primitives),s},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(s=>{const c={...s,attributes:{},indices:void 0,material:void 0},f=s.attributes;for(const r in f)c.attributes[r]=this.getAccessor(f[r]);return s.indices!==void 0&&(c.indices=this.getAccessor(s.indices)),s.material!==void 0&&(c.material=this.getMaterial(s.material)),c})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const s=n.pbrMetallicRoughness;s.baseColorTexture&&(s.baseColorTexture={...s.baseColorTexture},s.baseColorTexture.texture=this.getTexture(s.baseColorTexture.index)),s.metallicRoughnessTexture&&(s.metallicRoughnessTexture={...s.metallicRoughnessTexture},s.metallicRoughnessTexture.texture=this.getTexture(s.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=_ae(e.componentType),s=yae(e.type),c=n*s,f={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:s,bytesPerElement:c,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(f.bufferView=this.getBufferView(e.bufferView)),f.bufferView){const r=f.bufferView.buffer,{ArrayType:b,byteLength:w}=zC(f,f.bufferView),E=(f.bufferView.byteOffset||0)+(f.byteOffset||0)+r.byteOffset;let k=r.arrayBuffer.slice(E,E+w);f.bufferView.byteStride&&(k=this._getValueFromInterleavedBuffer(r,E,f.bufferView.byteStride,f.bytesPerElement,f.count)),f.value=new b(k)}return f}_getValueFromInterleavedBuffer(e,t,n,s,c){const f=new Uint8Array(c*s);for(let r=0;r<c;r++){const b=t+r*n;f.set(new Uint8Array(e.arrayBuffer.slice(b,b+s)),r*s)}return f.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):gae(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const s in n){const c=this._enumSamplerParameter(s);c!==void 0&&(n.parameters[c]=n[s])}return n}_enumSamplerParameter(e){return pae[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},s=this.images[t];return s&&(n.image=s),n}_resolveBufferView(e,t){const n=e.buffer,s=this.buffers[n].arrayBuffer;let c=this.buffers[n].byteOffset||0;return e.byteOffset&&(c+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(s,c,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}}function vae(i,e){return new bae().postProcess(i,e)}async function xae(i){const e=[];return i.scenes.forEach(t=>{t.traverse(n=>{Object.values(n.model.uniforms).forEach(s=>{s.loaded===!1&&e.push(s)})})}),await wae(()=>e.some(t=>!t.loaded))}async function wae(i){for(;i();)await new Promise(e=>requestAnimationFrame(e))}const nB=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,Aae={name:"scenegraph",vs:nB,fs:nB,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},Tae=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Sae=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,B4=[255,255,255,255],Eae={scenegraph:{type:"object",value:null,async:!0},getScene:i=>i&&i.scenes?typeof i.scene=="object"?i.scene:i.scenes[i.scene||0]:i,getAnimator:i=>i&&i.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:B4},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[fE]};class N1 extends MC{getShaders(){const e={};let t;this.props._lighting==="pbr"?(t=LL,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};const n=[jZ,fK,Aae,t];return super.getShaders({defines:e,vs:Tae,fs:Sae,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:B4,transition:!0},instanceModelMatrix:Ane})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.scenegraph!==n.scenegraph?this._updateScenegraph():t._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.scenegraph)==null||t.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var r;const e=this.props,{device:t}=this.context;let n=null;if(e.scenegraph instanceof I1)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const b=e.scenegraph,w=b.json?vae(b):b,E=ore(t,w,this._getModelOptions());n={gltf:w,...E},xae(E).then(()=>{this.setNeedsRedraw()}).catch(k=>{this.raiseError(k,"loading glTF")})}const s={layer:this,device:this.context.device},c=e.getScene(n,s),f=e.getAnimator(n,s);if(c instanceof wm){(r=this.state.scenegraph)==null||r.destroy(),this._applyAnimationsProp(f,e._animations);const b=[];c.traverse(w=>{w instanceof YS&&b.push(w.model)}),this.setState({scenegraph:c,animator:f,models:b}),this.getAttributeManager().invalidateAll()}else c!==null&&gr.warn("invalid scenegraph:",c)()}_applyAnimationsProp(e,t){if(!e||!t)return;const n=e.getAnimations();Object.keys(t).sort().forEach(s=>{const c=t[s];if(s==="*")n.forEach(f=>{Object.assign(f,c)});else if(Number.isFinite(Number(s))){const f=Number(s);f>=0&&f<n.length?Object.assign(n[f],c):gr.warn(`animation ${s} not found`)()}else{const f=n.find(({name:r})=>r===s);f?Object.assign(f,c):gr.warn(`animation ${s} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:t,renderPass:n}=this.context,{sizeScale:s,sizeMinPixels:c,sizeMaxPixels:f,coordinateSystem:r}=this.props,b=this.getNumInstances();this.state.scenegraph.traverse((w,{worldMatrix:E})=>{if(w instanceof YS){const{model:k}=w;k.setInstanceCount(b);const F={camera:k.uniforms.cameraPosition},$={sizeScale:s,sizeMinPixels:c,sizeMaxPixels:f,composeModelMatrix:Tne(t,r),sceneModelMatrix:E};k.shaderInputs.setProps({pbrProjection:F,scenegraph:$}),k.draw(n)}})}}N1.defaultProps=Eae;N1.layerName="ScenegraphLayer";const hx="/mapbox-tracking/";class Cae{constructor(e="map"){this.containerId=e,this.map=null,this.deckOverlay=null,this.destroy$=new zm,this.trackData=[],this.playIndex=0,this.didFitBoundsInRepeat=!1,this.eventIcons=[{name:"reserved",url:`${hx}icons/reserved.png`},{name:"landing",url:`${hx}icons/landing.png`},{name:"drop",url:`${hx}icons/drop.png`},{name:"get",url:`${hx}icons/get.png`}],Qp.accessToken="pk.eyJ1Ijoibm92YWthbmQiLCJhIjoiY2p3OXFlYnYwMDF3eTQxcW5qenZ2eGNoNCJ9.PTZDfrwxfMd-hAwzZjwPTg",this.defaultLayerOrder=["track-points-full-layer","heading-lines-layer","track-path-layer","track-points-labels","track-points-circles"],this.layerOrder=[...this.defaultLayerOrder]}initMap(){this.map=new Qp.Map({container:this.containerId,projection:"mercator",style:"mapbox://styles/mapbox/streets-v12",center:[37.6176,55.7558],zoom:3,pitch:0,bearing:0}),this.deckOverlay=new Eie({interleaved:!0,layers:[]}),this.map.on("load",()=>{var t,n;this.map.addControl(this.deckOverlay),this.map.dragRotate.disable(),this.map.touchZoomRotate.disableRotation(),this.map.doubleClickZoom.disable(),this.map.keyboard.disableRotation(),this._setupTrackSubscription();const e=document.getElementById("languageSelect");e&&(this.setMapLanguage(this.currentLang),e.addEventListener("sl-change",s=>{const c=s.target.value;this.currentLang=c,this.setMapLanguage(c)})),this.modelPopup=new Qp.Popup({closeButton:!1,closeOnClick:!1}),this.loadIcons(this.map,this.eventIcons),this.routeVisible=!0,this.headingVisible=!1,this.pointsVisible=!1,this.toggleRouteSwitch=document.getElementById("toggleRoute"),this.toggleHeadingSwitch=document.getElementById("toggleHeading"),this.togglePointsSwitch=document.getElementById("togglePoint"),(t=this.toggleRouteSwitch)==null||t.addEventListener("sl-change",s=>{this.routeVisible=s.target.checked,this._updateLayerVisibility()}),(n=this.toggleHeadingSwitch)==null||n.addEventListener("sl-change",s=>{this.headingVisible=s.target.checked,this._updateLayerVisibility()}),this.togglePointsSwitch.addEventListener("sl-change",s=>{this.pointsVisible=s.target.checked,this._updateLayerVisibility()})}),this.map.on("styledata",()=>{this.setMapLanguage(this.currentLang)})}setMapLanguage(e){if(!this.map||!this.map.getStyle())return;const t=["coalesce",["get",`name_${e}`],["get","name_en"],["get","name"]],n=this.map.getStyle().layers;Array.isArray(n)&&n.forEach(s=>{if(s.type==="symbol"&&typeof s.id=="string"&&s.id.endsWith("-label"))try{this.map.setLayoutProperty(s.id,"text-field",t)}catch{}})}loadIcon(e,t,n,s=64,c=64){return new Promise((f,r)=>{if(e.hasImage(t)){f();return}const b=new Image;b.crossOrigin="anonymous",b.onload=async()=>{try{const w=await createImageBitmap(b,{resizeWidth:s,resizeHeight:c,resizeQuality:"high"});e.addImage(t,w),f()}catch(w){r(w)}},b.onerror=()=>{r(new Error(`    : ${n}`))},b.src=n.startsWith("http")?n:location.origin+n})}loadIcons(e,t){const n=t.map(s=>this.loadIcon(e,s.name,s.url));return Promise.all(n).then(()=>{}).catch(s=>(console.error(" Error:",s),Promise.reject(s)))}setLayerOrder(e){if(!Array.isArray(e)){console.error("Layer order must be an array");return}const t=this.defaultLayerOrder.filter(n=>!e.includes(n));if(t.length>0){console.error(`Missing layers in new order: ${t.join(", ")}`);return}this.layerOrder=e,this.map&&this._applyLayerOrder()}getLayerOrder(){return[...this.layerOrder]}resetLayerOrder(){this.layerOrder=[...this.defaultLayerOrder],this.map&&this._applyLayerOrder()}safeAddLayer(e,t,n){try{if(n&&e.getLayer(n)?e.addLayer(t,n):e.addLayer(t),t.id==="track-points-full-layer"&&!this._hoverListenersAttached){this._hoverListenersAttached=!0;const s=new Qp.Popup({closeButton:!0,closeOnClick:!0});e.on("click","track-points-full-layer",c=>{e.getCanvas().style.cursor="pointer";const f=c.features[0].geometry.coordinates.slice(),r=c.features[0].properties,b=Object.entries(r).map(([w,E])=>`${w}: ${typeof E=="object"?JSON.stringify(E):E}`).join("<br>");if(["mercator","equirectangular"].includes(e.getProjection().name))for(;Math.abs(c.lngLat.lng-f[0])>180;)f[0]+=c.lngLat.lng>f[0]?360:-360;s.setLngLat(f).setHTML(b).addTo(e)})}}catch(s){console.warn(`Failed to add layer ${t.id}`,s)}}_applyLayerOrder(e){const t=this.layerOrder.filter(n=>this.map.getLayer(n));for(let n=t.length-1;n>0;n--){const s=t[n],c=t[n-1];try{this.map.getLayer(s)&&this.map.getLayer(c)&&this.map.moveLayer(s,c)}catch(f){console.warn(`Cannot move layer ${s} before ${c}`,f)}}}calcAvgAltitude(e,t){const n=e.altitude!=null?e.altitude:0,s=t.altitude!=null?t.altitude:0;return(n+s)/2}_updateLayerVisibility(){this.map.getLayer("track-path-layer")&&this.map.setLayoutProperty("track-path-layer","visibility",this.routeVisible?"visible":"none"),this.map.getLayer("heading-lines-layer")&&this.map.setLayoutProperty("heading-lines-layer","visibility",this.headingVisible?"visible":"none"),this.map.getLayer("track-points-full-layer")&&this.map.setLayoutProperty("track-points-full-layer","visibility",this.pointsVisible?"visible":"none")}_clearPreviousLayersAndMarkers(){const t=["track-path-layer","heading-lines-layer",...["track-points-circles","track-points-labels","track-points-full-layer","events-layer"]],n=["track-path","heading-lines","track-points","track-points-full","events-source"];for(const s of t)this.map.getLayer(s)&&this.map.removeLayer(s);for(const s of n)this.map.getSource(s)&&this.map.removeSource(s);this.deckOverlay.setProps({layers:[]})}_setupTrackSubscription(){FC.vehicleTrack$.pipe(p4(300),m4(this.destroy$),d4(e=>e&&e.vehicleId&&e.data),cE(e=>{this._isRepeat=e.isRepeat,e.isRepeat?(this.shouldFitBounds=!this.didFitBoundsInRepeat,this.didFitBoundsInRepeat=!0):(this.shouldFitBounds=!0,this.didFitBoundsInRepeat=!1)}),D0(e=>e.data.features),cE(()=>LC.hide()),OC((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{if(!e||e.length===0){this.trackData=[],this.deckOverlay.setProps({layers:[]}),this._clearPreviousLayersAndMarkers();return}this.trackData=e.map((X,W,ne)=>{var Je,Tt,_t;const[_e,Te]=X.geometry.coordinates,we=[_e,Te],Ee=X.properties.direct_angle;let Le=null;if(Ee!=null&&!isNaN(Ee))Le=Ee;else{const St=(_t=(Tt=(Je=ne[W+1])==null?void 0:Je.geometry)==null?void 0:Tt.coordinates)==null?void 0:_t.slice(0,2);St&&(Le=this.calculateAngle(we,St))}return{coordinates:we,timestamp:X.properties.timestamp,direct_angle:Le,...X.properties}}),this.playIndex=0;const t={type:"FeatureCollection",features:this.trackData.map((X,W)=>({type:"Feature",geometry:{type:"Point",coordinates:X.coordinates},properties:{...X}}))},n=[];for(let X=0;X<this.trackData.length-1;X++){const W=this.trackData[X],ne=this.trackData[X+1],_e=this.calcAvgAltitude(W,ne);n.push({type:"Feature",geometry:{type:"LineString",coordinates:[W.coordinates,ne.coordinates]},properties:{avgAltitude:_e}})}this.trackData.map(X=>X.coordinates);const s={type:"FeatureCollection",features:n};this.map.getSource("track-path")?(this.map.getSource("track-path").setData(s),this.map.setPaintProperty("track-path-layer","line-color",["step",["get","avgAltitude"],"#000000",200,"#800000",400,"#0000FF",600,"#00BFFF",800,"#00BFFF"])):(this.map.addSource("track-path",{type:"geojson",data:s}),this.map.addLayer({id:"track-path-layer",type:"line",source:"track-path",layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":4,"line-color":["step",["get","avgAltitude"],"#000000",200,"#800000",400,"#0000FF",600,"#00BFFF",800,"#00BFFF"]}}));const f={type:"FeatureCollection",features:this.trackData.filter(X=>X.direct_angle!=null).map(X=>{const[W,ne]=X.coordinates,_e=X.direct_angle*Math.PI/180,Te=.05*Math.sin(_e),we=.05*Math.cos(_e);return{type:"Feature",geometry:{type:"LineString",coordinates:[[W,ne],[W+Te,ne+we]]},properties:{suspicious:X.suspicious}}})};this.map.getSource("heading-lines")?this.map.getSource("heading-lines").setData(f):(this.map.addSource("heading-lines",{type:"geojson",data:f}),this.map.addLayer({id:"heading-lines-layer",type:"line",source:"heading-lines",paint:{"line-color":["case",["boolean",["get","suspicious"],!1],"#ff0000","#00ff00"],"line-width":2}})),this.map.getSource("track-points-full")?this.map.getSource("track-points-full").setData(t):(this.map.addSource("track-points-full",{type:"geojson",data:t}),this.safeAddLayer(this.map,{id:"track-points-full-layer",type:"circle",source:"track-points-full",paint:{"circle-radius":5,"circle-color":"#ffffff","circle-stroke-width":1,"circle-stroke-color":"#007bff"}}));const r=[],b=(X,W,ne)=>{const{coordinates:_e,...Te}=ne;return{type:"Feature",geometry:{type:"Point",coordinates:X},properties:{iconName:W,...Te}}};let w=null;for(let X=0;X<this.trackData.length;X++){const W=this.trackData[X],ne=this.trackData[X-1];W.fly&&W.fly!==w&&(W.fly==="reserved"||W.fly==="landing")&&(w===null&&W.fly==="reserved"||w==="reserved"&&W.fly==="landing"||w==="landing"&&W.fly==="reserved")&&(r.push(b(W.coordinates,W.fly,W)),w=W.fly),W.waterfall==="active"&&(ne==null?void 0:ne.waterfall)!=="active"&&W.waterup!=="active"&&r.push(b(W.coordinates,"drop",W)),W.waterup==="active"&&W.waterup!==(ne==null?void 0:ne.waterup)&&W.waterfall!=="active"&&r.push(b(W.coordinates,"get",W))}const E={type:"FeatureCollection",features:r};this.map.getSource("events-source")?this.map.getSource("events-source").setData(E):(this.map.addSource("events-source",{type:"geojson",data:E}),this.map.addLayer({id:"events-layer",type:"symbol",source:"events-source",layout:{"icon-image":["get","iconName"],"icon-size":.5,"icon-allow-overlap":!0}}));const k=new Qp.Popup({closeButton:!0,closeOnClick:!0});this.map.on("click","events-layer",X=>{this.map.getCanvas().style.cursor="pointer";const W=X.features[0].geometry.coordinates.slice(),ne=X.features[0].properties,_e=Object.entries(ne).filter(([Te])=>Te!=="iconName").map(([Te,we])=>`${Te}: ${typeof we=="object"?JSON.stringify(we):we}`).join("<br>");if(["mercator","equirectangular"].includes(this.map.getProjection().name))for(;Math.abs(X.lngLat.lng-W[0])>180;)W[0]+=X.lngLat.lng>W[0]?360:-360;k.setLngLat(W).setHTML(_e).addTo(this.map)}),this._updateLayerVisibility(),this._applyLayerOrder(this.layerOrder);const F=new N1({id:"model-layer",data:[this.trackData[this._isRepeat?this.trackData.length-1:0]],scenegraph:"/mapbox-tracking/models/test.glb",getPosition:X=>[X.coordinates[0],X.coordinates[1],0],getOrientation:X=>[0,-X.direct_angle+180,90],getColor:X=>X.suspicious?[255,0,0]:[255,255,255],pickable:!0,getTooltip:({object:X})=>this._getTooltip(X),sizeScale:6,sizeMinPixels:4,sizeMaxPixels:1.8,_lighting:"pbr",_animations:{"*":{speed:0}}});this.deckOverlay.setProps({layers:[F],getTooltip:()=>null});const $=this.trackData.reduce((X,W)=>X.extend(W.coordinates),new Qp.LngLatBounds(this.trackData[0].coordinates,this.trackData[0].coordinates));this.map.fitBounds($,{padding:200,maxZoom:15,duration:1e3}),this.shouldFitBounds=!1})}_getTooltip(e){return e?{text:Object.entries(e).map(([n,s])=>`${n}: ${s}`).join(`
`)}:null}_updateModel(e){if(!e)return;const n={type:"FeatureCollection",features:this.trackData.filter(f=>f.direct_angle!=null).map(f=>{const[r,b]=f.coordinates,w=f.direct_angle*Math.PI/180,E=.05*Math.sin(w),k=.05*Math.cos(w);return{type:"Feature",geometry:{type:"LineString",coordinates:[[r,b],[r+E,b+k]]},properties:{suspicious:f.suspicious}}})};this.map.getSource("heading-lines")?this.map.getSource("heading-lines").setData(n):(this.map.addSource("heading-lines",{type:"geojson",data:n}),this.map.addLayer({id:"heading-lines-layer",type:"line",source:"heading-lines",paint:{"line-color":["case",["boolean",["get","suspicious"],!1],"#ff0000","#00ff00"],"line-width":2}}));const s=(e==null?void 0:e.speed)??0,c=new N1({id:"model-layer",data:[e],scenegraph:"/mapbox-tracking/models/test.glb",getPosition:f=>[f.coordinates[0],f.coordinates[1],0],getOrientation:f=>[0,-f.direct_angle+180,90],pickable:!0,getTooltip:({object:f})=>this._getTooltip(f),sizeScale:6,sizeMinPixels:4,sizeMaxPixels:1.8,getColor:f=>{const r=f==null?void 0:f.speed;return r==null||r===0?[180,180,180]:[255,255,255]},sizeMinPixels:8,sizeMaxPixels:1.8,_lighting:"pbr",_animations:{"*":{speed:s>0?Math.max(s/20,.2):0}}});this.deckOverlay.setProps({layers:[c],getTooltip:()=>null})}calculateAngle(e,t){const[n,s]=e,[c,f]=t,r=c-n,b=f-s;return(Math.atan2(r,b)*180/Math.PI+360)%360}destroy(){this.destroy$.next(),this.destroy$.complete(),this.map&&(this.map.remove(),this.map=null)}}var N2=["onChange","onClose","onDayCreate","onDestroy","onKeyDown","onMonthChange","onOpen","onParseConfig","onReady","onValueUpdate","onYearChange","onPreCalendarPosition"],Em={_disable:[],allowInput:!1,allowInvalidPreload:!1,altFormat:"F j, Y",altInput:!1,altInputClass:"form-control input",animate:typeof window=="object"&&window.navigator.userAgent.indexOf("MSIE")===-1,ariaDateFormat:"F j, Y",autoFillDefaultTime:!0,clickOpens:!0,closeOnSelect:!0,conjunction:", ",dateFormat:"Y-m-d",defaultHour:12,defaultMinute:0,defaultSeconds:0,disable:[],disableMobile:!1,enableSeconds:!1,enableTime:!1,errorHandler:function(i){return typeof console<"u"&&console.warn(i)},getWeek:function(i){var e=new Date(i.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)},hourIncrement:1,ignoredFocusElements:[],inline:!1,locale:"default",minuteIncrement:5,mode:"single",monthSelectorType:"dropdown",nextArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M13.207 8.472l-7.854 7.854-0.707-0.707 7.146-7.146-7.146-7.148 0.707-0.707 7.854 7.854z' /></svg>",noCalendar:!1,now:new Date,onChange:[],onClose:[],onDayCreate:[],onDestroy:[],onKeyDown:[],onMonthChange:[],onOpen:[],onParseConfig:[],onReady:[],onValueUpdate:[],onYearChange:[],onPreCalendarPosition:[],plugins:[],position:"auto",positionElement:void 0,prevArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M5.207 8.471l7.146 7.147-0.707 0.707-7.853-7.854 7.854-7.853 0.707 0.707-7.147 7.146z' /></svg>",shorthandCurrentMonth:!1,showMonths:1,static:!1,time_24hr:!1,weekNumbers:!1,wrap:!1},l0={weekdays:{shorthand:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longhand:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{shorthand:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longhand:["January","February","March","April","May","June","July","August","September","October","November","December"]},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0,ordinal:function(i){var e=i%100;if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},rangeSeparator:" to ",weekAbbreviation:"Wk",scrollTitle:"Scroll to increment",toggleTitle:"Click to toggle",amPM:["AM","PM"],yearAriaLabel:"Year",monthAriaLabel:"Month",hourAriaLabel:"Hour",minuteAriaLabel:"Minute",time_24hr:!1},ta=function(i,e){return e===void 0&&(e=2),("000"+i).slice(e*-1)},rl=function(i){return i===!0?1:0};function rB(i,e){var t;return function(){var n=this,s=arguments;clearTimeout(t),t=setTimeout(function(){return i.apply(n,s)},e)}}var U2=function(i){return i instanceof Array?i:[i]};function Lo(i,e,t){if(t===!0)return i.classList.add(e);i.classList.remove(e)}function dr(i,e,t){var n=window.document.createElement(i);return e=e||"",t=t||"",n.className=e,t!==void 0&&(n.textContent=t),n}function ux(i){for(;i.firstChild;)i.removeChild(i.firstChild)}function O4(i,e){if(e(i))return i;if(i.parentNode)return O4(i.parentNode,e)}function dx(i,e){var t=dr("div","numInputWrapper"),n=dr("input","numInput "+i),s=dr("span","arrowUp"),c=dr("span","arrowDown");if(navigator.userAgent.indexOf("MSIE 9.0")===-1?n.type="number":(n.type="text",n.pattern="\\d*"),e!==void 0)for(var f in e)n.setAttribute(f,e[f]);return t.appendChild(n),t.appendChild(s),t.appendChild(c),t}function Ca(i){try{if(typeof i.composedPath=="function"){var e=i.composedPath();return e[0]}return i.target}catch{return i.target}}var V2=function(){},U1=function(i,e,t){return t.months[e?"shorthand":"longhand"][i]},Iae={D:V2,F:function(i,e,t){i.setMonth(t.months.longhand.indexOf(e))},G:function(i,e){i.setHours((i.getHours()>=12?12:0)+parseFloat(e))},H:function(i,e){i.setHours(parseFloat(e))},J:function(i,e){i.setDate(parseFloat(e))},K:function(i,e,t){i.setHours(i.getHours()%12+12*rl(new RegExp(t.amPM[1],"i").test(e)))},M:function(i,e,t){i.setMonth(t.months.shorthand.indexOf(e))},S:function(i,e){i.setSeconds(parseFloat(e))},U:function(i,e){return new Date(parseFloat(e)*1e3)},W:function(i,e,t){var n=parseInt(e),s=new Date(i.getFullYear(),0,2+(n-1)*7,0,0,0,0);return s.setDate(s.getDate()-s.getDay()+t.firstDayOfWeek),s},Y:function(i,e){i.setFullYear(parseFloat(e))},Z:function(i,e){return new Date(e)},d:function(i,e){i.setDate(parseFloat(e))},h:function(i,e){i.setHours((i.getHours()>=12?12:0)+parseFloat(e))},i:function(i,e){i.setMinutes(parseFloat(e))},j:function(i,e){i.setDate(parseFloat(e))},l:V2,m:function(i,e){i.setMonth(parseFloat(e)-1)},n:function(i,e){i.setMonth(parseFloat(e)-1)},s:function(i,e){i.setSeconds(parseFloat(e))},u:function(i,e){return new Date(parseFloat(e))},w:V2,y:function(i,e){i.setFullYear(2e3+parseFloat(e))}},nf={D:"",F:"",G:"(\\d\\d|\\d)",H:"(\\d\\d|\\d)",J:"(\\d\\d|\\d)\\w+",K:"",M:"",S:"(\\d\\d|\\d)",U:"(.+)",W:"(\\d\\d|\\d)",Y:"(\\d{4})",Z:"(.+)",d:"(\\d\\d|\\d)",h:"(\\d\\d|\\d)",i:"(\\d\\d|\\d)",j:"(\\d\\d|\\d)",l:"",m:"(\\d\\d|\\d)",n:"(\\d\\d|\\d)",s:"(\\d\\d|\\d)",u:"(.+)",w:"(\\d\\d|\\d)",y:"(\\d{2})"},zy={Z:function(i){return i.toISOString()},D:function(i,e,t){return e.weekdays.shorthand[zy.w(i,e,t)]},F:function(i,e,t){return U1(zy.n(i,e,t)-1,!1,e)},G:function(i,e,t){return ta(zy.h(i,e,t))},H:function(i){return ta(i.getHours())},J:function(i,e){return e.ordinal!==void 0?i.getDate()+e.ordinal(i.getDate()):i.getDate()},K:function(i,e){return e.amPM[rl(i.getHours()>11)]},M:function(i,e){return U1(i.getMonth(),!0,e)},S:function(i){return ta(i.getSeconds())},U:function(i){return i.getTime()/1e3},W:function(i,e,t){return t.getWeek(i)},Y:function(i){return ta(i.getFullYear(),4)},d:function(i){return ta(i.getDate())},h:function(i){return i.getHours()%12?i.getHours()%12:12},i:function(i){return ta(i.getMinutes())},j:function(i){return i.getDate()},l:function(i,e){return e.weekdays.longhand[i.getDay()]},m:function(i){return ta(i.getMonth()+1)},n:function(i){return i.getMonth()+1},s:function(i){return i.getSeconds()},u:function(i){return i.getTime()},w:function(i){return i.getDay()},y:function(i){return String(i.getFullYear()).substring(2)}},F4=function(i){var e=i.config,t=e===void 0?Em:e,n=i.l10n,s=n===void 0?l0:n,c=i.isMobile,f=c===void 0?!1:c;return function(r,b,w){var E=w||s;return t.formatDate!==void 0&&!f?t.formatDate(r,b,E):b.split("").map(function(k,F,$){return zy[k]&&$[F-1]!=="\\"?zy[k](r,E,t):k!=="\\"?k:""}).join("")}},pE=function(i){var e=i.config,t=e===void 0?Em:e,n=i.l10n,s=n===void 0?l0:n;return function(c,f,r,b){if(!(c!==0&&!c)){var w=b||s,E,k=c;if(c instanceof Date)E=new Date(c.getTime());else if(typeof c!="string"&&c.toFixed!==void 0)E=new Date(c);else if(typeof c=="string"){var F=f||(t||Em).dateFormat,$=String(c).trim();if($==="today")E=new Date,r=!0;else if(t&&t.parseDate)E=t.parseDate(c,F);else if(/Z$/.test($)||/GMT$/.test($))E=new Date(c);else{for(var X=void 0,W=[],ne=0,_e=0,Te="";ne<F.length;ne++){var we=F[ne],Ee=we==="\\",Le=F[ne-1]==="\\"||Ee;if(nf[we]&&!Le){Te+=nf[we];var Je=new RegExp(Te).exec(c);Je&&(X=!0)&&W[we!=="Y"?"push":"unshift"]({fn:Iae[we],val:Je[++_e]})}else Ee||(Te+=".")}E=!t||!t.noCalendar?new Date(new Date().getFullYear(),0,1,0,0,0,0):new Date(new Date().setHours(0,0,0,0)),W.forEach(function(Tt){var _t=Tt.fn,St=Tt.val;return E=_t(E,St,w)||E}),E=X?E:void 0}}if(!(E instanceof Date&&!isNaN(E.getTime()))){t.errorHandler(new Error("Invalid date provided: "+k));return}return r===!0&&E.setHours(0,0,0,0),E}}};function Ma(i,e,t){return t===void 0&&(t=!0),t!==!1?new Date(i.getTime()).setHours(0,0,0,0)-new Date(e.getTime()).setHours(0,0,0,0):i.getTime()-e.getTime()}var Mae=function(i,e,t){return i>Math.min(e,t)&&i<Math.max(e,t)},$2=function(i,e,t){return i*3600+e*60+t},Rae=function(i){var e=Math.floor(i/3600),t=(i-e*3600)/60;return[e,t,i-e*3600-t*60]},kae={DAY:864e5};function j2(i){var e=i.defaultHour,t=i.defaultMinute,n=i.defaultSeconds;if(i.minDate!==void 0){var s=i.minDate.getHours(),c=i.minDate.getMinutes(),f=i.minDate.getSeconds();e<s&&(e=s),e===s&&t<c&&(t=c),e===s&&t===c&&n<f&&(n=i.minDate.getSeconds())}if(i.maxDate!==void 0){var r=i.maxDate.getHours(),b=i.maxDate.getMinutes();e=Math.min(e,r),e===r&&(t=Math.min(b,t)),e===r&&t===b&&(n=i.maxDate.getSeconds())}return{hours:e,minutes:t,seconds:n}}typeof Object.assign!="function"&&(Object.assign=function(i){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];if(!i)throw TypeError("Cannot convert undefined or null to object");for(var n=function(r){r&&Object.keys(r).forEach(function(b){return i[b]=r[b]})},s=0,c=e;s<c.length;s++){var f=c[s];n(f)}return i});var Co=function(){return Co=Object.assign||function(i){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},Co.apply(this,arguments)},sB=function(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;for(var n=Array(i),s=0,e=0;e<t;e++)for(var c=arguments[e],f=0,r=c.length;f<r;f++,s++)n[s]=c[f];return n},Pae=300;function Dae(i,e){var t={config:Co(Co({},Em),Ts.defaultConfig),l10n:l0};t.parseDate=pE({config:t.config,l10n:t.l10n}),t._handlers=[],t.pluginElements=[],t.loadedPlugins=[],t._bind=W,t._setHoursFromDate=F,t._positionCalendar=ls,t.changeMonth=Gr,t.changeYear=rr,t.clear=Js,t.close=mo,t.onMouseOver=fs,t._createElement=dr,t.createDay=Je,t.destroy=Is,t.isEnabled=go,t.jumpToDate=Te,t.updateValue=Nr,t.open=Wu,t.redraw=$o,t.set=Lc,t.setDate=Zl,t.toggle=jo;function n(){t.utils={getDaysInMonth:function(ke,ue){return ke===void 0&&(ke=t.currentMonth),ue===void 0&&(ue=t.currentYear),ke===1&&(ue%4===0&&ue%100!==0||ue%400===0)?29:t.l10n.daysInMonth[ke]}}}function s(){t.element=t.input=i,t.isOpen=!1,ps(),la(),Ms(),ha(),n(),t.isMobile||Le(),_e(),(t.selectedDates.length||t.config.noCalendar)&&(t.config.enableTime&&F(t.config.noCalendar?t.latestSelectedDateObj:void 0),Nr(!1)),r();var ke=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);!t.isMobile&&ke&&ls(),er("onReady")}function c(){var ke;return((ke=t.calendarContainer)===null||ke===void 0?void 0:ke.getRootNode()).activeElement||document.activeElement}function f(ke){return ke.bind(t)}function r(){var ke=t.config;ke.weekNumbers===!1&&ke.showMonths===1||ke.noCalendar!==!0&&window.requestAnimationFrame(function(){if(t.calendarContainer!==void 0&&(t.calendarContainer.style.visibility="hidden",t.calendarContainer.style.display="block"),t.daysContainer!==void 0){var ue=(t.days.offsetWidth+1)*ke.showMonths;t.daysContainer.style.width=ue+"px",t.calendarContainer.style.width=ue+(t.weekWrapper!==void 0?t.weekWrapper.offsetWidth:0)+"px",t.calendarContainer.style.removeProperty("visibility"),t.calendarContainer.style.removeProperty("display")}})}function b(ke){if(t.selectedDates.length===0){var ue=t.config.minDate===void 0||Ma(new Date,t.config.minDate)>=0?new Date:new Date(t.config.minDate.getTime()),st=j2(t.config);ue.setHours(st.hours,st.minutes,st.seconds,ue.getMilliseconds()),t.selectedDates=[ue],t.latestSelectedDateObj=ue}ke!==void 0&&ke.type!=="blur"&&Mh(ke);var Pt=t._input.value;k(),Nr(),t._input.value!==Pt&&t._debouncedChange()}function w(ke,ue){return ke%12+12*rl(ue===t.l10n.amPM[1])}function E(ke){switch(ke%24){case 0:case 12:return 12;default:return ke%12}}function k(){if(!(t.hourElement===void 0||t.minuteElement===void 0)){var ke=(parseInt(t.hourElement.value.slice(-2),10)||0)%24,ue=(parseInt(t.minuteElement.value,10)||0)%60,st=t.secondElement!==void 0?(parseInt(t.secondElement.value,10)||0)%60:0;t.amPM!==void 0&&(ke=w(ke,t.amPM.textContent));var Pt=t.config.minTime!==void 0||t.config.minDate&&t.minDateHasTime&&t.latestSelectedDateObj&&Ma(t.latestSelectedDateObj,t.config.minDate,!0)===0,Oe=t.config.maxTime!==void 0||t.config.maxDate&&t.maxDateHasTime&&t.latestSelectedDateObj&&Ma(t.latestSelectedDateObj,t.config.maxDate,!0)===0;if(t.config.maxTime!==void 0&&t.config.minTime!==void 0&&t.config.minTime>t.config.maxTime){var H=$2(t.config.minTime.getHours(),t.config.minTime.getMinutes(),t.config.minTime.getSeconds()),te=$2(t.config.maxTime.getHours(),t.config.maxTime.getMinutes(),t.config.maxTime.getSeconds()),oe=$2(ke,ue,st);if(oe>te&&oe<H){var Ae=Rae(H);ke=Ae[0],ue=Ae[1],st=Ae[2]}}else{if(Oe){var ye=t.config.maxTime!==void 0?t.config.maxTime:t.config.maxDate;ke=Math.min(ke,ye.getHours()),ke===ye.getHours()&&(ue=Math.min(ue,ye.getMinutes())),ue===ye.getMinutes()&&(st=Math.min(st,ye.getSeconds()))}if(Pt){var Me=t.config.minTime!==void 0?t.config.minTime:t.config.minDate;ke=Math.max(ke,Me.getHours()),ke===Me.getHours()&&ue<Me.getMinutes()&&(ue=Me.getMinutes()),ue===Me.getMinutes()&&(st=Math.max(st,Me.getSeconds()))}}$(ke,ue,st)}}function F(ke){var ue=ke||t.latestSelectedDateObj;ue&&ue instanceof Date&&$(ue.getHours(),ue.getMinutes(),ue.getSeconds())}function $(ke,ue,st){t.latestSelectedDateObj!==void 0&&t.latestSelectedDateObj.setHours(ke%24,ue,st||0,0),!(!t.hourElement||!t.minuteElement||t.isMobile)&&(t.hourElement.value=ta(t.config.time_24hr?ke:(12+ke)%12+12*rl(ke%12===0)),t.minuteElement.value=ta(ue),t.amPM!==void 0&&(t.amPM.textContent=t.l10n.amPM[rl(ke>=12)]),t.secondElement!==void 0&&(t.secondElement.value=ta(st)))}function X(ke){var ue=Ca(ke),st=parseInt(ue.value)+(ke.delta||0);(st/1e3>1||ke.key==="Enter"&&!/[^\d]/.test(st.toString()))&&rr(st)}function W(ke,ue,st,Pt){if(ue instanceof Array)return ue.forEach(function(Oe){return W(ke,Oe,st,Pt)});if(ke instanceof Array)return ke.forEach(function(Oe){return W(Oe,ue,st,Pt)});ke.addEventListener(ue,st,Pt),t._handlers.push({remove:function(){return ke.removeEventListener(ue,st,Pt)}})}function ne(){er("onChange")}function _e(){if(t.config.wrap&&["open","close","toggle","clear"].forEach(function(st){Array.prototype.forEach.call(t.element.querySelectorAll("[data-"+st+"]"),function(Pt){return W(Pt,"click",t[st])})}),t.isMobile){Ga();return}var ke=rB(sr,50);if(t._debouncedChange=rB(ne,Pae),t.daysContainer&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)&&W(t.daysContainer,"mouseover",function(st){t.config.mode==="range"&&fs(Ca(st))}),W(t._input,"keydown",aa),t.calendarContainer!==void 0&&W(t.calendarContainer,"keydown",aa),!t.config.inline&&!t.config.static&&W(window,"resize",ke),window.ontouchstart!==void 0?W(window.document,"touchstart",cn):W(window.document,"mousedown",cn),W(window.document,"focus",cn,{capture:!0}),t.config.clickOpens===!0&&(W(t._input,"focus",t.open),W(t._input,"click",t.open)),t.daysContainer!==void 0&&(W(t.monthNav,"click",zc),W(t.monthNav,["keyup","increment"],X),W(t.daysContainer,"click",ms)),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0){var ue=function(st){return Ca(st).select()};W(t.timeContainer,["increment"],b),W(t.timeContainer,"blur",b,{capture:!0}),W(t.timeContainer,"click",we),W([t.hourElement,t.minuteElement],["focus","click"],ue),t.secondElement!==void 0&&W(t.secondElement,"focus",function(){return t.secondElement&&t.secondElement.select()}),t.amPM!==void 0&&W(t.amPM,"click",function(st){b(st)})}t.config.allowInput&&W(t._input,"blur",Yl)}function Te(ke,ue){var st=ke!==void 0?t.parseDate(ke):t.latestSelectedDateObj||(t.config.minDate&&t.config.minDate>t.now?t.config.minDate:t.config.maxDate&&t.config.maxDate<t.now?t.config.maxDate:t.now),Pt=t.currentYear,Oe=t.currentMonth;try{st!==void 0&&(t.currentYear=st.getFullYear(),t.currentMonth=st.getMonth())}catch(H){H.message="Invalid date supplied: "+st,t.config.errorHandler(H)}ue&&t.currentYear!==Pt&&(er("onYearChange"),bi()),ue&&(t.currentYear!==Pt||t.currentMonth!==Oe)&&er("onMonthChange"),t.redraw()}function we(ke){var ue=Ca(ke);~ue.className.indexOf("arrow")&&Ee(ke,ue.classList.contains("arrowUp")?1:-1)}function Ee(ke,ue,st){var Pt=ke&&Ca(ke),Oe=st||Pt&&Pt.parentNode&&Pt.parentNode.firstChild,H=ua("increment");H.delta=ue,Oe&&Oe.dispatchEvent(H)}function Le(){var ke=window.document.createDocumentFragment();if(t.calendarContainer=dr("div","flatpickr-calendar"),t.calendarContainer.tabIndex=-1,!t.config.noCalendar){if(ke.appendChild(Zi()),t.innerContainer=dr("div","flatpickr-innerContainer"),t.config.weekNumbers){var ue=Qi(),st=ue.weekWrapper,Pt=ue.weekNumbers;t.innerContainer.appendChild(st),t.weekNumbers=Pt,t.weekWrapper=st}t.rContainer=dr("div","flatpickr-rContainer"),t.rContainer.appendChild(nr()),t.daysContainer||(t.daysContainer=dr("div","flatpickr-days"),t.daysContainer.tabIndex=-1),si(),t.rContainer.appendChild(t.daysContainer),t.innerContainer.appendChild(t.rContainer),ke.appendChild(t.innerContainer)}t.config.enableTime&&ke.appendChild(Cn()),Lo(t.calendarContainer,"rangeMode",t.config.mode==="range"),Lo(t.calendarContainer,"animate",t.config.animate===!0),Lo(t.calendarContainer,"multiMonth",t.config.showMonths>1),t.calendarContainer.appendChild(ke);var Oe=t.config.appendTo!==void 0&&t.config.appendTo.nodeType!==void 0;if((t.config.inline||t.config.static)&&(t.calendarContainer.classList.add(t.config.inline?"inline":"static"),t.config.inline&&(!Oe&&t.element.parentNode?t.element.parentNode.insertBefore(t.calendarContainer,t._input.nextSibling):t.config.appendTo!==void 0&&t.config.appendTo.appendChild(t.calendarContainer)),t.config.static)){var H=dr("div","flatpickr-wrapper");t.element.parentNode&&t.element.parentNode.insertBefore(H,t.element),H.appendChild(t.element),t.altInput&&H.appendChild(t.altInput),H.appendChild(t.calendarContainer)}!t.config.static&&!t.config.inline&&(t.config.appendTo!==void 0?t.config.appendTo:window.document.body).appendChild(t.calendarContainer)}function Je(ke,ue,st,Pt){var Oe=go(ue,!0),H=dr("span",ke,ue.getDate().toString());return H.dateObj=ue,H.$i=Pt,H.setAttribute("aria-label",t.formatDate(ue,t.config.ariaDateFormat)),ke.indexOf("hidden")===-1&&Ma(ue,t.now)===0&&(t.todayDateElem=H,H.classList.add("today"),H.setAttribute("aria-current","date")),Oe?(H.tabIndex=-1,ml(ue)&&(H.classList.add("selected"),t.selectedDateElem=H,t.config.mode==="range"&&(Lo(H,"startRange",t.selectedDates[0]&&Ma(ue,t.selectedDates[0],!0)===0),Lo(H,"endRange",t.selectedDates[1]&&Ma(ue,t.selectedDates[1],!0)===0),ke==="nextMonthDay"&&H.classList.add("inRange")))):H.classList.add("flatpickr-disabled"),t.config.mode==="range"&&On(ue)&&!ml(ue)&&H.classList.add("inRange"),t.weekNumbers&&t.config.showMonths===1&&ke!=="prevMonthDay"&&Pt%7===6&&t.weekNumbers.insertAdjacentHTML("beforeend","<span class='flatpickr-day'>"+t.config.getWeek(ue)+"</span>"),er("onDayCreate",H),H}function Tt(ke){ke.focus(),t.config.mode==="range"&&fs(ke)}function _t(ke){for(var ue=ke>0?0:t.config.showMonths-1,st=ke>0?t.config.showMonths:-1,Pt=ue;Pt!=st;Pt+=ke)for(var Oe=t.daysContainer.children[Pt],H=ke>0?0:Oe.children.length-1,te=ke>0?Oe.children.length:-1,oe=H;oe!=te;oe+=ke){var Ae=Oe.children[oe];if(Ae.className.indexOf("hidden")===-1&&go(Ae.dateObj))return Ae}}function St(ke,ue){for(var st=ke.className.indexOf("Month")===-1?ke.dateObj.getMonth():t.currentMonth,Pt=ue>0?t.config.showMonths:-1,Oe=ue>0?1:-1,H=st-t.currentMonth;H!=Pt;H+=Oe)for(var te=t.daysContainer.children[H],oe=st-t.currentMonth===H?ke.$i+ue:ue<0?te.children.length-1:0,Ae=te.children.length,ye=oe;ye>=0&&ye<Ae&&ye!=(ue>0?Ae:-1);ye+=Oe){var Me=te.children[ye];if(Me.className.indexOf("hidden")===-1&&go(Me.dateObj)&&Math.abs(ke.$i-ye)>=Math.abs(ue))return Tt(Me)}t.changeMonth(Oe),kt(_t(Oe),0)}function kt(ke,ue){var st=c(),Pt=jn(st||document.body),Oe=ke!==void 0?ke:Pt?st:t.selectedDateElem!==void 0&&jn(t.selectedDateElem)?t.selectedDateElem:t.todayDateElem!==void 0&&jn(t.todayDateElem)?t.todayDateElem:_t(ue>0?1:-1);Oe===void 0?t._input.focus():Pt?St(Oe,ue):Tt(Oe)}function Lt(ke,ue){for(var st=(new Date(ke,ue,1).getDay()-t.l10n.firstDayOfWeek+7)%7,Pt=t.utils.getDaysInMonth((ue-1+12)%12,ke),Oe=t.utils.getDaysInMonth(ue,ke),H=window.document.createDocumentFragment(),te=t.config.showMonths>1,oe=te?"prevMonthDay hidden":"prevMonthDay",Ae=te?"nextMonthDay hidden":"nextMonthDay",ye=Pt+1-st,Me=0;ye<=Pt;ye++,Me++)H.appendChild(Je("flatpickr-day "+oe,new Date(ke,ue-1,ye),ye,Me));for(ye=1;ye<=Oe;ye++,Me++)H.appendChild(Je("flatpickr-day",new Date(ke,ue,ye),ye,Me));for(var De=Oe+1;De<=42-st&&(t.config.showMonths===1||Me%7!==0);De++,Me++)H.appendChild(Je("flatpickr-day "+Ae,new Date(ke,ue+1,De%Oe),De,Me));var ze=dr("div","dayContainer");return ze.appendChild(H),ze}function si(){if(t.daysContainer!==void 0){ux(t.daysContainer),t.weekNumbers&&ux(t.weekNumbers);for(var ke=document.createDocumentFragment(),ue=0;ue<t.config.showMonths;ue++){var st=new Date(t.currentYear,t.currentMonth,1);st.setMonth(t.currentMonth+ue),ke.appendChild(Lt(st.getFullYear(),st.getMonth()))}t.daysContainer.appendChild(ke),t.days=t.daysContainer.firstChild,t.config.mode==="range"&&t.selectedDates.length===1&&fs()}}function bi(){if(!(t.config.showMonths>1||t.config.monthSelectorType!=="dropdown")){var ke=function(Pt){return t.config.minDate!==void 0&&t.currentYear===t.config.minDate.getFullYear()&&Pt<t.config.minDate.getMonth()?!1:!(t.config.maxDate!==void 0&&t.currentYear===t.config.maxDate.getFullYear()&&Pt>t.config.maxDate.getMonth())};t.monthsDropdownContainer.tabIndex=-1,t.monthsDropdownContainer.innerHTML="";for(var ue=0;ue<12;ue++)if(ke(ue)){var st=dr("option","flatpickr-monthDropdown-month");st.value=new Date(t.currentYear,ue).getMonth().toString(),st.textContent=U1(ue,t.config.shorthandCurrentMonth,t.l10n),st.tabIndex=-1,t.currentMonth===ue&&(st.selected=!0),t.monthsDropdownContainer.appendChild(st)}}}function ii(){var ke=dr("div","flatpickr-month"),ue=window.document.createDocumentFragment(),st;t.config.showMonths>1||t.config.monthSelectorType==="static"?st=dr("span","cur-month"):(t.monthsDropdownContainer=dr("select","flatpickr-monthDropdown-months"),t.monthsDropdownContainer.setAttribute("aria-label",t.l10n.monthAriaLabel),W(t.monthsDropdownContainer,"change",function(te){var oe=Ca(te),Ae=parseInt(oe.value,10);t.changeMonth(Ae-t.currentMonth),er("onMonthChange")}),bi(),st=t.monthsDropdownContainer);var Pt=dx("cur-year",{tabindex:"-1"}),Oe=Pt.getElementsByTagName("input")[0];Oe.setAttribute("aria-label",t.l10n.yearAriaLabel),t.config.minDate&&Oe.setAttribute("min",t.config.minDate.getFullYear().toString()),t.config.maxDate&&(Oe.setAttribute("max",t.config.maxDate.getFullYear().toString()),Oe.disabled=!!t.config.minDate&&t.config.minDate.getFullYear()===t.config.maxDate.getFullYear());var H=dr("div","flatpickr-current-month");return H.appendChild(st),H.appendChild(Pt),ue.appendChild(H),ke.appendChild(ue),{container:ke,yearElement:Oe,monthElement:st}}function vi(){ux(t.monthNav),t.monthNav.appendChild(t.prevMonthNav),t.config.showMonths&&(t.yearElements=[],t.monthElements=[]);for(var ke=t.config.showMonths;ke--;){var ue=ii();t.yearElements.push(ue.yearElement),t.monthElements.push(ue.monthElement),t.monthNav.appendChild(ue.container)}t.monthNav.appendChild(t.nextMonthNav)}function Zi(){return t.monthNav=dr("div","flatpickr-months"),t.yearElements=[],t.monthElements=[],t.prevMonthNav=dr("span","flatpickr-prev-month"),t.prevMonthNav.innerHTML=t.config.prevArrow,t.nextMonthNav=dr("span","flatpickr-next-month"),t.nextMonthNav.innerHTML=t.config.nextArrow,vi(),Object.defineProperty(t,"_hidePrevMonthArrow",{get:function(){return t.__hidePrevMonthArrow},set:function(ke){t.__hidePrevMonthArrow!==ke&&(Lo(t.prevMonthNav,"flatpickr-disabled",ke),t.__hidePrevMonthArrow=ke)}}),Object.defineProperty(t,"_hideNextMonthArrow",{get:function(){return t.__hideNextMonthArrow},set:function(ke){t.__hideNextMonthArrow!==ke&&(Lo(t.nextMonthNav,"flatpickr-disabled",ke),t.__hideNextMonthArrow=ke)}}),t.currentYearElement=t.yearElements[0],Qs(),t.monthNav}function Cn(){t.calendarContainer.classList.add("hasTime"),t.config.noCalendar&&t.calendarContainer.classList.add("noCalendar");var ke=j2(t.config);t.timeContainer=dr("div","flatpickr-time"),t.timeContainer.tabIndex=-1;var ue=dr("span","flatpickr-time-separator",":"),st=dx("flatpickr-hour",{"aria-label":t.l10n.hourAriaLabel});t.hourElement=st.getElementsByTagName("input")[0];var Pt=dx("flatpickr-minute",{"aria-label":t.l10n.minuteAriaLabel});if(t.minuteElement=Pt.getElementsByTagName("input")[0],t.hourElement.tabIndex=t.minuteElement.tabIndex=-1,t.hourElement.value=ta(t.latestSelectedDateObj?t.latestSelectedDateObj.getHours():t.config.time_24hr?ke.hours:E(ke.hours)),t.minuteElement.value=ta(t.latestSelectedDateObj?t.latestSelectedDateObj.getMinutes():ke.minutes),t.hourElement.setAttribute("step",t.config.hourIncrement.toString()),t.minuteElement.setAttribute("step",t.config.minuteIncrement.toString()),t.hourElement.setAttribute("min",t.config.time_24hr?"0":"1"),t.hourElement.setAttribute("max",t.config.time_24hr?"23":"12"),t.hourElement.setAttribute("maxlength","2"),t.minuteElement.setAttribute("min","0"),t.minuteElement.setAttribute("max","59"),t.minuteElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(st),t.timeContainer.appendChild(ue),t.timeContainer.appendChild(Pt),t.config.time_24hr&&t.timeContainer.classList.add("time24hr"),t.config.enableSeconds){t.timeContainer.classList.add("hasSeconds");var Oe=dx("flatpickr-second");t.secondElement=Oe.getElementsByTagName("input")[0],t.secondElement.value=ta(t.latestSelectedDateObj?t.latestSelectedDateObj.getSeconds():ke.seconds),t.secondElement.setAttribute("step",t.minuteElement.getAttribute("step")),t.secondElement.setAttribute("min","0"),t.secondElement.setAttribute("max","59"),t.secondElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(dr("span","flatpickr-time-separator",":")),t.timeContainer.appendChild(Oe)}return t.config.time_24hr||(t.amPM=dr("span","flatpickr-am-pm",t.l10n.amPM[rl((t.latestSelectedDateObj?t.hourElement.value:t.config.defaultHour)>11)]),t.amPM.title=t.l10n.toggleTitle,t.amPM.tabIndex=-1,t.timeContainer.appendChild(t.amPM)),t.timeContainer}function nr(){t.weekdayContainer?ux(t.weekdayContainer):t.weekdayContainer=dr("div","flatpickr-weekdays");for(var ke=t.config.showMonths;ke--;){var ue=dr("div","flatpickr-weekdaycontainer");t.weekdayContainer.appendChild(ue)}return vr(),t.weekdayContainer}function vr(){if(t.weekdayContainer){var ke=t.l10n.firstDayOfWeek,ue=sB(t.l10n.weekdays.shorthand);ke>0&&ke<ue.length&&(ue=sB(ue.splice(ke,ue.length),ue.splice(0,ke)));for(var st=t.config.showMonths;st--;)t.weekdayContainer.children[st].innerHTML=`
      <span class='flatpickr-weekday'>
        `+ue.join("</span><span class='flatpickr-weekday'>")+`
      </span>
      `}}function Qi(){t.calendarContainer.classList.add("hasWeeks");var ke=dr("div","flatpickr-weekwrapper");ke.appendChild(dr("span","flatpickr-weekday",t.l10n.weekAbbreviation));var ue=dr("div","flatpickr-weeks");return ke.appendChild(ue),{weekWrapper:ke,weekNumbers:ue}}function Gr(ke,ue){ue===void 0&&(ue=!0);var st=ue?ke:ke-t.currentMonth;st<0&&t._hidePrevMonthArrow===!0||st>0&&t._hideNextMonthArrow===!0||(t.currentMonth+=st,(t.currentMonth<0||t.currentMonth>11)&&(t.currentYear+=t.currentMonth>11?1:-1,t.currentMonth=(t.currentMonth+12)%12,er("onYearChange"),bi()),si(),er("onMonthChange"),Qs())}function Js(ke,ue){if(ke===void 0&&(ke=!0),ue===void 0&&(ue=!0),t.input.value="",t.altInput!==void 0&&(t.altInput.value=""),t.mobileInput!==void 0&&(t.mobileInput.value=""),t.selectedDates=[],t.latestSelectedDateObj=void 0,ue===!0&&(t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth()),t.config.enableTime===!0){var st=j2(t.config),Pt=st.hours,Oe=st.minutes,H=st.seconds;$(Pt,Oe,H)}t.redraw(),ke&&er("onChange")}function mo(){t.isOpen=!1,t.isMobile||(t.calendarContainer!==void 0&&t.calendarContainer.classList.remove("open"),t._input!==void 0&&t._input.classList.remove("active")),er("onClose")}function Is(){t.config!==void 0&&er("onDestroy");for(var ke=t._handlers.length;ke--;)t._handlers[ke].remove();if(t._handlers=[],t.mobileInput)t.mobileInput.parentNode&&t.mobileInput.parentNode.removeChild(t.mobileInput),t.mobileInput=void 0;else if(t.calendarContainer&&t.calendarContainer.parentNode)if(t.config.static&&t.calendarContainer.parentNode){var ue=t.calendarContainer.parentNode;if(ue.lastChild&&ue.removeChild(ue.lastChild),ue.parentNode){for(;ue.firstChild;)ue.parentNode.insertBefore(ue.firstChild,ue);ue.parentNode.removeChild(ue)}}else t.calendarContainer.parentNode.removeChild(t.calendarContainer);t.altInput&&(t.input.type="text",t.altInput.parentNode&&t.altInput.parentNode.removeChild(t.altInput),delete t.altInput),t.input&&(t.input.type=t.input._type,t.input.classList.remove("flatpickr-input"),t.input.removeAttribute("readonly")),["_showTimeInput","latestSelectedDateObj","_hideNextMonthArrow","_hidePrevMonthArrow","__hideNextMonthArrow","__hidePrevMonthArrow","isMobile","isOpen","selectedDateElem","minDateHasTime","maxDateHasTime","days","daysContainer","_input","_positionElement","innerContainer","rContainer","monthNav","todayDateElem","calendarContainer","weekdayContainer","prevMonthNav","nextMonthNav","monthsDropdownContainer","currentMonthElement","currentYearElement","navigationCurrentMonth","selectedDateElem","config"].forEach(function(st){try{delete t[st]}catch{}})}function on(ke){return t.calendarContainer.contains(ke)}function cn(ke){if(t.isOpen&&!t.config.inline){var ue=Ca(ke),st=on(ue),Pt=ue===t.input||ue===t.altInput||t.element.contains(ue)||ke.path&&ke.path.indexOf&&(~ke.path.indexOf(t.input)||~ke.path.indexOf(t.altInput)),Oe=!Pt&&!st&&!on(ke.relatedTarget),H=!t.config.ignoredFocusElements.some(function(te){return te.contains(ue)});Oe&&H&&(t.config.allowInput&&t.setDate(t._input.value,!1,t.config.altInput?t.config.altFormat:t.config.dateFormat),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0&&t.input.value!==""&&t.input.value!==void 0&&b(),t.close(),t.config&&t.config.mode==="range"&&t.selectedDates.length===1&&t.clear(!1))}}function rr(ke){if(!(!ke||t.config.minDate&&ke<t.config.minDate.getFullYear()||t.config.maxDate&&ke>t.config.maxDate.getFullYear())){var ue=ke,st=t.currentYear!==ue;t.currentYear=ue||t.currentYear,t.config.maxDate&&t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth=Math.min(t.config.maxDate.getMonth(),t.currentMonth):t.config.minDate&&t.currentYear===t.config.minDate.getFullYear()&&(t.currentMonth=Math.max(t.config.minDate.getMonth(),t.currentMonth)),st&&(t.redraw(),er("onYearChange"),bi())}}function go(ke,ue){var st;ue===void 0&&(ue=!0);var Pt=t.parseDate(ke,void 0,ue);if(t.config.minDate&&Pt&&Ma(Pt,t.config.minDate,ue!==void 0?ue:!t.minDateHasTime)<0||t.config.maxDate&&Pt&&Ma(Pt,t.config.maxDate,ue!==void 0?ue:!t.maxDateHasTime)>0)return!1;if(!t.config.enable&&t.config.disable.length===0)return!0;if(Pt===void 0)return!1;for(var Oe=!!t.config.enable,H=(st=t.config.enable)!==null&&st!==void 0?st:t.config.disable,te=0,oe=void 0;te<H.length;te++){if(oe=H[te],typeof oe=="function"&&oe(Pt))return Oe;if(oe instanceof Date&&Pt!==void 0&&oe.getTime()===Pt.getTime())return Oe;if(typeof oe=="string"){var Ae=t.parseDate(oe,void 0,!0);return Ae&&Ae.getTime()===Pt.getTime()?Oe:!Oe}else if(typeof oe=="object"&&Pt!==void 0&&oe.from&&oe.to&&Pt.getTime()>=oe.from.getTime()&&Pt.getTime()<=oe.to.getTime())return Oe}return!Oe}function jn(ke){return t.daysContainer!==void 0?ke.className.indexOf("hidden")===-1&&ke.className.indexOf("flatpickr-disabled")===-1&&t.daysContainer.contains(ke):!1}function Yl(ke){var ue=ke.target===t._input,st=t._input.value.trimEnd()!==Xa();ue&&st&&!(ke.relatedTarget&&on(ke.relatedTarget))&&t.setDate(t._input.value,!0,ke.target===t.altInput?t.config.altFormat:t.config.dateFormat)}function aa(ke){var ue=Ca(ke),st=t.config.wrap?i.contains(ue):ue===t._input,Pt=t.config.allowInput,Oe=t.isOpen&&(!Pt||!st),H=t.config.inline&&st&&!Pt;if(ke.keyCode===13&&st){if(Pt)return t.setDate(t._input.value,!0,ue===t.altInput?t.config.altFormat:t.config.dateFormat),t.close(),ue.blur();t.open()}else if(on(ue)||Oe||H){var te=!!t.timeContainer&&t.timeContainer.contains(ue);switch(ke.keyCode){case 13:te?(ke.preventDefault(),b(),ca()):ms(ke);break;case 27:ke.preventDefault(),ca();break;case 8:case 46:st&&!t.config.allowInput&&(ke.preventDefault(),t.clear());break;case 37:case 39:if(!te&&!st){ke.preventDefault();var oe=c();if(t.daysContainer!==void 0&&(Pt===!1||oe&&jn(oe))){var Ae=ke.keyCode===39?1:-1;ke.ctrlKey?(ke.stopPropagation(),Gr(Ae),kt(_t(1),0)):kt(void 0,Ae)}}else t.hourElement&&t.hourElement.focus();break;case 38:case 40:ke.preventDefault();var ye=ke.keyCode===40?1:-1;t.daysContainer&&ue.$i!==void 0||ue===t.input||ue===t.altInput?ke.ctrlKey?(ke.stopPropagation(),rr(t.currentYear-ye),kt(_t(1),0)):te||kt(void 0,ye*7):ue===t.currentYearElement?rr(t.currentYear-ye):t.config.enableTime&&(!te&&t.hourElement&&t.hourElement.focus(),b(ke),t._debouncedChange());break;case 9:if(te){var Me=[t.hourElement,t.minuteElement,t.secondElement,t.amPM].concat(t.pluginElements).filter(function(We){return We}),De=Me.indexOf(ue);if(De!==-1){var ze=Me[De+(ke.shiftKey?-1:1)];ke.preventDefault(),(ze||t._input).focus()}}else!t.config.noCalendar&&t.daysContainer&&t.daysContainer.contains(ue)&&ke.shiftKey&&(ke.preventDefault(),t._input.focus());break}}if(t.amPM!==void 0&&ue===t.amPM)switch(ke.key){case t.l10n.amPM[0].charAt(0):case t.l10n.amPM[0].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[0],k(),Nr();break;case t.l10n.amPM[1].charAt(0):case t.l10n.amPM[1].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[1],k(),Nr();break}(st||on(ue))&&er("onKeyDown",ke)}function fs(ke,ue){if(ue===void 0&&(ue="flatpickr-day"),!(t.selectedDates.length!==1||ke&&(!ke.classList.contains(ue)||ke.classList.contains("flatpickr-disabled")))){for(var st=ke?ke.dateObj.getTime():t.days.firstElementChild.dateObj.getTime(),Pt=t.parseDate(t.selectedDates[0],void 0,!0).getTime(),Oe=Math.min(st,t.selectedDates[0].getTime()),H=Math.max(st,t.selectedDates[0].getTime()),te=!1,oe=0,Ae=0,ye=Oe;ye<H;ye+=kae.DAY)go(new Date(ye),!0)||(te=te||ye>Oe&&ye<H,ye<Pt&&(!oe||ye>oe)?oe=ye:ye>Pt&&(!Ae||ye<Ae)&&(Ae=ye));var Me=Array.from(t.rContainer.querySelectorAll("*:nth-child(-n+"+t.config.showMonths+") > ."+ue));Me.forEach(function(De){var ze=De.dateObj,We=ze.getTime(),nt=oe>0&&We<oe||Ae>0&&We>Ae;if(nt){De.classList.add("notAllowed"),["inRange","startRange","endRange"].forEach(function(Ge){De.classList.remove(Ge)});return}else if(te&&!nt)return;["startRange","inRange","endRange","notAllowed"].forEach(function(Ge){De.classList.remove(Ge)}),ke!==void 0&&(ke.classList.add(st<=t.selectedDates[0].getTime()?"startRange":"endRange"),Pt<st&&We===Pt?De.classList.add("startRange"):Pt>st&&We===Pt&&De.classList.add("endRange"),We>=oe&&(Ae===0||We<=Ae)&&Mae(We,Pt,st)&&De.classList.add("inRange"))})}}function sr(){t.isOpen&&!t.config.static&&!t.config.inline&&ls()}function Wu(ke,ue){if(ue===void 0&&(ue=t._positionElement),t.isMobile===!0){if(ke){ke.preventDefault();var st=Ca(ke);st&&st.blur()}t.mobileInput!==void 0&&(t.mobileInput.focus(),t.mobileInput.click()),er("onOpen");return}else if(t._input.disabled||t.config.inline)return;var Pt=t.isOpen;t.isOpen=!0,Pt||(t.calendarContainer.classList.add("open"),t._input.classList.add("active"),er("onOpen"),ls(ue)),t.config.enableTime===!0&&t.config.noCalendar===!0&&t.config.allowInput===!1&&(ke===void 0||!t.timeContainer.contains(ke.relatedTarget))&&setTimeout(function(){return t.hourElement.select()},50)}function $a(ke){return function(ue){var st=t.config["_"+ke+"Date"]=t.parseDate(ue,t.config.dateFormat),Pt=t.config["_"+(ke==="min"?"max":"min")+"Date"];st!==void 0&&(t[ke==="min"?"minDateHasTime":"maxDateHasTime"]=st.getHours()>0||st.getMinutes()>0||st.getSeconds()>0),t.selectedDates&&(t.selectedDates=t.selectedDates.filter(function(Oe){return go(Oe)}),!t.selectedDates.length&&ke==="min"&&F(st),Nr()),t.daysContainer&&($o(),st!==void 0?t.currentYearElement[ke]=st.getFullYear().toString():t.currentYearElement.removeAttribute(ke),t.currentYearElement.disabled=!!Pt&&st!==void 0&&Pt.getFullYear()===st.getFullYear())}}function ps(){var ke=["wrap","weekNumbers","allowInput","allowInvalidPreload","clickOpens","time_24hr","enableTime","noCalendar","altInput","shorthandCurrentMonth","inline","static","enableSeconds","disableMobile"],ue=Co(Co({},JSON.parse(JSON.stringify(i.dataset||{}))),e),st={};t.config.parseDate=ue.parseDate,t.config.formatDate=ue.formatDate,Object.defineProperty(t.config,"enable",{get:function(){return t.config._enable},set:function(Me){t.config._enable=Po(Me)}}),Object.defineProperty(t.config,"disable",{get:function(){return t.config._disable},set:function(Me){t.config._disable=Po(Me)}});var Pt=ue.mode==="time";if(!ue.dateFormat&&(ue.enableTime||Pt)){var Oe=Ts.defaultConfig.dateFormat||Em.dateFormat;st.dateFormat=ue.noCalendar||Pt?"H:i"+(ue.enableSeconds?":S":""):Oe+" H:i"+(ue.enableSeconds?":S":"")}if(ue.altInput&&(ue.enableTime||Pt)&&!ue.altFormat){var H=Ts.defaultConfig.altFormat||Em.altFormat;st.altFormat=ue.noCalendar||Pt?"h:i"+(ue.enableSeconds?":S K":" K"):H+(" h:i"+(ue.enableSeconds?":S":"")+" K")}Object.defineProperty(t.config,"minDate",{get:function(){return t.config._minDate},set:$a("min")}),Object.defineProperty(t.config,"maxDate",{get:function(){return t.config._maxDate},set:$a("max")});var te=function(Me){return function(De){t.config[Me==="min"?"_minTime":"_maxTime"]=t.parseDate(De,"H:i:S")}};Object.defineProperty(t.config,"minTime",{get:function(){return t.config._minTime},set:te("min")}),Object.defineProperty(t.config,"maxTime",{get:function(){return t.config._maxTime},set:te("max")}),ue.mode==="time"&&(t.config.noCalendar=!0,t.config.enableTime=!0),Object.assign(t.config,st,ue);for(var oe=0;oe<ke.length;oe++)t.config[ke[oe]]=t.config[ke[oe]]===!0||t.config[ke[oe]]==="true";N2.filter(function(Me){return t.config[Me]!==void 0}).forEach(function(Me){t.config[Me]=U2(t.config[Me]||[]).map(f)}),t.isMobile=!t.config.disableMobile&&!t.config.inline&&t.config.mode==="single"&&!t.config.disable.length&&!t.config.enable&&!t.config.weekNumbers&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);for(var oe=0;oe<t.config.plugins.length;oe++){var Ae=t.config.plugins[oe](t)||{};for(var ye in Ae)N2.indexOf(ye)>-1?t.config[ye]=U2(Ae[ye]).map(f).concat(t.config[ye]):typeof ue[ye]>"u"&&(t.config[ye]=Ae[ye])}ue.altInputClass||(t.config.altInputClass=Vo().className+" "+t.config.altInputClass),er("onParseConfig")}function Vo(){return t.config.wrap?i.querySelector("[data-input]"):i}function la(){typeof t.config.locale!="object"&&typeof Ts.l10ns[t.config.locale]>"u"&&t.config.errorHandler(new Error("flatpickr: invalid locale "+t.config.locale)),t.l10n=Co(Co({},Ts.l10ns.default),typeof t.config.locale=="object"?t.config.locale:t.config.locale!=="default"?Ts.l10ns[t.config.locale]:void 0),nf.D="("+t.l10n.weekdays.shorthand.join("|")+")",nf.l="("+t.l10n.weekdays.longhand.join("|")+")",nf.M="("+t.l10n.months.shorthand.join("|")+")",nf.F="("+t.l10n.months.longhand.join("|")+")",nf.K="("+t.l10n.amPM[0]+"|"+t.l10n.amPM[1]+"|"+t.l10n.amPM[0].toLowerCase()+"|"+t.l10n.amPM[1].toLowerCase()+")";var ke=Co(Co({},e),JSON.parse(JSON.stringify(i.dataset||{})));ke.time_24hr===void 0&&Ts.defaultConfig.time_24hr===void 0&&(t.config.time_24hr=t.l10n.time_24hr),t.formatDate=F4(t),t.parseDate=pE({config:t.config,l10n:t.l10n})}function ls(ke){if(typeof t.config.position=="function")return void t.config.position(t,ke);if(t.calendarContainer!==void 0){er("onPreCalendarPosition");var ue=ke||t._positionElement,st=Array.prototype.reduce.call(t.calendarContainer.children,function(Bi,yn){return Bi+yn.offsetHeight},0),Pt=t.calendarContainer.offsetWidth,Oe=t.config.position.split(" "),H=Oe[0],te=Oe.length>1?Oe[1]:null,oe=ue.getBoundingClientRect(),Ae=window.innerHeight-oe.bottom,ye=H==="above"||H!=="below"&&Ae<st&&oe.top>st,Me=window.pageYOffset+oe.top+(ye?-st-2:ue.offsetHeight+2);if(Lo(t.calendarContainer,"arrowTop",!ye),Lo(t.calendarContainer,"arrowBottom",ye),!t.config.inline){var De=window.pageXOffset+oe.left,ze=!1,We=!1;te==="center"?(De-=(Pt-oe.width)/2,ze=!0):te==="right"&&(De-=Pt-oe.width,We=!0),Lo(t.calendarContainer,"arrowLeft",!ze&&!We),Lo(t.calendarContainer,"arrowCenter",ze),Lo(t.calendarContainer,"arrowRight",We);var nt=window.document.body.offsetWidth-(window.pageXOffset+oe.right),Ge=De+Pt>window.document.body.offsetWidth,Rt=nt+Pt>window.document.body.offsetWidth;if(Lo(t.calendarContainer,"rightMost",Ge),!t.config.static)if(t.calendarContainer.style.top=Me+"px",!Ge)t.calendarContainer.style.left=De+"px",t.calendarContainer.style.right="auto";else if(!Rt)t.calendarContainer.style.left="auto",t.calendarContainer.style.right=nt+"px";else{var zt=ko();if(zt===void 0)return;var Yt=window.document.body.offsetWidth,gi=Math.max(0,Yt/2-Pt/2),xi=".flatpickr-calendar.centerMost:before",Si=".flatpickr-calendar.centerMost:after",Pi=zt.cssRules.length,Hn="{left:"+oe.left+"px;right:auto;}";Lo(t.calendarContainer,"rightMost",!1),Lo(t.calendarContainer,"centerMost",!0),zt.insertRule(xi+","+Si+Hn,Pi),t.calendarContainer.style.left=gi+"px",t.calendarContainer.style.right="auto"}}}}function ko(){for(var ke=null,ue=0;ue<document.styleSheets.length;ue++){var st=document.styleSheets[ue];if(st.cssRules){try{st.cssRules}catch{continue}ke=st;break}}return ke??ja()}function ja(){var ke=document.createElement("style");return document.head.appendChild(ke),ke.sheet}function $o(){t.config.noCalendar||t.isMobile||(bi(),Qs(),si())}function ca(){t._input.focus(),window.navigator.userAgent.indexOf("MSIE")!==-1||navigator.msMaxTouchPoints!==void 0?setTimeout(t.close,0):t.close()}function ms(ke){ke.preventDefault(),ke.stopPropagation();var ue=function(Me){return Me.classList&&Me.classList.contains("flatpickr-day")&&!Me.classList.contains("flatpickr-disabled")&&!Me.classList.contains("notAllowed")},st=O4(Ca(ke),ue);if(st!==void 0){var Pt=st,Oe=t.latestSelectedDateObj=new Date(Pt.dateObj.getTime()),H=(Oe.getMonth()<t.currentMonth||Oe.getMonth()>t.currentMonth+t.config.showMonths-1)&&t.config.mode!=="range";if(t.selectedDateElem=Pt,t.config.mode==="single")t.selectedDates=[Oe];else if(t.config.mode==="multiple"){var te=ml(Oe);te?t.selectedDates.splice(parseInt(te),1):t.selectedDates.push(Oe)}else t.config.mode==="range"&&(t.selectedDates.length===2&&t.clear(!1,!1),t.latestSelectedDateObj=Oe,t.selectedDates.push(Oe),Ma(Oe,t.selectedDates[0],!0)!==0&&t.selectedDates.sort(function(Me,De){return Me.getTime()-De.getTime()}));if(k(),H){var oe=t.currentYear!==Oe.getFullYear();t.currentYear=Oe.getFullYear(),t.currentMonth=Oe.getMonth(),oe&&(er("onYearChange"),bi()),er("onMonthChange")}if(Qs(),si(),Nr(),!H&&t.config.mode!=="range"&&t.config.showMonths===1?Tt(Pt):t.selectedDateElem!==void 0&&t.hourElement===void 0&&t.selectedDateElem&&t.selectedDateElem.focus(),t.hourElement!==void 0&&t.hourElement!==void 0&&t.hourElement.focus(),t.config.closeOnSelect){var Ae=t.config.mode==="single"&&!t.config.enableTime,ye=t.config.mode==="range"&&t.selectedDates.length===2&&!t.config.enableTime;(Ae||ye)&&ca()}ne()}}var gs={locale:[la,vr],showMonths:[vi,r,nr],minDate:[Te],maxDate:[Te],positionElement:[Wa],clickOpens:[function(){t.config.clickOpens===!0?(W(t._input,"focus",t.open),W(t._input,"click",t.open)):(t._input.removeEventListener("focus",t.open),t._input.removeEventListener("click",t.open))}]};function Lc(ke,ue){if(ke!==null&&typeof ke=="object"){Object.assign(t.config,ke);for(var st in ke)gs[st]!==void 0&&gs[st].forEach(function(Pt){return Pt()})}else t.config[ke]=ue,gs[ke]!==void 0?gs[ke].forEach(function(Pt){return Pt()}):N2.indexOf(ke)>-1&&(t.config[ke]=U2(ue));t.redraw(),Nr(!0)}function Ha(ke,ue){var st=[];if(ke instanceof Array)st=ke.map(function(Pt){return t.parseDate(Pt,ue)});else if(ke instanceof Date||typeof ke=="number")st=[t.parseDate(ke,ue)];else if(typeof ke=="string")switch(t.config.mode){case"single":case"time":st=[t.parseDate(ke,ue)];break;case"multiple":st=ke.split(t.config.conjunction).map(function(Pt){return t.parseDate(Pt,ue)});break;case"range":st=ke.split(t.l10n.rangeSeparator).map(function(Pt){return t.parseDate(Pt,ue)});break}else t.config.errorHandler(new Error("Invalid date supplied: "+JSON.stringify(ke)));t.selectedDates=t.config.allowInvalidPreload?st:st.filter(function(Pt){return Pt instanceof Date&&go(Pt,!1)}),t.config.mode==="range"&&t.selectedDates.sort(function(Pt,Oe){return Pt.getTime()-Oe.getTime()})}function Zl(ke,ue,st){if(ue===void 0&&(ue=!1),st===void 0&&(st=t.config.dateFormat),ke!==0&&!ke||ke instanceof Array&&ke.length===0)return t.clear(ue);Ha(ke,st),t.latestSelectedDateObj=t.selectedDates[t.selectedDates.length-1],t.redraw(),Te(void 0,ue),F(),t.selectedDates.length===0&&t.clear(!1),Nr(ue),ue&&er("onChange")}function Po(ke){return ke.slice().map(function(ue){return typeof ue=="string"||typeof ue=="number"||ue instanceof Date?t.parseDate(ue,void 0,!0):ue&&typeof ue=="object"&&ue.from&&ue.to?{from:t.parseDate(ue.from,void 0),to:t.parseDate(ue.to,void 0)}:ue}).filter(function(ue){return ue})}function ha(){t.selectedDates=[],t.now=t.parseDate(t.config.now)||new Date;var ke=t.config.defaultDate||((t.input.nodeName==="INPUT"||t.input.nodeName==="TEXTAREA")&&t.input.placeholder&&t.input.value===t.input.placeholder?null:t.input.value);ke&&Ha(ke,t.config.dateFormat),t._initialDate=t.selectedDates.length>0?t.selectedDates[0]:t.config.minDate&&t.config.minDate.getTime()>t.now.getTime()?t.config.minDate:t.config.maxDate&&t.config.maxDate.getTime()<t.now.getTime()?t.config.maxDate:t.now,t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth(),t.selectedDates.length>0&&(t.latestSelectedDateObj=t.selectedDates[0]),t.config.minTime!==void 0&&(t.config.minTime=t.parseDate(t.config.minTime,"H:i")),t.config.maxTime!==void 0&&(t.config.maxTime=t.parseDate(t.config.maxTime,"H:i")),t.minDateHasTime=!!t.config.minDate&&(t.config.minDate.getHours()>0||t.config.minDate.getMinutes()>0||t.config.minDate.getSeconds()>0),t.maxDateHasTime=!!t.config.maxDate&&(t.config.maxDate.getHours()>0||t.config.maxDate.getMinutes()>0||t.config.maxDate.getSeconds()>0)}function Ms(){if(t.input=Vo(),!t.input){t.config.errorHandler(new Error("Invalid input element specified"));return}t.input._type=t.input.type,t.input.type="text",t.input.classList.add("flatpickr-input"),t._input=t.input,t.config.altInput&&(t.altInput=dr(t.input.nodeName,t.config.altInputClass),t._input=t.altInput,t.altInput.placeholder=t.input.placeholder,t.altInput.disabled=t.input.disabled,t.altInput.required=t.input.required,t.altInput.tabIndex=t.input.tabIndex,t.altInput.type="text",t.input.setAttribute("type","hidden"),!t.config.static&&t.input.parentNode&&t.input.parentNode.insertBefore(t.altInput,t.input.nextSibling)),t.config.allowInput||t._input.setAttribute("readonly","readonly"),Wa()}function Wa(){t._positionElement=t.config.positionElement||t._input}function Ga(){var ke=t.config.enableTime?t.config.noCalendar?"time":"datetime-local":"date";t.mobileInput=dr("input",t.input.className+" flatpickr-mobile"),t.mobileInput.tabIndex=1,t.mobileInput.type=ke,t.mobileInput.disabled=t.input.disabled,t.mobileInput.required=t.input.required,t.mobileInput.placeholder=t.input.placeholder,t.mobileFormatStr=ke==="datetime-local"?"Y-m-d\\TH:i:S":ke==="date"?"Y-m-d":"H:i:S",t.selectedDates.length>0&&(t.mobileInput.defaultValue=t.mobileInput.value=t.formatDate(t.selectedDates[0],t.mobileFormatStr)),t.config.minDate&&(t.mobileInput.min=t.formatDate(t.config.minDate,"Y-m-d")),t.config.maxDate&&(t.mobileInput.max=t.formatDate(t.config.maxDate,"Y-m-d")),t.input.getAttribute("step")&&(t.mobileInput.step=String(t.input.getAttribute("step"))),t.input.type="hidden",t.altInput!==void 0&&(t.altInput.type="hidden");try{t.input.parentNode&&t.input.parentNode.insertBefore(t.mobileInput,t.input.nextSibling)}catch{}W(t.mobileInput,"change",function(ue){t.setDate(Ca(ue).value,!1,t.mobileFormatStr),er("onChange"),er("onClose")})}function jo(ke){if(t.isOpen===!0)return t.close();t.open(ke)}function er(ke,ue){if(t.config!==void 0){var st=t.config[ke];if(st!==void 0&&st.length>0)for(var Pt=0;st[Pt]&&Pt<st.length;Pt++)st[Pt](t.selectedDates,t.input.value,t,ue);ke==="onChange"&&(t.input.dispatchEvent(ua("change")),t.input.dispatchEvent(ua("input")))}}function ua(ke){var ue=document.createEvent("Event");return ue.initEvent(ke,!0,!0),ue}function ml(ke){for(var ue=0;ue<t.selectedDates.length;ue++){var st=t.selectedDates[ue];if(st instanceof Date&&Ma(st,ke)===0)return""+ue}return!1}function On(ke){return t.config.mode!=="range"||t.selectedDates.length<2?!1:Ma(ke,t.selectedDates[0])>=0&&Ma(ke,t.selectedDates[1])<=0}function Qs(){t.config.noCalendar||t.isMobile||!t.monthNav||(t.yearElements.forEach(function(ke,ue){var st=new Date(t.currentYear,t.currentMonth,1);st.setMonth(t.currentMonth+ue),t.config.showMonths>1||t.config.monthSelectorType==="static"?t.monthElements[ue].textContent=U1(st.getMonth(),t.config.shorthandCurrentMonth,t.l10n)+" ":t.monthsDropdownContainer.value=st.getMonth().toString(),ke.value=st.getFullYear().toString()}),t._hidePrevMonthArrow=t.config.minDate!==void 0&&(t.currentYear===t.config.minDate.getFullYear()?t.currentMonth<=t.config.minDate.getMonth():t.currentYear<t.config.minDate.getFullYear()),t._hideNextMonthArrow=t.config.maxDate!==void 0&&(t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth+1>t.config.maxDate.getMonth():t.currentYear>t.config.maxDate.getFullYear()))}function Xa(ke){var ue=ke||(t.config.altInput?t.config.altFormat:t.config.dateFormat);return t.selectedDates.map(function(st){return t.formatDate(st,ue)}).filter(function(st,Pt,Oe){return t.config.mode!=="range"||t.config.enableTime||Oe.indexOf(st)===Pt}).join(t.config.mode!=="range"?t.config.conjunction:t.l10n.rangeSeparator)}function Nr(ke){ke===void 0&&(ke=!0),t.mobileInput!==void 0&&t.mobileFormatStr&&(t.mobileInput.value=t.latestSelectedDateObj!==void 0?t.formatDate(t.latestSelectedDateObj,t.mobileFormatStr):""),t.input.value=Xa(t.config.dateFormat),t.altInput!==void 0&&(t.altInput.value=Xa(t.config.altFormat)),ke!==!1&&er("onValueUpdate")}function zc(ke){var ue=Ca(ke),st=t.prevMonthNav.contains(ue),Pt=t.nextMonthNav.contains(ue);st||Pt?Gr(st?-1:1):t.yearElements.indexOf(ue)>=0?ue.select():ue.classList.contains("arrowUp")?t.changeYear(t.currentYear+1):ue.classList.contains("arrowDown")&&t.changeYear(t.currentYear-1)}function Mh(ke){ke.preventDefault();var ue=ke.type==="keydown",st=Ca(ke),Pt=st;t.amPM!==void 0&&st===t.amPM&&(t.amPM.textContent=t.l10n.amPM[rl(t.amPM.textContent===t.l10n.amPM[0])]);var Oe=parseFloat(Pt.getAttribute("min")),H=parseFloat(Pt.getAttribute("max")),te=parseFloat(Pt.getAttribute("step")),oe=parseInt(Pt.value,10),Ae=ke.delta||(ue?ke.which===38?1:-1:0),ye=oe+te*Ae;if(typeof Pt.value<"u"&&Pt.value.length===2){var Me=Pt===t.hourElement,De=Pt===t.minuteElement;ye<Oe?(ye=H+ye+rl(!Me)+(rl(Me)&&rl(!t.amPM)),De&&Ee(void 0,-1,t.hourElement)):ye>H&&(ye=Pt===t.hourElement?ye-H-rl(!t.amPM):Oe,De&&Ee(void 0,1,t.hourElement)),t.amPM&&Me&&(te===1?ye+oe===23:Math.abs(ye-oe)>te)&&(t.amPM.textContent=t.l10n.amPM[rl(t.amPM.textContent===t.l10n.amPM[0])]),Pt.value=ta(ye)}}return s(),t}function Cm(i,e){for(var t=Array.prototype.slice.call(i).filter(function(f){return f instanceof HTMLElement}),n=[],s=0;s<t.length;s++){var c=t[s];try{if(c.getAttribute("data-fp-omit")!==null)continue;c._flatpickr!==void 0&&(c._flatpickr.destroy(),c._flatpickr=void 0),c._flatpickr=Dae(c,e||{}),n.push(c._flatpickr)}catch(f){console.error(f)}}return n.length===1?n[0]:n}typeof HTMLElement<"u"&&typeof HTMLCollection<"u"&&typeof NodeList<"u"&&(HTMLCollection.prototype.flatpickr=NodeList.prototype.flatpickr=function(i){return Cm(this,i)},HTMLElement.prototype.flatpickr=function(i){return Cm([this],i)});var Ts=function(i,e){return typeof i=="string"?Cm(window.document.querySelectorAll(i),e):i instanceof Node?Cm([i],e):Cm(i,e)};Ts.defaultConfig={};Ts.l10ns={en:Co({},l0),default:Co({},l0)};Ts.localize=function(i){Ts.l10ns.default=Co(Co({},Ts.l10ns.default),i)};Ts.setDefaults=function(i){Ts.defaultConfig=Co(Co({},Ts.defaultConfig),i)};Ts.parseDate=pE({});Ts.formatDate=F4({});Ts.compareDates=Ma;typeof jQuery<"u"&&typeof jQuery.fn<"u"&&(jQuery.fn.flatpickr=function(i){return Cm(this,i)});Date.prototype.fp_incr=function(i){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+(typeof i=="string"?parseInt(i,10):i))};typeof window<"u"&&(window.flatpickr=Ts);var fy={exports:{}},Bae=fy.exports,oB;function Oae(){return oB||(oB=1,function(i,e){(function(t,n){n(e)})(Bae,function(t){var n=typeof window<"u"&&window.flatpickr!==void 0?window.flatpickr:{l10ns:{}},s={weekdays:{shorthand:["","","","","","",""],longhand:["","","","","","",""]},months:{shorthand:["","","","","","","","","","","",""],longhand:["","","","","","","","","","","",""]},firstDayOfWeek:1,ordinal:function(){return""},rangeSeparator:"  ",weekAbbreviation:".",scrollTitle:"  ",toggleTitle:"  ",amPM:["",""],yearAriaLabel:"",time_24hr:!0};n.l10ns.ru=s;var c=n.l10ns;t.Russian=s,t.default=c,Object.defineProperty(t,"__esModule",{value:!0})})}(fy,fy.exports)),fy.exports}Oae();class Fae{constructor(e,t){this.container=document.getElementById(e),this.vehicleService=t,this.vehicles=[],this.getTrack$=new zm,this.destroy$=new zm}init(){this.vehicleService.getInitialVehicles().subscribe(e=>{this.vehicles=e,this.render(),this.setupListeners(),this.setupFlatpickr(),this._listenGetTrack(),this.vehicles.find(n=>n.active)&&this.loadVehicleTracks()})}_listenGetTrack(){this.getTrack$.pipe(dne(300),OC((e,t)=>e.id===t.id&&e.startDateTime===t.startDateTime&&e.endDateTime===t.endDateTime&&e.isRepeat===t.isRepeat),bne(({id:e,startDateTime:t,endDateTime:n,isRepeat:s})=>{LC.show();const c=this.getTrackInterval(s,t,n);return this.vehicleService.getVehicleTrack(e,c.startDateTime,c.endDateTime,s)}),m4(this.destroy$)).subscribe()}getTrackInterval(e,t,n){if(!e)return{startDateTime:this.toServerIso(t),endDateTime:this.toServerIso(n)};const s=new Date;return{startDateTime:new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0).toISOString().split(".")[0]+"Z",endDateTime:s.toISOString().split(".")[0]+"Z"}}toServerIso(e){if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e))return e;if(/^\d{2}\.\d{2}\.\d{4} \d{2}:\d{2}$/.test(e)){const[n,s]=e.split(" "),[c,f,r]=n.split(".").map(Number),[b,w]=s.split(":").map(Number);return new Date(Date.UTC(r,f-1,c,b,w,0)).toISOString().split(".")[0]+"Z"}return new Date(e).toISOString().split(".")[0]+"Z"}render(){if(!this.container){console.error("error container");return}this.container.innerHTML="",this.vehicles.forEach((e,t)=>{const n=document.createElement("sl-details");n.dataset.id=e.id,t===0&&n.setAttribute("open",""),n.innerHTML=`
      
  <div slot="summary" class="flex items-center gap-2">
    <sl-checkbox data-id="${e.id}"></sl-checkbox>
    <span>${e.name}</span>
    <span class="inline-block w-3 h-3 rounded-full" style="background-color: ${e.color};"></span>
  </div>

  <div class="p-2 space-y-2 text-xs  pt-2">
    <div data-id="${e.id}" class="space-y-1">
      <div class="field-timestamp"><strong>Date time:</strong> <span data-field="timestamp"></span></div>
      <div class="field-lat"><strong>Lat:</strong> <span data-field="lat"></span></div>
      <div class="field-lng"><strong>Lng:</strong> <span data-field="lng"></span></div>
    </div>

    <div>
      <label class="block text-sm mb-1">ONLINE</label>
      <sl-switch class="w-full" data-id="${e.id}" data-field="isRepeat"></sl-switch>
    </div>

    <div>
      <label class="block text-sm mb-1">Date and time range</label>
      <sl-input class="w-full" type="text" data-id="${e.id}" data-field="dateRange"></sl-input>
    </div>
  </div>
`,this.container.appendChild(n)}),this.container.querySelectorAll("sl-checkbox").forEach(e=>{const t=e.dataset.id,n=this.vehicles.find(s=>s.id===t);n&&(e.checked=n.active)}),this.container.querySelectorAll("sl-switch").forEach(e=>{const t=e.dataset.id,n=this.vehicles.find(s=>s.id===t);n&&(e.checked=n.isRepeat),e.hasListener||(e.addEventListener("sl-change",s=>{const c=s.target.dataset.id,f=this.vehicles.find(b=>b.id===c);if(!f)return;f.isRepeat=s.target.checked;const r=this.container.querySelector(`sl-details[data-id="${c}"]`);r&&r.querySelectorAll("sl-input").forEach(b=>{b.disabled=f.isRepeat}),this.loadVehicleTracks()}),e.hasListener=!0)})}setupListeners(){this.container.addEventListener("click",e=>{const t=e.target.closest("sl-checkbox");if(!t)return;const n=t.dataset.id;n&&(this.activateVehicle(n),this.loadVehicleTracks())}),this.container.addEventListener("sl-show",e=>{const t=e.target.dataset.id;t&&(this.container.querySelectorAll("sl-details").forEach(n=>{n.dataset.id!==t&&(n.open=!1)}),this.activateVehicle(t),this.loadVehicleTracks())}),this.container.addEventListener("sl-change",e=>{const t=e.target,n=t.dataset.id,s=t.dataset.field;if(!n||!s)return;const c=this.vehicles.find(f=>f.id===n);c&&(t.tagName.toLowerCase()==="sl-switch"?c[s]=t.checked:c[s]=t.value)})}activateVehicle(e){this.vehicles.forEach(s=>s.active=!1),this.container.querySelectorAll("sl-checkbox[data-id]").forEach(s=>{s.checked=!1});const t=this.vehicles.find(s=>s.id===e);if(!t)return;t.active=!0;const n=this.container.querySelector(`sl-checkbox[data-id="${e}"]`);n&&(n.checked=!0)}loadVehicleTracks(){const e=this.vehicles.find(f=>f.active);if(!e){console.warn("      ");return}const{id:t,startDateTime:n,endDateTime:s,isRepeat:c}=e;if(!n||!s){console.warn("     ");return}this.getTrack$.next({id:t,startDateTime:n,endDateTime:s,isRepeat:c})}setupFlatpickr(){this.container.querySelectorAll('sl-input[data-field="dateRange"]').forEach(e=>{const t=e.closest("sl-details"),n=t==null?void 0:t.dataset.id,s=this.vehicles.find(r=>r.id===n),c=(s==null?void 0:s.startDateTime)||"",f=(s==null?void 0:s.endDateTime)||"";Ts(e,{mode:"range",enableTime:!0,time_24hr:!0,dateFormat:"d.m.Y H:i",showMonths:2,defaultDate:[c,f].filter(Boolean),onClose:(r,b,w)=>{if(!r||r.length<2)return;const E=r[0].toISOString().split(".")[0]+"Z",k=r[1].toISOString().split(".")[0]+"Z";s.startDateTime=E,s.endDateTime=k,this.getTrack$.next({id:n,startDateTime:E,endDateTime:k,isRepeat:!1})}}),e.disabled=!!s.isRepeat})}destroy(){this.destroy$.next(),this.destroy$.complete()}}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function B0(i){return i+.5|0}const Pu=(i,e,t)=>Math.max(Math.min(i,t),e);function py(i){return Pu(B0(i*2.55),0,255)}function Lu(i){return Pu(B0(i*255),0,255)}function bh(i){return Pu(B0(i/2.55)/100,0,1)}function aB(i){return Pu(B0(i*100),0,100)}const il={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},mE=[..."0123456789ABCDEF"],Lae=i=>mE[i&15],zae=i=>mE[(i&240)>>4]+mE[i&15],fx=i=>(i&240)>>4===(i&15),Nae=i=>fx(i.r)&&fx(i.g)&&fx(i.b)&&fx(i.a);function Uae(i){var e=i.length,t;return i[0]==="#"&&(e===4||e===5?t={r:255&il[i[1]]*17,g:255&il[i[2]]*17,b:255&il[i[3]]*17,a:e===5?il[i[4]]*17:255}:(e===7||e===9)&&(t={r:il[i[1]]<<4|il[i[2]],g:il[i[3]]<<4|il[i[4]],b:il[i[5]]<<4|il[i[6]],a:e===9?il[i[7]]<<4|il[i[8]]:255})),t}const Vae=(i,e)=>i<255?e(i):"";function $ae(i){var e=Nae(i)?Lae:zae;return i?"#"+e(i.r)+e(i.g)+e(i.b)+Vae(i.a,e):void 0}const jae=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function L4(i,e,t){const n=e*Math.min(t,1-t),s=(c,f=(c+i/30)%12)=>t-n*Math.max(Math.min(f-3,9-f,1),-1);return[s(0),s(8),s(4)]}function Hae(i,e,t){const n=(s,c=(s+i/60)%6)=>t-t*e*Math.max(Math.min(c,4-c,1),0);return[n(5),n(3),n(1)]}function Wae(i,e,t){const n=L4(i,1,.5);let s;for(e+t>1&&(s=1/(e+t),e*=s,t*=s),s=0;s<3;s++)n[s]*=1-e-t,n[s]+=e;return n}function Gae(i,e,t,n,s){return i===s?(e-t)/n+(e<t?6:0):e===s?(t-i)/n+2:(i-e)/n+4}function jC(i){const t=i.r/255,n=i.g/255,s=i.b/255,c=Math.max(t,n,s),f=Math.min(t,n,s),r=(c+f)/2;let b,w,E;return c!==f&&(E=c-f,w=r>.5?E/(2-c-f):E/(c+f),b=Gae(t,n,s,E,c),b=b*60+.5),[b|0,w||0,r]}function HC(i,e,t,n){return(Array.isArray(e)?i(e[0],e[1],e[2]):i(e,t,n)).map(Lu)}function WC(i,e,t){return HC(L4,i,e,t)}function Xae(i,e,t){return HC(Wae,i,e,t)}function qae(i,e,t){return HC(Hae,i,e,t)}function z4(i){return(i%360+360)%360}function Yae(i){const e=jae.exec(i);let t=255,n;if(!e)return;e[5]!==n&&(t=e[6]?py(+e[5]):Lu(+e[5]));const s=z4(+e[2]),c=+e[3]/100,f=+e[4]/100;return e[1]==="hwb"?n=Xae(s,c,f):e[1]==="hsv"?n=qae(s,c,f):n=WC(s,c,f),{r:n[0],g:n[1],b:n[2],a:t}}function Zae(i,e){var t=jC(i);t[0]=z4(t[0]+e),t=WC(t),i.r=t[0],i.g=t[1],i.b=t[2]}function Kae(i){if(!i)return;const e=jC(i),t=e[0],n=aB(e[1]),s=aB(e[2]);return i.a<255?`hsla(${t}, ${n}%, ${s}%, ${bh(i.a)})`:`hsl(${t}, ${n}%, ${s}%)`}const lB={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},cB={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Jae(){const i={},e=Object.keys(cB),t=Object.keys(lB);let n,s,c,f,r;for(n=0;n<e.length;n++){for(f=r=e[n],s=0;s<t.length;s++)c=t[s],r=r.replace(c,lB[c]);c=parseInt(cB[f],16),i[r]=[c>>16&255,c>>8&255,c&255]}return i}let px;function Qae(i){px||(px=Jae(),px.transparent=[0,0,0,0]);const e=px[i.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const ele=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function tle(i){const e=ele.exec(i);let t=255,n,s,c;if(e){if(e[7]!==n){const f=+e[7];t=e[8]?py(f):Pu(f*255,0,255)}return n=+e[1],s=+e[3],c=+e[5],n=255&(e[2]?py(n):Pu(n,0,255)),s=255&(e[4]?py(s):Pu(s,0,255)),c=255&(e[6]?py(c):Pu(c,0,255)),{r:n,g:s,b:c,a:t}}}function ile(i){return i&&(i.a<255?`rgba(${i.r}, ${i.g}, ${i.b}, ${bh(i.a)})`:`rgb(${i.r}, ${i.g}, ${i.b})`)}const H2=i=>i<=.0031308?i*12.92:Math.pow(i,1/2.4)*1.055-.055,lm=i=>i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4);function nle(i,e,t){const n=lm(bh(i.r)),s=lm(bh(i.g)),c=lm(bh(i.b));return{r:Lu(H2(n+t*(lm(bh(e.r))-n))),g:Lu(H2(s+t*(lm(bh(e.g))-s))),b:Lu(H2(c+t*(lm(bh(e.b))-c))),a:i.a+t*(e.a-i.a)}}function mx(i,e,t){if(i){let n=jC(i);n[e]=Math.max(0,Math.min(n[e]+n[e]*t,e===0?360:1)),n=WC(n),i.r=n[0],i.g=n[1],i.b=n[2]}}function N4(i,e){return i&&Object.assign(e||{},i)}function hB(i){var e={r:0,g:0,b:0,a:255};return Array.isArray(i)?i.length>=3&&(e={r:i[0],g:i[1],b:i[2],a:255},i.length>3&&(e.a=Lu(i[3]))):(e=N4(i,{r:0,g:0,b:0,a:1}),e.a=Lu(e.a)),e}function rle(i){return i.charAt(0)==="r"?tle(i):Yae(i)}class c0{constructor(e){if(e instanceof c0)return e;const t=typeof e;let n;t==="object"?n=hB(e):t==="string"&&(n=Uae(e)||Qae(e)||rle(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=N4(this._rgb);return e&&(e.a=bh(e.a)),e}set rgb(e){this._rgb=hB(e)}rgbString(){return this._valid?ile(this._rgb):void 0}hexString(){return this._valid?$ae(this._rgb):void 0}hslString(){return this._valid?Kae(this._rgb):void 0}mix(e,t){if(e){const n=this.rgb,s=e.rgb;let c;const f=t===c?.5:t,r=2*f-1,b=n.a-s.a,w=((r*b===-1?r:(r+b)/(1+r*b))+1)/2;c=1-w,n.r=255&w*n.r+c*s.r+.5,n.g=255&w*n.g+c*s.g+.5,n.b=255&w*n.b+c*s.b+.5,n.a=f*n.a+(1-f)*s.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=nle(this._rgb,e._rgb,t)),this}clone(){return new c0(this.rgb)}alpha(e){return this._rgb.a=Lu(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=B0(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return mx(this._rgb,2,e),this}darken(e){return mx(this._rgb,2,-e),this}saturate(e){return mx(this._rgb,1,e),this}desaturate(e){return mx(this._rgb,1,-e),this}rotate(e){return Zae(this._rgb,e),this}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function ph(){}const sle=(()=>{let i=0;return()=>i++})();function Fr(i){return i==null}function oo(i){if(Array.isArray&&Array.isArray(i))return!0;const e=Object.prototype.toString.call(i);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function fr(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}function ul(i){return(typeof i=="number"||i instanceof Number)&&isFinite(+i)}function xc(i,e){return ul(i)?i:e}function Jn(i,e){return typeof i>"u"?e:i}const ole=(i,e)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100*e:+i;function zr(i,e,t){if(i&&typeof i.call=="function")return i.apply(t,e)}function wr(i,e,t,n){let s,c,f;if(oo(i))for(c=i.length,s=0;s<c;s++)e.call(t,i[s],s);else if(fr(i))for(f=Object.keys(i),c=f.length,s=0;s<c;s++)e.call(t,i[f[s]],f[s])}function V1(i,e){let t,n,s,c;if(!i||!e||i.length!==e.length)return!1;for(t=0,n=i.length;t<n;++t)if(s=i[t],c=e[t],s.datasetIndex!==c.datasetIndex||s.index!==c.index)return!1;return!0}function $1(i){if(oo(i))return i.map($1);if(fr(i)){const e=Object.create(null),t=Object.keys(i),n=t.length;let s=0;for(;s<n;++s)e[t[s]]=$1(i[t[s]]);return e}return i}function U4(i){return["__proto__","prototype","constructor"].indexOf(i)===-1}function ale(i,e,t,n){if(!U4(i))return;const s=e[i],c=t[i];fr(s)&&fr(c)?h0(s,c,n):e[i]=$1(c)}function h0(i,e,t){const n=oo(e)?e:[e],s=n.length;if(!fr(i))return i;t=t||{};const c=t.merger||ale;let f;for(let r=0;r<s;++r){if(f=n[r],!fr(f))continue;const b=Object.keys(f);for(let w=0,E=b.length;w<E;++w)c(b[w],i,f,t)}return i}function Ny(i,e){return h0(i,e,{merger:lle})}function lle(i,e,t){if(!U4(i))return;const n=e[i],s=t[i];fr(n)&&fr(s)?Ny(n,s):Object.prototype.hasOwnProperty.call(e,i)||(e[i]=$1(s))}const uB={"":i=>i,x:i=>i.x,y:i=>i.y};function cle(i){const e=i.split("."),t=[];let n="";for(const s of e)n+=s,n.endsWith("\\")?n=n.slice(0,-1)+".":(t.push(n),n="");return t}function hle(i){const e=cle(i);return t=>{for(const n of e){if(n==="")break;t=t&&t[n]}return t}}function j1(i,e){return(uB[e]||(uB[e]=hle(e)))(i)}function GC(i){return i.charAt(0).toUpperCase()+i.slice(1)}const H1=i=>typeof i<"u",$u=i=>typeof i=="function",dB=(i,e)=>{if(i.size!==e.size)return!1;for(const t of i)if(!e.has(t))return!1;return!0};function ule(i){return i.type==="mouseup"||i.type==="click"||i.type==="contextmenu"}const Io=Math.PI,Rc=2*Io,dle=Rc+Io,W1=Number.POSITIVE_INFINITY,fle=Io/180,Ll=Io/2,qd=Io/4,fB=Io*2/3,V4=Math.log10,Vm=Math.sign;function Uy(i,e,t){return Math.abs(i-e)<t}function pB(i){const e=Math.round(i);i=Uy(i,e,i/1e3)?e:i;const t=Math.pow(10,Math.floor(V4(i))),n=i/t;return(n<=1?1:n<=2?2:n<=5?5:10)*t}function ple(i){const e=[],t=Math.sqrt(i);let n;for(n=1;n<t;n++)i%n===0&&(e.push(n),e.push(i/n));return t===(t|0)&&e.push(t),e.sort((s,c)=>s-c).pop(),e}function mle(i){return typeof i=="symbol"||typeof i=="object"&&i!==null&&!(Symbol.toPrimitive in i||"toString"in i||"valueOf"in i)}function u0(i){return!mle(i)&&!isNaN(parseFloat(i))&&isFinite(i)}function gle(i,e){const t=Math.round(i);return t-e<=i&&t+e>=i}function _le(i,e,t){let n,s,c;for(n=0,s=i.length;n<s;n++)c=i[n][t],isNaN(c)||(e.min=Math.min(e.min,c),e.max=Math.max(e.max,c))}function cf(i){return i*(Io/180)}function yle(i){return i*(180/Io)}function mB(i){if(!ul(i))return;let e=1,t=0;for(;Math.round(i*e)/e!==i;)e*=10,t++;return t}function ble(i,e){const t=e.x-i.x,n=e.y-i.y,s=Math.sqrt(t*t+n*n);let c=Math.atan2(n,t);return c<-.5*Io&&(c+=Rc),{angle:c,distance:s}}function gE(i,e){return Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2))}function vle(i,e){return(i-e+dle)%Rc-Io}function Tu(i){return(i%Rc+Rc)%Rc}function $4(i,e,t,n){const s=Tu(i),c=Tu(e),f=Tu(t),r=Tu(c-s),b=Tu(f-s),w=Tu(s-c),E=Tu(s-f);return s===c||s===f||n&&c===f||r>b&&w<E}function ol(i,e,t){return Math.max(e,Math.min(t,i))}function xle(i){return ol(i,-32768,32767)}function my(i,e,t,n=1e-6){return i>=Math.min(e,t)-n&&i<=Math.max(e,t)+n}function XC(i,e,t){t=t||(f=>i[f]<e);let n=i.length-1,s=0,c;for(;n-s>1;)c=s+n>>1,t(c)?s=c:n=c;return{lo:s,hi:n}}const hf=(i,e,t,n)=>XC(i,t,n?s=>{const c=i[s][e];return c<t||c===t&&i[s+1][e]===t}:s=>i[s][e]<t),wle=(i,e,t)=>XC(i,t,n=>i[n][e]>=t);function Ale(i,e,t){let n=0,s=i.length;for(;n<s&&i[n]<e;)n++;for(;s>n&&i[s-1]>t;)s--;return n>0||s<i.length?i.slice(n,s):i}const j4=["push","pop","shift","splice","unshift"];function Tle(i,e){if(i._chartjs){i._chartjs.listeners.push(e);return}Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),j4.forEach(t=>{const n="_onData"+GC(t),s=i[t];Object.defineProperty(i,t,{configurable:!0,enumerable:!1,value(...c){const f=s.apply(this,c);return i._chartjs.listeners.forEach(r=>{typeof r[n]=="function"&&r[n](...c)}),f}})})}function gB(i,e){const t=i._chartjs;if(!t)return;const n=t.listeners,s=n.indexOf(e);s!==-1&&n.splice(s,1),!(n.length>0)&&(j4.forEach(c=>{delete i[c]}),delete i._chartjs)}function Sle(i){const e=new Set(i);return e.size===i.length?i:Array.from(e)}const H4=function(){return typeof window>"u"?function(i){return i()}:window.requestAnimationFrame}();function W4(i,e){let t=[],n=!1;return function(...s){t=s,n||(n=!0,H4.call(window,()=>{n=!1,i.apply(e,t)}))}}function Ele(i,e){let t;return function(...n){return e?(clearTimeout(t),t=setTimeout(i,e,n)):i.apply(this,n),e}}const G4=i=>i==="start"?"left":i==="end"?"right":"center",Ra=(i,e,t)=>i==="start"?e:i==="end"?t:(e+t)/2,Cle=(i,e,t,n)=>i===(n?"left":"right")?t:i==="center"?(e+t)/2:e;function Ile(i,e,t){const n=e.length;let s=0,c=n;if(i._sorted){const{iScale:f,vScale:r,_parsed:b}=i,w=i.dataset&&i.dataset.options?i.dataset.options.spanGaps:null,E=f.axis,{min:k,max:F,minDefined:$,maxDefined:X}=f.getUserBounds();if($){if(s=Math.min(hf(b,E,k).lo,t?n:hf(e,E,f.getPixelForValue(k)).lo),w){const W=b.slice(0,s+1).reverse().findIndex(ne=>!Fr(ne[r.axis]));s-=Math.max(0,W)}s=ol(s,0,n-1)}if(X){let W=Math.max(hf(b,f.axis,F,!0).hi+1,t?0:hf(e,E,f.getPixelForValue(F),!0).hi+1);if(w){const ne=b.slice(W-1).findIndex(_e=>!Fr(_e[r.axis]));W+=Math.max(0,ne)}c=ol(W,s,n)-s}else c=n-s}return{start:s,count:c}}function Mle(i){const{xScale:e,yScale:t,_scaleRanges:n}=i,s={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!n)return i._scaleRanges=s,!0;const c=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==t.min||n.ymax!==t.max;return Object.assign(n,s),c}const gx=i=>i===0||i===1,_B=(i,e,t)=>-(Math.pow(2,10*(i-=1))*Math.sin((i-e)*Rc/t)),yB=(i,e,t)=>Math.pow(2,-10*i)*Math.sin((i-e)*Rc/t)+1,Vy={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>-i*(i-2),easeInOutQuad:i=>(i/=.5)<1?.5*i*i:-.5*(--i*(i-2)-1),easeInCubic:i=>i*i*i,easeOutCubic:i=>(i-=1)*i*i+1,easeInOutCubic:i=>(i/=.5)<1?.5*i*i*i:.5*((i-=2)*i*i+2),easeInQuart:i=>i*i*i*i,easeOutQuart:i=>-((i-=1)*i*i*i-1),easeInOutQuart:i=>(i/=.5)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2),easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>(i-=1)*i*i*i*i+1,easeInOutQuint:i=>(i/=.5)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2),easeInSine:i=>-Math.cos(i*Ll)+1,easeOutSine:i=>Math.sin(i*Ll),easeInOutSine:i=>-.5*(Math.cos(Io*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>gx(i)?i:i<.5?.5*Math.pow(2,10*(i*2-1)):.5*(-Math.pow(2,-10*(i*2-1))+2),easeInCirc:i=>i>=1?i:-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-(i-=1)*i),easeInOutCirc:i=>(i/=.5)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1),easeInElastic:i=>gx(i)?i:_B(i,.075,.3),easeOutElastic:i=>gx(i)?i:yB(i,.075,.3),easeInOutElastic(i){return gx(i)?i:i<.5?.5*_B(i*2,.1125,.45):.5+.5*yB(i*2-1,.1125,.45)},easeInBack(i){return i*i*((1.70158+1)*i-1.70158)},easeOutBack(i){return(i-=1)*i*((1.70158+1)*i+1.70158)+1},easeInOutBack(i){let e=1.70158;return(i/=.5)<1?.5*(i*i*(((e*=1.525)+1)*i-e)):.5*((i-=2)*i*(((e*=1.525)+1)*i+e)+2)},easeInBounce:i=>1-Vy.easeOutBounce(1-i),easeOutBounce(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},easeInOutBounce:i=>i<.5?Vy.easeInBounce(i*2)*.5:Vy.easeOutBounce(i*2-1)*.5+.5};function qC(i){if(i&&typeof i=="object"){const e=i.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function bB(i){return qC(i)?i:new c0(i)}function W2(i){return qC(i)?i:new c0(i).saturate(.5).darken(.1).hexString()}const Rle=["x","y","borderWidth","radius","tension"],kle=["color","borderColor","backgroundColor"];function Ple(i){i.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),i.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),i.set("animations",{colors:{type:"color",properties:kle},numbers:{type:"number",properties:Rle}}),i.describe("animations",{_fallback:"animation"}),i.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function Dle(i){i.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const vB=new Map;function Ble(i,e){e=e||{};const t=i+JSON.stringify(e);let n=vB.get(t);return n||(n=new Intl.NumberFormat(i,e),vB.set(t,n)),n}function X4(i,e,t){return Ble(e,t).format(i)}const Ole={values(i){return oo(i)?i:""+i},numeric(i,e,t){if(i===0)return"0";const n=this.chart.options.locale;let s,c=i;if(t.length>1){const w=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(w<1e-4||w>1e15)&&(s="scientific"),c=Fle(i,t)}const f=V4(Math.abs(c)),r=isNaN(f)?1:Math.max(Math.min(-1*Math.floor(f),20),0),b={notation:s,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(b,this.options.ticks.format),X4(i,n,b)}};function Fle(i,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&i!==Math.floor(i)&&(t=i-Math.floor(i)),t}var q4={formatters:Ole};function Lle(i){i.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:q4.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),i.route("scale.ticks","color","","color"),i.route("scale.grid","color","","borderColor"),i.route("scale.border","color","","borderColor"),i.route("scale.title","color","","color"),i.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),i.describe("scales",{_fallback:"scale"}),i.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Cf=Object.create(null),_E=Object.create(null);function $y(i,e){if(!e)return i;const t=e.split(".");for(let n=0,s=t.length;n<s;++n){const c=t[n];i=i[c]||(i[c]=Object.create(null))}return i}function G2(i,e,t){return typeof e=="string"?h0($y(i,e),t):h0($y(i,""),e)}class zle{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,s)=>W2(s.backgroundColor),this.hoverBorderColor=(n,s)=>W2(s.borderColor),this.hoverColor=(n,s)=>W2(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return G2(this,e,t)}get(e){return $y(this,e)}describe(e,t){return G2(_E,e,t)}override(e,t){return G2(Cf,e,t)}route(e,t,n,s){const c=$y(this,e),f=$y(this,n),r="_"+t;Object.defineProperties(c,{[r]:{value:c[t],writable:!0},[t]:{enumerable:!0,get(){const b=this[r],w=f[s];return fr(b)?Object.assign({},w,b):Jn(b,w)},set(b){this[r]=b}}})}apply(e){e.forEach(t=>t(this))}}var ds=new zle({_scriptable:i=>!i.startsWith("on"),_indexable:i=>i!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Ple,Dle,Lle]);function Nle(i){return!i||Fr(i.size)||Fr(i.family)?null:(i.style?i.style+" ":"")+(i.weight?i.weight+" ":"")+i.size+"px "+i.family}function xB(i,e,t,n,s){let c=e[s];return c||(c=e[s]=i.measureText(s).width,t.push(s)),c>n&&(n=c),n}function Yd(i,e,t){const n=i.currentDevicePixelRatio,s=t!==0?Math.max(t/2,.5):0;return Math.round((e-s)*n)/n+s}function wB(i,e){!e&&!i||(e=e||i.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,i.width,i.height),e.restore())}function yE(i,e,t,n){Y4(i,e,t,n,null)}function Y4(i,e,t,n,s){let c,f,r,b,w,E,k,F;const $=e.pointStyle,X=e.rotation,W=e.radius;let ne=(X||0)*fle;if($&&typeof $=="object"&&(c=$.toString(),c==="[object HTMLImageElement]"||c==="[object HTMLCanvasElement]")){i.save(),i.translate(t,n),i.rotate(ne),i.drawImage($,-$.width/2,-$.height/2,$.width,$.height),i.restore();return}if(!(isNaN(W)||W<=0)){switch(i.beginPath(),$){default:s?i.ellipse(t,n,s/2,W,0,0,Rc):i.arc(t,n,W,0,Rc),i.closePath();break;case"triangle":E=s?s/2:W,i.moveTo(t+Math.sin(ne)*E,n-Math.cos(ne)*W),ne+=fB,i.lineTo(t+Math.sin(ne)*E,n-Math.cos(ne)*W),ne+=fB,i.lineTo(t+Math.sin(ne)*E,n-Math.cos(ne)*W),i.closePath();break;case"rectRounded":w=W*.516,b=W-w,f=Math.cos(ne+qd)*b,k=Math.cos(ne+qd)*(s?s/2-w:b),r=Math.sin(ne+qd)*b,F=Math.sin(ne+qd)*(s?s/2-w:b),i.arc(t-k,n-r,w,ne-Io,ne-Ll),i.arc(t+F,n-f,w,ne-Ll,ne),i.arc(t+k,n+r,w,ne,ne+Ll),i.arc(t-F,n+f,w,ne+Ll,ne+Io),i.closePath();break;case"rect":if(!X){b=Math.SQRT1_2*W,E=s?s/2:b,i.rect(t-E,n-b,2*E,2*b);break}ne+=qd;case"rectRot":k=Math.cos(ne)*(s?s/2:W),f=Math.cos(ne)*W,r=Math.sin(ne)*W,F=Math.sin(ne)*(s?s/2:W),i.moveTo(t-k,n-r),i.lineTo(t+F,n-f),i.lineTo(t+k,n+r),i.lineTo(t-F,n+f),i.closePath();break;case"crossRot":ne+=qd;case"cross":k=Math.cos(ne)*(s?s/2:W),f=Math.cos(ne)*W,r=Math.sin(ne)*W,F=Math.sin(ne)*(s?s/2:W),i.moveTo(t-k,n-r),i.lineTo(t+k,n+r),i.moveTo(t+F,n-f),i.lineTo(t-F,n+f);break;case"star":k=Math.cos(ne)*(s?s/2:W),f=Math.cos(ne)*W,r=Math.sin(ne)*W,F=Math.sin(ne)*(s?s/2:W),i.moveTo(t-k,n-r),i.lineTo(t+k,n+r),i.moveTo(t+F,n-f),i.lineTo(t-F,n+f),ne+=qd,k=Math.cos(ne)*(s?s/2:W),f=Math.cos(ne)*W,r=Math.sin(ne)*W,F=Math.sin(ne)*(s?s/2:W),i.moveTo(t-k,n-r),i.lineTo(t+k,n+r),i.moveTo(t+F,n-f),i.lineTo(t-F,n+f);break;case"line":f=s?s/2:Math.cos(ne)*W,r=Math.sin(ne)*W,i.moveTo(t-f,n-r),i.lineTo(t+f,n+r);break;case"dash":i.moveTo(t,n),i.lineTo(t+Math.cos(ne)*(s?s/2:W),n+Math.sin(ne)*W);break;case!1:i.closePath();break}i.fill(),e.borderWidth>0&&i.stroke()}}function d0(i,e,t){return t=t||.5,!e||i&&i.x>e.left-t&&i.x<e.right+t&&i.y>e.top-t&&i.y<e.bottom+t}function YC(i,e){i.save(),i.beginPath(),i.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),i.clip()}function ZC(i){i.restore()}function Ule(i,e,t,n,s){if(!e)return i.lineTo(t.x,t.y);if(s==="middle"){const c=(e.x+t.x)/2;i.lineTo(c,e.y),i.lineTo(c,t.y)}else s==="after"!=!!n?i.lineTo(e.x,t.y):i.lineTo(t.x,e.y);i.lineTo(t.x,t.y)}function Vle(i,e,t,n){if(!e)return i.lineTo(t.x,t.y);i.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?t.cp2x:t.cp1x,n?t.cp2y:t.cp1y,t.x,t.y)}function $le(i,e){e.translation&&i.translate(e.translation[0],e.translation[1]),Fr(e.rotation)||i.rotate(e.rotation),e.color&&(i.fillStyle=e.color),e.textAlign&&(i.textAlign=e.textAlign),e.textBaseline&&(i.textBaseline=e.textBaseline)}function jle(i,e,t,n,s){if(s.strikethrough||s.underline){const c=i.measureText(n),f=e-c.actualBoundingBoxLeft,r=e+c.actualBoundingBoxRight,b=t-c.actualBoundingBoxAscent,w=t+c.actualBoundingBoxDescent,E=s.strikethrough?(b+w)/2:w;i.strokeStyle=i.fillStyle,i.beginPath(),i.lineWidth=s.decorationWidth||2,i.moveTo(f,E),i.lineTo(r,E),i.stroke()}}function Hle(i,e){const t=i.fillStyle;i.fillStyle=e.color,i.fillRect(e.left,e.top,e.width,e.height),i.fillStyle=t}function G1(i,e,t,n,s,c={}){const f=oo(e)?e:[e],r=c.strokeWidth>0&&c.strokeColor!=="";let b,w;for(i.save(),i.font=s.string,$le(i,c),b=0;b<f.length;++b)w=f[b],c.backdrop&&Hle(i,c.backdrop),r&&(c.strokeColor&&(i.strokeStyle=c.strokeColor),Fr(c.strokeWidth)||(i.lineWidth=c.strokeWidth),i.strokeText(w,t,n,c.maxWidth)),i.fillText(w,t,n,c.maxWidth),jle(i,t,n,w,c),n+=Number(s.lineHeight);i.restore()}function bE(i,e){const{x:t,y:n,w:s,h:c,radius:f}=e;i.arc(t+f.topLeft,n+f.topLeft,f.topLeft,1.5*Io,Io,!0),i.lineTo(t,n+c-f.bottomLeft),i.arc(t+f.bottomLeft,n+c-f.bottomLeft,f.bottomLeft,Io,Ll,!0),i.lineTo(t+s-f.bottomRight,n+c),i.arc(t+s-f.bottomRight,n+c-f.bottomRight,f.bottomRight,Ll,0,!0),i.lineTo(t+s,n+f.topRight),i.arc(t+s-f.topRight,n+f.topRight,f.topRight,0,-Ll,!0),i.lineTo(t+f.topLeft,n)}const Wle=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Gle=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Xle(i,e){const t=(""+i).match(Wle);if(!t||t[1]==="normal")return e*1.2;switch(i=+t[2],t[3]){case"px":return i;case"%":i/=100;break}return e*i}const qle=i=>+i||0;function Z4(i,e){const t={},n=fr(e),s=n?Object.keys(e):e,c=fr(i)?n?f=>Jn(i[f],i[e[f]]):f=>i[f]:()=>i;for(const f of s)t[f]=qle(c(f));return t}function Yle(i){return Z4(i,{top:"y",right:"x",bottom:"y",left:"x"})}function jy(i){return Z4(i,["topLeft","topRight","bottomLeft","bottomRight"])}function Vl(i){const e=Yle(i);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function na(i,e){i=i||{},e=e||ds.font;let t=Jn(i.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let n=Jn(i.style,e.style);n&&!(""+n).match(Gle)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const s={family:Jn(i.family,e.family),lineHeight:Xle(Jn(i.lineHeight,e.lineHeight),t),size:t,style:n,weight:Jn(i.weight,e.weight),string:""};return s.string=Nle(s),s}function _x(i,e,t,n){let s,c,f;for(s=0,c=i.length;s<c;++s)if(f=i[s],f!==void 0&&f!==void 0)return f}function Zle(i,e,t){const{min:n,max:s}=i,c=ole(e,(s-n)/2),f=(r,b)=>t&&r===0?0:r+b;return{min:f(n,-Math.abs(c)),max:f(s,c)}}function Ff(i,e){return Object.assign(Object.create(i),e)}function KC(i,e=[""],t,n,s=()=>i[0]){const c=t||i;typeof n>"u"&&(n=eN("_fallback",i));const f={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:i,_rootScopes:c,_fallback:n,_getTarget:s,override:r=>KC([r,...i],e,c,n)};return new Proxy(f,{deleteProperty(r,b){return delete r[b],delete r._keys,delete i[0][b],!0},get(r,b){return J4(r,b,()=>rce(b,e,i,r))},getOwnPropertyDescriptor(r,b){return Reflect.getOwnPropertyDescriptor(r._scopes[0],b)},getPrototypeOf(){return Reflect.getPrototypeOf(i[0])},has(r,b){return TB(r).includes(b)},ownKeys(r){return TB(r)},set(r,b,w){const E=r._storage||(r._storage=s());return r[b]=E[b]=w,delete r._keys,!0}})}function $m(i,e,t,n){const s={_cacheable:!1,_proxy:i,_context:e,_subProxy:t,_stack:new Set,_descriptors:K4(i,n),setContext:c=>$m(i,c,t,n),override:c=>$m(i.override(c),e,t,n)};return new Proxy(s,{deleteProperty(c,f){return delete c[f],delete i[f],!0},get(c,f,r){return J4(c,f,()=>Jle(c,f,r))},getOwnPropertyDescriptor(c,f){return c._descriptors.allKeys?Reflect.has(i,f)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(i,f)},getPrototypeOf(){return Reflect.getPrototypeOf(i)},has(c,f){return Reflect.has(i,f)},ownKeys(){return Reflect.ownKeys(i)},set(c,f,r){return i[f]=r,delete c[f],!0}})}function K4(i,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:n=e.indexable,_allKeys:s=e.allKeys}=i;return{allKeys:s,scriptable:t,indexable:n,isScriptable:$u(t)?t:()=>t,isIndexable:$u(n)?n:()=>n}}const Kle=(i,e)=>i?i+GC(e):e,JC=(i,e)=>fr(e)&&i!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function J4(i,e,t){if(Object.prototype.hasOwnProperty.call(i,e)||e==="constructor")return i[e];const n=t();return i[e]=n,n}function Jle(i,e,t){const{_proxy:n,_context:s,_subProxy:c,_descriptors:f}=i;let r=n[e];return $u(r)&&f.isScriptable(e)&&(r=Qle(e,r,i,t)),oo(r)&&r.length&&(r=ece(e,r,i,f.isIndexable)),JC(e,r)&&(r=$m(r,s,c&&c[e],f)),r}function Qle(i,e,t,n){const{_proxy:s,_context:c,_subProxy:f,_stack:r}=t;if(r.has(i))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+i);r.add(i);let b=e(c,f||n);return r.delete(i),JC(i,b)&&(b=QC(s._scopes,s,i,b)),b}function ece(i,e,t,n){const{_proxy:s,_context:c,_subProxy:f,_descriptors:r}=t;if(typeof c.index<"u"&&n(i))return e[c.index%e.length];if(fr(e[0])){const b=e,w=s._scopes.filter(E=>E!==b);e=[];for(const E of b){const k=QC(w,s,i,E);e.push($m(k,c,f&&f[i],r))}}return e}function Q4(i,e,t){return $u(i)?i(e,t):i}const tce=(i,e)=>i===!0?e:typeof i=="string"?j1(e,i):void 0;function ice(i,e,t,n,s){for(const c of e){const f=tce(t,c);if(f){i.add(f);const r=Q4(f._fallback,t,s);if(typeof r<"u"&&r!==t&&r!==n)return r}else if(f===!1&&typeof n<"u"&&t!==n)return null}return!1}function QC(i,e,t,n){const s=e._rootScopes,c=Q4(e._fallback,t,n),f=[...i,...s],r=new Set;r.add(n);let b=AB(r,f,t,c||t,n);return b===null||typeof c<"u"&&c!==t&&(b=AB(r,f,c,b,n),b===null)?!1:KC(Array.from(r),[""],s,c,()=>nce(e,t,n))}function AB(i,e,t,n,s){for(;t;)t=ice(i,e,t,n,s);return t}function nce(i,e,t){const n=i._getTarget();e in n||(n[e]={});const s=n[e];return oo(s)&&fr(t)?t:s||{}}function rce(i,e,t,n){let s;for(const c of e)if(s=eN(Kle(c,i),t),typeof s<"u")return JC(i,s)?QC(t,n,i,s):s}function eN(i,e){for(const t of e){if(!t)continue;const n=t[i];if(typeof n<"u")return n}}function TB(i){let e=i._keys;return e||(e=i._keys=sce(i._scopes)),e}function sce(i){const e=new Set;for(const t of i)for(const n of Object.keys(t).filter(s=>!s.startsWith("_")))e.add(n);return Array.from(e)}const oce=Number.EPSILON||1e-14,jm=(i,e)=>e<i.length&&!i[e].skip&&i[e],tN=i=>i==="x"?"y":"x";function ace(i,e,t,n){const s=i.skip?e:i,c=e,f=t.skip?e:t,r=gE(c,s),b=gE(f,c);let w=r/(r+b),E=b/(r+b);w=isNaN(w)?0:w,E=isNaN(E)?0:E;const k=n*w,F=n*E;return{previous:{x:c.x-k*(f.x-s.x),y:c.y-k*(f.y-s.y)},next:{x:c.x+F*(f.x-s.x),y:c.y+F*(f.y-s.y)}}}function lce(i,e,t){const n=i.length;let s,c,f,r,b,w=jm(i,0);for(let E=0;E<n-1;++E)if(b=w,w=jm(i,E+1),!(!b||!w)){if(Uy(e[E],0,oce)){t[E]=t[E+1]=0;continue}s=t[E]/e[E],c=t[E+1]/e[E],r=Math.pow(s,2)+Math.pow(c,2),!(r<=9)&&(f=3/Math.sqrt(r),t[E]=s*f*e[E],t[E+1]=c*f*e[E])}}function cce(i,e,t="x"){const n=tN(t),s=i.length;let c,f,r,b=jm(i,0);for(let w=0;w<s;++w){if(f=r,r=b,b=jm(i,w+1),!r)continue;const E=r[t],k=r[n];f&&(c=(E-f[t])/3,r[`cp1${t}`]=E-c,r[`cp1${n}`]=k-c*e[w]),b&&(c=(b[t]-E)/3,r[`cp2${t}`]=E+c,r[`cp2${n}`]=k+c*e[w])}}function hce(i,e="x"){const t=tN(e),n=i.length,s=Array(n).fill(0),c=Array(n);let f,r,b,w=jm(i,0);for(f=0;f<n;++f)if(r=b,b=w,w=jm(i,f+1),!!b){if(w){const E=w[e]-b[e];s[f]=E!==0?(w[t]-b[t])/E:0}c[f]=r?w?Vm(s[f-1])!==Vm(s[f])?0:(s[f-1]+s[f])/2:s[f-1]:s[f]}lce(i,s,c),cce(i,c,e)}function yx(i,e,t){return Math.max(Math.min(i,t),e)}function uce(i,e){let t,n,s,c,f,r=d0(i[0],e);for(t=0,n=i.length;t<n;++t)f=c,c=r,r=t<n-1&&d0(i[t+1],e),c&&(s=i[t],f&&(s.cp1x=yx(s.cp1x,e.left,e.right),s.cp1y=yx(s.cp1y,e.top,e.bottom)),r&&(s.cp2x=yx(s.cp2x,e.left,e.right),s.cp2y=yx(s.cp2y,e.top,e.bottom)))}function dce(i,e,t,n,s){let c,f,r,b;if(e.spanGaps&&(i=i.filter(w=>!w.skip)),e.cubicInterpolationMode==="monotone")hce(i,s);else{let w=n?i[i.length-1]:i[0];for(c=0,f=i.length;c<f;++c)r=i[c],b=ace(w,r,i[Math.min(c+1,f-(n?0:1))%f],e.tension),r.cp1x=b.previous.x,r.cp1y=b.previous.y,r.cp2x=b.next.x,r.cp2y=b.next.y,w=r}e.capBezierPoints&&uce(i,t)}function eI(){return typeof window<"u"&&typeof document<"u"}function tI(i){let e=i.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function X1(i,e,t){let n;return typeof i=="string"?(n=parseInt(i,10),i.indexOf("%")!==-1&&(n=n/100*e.parentNode[t])):n=i,n}const Rw=i=>i.ownerDocument.defaultView.getComputedStyle(i,null);function fce(i,e){return Rw(i).getPropertyValue(e)}const pce=["top","right","bottom","left"];function yf(i,e,t){const n={};t=t?"-"+t:"";for(let s=0;s<4;s++){const c=pce[s];n[c]=parseFloat(i[e+"-"+c+t])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const mce=(i,e,t)=>(i>0||e>0)&&(!t||!t.shadowRoot);function gce(i,e){const t=i.touches,n=t&&t.length?t[0]:i,{offsetX:s,offsetY:c}=n;let f=!1,r,b;if(mce(s,c,i.target))r=s,b=c;else{const w=e.getBoundingClientRect();r=n.clientX-w.left,b=n.clientY-w.top,f=!0}return{x:r,y:b,box:f}}function Jd(i,e){if("native"in i)return i;const{canvas:t,currentDevicePixelRatio:n}=e,s=Rw(t),c=s.boxSizing==="border-box",f=yf(s,"padding"),r=yf(s,"border","width"),{x:b,y:w,box:E}=gce(i,t),k=f.left+(E&&r.left),F=f.top+(E&&r.top);let{width:$,height:X}=e;return c&&($-=f.width+r.width,X-=f.height+r.height),{x:Math.round((b-k)/$*t.width/n),y:Math.round((w-F)/X*t.height/n)}}function _ce(i,e,t){let n,s;if(e===void 0||t===void 0){const c=i&&tI(i);if(!c)e=i.clientWidth,t=i.clientHeight;else{const f=c.getBoundingClientRect(),r=Rw(c),b=yf(r,"border","width"),w=yf(r,"padding");e=f.width-w.width-b.width,t=f.height-w.height-b.height,n=X1(r.maxWidth,c,"clientWidth"),s=X1(r.maxHeight,c,"clientHeight")}}return{width:e,height:t,maxWidth:n||W1,maxHeight:s||W1}}const bx=i=>Math.round(i*10)/10;function yce(i,e,t,n){const s=Rw(i),c=yf(s,"margin"),f=X1(s.maxWidth,i,"clientWidth")||W1,r=X1(s.maxHeight,i,"clientHeight")||W1,b=_ce(i,e,t);let{width:w,height:E}=b;if(s.boxSizing==="content-box"){const F=yf(s,"border","width"),$=yf(s,"padding");w-=$.width+F.width,E-=$.height+F.height}return w=Math.max(0,w-c.width),E=Math.max(0,n?w/n:E-c.height),w=bx(Math.min(w,f,b.maxWidth)),E=bx(Math.min(E,r,b.maxHeight)),w&&!E&&(E=bx(w/2)),(e!==void 0||t!==void 0)&&n&&b.height&&E>b.height&&(E=b.height,w=bx(Math.floor(E*n))),{width:w,height:E}}function SB(i,e,t){const n=e||1,s=Math.floor(i.height*n),c=Math.floor(i.width*n);i.height=Math.floor(i.height),i.width=Math.floor(i.width);const f=i.canvas;return f.style&&(t||!f.style.height&&!f.style.width)&&(f.style.height=`${i.height}px`,f.style.width=`${i.width}px`),i.currentDevicePixelRatio!==n||f.height!==s||f.width!==c?(i.currentDevicePixelRatio=n,f.height=s,f.width=c,i.ctx.setTransform(n,0,0,n,0,0),!0):!1}const bce=function(){let i=!1;try{const e={get passive(){return i=!0,!1}};eI()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return i}();function EB(i,e){const t=fce(i,e),n=t&&t.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function Qd(i,e,t,n){return{x:i.x+t*(e.x-i.x),y:i.y+t*(e.y-i.y)}}function vce(i,e,t,n){return{x:i.x+t*(e.x-i.x),y:n==="middle"?t<.5?i.y:e.y:n==="after"?t<1?i.y:e.y:t>0?e.y:i.y}}function xce(i,e,t,n){const s={x:i.cp2x,y:i.cp2y},c={x:e.cp1x,y:e.cp1y},f=Qd(i,s,t),r=Qd(s,c,t),b=Qd(c,e,t),w=Qd(f,r,t),E=Qd(r,b,t);return Qd(w,E,t)}const wce=function(i,e){return{x(t){return i+i+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,n){return t-n},leftForLtr(t,n){return t-n}}},Ace=function(){return{x(i){return i},setWidth(i){},textAlign(i){return i},xPlus(i,e){return i+e},leftForLtr(i,e){return i}}};function Im(i,e,t){return i?wce(e,t):Ace()}function iN(i,e){let t,n;(e==="ltr"||e==="rtl")&&(t=i.canvas.style,n=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),i.prevTextDirection=n)}function nN(i,e){e!==void 0&&(delete i.prevTextDirection,i.canvas.style.setProperty("direction",e[0],e[1]))}function rN(i){return i==="angle"?{between:$4,compare:vle,normalize:Tu}:{between:my,compare:(e,t)=>e-t,normalize:e=>e}}function CB({start:i,end:e,count:t,loop:n,style:s}){return{start:i%t,end:e%t,loop:n&&(e-i+1)%t===0,style:s}}function Tce(i,e,t){const{property:n,start:s,end:c}=t,{between:f,normalize:r}=rN(n),b=e.length;let{start:w,end:E,loop:k}=i,F,$;if(k){for(w+=b,E+=b,F=0,$=b;F<$&&f(r(e[w%b][n]),s,c);++F)w--,E--;w%=b,E%=b}return E<w&&(E+=b),{start:w,end:E,loop:k,style:i.style}}function Sce(i,e,t){if(!t)return[i];const{property:n,start:s,end:c}=t,f=e.length,{compare:r,between:b,normalize:w}=rN(n),{start:E,end:k,loop:F,style:$}=Tce(i,e,t),X=[];let W=!1,ne=null,_e,Te,we;const Ee=()=>b(s,we,_e)&&r(s,we)!==0,Le=()=>r(c,_e)===0||b(c,we,_e),Je=()=>W||Ee(),Tt=()=>!W||Le();for(let _t=E,St=E;_t<=k;++_t)Te=e[_t%f],!Te.skip&&(_e=w(Te[n]),_e!==we&&(W=b(_e,s,c),ne===null&&Je()&&(ne=r(_e,s)===0?_t:St),ne!==null&&Tt()&&(X.push(CB({start:ne,end:_t,loop:F,count:f,style:$})),ne=null),St=_t,we=_e));return ne!==null&&X.push(CB({start:ne,end:k,loop:F,count:f,style:$})),X}function Ece(i,e){const t=[],n=i.segments;for(let s=0;s<n.length;s++){const c=Sce(n[s],i.points,e);c.length&&t.push(...c)}return t}function Cce(i,e,t,n){let s=0,c=e-1;if(t&&!n)for(;s<e&&!i[s].skip;)s++;for(;s<e&&i[s].skip;)s++;for(s%=e,t&&(c+=s);c>s&&i[c%e].skip;)c--;return c%=e,{start:s,end:c}}function Ice(i,e,t,n){const s=i.length,c=[];let f=e,r=i[e],b;for(b=e+1;b<=t;++b){const w=i[b%s];w.skip||w.stop?r.skip||(n=!1,c.push({start:e%s,end:(b-1)%s,loop:n}),e=f=w.stop?b:null):(f=b,r.skip&&(e=b)),r=w}return f!==null&&c.push({start:e%s,end:f%s,loop:n}),c}function Mce(i,e){const t=i.points,n=i.options.spanGaps,s=t.length;if(!s)return[];const c=!!i._loop,{start:f,end:r}=Cce(t,s,c,n);if(n===!0)return IB(i,[{start:f,end:r,loop:c}],t,e);const b=r<f?r+s:r,w=!!i._fullLoop&&f===0&&r===s-1;return IB(i,Ice(t,f,b,w),t,e)}function IB(i,e,t,n){return!n||!n.setContext||!t?e:Rce(i,e,t,n)}function Rce(i,e,t,n){const s=i._chart.getContext(),c=MB(i.options),{_datasetIndex:f,options:{spanGaps:r}}=i,b=t.length,w=[];let E=c,k=e[0].start,F=k;function $(X,W,ne,_e){const Te=r?-1:1;if(X!==W){for(X+=b;t[X%b].skip;)X-=Te;for(;t[W%b].skip;)W+=Te;X%b!==W%b&&(w.push({start:X%b,end:W%b,loop:ne,style:_e}),E=_e,k=W%b)}}for(const X of e){k=r?k:X.start;let W=t[k%b],ne;for(F=k+1;F<=X.end;F++){const _e=t[F%b];ne=MB(n.setContext(Ff(s,{type:"segment",p0:W,p1:_e,p0DataIndex:(F-1)%b,p1DataIndex:F%b,datasetIndex:f}))),kce(ne,E)&&$(k,F-1,X.loop,E),W=_e,E=ne}k<F-1&&$(k,F-1,X.loop,E)}return w}function MB(i){return{backgroundColor:i.backgroundColor,borderCapStyle:i.borderCapStyle,borderDash:i.borderDash,borderDashOffset:i.borderDashOffset,borderJoinStyle:i.borderJoinStyle,borderWidth:i.borderWidth,borderColor:i.borderColor}}function kce(i,e){if(!e)return!1;const t=[],n=function(s,c){return qC(c)?(t.includes(c)||t.push(c),t.indexOf(c)):c};return JSON.stringify(i,n)!==JSON.stringify(e,n)}function vx(i,e,t){return i.options.clip?i[t]:e[t]}function Pce(i,e){const{xScale:t,yScale:n}=i;return t&&n?{left:vx(t,e,"left"),right:vx(t,e,"right"),top:vx(n,e,"top"),bottom:vx(n,e,"bottom")}:e}function Dce(i,e){const t=e._clip;if(t.disabled)return!1;const n=Pce(e,i.chartArea);return{left:t.left===!1?0:n.left-(t.left===!0?0:t.left),right:t.right===!1?i.width:n.right+(t.right===!0?0:t.right),top:t.top===!1?0:n.top-(t.top===!0?0:t.top),bottom:t.bottom===!1?i.height:n.bottom+(t.bottom===!0?0:t.bottom)}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class Bce{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,s){const c=t.listeners[s],f=t.duration;c.forEach(r=>r({chart:e,initial:t.initial,numSteps:f,currentStep:Math.min(n-t.start,f)}))}_refresh(){this._request||(this._running=!0,this._request=H4.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((n,s)=>{if(!n.running||!n.items.length)return;const c=n.items;let f=c.length-1,r=!1,b;for(;f>=0;--f)b=c[f],b._active?(b._total>n.duration&&(n.duration=b._total),b.tick(e),r=!0):(c[f]=c[c.length-1],c.pop());r&&(s.draw(),this._notify(s,n,e,"progress")),c.length||(n.running=!1,this._notify(s,n,e,"complete"),n.initial=!1),t+=c.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((n,s)=>Math.max(n,s._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const n=t.items;let s=n.length-1;for(;s>=0;--s)n[s].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var mh=new Bce;const RB="transparent",Oce={boolean(i,e,t){return t>.5?e:i},color(i,e,t){const n=bB(i||RB),s=n.valid&&bB(e||RB);return s&&s.valid?s.mix(n,t).hexString():e},number(i,e,t){return i+(e-i)*t}};class Fce{constructor(e,t,n,s){const c=t[n];s=_x([e.to,s,c,e.from]);const f=_x([e.from,c,s]);this._active=!0,this._fn=e.fn||Oce[e.type||typeof f],this._easing=Vy[e.easing]||Vy.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=f,this._to=s,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);const s=this._target[this._prop],c=n-this._start,f=this._duration-c;this._start=n,this._duration=Math.floor(Math.max(f,e.duration)),this._total+=c,this._loop=!!e.loop,this._to=_x([e.to,t,s,e.from]),this._from=_x([e.from,s,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,n=this._duration,s=this._prop,c=this._from,f=this._loop,r=this._to;let b;if(this._active=c!==r&&(f||t<n),!this._active){this._target[s]=r,this._notify(!0);return}if(t<0){this._target[s]=c;return}b=t/n%2,b=f&&b>1?2-b:b,b=this._easing(Math.min(1,Math.max(0,b))),this._target[s]=this._fn(c,r,b)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){const t=e?"res":"rej",n=this._promises||[];for(let s=0;s<n.length;s++)n[s][t]()}}class sN{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!fr(e))return;const t=Object.keys(ds.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(s=>{const c=e[s];if(!fr(c))return;const f={};for(const r of t)f[r]=c[r];(oo(c.properties)&&c.properties||[s]).forEach(r=>{(r===s||!n.has(r))&&n.set(r,f)})})}_animateOptions(e,t){const n=t.options,s=zce(e,n);if(!s)return[];const c=this._createAnimations(s,n);return n.$shared&&Lce(e.options.$animations,n).then(()=>{e.options=n},()=>{}),c}_createAnimations(e,t){const n=this._properties,s=[],c=e.$animations||(e.$animations={}),f=Object.keys(t),r=Date.now();let b;for(b=f.length-1;b>=0;--b){const w=f[b];if(w.charAt(0)==="$")continue;if(w==="options"){s.push(...this._animateOptions(e,t));continue}const E=t[w];let k=c[w];const F=n.get(w);if(k)if(F&&k.active()){k.update(F,E,r);continue}else k.cancel();if(!F||!F.duration){e[w]=E;continue}c[w]=k=new Fce(F,e,w,E),s.push(k)}return s}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const n=this._createAnimations(e,t);if(n.length)return mh.add(this._chart,n),!0}}function Lce(i,e){const t=[],n=Object.keys(e);for(let s=0;s<n.length;s++){const c=i[n[s]];c&&c.active()&&t.push(c.wait())}return Promise.all(t)}function zce(i,e){if(!e)return;let t=i.options;if(!t){i.options=e;return}return t.$shared&&(i.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function kB(i,e){const t=i&&i.options||{},n=t.reverse,s=t.min===void 0?e:0,c=t.max===void 0?e:0;return{start:n?c:s,end:n?s:c}}function Nce(i,e,t){if(t===!1)return!1;const n=kB(i,t),s=kB(e,t);return{top:s.end,right:n.end,bottom:s.start,left:n.start}}function Uce(i){let e,t,n,s;return fr(i)?(e=i.top,t=i.right,n=i.bottom,s=i.left):e=t=n=s=i,{top:e,right:t,bottom:n,left:s,disabled:i===!1}}function oN(i,e){const t=[],n=i._getSortedDatasetMetas(e);let s,c;for(s=0,c=n.length;s<c;++s)t.push(n[s].index);return t}function PB(i,e,t,n={}){const s=i.keys,c=n.mode==="single";let f,r,b,w;if(e===null)return;let E=!1;for(f=0,r=s.length;f<r;++f){if(b=+s[f],b===t){if(E=!0,n.all)continue;break}w=i.values[b],ul(w)&&(c||e===0||Vm(e)===Vm(w))&&(e+=w)}return!E&&!n.all?0:e}function Vce(i,e){const{iScale:t,vScale:n}=e,s=t.axis==="x"?"x":"y",c=n.axis==="x"?"x":"y",f=Object.keys(i),r=new Array(f.length);let b,w,E;for(b=0,w=f.length;b<w;++b)E=f[b],r[b]={[s]:E,[c]:i[E]};return r}function X2(i,e){const t=i&&i.options.stacked;return t||t===void 0&&e.stack!==void 0}function $ce(i,e,t){return`${i.id}.${e.id}.${t.stack||t.type}`}function jce(i){const{min:e,max:t,minDefined:n,maxDefined:s}=i.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:s?t:Number.POSITIVE_INFINITY}}function Hce(i,e,t){const n=i[e]||(i[e]={});return n[t]||(n[t]={})}function DB(i,e,t,n){for(const s of e.getMatchingVisibleMetas(n).reverse()){const c=i[s.index];if(t&&c>0||!t&&c<0)return s.index}return null}function BB(i,e){const{chart:t,_cachedMeta:n}=i,s=t._stacks||(t._stacks={}),{iScale:c,vScale:f,index:r}=n,b=c.axis,w=f.axis,E=$ce(c,f,n),k=e.length;let F;for(let $=0;$<k;++$){const X=e[$],{[b]:W,[w]:ne}=X,_e=X._stacks||(X._stacks={});F=_e[w]=Hce(s,E,W),F[r]=ne,F._top=DB(F,f,!0,n.type),F._bottom=DB(F,f,!1,n.type);const Te=F._visualValues||(F._visualValues={});Te[r]=ne}}function q2(i,e){const t=i.scales;return Object.keys(t).filter(n=>t[n].axis===e).shift()}function Wce(i,e){return Ff(i,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function Gce(i,e,t){return Ff(i,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function iy(i,e){const t=i.controller.index,n=i.vScale&&i.vScale.axis;if(n){e=e||i._parsed;for(const s of e){const c=s._stacks;if(!c||c[n]===void 0||c[n][t]===void 0)return;delete c[n][t],c[n]._visualValues!==void 0&&c[n]._visualValues[t]!==void 0&&delete c[n]._visualValues[t]}}}const Y2=i=>i==="reset"||i==="none",OB=(i,e)=>e?i:Object.assign({},i),Xce=(i,e,t)=>i&&!e.hidden&&e._stacked&&{keys:oN(t,!0),values:null};class Hy{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=X2(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&iy(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,n=this.getDataset(),s=(k,F,$,X)=>k==="x"?F:k==="r"?X:$,c=t.xAxisID=Jn(n.xAxisID,q2(e,"x")),f=t.yAxisID=Jn(n.yAxisID,q2(e,"y")),r=t.rAxisID=Jn(n.rAxisID,q2(e,"r")),b=t.indexAxis,w=t.iAxisID=s(b,c,f,r),E=t.vAxisID=s(b,f,c,r);t.xScale=this.getScaleForId(c),t.yScale=this.getScaleForId(f),t.rScale=this.getScaleForId(r),t.iScale=this.getScaleForId(w),t.vScale=this.getScaleForId(E)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&gB(this._data,this),e._stacked&&iy(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),n=this._data;if(fr(t)){const s=this._cachedMeta;this._data=Vce(t,s)}else if(n!==t){if(n){gB(n,this);const s=this._cachedMeta;iy(s),s._parsed=[]}t&&Object.isExtensible(t)&&Tle(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,n=this.getDataset();let s=!1;this._dataCheck();const c=t._stacked;t._stacked=X2(t.vScale,t),t.stack!==n.stack&&(s=!0,iy(t),t.stack=n.stack),this._resyncElements(e),(s||c!==t._stacked)&&(BB(this,t._parsed),t._stacked=X2(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:n,_data:s}=this,{iScale:c,_stacked:f}=n,r=c.axis;let b=e===0&&t===s.length?!0:n._sorted,w=e>0&&n._parsed[e-1],E,k,F;if(this._parsing===!1)n._parsed=s,n._sorted=!0,F=s;else{oo(s[e])?F=this.parseArrayData(n,s,e,t):fr(s[e])?F=this.parseObjectData(n,s,e,t):F=this.parsePrimitiveData(n,s,e,t);const $=()=>k[r]===null||w&&k[r]<w[r];for(E=0;E<t;++E)n._parsed[E+e]=k=F[E],b&&($()&&(b=!1),w=k);n._sorted=b}f&&BB(this,F)}parsePrimitiveData(e,t,n,s){const{iScale:c,vScale:f}=e,r=c.axis,b=f.axis,w=c.getLabels(),E=c===f,k=new Array(s);let F,$,X;for(F=0,$=s;F<$;++F)X=F+n,k[F]={[r]:E||c.parse(w[X],X),[b]:f.parse(t[X],X)};return k}parseArrayData(e,t,n,s){const{xScale:c,yScale:f}=e,r=new Array(s);let b,w,E,k;for(b=0,w=s;b<w;++b)E=b+n,k=t[E],r[b]={x:c.parse(k[0],E),y:f.parse(k[1],E)};return r}parseObjectData(e,t,n,s){const{xScale:c,yScale:f}=e,{xAxisKey:r="x",yAxisKey:b="y"}=this._parsing,w=new Array(s);let E,k,F,$;for(E=0,k=s;E<k;++E)F=E+n,$=t[F],w[E]={x:c.parse(j1($,r),F),y:f.parse(j1($,b),F)};return w}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,n){const s=this.chart,c=this._cachedMeta,f=t[e.axis],r={keys:oN(s,!0),values:t._stacks[e.axis]._visualValues};return PB(r,f,c.index,{mode:n})}updateRangeFromParsed(e,t,n,s){const c=n[t.axis];let f=c===null?NaN:c;const r=s&&n._stacks[t.axis];s&&r&&(s.values=r,f=PB(s,c,this._cachedMeta.index)),e.min=Math.min(e.min,f),e.max=Math.max(e.max,f)}getMinMax(e,t){const n=this._cachedMeta,s=n._parsed,c=n._sorted&&e===n.iScale,f=s.length,r=this._getOtherScale(e),b=Xce(t,n,this.chart),w={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:E,max:k}=jce(r);let F,$;function X(){$=s[F];const W=$[r.axis];return!ul($[e.axis])||E>W||k<W}for(F=0;F<f&&!(!X()&&(this.updateRangeFromParsed(w,e,$,b),c));++F);if(c){for(F=f-1;F>=0;--F)if(!X()){this.updateRangeFromParsed(w,e,$,b);break}}return w}getAllParsedValues(e){const t=this._cachedMeta._parsed,n=[];let s,c,f;for(s=0,c=t.length;s<c;++s)f=t[s][e.axis],ul(f)&&n.push(f);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,n=t.iScale,s=t.vScale,c=this.getParsed(e);return{label:n?""+n.getLabelForValue(c[n.axis]):"",value:s?""+s.getLabelForValue(c[s.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=Uce(Jn(this.options.clip,Nce(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,n=this._cachedMeta,s=n.data||[],c=t.chartArea,f=[],r=this._drawStart||0,b=this._drawCount||s.length-r,w=this.options.drawActiveElementsOnTop;let E;for(n.dataset&&n.dataset.draw(e,c,r,b),E=r;E<r+b;++E){const k=s[E];k.hidden||(k.active&&w?f.push(k):k.draw(e,c))}for(E=0;E<f.length;++E)f[E].draw(e,c)}getStyle(e,t){const n=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,t,n){const s=this.getDataset();let c;if(e>=0&&e<this._cachedMeta.data.length){const f=this._cachedMeta.data[e];c=f.$context||(f.$context=Gce(this.getContext(),e,f)),c.parsed=this.getParsed(e),c.raw=s.data[e],c.index=c.dataIndex=e}else c=this.$context||(this.$context=Wce(this.chart.getContext(),this.index)),c.dataset=s,c.index=c.datasetIndex=this.index;return c.active=!!t,c.mode=n,c}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",n){const s=t==="active",c=this._cachedDataOpts,f=e+"-"+t,r=c[f],b=this.enableOptionSharing&&H1(n);if(r)return OB(r,b);const w=this.chart.config,E=w.datasetElementScopeKeys(this._type,e),k=s?[`${e}Hover`,"hover",e,""]:[e,""],F=w.getOptionScopes(this.getDataset(),E),$=Object.keys(ds.elements[e]),X=()=>this.getContext(n,s,t),W=w.resolveNamedOptions(F,$,X,k);return W.$shared&&(W.$shared=b,c[f]=Object.freeze(OB(W,b))),W}_resolveAnimations(e,t,n){const s=this.chart,c=this._cachedDataOpts,f=`animation-${t}`,r=c[f];if(r)return r;let b;if(s.options.animation!==!1){const E=this.chart.config,k=E.datasetAnimationScopeKeys(this._type,t),F=E.getOptionScopes(this.getDataset(),k);b=E.createResolver(F,this.getContext(e,n,t))}const w=new sN(s,b&&b.animations);return b&&b._cacheable&&(c[f]=Object.freeze(w)),w}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||Y2(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const n=this.resolveDataElementOptions(e,t),s=this._sharedOptions,c=this.getSharedOptions(n),f=this.includeOptions(t,c)||c!==s;return this.updateSharedOptions(c,t,n),{sharedOptions:c,includeOptions:f}}updateElement(e,t,n,s){Y2(s)?Object.assign(e,n):this._resolveAnimations(t,s).update(e,n)}updateSharedOptions(e,t,n){e&&!Y2(t)&&this._resolveAnimations(void 0,t).update(e,n)}_setStyle(e,t,n,s){e.active=s;const c=this.getStyle(t,s);this._resolveAnimations(t,n,s).update(e,{options:!s&&this.getSharedOptions(c)||c})}removeHoverStyle(e,t,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,t,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,n=this._cachedMeta.data;for(const[r,b,w]of this._syncList)this[r](b,w);this._syncList=[];const s=n.length,c=t.length,f=Math.min(c,s);f&&this.parse(0,f),c>s?this._insertElements(s,c-s,e):c<s&&this._removeElements(c,s-c)}_insertElements(e,t,n=!0){const s=this._cachedMeta,c=s.data,f=e+t;let r;const b=w=>{for(w.length+=t,r=w.length-1;r>=f;r--)w[r]=w[r-t]};for(b(c),r=e;r<f;++r)c[r]=new this.dataElementType;this._parsing&&b(s._parsed),this.parse(e,t),n&&this.updateElements(c,e,t,"reset")}updateElements(e,t,n,s){}_removeElements(e,t){const n=this._cachedMeta;if(this._parsing){const s=n._parsed.splice(e,t);n._stacked&&iy(n,s)}n.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,n,s]=e;this[t](n,s)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ce(Hy,"defaults",{}),ce(Hy,"datasetElementType",null),ce(Hy,"dataElementType",null);class Gx extends Hy{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:n,data:s=[],_dataset:c}=t,f=this.chart._animationsDisabled;let{start:r,count:b}=Ile(t,s,f);this._drawStart=r,this._drawCount=b,Mle(t)&&(r=0,b=s.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!c._decimated,n.points=s;const w=this.resolveDatasetElementOptions(e);this.options.showLine||(w.borderWidth=0),w.segment=this.options.segment,this.updateElement(n,void 0,{animated:!f,options:w},e),this.updateElements(s,r,b,e)}updateElements(e,t,n,s){const c=s==="reset",{iScale:f,vScale:r,_stacked:b,_dataset:w}=this._cachedMeta,{sharedOptions:E,includeOptions:k}=this._getSharedOptions(t,s),F=f.axis,$=r.axis,{spanGaps:X,segment:W}=this.options,ne=u0(X)?X:Number.POSITIVE_INFINITY,_e=this.chart._animationsDisabled||c||s==="none",Te=t+n,we=e.length;let Ee=t>0&&this.getParsed(t-1);for(let Le=0;Le<we;++Le){const Je=e[Le],Tt=_e?Je:{};if(Le<t||Le>=Te){Tt.skip=!0;continue}const _t=this.getParsed(Le),St=Fr(_t[$]),kt=Tt[F]=f.getPixelForValue(_t[F],Le),Lt=Tt[$]=c||St?r.getBasePixel():r.getPixelForValue(b?this.applyStack(r,_t,b):_t[$],Le);Tt.skip=isNaN(kt)||isNaN(Lt)||St,Tt.stop=Le>0&&Math.abs(_t[F]-Ee[F])>ne,W&&(Tt.parsed=_t,Tt.raw=w.data[Le]),k&&(Tt.options=E||this.resolveDataElementOptions(Le,Je.active?"active":s)),_e||this.updateElement(Je,Le,Tt,s),Ee=_t}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,n=t.options&&t.options.borderWidth||0,s=e.data||[];if(!s.length)return n;const c=s[0].size(this.resolveDataElementOptions(0)),f=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(n,c,f)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}ce(Gx,"id","line"),ce(Gx,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),ce(Gx,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});function Zd(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class iI{constructor(e){ce(this,"options");this.options=e||{}}static override(e){Object.assign(iI.prototype,e)}init(){}formats(){return Zd()}parse(){return Zd()}format(){return Zd()}add(){return Zd()}diff(){return Zd()}startOf(){return Zd()}endOf(){return Zd()}}var qce={_date:iI};function Yce(i,e,t,n){const{controller:s,data:c,_sorted:f}=i,r=s._cachedMeta.iScale,b=i.dataset&&i.dataset.options?i.dataset.options.spanGaps:null;if(r&&e===r.axis&&e!=="r"&&f&&c.length){const w=r._reversePixels?wle:hf;if(n){if(s._sharedOptions){const E=c[0],k=typeof E.getRange=="function"&&E.getRange(e);if(k){const F=w(c,e,t-k),$=w(c,e,t+k);return{lo:F.lo,hi:$.hi}}}}else{const E=w(c,e,t);if(b){const{vScale:k}=s._cachedMeta,{_parsed:F}=i,$=F.slice(0,E.lo+1).reverse().findIndex(W=>!Fr(W[k.axis]));E.lo-=Math.max(0,$);const X=F.slice(E.hi).findIndex(W=>!Fr(W[k.axis]));E.hi+=Math.max(0,X)}return E}}return{lo:0,hi:c.length-1}}function kw(i,e,t,n,s){const c=i.getSortedVisibleDatasetMetas(),f=t[e];for(let r=0,b=c.length;r<b;++r){const{index:w,data:E}=c[r],{lo:k,hi:F}=Yce(c[r],e,f,s);for(let $=k;$<=F;++$){const X=E[$];X.skip||n(X,w,$)}}}function Zce(i){const e=i.indexOf("x")!==-1,t=i.indexOf("y")!==-1;return function(n,s){const c=e?Math.abs(n.x-s.x):0,f=t?Math.abs(n.y-s.y):0;return Math.sqrt(Math.pow(c,2)+Math.pow(f,2))}}function Z2(i,e,t,n,s){const c=[];return!s&&!i.isPointInArea(e)||kw(i,t,e,function(r,b,w){!s&&!d0(r,i.chartArea,0)||r.inRange(e.x,e.y,n)&&c.push({element:r,datasetIndex:b,index:w})},!0),c}function Kce(i,e,t,n){let s=[];function c(f,r,b){const{startAngle:w,endAngle:E}=f.getProps(["startAngle","endAngle"],n),{angle:k}=ble(f,{x:e.x,y:e.y});$4(k,w,E)&&s.push({element:f,datasetIndex:r,index:b})}return kw(i,t,e,c),s}function Jce(i,e,t,n,s,c){let f=[];const r=Zce(t);let b=Number.POSITIVE_INFINITY;function w(E,k,F){const $=E.inRange(e.x,e.y,s);if(n&&!$)return;const X=E.getCenterPoint(s);if(!(!!c||i.isPointInArea(X))&&!$)return;const ne=r(e,X);ne<b?(f=[{element:E,datasetIndex:k,index:F}],b=ne):ne===b&&f.push({element:E,datasetIndex:k,index:F})}return kw(i,t,e,w),f}function K2(i,e,t,n,s,c){return!c&&!i.isPointInArea(e)?[]:t==="r"&&!n?Kce(i,e,t,s):Jce(i,e,t,n,s,c)}function FB(i,e,t,n,s){const c=[],f=t==="x"?"inXRange":"inYRange";let r=!1;return kw(i,t,e,(b,w,E)=>{b[f]&&b[f](e[t],s)&&(c.push({element:b,datasetIndex:w,index:E}),r=r||b.inRange(e.x,e.y,s))}),n&&!r?[]:c}var Qce={modes:{index(i,e,t,n){const s=Jd(e,i),c=t.axis||"x",f=t.includeInvisible||!1,r=t.intersect?Z2(i,s,c,n,f):K2(i,s,c,!1,n,f),b=[];return r.length?(i.getSortedVisibleDatasetMetas().forEach(w=>{const E=r[0].index,k=w.data[E];k&&!k.skip&&b.push({element:k,datasetIndex:w.index,index:E})}),b):[]},dataset(i,e,t,n){const s=Jd(e,i),c=t.axis||"xy",f=t.includeInvisible||!1;let r=t.intersect?Z2(i,s,c,n,f):K2(i,s,c,!1,n,f);if(r.length>0){const b=r[0].datasetIndex,w=i.getDatasetMeta(b).data;r=[];for(let E=0;E<w.length;++E)r.push({element:w[E],datasetIndex:b,index:E})}return r},point(i,e,t,n){const s=Jd(e,i),c=t.axis||"xy",f=t.includeInvisible||!1;return Z2(i,s,c,n,f)},nearest(i,e,t,n){const s=Jd(e,i),c=t.axis||"xy",f=t.includeInvisible||!1;return K2(i,s,c,t.intersect,n,f)},x(i,e,t,n){const s=Jd(e,i);return FB(i,s,"x",t.intersect,n)},y(i,e,t,n){const s=Jd(e,i);return FB(i,s,"y",t.intersect,n)}}};const aN=["left","top","right","bottom"];function ny(i,e){return i.filter(t=>t.pos===e)}function LB(i,e){return i.filter(t=>aN.indexOf(t.pos)===-1&&t.box.axis===e)}function ry(i,e){return i.sort((t,n)=>{const s=e?n:t,c=e?t:n;return s.weight===c.weight?s.index-c.index:s.weight-c.weight})}function ehe(i){const e=[];let t,n,s,c,f,r;for(t=0,n=(i||[]).length;t<n;++t)s=i[t],{position:c,options:{stack:f,stackWeight:r=1}}=s,e.push({index:t,box:s,pos:c,horizontal:s.isHorizontal(),weight:s.weight,stack:f&&c+f,stackWeight:r});return e}function the(i){const e={};for(const t of i){const{stack:n,pos:s,stackWeight:c}=t;if(!n||!aN.includes(s))continue;const f=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});f.count++,f.weight+=c}return e}function ihe(i,e){const t=the(i),{vBoxMaxWidth:n,hBoxMaxHeight:s}=e;let c,f,r;for(c=0,f=i.length;c<f;++c){r=i[c];const{fullSize:b}=r.box,w=t[r.stack],E=w&&r.stackWeight/w.weight;r.horizontal?(r.width=E?E*n:b&&e.availableWidth,r.height=s):(r.width=n,r.height=E?E*s:b&&e.availableHeight)}return t}function nhe(i){const e=ehe(i),t=ry(e.filter(w=>w.box.fullSize),!0),n=ry(ny(e,"left"),!0),s=ry(ny(e,"right")),c=ry(ny(e,"top"),!0),f=ry(ny(e,"bottom")),r=LB(e,"x"),b=LB(e,"y");return{fullSize:t,leftAndTop:n.concat(c),rightAndBottom:s.concat(b).concat(f).concat(r),chartArea:ny(e,"chartArea"),vertical:n.concat(s).concat(b),horizontal:c.concat(f).concat(r)}}function zB(i,e,t,n){return Math.max(i[t],e[t])+Math.max(i[n],e[n])}function lN(i,e){i.top=Math.max(i.top,e.top),i.left=Math.max(i.left,e.left),i.bottom=Math.max(i.bottom,e.bottom),i.right=Math.max(i.right,e.right)}function rhe(i,e,t,n){const{pos:s,box:c}=t,f=i.maxPadding;if(!fr(s)){t.size&&(i[s]-=t.size);const k=n[t.stack]||{size:0,count:1};k.size=Math.max(k.size,t.horizontal?c.height:c.width),t.size=k.size/k.count,i[s]+=t.size}c.getPadding&&lN(f,c.getPadding());const r=Math.max(0,e.outerWidth-zB(f,i,"left","right")),b=Math.max(0,e.outerHeight-zB(f,i,"top","bottom")),w=r!==i.w,E=b!==i.h;return i.w=r,i.h=b,t.horizontal?{same:w,other:E}:{same:E,other:w}}function she(i){const e=i.maxPadding;function t(n){const s=Math.max(e[n]-i[n],0);return i[n]+=s,s}i.y+=t("top"),i.x+=t("left"),t("right"),t("bottom")}function ohe(i,e){const t=e.maxPadding;function n(s){const c={left:0,top:0,right:0,bottom:0};return s.forEach(f=>{c[f]=Math.max(e[f],t[f])}),c}return n(i?["left","right"]:["top","bottom"])}function gy(i,e,t,n){const s=[];let c,f,r,b,w,E;for(c=0,f=i.length,w=0;c<f;++c){r=i[c],b=r.box,b.update(r.width||e.w,r.height||e.h,ohe(r.horizontal,e));const{same:k,other:F}=rhe(e,t,r,n);w|=k&&s.length,E=E||F,b.fullSize||s.push(r)}return w&&gy(s,e,t,n)||E}function xx(i,e,t,n,s){i.top=t,i.left=e,i.right=e+n,i.bottom=t+s,i.width=n,i.height=s}function NB(i,e,t,n){const s=t.padding;let{x:c,y:f}=e;for(const r of i){const b=r.box,w=n[r.stack]||{placed:0,weight:1},E=r.stackWeight/w.weight||1;if(r.horizontal){const k=e.w*E,F=w.size||b.height;H1(w.start)&&(f=w.start),b.fullSize?xx(b,s.left,f,t.outerWidth-s.right-s.left,F):xx(b,e.left+w.placed,f,k,F),w.start=f,w.placed+=k,f=b.bottom}else{const k=e.h*E,F=w.size||b.width;H1(w.start)&&(c=w.start),b.fullSize?xx(b,c,s.top,F,t.outerHeight-s.bottom-s.top):xx(b,c,e.top+w.placed,F,k),w.start=c,w.placed+=k,c=b.right}}e.x=c,e.y=f}var Du={addBox(i,e){i.boxes||(i.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},i.boxes.push(e)},removeBox(i,e){const t=i.boxes?i.boxes.indexOf(e):-1;t!==-1&&i.boxes.splice(t,1)},configure(i,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(i,e,t,n){if(!i)return;const s=Vl(i.options.layout.padding),c=Math.max(e-s.width,0),f=Math.max(t-s.height,0),r=nhe(i.boxes),b=r.vertical,w=r.horizontal;wr(i.boxes,W=>{typeof W.beforeLayout=="function"&&W.beforeLayout()});const E=b.reduce((W,ne)=>ne.box.options&&ne.box.options.display===!1?W:W+1,0)||1,k=Object.freeze({outerWidth:e,outerHeight:t,padding:s,availableWidth:c,availableHeight:f,vBoxMaxWidth:c/2/E,hBoxMaxHeight:f/2}),F=Object.assign({},s);lN(F,Vl(n));const $=Object.assign({maxPadding:F,w:c,h:f,x:s.left,y:s.top},s),X=ihe(b.concat(w),k);gy(r.fullSize,$,k,X),gy(b,$,k,X),gy(w,$,k,X)&&gy(b,$,k,X),she($),NB(r.leftAndTop,$,k,X),$.x+=$.w,$.y+=$.h,NB(r.rightAndBottom,$,k,X),i.chartArea={left:$.left,top:$.top,right:$.left+$.w,bottom:$.top+$.h,height:$.h,width:$.w},wr(r.chartArea,W=>{const ne=W.box;Object.assign(ne,i.chartArea),ne.update($.w,$.h,{left:0,top:0,right:0,bottom:0})})}};class cN{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,s){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,s?Math.floor(t/s):n)}}isAttached(e){return!0}updateConfig(e){}}class ahe extends cN{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Xx="$chartjs",lhe={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},UB=i=>i===null||i==="";function che(i,e){const t=i.style,n=i.getAttribute("height"),s=i.getAttribute("width");if(i[Xx]={initial:{height:n,width:s,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",UB(s)){const c=EB(i,"width");c!==void 0&&(i.width=c)}if(UB(n))if(i.style.height==="")i.height=i.width/(e||2);else{const c=EB(i,"height");c!==void 0&&(i.height=c)}return i}const hN=bce?{passive:!0}:!1;function hhe(i,e,t){i&&i.addEventListener(e,t,hN)}function uhe(i,e,t){i&&i.canvas&&i.canvas.removeEventListener(e,t,hN)}function dhe(i,e){const t=lhe[i.type]||i.type,{x:n,y:s}=Jd(i,e);return{type:t,chart:e,native:i,x:n!==void 0?n:null,y:s!==void 0?s:null}}function q1(i,e){for(const t of i)if(t===e||t.contains(e))return!0}function fhe(i,e,t){const n=i.canvas,s=new MutationObserver(c=>{let f=!1;for(const r of c)f=f||q1(r.addedNodes,n),f=f&&!q1(r.removedNodes,n);f&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}function phe(i,e,t){const n=i.canvas,s=new MutationObserver(c=>{let f=!1;for(const r of c)f=f||q1(r.removedNodes,n),f=f&&!q1(r.addedNodes,n);f&&t()});return s.observe(document,{childList:!0,subtree:!0}),s}const f0=new Map;let VB=0;function uN(){const i=window.devicePixelRatio;i!==VB&&(VB=i,f0.forEach((e,t)=>{t.currentDevicePixelRatio!==i&&e()}))}function mhe(i,e){f0.size||window.addEventListener("resize",uN),f0.set(i,e)}function ghe(i){f0.delete(i),f0.size||window.removeEventListener("resize",uN)}function _he(i,e,t){const n=i.canvas,s=n&&tI(n);if(!s)return;const c=W4((r,b)=>{const w=s.clientWidth;t(r,b),w<s.clientWidth&&t()},window),f=new ResizeObserver(r=>{const b=r[0],w=b.contentRect.width,E=b.contentRect.height;w===0&&E===0||c(w,E)});return f.observe(s),mhe(i,c),f}function J2(i,e,t){t&&t.disconnect(),e==="resize"&&ghe(i)}function yhe(i,e,t){const n=i.canvas,s=W4(c=>{i.ctx!==null&&t(dhe(c,i))},i);return hhe(n,e,s),s}class bhe extends cN{acquireContext(e,t){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(che(e,t),n):null}releaseContext(e){const t=e.canvas;if(!t[Xx])return!1;const n=t[Xx].initial;["height","width"].forEach(c=>{const f=n[c];Fr(f)?t.removeAttribute(c):t.setAttribute(c,f)});const s=n.style||{};return Object.keys(s).forEach(c=>{t.style[c]=s[c]}),t.width=t.width,delete t[Xx],!0}addEventListener(e,t,n){this.removeEventListener(e,t);const s=e.$proxies||(e.$proxies={}),f={attach:fhe,detach:phe,resize:_he}[t]||yhe;s[t]=f(e,t,n)}removeEventListener(e,t){const n=e.$proxies||(e.$proxies={}),s=n[t];if(!s)return;({attach:J2,detach:J2,resize:J2}[t]||uhe)(e,t,s),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,s){return yce(e,t,n,s)}isAttached(e){const t=e&&tI(e);return!!(t&&t.isConnected)}}function vhe(i){return!eI()||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?ahe:bhe}var Cx;let eg=(Cx=class{constructor(){ce(this,"x");ce(this,"y");ce(this,"active",!1);ce(this,"options");ce(this,"$animations")}tooltipPosition(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return u0(this.x)&&u0(this.y)}getProps(e,t){const n=this.$animations;if(!t||!n)return this;const s={};return e.forEach(c=>{s[c]=n[c]&&n[c].active()?n[c]._to:this[c]}),s}},ce(Cx,"defaults",{}),ce(Cx,"defaultRoutes"),Cx);function xhe(i,e){const t=i.options.ticks,n=whe(i),s=Math.min(t.maxTicksLimit||n,n),c=t.major.enabled?The(e):[],f=c.length,r=c[0],b=c[f-1],w=[];if(f>s)return She(e,w,c,f/s),w;const E=Ahe(c,e,s);if(f>0){let k,F;const $=f>1?Math.round((b-r)/(f-1)):null;for(wx(e,w,E,Fr($)?0:r-$,r),k=0,F=f-1;k<F;k++)wx(e,w,E,c[k],c[k+1]);return wx(e,w,E,b,Fr($)?e.length:b+$),w}return wx(e,w,E),w}function whe(i){const e=i.options.offset,t=i._tickSize(),n=i._length/t+(e?0:1),s=i._maxLength/t;return Math.floor(Math.min(n,s))}function Ahe(i,e,t){const n=Ehe(i),s=e.length/t;if(!n)return Math.max(s,1);const c=ple(n);for(let f=0,r=c.length-1;f<r;f++){const b=c[f];if(b>s)return b}return Math.max(s,1)}function The(i){const e=[];let t,n;for(t=0,n=i.length;t<n;t++)i[t].major&&e.push(t);return e}function She(i,e,t,n){let s=0,c=t[0],f;for(n=Math.ceil(n),f=0;f<i.length;f++)f===c&&(e.push(i[f]),s++,c=t[s*n])}function wx(i,e,t,n,s){const c=Jn(n,0),f=Math.min(Jn(s,i.length),i.length);let r=0,b,w,E;for(t=Math.ceil(t),s&&(b=s-n,t=b/Math.floor(b/t)),E=c;E<0;)r++,E=Math.round(c+r*t);for(w=Math.max(c,0);w<f;w++)w===E&&(e.push(i[w]),r++,E=Math.round(c+r*t))}function Ehe(i){const e=i.length;let t,n;if(e<2)return!1;for(n=i[0],t=1;t<e;++t)if(i[t]-i[t-1]!==n)return!1;return n}const Che=i=>i==="left"?"right":i==="right"?"left":i,$B=(i,e,t)=>e==="top"||e==="left"?i[e]+t:i[e]-t,jB=(i,e)=>Math.min(e||i,i);function HB(i,e){const t=[],n=i.length/e,s=i.length;let c=0;for(;c<s;c+=n)t.push(i[Math.floor(c)]);return t}function Ihe(i,e,t){const n=i.ticks.length,s=Math.min(e,n-1),c=i._startPixel,f=i._endPixel,r=1e-6;let b=i.getPixelForTick(s),w;if(!(t&&(n===1?w=Math.max(b-c,f-b):e===0?w=(i.getPixelForTick(1)-b)/2:w=(b-i.getPixelForTick(s-1))/2,b+=s<e?w:-w,b<c-r||b>f+r)))return b}function Mhe(i,e){wr(i,t=>{const n=t.gc,s=n.length/2;let c;if(s>e){for(c=0;c<s;++c)delete t.data[n[c]];n.splice(0,s)}})}function sy(i){return i.drawTicks?i.tickLength:0}function WB(i,e){if(!i.display)return 0;const t=na(i.font,e),n=Vl(i.padding);return(oo(i.text)?i.text.length:1)*t.lineHeight+n.height}function Rhe(i,e){return Ff(i,{scale:e,type:"scale"})}function khe(i,e,t){return Ff(i,{tick:t,index:e,type:"tick"})}function Phe(i,e,t){let n=G4(i);return(t&&e!=="right"||!t&&e==="right")&&(n=Che(n)),n}function Dhe(i,e,t,n){const{top:s,left:c,bottom:f,right:r,chart:b}=i,{chartArea:w,scales:E}=b;let k=0,F,$,X;const W=f-s,ne=r-c;if(i.isHorizontal()){if($=Ra(n,c,r),fr(t)){const _e=Object.keys(t)[0],Te=t[_e];X=E[_e].getPixelForValue(Te)+W-e}else t==="center"?X=(w.bottom+w.top)/2+W-e:X=$B(i,t,e);F=r-c}else{if(fr(t)){const _e=Object.keys(t)[0],Te=t[_e];$=E[_e].getPixelForValue(Te)-ne+e}else t==="center"?$=(w.left+w.right)/2-ne+e:$=$B(i,t,e);X=Ra(n,f,s),k=t==="left"?-Ll:Ll}return{titleX:$,titleY:X,maxWidth:F,rotation:k}}class tg extends eg{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:s}=this;return e=xc(e,Number.POSITIVE_INFINITY),t=xc(t,Number.NEGATIVE_INFINITY),n=xc(n,Number.POSITIVE_INFINITY),s=xc(s,Number.NEGATIVE_INFINITY),{min:xc(e,n),max:xc(t,s),minDefined:ul(e),maxDefined:ul(t)}}getMinMax(e){let{min:t,max:n,minDefined:s,maxDefined:c}=this.getUserBounds(),f;if(s&&c)return{min:t,max:n};const r=this.getMatchingVisibleMetas();for(let b=0,w=r.length;b<w;++b)f=r[b].controller.getMinMax(this,e),s||(t=Math.min(t,f.min)),c||(n=Math.max(n,f.max));return t=c&&t>n?n:t,n=s&&t>n?t:n,{min:xc(t,xc(n,t)),max:xc(n,xc(t,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){zr(this.options.beforeUpdate,[this])}update(e,t,n){const{beginAtZero:s,grace:c,ticks:f}=this.options,r=f.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Zle(this,c,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const b=r<this.ticks.length;this._convertTicksToLabels(b?HB(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),f.display&&(f.autoSkip||f.source==="auto")&&(this.ticks=xhe(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),b&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,n;this.isHorizontal()?(t=this.left,n=this.right):(t=this.top,n=this.bottom,e=!e),this._startPixel=t,this._endPixel=n,this._reversePixels=e,this._length=n-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){zr(this.options.afterUpdate,[this])}beforeSetDimensions(){zr(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){zr(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),zr(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){zr(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let n,s,c;for(n=0,s=e.length;n<s;n++)c=e[n],c.label=zr(t.callback,[c.value,n,e],this)}afterTickToLabelConversion(){zr(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){zr(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,n=jB(this.ticks.length,e.ticks.maxTicksLimit),s=t.minRotation||0,c=t.maxRotation;let f=s,r,b,w;if(!this._isVisible()||!t.display||s>=c||n<=1||!this.isHorizontal()){this.labelRotation=s;return}const E=this._getLabelSizes(),k=E.widest.width,F=E.highest.height,$=ol(this.chart.width-k,0,this.maxWidth);r=e.offset?this.maxWidth/n:$/(n-1),k+6>r&&(r=$/(n-(e.offset?.5:1)),b=this.maxHeight-sy(e.grid)-t.padding-WB(e.title,this.chart.options.font),w=Math.sqrt(k*k+F*F),f=yle(Math.min(Math.asin(ol((E.highest.height+6)/r,-1,1)),Math.asin(ol(b/w,-1,1))-Math.asin(ol(F/w,-1,1)))),f=Math.max(s,Math.min(c,f))),this.labelRotation=f}afterCalculateLabelRotation(){zr(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){zr(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:n,title:s,grid:c}}=this,f=this._isVisible(),r=this.isHorizontal();if(f){const b=WB(s,t.options.font);if(r?(e.width=this.maxWidth,e.height=sy(c)+b):(e.height=this.maxHeight,e.width=sy(c)+b),n.display&&this.ticks.length){const{first:w,last:E,widest:k,highest:F}=this._getLabelSizes(),$=n.padding*2,X=cf(this.labelRotation),W=Math.cos(X),ne=Math.sin(X);if(r){const _e=n.mirror?0:ne*k.width+W*F.height;e.height=Math.min(this.maxHeight,e.height+_e+$)}else{const _e=n.mirror?0:W*k.width+ne*F.height;e.width=Math.min(this.maxWidth,e.width+_e+$)}this._calculatePadding(w,E,ne,W)}}this._handleMargins(),r?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,s){const{ticks:{align:c,padding:f},position:r}=this.options,b=this.labelRotation!==0,w=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const E=this.getPixelForTick(0)-this.left,k=this.right-this.getPixelForTick(this.ticks.length-1);let F=0,$=0;b?w?(F=s*e.width,$=n*t.height):(F=n*e.height,$=s*t.width):c==="start"?$=t.width:c==="end"?F=e.width:c!=="inner"&&(F=e.width/2,$=t.width/2),this.paddingLeft=Math.max((F-E+f)*this.width/(this.width-E),0),this.paddingRight=Math.max(($-k+f)*this.width/(this.width-k),0)}else{let E=t.height/2,k=e.height/2;c==="start"?(E=0,k=e.height):c==="end"&&(E=t.height,k=0),this.paddingTop=E+f,this.paddingBottom=k+f}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){zr(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,n;for(t=0,n=e.length;t<n;t++)Fr(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let n=this.ticks;t<n.length&&(n=HB(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){const{ctx:s,_longestTextCache:c}=this,f=[],r=[],b=Math.floor(t/jB(t,n));let w=0,E=0,k,F,$,X,W,ne,_e,Te,we,Ee,Le;for(k=0;k<t;k+=b){if(X=e[k].label,W=this._resolveTickFontOptions(k),s.font=ne=W.string,_e=c[ne]=c[ne]||{data:{},gc:[]},Te=W.lineHeight,we=Ee=0,!Fr(X)&&!oo(X))we=xB(s,_e.data,_e.gc,we,X),Ee=Te;else if(oo(X))for(F=0,$=X.length;F<$;++F)Le=X[F],!Fr(Le)&&!oo(Le)&&(we=xB(s,_e.data,_e.gc,we,Le),Ee+=Te);f.push(we),r.push(Ee),w=Math.max(we,w),E=Math.max(Ee,E)}Mhe(c,t);const Je=f.indexOf(w),Tt=r.indexOf(E),_t=St=>({width:f[St]||0,height:r[St]||0});return{first:_t(0),last:_t(t-1),widest:_t(Je),highest:_t(Tt),widths:f,heights:r}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return xle(this._alignToPixels?Yd(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const n=t[e];return n.$context||(n.$context=khe(this.getContext(),e,n))}return this.$context||(this.$context=Rhe(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=cf(this.labelRotation),n=Math.abs(Math.cos(t)),s=Math.abs(Math.sin(t)),c=this._getLabelSizes(),f=e.autoSkipPadding||0,r=c?c.widest.width+f:0,b=c?c.highest.height+f:0;return this.isHorizontal()?b*n>r*s?r/n:b/s:b*s<r*n?b/n:r/s}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,n=this.chart,s=this.options,{grid:c,position:f,border:r}=s,b=c.offset,w=this.isHorizontal(),k=this.ticks.length+(b?1:0),F=sy(c),$=[],X=r.setContext(this.getContext()),W=X.display?X.width:0,ne=W/2,_e=function(Zi){return Yd(n,Zi,W)};let Te,we,Ee,Le,Je,Tt,_t,St,kt,Lt,si,bi;if(f==="top")Te=_e(this.bottom),Tt=this.bottom-F,St=Te-ne,Lt=_e(e.top)+ne,bi=e.bottom;else if(f==="bottom")Te=_e(this.top),Lt=e.top,bi=_e(e.bottom)-ne,Tt=Te+ne,St=this.top+F;else if(f==="left")Te=_e(this.right),Je=this.right-F,_t=Te-ne,kt=_e(e.left)+ne,si=e.right;else if(f==="right")Te=_e(this.left),kt=e.left,si=_e(e.right)-ne,Je=Te+ne,_t=this.left+F;else if(t==="x"){if(f==="center")Te=_e((e.top+e.bottom)/2+.5);else if(fr(f)){const Zi=Object.keys(f)[0],Cn=f[Zi];Te=_e(this.chart.scales[Zi].getPixelForValue(Cn))}Lt=e.top,bi=e.bottom,Tt=Te+ne,St=Tt+F}else if(t==="y"){if(f==="center")Te=_e((e.left+e.right)/2);else if(fr(f)){const Zi=Object.keys(f)[0],Cn=f[Zi];Te=_e(this.chart.scales[Zi].getPixelForValue(Cn))}Je=Te-ne,_t=Je-F,kt=e.left,si=e.right}const ii=Jn(s.ticks.maxTicksLimit,k),vi=Math.max(1,Math.ceil(k/ii));for(we=0;we<k;we+=vi){const Zi=this.getContext(we),Cn=c.setContext(Zi),nr=r.setContext(Zi),vr=Cn.lineWidth,Qi=Cn.color,Gr=nr.dash||[],Js=nr.dashOffset,mo=Cn.tickWidth,Is=Cn.tickColor,on=Cn.tickBorderDash||[],cn=Cn.tickBorderDashOffset;Ee=Ihe(this,we,b),Ee!==void 0&&(Le=Yd(n,Ee,vr),w?Je=_t=kt=si=Le:Tt=St=Lt=bi=Le,$.push({tx1:Je,ty1:Tt,tx2:_t,ty2:St,x1:kt,y1:Lt,x2:si,y2:bi,width:vr,color:Qi,borderDash:Gr,borderDashOffset:Js,tickWidth:mo,tickColor:Is,tickBorderDash:on,tickBorderDashOffset:cn}))}return this._ticksLength=k,this._borderValue=Te,$}_computeLabelItems(e){const t=this.axis,n=this.options,{position:s,ticks:c}=n,f=this.isHorizontal(),r=this.ticks,{align:b,crossAlign:w,padding:E,mirror:k}=c,F=sy(n.grid),$=F+E,X=k?-E:$,W=-cf(this.labelRotation),ne=[];let _e,Te,we,Ee,Le,Je,Tt,_t,St,kt,Lt,si,bi="middle";if(s==="top")Je=this.bottom-X,Tt=this._getXAxisLabelAlignment();else if(s==="bottom")Je=this.top+X,Tt=this._getXAxisLabelAlignment();else if(s==="left"){const vi=this._getYAxisLabelAlignment(F);Tt=vi.textAlign,Le=vi.x}else if(s==="right"){const vi=this._getYAxisLabelAlignment(F);Tt=vi.textAlign,Le=vi.x}else if(t==="x"){if(s==="center")Je=(e.top+e.bottom)/2+$;else if(fr(s)){const vi=Object.keys(s)[0],Zi=s[vi];Je=this.chart.scales[vi].getPixelForValue(Zi)+$}Tt=this._getXAxisLabelAlignment()}else if(t==="y"){if(s==="center")Le=(e.left+e.right)/2-$;else if(fr(s)){const vi=Object.keys(s)[0],Zi=s[vi];Le=this.chart.scales[vi].getPixelForValue(Zi)}Tt=this._getYAxisLabelAlignment(F).textAlign}t==="y"&&(b==="start"?bi="top":b==="end"&&(bi="bottom"));const ii=this._getLabelSizes();for(_e=0,Te=r.length;_e<Te;++_e){we=r[_e],Ee=we.label;const vi=c.setContext(this.getContext(_e));_t=this.getPixelForTick(_e)+c.labelOffset,St=this._resolveTickFontOptions(_e),kt=St.lineHeight,Lt=oo(Ee)?Ee.length:1;const Zi=Lt/2,Cn=vi.color,nr=vi.textStrokeColor,vr=vi.textStrokeWidth;let Qi=Tt;f?(Le=_t,Tt==="inner"&&(_e===Te-1?Qi=this.options.reverse?"left":"right":_e===0?Qi=this.options.reverse?"right":"left":Qi="center"),s==="top"?w==="near"||W!==0?si=-Lt*kt+kt/2:w==="center"?si=-ii.highest.height/2-Zi*kt+kt:si=-ii.highest.height+kt/2:w==="near"||W!==0?si=kt/2:w==="center"?si=ii.highest.height/2-Zi*kt:si=ii.highest.height-Lt*kt,k&&(si*=-1),W!==0&&!vi.showLabelBackdrop&&(Le+=kt/2*Math.sin(W))):(Je=_t,si=(1-Lt)*kt/2);let Gr;if(vi.showLabelBackdrop){const Js=Vl(vi.backdropPadding),mo=ii.heights[_e],Is=ii.widths[_e];let on=si-Js.top,cn=0-Js.left;switch(bi){case"middle":on-=mo/2;break;case"bottom":on-=mo;break}switch(Tt){case"center":cn-=Is/2;break;case"right":cn-=Is;break;case"inner":_e===Te-1?cn-=Is:_e>0&&(cn-=Is/2);break}Gr={left:cn,top:on,width:Is+Js.width,height:mo+Js.height,color:vi.backdropColor}}ne.push({label:Ee,font:St,textOffset:si,options:{rotation:W,color:Cn,strokeColor:nr,strokeWidth:vr,textAlign:Qi,textBaseline:bi,translation:[Le,Je],backdrop:Gr}})}return ne}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-cf(this.labelRotation))return e==="top"?"left":"right";let s="center";return t.align==="start"?s="left":t.align==="end"?s="right":t.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:n,mirror:s,padding:c}}=this.options,f=this._getLabelSizes(),r=e+c,b=f.widest.width;let w,E;return t==="left"?s?(E=this.right+c,n==="near"?w="left":n==="center"?(w="center",E+=b/2):(w="right",E+=b)):(E=this.right-r,n==="near"?w="right":n==="center"?(w="center",E-=b/2):(w="left",E=this.left)):t==="right"?s?(E=this.left+c,n==="near"?w="right":n==="center"?(w="center",E-=b/2):(w="left",E-=b)):(E=this.left+r,n==="near"?w="left":n==="center"?(w="center",E+=b/2):(w="right",E=this.right)):w="right",{textAlign:w,x:E}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:n,top:s,width:c,height:f}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,s,c,f),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const s=this.ticks.findIndex(c=>c.value===e);return s>=0?t.setContext(this.getContext(s)).lineWidth:0}drawGrid(e){const t=this.options.grid,n=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let c,f;const r=(b,w,E)=>{!E.width||!E.color||(n.save(),n.lineWidth=E.width,n.strokeStyle=E.color,n.setLineDash(E.borderDash||[]),n.lineDashOffset=E.borderDashOffset,n.beginPath(),n.moveTo(b.x,b.y),n.lineTo(w.x,w.y),n.stroke(),n.restore())};if(t.display)for(c=0,f=s.length;c<f;++c){const b=s[c];t.drawOnChartArea&&r({x:b.x1,y:b.y1},{x:b.x2,y:b.y2},b),t.drawTicks&&r({x:b.tx1,y:b.ty1},{x:b.tx2,y:b.ty2},{color:b.tickColor,width:b.tickWidth,borderDash:b.tickBorderDash,borderDashOffset:b.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:n,grid:s}}=this,c=n.setContext(this.getContext()),f=n.display?c.width:0;if(!f)return;const r=s.setContext(this.getContext(0)).lineWidth,b=this._borderValue;let w,E,k,F;this.isHorizontal()?(w=Yd(e,this.left,f)-f/2,E=Yd(e,this.right,r)+r/2,k=F=b):(k=Yd(e,this.top,f)-f/2,F=Yd(e,this.bottom,r)+r/2,w=E=b),t.save(),t.lineWidth=c.width,t.strokeStyle=c.color,t.beginPath(),t.moveTo(w,k),t.lineTo(E,F),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const n=this.ctx,s=this._computeLabelArea();s&&YC(n,s);const c=this.getLabelItems(e);for(const f of c){const r=f.options,b=f.font,w=f.label,E=f.textOffset;G1(n,w,0,E,b,r)}s&&ZC(n)}drawTitle(){const{ctx:e,options:{position:t,title:n,reverse:s}}=this;if(!n.display)return;const c=na(n.font),f=Vl(n.padding),r=n.align;let b=c.lineHeight/2;t==="bottom"||t==="center"||fr(t)?(b+=f.bottom,oo(n.text)&&(b+=c.lineHeight*(n.text.length-1))):b+=f.top;const{titleX:w,titleY:E,maxWidth:k,rotation:F}=Dhe(this,b,t,r);G1(e,n.text,0,0,c,{color:n.color,maxWidth:k,rotation:F,textAlign:Phe(r,t,s),textBaseline:"middle",translation:[w,E]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,n=Jn(e.grid&&e.grid.z,-1),s=Jn(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==tg.prototype.draw?[{z:t,draw:c=>{this.draw(c)}}]:[{z:n,draw:c=>{this.drawBackground(),this.drawGrid(c),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:t,draw:c=>{this.drawLabels(c)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",s=[];let c,f;for(c=0,f=t.length;c<f;++c){const r=t[c];r[n]===this.id&&(!e||r.type===e)&&s.push(r)}return s}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return na(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class Ax{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let n;Fhe(t)&&(n=this.register(t));const s=this.items,c=e.id,f=this.scope+"."+c;if(!c)throw new Error("class does not have id: "+e);return c in s||(s[c]=e,Bhe(e,f,n),this.override&&ds.override(e.id,e.overrides)),f}get(e){return this.items[e]}unregister(e){const t=this.items,n=e.id,s=this.scope;n in t&&delete t[n],s&&n in ds[s]&&(delete ds[s][n],this.override&&delete Cf[n])}}function Bhe(i,e,t){const n=h0(Object.create(null),[t?ds.get(t):{},ds.get(e),i.defaults]);ds.set(e,n),i.defaultRoutes&&Ohe(e,i.defaultRoutes),i.descriptors&&ds.describe(e,i.descriptors)}function Ohe(i,e){Object.keys(e).forEach(t=>{const n=t.split("."),s=n.pop(),c=[i].concat(n).join("."),f=e[t].split("."),r=f.pop(),b=f.join(".");ds.route(c,s,b,r)})}function Fhe(i){return"id"in i&&"defaults"in i}class Lhe{constructor(){this.controllers=new Ax(Hy,"datasets",!0),this.elements=new Ax(eg,"elements"),this.plugins=new Ax(Object,"plugins"),this.scales=new Ax(tg,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,n){[...t].forEach(s=>{const c=n||this._getRegistryForType(s);n||c.isForType(s)||c===this.plugins&&s.id?this._exec(e,c,s):wr(s,f=>{const r=n||this._getRegistryForType(f);this._exec(e,r,f)})})}_exec(e,t,n){const s=GC(e);zr(n["before"+s],[],n),t[e](n),zr(n["after"+s],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){const s=t.get(e);if(s===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return s}}var Ac=new Lhe;class zhe{constructor(){this._init=[]}notify(e,t,n,s){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const c=s?this._descriptors(e).filter(s):this._descriptors(e),f=this._notify(c,e,t,n);return t==="afterDestroy"&&(this._notify(c,e,"stop"),this._notify(this._init,e,"uninstall")),f}_notify(e,t,n,s){s=s||{};for(const c of e){const f=c.plugin,r=f[n],b=[t,s,c.options];if(zr(r,b,f)===!1&&s.cancelable)return!1}return!0}invalidate(){Fr(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const n=e&&e.config,s=Jn(n.options&&n.options.plugins,{}),c=Nhe(n);return s===!1&&!t?[]:Vhe(e,c,s,t)}_notifyStateChanges(e){const t=this._oldCache||[],n=this._cache,s=(c,f)=>c.filter(r=>!f.some(b=>r.plugin.id===b.plugin.id));this._notify(s(t,n),e,"stop"),this._notify(s(n,t),e,"start")}}function Nhe(i){const e={},t=[],n=Object.keys(Ac.plugins.items);for(let c=0;c<n.length;c++)t.push(Ac.getPlugin(n[c]));const s=i.plugins||[];for(let c=0;c<s.length;c++){const f=s[c];t.indexOf(f)===-1&&(t.push(f),e[f.id]=!0)}return{plugins:t,localIds:e}}function Uhe(i,e){return!e&&i===!1?null:i===!0?{}:i}function Vhe(i,{plugins:e,localIds:t},n,s){const c=[],f=i.getContext();for(const r of e){const b=r.id,w=Uhe(n[b],s);w!==null&&c.push({plugin:r,options:$he(i.config,{plugin:r,local:t[b]},w,f)})}return c}function $he(i,{plugin:e,local:t},n,s){const c=i.pluginScopeKeys(e),f=i.getOptionScopes(n,c);return t&&e.defaults&&f.push(e.defaults),i.createResolver(f,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function vE(i,e){const t=ds.datasets[i]||{};return((e.datasets||{})[i]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function jhe(i,e){let t=i;return i==="_index_"?t=e:i==="_value_"&&(t=e==="x"?"y":"x"),t}function Hhe(i,e){return i===e?"_index_":"_value_"}function GB(i){if(i==="x"||i==="y"||i==="r")return i}function Whe(i){if(i==="top"||i==="bottom")return"x";if(i==="left"||i==="right")return"y"}function xE(i,...e){if(GB(i))return i;for(const t of e){const n=t.axis||Whe(t.position)||i.length>1&&GB(i[0].toLowerCase());if(n)return n}throw new Error(`Cannot determine type of '${i}' axis. Please provide 'axis' or 'position' option.`)}function XB(i,e,t){if(t[e+"AxisID"]===i)return{axis:e}}function Ghe(i,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(n=>n.xAxisID===i||n.yAxisID===i);if(t.length)return XB(i,"x",t[0])||XB(i,"y",t[0])}return{}}function Xhe(i,e){const t=Cf[i.type]||{scales:{}},n=e.scales||{},s=vE(i.type,e),c=Object.create(null);return Object.keys(n).forEach(f=>{const r=n[f];if(!fr(r))return console.error(`Invalid scale configuration for scale: ${f}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${f}`);const b=xE(f,r,Ghe(f,i),ds.scales[r.type]),w=Hhe(b,s),E=t.scales||{};c[f]=Ny(Object.create(null),[{axis:b},r,E[b],E[w]])}),i.data.datasets.forEach(f=>{const r=f.type||i.type,b=f.indexAxis||vE(r,e),E=(Cf[r]||{}).scales||{};Object.keys(E).forEach(k=>{const F=jhe(k,b),$=f[F+"AxisID"]||F;c[$]=c[$]||Object.create(null),Ny(c[$],[{axis:F},n[$],E[k]])})}),Object.keys(c).forEach(f=>{const r=c[f];Ny(r,[ds.scales[r.type],ds.scale])}),c}function dN(i){const e=i.options||(i.options={});e.plugins=Jn(e.plugins,{}),e.scales=Xhe(i,e)}function fN(i){return i=i||{},i.datasets=i.datasets||[],i.labels=i.labels||[],i}function qhe(i){return i=i||{},i.data=fN(i.data),dN(i),i}const qB=new Map,pN=new Set;function Tx(i,e){let t=qB.get(i);return t||(t=e(),qB.set(i,t),pN.add(t)),t}const oy=(i,e,t)=>{const n=j1(e,t);n!==void 0&&i.add(n)};class Yhe{constructor(e){this._config=qhe(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=fN(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),dN(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Tx(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Tx(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Tx(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,n=this.type;return Tx(`${n}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const n=this._scopeCache;let s=n.get(e);return(!s||t)&&(s=new Map,n.set(e,s)),s}getOptionScopes(e,t,n){const{options:s,type:c}=this,f=this._cachedScopes(e,n),r=f.get(t);if(r)return r;const b=new Set;t.forEach(E=>{e&&(b.add(e),E.forEach(k=>oy(b,e,k))),E.forEach(k=>oy(b,s,k)),E.forEach(k=>oy(b,Cf[c]||{},k)),E.forEach(k=>oy(b,ds,k)),E.forEach(k=>oy(b,_E,k))});const w=Array.from(b);return w.length===0&&w.push(Object.create(null)),pN.has(t)&&f.set(t,w),w}chartOptionScopes(){const{options:e,type:t}=this;return[e,Cf[t]||{},ds.datasets[t]||{},{type:t},ds,_E]}resolveNamedOptions(e,t,n,s=[""]){const c={$shared:!0},{resolver:f,subPrefixes:r}=YB(this._resolverCache,e,s);let b=f;if(Khe(f,t)){c.$shared=!1,n=$u(n)?n():n;const w=this.createResolver(e,n,r);b=$m(f,n,w)}for(const w of t)c[w]=b[w];return c}createResolver(e,t,n=[""],s){const{resolver:c}=YB(this._resolverCache,e,n);return fr(t)?$m(c,t,void 0,s):c}}function YB(i,e,t){let n=i.get(e);n||(n=new Map,i.set(e,n));const s=t.join();let c=n.get(s);return c||(c={resolver:KC(e,t),subPrefixes:t.filter(r=>!r.toLowerCase().includes("hover"))},n.set(s,c)),c}const Zhe=i=>fr(i)&&Object.getOwnPropertyNames(i).some(e=>$u(i[e]));function Khe(i,e){const{isScriptable:t,isIndexable:n}=K4(i);for(const s of e){const c=t(s),f=n(s),r=(f||c)&&i[s];if(c&&($u(r)||Zhe(r))||f&&oo(r))return!0}return!1}var Jhe="4.4.9";const Qhe=["top","bottom","left","right","chartArea"];function ZB(i,e){return i==="top"||i==="bottom"||Qhe.indexOf(i)===-1&&e==="x"}function KB(i,e){return function(t,n){return t[i]===n[i]?t[e]-n[e]:t[i]-n[i]}}function JB(i){const e=i.chart,t=e.options.animation;e.notifyPlugins("afterRender"),zr(t&&t.onComplete,[i],e)}function eue(i){const e=i.chart,t=e.options.animation;zr(t&&t.onProgress,[i],e)}function mN(i){return eI()&&typeof i=="string"?i=document.getElementById(i):i&&i.length&&(i=i[0]),i&&i.canvas&&(i=i.canvas),i}const qx={},QB=i=>{const e=mN(i);return Object.values(qx).filter(t=>t.canvas===e).pop()};function tue(i,e,t){const n=Object.keys(i);for(const s of n){const c=+s;if(c>=e){const f=i[s];delete i[s],(t>0||c>e)&&(i[c+t]=f)}}}function iue(i,e,t,n){return!t||i.type==="mouseout"?null:n?e:i}class vh{static register(...e){Ac.add(...e),eO()}static unregister(...e){Ac.remove(...e),eO()}constructor(e,t){const n=this.config=new Yhe(t),s=mN(e),c=QB(s);if(c)throw new Error("Canvas is already in use. Chart with ID '"+c.id+"' must be destroyed before the canvas with ID '"+c.canvas.id+"' can be reused.");const f=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||vhe(s)),this.platform.updateConfig(n);const r=this.platform.acquireContext(s,f.aspectRatio),b=r&&r.canvas,w=b&&b.height,E=b&&b.width;if(this.id=sle(),this.ctx=r,this.canvas=b,this.width=E,this.height=w,this._options=f,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new zhe,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Ele(k=>this.update(k),f.resizeDelay||0),this._dataChanges=[],qx[this.id]=this,!r||!b){console.error("Failed to create chart: can't acquire context from the given item");return}mh.listen(this,"complete",JB),mh.listen(this,"progress",eue),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:n,height:s,_aspectRatio:c}=this;return Fr(e)?t&&c?c:s?n/s:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Ac}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():SB(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return wB(this.canvas,this.ctx),this}stop(){return mh.stop(this),this}resize(e,t){mh.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const n=this.options,s=this.canvas,c=n.maintainAspectRatio&&this.aspectRatio,f=this.platform.getMaximumSize(s,e,t,c),r=n.devicePixelRatio||this.platform.getDevicePixelRatio(),b=this.width?"resize":"attach";this.width=f.width,this.height=f.height,this._aspectRatio=this.aspectRatio,SB(this,r,!0)&&(this.notifyPlugins("resize",{size:f}),zr(n.onResize,[this,f],this),this.attached&&this._doResize(b)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};wr(t,(n,s)=>{n.id=s})}buildOrUpdateScales(){const e=this.options,t=e.scales,n=this.scales,s=Object.keys(n).reduce((f,r)=>(f[r]=!1,f),{});let c=[];t&&(c=c.concat(Object.keys(t).map(f=>{const r=t[f],b=xE(f,r),w=b==="r",E=b==="x";return{options:r,dposition:w?"chartArea":E?"bottom":"left",dtype:w?"radialLinear":E?"category":"linear"}}))),wr(c,f=>{const r=f.options,b=r.id,w=xE(b,r),E=Jn(r.type,f.dtype);(r.position===void 0||ZB(r.position,w)!==ZB(f.dposition))&&(r.position=f.dposition),s[b]=!0;let k=null;if(b in n&&n[b].type===E)k=n[b];else{const F=Ac.getScale(E);k=new F({id:b,type:E,ctx:this.ctx,chart:this}),n[k.id]=k}k.init(r,e)}),wr(s,(f,r)=>{f||delete n[r]}),wr(n,f=>{Du.configure(this,f,f.options),Du.addBox(this,f)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,n=e.length;if(e.sort((s,c)=>s.index-c.index),n>t){for(let s=t;s<n;++s)this._destroyDatasetMeta(s);e.splice(t,n-t)}this._sortedMetasets=e.slice(0).sort(KB("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((n,s)=>{t.filter(c=>c===n._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let n,s;for(this._removeUnreferencedMetasets(),n=0,s=t.length;n<s;n++){const c=t[n];let f=this.getDatasetMeta(n);const r=c.type||this.config.type;if(f.type&&f.type!==r&&(this._destroyDatasetMeta(n),f=this.getDatasetMeta(n)),f.type=r,f.indexAxis=c.indexAxis||vE(r,this.options),f.order=c.order||0,f.index=n,f.label=""+c.label,f.visible=this.isDatasetVisible(n),f.controller)f.controller.updateIndex(n),f.controller.linkScales();else{const b=Ac.getController(r),{datasetElementType:w,dataElementType:E}=ds.datasets[r];Object.assign(b,{dataElementType:Ac.getElement(E),datasetElementType:w&&Ac.getElement(w)}),f.controller=new b(this,n),e.push(f.controller)}}return this._updateMetasets(),e}_resetElements(){wr(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const n=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const c=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let f=0;for(let w=0,E=this.data.datasets.length;w<E;w++){const{controller:k}=this.getDatasetMeta(w),F=!s&&c.indexOf(k)===-1;k.buildOrUpdateElements(F),f=Math.max(+k.getMaxOverflow(),f)}f=this._minPadding=n.layout.autoPadding?f:0,this._updateLayout(f),s||wr(c,w=>{w.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(KB("z","_idx"));const{_active:r,_lastEvent:b}=this;b?this._eventHandler(b,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){wr(this.scales,e=>{Du.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),n=new Set(e.events);(!dB(t,n)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:n,start:s,count:c}of t){const f=n==="_removeElements"?-c:c;tue(e,s,f)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,n=c=>new Set(e.filter(f=>f[0]===c).map((f,r)=>r+","+f.splice(1).join(","))),s=n(0);for(let c=1;c<t;c++)if(!dB(s,n(c)))return;return Array.from(s).map(c=>c.split(",")).map(c=>({method:c[1],start:+c[2],count:+c[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Du.update(this,this.width,this.height,e);const t=this.chartArea,n=t.width<=0||t.height<=0;this._layers=[],wr(this.boxes,s=>{n&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,c)=>{s._idx=c}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,n=this.data.datasets.length;t<n;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,n=this.data.datasets.length;t<n;++t)this._updateDataset(t,$u(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const n=this.getDatasetMeta(e),s={meta:n,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(n.controller._update(t),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(mh.has(this)?this.attached&&!mh.running(this)&&mh.start(this):(this.draw(),JB({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:n,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(n,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,n=[];let s,c;for(s=0,c=t.length;s<c;++s){const f=t[s];(!e||f.visible)&&n.push(f)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,n={meta:e,index:e.index,cancelable:!0},s=Dce(this,e);this.notifyPlugins("beforeDatasetDraw",n)!==!1&&(s&&YC(t,s),e.controller.draw(),s&&ZC(t),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(e){return d0(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,n,s){const c=Qce.modes[t];return typeof c=="function"?c(this,e,n,s):[]}getDatasetMeta(e){const t=this.data.datasets[e],n=this._metasets;let s=n.filter(c=>c&&c._dataset===t).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},n.push(s)),s}getContext(){return this.$context||(this.$context=Ff(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const n=this.getDatasetMeta(e);return typeof n.hidden=="boolean"?!n.hidden:!t.hidden}setDatasetVisibility(e,t){const n=this.getDatasetMeta(e);n.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,n){const s=n?"show":"hide",c=this.getDatasetMeta(e),f=c.controller._resolveAnimations(void 0,s);H1(t)?(c.data[t].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),f.update(c,{visible:n}),this.update(r=>r.datasetIndex===e?s:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),mh.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),wB(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete qx[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,n=(c,f)=>{t.addEventListener(this,c,f),e[c]=f},s=(c,f,r)=>{c.offsetX=f,c.offsetY=r,this._eventHandler(c)};wr(this.options.events,c=>n(c,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,n=(b,w)=>{t.addEventListener(this,b,w),e[b]=w},s=(b,w)=>{e[b]&&(t.removeEventListener(this,b,w),delete e[b])},c=(b,w)=>{this.canvas&&this.resize(b,w)};let f;const r=()=>{s("attach",r),this.attached=!0,this.resize(),n("resize",c),n("detach",f)};f=()=>{this.attached=!1,s("resize",c),this._stop(),this._resize(0,0),n("attach",r)},t.isAttached(this.canvas)?r():f()}unbindEvents(){wr(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},wr(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,n){const s=n?"set":"remove";let c,f,r,b;for(t==="dataset"&&(c=this.getDatasetMeta(e[0].datasetIndex),c.controller["_"+s+"DatasetHoverStyle"]()),r=0,b=e.length;r<b;++r){f=e[r];const w=f&&this.getDatasetMeta(f.datasetIndex).controller;w&&w[s+"HoverStyle"](f.element,f.datasetIndex,f.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],n=e.map(({datasetIndex:c,index:f})=>{const r=this.getDatasetMeta(c);if(!r)throw new Error("No dataset found at index "+c);return{datasetIndex:c,element:r.data[f],index:f}});!V1(n,t)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,t))}notifyPlugins(e,t,n){return this._plugins.notify(this,e,t,n)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,n){const s=this.options.hover,c=(b,w)=>b.filter(E=>!w.some(k=>E.datasetIndex===k.datasetIndex&&E.index===k.index)),f=c(t,e),r=n?e:c(e,t);f.length&&this.updateHoverStyle(f,s.mode,!1),r.length&&s.mode&&this.updateHoverStyle(r,s.mode,!0)}_eventHandler(e,t){const n={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},s=f=>(f.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",n,s)===!1)return;const c=this._handleEvent(e,t,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,s),(c||n.changed)&&this.render(),this}_handleEvent(e,t,n){const{_active:s=[],options:c}=this,f=t,r=this._getActiveElements(e,s,n,f),b=ule(e),w=iue(e,this._lastEvent,n,b);n&&(this._lastEvent=null,zr(c.onHover,[e,r,this],this),b&&zr(c.onClick,[e,r,this],this));const E=!V1(r,s);return(E||t)&&(this._active=r,this._updateHoverStyles(r,s,t)),this._lastEvent=w,E}_getActiveElements(e,t,n,s){if(e.type==="mouseout")return[];if(!n)return t;const c=this.options.hover;return this.getElementsAtEventForMode(e,c.mode,c,s)}}ce(vh,"defaults",ds),ce(vh,"instances",qx),ce(vh,"overrides",Cf),ce(vh,"registry",Ac),ce(vh,"version",Jhe),ce(vh,"getChart",QB);function eO(){return wr(vh.instances,i=>i._plugins.invalidate())}function gN(i,e,t=e){i.lineCap=Jn(t.borderCapStyle,e.borderCapStyle),i.setLineDash(Jn(t.borderDash,e.borderDash)),i.lineDashOffset=Jn(t.borderDashOffset,e.borderDashOffset),i.lineJoin=Jn(t.borderJoinStyle,e.borderJoinStyle),i.lineWidth=Jn(t.borderWidth,e.borderWidth),i.strokeStyle=Jn(t.borderColor,e.borderColor)}function nue(i,e,t){i.lineTo(t.x,t.y)}function rue(i){return i.stepped?Ule:i.tension||i.cubicInterpolationMode==="monotone"?Vle:nue}function _N(i,e,t={}){const n=i.length,{start:s=0,end:c=n-1}=t,{start:f,end:r}=e,b=Math.max(s,f),w=Math.min(c,r),E=s<f&&c<f||s>r&&c>r;return{count:n,start:b,loop:e.loop,ilen:w<b&&!E?n+w-b:w-b}}function sue(i,e,t,n){const{points:s,options:c}=e,{count:f,start:r,loop:b,ilen:w}=_N(s,t,n),E=rue(c);let{move:k=!0,reverse:F}=n||{},$,X,W;for($=0;$<=w;++$)X=s[(r+(F?w-$:$))%f],!X.skip&&(k?(i.moveTo(X.x,X.y),k=!1):E(i,W,X,F,c.stepped),W=X);return b&&(X=s[(r+(F?w:0))%f],E(i,W,X,F,c.stepped)),!!b}function oue(i,e,t,n){const s=e.points,{count:c,start:f,ilen:r}=_N(s,t,n),{move:b=!0,reverse:w}=n||{};let E=0,k=0,F,$,X,W,ne,_e;const Te=Ee=>(f+(w?r-Ee:Ee))%c,we=()=>{W!==ne&&(i.lineTo(E,ne),i.lineTo(E,W),i.lineTo(E,_e))};for(b&&($=s[Te(0)],i.moveTo($.x,$.y)),F=0;F<=r;++F){if($=s[Te(F)],$.skip)continue;const Ee=$.x,Le=$.y,Je=Ee|0;Je===X?(Le<W?W=Le:Le>ne&&(ne=Le),E=(k*E+Ee)/++k):(we(),i.lineTo(Ee,Le),X=Je,k=0,W=ne=Le),_e=Le}we()}function wE(i){const e=i.options,t=e.borderDash&&e.borderDash.length;return!i._decimated&&!i._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?oue:sue}function aue(i){return i.stepped?vce:i.tension||i.cubicInterpolationMode==="monotone"?xce:Qd}function lue(i,e,t,n){let s=e._path;s||(s=e._path=new Path2D,e.path(s,t,n)&&s.closePath()),gN(i,e.options),i.stroke(s)}function cue(i,e,t,n){const{segments:s,options:c}=e,f=wE(e);for(const r of s)gN(i,c,r.style),i.beginPath(),f(i,e,r,{start:t,end:t+n-1})&&i.closePath(),i.stroke()}const hue=typeof Path2D=="function";function uue(i,e,t,n){hue&&!e.options.segment?lue(i,e,t,n):cue(i,e,t,n)}class _y extends eg{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const n=this.options;if((n.tension||n.cubicInterpolationMode==="monotone")&&!n.stepped&&!this._pointsUpdated){const s=n.spanGaps?this._loop:this._fullLoop;dce(this._points,n,e,s,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Mce(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,n=e.length;return n&&t[e[n-1].end]}interpolate(e,t){const n=this.options,s=e[t],c=this.points,f=Ece(this,{property:t,start:s,end:s});if(!f.length)return;const r=[],b=aue(n);let w,E;for(w=0,E=f.length;w<E;++w){const{start:k,end:F}=f[w],$=c[k],X=c[F];if($===X){r.push($);continue}const W=Math.abs((s-$[t])/(X[t]-$[t])),ne=b($,X,W,n.stepped);ne[t]=e[t],r.push(ne)}return r.length===1?r[0]:r}pathSegment(e,t,n){return wE(this)(e,this,t,n)}path(e,t,n){const s=this.segments,c=wE(this);let f=this._loop;t=t||0,n=n||this.points.length-t;for(const r of s)f&=c(e,this,r,{start:t,end:t+n-1});return!!f}draw(e,t,n,s){const c=this.options||{};(this.points||[]).length&&c.borderWidth&&(e.save(),uue(e,this,n,s),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}ce(_y,"id","line"),ce(_y,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),ce(_y,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),ce(_y,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function tO(i,e,t,n){const s=i.options,{[t]:c}=i.getProps([t],n);return Math.abs(e-c)<s.radius+s.hitRadius}class Yx extends eg{constructor(t){super();ce(this,"parsed");ce(this,"skip");ce(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,n,s){const c=this.options,{x:f,y:r}=this.getProps(["x","y"],s);return Math.pow(t-f,2)+Math.pow(n-r,2)<Math.pow(c.hitRadius+c.radius,2)}inXRange(t,n){return tO(this,t,"x",n)}inYRange(t,n){return tO(this,t,"y",n)}getCenterPoint(t){const{x:n,y:s}=this.getProps(["x","y"],t);return{x:n,y:s}}size(t){t=t||this.options||{};let n=t.radius||0;n=Math.max(n,n&&t.hoverRadius||0);const s=n&&t.borderWidth||0;return(n+s)*2}draw(t,n){const s=this.options;this.skip||s.radius<.1||!d0(this,n,this.size(s)/2)||(t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.fillStyle=s.backgroundColor,yE(t,s,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}ce(Yx,"id","point"),ce(Yx,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),ce(Yx,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const iO=(i,e)=>{let{boxHeight:t=e,boxWidth:n=e}=i;return i.usePointStyle&&(t=Math.min(t,e),n=i.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:t,itemHeight:Math.max(e,t)}},due=(i,e)=>i!==null&&e!==null&&i.datasetIndex===e.datasetIndex&&i.index===e.index;class nO extends eg{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=zr(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(n=>e.filter(n,this.chart.data))),e.sort&&(t=t.sort((n,s)=>e.sort(n,s,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const n=e.labels,s=na(n.font),c=s.size,f=this._computeTitleHeight(),{boxWidth:r,itemHeight:b}=iO(n,c);let w,E;t.font=s.string,this.isHorizontal()?(w=this.maxWidth,E=this._fitRows(f,c,r,b)+10):(E=this.maxHeight,w=this._fitCols(f,s,r,b)+10),this.width=Math.min(w,e.maxWidth||this.maxWidth),this.height=Math.min(E,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,s){const{ctx:c,maxWidth:f,options:{labels:{padding:r}}}=this,b=this.legendHitBoxes=[],w=this.lineWidths=[0],E=s+r;let k=e;c.textAlign="left",c.textBaseline="middle";let F=-1,$=-E;return this.legendItems.forEach((X,W)=>{const ne=n+t/2+c.measureText(X.text).width;(W===0||w[w.length-1]+ne+2*r>f)&&(k+=E,w[w.length-(W>0?0:1)]=0,$+=E,F++),b[W]={left:0,top:$,row:F,width:ne,height:s},w[w.length-1]+=ne+r}),k}_fitCols(e,t,n,s){const{ctx:c,maxHeight:f,options:{labels:{padding:r}}}=this,b=this.legendHitBoxes=[],w=this.columnSizes=[],E=f-e;let k=r,F=0,$=0,X=0,W=0;return this.legendItems.forEach((ne,_e)=>{const{itemWidth:Te,itemHeight:we}=fue(n,t,c,ne,s);_e>0&&$+we+2*r>E&&(k+=F+r,w.push({width:F,height:$}),X+=F+r,W++,F=$=0),b[_e]={left:X,top:$,col:W,width:Te,height:we},F=Math.max(F,Te),$+=we+r}),k+=F,w.push({width:F,height:$}),k}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:s},rtl:c}}=this,f=Im(c,this.left,this.width);if(this.isHorizontal()){let r=0,b=Ra(n,this.left+s,this.right-this.lineWidths[r]);for(const w of t)r!==w.row&&(r=w.row,b=Ra(n,this.left+s,this.right-this.lineWidths[r])),w.top+=this.top+e+s,w.left=f.leftForLtr(f.x(b),w.width),b+=w.width+s}else{let r=0,b=Ra(n,this.top+e+s,this.bottom-this.columnSizes[r].height);for(const w of t)w.col!==r&&(r=w.col,b=Ra(n,this.top+e+s,this.bottom-this.columnSizes[r].height)),w.top=b,w.left+=this.left+s,w.left=f.leftForLtr(f.x(w.left),w.width),b+=w.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;YC(e,this),this._draw(),ZC(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:n,ctx:s}=this,{align:c,labels:f}=e,r=ds.color,b=Im(e.rtl,this.left,this.width),w=na(f.font),{padding:E}=f,k=w.size,F=k/2;let $;this.drawTitle(),s.textAlign=b.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=w.string;const{boxWidth:X,boxHeight:W,itemHeight:ne}=iO(f,k),_e=function(Je,Tt,_t){if(isNaN(X)||X<=0||isNaN(W)||W<0)return;s.save();const St=Jn(_t.lineWidth,1);if(s.fillStyle=Jn(_t.fillStyle,r),s.lineCap=Jn(_t.lineCap,"butt"),s.lineDashOffset=Jn(_t.lineDashOffset,0),s.lineJoin=Jn(_t.lineJoin,"miter"),s.lineWidth=St,s.strokeStyle=Jn(_t.strokeStyle,r),s.setLineDash(Jn(_t.lineDash,[])),f.usePointStyle){const kt={radius:W*Math.SQRT2/2,pointStyle:_t.pointStyle,rotation:_t.rotation,borderWidth:St},Lt=b.xPlus(Je,X/2),si=Tt+F;Y4(s,kt,Lt,si,f.pointStyleWidth&&X)}else{const kt=Tt+Math.max((k-W)/2,0),Lt=b.leftForLtr(Je,X),si=jy(_t.borderRadius);s.beginPath(),Object.values(si).some(bi=>bi!==0)?bE(s,{x:Lt,y:kt,w:X,h:W,radius:si}):s.rect(Lt,kt,X,W),s.fill(),St!==0&&s.stroke()}s.restore()},Te=function(Je,Tt,_t){G1(s,_t.text,Je,Tt+ne/2,w,{strikethrough:_t.hidden,textAlign:b.textAlign(_t.textAlign)})},we=this.isHorizontal(),Ee=this._computeTitleHeight();we?$={x:Ra(c,this.left+E,this.right-n[0]),y:this.top+E+Ee,line:0}:$={x:this.left+E,y:Ra(c,this.top+Ee+E,this.bottom-t[0].height),line:0},iN(this.ctx,e.textDirection);const Le=ne+E;this.legendItems.forEach((Je,Tt)=>{s.strokeStyle=Je.fontColor,s.fillStyle=Je.fontColor;const _t=s.measureText(Je.text).width,St=b.textAlign(Je.textAlign||(Je.textAlign=f.textAlign)),kt=X+F+_t;let Lt=$.x,si=$.y;b.setWidth(this.width),we?Tt>0&&Lt+kt+E>this.right&&(si=$.y+=Le,$.line++,Lt=$.x=Ra(c,this.left+E,this.right-n[$.line])):Tt>0&&si+Le>this.bottom&&(Lt=$.x=Lt+t[$.line].width+E,$.line++,si=$.y=Ra(c,this.top+Ee+E,this.bottom-t[$.line].height));const bi=b.x(Lt);if(_e(bi,si,Je),Lt=Cle(St,Lt+X+F,we?Lt+kt:this.right,e.rtl),Te(b.x(Lt),si,Je),we)$.x+=kt+E;else if(typeof Je.text!="string"){const ii=w.lineHeight;$.y+=yN(Je,ii)+E}else $.y+=Le}),nN(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,n=na(t.font),s=Vl(t.padding);if(!t.display)return;const c=Im(e.rtl,this.left,this.width),f=this.ctx,r=t.position,b=n.size/2,w=s.top+b;let E,k=this.left,F=this.width;if(this.isHorizontal())F=Math.max(...this.lineWidths),E=this.top+w,k=Ra(e.align,k,this.right-F);else{const X=this.columnSizes.reduce((W,ne)=>Math.max(W,ne.height),0);E=w+Ra(e.align,this.top,this.bottom-X-e.labels.padding-this._computeTitleHeight())}const $=Ra(r,k,k+F);f.textAlign=c.textAlign(G4(r)),f.textBaseline="middle",f.strokeStyle=t.color,f.fillStyle=t.color,f.font=n.string,G1(f,t.text,$,E,n)}_computeTitleHeight(){const e=this.options.title,t=na(e.font),n=Vl(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,s,c;if(my(e,this.left,this.right)&&my(t,this.top,this.bottom)){for(c=this.legendHitBoxes,n=0;n<c.length;++n)if(s=c[n],my(e,s.left,s.left+s.width)&&my(t,s.top,s.top+s.height))return this.legendItems[n]}return null}handleEvent(e){const t=this.options;if(!gue(e.type,t))return;const n=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const s=this._hoveredItem,c=due(s,n);s&&!c&&zr(t.onLeave,[e,s,this],this),this._hoveredItem=n,n&&!c&&zr(t.onHover,[e,n,this],this)}else n&&zr(t.onClick,[e,n,this],this)}}function fue(i,e,t,n,s){const c=pue(n,i,e,t),f=mue(s,n,e.lineHeight);return{itemWidth:c,itemHeight:f}}function pue(i,e,t,n){let s=i.text;return s&&typeof s!="string"&&(s=s.reduce((c,f)=>c.length>f.length?c:f)),e+t.size/2+n.measureText(s).width}function mue(i,e,t){let n=i;return typeof e.text!="string"&&(n=yN(e,t)),n}function yN(i,e){const t=i.text?i.text.length:0;return e*t}function gue(i,e){return!!((i==="mousemove"||i==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(i==="click"||i==="mouseup"))}var _ue={id:"legend",_element:nO,start(i,e,t){const n=i.legend=new nO({ctx:i.ctx,options:t,chart:i});Du.configure(i,n,t),Du.addBox(i,n)},stop(i){Du.removeBox(i,i.legend),delete i.legend},beforeUpdate(i,e,t){const n=i.legend;Du.configure(i,n,t),n.options=t},afterUpdate(i){const e=i.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(i,e){e.replay||i.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(i,e,t){const n=e.datasetIndex,s=t.chart;s.isDatasetVisible(n)?(s.hide(n),e.hidden=!0):(s.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:i=>i.chart.options.color,boxWidth:40,padding:10,generateLabels(i){const e=i.data.datasets,{labels:{usePointStyle:t,pointStyle:n,textAlign:s,color:c,useBorderRadius:f,borderRadius:r}}=i.legend.options;return i._getSortedDatasetMetas().map(b=>{const w=b.controller.getStyle(t?0:void 0),E=Vl(w.borderWidth);return{text:e[b.index].label,fillStyle:w.backgroundColor,fontColor:c,hidden:!b.visible,lineCap:w.borderCapStyle,lineDash:w.borderDash,lineDashOffset:w.borderDashOffset,lineJoin:w.borderJoinStyle,lineWidth:(E.width+E.height)/4,strokeStyle:w.borderColor,pointStyle:n||w.pointStyle,rotation:w.rotation,textAlign:s||w.textAlign,borderRadius:f&&(r||w.borderRadius),datasetIndex:b.index}},this)}},title:{color:i=>i.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:i=>!i.startsWith("on"),labels:{_scriptable:i=>!["generateLabels","filter","sort"].includes(i)}}};const yy={average(i){if(!i.length)return!1;let e,t,n=new Set,s=0,c=0;for(e=0,t=i.length;e<t;++e){const r=i[e].element;if(r&&r.hasValue()){const b=r.tooltipPosition();n.add(b.x),s+=b.y,++c}}return c===0||n.size===0?!1:{x:[...n].reduce((r,b)=>r+b)/n.size,y:s/c}},nearest(i,e){if(!i.length)return!1;let t=e.x,n=e.y,s=Number.POSITIVE_INFINITY,c,f,r;for(c=0,f=i.length;c<f;++c){const b=i[c].element;if(b&&b.hasValue()){const w=b.getCenterPoint(),E=gE(e,w);E<s&&(s=E,r=b)}}if(r){const b=r.tooltipPosition();t=b.x,n=b.y}return{x:t,y:n}}};function wc(i,e){return e&&(oo(e)?Array.prototype.push.apply(i,e):i.push(e)),i}function gh(i){return(typeof i=="string"||i instanceof String)&&i.indexOf(`
`)>-1?i.split(`
`):i}function yue(i,e){const{element:t,datasetIndex:n,index:s}=e,c=i.getDatasetMeta(n).controller,{label:f,value:r}=c.getLabelAndValue(s);return{chart:i,label:f,parsed:c.getParsed(s),raw:i.data.datasets[n].data[s],formattedValue:r,dataset:c.getDataset(),dataIndex:s,datasetIndex:n,element:t}}function rO(i,e){const t=i.chart.ctx,{body:n,footer:s,title:c}=i,{boxWidth:f,boxHeight:r}=e,b=na(e.bodyFont),w=na(e.titleFont),E=na(e.footerFont),k=c.length,F=s.length,$=n.length,X=Vl(e.padding);let W=X.height,ne=0,_e=n.reduce((Ee,Le)=>Ee+Le.before.length+Le.lines.length+Le.after.length,0);if(_e+=i.beforeBody.length+i.afterBody.length,k&&(W+=k*w.lineHeight+(k-1)*e.titleSpacing+e.titleMarginBottom),_e){const Ee=e.displayColors?Math.max(r,b.lineHeight):b.lineHeight;W+=$*Ee+(_e-$)*b.lineHeight+(_e-1)*e.bodySpacing}F&&(W+=e.footerMarginTop+F*E.lineHeight+(F-1)*e.footerSpacing);let Te=0;const we=function(Ee){ne=Math.max(ne,t.measureText(Ee).width+Te)};return t.save(),t.font=w.string,wr(i.title,we),t.font=b.string,wr(i.beforeBody.concat(i.afterBody),we),Te=e.displayColors?f+2+e.boxPadding:0,wr(n,Ee=>{wr(Ee.before,we),wr(Ee.lines,we),wr(Ee.after,we)}),Te=0,t.font=E.string,wr(i.footer,we),t.restore(),ne+=X.width,{width:ne,height:W}}function bue(i,e){const{y:t,height:n}=e;return t<n/2?"top":t>i.height-n/2?"bottom":"center"}function vue(i,e,t,n){const{x:s,width:c}=n,f=t.caretSize+t.caretPadding;if(i==="left"&&s+c+f>e.width||i==="right"&&s-c-f<0)return!0}function xue(i,e,t,n){const{x:s,width:c}=t,{width:f,chartArea:{left:r,right:b}}=i;let w="center";return n==="center"?w=s<=(r+b)/2?"left":"right":s<=c/2?w="left":s>=f-c/2&&(w="right"),vue(w,i,e,t)&&(w="center"),w}function sO(i,e,t){const n=t.yAlign||e.yAlign||bue(i,t);return{xAlign:t.xAlign||e.xAlign||xue(i,e,t,n),yAlign:n}}function wue(i,e){let{x:t,width:n}=i;return e==="right"?t-=n:e==="center"&&(t-=n/2),t}function Aue(i,e,t){let{y:n,height:s}=i;return e==="top"?n+=t:e==="bottom"?n-=s+t:n-=s/2,n}function oO(i,e,t,n){const{caretSize:s,caretPadding:c,cornerRadius:f}=i,{xAlign:r,yAlign:b}=t,w=s+c,{topLeft:E,topRight:k,bottomLeft:F,bottomRight:$}=jy(f);let X=wue(e,r);const W=Aue(e,b,w);return b==="center"?r==="left"?X+=w:r==="right"&&(X-=w):r==="left"?X-=Math.max(E,F)+s:r==="right"&&(X+=Math.max(k,$)+s),{x:ol(X,0,n.width-e.width),y:ol(W,0,n.height-e.height)}}function Sx(i,e,t){const n=Vl(t.padding);return e==="center"?i.x+i.width/2:e==="right"?i.x+i.width-n.right:i.x+n.left}function aO(i){return wc([],gh(i))}function Tue(i,e,t){return Ff(i,{tooltip:e,tooltipItems:t,type:"tooltip"})}function lO(i,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?i.override(t):i}const bN={beforeTitle:ph,title(i){if(i.length>0){const e=i[0],t=e.chart.data.labels,n=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return t[e.dataIndex]}return""},afterTitle:ph,beforeBody:ph,beforeLabel:ph,label(i){if(this&&this.options&&this.options.mode==="dataset")return i.label+": "+i.formattedValue||i.formattedValue;let e=i.dataset.label||"";e&&(e+=": ");const t=i.formattedValue;return Fr(t)||(e+=t),e},labelColor(i){const t=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(i){const t=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:ph,afterBody:ph,beforeFooter:ph,footer:ph,afterFooter:ph};function Jo(i,e,t,n){const s=i[e].call(t,n);return typeof s>"u"?bN[e].call(t,n):s}class AE extends eg{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,n=this.options.setContext(this.getContext()),s=n.enabled&&t.options.animation&&n.animations,c=new sN(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(c)),c}getContext(){return this.$context||(this.$context=Tue(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:n}=t,s=Jo(n,"beforeTitle",this,e),c=Jo(n,"title",this,e),f=Jo(n,"afterTitle",this,e);let r=[];return r=wc(r,gh(s)),r=wc(r,gh(c)),r=wc(r,gh(f)),r}getBeforeBody(e,t){return aO(Jo(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:n}=t,s=[];return wr(e,c=>{const f={before:[],lines:[],after:[]},r=lO(n,c);wc(f.before,gh(Jo(r,"beforeLabel",this,c))),wc(f.lines,Jo(r,"label",this,c)),wc(f.after,gh(Jo(r,"afterLabel",this,c))),s.push(f)}),s}getAfterBody(e,t){return aO(Jo(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:n}=t,s=Jo(n,"beforeFooter",this,e),c=Jo(n,"footer",this,e),f=Jo(n,"afterFooter",this,e);let r=[];return r=wc(r,gh(s)),r=wc(r,gh(c)),r=wc(r,gh(f)),r}_createItems(e){const t=this._active,n=this.chart.data,s=[],c=[],f=[];let r=[],b,w;for(b=0,w=t.length;b<w;++b)r.push(yue(this.chart,t[b]));return e.filter&&(r=r.filter((E,k,F)=>e.filter(E,k,F,n))),e.itemSort&&(r=r.sort((E,k)=>e.itemSort(E,k,n))),wr(r,E=>{const k=lO(e.callbacks,E);s.push(Jo(k,"labelColor",this,E)),c.push(Jo(k,"labelPointStyle",this,E)),f.push(Jo(k,"labelTextColor",this,E))}),this.labelColors=s,this.labelPointStyles=c,this.labelTextColors=f,this.dataPoints=r,r}update(e,t){const n=this.options.setContext(this.getContext()),s=this._active;let c,f=[];if(!s.length)this.opacity!==0&&(c={opacity:0});else{const r=yy[n.position].call(this,s,this._eventPosition);f=this._createItems(n),this.title=this.getTitle(f,n),this.beforeBody=this.getBeforeBody(f,n),this.body=this.getBody(f,n),this.afterBody=this.getAfterBody(f,n),this.footer=this.getFooter(f,n);const b=this._size=rO(this,n),w=Object.assign({},r,b),E=sO(this.chart,n,w),k=oO(n,w,E,this.chart);this.xAlign=E.xAlign,this.yAlign=E.yAlign,c={opacity:1,x:k.x,y:k.y,width:b.width,height:b.height,caretX:r.x,caretY:r.y}}this._tooltipItems=f,this.$context=void 0,c&&this._resolveAnimations().update(this,c),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,n,s){const c=this.getCaretPosition(e,n,s);t.lineTo(c.x1,c.y1),t.lineTo(c.x2,c.y2),t.lineTo(c.x3,c.y3)}getCaretPosition(e,t,n){const{xAlign:s,yAlign:c}=this,{caretSize:f,cornerRadius:r}=n,{topLeft:b,topRight:w,bottomLeft:E,bottomRight:k}=jy(r),{x:F,y:$}=e,{width:X,height:W}=t;let ne,_e,Te,we,Ee,Le;return c==="center"?(Ee=$+W/2,s==="left"?(ne=F,_e=ne-f,we=Ee+f,Le=Ee-f):(ne=F+X,_e=ne+f,we=Ee-f,Le=Ee+f),Te=ne):(s==="left"?_e=F+Math.max(b,E)+f:s==="right"?_e=F+X-Math.max(w,k)-f:_e=this.caretX,c==="top"?(we=$,Ee=we-f,ne=_e-f,Te=_e+f):(we=$+W,Ee=we+f,ne=_e+f,Te=_e-f),Le=we),{x1:ne,x2:_e,x3:Te,y1:we,y2:Ee,y3:Le}}drawTitle(e,t,n){const s=this.title,c=s.length;let f,r,b;if(c){const w=Im(n.rtl,this.x,this.width);for(e.x=Sx(this,n.titleAlign,n),t.textAlign=w.textAlign(n.titleAlign),t.textBaseline="middle",f=na(n.titleFont),r=n.titleSpacing,t.fillStyle=n.titleColor,t.font=f.string,b=0;b<c;++b)t.fillText(s[b],w.x(e.x),e.y+f.lineHeight/2),e.y+=f.lineHeight+r,b+1===c&&(e.y+=n.titleMarginBottom-r)}}_drawColorBox(e,t,n,s,c){const f=this.labelColors[n],r=this.labelPointStyles[n],{boxHeight:b,boxWidth:w}=c,E=na(c.bodyFont),k=Sx(this,"left",c),F=s.x(k),$=b<E.lineHeight?(E.lineHeight-b)/2:0,X=t.y+$;if(c.usePointStyle){const W={radius:Math.min(w,b)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},ne=s.leftForLtr(F,w)+w/2,_e=X+b/2;e.strokeStyle=c.multiKeyBackground,e.fillStyle=c.multiKeyBackground,yE(e,W,ne,_e),e.strokeStyle=f.borderColor,e.fillStyle=f.backgroundColor,yE(e,W,ne,_e)}else{e.lineWidth=fr(f.borderWidth)?Math.max(...Object.values(f.borderWidth)):f.borderWidth||1,e.strokeStyle=f.borderColor,e.setLineDash(f.borderDash||[]),e.lineDashOffset=f.borderDashOffset||0;const W=s.leftForLtr(F,w),ne=s.leftForLtr(s.xPlus(F,1),w-2),_e=jy(f.borderRadius);Object.values(_e).some(Te=>Te!==0)?(e.beginPath(),e.fillStyle=c.multiKeyBackground,bE(e,{x:W,y:X,w,h:b,radius:_e}),e.fill(),e.stroke(),e.fillStyle=f.backgroundColor,e.beginPath(),bE(e,{x:ne,y:X+1,w:w-2,h:b-2,radius:_e}),e.fill()):(e.fillStyle=c.multiKeyBackground,e.fillRect(W,X,w,b),e.strokeRect(W,X,w,b),e.fillStyle=f.backgroundColor,e.fillRect(ne,X+1,w-2,b-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,t,n){const{body:s}=this,{bodySpacing:c,bodyAlign:f,displayColors:r,boxHeight:b,boxWidth:w,boxPadding:E}=n,k=na(n.bodyFont);let F=k.lineHeight,$=0;const X=Im(n.rtl,this.x,this.width),W=function(_t){t.fillText(_t,X.x(e.x+$),e.y+F/2),e.y+=F+c},ne=X.textAlign(f);let _e,Te,we,Ee,Le,Je,Tt;for(t.textAlign=f,t.textBaseline="middle",t.font=k.string,e.x=Sx(this,ne,n),t.fillStyle=n.bodyColor,wr(this.beforeBody,W),$=r&&ne!=="right"?f==="center"?w/2+E:w+2+E:0,Ee=0,Je=s.length;Ee<Je;++Ee){for(_e=s[Ee],Te=this.labelTextColors[Ee],t.fillStyle=Te,wr(_e.before,W),we=_e.lines,r&&we.length&&(this._drawColorBox(t,e,Ee,X,n),F=Math.max(k.lineHeight,b)),Le=0,Tt=we.length;Le<Tt;++Le)W(we[Le]),F=k.lineHeight;wr(_e.after,W)}$=0,F=k.lineHeight,wr(this.afterBody,W),e.y-=c}drawFooter(e,t,n){const s=this.footer,c=s.length;let f,r;if(c){const b=Im(n.rtl,this.x,this.width);for(e.x=Sx(this,n.footerAlign,n),e.y+=n.footerMarginTop,t.textAlign=b.textAlign(n.footerAlign),t.textBaseline="middle",f=na(n.footerFont),t.fillStyle=n.footerColor,t.font=f.string,r=0;r<c;++r)t.fillText(s[r],b.x(e.x),e.y+f.lineHeight/2),e.y+=f.lineHeight+n.footerSpacing}}drawBackground(e,t,n,s){const{xAlign:c,yAlign:f}=this,{x:r,y:b}=e,{width:w,height:E}=n,{topLeft:k,topRight:F,bottomLeft:$,bottomRight:X}=jy(s.cornerRadius);t.fillStyle=s.backgroundColor,t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.beginPath(),t.moveTo(r+k,b),f==="top"&&this.drawCaret(e,t,n,s),t.lineTo(r+w-F,b),t.quadraticCurveTo(r+w,b,r+w,b+F),f==="center"&&c==="right"&&this.drawCaret(e,t,n,s),t.lineTo(r+w,b+E-X),t.quadraticCurveTo(r+w,b+E,r+w-X,b+E),f==="bottom"&&this.drawCaret(e,t,n,s),t.lineTo(r+$,b+E),t.quadraticCurveTo(r,b+E,r,b+E-$),f==="center"&&c==="left"&&this.drawCaret(e,t,n,s),t.lineTo(r,b+k),t.quadraticCurveTo(r,b,r+k,b),t.closePath(),t.fill(),s.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,n=this.$animations,s=n&&n.x,c=n&&n.y;if(s||c){const f=yy[e.position].call(this,this._active,this._eventPosition);if(!f)return;const r=this._size=rO(this,e),b=Object.assign({},f,this._size),w=sO(t,e,b),E=oO(e,b,w,t);(s._to!==E.x||c._to!==E.y)&&(this.xAlign=w.xAlign,this.yAlign=w.yAlign,this.width=r.width,this.height=r.height,this.caretX=f.x,this.caretY=f.y,this._resolveAnimations().update(this,E))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(t);const s={width:this.width,height:this.height},c={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const f=Vl(t.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&r&&(e.save(),e.globalAlpha=n,this.drawBackground(c,e,s,t),iN(e,t.textDirection),c.y+=f.top,this.drawTitle(c,e,t),this.drawBody(c,e,t),this.drawFooter(c,e,t),nN(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const n=this._active,s=e.map(({datasetIndex:r,index:b})=>{const w=this.chart.getDatasetMeta(r);if(!w)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:w.data[b],index:b}}),c=!V1(n,s),f=this._positionChanged(s,t);(c||f)&&(this._active=s,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,n=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,c=this._active||[],f=this._getActiveElements(e,c,t,n),r=this._positionChanged(f,e),b=t||!V1(f,c)||r;return b&&(this._active=f,(s.enabled||s.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),b}_getActiveElements(e,t,n,s){const c=this.options;if(e.type==="mouseout")return[];if(!s)return t.filter(r=>this.chart.data.datasets[r.datasetIndex]&&this.chart.getDatasetMeta(r.datasetIndex).controller.getParsed(r.index)!==void 0);const f=this.chart.getElementsAtEventForMode(e,c.mode,c,n);return c.reverse&&f.reverse(),f}_positionChanged(e,t){const{caretX:n,caretY:s,options:c}=this,f=yy[c.position].call(this,e,t);return f!==!1&&(n!==f.x||s!==f.y)}}ce(AE,"positioners",yy);var Sue={id:"tooltip",_element:AE,positioners:yy,afterInit(i,e,t){t&&(i.tooltip=new AE({chart:i,options:t}))},beforeUpdate(i,e,t){i.tooltip&&i.tooltip.initialize(t)},reset(i,e,t){i.tooltip&&i.tooltip.initialize(t)},afterDraw(i){const e=i.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(i.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(i.ctx),i.notifyPlugins("afterTooltipDraw",t)}},afterEvent(i,e){if(i.tooltip){const t=e.replay;i.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(i,e)=>e.bodyFont.size,boxWidth:(i,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:bN},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:i=>i!=="filter"&&i!=="itemSort"&&i!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const Eue=(i,e,t,n)=>(typeof e=="string"?(t=i.push(e)-1,n.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function Cue(i,e,t,n){const s=i.indexOf(e);if(s===-1)return Eue(i,e,t,n);const c=i.lastIndexOf(e);return s!==c?t:s}const Iue=(i,e)=>i===null?null:ol(Math.round(i),0,e);function cO(i){const e=this.getLabels();return i>=0&&i<e.length?e[i]:i}class TE extends tg{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const n=this.getLabels();for(const{index:s,label:c}of t)n[s]===c&&n.splice(s,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(Fr(e))return null;const n=this.getLabels();return t=isFinite(t)&&n[t]===e?t:Cue(n,e,Jn(t,e),this._addedLabels),Iue(t,n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:n,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(n=0),t||(s=this.getLabels().length-1)),this.min=n,this.max=s}buildTicks(){const e=this.min,t=this.max,n=this.options.offset,s=[];let c=this.getLabels();c=e===0&&t===c.length-1?c:c.slice(e,t+1),this._valueRange=Math.max(c.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let f=e;f<=t;f++)s.push({value:f});return s}getLabelForValue(e){return cO.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}ce(TE,"id","category"),ce(TE,"defaults",{ticks:{callback:cO}});function Mue(i,e){const t=[],{bounds:s,step:c,min:f,max:r,precision:b,count:w,maxTicks:E,maxDigits:k,includeBounds:F}=i,$=c||1,X=E-1,{min:W,max:ne}=e,_e=!Fr(f),Te=!Fr(r),we=!Fr(w),Ee=(ne-W)/(k+1);let Le=pB((ne-W)/X/$)*$,Je,Tt,_t,St;if(Le<1e-14&&!_e&&!Te)return[{value:W},{value:ne}];St=Math.ceil(ne/Le)-Math.floor(W/Le),St>X&&(Le=pB(St*Le/X/$)*$),Fr(b)||(Je=Math.pow(10,b),Le=Math.ceil(Le*Je)/Je),s==="ticks"?(Tt=Math.floor(W/Le)*Le,_t=Math.ceil(ne/Le)*Le):(Tt=W,_t=ne),_e&&Te&&c&&gle((r-f)/c,Le/1e3)?(St=Math.round(Math.min((r-f)/Le,E)),Le=(r-f)/St,Tt=f,_t=r):we?(Tt=_e?f:Tt,_t=Te?r:_t,St=w-1,Le=(_t-Tt)/St):(St=(_t-Tt)/Le,Uy(St,Math.round(St),Le/1e3)?St=Math.round(St):St=Math.ceil(St));const kt=Math.max(mB(Le),mB(Tt));Je=Math.pow(10,Fr(b)?kt:b),Tt=Math.round(Tt*Je)/Je,_t=Math.round(_t*Je)/Je;let Lt=0;for(_e&&(F&&Tt!==f?(t.push({value:f}),Tt<f&&Lt++,Uy(Math.round((Tt+Lt*Le)*Je)/Je,f,hO(f,Ee,i))&&Lt++):Tt<f&&Lt++);Lt<St;++Lt){const si=Math.round((Tt+Lt*Le)*Je)/Je;if(Te&&si>r)break;t.push({value:si})}return Te&&F&&_t!==r?t.length&&Uy(t[t.length-1].value,r,hO(r,Ee,i))?t[t.length-1].value=r:t.push({value:r}):(!Te||_t===r)&&t.push({value:_t}),t}function hO(i,e,{horizontal:t,minRotation:n}){const s=cf(n),c=(t?Math.sin(s):Math.cos(s))||.001,f=.75*e*(""+i).length;return Math.min(e/c,f)}class Rue extends tg{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Fr(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:s,max:c}=this;const f=b=>s=t?s:b,r=b=>c=n?c:b;if(e){const b=Vm(s),w=Vm(c);b<0&&w<0?r(0):b>0&&w>0&&f(0)}if(s===c){let b=c===0?1:Math.abs(c*.05);r(c+b),e||f(s-b)}this.min=s,this.max=c}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:n}=e,s;return n?(s=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),t=t||11),t&&(s=Math.min(t,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const s={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},c=this._range||this,f=Mue(s,c);return e.bounds==="ticks"&&_le(f,this,"value"),e.reverse?(f.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),f}configure(){const e=this.ticks;let t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const s=(n-t)/Math.max(e.length-1,1)/2;t-=s,n+=s}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return X4(e,this.chart.options.locale,this.options.ticks.format)}}class SE extends Rue{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=ul(e)?e:0,this.max=ul(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,n=cf(this.options.ticks.minRotation),s=(e?Math.sin(n):Math.cos(n))||.001,c=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,c.lineHeight/s))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}ce(SE,"id","linear"),ce(SE,"defaults",{ticks:{callback:q4.formatters.numeric}});const Pw={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ia=Object.keys(Pw);function uO(i,e){return i-e}function dO(i,e){if(Fr(e))return null;const t=i._adapter,{parser:n,round:s,isoWeekday:c}=i._parseOpts;let f=e;return typeof n=="function"&&(f=n(f)),ul(f)||(f=typeof n=="string"?t.parse(f,n):t.parse(f)),f===null?null:(s&&(f=s==="week"&&(u0(c)||c===!0)?t.startOf(f,"isoWeek",c):t.startOf(f,s)),+f)}function fO(i,e,t,n){const s=ia.length;for(let c=ia.indexOf(i);c<s-1;++c){const f=Pw[ia[c]],r=f.steps?f.steps:Number.MAX_SAFE_INTEGER;if(f.common&&Math.ceil((t-e)/(r*f.size))<=n)return ia[c]}return ia[s-1]}function kue(i,e,t,n,s){for(let c=ia.length-1;c>=ia.indexOf(t);c--){const f=ia[c];if(Pw[f].common&&i._adapter.diff(s,n,f)>=e-1)return f}return ia[t?ia.indexOf(t):0]}function Pue(i){for(let e=ia.indexOf(i)+1,t=ia.length;e<t;++e)if(Pw[ia[e]].common)return ia[e]}function pO(i,e,t){if(!t)i[e]=!0;else if(t.length){const{lo:n,hi:s}=XC(t,e),c=t[n]>=e?t[n]:t[s];i[c]=!0}}function Due(i,e,t,n){const s=i._adapter,c=+s.startOf(e[0].value,n),f=e[e.length-1].value;let r,b;for(r=c;r<=f;r=+s.add(r,1,n))b=t[r],b>=0&&(e[b].major=!0);return e}function mO(i,e,t){const n=[],s={},c=e.length;let f,r;for(f=0;f<c;++f)r=e[f],s[r]=f,n.push({value:r,major:!1});return c===0||!t?n:Due(i,n,s,t)}class Y1 extends tg{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const n=e.time||(e.time={}),s=this._adapter=new qce._date(e.adapters.date);s.init(t),Ny(n.displayFormats,s.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:dO(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,n=e.time.unit||"day";let{min:s,max:c,minDefined:f,maxDefined:r}=this.getUserBounds();function b(w){!f&&!isNaN(w.min)&&(s=Math.min(s,w.min)),!r&&!isNaN(w.max)&&(c=Math.max(c,w.max))}(!f||!r)&&(b(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&b(this.getMinMax(!1))),s=ul(s)&&!isNaN(s)?s:+t.startOf(Date.now(),n),c=ul(c)&&!isNaN(c)?c:+t.endOf(Date.now(),n)+1,this.min=Math.min(s,c-1),this.max=Math.max(s+1,c)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],n=e[e.length-1]),{min:t,max:n}}buildTicks(){const e=this.options,t=e.time,n=e.ticks,s=n.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const c=this.min,f=this.max,r=Ale(s,c,f);return this._unit=t.unit||(n.autoSkip?fO(t.minUnit,this.min,this.max,this._getLabelCapacity(c)):kue(this,r.length,t.minUnit,this.min,this.max)),this._majorUnit=!n.major.enabled||this._unit==="year"?void 0:Pue(this._unit),this.initOffsets(s),e.reverse&&r.reverse(),mO(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,n=0,s,c;this.options.offset&&e.length&&(s=this.getDecimalForValue(e[0]),e.length===1?t=1-s:t=(this.getDecimalForValue(e[1])-s)/2,c=this.getDecimalForValue(e[e.length-1]),e.length===1?n=c:n=(c-this.getDecimalForValue(e[e.length-2]))/2);const f=e.length<3?.5:.25;t=ol(t,0,f),n=ol(n,0,f),this._offsets={start:t,end:n,factor:1/(t+1+n)}}_generate(){const e=this._adapter,t=this.min,n=this.max,s=this.options,c=s.time,f=c.unit||fO(c.minUnit,t,n,this._getLabelCapacity(t)),r=Jn(s.ticks.stepSize,1),b=f==="week"?c.isoWeekday:!1,w=u0(b)||b===!0,E={};let k=t,F,$;if(w&&(k=+e.startOf(k,"isoWeek",b)),k=+e.startOf(k,w?"day":f),e.diff(n,t,f)>1e5*r)throw new Error(t+" and "+n+" are too far apart with stepSize of "+r+" "+f);const X=s.ticks.source==="data"&&this.getDataTimestamps();for(F=k,$=0;F<n;F=+e.add(F,r,f),$++)pO(E,F,X);return(F===n||s.bounds==="ticks"||$===1)&&pO(E,F,X),Object.keys(E).sort(uO).map(W=>+W)}getLabelForValue(e){const t=this._adapter,n=this.options.time;return n.tooltipFormat?t.format(e,n.tooltipFormat):t.format(e,n.displayFormats.datetime)}format(e,t){const s=this.options.time.displayFormats,c=this._unit,f=t||s[c];return this._adapter.format(e,f)}_tickFormatFunction(e,t,n,s){const c=this.options,f=c.ticks.callback;if(f)return zr(f,[e,t,n],this);const r=c.time.displayFormats,b=this._unit,w=this._majorUnit,E=b&&r[b],k=w&&r[w],F=n[t],$=w&&k&&F&&F.major;return this._adapter.format(e,s||($?k:E))}generateTickLabels(e){let t,n,s;for(t=0,n=e.length;t<n;++t)s=e[t],s.label=this._tickFormatFunction(s.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+n)*t.factor)}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,n=this.ctx.measureText(e).width,s=cf(this.isHorizontal()?t.maxRotation:t.minRotation),c=Math.cos(s),f=Math.sin(s),r=this._resolveTickFontOptions(0).size;return{w:n*c+r*f,h:n*f+r*c}}_getLabelCapacity(e){const t=this.options.time,n=t.displayFormats,s=n[t.unit]||n.millisecond,c=this._tickFormatFunction(e,0,mO(this,[e],this._majorUnit),s),f=this._getLabelSize(c),r=Math.floor(this.isHorizontal()?this.width/f.w:this.height/f.h)-1;return r>0?r:1}getDataTimestamps(){let e=this._cache.data||[],t,n;if(e.length)return e;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(t=0,n=s.length;t<n;++t)e=e.concat(s[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,n;if(e.length)return e;const s=this.getLabels();for(t=0,n=s.length;t<n;++t)e.push(dO(this,s[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return Sle(e.sort(uO))}}ce(Y1,"id","time"),ce(Y1,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Ex(i,e,t){let n=0,s=i.length-1,c,f,r,b;t?(e>=i[n].pos&&e<=i[s].pos&&({lo:n,hi:s}=hf(i,"pos",e)),{pos:c,time:r}=i[n],{pos:f,time:b}=i[s]):(e>=i[n].time&&e<=i[s].time&&({lo:n,hi:s}=hf(i,"time",e)),{time:c,pos:r}=i[n],{time:f,pos:b}=i[s]);const w=f-c;return w?r+(b-r)*(e-c)/w:r}class gO extends Y1{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=Ex(t,this.min),this._tableRange=Ex(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:n}=this,s=[],c=[];let f,r,b,w,E;for(f=0,r=e.length;f<r;++f)w=e[f],w>=t&&w<=n&&s.push(w);if(s.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(f=0,r=s.length;f<r;++f)E=s[f+1],b=s[f-1],w=s[f],Math.round((E+b)/2)!==w&&c.push({time:w,pos:f/(r-1)});return c}_generate(){const e=this.min,t=this.max;let n=super.getDataTimestamps();return(!n.includes(e)||!n.length)&&n.splice(0,0,e),(!n.includes(t)||n.length===1)&&n.push(t),n.sort((s,c)=>s-c)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),n=this.getLabelTimestamps();return t.length&&n.length?e=this.normalize(t.concat(n)):e=t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(Ex(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return Ex(this._table,n*this._tableRange+this._minPos,!0)}}ce(gO,"id","timeseries"),ce(gO,"defaults",Y1.defaults);vh.register(Gx,_y,Yx,SE,TE,Sue,_ue);class Bue{constructor(e){ce(this,"formatTimestamp",e=>new Date(e).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}));this.mapService=e,this.chartDrawer=document.querySelector("#chartDrawer"),this.chartCanvas=this.chartDrawer.querySelector("#chartCanvas"),this.chartEmptyMessage=this.chartDrawer.querySelector("#chartEmptyMessage"),this.chartInstance=null,this.playInterval=null,this.playIndex=0,this.speed=1,!this.chartDrawer||this.chartCanvas,this._setupControls(),this._setupSubscription()}_setupControls(){this.playButton=this.chartDrawer.querySelector("#playButton"),this.stopButton=this.chartDrawer.querySelector("#stopButton"),this.speedButtons=this.chartDrawer.querySelectorAll(".speedButton"),this.pauseButton=this.chartDrawer.querySelector("#pauseButton"),this.pauseButton.addEventListener("click",()=>this._pause()),this.playButton.addEventListener("click",()=>this._play()),this.stopButton.addEventListener("click",()=>this._stop()),this.speedButtons.forEach(e=>e.addEventListener("click",t=>{this.speed=parseInt(t.target.dataset.speed,10)||1}))}_setupSubscription(){FC.vehicleTrack$.pipe(p4(300),d4(e=>e&&e.vehicleId&&e.data),D0(e=>this._prepareChartData(e.data.features)),OC((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{if(!e.length)return;this.fullChartData=e,this.playIndex=0;const t=e[e.length-1],n=t,[s,c]=t.coordinates,f=document.querySelector(`div[slot="summary"] sl-checkbox[data-id="${n.vehicle_id}"]`);if(!f)return;const r=f.closest(".vehicle-card")||f.closest("sl-details");if(!r)return;const b=(w,E)=>{const k=r.querySelector(w);k&&(k.textContent=E??"")};b('[data-field="id"]',n.vehicle_id),b('[data-field="timestamp"]',this.formatTimestamp(n.timestamp)),b('[data-field="lat"]',c==null?void 0:c.toFixed(6)),b('[data-field="lng"]',s==null?void 0:s.toFixed(6))})}_play(){!this.fullChartData||this.fullChartData.length===0||(this.playInterval&&clearInterval(this.playInterval),this.playIndex>=this.fullChartData.length&&(this.playIndex=0),this.playInterval=setInterval(()=>{if(this.playIndex>=this.fullChartData.length){this._stop();return}const e=this.fullChartData[this.playIndex];this._updateCurrentPoint(this.playIndex);const t=this._getMapPointByTimestamp(e.timestamp);t&&this.mapService._updateModel(t),this._updateVehicleCard(e,e.coordinates),this.playIndex+=this.speed},300))}_pause(){this.playInterval&&(clearInterval(this.playInterval),this.playInterval=null)}_stop(){this.playInterval&&(clearInterval(this.playInterval),this.playInterval=null),this._updateCurrentPoint(null)}_updateVehicleCard(e,t){const[n,s]=t,c=document.querySelector(`div[slot="summary"] sl-checkbox[data-id="${e.vehicle_id}"]`);if(!c)return;const f=c.closest(".vehicle-card")||c.closest("sl-details");if(!f)return;const r=(b,w)=>{const E=f.querySelector(b);E&&(E.textContent=w??"")};r('[data-field="id"]',e.vehicle_id),r('[data-field="timestamp"]',this.formatTimestamp(e.timestamp)),r('[data-field="lat"]',s==null?void 0:s.toFixed(6)),r('[data-field="lng"]',n==null?void 0:n.toFixed(6))}_prepareChartData(e){return e.filter(t=>{var n,s;return((n=t.geometry)==null?void 0:n.type)==="Point"&&((s=t.properties)==null?void 0:s.timestamp)}).map(t=>{var n;return{timestamp:new Date(t.properties.timestamp),speed:t.properties.speed??null,altitude:t.properties.altitude??null,waterfall:t.properties.waterfall??"inactive",coordinates:t.geometry.coordinates,vehicle_id:(n=t.properties)==null?void 0:n.vehicle_id}})}_renderChart(e){this.chartInstance&&this.chartInstance.destroy();const t=this.chartCanvas.parentElement,n=this.chartCanvas.getContext("2d"),s=window.devicePixelRatio||1,c=t.clientWidth,f=180;this.chartCanvas.width=c*s,this.chartCanvas.height=f*s,this.chartCanvas.style.width=`${c}px`,this.chartCanvas.style.height=`${f}px`,n.scale(s,s);const r=e.map(F=>F.timestamp.toLocaleTimeString()),b=e.map(F=>F.altitude),w=e.map(F=>F.speed),E=e.map(F=>F.waterfall==="active"?"green":"red"),k={id:"currentPointPlugin",afterDatasetsDraw(F){const $=F.data.datasets.findIndex(ne=>ne.label===" ");if($===-1)return;const X=F.getDatasetMeta($),W=F.ctx;X.data.forEach((ne,_e)=>{F.data.datasets[$].data[_e]!==null&&(W.save(),W.beginPath(),W.arc(ne.x,ne.y,8,0,2*Math.PI),W.fillStyle="red",W.shadowColor="#fff",W.shadowBlur=8,W.fill(),W.lineWidth=3,W.strokeStyle="#fff",W.stroke(),W.restore())})}};this.chartInstance=new vh(this.chartCanvas,{type:"line",data:{labels:r,datasets:[{label:" ()",data:b,borderColor:"orange",backgroundColor:"rgba(255,165,0,0.2)",fill:!0,tension:.4,order:1},{label:" (/)",data:w,borderColor:"blue",backgroundColor:"rgba(0,0,255,0.2)",fill:!1,tension:.4,order:2},{label:" waterfall",data:b,pointBackgroundColor:E,pointRadius:5,showLine:!1,order:98},{label:" ",data:new Array(e.length).fill(null),pointBackgroundColor:"red",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:1,pointStyle:"circle",showLine:!1,order:99}]},options:{responsive:!0,plugins:{legend:{display:!0}},scales:{x:{title:{display:!0,text:""}},y:{title:{display:!0,text:""}}}},plugins:[k]})}_updateCurrentPoint(e){if(!this.chartInstance)return;const t=this.chartInstance.data.datasets.find(n=>n.label===" ");t&&(t.data=this.fullChartData.map((n,s)=>s===e?n.altitude:null),this.chartInstance.update("none"))}_getMapPointByTimestamp(e){return this.mapService.trackData?this.mapService.trackData.find(t=>new Date(t.timestamp).getTime()===e.getTime()):null}showEmptyMessage(){this.chartEmptyMessage.classList.remove("hidden"),this.chartCanvas.classList.add("hidden")}hideEmptyMessage(){this.chartEmptyMessage.classList.add("hidden"),this.chartCanvas.classList.remove("hidden")}_destroyChart(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)}}xV("default",{resolver:i=>`https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/${i}.svg`,mutator:i=>i.setAttribute("fill","currentColor")});iS("/mapbox-tracking/");const vN=new Cae;vN.initMap();const Oue=new Fae("vehicle-list",FC);Oue.init();LC.inProgress.subscribe(i=>{Fue.style.display=i?"block":"none"});window.addEventListener("load",()=>{const i=document.querySelector(".preloader");i&&(i.style.opacity="0",i.style.pointerEvents="none",i.remove())});const Fue=document.querySelector("sl-progress-bar");new Bue(vN);
